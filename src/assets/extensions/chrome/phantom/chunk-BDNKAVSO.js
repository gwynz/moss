import{a as _}from"./chunk-5ZVHSBHF.js";import{w as Ie}from"./chunk-DQLUBVF4.js";import{h as Ae}from"./chunk-4GL3WODX.js";import{Na as D}from"./chunk-KWNEQJE2.js";import{a as k}from"./chunk-ZGQB4B3Z.js";import{a as P}from"./chunk-OJPBMZQC.js";import{F as Ce}from"./chunk-FLYQWZR6.js";import{a as He}from"./chunk-CYENH7PC.js";import{$a as Pe,Ba as ge,Ca as Ee,Da as ve,Ea as we,Fa as xe,Ga as Se,H as pe,Ha as Te,Ja as be,Ka as Re,Z as de,fa as me,s as le,ua as fe,va as R,wa as ye,ya as I,za as he}from"./chunk-F236ETGH.js";import{A as x,Gc as T,Hc as b,Hd as se,Id as ie,Jd as ae,Kc as S,Nf as qe,ce,ib as Ge,jb as ne,je as W,le as ue,pb as oe,qb as M}from"./chunk-LPV5DSV2.js";import{B as y}from"./chunk-NEE4FZIK.js";import{f as te,y as re}from"./chunk-JYKVQ4NC.js";import{a as n,d as Fe,e as We,g as F,i as d,j as g,n as m}from"./chunk-TSHWMJEM.js";var Oe=Fe(w=>{"use strict";d();m();Object.defineProperty(w,"__esModule",{value:!0});w.TokenData=void 0;w.parse=Y;w.compile=ht;w.match=Et;w.pathToRegexp=je;w.stringify=xt;var H="/",J=n(e=>e,"NOOP_VALUE"),Ke=/^[$_\p{ID_Start}]$/u,X=/^[$\u200c\u200d\p{ID_Continue}]$/u,j="https://git.new/pathToRegexpError",mt={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function ft(e){return e.replace(/[{}()\[\]+?!:*]/g,"\\$&")}n(ft,"escapeText");function v(e){return e.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}n(v,"escape");function*yt(e){let t=[...e],r=0;function o(){let s="";if(Ke.test(t[++r]))for(s+=t[r];X.test(t[++r]);)s+=t[r];else if(t[r]==='"'){let i=r;for(;r<t.length;){if(t[++r]==='"'){r++,i=0;break}t[r]==="\\"?s+=t[++r]:s+=t[r]}if(i)throw new TypeError(`Unterminated quote at ${i}: ${j}`)}if(!s)throw new TypeError(`Missing parameter name at ${r}: ${j}`);return s}for(n(o,"name");r<t.length;){let s=t[r],i=mt[s];if(i)yield{type:i,index:r++,value:s};else if(s==="\\")yield{type:"ESCAPED",index:r++,value:t[r++]};else if(s===":"){let a=o();yield{type:"PARAM",index:r,value:a}}else if(s==="*"){let a=o();yield{type:"WILDCARD",index:r,value:a}}else yield{type:"CHAR",index:r,value:t[r++]}}return{type:"END",index:r,value:""}}n(yt,"lexer");var G=class{static{n(this,"Iter")}constructor(t){this.tokens=t}peek(){if(!this._peek){let t=this.tokens.next();this._peek=t.value}return this._peek}tryConsume(t){let r=this.peek();if(r.type===t)return this._peek=void 0,r.value}consume(t){let r=this.tryConsume(t);if(r!==void 0)return r;let{type:o,index:s}=this.peek();throw new TypeError(`Unexpected ${o} at ${s}, expected ${t}: ${j}`)}text(){let t="",r;for(;r=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=r;return t}},q=class{static{n(this,"TokenData")}constructor(t){this.tokens=t}};w.TokenData=q;function Y(e,t={}){let{encodePath:r=J}=t,o=new G(yt(e));function s(a){let c=[];for(;;){let p=o.text();p&&c.push({type:"text",value:r(p)});let l=o.tryConsume("PARAM");if(l){c.push({type:"param",name:l});continue}let u=o.tryConsume("WILDCARD");if(u){c.push({type:"wildcard",name:u});continue}if(o.tryConsume("{")){c.push({type:"group",tokens:s("}")});continue}return o.consume(a),c}}n(s,"consume");let i=s("END");return new q(i)}n(Y,"parse");function ht(e,t={}){let{encode:r=encodeURIComponent,delimiter:o=H}=t,s=e instanceof q?e:Y(e,t),i=$e(s.tokens,o,r);return n(function(c={}){let[p,...l]=i(c);if(l.length)throw new TypeError(`Missing parameters: ${l.join(", ")}`);return p},"path")}n(ht,"compile");function $e(e,t,r){let o=e.map(s=>gt(s,t,r));return s=>{let i=[""];for(let a of o){let[c,...p]=a(s);i[0]+=c,i.push(...p)}return i}}n($e,"tokensToFunction");function gt(e,t,r){if(e.type==="text")return()=>[e.value];if(e.type==="group"){let s=$e(e.tokens,t,r);return i=>{let[a,...c]=s(i);return c.length?[""]:[a]}}let o=r||J;return e.type==="wildcard"&&r!==!1?s=>{let i=s[e.name];if(i==null)return["",e.name];if(!Array.isArray(i)||i.length===0)throw new TypeError(`Expected "${e.name}" to be a non-empty array`);return[i.map((a,c)=>{if(typeof a!="string")throw new TypeError(`Expected "${e.name}/${c}" to be a string`);return o(a)}).join(t)]}:s=>{let i=s[e.name];if(i==null)return["",e.name];if(typeof i!="string")throw new TypeError(`Expected "${e.name}" to be a string`);return[o(i)]}}n(gt,"tokenToFunction");function Et(e,t={}){let{decode:r=decodeURIComponent,delimiter:o=H}=t,{regexp:s,keys:i}=je(e,t),a=i.map(c=>r===!1?J:c.type==="param"?r:p=>p.split(o).map(r));return n(function(p){let l=s.exec(p);if(!l)return!1;let u=l[0],f=Object.create(null);for(let E=1;E<l.length;E++){if(l[E]===void 0)continue;let h=i[E-1],B=a[E-1];f[h.name]=B(l[E])}return{path:u,params:f}},"match")}n(Et,"match");function je(e,t={}){let{delimiter:r=H,end:o=!0,sensitive:s=!1,trailing:i=!0}=t,a=[],c=[],p=s?"":"i",u=(Array.isArray(e)?e:[e]).map(h=>h instanceof q?h:Y(h,t));for(let{tokens:h}of u)for(let B of $(h,0,[])){let Be=vt(B,r,a);c.push(Be)}let f=`^(?:${c.join("|")})`;return i&&(f+=`(?:${v(r)}$)?`),f+=o?"$":`(?=${v(r)}|$)`,{regexp:new RegExp(f,p),keys:a}}n(je,"pathToRegexp");function*$(e,t,r){if(t===e.length)return yield r;let o=e[t];if(o.type==="group"){let s=r.slice();for(let i of $(o.tokens,0,s))yield*$(e,t+1,i)}else r.push(o);yield*$(e,t+1,r)}n($,"flatten");function vt(e,t,r){let o="",s="",i=!0;for(let a=0;a<e.length;a++){let c=e[a];if(c.type==="text"){o+=v(c.value),s+=c.value,i||(i=c.value.includes(t));continue}if(c.type==="param"||c.type==="wildcard"){if(!i&&!s)throw new TypeError(`Missing text after "${c.name}": ${j}`);c.type==="param"?o+=`(${wt(t,i?"":s)}+)`:o+="([\\s\\S]+)",r.push(c),s="",i=!1;continue}}return o}n(vt,"sequenceToRegExp");function wt(e,t){return t.length<2?e.length<2?`[^${v(e+t)}]`:`(?:(?!${v(e)})[^${v(t)}])`:e.length<2?`(?:(?!${v(t)})[^${v(e)}])`:`(?:(?!${v(t)}|${v(e)})[\\s\\S])`}n(wt,"negate");function xt(e){return e.tokens.map(n(function t(r,o,s){if(r.type==="text")return ft(r.value);if(r.type==="group")return`{${r.tokens.map(t).join("")}}`;let a=St(r.name)&&Tt(s[o+1])?r.name:JSON.stringify(r.name);if(r.type==="param")return`:${a}`;if(r.type==="wildcard")return`*${a}`;throw new TypeError(`Unexpected token: ${r}`)},"stringifyToken")).join("")}n(xt,"stringify");function St(e){let[t,...r]=e;return Ke.test(t)?r.every(o=>X.test(o)):!1}n(St,"isNameSafe");function Tt(e){return e?.type!=="text"?!0:!X.test(e.value[0])}n(Tt,"isNextNameSafe")});d();m();d();m();var Me=n(e=>{let t=new P,r=new ae({storage:t,getPassword:e}),o=ie.fromStorage(t,r),s=new ne,i=new Te({[R.KeyPair]:{[x.Solana]:xe(),[x.EVM]:ge(),[x.BitcoinTaproot]:I(),[x.BitcoinNativeSegwit]:I(),[x.BitcoinNestedSegwit]:I(),[x.BitcoinLegacy]:I(),[x.Sui]:Se(),JWT:Ee(),KMSPKIAuthenticator:we(),Cash:he()},[R.Ledger]:Ie(),[R.SeedVault]:{type:R.SeedVault,async sign(){return ye(fe.UnsupportedOperation)}},[R.KMS]:ve()}),a=n(()=>Promise.resolve(ue()),"getChainAvailability"),c={generalStorage:t,secretsStorage:o,secureCache:Pe({isEnabled:n(()=>!_("kill-vault-secure-cache"),"isEnabled"),generalStorage:t,secretsStorage:o}),fetchChainAvailability:a,keypairGenerator:s,vaultSigner:i};return{vault:be(c),getChainAvailability:a,encryptedStorage:o,storageEncryptionKeyManager:r}},"createBrowserVault");d();m();var Je=/^\.phantom-labs\.vault\.seed\.[0-9A-Fa-f]+$/,Xe=/^\.phantom-labs\.vault\.privateKey\.[0-9A-Fa-f]+$/;async function De(e){let t;try{if(t=await e.storageEncryptionKeyManager.hasPersistedDeviceEncryptionKey(),!t)return{status:"noMiddleEncryptionKey"}}catch{return{status:"errorRetrievingMiddleEncryptionKey"}}let r;try{r=(await e.vault.checkVaultIntegrity()).status}catch{return{status:"errorUnableToCheckVaultIntegrity"}}try{let o=await e.generalStorage.getAll(),[s,i]=await ke(e,o,Je),[a,c]=await ke(e,o,Xe);return{status:"hasMiddleEncryptionKey",vaultStatus:r,numberOfEncryptedSeeds:s,numberOfDecryptableSeeds:i,numberOfEncryptedPrivateKeys:a,numberOfDecryptablePrivateKeys:c}}catch{return{status:"errorUnableToCountDecryptableValues",vaultStatus:r}}}n(De,"checkExtensionStorageIntegrity");async function ke(e,t,r){let o=0,s=0;for(let[i,a]of Object.entries(t))if(!(!i.match(r)||!se.safeParse(a).success)){o++;try{await e.secretsStorage.getSecureValue(i),s++}catch{}}return[o,s]}n(ke,"countDecryptableValues");var er="HAS_ONBOARDING_BEEN_OPENED",tr="EXTENSION_LOCKED",K=null,rr=n(()=>K,"getInMemoryPassword"),Ye=n(e=>{K=e},"setInMemoryPassword"),nr=n(()=>{K=null},"resetInMemoryPassword"),ze=n(()=>K??null,"getInMemoryPasswordCallback"),{vault:C,getChainAvailability:or,encryptedStorage:Qe,storageEncryptionKeyManager:_e}=Me(ze),sr=n(async e=>!e||!await S.startSpan("storageEncryptionKeyManager.verifyPassword",()=>_e.verifyPassword(e))?!1:(Ye(e),!0),"verifyAndSetInMemoryPassword"),ir=n(async()=>{let e=await C.deriveAddresses();return e&&(S.addBreadcrumb(b.Account,"\u2705 Derived new addresses in Vault",T.Info),await D.invalidateQueries({refetchType:"all"})),e},"deriveNewVaultAddresses"),ar=n(async()=>{if(!_("kill-extension-storage-integrity-check"))try{let e=await De({generalStorage:new P,secretsStorage:Qe,storageEncryptionKeyManager:_e,vault:C});e.status!=="hasMiddleEncryptionKey"&&k.capture("extensionStorageIntegrityCheck",{data:{extensionStorageIntegrityCheck:e}})}catch{}},"logExtensionStorageIntegrity");var A={};We(A,{any:()=>tt,cancelled:()=>dt,chainDisconnected:()=>rt,error:()=>et,internalError:()=>ot,invalidInput:()=>nt,methodNotFound:()=>st,rateLimited:()=>lt,resourceUnavailable:()=>it,result:()=>Ze,transactionRejected:()=>at,unauthorized:()=>ct,unsupportedMethod:()=>ut,userRejectedRequest:()=>pt});d();m();var Ze=n((e,t)=>({jsonrpc:"2.0",id:e,result:t}),"result"),et=n((e,t)=>({jsonrpc:"2.0",id:e,error:t}),"error"),tt=n((e,t)=>({...t,jsonrpc:"2.0",id:e}),"any"),rt=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.ChainDisconnected,message:t??"The Provider is not connected to the requested chain."}}),"chainDisconnected"),nt=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.InvalidInput,message:t??"Missing or invalid parameters."}}),"invalidInput"),ot=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.InternalError,message:t??"Something went wrong."}}),"internalError"),st=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.MethodNotFound,message:t??"Method does not exist."}}),"methodNotFound"),it=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.ResourceUnavailable,message:t??"Requested resource not available."}}),"resourceUnavailable"),at=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.TransactionRejected,message:t??"Transaction creation failed."}}),"transactionRejected"),ct=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.Unauthorized,message:t??"The requested method and/or account has not been authorized by the user."}}),"unauthorized"),ut=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.UnsupportedMethod,message:t??"The requested method is not supported."}}),"unsupportedMethod"),lt=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.RateLimited,message:t??"The requested method has been rate limited."}}),"rateLimited"),pt=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.UserRejectedRequest,message:t??"User rejected the request."}}),"userRejectedRequest"),dt=n((e,t)=>({id:e,jsonrpc:"2.0",error:{code:y.RequestCancelled,message:t??"The request was cancelled."}}),"cancelled");d();m();d();m();var Ve=F(Oe());function bt(e,t){return{request:e,source:t,id:qe()}}n(bt,"rpcRequestData");function Rt(){return{parse(e){return qt(e)}}}n(Rt,"route");function Pt(e,t){let r=new URL(e),o=r.host+r.pathname;return(0,Ve.match)(t)(o)}n(Pt,"parseDeepLinkUrl");function qt(e){function t(r,o,s){return n(async a=>{if(e.path&&a.source?.type==="DeepLinkRpcRequestSource"){let u=Pt(a.source.deepLinkUrl,e.path);u&&a.request.params&&typeof a.request.params=="object"&&(a.request.params={...a.request.params,...u.params})}let c={...a,request:e.request.parse(a.request)},p=[];for(let u of o){let f=await u(c,r);if(f){if(typeof f!="function")return setTimeout(()=>{for(let E of p)E(f)},0),f;p.push(f)}}let l=e.response.parse(await s(c,r));if(l.id!==a.request.id){let u="Request id does not match response id";throw console.error(u,{request:a.request,response:l}),new Error(u)}return setTimeout(()=>{for(let u of p)u(l)},0),l},"handleRpcRequest")}return n(t,"build"),{context(r){return{use:n((o,s)=>t(r,o,s),"use")}},use:n((r,o)=>t(void 0,r,o),"use")}}n(qt,"createRouteHandler");d();m();var z=class{static{n(this,"RpcRouter")}#e;constructor(t){this.#e=t}init(t,r){let o=new AbortController,{signal:s}=o,i=It(this.#e.routes,this.#e.concurrent);return{start:n(async()=>{if(s.aborted){console.warn("stream already closed");return}try{await t.pipeThrough(i,{signal:s}).pipeTo(r,{signal:s})}catch(a){s.aborted||console.error("RPC router stream error",a)}},"start"),stop:n(a=>{o.abort(a)},"stop")}}};function It(e,t){return new TransformStream({async transform(r,o){let s=n(async()=>{let i=e[r.request.method];if(!i){let a={jsonrpc:"2.0",id:r.request.id,error:{code:0,message:`${r.request.method} isn't implemented`}};o.enqueue([r,a]);return}try{let a=await i(r);o.enqueue([r,a]);return}catch(a){le(a)||console.error(`RPC ROUTER: Unexpected error in method: ${r.request.method}, message: ${a?.message}`);let c={jsonrpc:"2.0",id:r.request.id,error:{code:y.InternalError,message:"Unexpected error"}};o.enqueue([r,c]);return}},"process");t?s().catch(i=>{i?.name!=="AbortError"&&S.addBreadcrumb(b.Provider,"[RpcRouter] Unhandled error in concurrent process",T.Error,{error:String(i)})}):await s()}})}n(It,"createRpcRequestHandlerStream");d();m();var Ne=1e4,Q=class{static{n(this,"MutexQueue")}queue=[];isLocked=!1;currentTag=null;timeoutId=null;currentReject=null;constructor(){te()&&(globalThis.__PHANTOM_TEST_MUTEX__={cancelAllRequests:n(()=>this.cancelAllRequests(),"cancelAllRequests")})}_processNextRequest(){if(this.queue.length===0){this.isLocked=!1;return}let t=this.queue.shift();t&&(this.isLocked=!0,this.currentTag=t.tag,this.currentReject=t.reject,t.resolve())}async acquire(t){return this.isLocked?new Promise((r,o)=>{this.queue.push({tag:t,resolve:r,reject:o})}):(this.isLocked=!0,this.currentTag=t,this.timeoutId=setTimeout(()=>{this.currentTag===t&&this.currentReject&&(this.currentReject(new Error(`Mutex request timed out after ${Ne}ms for tag: ${t}`)),this.currentTag=null,this.isLocked=!1,this.currentReject=null,this._processNextRequest())},Ne),new Promise((r,o)=>{this.currentReject=o,r()}))}release(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.currentTag=null,this.currentReject=null,this._processNextRequest()}cancelTaggedRequests(t){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.currentTag===t&&(this.currentTag=null,this.isLocked=!1);let r=this.queue.filter(o=>o.tag===t);if(this.queue=this.queue.filter(o=>o.tag!==t),r.forEach(o=>{o.reject(new Error(`Mutex request cancelled for tag: ${t}`))}),!this.isLocked&&this.queue.length>0){let o=this.queue.shift();o&&(this.isLocked=!0,this.currentTag=o.tag,o.resolve())}}async runExclusive(t,r){await this.acquire(t);try{return await r()}finally{this.release()}}cancelAllRequests(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.currentReject&&this.currentReject(new Error("Mutex request cancelled")),this.queue.forEach(t=>{t.reject(new Error("Mutex request cancelled"))}),this.currentTag=null,this.currentReject=null,this.isLocked=!1,this.queue=[]}},O=new Q;async function Vr(e,t){return await O.acquire(t),A.result(e.id,!0)}n(Vr,"_serviceWorkerMutexAcquire");async function Nr(e){return O.release(),A.result(e.id,!0)}n(Nr,"_serviceWorkerMutexRelease");async function Ue(e){return O.runExclusive("default",e)}n(Ue,"runExclusiveAsServiceWorker");function Ur(e){O.cancelTaggedRequests(e)}n(Ur,"_cancelTaggedMutexRequests");d();m();var Ct={storage:new P,signer:{sign:n((e,t)=>pe(C,e,t),"sign"),getAuthenticationPublicKey:n(e=>C.getAuthenticationPublicKey(e),"getAuthenticationPublicKey"),getAllSecretIdentifiers:Re},queryClient:D,authConfig:Ae,runExclusive:Ue,isLocalTokenValidityCheckEnabled:n(()=>!W.isFeatureEnabled("kill-frontend-local-check"),"isLocalTokenValidityCheckEnabled"),isServerTimeEnabled:n(()=>!W.isFeatureEnabled("kill-frontend-server-time"),"isServerTimeEnabled")},Z=me(Ct);Z.subscribe(de.UserID,e=>{S.addBreadcrumb(b.Generic,`Auth userID: ${e}`,T.Info),k.addUserProperties({authUserId:e})});d();m();var V=F(Ge(),1),N=F(He(),1);var U=g.RT_PUBLIC_KEY,L=g.RT_ENDPOINT;async function At(){return(await Z.getUser())?.userID??null}n(At,"getAuthUserId");function Le(){try{return ce("enable-rt")===!0}catch{return!1}}n(Le,"isEnabled");async function ee(e,t,r){if(!(!U||!L))try{let o=oe(U),s=new TextEncoder().encode(JSON.stringify({t:Math.floor(Date.now()/1e3),s:e,o:t,v:re,...r})),i=V.default.box.keyPair(),a=V.default.randomBytes(24),c=V.default.box(s,a,o,i.secretKey);fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({c:M(c),k:M(i.publicKey),n:M(a)})})}catch{}}n(ee,"sendEvent");async function dn(e,t){if(!U||!L||!Le())return;let r=(()=>{try{return new URL(e).origin}catch{return e}})();try{let s=(await N.default.windows.getAll({populate:!0})).filter(u=>u.type==="popup");if(s.length>1){let u=s.flatMap(h=>h.tabs??[]).map(h=>{try{return new URL(h.url||"").origin}catch{return null}}).filter(h=>h!==null),f=u[0]??"",E={a:u,n:s.length,c:r};t&&(E.u=t),ee(1,f,E)}let i=await N.default.windows.getAll({windowTypes:["normal"]}),a=new Set(i.map(u=>u.id).filter(u=>u!=null)),p=(await N.default.tabs.query({active:!0})).find(u=>u.windowId!=null&&a.has(u.windowId)),l;if(p?.url)try{l=new URL(p.url).origin}catch{}if(l&&l!==r){let u={c:r,top:l};t&&(u.u=t),ee(3,r,u)}}catch{}}n(dn,"rt");async function mn(e){if(!(!U||!L||!Le()))try{let t=await Ce(e),r=Date.now(),o=30*60*1e3,s="",i=0;for(let p of Object.values(t.apps))for(let[l,u]of Object.entries(p)){let f=u.lastConnectedTimestamp;f&&f>i&&r-f<o&&(i=f,s=l)}let a={r:s||null,d:i?Math.floor((r-i)/1e3):null},c=await At().catch(()=>null);c&&(a.u=c),ee(2,s,a)}catch{}}n(mn,"recordExportSecurityContext");export{er as a,tr as b,rr as c,Ye as d,nr as e,C as f,or as g,Qe as h,_e as i,sr as j,ir as k,ar as l,bt as m,Rt as n,z as o,A as p,Vr as q,Nr as r,Ur as s,Z as t,dn as u,mn as v};
//# sourceMappingURL=chunk-BDNKAVSO.js.map
