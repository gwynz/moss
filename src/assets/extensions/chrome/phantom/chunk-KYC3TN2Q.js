import{d as Te}from"./chunk-RKISZW47.js";import{g as fe}from"./chunk-IAL2BZAA.js";import{a as Ae}from"./chunk-M6UNEOVM.js";import{a as D,b as x,c as re,e as h,f as T,g as ne,h as oe,i as ie,j as C,l as se,n as u,o as S,q as ae,r as ce,s as de,t as q,u as k,v as B}from"./chunk-DQLUBVF4.js";import{b as pe}from"./chunk-EOII3ZM4.js";import{a as ue,c as le,d as ge}from"./chunk-H3HVEJML.js";import{_a as H,v as me}from"./chunk-NDIBTKLE.js";import{c as E}from"./chunk-6JMEWALM.js";import{Na as G}from"./chunk-KWNEQJE2.js";import{Ad as y,Hc as J,Kc as X,V as j,df as W,ff as Z,ud as F}from"./chunk-LPV5DSV2.js";import{_ as ee}from"./chunk-NEE4FZIK.js";import{a as Y}from"./chunk-BYU664DD.js";import{Ba as K,L as V,La as te,M as z,Y as Q,c as U}from"./chunk-JYKVQ4NC.js";import{a as i,g as M,i as c,n as d}from"./chunk-TSHWMJEM.js";c();d();c();d();c();d();var I=i(()=>{let n=T.isLedgerSupported();return y({queryKey:n,queryFn:i(async()=>B().isSupported(),"queryFn")})},"default");c();d();var Le=i((n,e=[],o=!1,t=!1,l=()=>{})=>{let{defaultTransportTimeout:f}=B(),p=F(),a=ae(j.getAddressType(e[0].pathType)),m=n.isConnected&&e.length>0&&a===n.selectedApp?.app,g=T.ledgerAddresses(e,t);return y({enabled:m,queryKey:g,queryFn:i(async()=>{let s=await p.getQueryData(T.ledgerTransportState());if(!s)throw new se;return ce({transportTimeout:f,state:s,derivationPathParams:e,enableDebugLogs:o,enableLedgerXPubDerivation:t,onSuccess:l})},"queryFn"),retry:!1})},"default");c();d();var O=i((n=!1,e,o)=>{if(e?.status===o.status)return;let t,l="";switch(o.status){case"connected":t="\u{1F7E2} Connected",l=`, selected app: ${o.selectedApp?S(o.selectedApp.app):"None"}`;break;case"needs-permission":t="\u{1F7E0} Needs Permission";break;case"reconnecting":t="\u{1F7E0} Reconnecting";break;case"waiting-for-approval":t="\u{1F7E0} Waiting For Approval";break;case"not-connected":t="\u26AA\uFE0F Not Connected";break}u(n,`${t}${l}`)},"debugLogStateChange");c();d();var R=M(V());var xe=5,he=500,$=i((n=!0,e=!1,o=2e3)=>{let t=F(),[l,f]=(0,R.useState)(o),p=(0,R.useCallback)(()=>{u(e,"disconnect event received from Ledger transport."),ie(t)},[e,t]);(0,R.useEffect)(()=>("hid"in self.navigator&&self.navigator.hid.addEventListener("disconnect",p),()=>"hid"in self.navigator&&self.navigator.hid.removeEventListener("disconnect",p)),[p]);let{data:a=!1}=I(),m=n&&a,g=T.ledgerTransportState();return y({enabled:m,queryKey:g,queryFn:i(async()=>{if(!m)return D;let s=t.getQueryData(g),A,w=!1,P=0;do{try{A=(await Promise.all([Z(q(k(),e,P>0?x:s),o),W(200)]))[0]}catch{A=D}w=!!s?.isConnected&&A.status==="not-connected"&&++P<xe,w&&(C(t,x),u(e,"Attempting to reconnect..."),P===1&&O(e,s,x),await W(he))}while(w);return P>0&&(s=x),O(e,s,A),s?.isConnected&&!A.isConnected&&ne(t).then(()=>oe(t)),f(A.isConnected?3500:o),A},"queryFn"),refetchOnMount:!0,refetchInterval:l,initialData:D})},"useLedgerWireTransportState");c();d();var Se=i((n=!0,e=!1)=>{let o=k(),t=F(),l=T.requestLedgerPermission();return y({enabled:n,queryKey:l,queryFn:i(async()=>{let p;try{u(e,"Requesting permission to connect to Ledger..."),p=await o.request()}catch(m){if(u(e,`Received error trying to request permission: ${m}`),typeof m.message=="string"&&m.message?.includes("device is already open")){u(e,"\u2705 Permission granted, device already open. Connecting to device...");let g=T.ledgerTransportState(),v=await t.getQueryData(g),s;try{s=await q(o,e,v)}catch{}return s?.isConnected?(u(e,`\u2705 Permission granted. Connected to Ledger device: ${s.transport.deviceModel?.productName??"Unknown device"}. Selected app: ${s?.selectedApp?.app??"none"}`),await C(t,s),O(e,void 0,s),{type:"granted",transport:s.transport}):(u(e,"\u274C Unable to connect. Try again and make sure device is unlocked."),{type:"unable-to-connect"})}return u(e,"\u274C Permission denied."),{type:"denied"}}if(!p)return u(e,"\u274C Unable to connect to Ledger device. Permission granted, but no Transport received."),{type:"unable-to-connect"};let a={status:"connected",isConnected:!0,transport:p,selectedApp:await de(p,o.defaultTransportTimeout)};return await C(t,a),O(e,void 0,a),u(e,`\u2705 Permission granted. Connected to Ledger device: ${p.deviceModel?.productName??"Unknown device"}`),{type:"granted",transport:p}},"queryFn"),gcTime:0,staleTime:0,refetchOnMount:!0})},"default");var L=M(V(),1);c();d();var ye=i(async n=>{C(G,re);try{return await n()}finally{C(G,x)}},"runLedgerActionWithApprovalState");var r=M(z(),1),Ee=E.div`
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  width: 100%;
`,Ne=E(Te)`
  margin: auto 0px;
  padding-left: 10px;
  padding-right: 10px;
`,ve=E.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
`,we=E.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 55px;
`,b=E(H).attrs({size:28,lineHeight:34,weight:500})`
  margin-bottom: 8px;
  margin-top: 22px;
`,_=E(H).attrs({size:16,color:K.colors.legacy.textDiminished})`
  max-width: 275px;
  span {
    color: white;
  }
`,Pe={ledgerActionNeedToConfirm:"ledgerActionNeedToConfirm",ledgerActionNeedToConfirmMany:"ledgerActionNeedToConfirmMany",ledgerActionNeedToConfirmBlind:"ledgerActionNeedToConfirmBlind",ledgerActionNeedToConfirmBlindMany:"ledgerActionNeedToConfirmBlindMany",ledgerActionPleaseConnect:"ledgerActionPleaseConnect",ledgerActionConfirm:"ledgerActionConfirm",ledgerActionNeedPermission:"ledgerActionNeedPermission",ledgerActionPleaseConnectAndConfirm:"ledgerActionPleaseConnectAndConfirm",commandContinue:"commandContinue",commandCancel:"commandCancel"},cr=i(n=>!!(n&&(n.statusCode===26632||n.statusCode===27013||n.statusCode===27404||n.name==="DisconnectedDeviceDuringOperation")),"isKnownLedgerActionError"),Ce=i(n=>{switch(n){case h.Bitcoin:return!1;case h.EVM:return!0;case h.Solana:return!0;case h.Sui:return!1}},"ledgerAppHasBlindSigning"),Fe=i(n=>{let{data:e=D}=$(!0,U());return(0,L.useMemo)(()=>({status:e.status,isConnected:e.isConnected,isExpectedSelectedAppOpen:e.isConnected&&e.selectedApp?.app===n,transport:e.isConnected?e.transport:void 0}),[n,e])},"useMultiChainLedgerConnectivity"),De=i((n,e,o)=>{let{ledgerApp:t=h.Solana,ledgerAction:l,numberOfTransactions:f=1,cancel:p=ee}=n,{t:a}=Q(),m,g;f>1?Ce(t)?g=a(o.ledgerActionNeedToConfirmBlindMany,{numberOfTransactions:f,chainType:S(t)}):g=a(o.ledgerActionNeedToConfirmMany,{numberOfTransactions:f,chainType:S(t)}):Ce(t)?g=a(o.ledgerActionNeedToConfirmBlind,{chainType:S(t)}):g=a(o.ledgerActionNeedToConfirm,{chainType:S(t)});let v=a(o.commandCancel),s="default",A=p,w=(0,L.useRef)(!1);switch(e.status){case"not-connected":{m=a(o.ledgerActionPleaseConnect);break}case"reconnecting":case"waiting-for-approval":case"connected":{m=a(o.ledgerActionConfirm);break}case"needs-permission":{m=a(o.ledgerActionNeedPermission),g=a(o.ledgerActionPleaseConnectAndConfirm),s="primary",v=a(o.commandContinue),A=i(()=>{pe({url:"connect_hardware.html?permission=true"}),p()},"buttonAction");break}}return(0,L.useEffect)(()=>{!w.current&&e.isConnected&&e.transport&&(e.isExpectedSelectedAppOpen===null||e.isExpectedSelectedAppOpen)&&(w.current=!0,ye(()=>l(e.transport)).catch(P=>{X.captureError(P,J.Ledger)}))},[e,l]),{primaryText:m,secondaryText:g,buttonTheme:s,buttonText:v,buttonAction:A}},"useStatelessLedgerActionProps"),Oe=L.default.memo(n=>{let{primaryText:e,secondaryText:o,buttonAction:t,buttonTheme:l,buttonText:f}=n;return(0,r.jsxs)(Ee,{children:[(0,r.jsx)(Ne,{icon:(0,r.jsx)(ue,{diameter:75}),primaryText:e,secondaryText:o}),(0,r.jsx)(te,{marginTop:16,children:(0,r.jsx)(le,{onClick:t,theme:l,children:f})})]})}),Re=i(n=>{let e=Fe(n.ledgerApp??h.Solana),o=De(n,e,Pe);return(0,r.jsx)(Oe,{...o})},"MultiChainLedgerAction"),dr=i(n=>(0,r.jsx)(Re,{...n}),"LedgerAction"),pr=i(({ledgerActionError:n,onRetryClick:e,onCancelClick:o})=>{let{t}=Q();return(0,r.jsxs)(ve,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(fe,{children:t("ledgerActionErrorHeader")}),(0,r.jsxs)(we,{children:[(0,r.jsx)(Ae,{color:Y(K.colors.legacy.spotNegative,.1),diameter:94,children:(0,r.jsx)(me,{width:32})}),n?.statusCode===26632?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorBlindSignDisabledPrimaryText")}),(0,r.jsx)(_,{children:t("ledgerActionErrorBlindSignDisabledSecondaryText")})]}):(0,r.jsx)(r.Fragment,{}),n?.statusCode===27013?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorUserRejectionPrimaryText")}),(0,r.jsx)(_,{children:t("ledgerActionErrorUserRejectionSecondaryText")})]}):(0,r.jsx)(r.Fragment,{}),n?.statusCode===27404?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorDeviceLockedPrimaryText")}),(0,r.jsx)(_,{children:t("ledgerActionErrorDeviceLockedSecondaryText")})]}):(0,r.jsx)(r.Fragment,{}),n?.name==="DisconnectedDeviceDuringOperation"?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorDeviceDisconnectedDuringOperationPrimaryText")}),(0,r.jsx)(_,{children:t("ledgerActionErrorDeviceDisconnectedDuringOperationSecondaryText")})]}):(0,r.jsx)(r.Fragment,{})]})]}),(0,r.jsx)(ge,{primaryText:t("commandRetry"),secondaryText:t("commandCancel"),onPrimaryClicked:e,onSecondaryClicked:o})]})},"LedgerActionError");export{I as a,Le as b,$ as c,Se as d,cr as e,dr as f,pr as g};
//# sourceMappingURL=chunk-KYC3TN2Q.js.map
