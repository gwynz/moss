import{a as $6,f as i6,g as q6}from"./chunk-4AQPJCXC.js";import{$ as E6,Ta as QA,Ub as a6,ac as o6,ja as zA,lb as n6,na as WA,p as YA}from"./chunk-F236ETGH.js";import{Ad as xA,Bd as tA,Fd as e6,Gc as I,Hc as F,Kc as l,Mf as kA,Nf as uj,_c as Z,bd as AA,be as B6,h as UA,i as VA,je as k6,k as JA,ob as W,oe as Ij,ud as jA,wd as rA}from"./chunk-LPV5DSV2.js";import{L as gA,M as m7,Y as s6,a as cj,e as Gj,g as dj,w as D}from"./chunk-JYKVQ4NC.js";import{a as e,e as f7,g as GA,i as n,m as Buffer,n as a}from"./chunk-TSHWMJEM.js";n();a();n();a();n();a();function KA(A){if(!Number.isSafeInteger(A)||A<0)throw new Error(`positive integer expected, not ${A}`)}e(KA,"number");function pj(A){if(typeof A!="boolean")throw new Error(`boolean expected, not ${A}`)}e(pj,"bool");function vj(A){return A instanceof Uint8Array||A!=null&&typeof A=="object"&&A.constructor.name==="Uint8Array"}e(vj,"isBytes");function J(A,...j){if(!vj(A))throw new Error("Uint8Array expected");if(j.length>0&&!j.includes(A.length))throw new Error(`Uint8Array expected of length ${j}, not of length=${A.length}`)}e(J,"bytes");function Oj(A,j=!0){if(A.destroyed)throw new Error("Hash instance has been destroyed");if(j&&A.finished)throw new Error("Hash#digest() has already been called")}e(Oj,"exists");function F6(A,j){J(A);let r=j.outputLen;if(A.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}e(F6,"output");var oA=e(A=>new Uint32Array(A.buffer,A.byteOffset,Math.floor(A.byteLength/4)),"u32"),l6=e(A=>new DataView(A.buffer,A.byteOffset,A.byteLength),"createView"),h7=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!h7)throw new Error("Non little-endian hardware is not supported");function fj(A){if(typeof A!="string")throw new Error(`string expected, got ${typeof A}`);return new Uint8Array(new TextEncoder().encode(A))}e(fj,"utf8ToBytes");function ZA(A){if(typeof A=="string")A=fj(A);else if(vj(A))A=A.slice();else throw new Error(`Uint8Array expected, got ${typeof A}`);return A}e(ZA,"toBytes");function c6(...A){let j=0;for(let t=0;t<A.length;t++){let B=A[t];J(B),j+=B.length}let r=new Uint8Array(j);for(let t=0,B=0;t<A.length;t++){let s=A[t];r.set(s,B),B+=s.length}return r}e(c6,"concatBytes");function G6(A,j){if(j==null||typeof j!="object")throw new Error("options must be defined");return Object.assign(A,j)}e(G6,"checkOpts");function d6(A,j){if(A.length!==j.length)return!1;let r=0;for(let t=0;t<A.length;t++)r|=A[t]^j[t];return r===0}e(d6,"equalBytes");var mj=e((A,j)=>(Object.assign(j,A),j),"wrapCipher");function hj(A,j,r,t){if(typeof A.setBigUint64=="function")return A.setBigUint64(j,r,t);let B=BigInt(32),s=BigInt(4294967295),k=Number(r>>B&s),E=Number(r&s),o=t?4:0,$=t?0:4;A.setUint32(j+o,k,t),A.setUint32(j+$,E,t)}e(hj,"setBigUint64");n();a();var I6;(function(A){A.Initial="initial",A.Create="create",A.ImportSeed="importSeed",A.ImportPrivateKey="importPrivateKey",A.ConnectHardware="connectHardware",A.SeedlessRecover="seedlessRecover",A.SeedlessBackup="seedlessBackup",A.SeedVault="seedVault",A.Append="append"})(I6||(I6={}));var M7=D.object({balance:D.boolean(),history:D.boolean()}),at=D.record(D.string(),M7),TA=class extends Error{static{e(this,"SetTermsAcknowledgementError")}constructor(j){super(j),this.name="SetTermsAcknowledgementError"}};var DA;(function(A){A.FirstTimeOnboarding="firstTimeOnboarding",A.IsResettingApp="isResettingApp",A.OnBoardedAt="onboardedAt"})(DA||(DA={}));var ct=e(async(A,j)=>{try{return await A.set(QA.TermsHaveBeenAcknowledgedLastSeenVersion,j)}catch{throw new TA("Error Setting Terms Acknowledgement")}},"setTermsAcknowledgement"),Gt=e(async A=>await A.get(QA.TermsHaveBeenAcknowledgedLastSeenVersion)??0,"getTermsAcknowledgementLastSeenVersion"),dt=e(async A=>{try{return await A.remove(QA.TermsHaveBeenAcknowledgedLastSeenVersion)}catch{throw new TA("Error Clearing Terms Acknowledgement")}},"clearTermsAcknowledgement");n();a();var u6=GA(m7()),Aj=GA(gA());var p6=(0,Aj.createContext)(null);function g7({children:A,seedlessRepository:j}){return(0,u6.jsx)(p6.Provider,{value:{seedlessRepository:j},children:A})}e(g7,"SeedlessProvider");function x7(){let A=(0,Aj.useContext)(p6);if(!A)throw new Error("useSeedlessContext must be used within a SeedlessProvider");return A}e(x7,"useSeedlessContext");function R(){return x7().seedlessRepository}e(R,"useSeedlessRepository");n();a();n();a();var K7=D.record(D.string(),D.number()),b7=D.object({type:D.union([D.literal("Buffer"),D.literal("Object")]),data:D.array(D.number())}),_7=D.union([K7,b7]),v6=D.object({seeds:D.array(D.tuple([D.string(),_7]))}),O6=e(A=>y7(A)?new Uint8Array(Buffer.from(A.data)):new Uint8Array(Object.values(A)),"bundleBytesLikeToUint8Array"),y7=e(A=>!!A&&typeof A=="object"&&Ij("type",A)&&typeof A.type=="string"&&Ij("data",A)&&Array.isArray(A.data)&&A.data.every(j=>!Number.isNaN(parseInt(j))),"isSerializedBuffer"),f6=D.object({deviceId:D.string(),encryptionKey:D.string().length(44).base64()}),dA;(function(A){A.RotationResult="seedlessRotationResult",A.RecoverResult="seedlessRecoverResult",A.BackupResult="seedlessBackupResult"})(dA||(dA={}));n();a();n();a();var sA="/seedless",w7="https://phantom-wallet.zendesk.com/hc/en-us/articles/32775281256851";var m6="/seedless";n();a();var bA=class extends Error{static{e(this,"JuiceboxBackupError")}reasonString;reasonCode;constructor(j){super("Failed to backup share from Juicebox"),this.reasonCode=j,this.reasonString=jj[j]}},_A=class extends Error{static{e(this,"JuiceboxRecoverError")}guessesRemaining;reasonString;reasonCode;constructor(j,r){super("Failed to recover share from Juicebox"),this.guessesRemaining=r,this.reasonCode=j,this.reasonString=eA[j]}},LA=class extends Error{static{e(this,"JuiceboxDeleteError")}reasonString;reasonCode;constructor(j){super("Failed to delete share from Juicebox"),this.reasonCode=j,this.reasonString=Mj[j]}},jj;(function(A){A[A.InvalidAuth=0]="InvalidAuth",A[A.UpgradeRequired=1]="UpgradeRequired",A[A.Assertion=2]="Assertion",A[A.Transient=3]="Transient"})(jj||(jj={}));var eA;(function(A){A[A.InvalidPin=0]="InvalidPin",A[A.NotRegistered=1]="NotRegistered",A[A.InvalidAuth=2]="InvalidAuth",A[A.UpgradeRequired=3]="UpgradeRequired",A[A.Assertion=4]="Assertion",A[A.Transient=5]="Transient",A[A.CooldownTimer=6]="CooldownTimer"})(eA||(eA={}));var Mj;(function(A){A[A.InvalidAuth=0]="InvalidAuth",A[A.UpgradeRequired=1]="UpgradeRequired",A[A.RateLimitExceeded=2]="RateLimitExceeded",A[A.Assertion=3]="Assertion",A[A.Transient=4]="Transient"})(Mj||(Mj={}));var P7=e(A=>rj(A)||h6(A)||M6(A),"isJuiceboxError"),rj=e(A=>A instanceof _A,"isJuiceboxRecoverError"),h6=e(A=>A instanceof bA,"isJuiceboxBackupError"),M6=e(A=>A instanceof LA,"isJuiceboxDeleteError");n();a();var FA=e(A=>{let j=gj(A),r=JSON.stringify(j),t=typeof r=="string"?r:String(r),B=typeof TextEncoder<"u"?new TextEncoder().encode(t):Buffer.from(t,"utf8");return UA(e6(B instanceof Uint8Array?B:Uint8Array.from(B)))},"hashJSON");function tj(A){return/^\d+$/.test(A)}e(tj,"isNumeric");var $A=e(A=>A.length!==4?!1:tj(A),"isValidPin"),ej=e(A=>{let j=A?.realms?.map(r=>{if(!r.address)return null;try{return new URL(r.address).host}catch{return r.address}}).filter(r=>!!r)??[];return Array.from(new Set(j))},"getConfigRealmHosts"),gj=e(A=>{if(Array.isArray(A))return A.map(j=>typeof j=="object"?gj(j):j).sort();if(typeof A=="object"&&A!==null){let j={},r=Object.keys(A).sort();for(let t of r)j[t]=gj(A[t]);return j}else return A},"sortKeys"),xj=e(A=>{let j=Math.max(0,Math.floor(A/1e3)),r=Math.floor(j/60).toString(),t=j%60>9?`${j%60}`:`0${j%60}`;return{minutes:r,seconds:t}},"extractMinutesAndSeconds");var g6=3,T7=200,x6=7e3;globalThis.JuiceboxGetAuthToken=async A=>{let j=Buffer.from(A).toString("hex");return globalThis.JuiceboxTokens[j]};var NA=e((A,j)=>{if(typeof A!="object"||A===null)return;let r=A[j];return typeof r=="number"?r:void 0},"getNumericField"),K6=e(A=>typeof A=="number"?A:NA(A,"reason")??-1,"getReasonCode"),Kj=class{static{e(this,"JuiceboxClient")}encoder;provider;constructor(j){this.encoder=new TextEncoder,this.provider=j}async getJwts(j){let r=`${m6}/v1/juiceboxtoken`;l.addBreadcrumb(F.Seedless,"Juicebox JWT request started",I.Debug,{maxAttempts:g6,timeoutMs:x6});try{let t=await Z.api().bearer(j).retry(g6-1,T7).post(r,void 0,{fetchTimeout:x6});if(!AA(t))throw Object.assign(new Error(`Juicebox JWT request failed with status ${t.status}`),{status:t.status});if(typeof t.data!="object"||t.data===null)throw new Error("Juicebox JWT response data is malformed");this.provider.setJuiceboxTokens(t.data),l.addBreadcrumb(F.Seedless,"Juicebox JWT request succeeded",I.Debug,{status:t.status})}catch(t){let B=t instanceof Error?t:new Error("Juicebox JWT request failed");throw l.addBreadcrumb(F.Seedless,"Juicebox JWT request failed",I.Error,{status:NA(t,"status")??null,error:B.message}),l.captureError(B,F.Seedless),B}}async sendJuiceboxShare(j,r,t,B){await this.getJwts(B);try{await this.provider.backupShare(j,r,this.encoder.encode(t),this.encoder.encode("phantom"),7),l.addBreadcrumb(F.Seedless,"Successful backup share to Juicebox",I.Debug)}catch(s){l.addBreadcrumb(F.Seedless,"Failed to backup share to Juicebox",I.Error);let k=new bA(K6(s));throw l.captureError(k,F.Seedless),k}return!0}async getJuiceboxShare(j,r,t){let B=ej(j),s=j.realms.length;l.addBreadcrumb(F.Seedless,"Juicebox share recover started",I.Info,{realmCount:s,realmHosts:B.join(",")}),await this.getJwts(t);try{let k=await this.provider.recoverShare(j,this.encoder.encode(r),this.encoder.encode("phantom"));return l.addBreadcrumb(F.Seedless,"Juicebox share recover succeeded",I.Info,{shareByteLength:k.length}),k}catch(k){let E=NA(k,"reason")??-1,o=NA(k,"guessesRemaining")??NA(k,"guesses_remaining");l.addBreadcrumb(F.Seedless,"Juicebox share recover failed",I.Error,{reason:E,guessesRemaining:o??null});let $=new _A(E,o);throw l.captureError($,F.Seedless),$}}async deleteShare(j,r){await this.getJwts(r);try{await this.provider.deleteShare(j),l.addBreadcrumb(F.Seedless,"Successfully deleted share from Juicebox",I.Debug)}catch(t){l.addBreadcrumb(F.Seedless,"Failed to delete share from Juicebox",I.Error);let B=new LA(K6(t));throw l.captureError(B,F.Seedless),B}}};n();a();n();a();var bj="@phantom/seedless",IA={hasSeedlessBundle:["seedless",`${bj}:has_seedless_bundle`],needsBundleUpdate:["seedless",`${bj}:needs_bundle_update`],timeLeftCooldown:["seedless",`${bj}:time_left_cooldown`]};function D7({enabled:A=!0}={}){let j=IA.hasSeedlessBundle,r=R(),t=WA();return xA({enabled:t&&A,queryKey:j,queryFn:e(async()=>await r.hasSeedlessBundle(),"queryFn")})}e(D7,"useHasSeedlessBundle");n();a();n();a();var lA=e(async A=>{await A.invalidateQueries({queryKey:IA.hasSeedlessBundle})},"invalidateHasSeedlessBundle"),EA=e(async A=>{await A.invalidateQueries({queryKey:IA.needsBundleUpdate})},"invalidateNeedsBundleUpdate");function L7(){let A=R(),j=jA(),r=kA();return rA({mutationFn:e(async({entropy:t,pin:B})=>await A.backup(t,B),"mutationFn"),onSuccess:e(async()=>{r.capture("seedlessBackupSuccess"),await lA(j),await EA(j)},"onSuccess"),onError:e(()=>{r.capture("seedlessBackupError")},"onError")})}e(L7,"useBackup");n();a();function _j(){let A=R(),j=jA(),r=kA();return rA({mutationFn:e(async B=>await A.recover(B),"mutationFn"),onSuccess:e(async()=>{r.capture("seedlessRecoverSuccess"),await EA(j)},"onSuccess"),onError:e(()=>{r.capture("seedlessRecoverError")},"onError")})}e(_j,"useRecover");n();a();function N7(){let A=R(),j=kA();return rA({mutationFn:e(async t=>{await A.verifyPin(t)},"mutationFn"),onSuccess:e(()=>{l.addBreadcrumb(F.Seedless,"Successfully verified PIN",I.Info),j.capture("seedlessVerifyPinSuccess")},"onSuccess"),onError:e(()=>{l.addBreadcrumb(F.Seedless,"Failed to verify PIN",I.Error),j.capture("seedlessVerifyPinError")},"onError")})}e(N7,"useVerifyPin");n();a();function S7(){let A=R(),j=jA();return rA({mutationFn:e(async()=>await A.deleteBundle(),"mutationFn"),onSuccess:e(async()=>{await lA(j),await EA(j)},"onSuccess")})}e(S7,"useDeleteBundle");n();a();n();a();n();a();var Ye=new Error("timeout while waiting for mutex to become available"),ze=new Error("mutex already locked"),R7=new Error("request for lock canceled"),C7=function(A,j,r,t){function B(s){return s instanceof r?s:new r(function(k){k(s)})}return e(B,"adopt"),new(r||(r=Promise))(function(s,k){function E(i){try{$(t.next(i))}catch(q){k(q)}}e(E,"fulfilled");function o(i){try{$(t.throw(i))}catch(q){k(q)}}e(o,"rejected");function $(i){i.done?s(i.value):B(i.value).then(E,o)}e($,"step"),$((t=t.apply(A,j||[])).next())})},yj=class{static{e(this,"Semaphore")}constructor(j,r=R7){this._value=j,this._cancelError=r,this._weightedQueues=[],this._weightedWaiters=[]}acquire(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);return new Promise((r,t)=>{this._weightedQueues[j-1]||(this._weightedQueues[j-1]=[]),this._weightedQueues[j-1].push({resolve:r,reject:t}),this._dispatch()})}runExclusive(j,r=1){return C7(this,void 0,void 0,function*(){let[t,B]=yield this.acquire(r);try{return yield j(t)}finally{B()}})}waitForUnlock(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);return new Promise(r=>{this._weightedWaiters[j-1]||(this._weightedWaiters[j-1]=[]),this._weightedWaiters[j-1].push(r),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(j){this._value=j,this._dispatch()}release(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);this._value+=j,this._dispatch()}cancel(){this._weightedQueues.forEach(j=>j.forEach(r=>r.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var j;for(let r=this._value;r>0;r--){let t=(j=this._weightedQueues[r-1])===null||j===void 0?void 0:j.shift();if(!t)continue;let B=this._value,s=r;this._value-=r,r=this._value+1,t.resolve([B,this._newReleaser(s)])}this._drainUnlockWaiters()}_newReleaser(j){let r=!1;return()=>{r||(r=!0,this.release(j))}}_drainUnlockWaiters(){for(let j=this._value;j>0;j--)this._weightedWaiters[j-1]&&(this._weightedWaiters[j-1].forEach(r=>r()),this._weightedWaiters[j-1]=[])}},X7=function(A,j,r,t){function B(s){return s instanceof r?s:new r(function(k){k(s)})}return e(B,"adopt"),new(r||(r=Promise))(function(s,k){function E(i){try{$(t.next(i))}catch(q){k(q)}}e(E,"fulfilled");function o(i){try{$(t.throw(i))}catch(q){k(q)}}e(o,"rejected");function $(i){i.done?s(i.value):B(i.value).then(E,o)}e($,"step"),$((t=t.apply(A,j||[])).next())})},SA=class{static{e(this,"Mutex")}constructor(j){this._semaphore=new yj(1,j)}acquire(){return X7(this,void 0,void 0,function*(){let[,j]=yield this._semaphore.acquire();return j})}runExclusive(j){return this._semaphore.runExclusive(()=>j())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};n();a();async function b6(A,j,r){let t=await A.decryptionKeySharePhantom.foldAsync(async $=>Buffer.from(new Uint8Array($)).toString("base64")),B=Buffer.from(A.encryptedAccounts,"hex").toString("base64"),s=Buffer.from(A.encryptionKey,"hex").toString("base64"),k={ciphertext:B,encryptionKey:s,share:t,externalId:j,mode:"JUICEBOX"},E=await Z.api().bearer(r).headers({"Content-Type":"application/json"}).post(`${sA}/v1/bundles`,k),o=AA(E);return o||l.addBreadcrumb(F.Seedless,"Failed to backup bundle to backend",I.Error,{status:E.status,statusText:E.statusText}),o}e(b6,"sendSeedlessBundleToBackend");async function yA(A,j){let r=await Z.api().bearer(j).get(`${sA}/v1/bundles/${A}?mode=JUICEBOX`);if(r.status===404)throw new Error("bundle not found");if(!AA(r)){l.addBreadcrumb(F.Seedless,"Failed to recover bundle from backend",I.Error,{status:r.status,statusText:r.statusText});let t=new Error("Got invalid response from seedless backend: "+r.statusText);throw l.captureError(t,F.Seedless),t}if(!("share"in r.data)){l.addBreadcrumb(F.Seedless,"No share found in bundle",I.Error);let t=new Error("Did not receive share from seedless backend");throw l.captureError(t,F.Seedless),t}try{let t=W.from(new Uint8Array(Buffer.from(r.data.share,"base64"))),B=Buffer.from(r.data.ciphertext,"base64").toString("hex"),s=Buffer.from(r.data.encryptionKey,"base64").toString("hex");return{id:r.data.externalId,encryptedAccounts:B,encryptionKey:s,decryptionKeyShare1:t}}catch{throw new Error("Unable to parse bundle. Incorrect format.")}}e(yA,"recoverSeedlessBundle");async function _6(A){let j=await Z.api().bearer(A).get(`${sA}/v1/bundles?mode=JUICEBOX`);if(!AA(j))throw l.addBreadcrumb(F.Seedless,"Failed to recover all seedless bundles",I.Error,{status:j.status,statusText:j.statusText}),new Error("Failed to recover all seedless bundles.");try{if(!Array.isArray(j.data))throw new Error("Seedless bundles are not an array.");return j.data.map(r=>{if(typeof r!="object"||r===null||!("externalId"in r))throw new Error("No externalId found in bundle.");let t=r.externalId;if(typeof t!="string")throw new Error("External ID is not a string.");return{id:t}})}catch{throw new Error("Unable to parse seedless bundles. Incorrect format.")}}e(_6,"fetchAllSeedlessBundleIDs");async function Bj(A,j){let r=await Z.api().bearer(j).get(`${sA}/v1/bundles/${A}?mode=JUICEBOX&populate=none`);if(l.addBreadcrumb(F.Seedless,"Checking if user has a se*dless bundle",I.Info),AA(r))return l.addBreadcrumb(F.Seedless,"A se*dless bundle has been found for this user",I.Info,{status:r.status,statusText:r.statusText}),!0;if(r.status===404)return l.addBreadcrumb(F.Seedless,"No se*dless bundle found for user",I.Info,{status:r.status,statusText:r.statusText}),!1;let t=new Error("Failed to check for se*dless bundle.");throw l.captureError(t,F.Seedless),t}e(Bj,"hasSeedlessBundle");async function kj(A,j){let r=await Z.api().bearer(j).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${sA}/v1/bundles/${A}`,{mode:"JUICEBOX"});if(l.addBreadcrumb(F.Seedless,`Deleting se*dless bundle: ${A}`,I.Info),AA(r))return l.addBreadcrumb(F.Seedless,"A se*dless bundle has been deleted for this user",I.Info,{status:r.status,statusText:r.statusText}),!0;if(r.status===404)return l.addBreadcrumb(F.Seedless,"No se*dless bundle found for user",I.Info,{status:r.status,statusText:r.statusText}),!1;let t=new Error("Failed to delete se*dless bundle.");throw l.captureError(t,F.Seedless),t}e(kj,"deleteSeedlessBundle");async function y6(A){let j=await Z.api().bearer(A).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${sA}/v1/bundles`,{mode:"JUICEBOX"});if(l.addBreadcrumb(F.Seedless,"Deleting se*dless bundle",I.Info),AA(j))return l.addBreadcrumb(F.Seedless,"All se*dless bundles, if they exist, have been deleted for this user",I.Info,{status:j.status,statusText:j.statusText,data:j.data}),!0;let r=new Error("Failed to delete all se*dless bundles.");throw l.captureError(r,F.Seedless),r}e(y6,"deleteAllSeedlessBundles");async function wj(A,j){let r=await Z.api().bearer(A).get(`${sA}/v1/device-encryption-keys/${j}`);if(r.status===404)return l.addBreadcrumb(F.Seedless,"No device encryption key found for user",I.Info),null;if(!AA(r))throw new Error("Unable to get device encryption key.");try{let{encryptionKey:t}=f6.parse(r.data);return W.from(new Uint8Array(Buffer.from(t,"base64")))}catch{throw new Error("Unable to parse device encryption key from response.")}}e(wj,"getDeviceEncryptionKey");async function w6(A,j,r){let t=await Z.api().bearer(A).post(`${sA}/v1/device-encryption-keys`,{deviceId:j,encryptionKey:r.fold(B=>Buffer.from(B).toString("base64"))});if(!AA(t))throw new Error("Unable to set device encryption key.")}e(w6,"setDeviceEncryptionKey");async function P6(A,j){let r=await Z.api().bearer(A).delete(`${sA}/v1/device-encryption-keys/${j}`);if(!AA(r))throw new Error("Unable to delete device encryption key.")}e(P6,"deleteDeviceEncryptionKey");n();a();n();a();n();a();n();a();var Y=e((A,j)=>A[j++]&255|(A[j++]&255)<<8,"u8to16"),Pj=class{static{e(this,"Poly1305")}constructor(j){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,j=ZA(j),J(j,32);let r=Y(j,0),t=Y(j,2),B=Y(j,4),s=Y(j,6),k=Y(j,8),E=Y(j,10),o=Y(j,12),$=Y(j,14);this.r[0]=r&8191,this.r[1]=(r>>>13|t<<3)&8191,this.r[2]=(t>>>10|B<<6)&7939,this.r[3]=(B>>>7|s<<9)&8191,this.r[4]=(s>>>4|k<<12)&255,this.r[5]=k>>>1&8190,this.r[6]=(k>>>14|E<<2)&8191,this.r[7]=(E>>>11|o<<5)&8065,this.r[8]=(o>>>8|$<<8)&8191,this.r[9]=$>>>5&127;for(let i=0;i<8;i++)this.pad[i]=Y(j,16+2*i)}process(j,r,t=!1){let B=t?0:2048,{h:s,r:k}=this,E=k[0],o=k[1],$=k[2],i=k[3],q=k[4],f=k[5],g=k[6],O=k[7],G=k[8],p=k[9],x=Y(j,r+0),b=Y(j,r+2),w=Y(j,r+4),N=Y(j,r+6),z=Y(j,r+8),V=Y(j,r+10),L=Y(j,r+12),C=Y(j,r+14),P=s[0]+(x&8191),_=s[1]+((x>>>13|b<<3)&8191),u=s[2]+((b>>>10|w<<6)&8191),m=s[3]+((w>>>7|N<<9)&8191),h=s[4]+((N>>>4|z<<12)&8191),M=s[5]+(z>>>1&8191),K=s[6]+((z>>>14|V<<2)&8191),H=s[7]+((V>>>11|L<<5)&8191),y=s[8]+((L>>>8|C<<8)&8191),T=s[9]+(C>>>5|B),d=0,X=d+P*E+_*(5*p)+u*(5*G)+m*(5*O)+h*(5*g);d=X>>>13,X&=8191,X+=M*(5*f)+K*(5*q)+H*(5*i)+y*(5*$)+T*(5*o),d+=X>>>13,X&=8191;let U=d+P*o+_*E+u*(5*p)+m*(5*G)+h*(5*O);d=U>>>13,U&=8191,U+=M*(5*g)+K*(5*f)+H*(5*q)+y*(5*i)+T*(5*$),d+=U>>>13,U&=8191;let S=d+P*$+_*o+u*E+m*(5*p)+h*(5*G);d=S>>>13,S&=8191,S+=M*(5*O)+K*(5*g)+H*(5*f)+y*(5*q)+T*(5*i),d+=S>>>13,S&=8191;let aA=d+P*i+_*$+u*o+m*E+h*(5*p);d=aA>>>13,aA&=8191,aA+=M*(5*G)+K*(5*O)+H*(5*g)+y*(5*f)+T*(5*q),d+=aA>>>13,aA&=8191;let vA=d+P*q+_*i+u*$+m*o+h*E;d=vA>>>13,vA&=8191,vA+=M*(5*p)+K*(5*G)+H*(5*O)+y*(5*g)+T*(5*f),d+=vA>>>13,vA&=8191;let OA=d+P*f+_*q+u*i+m*$+h*o;d=OA>>>13,OA&=8191,OA+=M*E+K*(5*p)+H*(5*G)+y*(5*O)+T*(5*g),d+=OA>>>13,OA&=8191;let fA=d+P*g+_*f+u*q+m*i+h*$;d=fA>>>13,fA&=8191,fA+=M*o+K*E+H*(5*p)+y*(5*G)+T*(5*O),d+=fA>>>13,fA&=8191;let mA=d+P*O+_*g+u*f+m*q+h*i;d=mA>>>13,mA&=8191,mA+=M*$+K*o+H*E+y*(5*p)+T*(5*G),d+=mA>>>13,mA&=8191;let hA=d+P*G+_*O+u*g+m*f+h*q;d=hA>>>13,hA&=8191,hA+=M*i+K*$+H*o+y*E+T*(5*p),d+=hA>>>13,hA&=8191;let MA=d+P*p+_*G+u*O+m*g+h*f;d=MA>>>13,MA&=8191,MA+=M*q+K*i+H*$+y*o+T*E,d+=MA>>>13,MA&=8191,d=(d<<2)+d|0,d=d+X|0,X=d&8191,d=d>>>13,U+=d,s[0]=X,s[1]=U,s[2]=S,s[3]=aA,s[4]=vA,s[5]=OA,s[6]=fA,s[7]=mA,s[8]=hA,s[9]=MA}finalize(){let{h:j,pad:r}=this,t=new Uint16Array(10),B=j[1]>>>13;j[1]&=8191;for(let E=2;E<10;E++)j[E]+=B,B=j[E]>>>13,j[E]&=8191;j[0]+=B*5,B=j[0]>>>13,j[0]&=8191,j[1]+=B,B=j[1]>>>13,j[1]&=8191,j[2]+=B,t[0]=j[0]+5,B=t[0]>>>13,t[0]&=8191;for(let E=1;E<10;E++)t[E]=j[E]+B,B=t[E]>>>13,t[E]&=8191;t[9]-=8192;let s=(B^1)-1;for(let E=0;E<10;E++)t[E]&=s;s=~s;for(let E=0;E<10;E++)j[E]=j[E]&s|t[E];j[0]=(j[0]|j[1]<<13)&65535,j[1]=(j[1]>>>3|j[2]<<10)&65535,j[2]=(j[2]>>>6|j[3]<<7)&65535,j[3]=(j[3]>>>9|j[4]<<4)&65535,j[4]=(j[4]>>>12|j[5]<<1|j[6]<<14)&65535,j[5]=(j[6]>>>2|j[7]<<11)&65535,j[6]=(j[7]>>>5|j[8]<<8)&65535,j[7]=(j[8]>>>8|j[9]<<5)&65535;let k=j[0]+r[0];j[0]=k&65535;for(let E=1;E<8;E++)k=(j[E]+r[E]|0)+(k>>>16)|0,j[E]=k&65535}update(j){Oj(this);let{buffer:r,blockLen:t}=this;j=ZA(j);let B=j.length;for(let s=0;s<B;){let k=Math.min(t-this.pos,B-s);if(k===t){for(;t<=B-s;s+=t)this.process(j,s);continue}r.set(j.subarray(s,s+k),this.pos),this.pos+=k,s+=k,this.pos===t&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(j){Oj(this),F6(j,this),this.finished=!0;let{buffer:r,h:t}=this,{pos:B}=this;if(B){for(r[B++]=1;B<16;B++)r[B]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let k=0;k<8;k++)j[s++]=t[k]>>>0,j[s++]=t[k]>>>8;return j}digest(){let{buffer:j,outputLen:r}=this;this.digestInto(j);let t=j.slice(0,r);return this.destroy(),t}};function U7(A){let j=e((t,B)=>A(B).update(ZA(t)).digest(),"hashC"),r=A(new Uint8Array(32));return j.outputLen=r.outputLen,j.blockLen=r.blockLen,j.create=t=>A(t),j}e(U7,"wrapConstructorWithKey");var H6=U7(A=>new Pj(A));n();a();var D6=e(A=>Uint8Array.from(A.split("").map(j=>j.charCodeAt(0))),"_utf8ToBytes"),V7=D6("expand 16-byte k"),J7=D6("expand 32-byte k"),Y7=oA(V7),L6=oA(J7),GB=L6.slice();function c(A,j){return A<<j|A>>>32-j}e(c,"rotl");function Hj(A){return A.byteOffset%4===0}e(Hj,"isAligned32");var sj=64,z7=16,N6=2**32-1,T6=new Uint32Array;function W7(A,j,r,t,B,s,k,E){let o=B.length,$=new Uint8Array(sj),i=oA($),q=Hj(B)&&Hj(s),f=q?oA(B):T6,g=q?oA(s):T6;for(let O=0;O<o;k++){if(A(j,r,t,i,k,E),k>=N6)throw new Error("arx: counter overflow");let G=Math.min(sj,o-O);if(q&&G===sj){let p=O/4;if(O%4!==0)throw new Error("arx: invalid block position");for(let x=0,b;x<z7;x++)b=p+x,g[b]=f[b]^i[x];O+=sj;continue}for(let p=0,x;p<G;p++)x=O+p,s[x]=B[x]^$[p];O+=G}}e(W7,"runCipher");function Tj(A,j){let{allowShortKeys:r,extendNonceFn:t,counterLength:B,counterRight:s,rounds:k}=G6({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},j);if(typeof A!="function")throw new Error("core must be a function");return KA(B),KA(k),pj(s),pj(r),(E,o,$,i,q=0)=>{J(E),J(o),J($);let f=$.length;if(i||(i=new Uint8Array(f)),J(i),KA(q),q<0||q>=N6)throw new Error("arx: counter overflow");if(i.length<f)throw new Error(`arx: output (${i.length}) is shorter than data (${f})`);let g=[],O=E.length,G,p;if(O===32)G=E.slice(),g.push(G),p=L6;else if(O===16&&r)G=new Uint8Array(32),G.set(E),G.set(E,16),p=Y7,g.push(G);else throw new Error(`arx: invalid 32-byte key, got length=${O}`);Hj(o)||(o=o.slice(),g.push(o));let x=oA(G);if(t){if(o.length!==24)throw new Error("arx: extended nonce must be 24 bytes");t(p,x,oA(o.subarray(0,16)),x),o=o.subarray(16)}let b=16-B;if(b!==o.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){let N=new Uint8Array(12);N.set(o,s?0:12-o.length),o=N,g.push(o)}let w=oA(o);for(W7(A,p,x,w,$,i,q,k);g.length>0;)g.pop().fill(0);return i}}e(Tj,"createCipher");function C6(A,j,r,t,B,s=20){let k=A[0],E=A[1],o=A[2],$=A[3],i=j[0],q=j[1],f=j[2],g=j[3],O=j[4],G=j[5],p=j[6],x=j[7],b=B,w=r[0],N=r[1],z=r[2],V=k,L=E,C=o,P=$,_=i,u=q,m=f,h=g,M=O,K=G,H=p,y=x,T=b,d=w,X=N,U=z;for(let aA=0;aA<s;aA+=2)V=V+_|0,T=c(T^V,16),M=M+T|0,_=c(_^M,12),V=V+_|0,T=c(T^V,8),M=M+T|0,_=c(_^M,7),L=L+u|0,d=c(d^L,16),K=K+d|0,u=c(u^K,12),L=L+u|0,d=c(d^L,8),K=K+d|0,u=c(u^K,7),C=C+m|0,X=c(X^C,16),H=H+X|0,m=c(m^H,12),C=C+m|0,X=c(X^C,8),H=H+X|0,m=c(m^H,7),P=P+h|0,U=c(U^P,16),y=y+U|0,h=c(h^y,12),P=P+h|0,U=c(U^P,8),y=y+U|0,h=c(h^y,7),V=V+u|0,U=c(U^V,16),H=H+U|0,u=c(u^H,12),V=V+u|0,U=c(U^V,8),H=H+U|0,u=c(u^H,7),L=L+m|0,T=c(T^L,16),y=y+T|0,m=c(m^y,12),L=L+m|0,T=c(T^L,8),y=y+T|0,m=c(m^y,7),C=C+h|0,d=c(d^C,16),M=M+d|0,h=c(h^M,12),C=C+h|0,d=c(d^C,8),M=M+d|0,h=c(h^M,7),P=P+_|0,X=c(X^P,16),K=K+X|0,_=c(_^K,12),P=P+_|0,X=c(X^P,8),K=K+X|0,_=c(_^K,7);let S=0;t[S++]=k+V|0,t[S++]=E+L|0,t[S++]=o+C|0,t[S++]=$+P|0,t[S++]=i+_|0,t[S++]=q+u|0,t[S++]=f+m|0,t[S++]=g+h|0,t[S++]=O+M|0,t[S++]=G+K|0,t[S++]=p+H|0,t[S++]=x+y|0,t[S++]=b+T|0,t[S++]=w+d|0,t[S++]=N+X|0,t[S++]=z+U|0}e(C6,"chachaCore");function Q7(A,j,r,t){let B=A[0],s=A[1],k=A[2],E=A[3],o=j[0],$=j[1],i=j[2],q=j[3],f=j[4],g=j[5],O=j[6],G=j[7],p=r[0],x=r[1],b=r[2],w=r[3];for(let z=0;z<20;z+=2)B=B+o|0,p=c(p^B,16),f=f+p|0,o=c(o^f,12),B=B+o|0,p=c(p^B,8),f=f+p|0,o=c(o^f,7),s=s+$|0,x=c(x^s,16),g=g+x|0,$=c($^g,12),s=s+$|0,x=c(x^s,8),g=g+x|0,$=c($^g,7),k=k+i|0,b=c(b^k,16),O=O+b|0,i=c(i^O,12),k=k+i|0,b=c(b^k,8),O=O+b|0,i=c(i^O,7),E=E+q|0,w=c(w^E,16),G=G+w|0,q=c(q^G,12),E=E+q|0,w=c(w^E,8),G=G+w|0,q=c(q^G,7),B=B+$|0,w=c(w^B,16),O=O+w|0,$=c($^O,12),B=B+$|0,w=c(w^B,8),O=O+w|0,$=c($^O,7),s=s+i|0,p=c(p^s,16),G=G+p|0,i=c(i^G,12),s=s+i|0,p=c(p^s,8),G=G+p|0,i=c(i^G,7),k=k+q|0,x=c(x^k,16),f=f+x|0,q=c(q^f,12),k=k+q|0,x=c(x^k,8),f=f+x|0,q=c(q^f,7),E=E+o|0,b=c(b^E,16),g=g+b|0,o=c(o^g,12),E=E+o|0,b=c(b^E,8),g=g+b|0,o=c(o^g,7);let N=0;t[N++]=B,t[N++]=s,t[N++]=k,t[N++]=E,t[N++]=p,t[N++]=x,t[N++]=b,t[N++]=w}e(Q7,"hchacha");var Z7=Tj(C6,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ar=Tj(C6,{counterRight:!1,counterLength:8,extendNonceFn:Q7,allowShortKeys:!1});var jr=new Uint8Array(16),S6=e((A,j)=>{A.update(j);let r=j.length%16;r&&A.update(jr.subarray(r))},"updatePadded"),rr=new Uint8Array(32);function R6(A,j,r,t,B){let s=A(j,r,rr),k=H6.create(s);B&&S6(k,B),S6(k,t);let E=new Uint8Array(16),o=l6(E);hj(o,0,BigInt(B?B.length:0),!0),hj(o,8,BigInt(t.length),!0),k.update(E);let $=k.digest();return s.fill(0),$}e(R6,"computeTag");var X6=e(A=>(j,r,t)=>(J(j,32),J(r),{encrypt:e((s,k)=>{let E=s.length,o=E+16;k?J(k,o):k=new Uint8Array(o),A(j,r,s,k,1);let $=R6(A,j,r,k.subarray(0,-16),t);return k.set($,E),k},"encrypt"),decrypt:e((s,k)=>{let E=s.length,o=E-16;if(E<16)throw new Error("encrypted data must be at least 16 bytes");k?J(k,o):k=new Uint8Array(o);let $=s.subarray(0,-16),i=s.subarray(-16),q=R6(A,j,r,$,t);if(!d6(i,q))throw new Error("invalid tag");return A(j,r,$,k,1),k},"decrypt")}),"_poly1305_aead"),hB=mj({blockSize:64,nonceLength:12,tagLength:16},X6(Z7)),Dj=mj({blockSize:64,nonceLength:24,tagLength:16},X6(Ar));n();a();n();a();var uA=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function U6(A=32){if(uA&&typeof uA.getRandomValues=="function")return uA.getRandomValues(new Uint8Array(A));throw new Error("crypto.getRandomValues must be defined")}e(U6,"randomBytes");function Lj(){if(uA&&typeof uA.subtle=="object"&&uA.subtle!=null)return uA.subtle;throw new Error("crypto.subtle must be defined")}e(Lj,"getWebcryptoSubtle");function Nj(A){return KA(A.nonceLength),(j,...r)=>({encrypt:e((t,...B)=>{let{nonceLength:s}=A,k=U6(s),E=A(j,k,...r).encrypt(t,...B),o=c6(k,E);return E.fill(0),o},"encrypt"),decrypt:e((t,...B)=>{let{nonceLength:s}=A,k=t.subarray(0,s),E=t.subarray(s);return A(j,k,...r).decrypt(E,...B)},"decrypt")})}e(Nj,"managedNonce");var V6={async encrypt(A,j,r,t){let B=Lj(),s=await B.importKey("raw",A,j,!0,["encrypt"]),k=await B.encrypt(r,s,t);return new Uint8Array(k)},async decrypt(A,j,r,t){let B=Lj(),s=await B.importKey("raw",A,j,!0,["decrypt"]),k=await B.decrypt(r,s,t);return new Uint8Array(k)}},nA={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function tr(A,j,r){if(A===nA.CBC)return{name:nA.CBC,iv:j};if(A===nA.CTR)return{name:nA.CTR,counter:j,length:64};if(A===nA.GCM)return r?{name:nA.GCM,iv:j,additionalData:r}:{name:nA.GCM,iv:j};throw new Error("unknown aes block mode")}e(tr,"getCryptParams");function Sj(A){return(j,r,t)=>{J(j),J(r);let B={name:A,length:j.length*8},s=tr(A,r,t);return{encrypt(k){return J(k),V6.encrypt(j,B,s,k)},decrypt(k){return J(k),V6.decrypt(j,B,s,k)}}}}e(Sj,"generate");var DB=Sj(nA.CBC),LB=Sj(nA.CTR),NB=Sj(nA.GCM);n();a();n();a();function Rj(A){return self.crypto.getRandomValues(new Uint8Array(A))}e(Rj,"getRandomBytes");var nj=new Uint8Array([0,255,200,8,145,16,208,54,90,62,216,67,153,119,254,24,35,32,7,112,161,108,12,127,98,139,64,70,199,75,224,14,235,22,232,173,207,205,57,83,106,39,53,147,212,78,72,195,43,121,84,40,9,120,15,33,144,135,20,42,169,156,214,116,180,124,222,237,177,134,118,164,152,226,150,143,2,50,28,193,51,238,239,129,253,48,92,19,157,41,23,196,17,68,140,128,243,115,66,30,29,181,240,18,209,91,65,162,215,44,233,213,89,203,80,168,220,252,242,86,114,166,101,47,159,155,61,186,125,194,69,130,167,87,182,163,122,117,79,174,63,55,109,71,97,190,171,211,95,176,88,175,202,94,250,133,228,77,138,5,251,96,183,123,184,38,74,103,198,26,248,105,37,179,219,189,102,221,241,210,223,3,141,52,217,146,13,99,85,170,73,236,188,149,60,132,11,245,230,231,229,172,126,110,185,249,218,142,154,201,36,225,10,21,107,58,160,81,244,234,178,151,158,93,34,136,148,206,25,1,113,76,165,227,197,49,187,204,31,45,59,82,111,246,46,137,247,192,104,27,100,4,6,191,131,56]),J6=new Uint8Array([1,229,76,181,251,159,252,18,3,52,212,196,22,186,31,54,5,92,103,87,58,213,33,90,15,228,169,249,78,100,99,238,17,55,224,16,210,172,165,41,51,89,59,48,109,239,244,123,85,235,77,80,183,42,7,141,255,38,215,240,194,126,9,140,26,106,98,11,93,130,27,143,46,190,166,29,231,157,45,138,114,217,241,39,50,188,119,133,150,112,8,105,86,223,153,148,161,144,24,187,250,122,176,167,248,171,40,214,21,142,203,242,19,230,120,97,63,137,70,13,53,49,136,163,65,128,202,23,95,83,131,254,195,155,69,57,225,245,158,25,94,182,207,75,56,4,185,43,226,193,74,221,72,12,208,125,61,88,222,124,216,20,107,135,71,232,121,132,115,60,189,146,201,35,139,151,149,68,220,173,64,101,134,162,164,204,127,236,192,175,145,253,247,79,129,47,91,234,168,28,2,209,152,113,237,37,227,36,6,104,179,147,44,111,62,108,10,184,206,174,116,177,66,180,30,211,73,233,156,200,198,199,34,110,219,32,191,67,81,82,102,178,118,96,218,197,243,246,170,205,154,160,117,84,14,1]);function Ej(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");return A^j}e(Ej,"add");function er(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");if(j===0)throw new Error("cannot divide by zero");let r=nj[A],t=nj[j],B=(r-t+255)%255,s=J6[B];return A===0?0:s}e(er,"div");function Cj(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");let r=nj[A],t=nj[j],B=(r+t)%255,s=J6[B];return A===0||j===0?0:s}e(Cj,"mult");function Br(A,j,r){if(A.length!==j.length)throw new Error("sample length mistmatch");let t=A.length,B=0,s=0;for(let k=0;k<t;k++){B=1;for(let E=0;E<t;++E){if(k===E)continue;let o=Ej(r,A[E]),$=Ej(A[k],A[E]),i=er(o,$);B=Cj(B,i)}s=Ej(s,Cj(j[k],B))}return s}e(Br,"interpolatePolynomial");function kr(A,j,r){if(j===0)throw new Error("cannot evaluate secret polynomial at zero");let t=A[r];for(let B=r-1;B>=0;B--){let s=A[B];t=Ej(Cj(t,j),s)}return t}e(kr,"evaluate");function Y6(){return Rj(1)[0]}e(Y6,"getRandomByte");function sr(){for(;;){let A=Y6();if(A>0)return A}}e(sr,"getNonZeroRandomByte");function Er(A,j){let r=new Uint8Array(j+1);r[0]=A;for(let t=1;t<=j;t++){let B=t===j;r[t]=B?sr():Y6()}return r}e(Er,"newCoefficients");function nr(){let A=new Uint8Array(255);for(let r=0;r<255;r++)A[r]=r+1;let j=Rj(255);for(let r=0;r<255;r++){let t=j[r]%255,B=A[r];A[r]=A[t],A[t]=B}return A}e(nr,"newCoordinates");var Q={instanceOf(A,j,r){if(A.constructor!==j)throw new TypeError(r)},inRange(A,j,r,t){if(!(j<r&&A>=j&&A<r))throw new RangeError(t)},greaterThanOrEqualTo(A,j,r){if(A<j)throw new Error(r)},equalTo(A,j,r){if(A!==j)throw new Error(r)}};async function z6(A,j,r){Q.instanceOf(A,Uint8Array,"secret must be a Uint8Array"),Q.greaterThanOrEqualTo(A.byteLength,1,"secret cannot be empty"),Q.instanceOf(j,Number,"shares must be a number"),Q.inRange(j,2,256,"shares must be at least 2 and at most 255"),Q.instanceOf(r,Number,"threshold must be a number"),Q.inRange(r,2,256,"threshold must be at least 2 and at most 255"),Q.greaterThanOrEqualTo(j,r,"shares cannot be less than threshold");let t=[],B=A.byteLength,s=nr();for(let E=0;E<j;E++){let o=new Uint8Array(B+1);o[B]=s[E],t.push(o)}let k=r-1;for(let E=0;E<B;E++){let o=A[E],$=Er(o,k);for(let i=0;i<j;++i){let q=s[i],f=kr($,q,k);t[i][E]=f}}return t}e(z6,"split");async function W6(A){Q.instanceOf(A,Array,"shares must be an Array"),Q.inRange(A.length,2,256,"shares must have at least 2 and at most 255 elements");let j=A[0];Q.instanceOf(j,Uint8Array,"each share must be a Uint8Array");for(let $ of A)Q.instanceOf($,Uint8Array,"each share must be a Uint8Array"),Q.greaterThanOrEqualTo($.byteLength,2,"each share must be at least 2 bytes"),Q.equalTo($.byteLength,j.byteLength,"all shares must have the same byte length");let r=A.length,t=j.byteLength,B=t-1,s=new Uint8Array(B),k=new Uint8Array(r),E=new Uint8Array(r),o=new Set;for(let $=0;$<r;$++){let q=A[$][t-1];if(o.has(q))throw new Error("shares must contain unique values but a duplicate was found");o.add(q),k[$]=q}for(let $=0;$<B;$++){for(let i=0;i<r;++i)E[i]=A[i][$];s[$]=Br(k,E,0)}return s}e(W6,"combine");var Q6=e(async(A,j)=>{if(A.length!==32)throw new Error("encryption key must be 32 bytes");or(A);let r={seeds:[]};for(let $ of j){let i="unused",q=$.fold(f=>new Uint8Array(f));r.seeds.push([i,q])}let t=Nj(Dj)(A),B=fj(JSON.stringify(r)),s=t.encrypt(B),[k,E]=await z6(A,2,2);return{encryptedAccounts:UA(s),decryptionKeySharePhantom:W.from(k),decryptionKeyShareExternal:W.from(E),encryptionKey:"unused"}},"encryptAccounts"),qA=class extends Error{static{e(this,"SeedlessDecryptionError")}reason;constructor(j,r){super(`Unable to decrypt seedless bundle: ${j}`),this.reason=j,r!==void 0&&(this.cause=r)}},aj=e(async A=>{let j;try{j=await ar(A.decryptionKeySharePhantom,A.decryptionKeyShareExternal)}catch(k){throw new qA("incompatible-shares",k)}let r;try{r=Nj(Dj)(j).decrypt(VA(A.encryptedAccounts))}catch(k){throw new qA("incorrect-decryption-key",k)}let t;try{t=JSON.parse(Buffer.from(r).toString())}catch(k){throw new qA("invalid-json",k)}let B=v6.safeParse(t);if(!B.success)throw new qA("invalid-format");return B.data.seeds.map(k=>{let E=k[1],o=O6(E);return W.from(o)})},"decryptAccounts"),ar=e(async(A,j)=>{let r=A.fold(B=>new Uint8Array(B)),t=j.fold(B=>new Uint8Array(B));return await W6([r,t])},"getDecryptionKeyFromShares"),or=e(A=>{if(A.every(j=>j===0))throw new Error("encryption key must not be all zeros")},"validateNotZero");n();a();var Z6={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var A7={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var j7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var r7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev/"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var t7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f76005fd-80e5-483e-9d84-c09ef7c60ba3",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var e7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"153ebe7b-400c-4d27-be76-139248bb3acd",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var B7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f577175c-3f1e-4f4a-91d1-cb30aaa0d5d4",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var oj=[Z6,A7],k7=oj.reduce((A,j)=>(A[FA(j)]=j,A),{}),s7=[j7,r7,t7,e7,B7],dr=s7.reduce((A,j)=>(A[FA(j)]=j,A),{});function $j(){return Gj()||dj()===cj.Production?k7:dr}e($j,"getSupportedConfigs");function pA(){if(Gj())return oj[oj.length-1];let A=dj()===cj.Production?oj:s7;return A[A.length-1]}e(pA,"getLatestConfig");var BA={success:{type:"success",didBackup:!0},unauthorized:{type:"unauthorized",didBackup:!1},bundleAlreadyExists:{type:"bundle-already-exists",didBackup:!1},errorBackendCheck:{type:"error-backend-check",didBackup:!1},invalidPin:{type:"invalid-pin-format",didBackup:!1},errorEncryptionFailed:{type:"error-encryption-failed",didBackup:!1},errorBackendUpload:{type:"error-backend-upload",didBackup:!1},errorJuiceboxUpload:{type:"error-juicebox-upload",didBackup:!1},recoveredFromJuiceboxError:{type:"recovered-juicebox-error",didBackup:!1},errorBackendDelete:{type:"error-backend-delete",didBackup:!1}},RA=e(async(A,{pin:j,entropy:r})=>{if(!$A(j))return BA.invalidPin;let t;try{if(t=await A.authRepository.getUser(),!t)return BA.unauthorized}catch{return BA.unauthorized}let B=pA(),s=FA(B);try{if(await Bj(s,t.accessToken))return BA.bundleAlreadyExists}catch{return BA.errorBackendCheck}let k;try{let i=JA(32);k=await Q6(i,[r])}catch{return BA.errorEncryptionFailed}try{if(!await b6(k,s,t.accessToken))return BA.errorBackendUpload}catch{return BA.errorBackendUpload}let E=k.decryptionKeyShareExternal.fold(i=>new Uint8Array(i)),o=await A.juiceboxClient(),$=!0;try{$=await o.sendJuiceboxShare(pA(),E,j,t.accessToken)}catch{$=!1}if(!$)try{return await kj(s,t.accessToken),BA.recoveredFromJuiceboxError}catch{return BA.errorBackendDelete}return BA.success},"backupBundle");n();a();var E7="seedlessJuiceboxPinCooldownTimer",Xj=".phantom.seedless.juiceboxPinCooldownTimer",CA=e(async A=>{let j=await A.get(E7),r=await A.get(Xj),t=r?.timeRemaining||j,B=r?.guessesRemaining;return!t||t<0?{timeRemaining:0,guessesRemaining:B}:{timeRemaining:t-Date.now(),guessesRemaining:B}},"cooldownTimeLeft"),n7=e(async(A,j)=>{let r=ur(A);if(!r)return;let t=Date.now()+r*1e3;j.set(Xj,{version:2,timeRemaining:t,guessesRemaining:A})},"updateCooldownTimer"),a7=e(async A=>{await A.remove(E7),await A.remove(Xj)},"resetCooldownTimer"),ur=e(A=>pr[A],"getCooldownTimeInSeconds"),pr={[7]:0,[6]:0,[5]:30,[4]:60,[3]:120,[2]:300,[1]:300};n();a();n();a();var o7=e(async(A,j,r)=>{let t=[];try{t=await _6(A)}catch{return{status:"error-fetch-all-seedless-bundles"}}let B=t.filter(s=>s.id!==r).map(s=>s.id);if(B.length===0)return{status:"no-other-bundles-found"};for(let s of B)try{let k=await yA(s,A),E=await aj({encryptedAccounts:k.encryptedAccounts,encryptionKey:k.encryptionKey,decryptionKeySharePhantom:k.decryptionKeyShare1,decryptionKeyShareExternal:W.from(j)});if(E.length===0)continue;return{status:"found-valid-bundle",entropies:E}}catch{continue}return{status:"error-no-decryptable-accounts"}},"recoverFirstValidBundle");var Or=e(A=>{if(A===void 0)return{causeType:null,causeName:null,causeCategory:null};if(A instanceof Error){let j=A.message.toLowerCase(),r="other-error";return j.includes("invalid tag")?r="invalid-auth-tag":j.includes("hexToBytes: received invalid unpadded hex".toLowerCase())||j.includes("invalid byte sequence")?r="invalid-ciphertext-hex":j.includes("encrypted data must be at least")?r="ciphertext-too-short":j.includes("shares must contain unique values")?r="duplicate-share-index":j.includes("sample length mistmatch")&&(r="share-length-mismatch"),{causeType:"Error",causeName:A.name,causeCategory:r}}return{causeType:typeof A,causeName:null,causeCategory:"non-error"}},"normalizeCause"),fr=40,mr=e(A=>{try{let r=VA(A).length;return{ciphertextHexValid:!0,ciphertextHexErrorCategory:null,ciphertextBytesLen:r,ciphertextTooShort:r<fr}}catch(j){let r="unknown";if(j instanceof Error){let t=j.message.toLowerCase();t.includes("hextobytes: received invalid unpadded hex")?r="invalid-unpadded-hex":t.includes("invalid byte sequence")&&(r="invalid-byte-sequence")}return{ciphertextHexValid:!1,ciphertextHexErrorCategory:r,ciphertextBytesLen:null,ciphertextTooShort:null}}},"inspectCiphertext"),hr=e(A=>{let j="unknown";return A instanceof Error&&(A.message.includes("bundle not found")?j="bundle-not-found":A.message.includes("Got invalid response from seedless backend")?j="non-ok-response":A.message.includes("Did not receive share from seedless backend")?j="no-share-in-bundle":A.message.includes("Unable to parse bundle. Incorrect format.")&&(j="incorrect-format")),{type:"error-backend-recover",reason:j}},"handleBackendRecoverError"),$7=e(async(A,j,{pin:r,ignoreCooldown:t=!1})=>{l.addBreadcrumb(F.Seedless,"Recover flow started",I.Info,{ignoreCooldown:t,pinLength:r.length});let{authRepository:B,juiceboxClient:s,storage:k}=A,{timeRemaining:E,guessesRemaining:o}=await CA(k);if(E>0&&!t)return l.addBreadcrumb(F.Seedless,"Recover blocked by local cooldown timer",I.Info,{cooldownTime:E,storedGuessesRemaining:o??null}),{type:"cooldown",timeRemaining:E,guessesRemaining:o};if(!$A(r))return{type:"invalid-pin-format"};let $=await B.getUser();if(!$)return{type:"unauthorized"};let{accessToken:i}=$;l.addBreadcrumb(F.Seedless,"Recover bundle fetch started",I.Info,{bundleSelector:"latest"});let q;try{q=await yA("latest",i),l.addBreadcrumb(F.Seedless,"Recover bundle fetch succeeded",I.Info,{bundleId:q.id})}catch(h){let M=hr(h);return l.addBreadcrumb(F.Seedless,"Recover bundle fetch failed",I.Error,{reason:M.reason}),M}let f=$j()[q.id];if(!f)return l.addBreadcrumb(F.Seedless,"Recover blocked by unsupported Juicebox config",I.Error,{bundleId:q.id}),{type:"upgrade-required"};let g=ej(f);l.addBreadcrumb(F.Seedless,"Recover selected Juicebox config",I.Info,{bundleId:q.id,realmCount:f.realms.length,realmHosts:g.join(",")});let O=await s();l.addBreadcrumb(F.Seedless,"Juicebox recover share started",I.Info,{bundleId:q.id,realmCount:f.realms.length,realmHosts:g.join(",")});let G;try{G=new Uint8Array(await O.getJuiceboxShare(f,r,i)),await a7(k),l.addBreadcrumb(F.Seedless,"Juicebox recover share succeeded",I.Info,{bundleId:q.id,shareByteLength:G.length})}catch(h){if(rj(h)){let M=h.reasonCode,K=h.guessesRemaining;if(!t&&K&&K<=5){await n7(K,k);let{timeRemaining:y}=await CA(k);return l.addBreadcrumb(F.Seedless,"Juicebox recover share blocked by cooldown",I.Info,{reason:M,guessesRemaining:K??null,timeRemaining:y}),{type:"cooldown",timeRemaining:y,guessesRemaining:K}}else return l.addBreadcrumb(F.Seedless,"Juicebox recover share failed",I.Error,{reason:M,guessesRemaining:K??null,isJuiceboxRecoverError:!0}),{type:"error-juicebox-recover",reason:M,guessesRemaining:K}}else return l.addBreadcrumb(F.Seedless,"Juicebox recover share failed",I.Error,{reason:"unknown",isJuiceboxRecoverError:!1}),{type:"error-juicebox-recover",reason:"unknown"}}if(G.every(h=>h===0))return l.addBreadcrumb(F.Seedless,"Juicebox recover returned all-zero share",I.Error,{shareByteLength:G.length}),{type:"error-juicebox-share-zero"};let x=q.encryptedAccounts.length,b=x%2===0,w=Math.floor(x/2),N=q.decryptionKeyShare1.fold(h=>h.length),z=G.length,{ciphertextHexValid:V,ciphertextHexErrorCategory:L,ciphertextBytesLen:C,ciphertextTooShort:P}=mr(q.encryptedAccounts);l.addBreadcrumb(F.Seedless,"Bundle decrypt preflight",I.Info,{bundleId:q.id,encryptedAccountsHexLen:x,encryptedAccountsHexEvenLength:b,encryptedAccountsBytesLenEstimate:w,ciphertextHexValid:V,ciphertextHexErrorCategory:L,ciphertextBytesLen:C,ciphertextTooShort:P,decryptionKeySharePhantomLen:N,decryptionKeyShareExternalLen:z});let _,u=!1;l.addBreadcrumb(F.Seedless,"Bundle decrypt started",I.Info,{bundleId:q.id});try{_=await aj({encryptedAccounts:q.encryptedAccounts,encryptionKey:q.encryptionKey,decryptionKeySharePhantom:q.decryptionKeyShare1,decryptionKeyShareExternal:W.from(G)})}catch(h){let M;h instanceof qA?M=h.reason:M="unknown";let K=h instanceof qA?h.cause:h instanceof Error?h:void 0,{causeType:H,causeName:y,causeCategory:T}=Or(K);l.addBreadcrumb(F.Seedless,"Failed to decrypt bundle",I.Error,{reason:M,bundleId:q.id,causeType:H,causeName:y,causeCategory:T}),l.captureError(new Error(`Bundle decrypt failed: ${M}`),F.Seedless);let d=await o7(i,G,q.id);if(d.status==="found-valid-bundle")u=!0,l.addBreadcrumb(F.Seedless,"Recovered from older bundle",I.Info),_=d.entropies;else return l.addBreadcrumb(F.Seedless,"Failed to recover from older bundle",I.Error,{status:d.status,originalReason:M}),d.status==="no-other-bundles-found"?{type:"error-decrypt-accounts",reason:M}:{type:"error-decrypt-accounts",reason:d.status}}if(_.length===0)return{type:"error-no-entropies"};let m=await RA(A,{entropy:_[0],pin:r});return l.addBreadcrumb(F.Seedless,"Recover rotation finished",I.Info,{bundleId:q.id,resultType:m.type,didBackup:m.didBackup}),j.emitRotationResult(m),l.addBreadcrumb(F.Seedless,"Recover flow succeeded",I.Info,{bundleId:q.id,usedFallbackBundle:u}),{type:"success",entropy:_[0]}},"recoverBundle");n();a();var wA=class extends Error{static{e(this,"SeedlessRecoverError")}result;constructor(j){super(`Unable to recover seedless bundle: ${j.type}`),this.result=j}},ij=class extends Error{static{e(this,"SeedlessBackupError")}result;constructor(j){super(`Unable to backup seedless bundle: ${j.type}`),this.result=j}},PA=e(A=>A instanceof wA,"isSeedlessRecoverError"),Mr=e(A=>PA(A)&&A.result.type==="unauthorized","isSeedlessUnauthorizedError"),Uj=e(A=>PA(A)&&A.result.type==="error-juicebox-recover"&&A.result.reason===eA.InvalidPin,"isSeedlessInvalidPinError"),Vj=e(A=>PA(A)&&A.result.type==="cooldown","isSeedlessCooldownError"),Jj=e(A=>PA(A)&&A.result.type==="upgrade-required","isSeedlessUpgradeRequiredError"),Yj=e(A=>PA(A)&&A.result.type==="error-juicebox-recover"&&A.result.reason===eA.NotRegistered,"isSeedlessJuiceboxNotRegisteredError");n();a();var qj=class extends E6{static{e(this,"SeedlessEventEmitter")}emitRotationResult(j){this.emitEvent(dA.RotationResult,{type:j.type,didRotate:j.didBackup})}emitRecoverResult(j){let r=j.type,t;"reason"in j&&(typeof j.reason=="string"?t=j.reason:t=eA[j.reason]),this.emitEvent(dA.RecoverResult,{type:r,reason:t})}emitBackupResult(j){this.emitEvent(dA.BackupResult,{type:j.type,didBackup:j.didBackup})}};var gr=e(A=>{let j=new qj,r=new SA,t={backup:e((k,E)=>r.runExclusive(async()=>await Kr(A,k,E,j)),"backup"),recover:e(k=>r.runExclusive(async()=>await i7(A,k,!1,j)),"recover"),verifyPin:e(k=>r.runExclusive(async()=>await br(A,k,!0,j)),"verifyPin"),resetBundleFromDevice:e((k,E)=>r.runExclusive(async()=>await xr(A,k,E)),"resetBundleFromDevice")},B=new SA;return{...t,hasSeedlessBundle:e(k=>yr(A,k),"hasSeedlessBundle"),deleteBundle:e(()=>zj(A,"latest"),"deleteBundle"),deleteAllBundles:e(()=>zj(A,"all"),"deleteAllBundles"),deleteJuiceboxShare:e(()=>wr(A),"deleteJuiceboxShare"),needsBundleUpdate:e(()=>_r(A),"needsBundleUpdate"),timeLeftCooldown:e(()=>Pr(A),"timeLeftCooldown"),getPinVerificationTimer:e(({pinVerificationExpiryInMs:k})=>Hr({...A,pinVerificationExpiryInMs:k}),"getPinVerificationTimer"),setPinVerificationTimer:e(k=>Tr(A,k),"setPinVerificationTimer"),...{getDeviceEncryptionKey:e(()=>B.runExclusive(async()=>await Lr(A)),"getDeviceEncryptionKey")},generateDeviceEncryptionKey:F7,setDeviceEncryptionKey:e(k=>c7(A,k),"setDeviceEncryptionKey"),deleteDeviceEncryptionKey:e(()=>Nr(A),"deleteDeviceEncryptionKey"),getOrCreateSeedlessDeviceID:e(()=>l7(A),"getOrCreateSeedlessDeviceID"),resetLocalDeviceState:e(()=>Dr(A.storage),"resetLocalDeviceState"),subscribe:e((k,E)=>j.subscribe(k,E),"subscribe")}},"createSeedlessRepository"),HA={},Wj="Cannot reset bundle from device: no local seedless entropy is available.",Fj="Failed to reset bundle from device: backup result=",xr=e(async(A,j,r)=>{if(!$A(j))throw new Error("Invalid PIN provided. Only numbers are accepted.");let t=r?.[0];if(!t)throw new Error(Wj);await zj(A);let B=await RA(A,{pin:j,entropy:t});if(B.type!=="success")throw new Error(`${Fj}${B.type}`);return{entropy:t}},"resetBundleFromDevice"),Kr=e(async(A,j,r,t)=>{let B=await RA(A,{pin:r,entropy:j});if(t.emitBackupResult(B),B.type!=="success")throw new ij(B)},"backup"),i7=e(async(A,j,r=!1,t)=>{let B=await $7(A,t,{pin:j,ignoreCooldown:r});if(t.emitRecoverResult(B),B.type!=="success")throw new wA(B);return{entropy:B.entropy}},"recover"),br=e(async(A,j,r=!0,t)=>{await i7(A,j,r,t)},"verifyPin"),_r=e(async({authRepository:A})=>{let j=await A.getUser();if(!j)throw new Error("User is not logged in, cannot check for seedless bundle update");let{accessToken:r}=j,t,B=FA(pA());try{t=await yA("latest",r)}catch(k){if(k instanceof Error&&k.message==="bundle not found")return!1;throw k}return!!$j()[t.id]&&t.id!==B},"needsBundleUpdate"),yr=e(async(A,j="latest")=>{let r=await A.authRepository.getUser();if(!r)throw new Error("User is not logged in, cannot check for se*dless bundle");let{accessToken:t}=r;return await Bj(j,t)},"hasSeedlessBundle"),zj=e(async(A,j="latest")=>{let r=await A.authRepository.getUser();if(!r)throw new Error("User is not logged in, cannot delete se*dless bundle");let{accessToken:t}=r;if(j==="all")return await y6(t);let B=FA(pA());return await kj(B,t)},"deleteSeedlessBundle"),wr=e(async A=>{let j=await A.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot delete juicebox share");let{accessToken:r}=j;await(await A.juiceboxClient()).deleteShare(pA(),r)},"deleteJuiceboxShare"),Pr=e(async({storage:A})=>{let{timeRemaining:j}=await CA(A);return j},"timeLeftCooldown"),Hr=e(async({storage:A,pinVerificationExpiryInMs:j})=>{let r=Date.now(),t=await A.get(tA.SeedlessPinVerificationLockTimerInMs)??Date.now();return{expired:r>=t+(j??2147483647),timestampInMs:t}},"getPinVerificationTimer"),Tr=e(async({storage:A},j)=>{await A.set(tA.SeedlessPinVerificationLockTimerInMs,j)},"setPinVerificationTimer"),Qj=e(async A=>(await A.get(tA.SeedlessDeviceID))?.deviceID??null,"fetchSeedlessDeviceID"),q7=e(async(A,j)=>{await A.set(tA.SeedlessDeviceID,{version:1,deviceID:j})},"storeSeedlessDeviceID"),Dr=e(async(A,j)=>{if(await A.remove([tA.SeedlessDeviceID,tA.SeedlessPinVerificationLockTimerInMs]),j){delete HA[j];return}for(let r of Object.keys(HA))delete HA[r]},"resetLocalDeviceState"),F7=e(()=>{let A=JA(32);try{return Promise.resolve(W.from(A))}finally{A.fill(0)}},"generateDeviceEncryptionKey"),l7=e(async({storage:A})=>{let j=await Qj(A);return j||(j=uj(),await q7(A,j)),j},"getOrCreateSeedlessDeviceID"),Lr=e(async A=>{let{authRepository:j}=A,r=await j.getUser();if(!r)throw new Error("User not logged in, cannot retrieve device encryption key.");let t=await l7(A),B=HA[t];if(B)return B;let s=await wj(r.accessToken,t);return s||(s=await F7(),await c7(A,s)),HA[t]=s,s},"getDeviceEncryptionKey"),c7=e(async({authRepository:A,storage:j},r)=>{let t=await A.getUser();if(!t)throw new Error("User not logged in, cannot set device encryption key.");let B=await Qj(j);return B||(B=uj(),await q7(j,B)),await w6(t.accessToken,B,r),HA[B]=r,r},"setDeviceEncryptionKey"),Nr=e(async({authRepository:A,storage:j})=>{let r=await A.getUser();if(!r)throw new Error("User not logged in, cannot delete device encryption key.");let t=await Qj(j);if(!t)return null;let B=await wj(r.accessToken,t);return B?(await P6(r.accessToken,t),B):null},"deleteDeviceEncryptionKey");var Sr=e(A=>!(A instanceof Error)||!A.message.startsWith(Fj)?null:A.message.slice(Fj.length),"getBackupResultFromResetError");function Rr(){let A=R(),j=kA();return rA({mutationFn:e(async t=>await A.resetBundleFromDevice(t.pin,t.seedlessEntropies),"mutationFn"),onSuccess:e(()=>{l.addBreadcrumb(F.Seedless,"Successfully reset bundle from device",I.Info),j.capture("seedlessResetPinSuccess")},"onSuccess"),onError:e(t=>{l.addBreadcrumb(F.Seedless,"Failed to reset bundle from device",I.Error),j.capture("seedlessResetPinError"),t instanceof Error&&t.message===Wj&&j.capture("reset_rejected_empty_entropy");let B=Sr(t);B&&(j.capture("reset_rejected_non_success_result",{data:{backupResult:B}}),B==="bundle-already-exists"&&j.capture("reset_rejected_bundle_already_exists"))},"onError")})}e(Rr,"useResetBundleFromDevice");n();a();var Cr=1e3,Xr=500;function Zj(){let A=IA.timeLeftCooldown,j=R(),r=WA();return xA({enabled:r,queryKey:A,queryFn:e(async()=>await j.timeLeftCooldown(),"queryFn"),refetchInterval:Cr,refetchOnMount:"always",staleTime:Xr})}e(Zj,"useTimeLeftCooldown");n();a();var lj=GA(gA());var G7=1e3,d7=e(()=>{let[A,j]=(0,lj.useState)(0);return(0,lj.useEffect)(()=>{if(!A)return;let r=setInterval(async()=>{j(A-G7)},G7);return()=>clearInterval(r)},[A]),{cooldownTimer:A,setCooldownTimer:j}},"useCheckCooldownTimer");n();a();var I7=GA(gA());var Ur=e(()=>{let A=jA(),j=R(),r=zA(),t=o6(),B=n6();return(0,I7.useCallback)(async()=>{await r.deleteAllAuthFactors(),await t.patchUserProfile({privacyState:a6.INVISIBLE,addresses:B.reduce((s,k)=>(s[k]="",s),{})}),await j.deleteAllBundles(),await j.deleteJuiceboxShare(),await lA(A),await EA(A)},[j,r,t,A,B])},"useDeleteSeedlessProfile");n();a();var u7=GA(gA());var Vr="seedless-pin-verification-timer-in-ms",Jr=D.coerce.number().positive().lte(2147483647).transform(A=>Math.max(A,1e3)).catch(2147483647).default(2147483647),Yr=e(()=>{let A=R(),j=(0,u7.useMemo)(()=>{let t=k6.getMultivariateAssignment(Vr,{dependent_flag:"enable-seedless-pin-verification-interstitial",variation_served:"true"});return Jr.parse(t)},[]),r=e(async()=>{let{expired:t,timestampInMs:B}=await A.getPinVerificationTimer({pinVerificationExpiryInMs:j});return{expired:t,timestampInMs:B}},"queryFn");return xA({queryKey:[tA.SeedlessPinVerificationLockTimerInMs],queryFn:r,refetchInterval:j??2147483647,staleTime:j??2147483647})},"useSeedlessPinVerificationTimer");n();a();var A6=e(()=>{let A=jA(),j=R();return rA({mutationFn:e(async()=>{l.addBreadcrumb(F.Seedless,"Resetting PIN verification timer",I.Info),await j.setPinVerificationTimer(Date.now())},"mutationFn"),onSuccess:e(async()=>{l.addBreadcrumb(F.Seedless,"Successfully reset PIN verification timer",I.Info),await A.invalidateQueries({queryKey:[tA.SeedlessPinVerificationLockTimerInMs]})},"onSuccess"),onError:e(()=>{l.addBreadcrumb(F.Seedless,"Failed to reset PIN verification timer",I.Error)},"onError")})},"useResetSeedlessPinVerificationTimer");n();a();var cA=GA(gA());var zr=e(({hasEnrolledAuthentication:A,onOnboardingDone:j,onOnboardingProtect:r,onImportAndSyncAccounts:t,onForgot:B,onNotRegisteredError:s,onError:k})=>{let{t:E}=s6(),o=kA(),{refetch:$}=Zj(),{mutateAsync:i}=A6(),{mutateAsync:q}=_j(),f=B6("enable-cleanup-on-not-registered-error"),[g,O]=(0,cA.useState)(!1),[G,p]=(0,cA.useState)({isInvalidPin:!1,triesLeft:void 0,pin:""}),[x,b]=(0,cA.useState)(!1),{cooldownTimer:w,setCooldownTimer:N}=d7(),{minutes:z,seconds:V}=xj(w),[L,C]=(0,cA.useState)(null);return(0,cA.useEffect)(()=>{!G.triesLeft||G.triesLeft>0||B()},[G.triesLeft,B]),(0,cA.useEffect)(()=>{e(async()=>{let{data:m=0}=await $();return m},"refetchTimer")().then(m=>N(m))},[$,N]),{isLoading:x,isError:g,handleInput:e(u=>{p(m=>({...m,isInvalidPin:u!==""&&!tj(u),pin:u}))},"handleInput"),onSubmit:e(async()=>{if(!x){if(!$A(G.pin)){p(u=>({...u,isInvalidPin:!0,triesLeft:void 0,pin:""}));return}try{b(!0),O(!1),p(m=>({...m,isInvalidPin:!1,triesLeft:void 0}));let{entropy:u}=await q(G.pin);await t(u),await i(),o.capture("seedlessEnterPinContinue"),!A&&j?j():r?.()}catch(u){if(k?.(u instanceof Error?u:new Error(String(u))),Uj(u)||Vj(u)){let m;if("guessesRemaining"in u.result&&(m=u.result.guessesRemaining),m===0){p(K=>({...K,isInvalidPin:!0,triesLeft:m,pin:""})),B();return}let h=!1;"reason"in u.result&&u.result.reason===eA.InvalidPin&&(h=!0);let{data:M=0}=await $();N(M),o.capture("seedlessPinError",{data:{triesLeft:m,cooldownTimer:M}}),p(K=>({...K,isInvalidPin:h,triesLeft:m,pin:""}))}else if(Jj(u))O(!0),C({title:E("seedlessRecoverErrorUpgradeRequiredTitle"),description:E("seedlessRecoverErrorUpgradeRequiredDescription")});else if(Yj(u)&&s&&f){l.captureError(u,F.Seedless);try{await s(G.pin)}catch(m){l.captureError(m,F.Seedless),O(!0),C({title:E("seedlessEnterPinUnknownErrorPrimaryText"),description:E("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:E("seedlessTryAgain")})}}else l.captureError(u,F.Seedless),O(!0),C({title:E("seedlessEnterPinUnknownErrorPrimaryText"),description:E("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:E("seedlessTryAgain")})}finally{b(!1)}}},"onSubmit"),onForgot:B,pinAttemptsLeft:G.triesLeft,isPinError:G.isInvalidPin,hasCooldownTimer:w>0,disabled:w>0||G.isInvalidPin||!G.pin||G.pin.length<4,pin:G.pin,continueButtonText:E("seedlessContinueText"),forgotButtonText:E("seedlessVerifyPinForgotButtonText"),attemptsLeftText:E("seedlessEnterPinNumTriesLeft",{numTries:G.triesLeft}),cooldownTimerText:E("seedlessEnterPinCooldown",{minutesLeft:z,secondsLeft:V}),invalidPinText:E("seedlessEnterPinInvalidPinError"),title:E("seedlessEnterPinPrimaryText"),loadingTitle:E("seedlessLoadingWalletPrimaryText"),loadingDescription:E("seedlessLoadingWalletSecondaryText"),errorTitle:L?L.title:E("seedlessLoadingWalletErrorPrimaryText"),errorDescription:L?L.description:E("seedlessErrorSecondaryText"),tryAgainButtonText:L?L.buttonText:E("seedlessTryAgain")}},"useSeedlessEnterPinProps");n();a();var p7=GA(gA());var Wr=e(()=>{let A=R(),j=zA(),r=jA();return(0,p7.useCallback)(async()=>{await A.deleteAllBundles(),await j.deleteAllAuthFactors(),await lA(r),await EA(r)},[A,j,r])},"useDeleteSeedlessBundles");n();a();n();a();var j6={};f7(j6,{default:()=>r6});var r6="./juicebox-sdk_bg-LUYFYBUJ.wasm";$6(j6);var v7=!1,Zr=e(async()=>{if(v7)return;let A=await import("./juicebox-sdk_bg-HFON7OYX.js"),j=await WebAssembly.instantiateStreaming(fetch(r6),{"./juicebox-sdk_bg.js":A});A.__wbg_set_wasm(j.instance.exports),v7=!0},"initWasm");function O7(A){globalThis.JuiceboxTokens=A}e(O7,"setGlobalJuiceboxTokens");O7({});var t6=class{static{e(this,"JuiceboxProvider")}setJuiceboxTokens(j){O7(j)}async backupShare(j,r,t,B,s){await(await this.client(j)).register(t,r,B,s)}async recoverShare(j,r,t){return await(await this.client(j)).recover(r,t)}async deleteShare(j){await(await this.client(j)).delete()}async client(j){return await Zr(),new i6(new q6(j),[])}};n();a();var Jn=[DA.FirstTimeOnboarding,DA.IsResettingApp],Yn=[YA.Seed,YA.Seedless,YA.PrivateKey],zn="https://phantom-wallet.zendesk.com/hc/en-us/articles/33478025712531",Wn="https://help.phantom.com/hc/en-us/articles/15079894392851";export{I6 as a,DA as b,ct as c,Gt as d,dt as e,Jn as f,Yn as g,zn as h,Wn as i,dA as j,w7 as k,eA as l,P7 as m,h6 as n,$A as o,xj as p,Kj as q,g7 as r,D7 as s,L7 as t,_j as u,N7 as v,S7 as w,PA as x,Mr as y,Uj as z,Vj as A,Jj as B,gr as C,Rr as D,Zj as E,Ur as F,Yr as G,A6 as H,zr as I,Wr as J,t6 as K};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-GA7OWDUC.js.map
