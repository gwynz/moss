import{A as ca,B as oh,G as ih,L as Ao,P as ah,Q as tn,T as ch,db as bh,f as Xf,fa as uh,g as ql,ia as lh,ja as dh,k as sh,ka as is,qa as ua,ra as ph,sa as mh,t as aa,ta as fh,u as en,ua as hh,va as gh,wa as yh,ya as wh,za as Sh}from"./chunk-IOXJCRJI.js";import{e as Ft,ia as _f,o as Cf,ua as Ff,ya as Zr}from"./chunk-FLYQWZR6.js";import{Ac as ft,B as cf,Ec as If,Fb as Fe,Vb as Ki,Wb as tr,Zb as bf,ac as Tf,b as of,bc as Ef,ca as yf,cc as Af,da as wf,hc as xf,i as jr,ja as Wr,ka as Vi,lb as ji,oa as $i,p as af,sa as Sf,tc as Wi}from"./chunk-F236ETGH.js";import{Cb as zf,Eb as Qf,Gb as Hf,Ib as Gf,Jd as Y,Kb as Vf,L as Zi,Mb as $f,Nb as jf,Ob as ea,P as Nf,Pb as ta,Pd as oa,Q as Bf,Qd as nh,R as Lf,S as Of,Sc as sa,T as Xi,Ua as Jr,Ud as Ml,Vd as Eo,Xc as ae,Yc as Pt,ab as Uf,be as Ne,c as Pf,ce as ia,d as st,e as rs,fd as To,g as Xr,gb as Ji,hb as Yi,hc as Kf,hd as Jf,id as Yf,jc as Yr,jd as eh,lc as ra,mc as ss,nc as os,ob as Ul,oc as Wf,p as vf,pc as Zf,q as Rf,qd as En,sd as th,tc as ce,u as Df,uc as bo,vc as na,vd as rh,w as ns,xb as Mf,yb as qf}from"./chunk-QF7OLC35.js";import{A as ie,Ad as ne,Bb as DA,Bd as et,D as we,Db as Xm,Ee as uf,F as _t,Fa as Oi,Fd as sf,Fe as Hi,Gc as F,Ha as Gm,Hc as I,He as lf,Ia as Vm,Ja as mt,Jc as Jn,Kb as A,Kc as E,Ma as $m,Mb as W,Mf as Se,Na as Ui,Nb as Gr,Nf as be,Oa as jm,Ob as Jm,Pb as qt,Q as Tn,Qa as Km,Qb as je,R as Hm,Rb as D,Sb as wo,T as kr,Tb as Ym,Te as df,U as te,Ue as pf,Vb as cr,Ve as es,Wa as ue,We as Re,Ye as ts,_c as H,_e as mf,bd as ee,be as At,ce as zi,dc as ef,dd as K,df as ff,ec as zt,ee as Qi,ef as Gi,fe as Yn,ge as $r,h as zm,hf,ic as Mi,ie as xt,j as Qm,jc as qi,jd as Ke,je as er,jf as gf,nd as tf,od as rf,qd as nf,ud as Pe,vf as O,wd as Vr,zb as RA}from"./chunk-LPV5DSV2.js";import{E as Zm,g as yo,m as vA,t as Wm,u as Xn}from"./chunk-NEE4FZIK.js";import{A as bt,B as go,C as pt,J as b,Ja as kf,K as V,L as $,M as So,Pb as OA,Qb as UA,Sb as MA,T as L,Y as Kr,Z as We,aa as NA,da as BA,db as LA,e as bn,w as i,y as nt}from"./chunk-JYKVQ4NC.js";import{a,d as dt,g as U,i as u,j as h,l as PA,m as Buffer,n as l}from"./chunk-TSHWMJEM.js";var Ah=dt((Cr,Eh)=>{u();l();var Th=typeof self<"u"?self:Cr,la=function(){function t(){this.fetch=!1,this.DOMException=Th.DOMException}return a(t,"F"),t.prototype=Th,new t}();(function(t){var e=function(r){var n={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function s(C){return C&&DataView.prototype.isPrototypeOf(C)}if(a(s,"isDataView"),n.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(C){return C&&o.indexOf(Object.prototype.toString.call(C))>-1};function d(C){if(typeof C!="string"&&(C=String(C)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(C))throw new TypeError("Invalid character in header field name");return C.toLowerCase()}a(d,"normalizeName");function m(C){return typeof C!="string"&&(C=String(C)),C}a(m,"normalizeValue");function p(C){var N={next:a(function(){var Z=C.shift();return{done:Z===void 0,value:Z}},"next")};return n.iterable&&(N[Symbol.iterator]=function(){return N}),N}a(p,"iteratorFor");function f(C){this.map={},C instanceof f?C.forEach(function(N,Z){this.append(Z,N)},this):Array.isArray(C)?C.forEach(function(N){this.append(N[0],N[1])},this):C&&Object.getOwnPropertyNames(C).forEach(function(N){this.append(N,C[N])},this)}a(f,"Headers"),f.prototype.append=function(C,N){C=d(C),N=m(N);var Z=this.map[C];this.map[C]=Z?Z+", "+N:N},f.prototype.delete=function(C){delete this.map[d(C)]},f.prototype.get=function(C){return C=d(C),this.has(C)?this.map[C]:null},f.prototype.has=function(C){return this.map.hasOwnProperty(d(C))},f.prototype.set=function(C,N){this.map[d(C)]=m(N)},f.prototype.forEach=function(C,N){for(var Z in this.map)this.map.hasOwnProperty(Z)&&C.call(N,this.map[Z],Z,this)},f.prototype.keys=function(){var C=[];return this.forEach(function(N,Z){C.push(Z)}),p(C)},f.prototype.values=function(){var C=[];return this.forEach(function(N){C.push(N)}),p(C)},f.prototype.entries=function(){var C=[];return this.forEach(function(N,Z){C.push([Z,N])}),p(C)},n.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function g(C){if(C.bodyUsed)return Promise.reject(new TypeError("Already read"));C.bodyUsed=!0}a(g,"consumed");function w(C){return new Promise(function(N,Z){C.onload=function(){N(C.result)},C.onerror=function(){Z(C.error)}})}a(w,"fileReaderReady");function y(C){var N=new FileReader,Z=w(N);return N.readAsArrayBuffer(C),Z}a(y,"readBlobAsArrayBuffer");function S(C){var N=new FileReader,Z=w(N);return N.readAsText(C),Z}a(S,"readBlobAsText");function x(C){for(var N=new Uint8Array(C),Z=new Array(N.length),oe=0;oe<N.length;oe++)Z[oe]=String.fromCharCode(N[oe]);return Z.join("")}a(x,"readArrayBufferAsText");function T(C){if(C.slice)return C.slice(0);var N=new Uint8Array(C.byteLength);return N.set(new Uint8Array(C)),N.buffer}a(T,"bufferClone");function _(){return this.bodyUsed=!1,this._initBody=function(C){this._bodyInit=C,C?typeof C=="string"?this._bodyText=C:n.blob&&Blob.prototype.isPrototypeOf(C)?this._bodyBlob=C:n.formData&&FormData.prototype.isPrototypeOf(C)?this._bodyFormData=C:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)?this._bodyText=C.toString():n.arrayBuffer&&n.blob&&s(C)?(this._bodyArrayBuffer=T(C.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(C)||c(C))?this._bodyArrayBuffer=T(C):this._bodyText=C=Object.prototype.toString.call(C):this._bodyText="",this.headers.get("content-type")||(typeof C=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var C=g(this);if(C)return C;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var C=g(this);if(C)return C;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(x(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(z)}),this.json=function(){return this.text().then(JSON.parse)},this}a(_,"Body");var k=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function P(C){var N=C.toUpperCase();return k.indexOf(N)>-1?N:C}a(P,"normalizeMethod");function v(C,N){N=N||{};var Z=N.body;if(C instanceof v){if(C.bodyUsed)throw new TypeError("Already read");this.url=C.url,this.credentials=C.credentials,N.headers||(this.headers=new f(C.headers)),this.method=C.method,this.mode=C.mode,this.signal=C.signal,!Z&&C._bodyInit!=null&&(Z=C._bodyInit,C.bodyUsed=!0)}else this.url=String(C);if(this.credentials=N.credentials||this.credentials||"same-origin",(N.headers||!this.headers)&&(this.headers=new f(N.headers)),this.method=P(N.method||this.method||"GET"),this.mode=N.mode||this.mode||null,this.signal=N.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Z)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Z)}a(v,"Request"),v.prototype.clone=function(){return new v(this,{body:this._bodyInit})};function z(C){var N=new FormData;return C.trim().split("&").forEach(function(Z){if(Z){var oe=Z.split("="),re=oe.shift().replace(/\+/g," "),J=oe.join("=").replace(/\+/g," ");N.append(decodeURIComponent(re),decodeURIComponent(J))}}),N}a(z,"decode");function Q(C){var N=new f,Z=C.replace(/\r?\n[\t ]+/g," ");return Z.split(/\r?\n/).forEach(function(oe){var re=oe.split(":"),J=re.shift().trim();if(J){var Ge=re.join(":").trim();N.append(J,Ge)}}),N}a(Q,"parseHeaders"),_.call(v.prototype);function R(C,N){N||(N={}),this.type="default",this.status=N.status===void 0?200:N.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in N?N.statusText:"OK",this.headers=new f(N.headers),this.url=N.url||"",this._initBody(C)}a(R,"Response"),_.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},R.error=function(){var C=new R(null,{status:0,statusText:""});return C.type="error",C};var G=[301,302,303,307,308];R.redirect=function(C,N){if(G.indexOf(N)===-1)throw new RangeError("Invalid status code");return new R(null,{status:N,headers:{location:C}})},r.DOMException=t.DOMException;try{new r.DOMException}catch{r.DOMException=function(N,Z){this.message=N,this.name=Z;var oe=Error(N);this.stack=oe.stack},r.DOMException.prototype=Object.create(Error.prototype),r.DOMException.prototype.constructor=r.DOMException}function M(C,N){return new Promise(function(Z,oe){var re=new v(C,N);if(re.signal&&re.signal.aborted)return oe(new r.DOMException("Aborted","AbortError"));var J=new XMLHttpRequest;function Ge(){J.abort()}a(Ge,"abortXhr"),J.onload=function(){var xe={status:J.status,statusText:J.statusText,headers:Q(J.getAllResponseHeaders()||"")};xe.url="responseURL"in J?J.responseURL:xe.headers.get("X-Request-URL");var St="response"in J?J.response:J.responseText;Z(new R(St,xe))},J.onerror=function(){oe(new TypeError("Network request failed"))},J.ontimeout=function(){oe(new TypeError("Network request failed"))},J.onabort=function(){oe(new r.DOMException("Aborted","AbortError"))},J.open(re.method,re.url,!0),re.credentials==="include"?J.withCredentials=!0:re.credentials==="omit"&&(J.withCredentials=!1),"responseType"in J&&n.blob&&(J.responseType="blob"),re.headers.forEach(function(xe,St){J.setRequestHeader(St,xe)}),re.signal&&(re.signal.addEventListener("abort",Ge),J.onreadystatechange=function(){J.readyState===4&&re.signal.removeEventListener("abort",Ge)}),J.send(typeof re._bodyInit>"u"?null:re._bodyInit)})}return a(M,"fetch"),M.polyfill=!0,t.fetch||(t.fetch=M,t.Headers=f,t.Request=v,t.Response=R),r.Headers=f,r.Request=v,r.Response=R,r.fetch=M,Object.defineProperty(r,"__esModule",{value:!0}),r}({})})(la);la.fetch.ponyfill=!0;delete la.fetch.polyfill;var as=la;Cr=as.fetch;Cr.default=as.fetch;Cr.fetch=as.fetch;Cr.Headers=as.Headers;Cr.Request=as.Request;Cr.Response=as.Response;Eh.exports=Cr});var Ih=dt((UB,xh)=>{u();l();(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:a(function(r,n){return r<<n|r>>>32-n},"rotl"),rotr:a(function(r,n){return r<<32-n|r>>>n},"rotr"),endian:a(function(r){if(r.constructor==Number)return e.rotl(r,8)&16711935|e.rotl(r,24)&4278255360;for(var n=0;n<r.length;n++)r[n]=e.endian(r[n]);return r},"endian"),randomBytes:a(function(r){for(var n=[];r>0;r--)n.push(Math.floor(Math.random()*256));return n},"randomBytes"),bytesToWords:a(function(r){for(var n=[],s=0,o=0;s<r.length;s++,o+=8)n[o>>>5]|=r[s]<<24-o%32;return n},"bytesToWords"),wordsToBytes:a(function(r){for(var n=[],s=0;s<r.length*32;s+=8)n.push(r[s>>>5]>>>24-s%32&255);return n},"wordsToBytes"),bytesToHex:a(function(r){for(var n=[],s=0;s<r.length;s++)n.push((r[s]>>>4).toString(16)),n.push((r[s]&15).toString(16));return n.join("")},"bytesToHex"),hexToBytes:a(function(r){for(var n=[],s=0;s<r.length;s+=2)n.push(parseInt(r.substr(s,2),16));return n},"hexToBytes"),bytesToBase64:a(function(r){for(var n=[],s=0;s<r.length;s+=3)for(var o=r[s]<<16|r[s+1]<<8|r[s+2],c=0;c<4;c++)s*8+c*6<=r.length*8?n.push(t.charAt(o>>>6*(3-c)&63)):n.push("=");return n.join("")},"bytesToBase64"),base64ToBytes:a(function(r){r=r.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],s=0,o=0;s<r.length;o=++s%4)o!=0&&n.push((t.indexOf(r.charAt(s-1))&Math.pow(2,-2*o+8)-1)<<o*2|t.indexOf(r.charAt(s))>>>6-o*2);return n},"base64ToBytes")};xh.exports=e})()});var Ql=dt((QB,kh)=>{u();l();var zl={utf8:{stringToBytes:a(function(t){return zl.bin.stringToBytes(unescape(encodeURIComponent(t)))},"stringToBytes"),bytesToString:a(function(t){return decodeURIComponent(escape(zl.bin.bytesToString(t)))},"bytesToString")},bin:{stringToBytes:a(function(t){for(var e=[],r=0;r<t.length;r++)e.push(t.charCodeAt(r)&255);return e},"stringToBytes"),bytesToString:a(function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")},"bytesToString")}};kh.exports=zl});var _h=dt(($B,Ch)=>{u();l();(function(){var t=Ih(),e=Ql().utf8,r=Ql().bin,n=a(function(o){o.constructor==String?o=e.stringToBytes(o):typeof Buffer<"u"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(o)?o=Array.prototype.slice.call(o,0):Array.isArray(o)||(o=o.toString());var c=t.bytesToWords(o),d=o.length*8,m=[],p=1732584193,f=-271733879,g=-1732584194,w=271733878,y=-1009589776;c[d>>5]|=128<<24-d%32,c[(d+64>>>9<<4)+15]=d;for(var S=0;S<c.length;S+=16){for(var x=p,T=f,_=g,k=w,P=y,v=0;v<80;v++){if(v<16)m[v]=c[S+v];else{var z=m[v-3]^m[v-8]^m[v-14]^m[v-16];m[v]=z<<1|z>>>31}var Q=(p<<5|p>>>27)+y+(m[v]>>>0)+(v<20?(f&g|~f&w)+1518500249:v<40?(f^g^w)+1859775393:v<60?(f&g|f&w|g&w)-1894007588:(f^g^w)-899497514);y=w,w=g,g=f<<30|f>>>2,f=p,p=Q}p+=x,f+=T,g+=_,w+=k,y+=P}return[p,f,g,w,y]},"sha1"),s=a(function(o,c){var d=t.wordsToBytes(n(o));return c&&c.asBytes?d:c&&c.asString?r.bytesToString(d):t.bytesToHex(d)},"api");s._blocksize=16,s._digestsize=20,Ch.exports=s})()});var gS=dt(hS=>{"use strict";u();l();var Qs=$();function wP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}a(wP,"is");var SP=typeof Object.is=="function"?Object.is:wP,bP=Qs.useState,TP=Qs.useEffect,EP=Qs.useLayoutEffect,AP=Qs.useDebugValue;function xP(t,e){var r=e(),n=bP({inst:{value:r,getSnapshot:e}}),s=n[0].inst,o=n[1];return EP(function(){s.value=r,s.getSnapshot=e,yp(s)&&o({inst:s})},[t,r,e]),TP(function(){return yp(s)&&o({inst:s}),t(function(){yp(s)&&o({inst:s})})},[t]),AP(r),r}a(xP,"useSyncExternalStore$2");function yp(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!SP(t,r)}catch{return!0}}a(yp,"checkIfSnapshotChanged");function IP(t,e){return e()}a(IP,"useSyncExternalStore$1");var kP=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?IP:xP;hS.useSyncExternalStore=Qs.useSyncExternalStore!==void 0?Qs.useSyncExternalStore:kP});var wS=dt(yS=>{"use strict";u();l();h.NODE_ENV!=="production"&&function(){function t(y,S){return y===S&&(y!==0||1/y===1/S)||y!==y&&S!==S}a(t,"is");function e(y,S){f||s.startTransition===void 0||(f=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var x=S();if(!g){var T=S();o(x,T)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),g=!0)}T=c({inst:{value:x,getSnapshot:S}});var _=T[0].inst,k=T[1];return m(function(){_.value=x,_.getSnapshot=S,r(_)&&k({inst:_})},[y,x,S]),d(function(){return r(_)&&k({inst:_}),y(function(){r(_)&&k({inst:_})})},[y]),p(x),x}a(e,"useSyncExternalStore$2");function r(y){var S=y.getSnapshot;y=y.value;try{var x=S();return!o(y,x)}catch{return!0}}a(r,"checkIfSnapshotChanged");function n(y,S){return S()}a(n,"useSyncExternalStore$1"),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var s=$(),o=typeof Object.is=="function"?Object.is:t,c=s.useState,d=s.useEffect,m=s.useLayoutEffect,p=s.useDebugValue,f=!1,g=!1,w=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?n:e;yS.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:w,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var Sp=dt((KY,wp)=>{"use strict";u();l();h.NODE_ENV==="production"?wp.exports=gS():wp.exports=wS()});var bS=dt(SS=>{"use strict";u();l();var nu=$(),CP=Sp();function _P(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}a(_P,"is");var FP=typeof Object.is=="function"?Object.is:_P,PP=CP.useSyncExternalStore,vP=nu.useRef,RP=nu.useEffect,DP=nu.useMemo,NP=nu.useDebugValue;SS.useSyncExternalStoreWithSelector=function(t,e,r,n,s){var o=vP(null);if(o.current===null){var c={hasValue:!1,value:null};o.current=c}else c=o.current;o=DP(function(){function m(y){if(!p){if(p=!0,f=y,y=n(y),s!==void 0&&c.hasValue){var S=c.value;if(s(S,y))return g=S}return g=y}if(S=g,FP(f,y))return S;var x=n(y);return s!==void 0&&s(S,x)?(f=y,S):(f=y,g=x)}a(m,"memoizedSelector");var p=!1,f,g,w=r===void 0?null:r;return[function(){return m(e())},w===null?void 0:function(){return m(w())}]},[e,r,n,s]);var d=PP(t,o[0],o[1]);return RP(function(){c.hasValue=!0,c.value=d},[d]),NP(d),d}});var ES=dt(TS=>{"use strict";u();l();h.NODE_ENV!=="production"&&function(){function t(p,f){return p===f&&(p!==0||1/p===1/f)||p!==p&&f!==f}a(t,"is"),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=$(),r=Sp(),n=typeof Object.is=="function"?Object.is:t,s=r.useSyncExternalStore,o=e.useRef,c=e.useEffect,d=e.useMemo,m=e.useDebugValue;TS.useSyncExternalStoreWithSelector=function(p,f,g,w,y){var S=o(null);if(S.current===null){var x={hasValue:!1,value:null};S.current=x}else x=S.current;S=d(function(){function _(Q){if(!k){if(k=!0,P=Q,Q=w(Q),y!==void 0&&x.hasValue){var R=x.value;if(y(R,Q))return v=R}return v=Q}if(R=v,n(P,Q))return R;var G=w(Q);return y!==void 0&&y(R,G)?(P=Q,R):(P=Q,v=G)}a(_,"memoizedSelector");var k=!1,P,v,z=g===void 0?null:g;return[function(){return _(f())},z===null?void 0:function(){return _(z())}]},[f,g,w,y]);var T=s(p,S[0],S[1]);return c(function(){x.hasValue=!0,x.value=T},[T]),m(T),T},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var AS=dt((oee,bp)=>{"use strict";u();l();h.NODE_ENV==="production"?bp.exports=bS():bp.exports=ES()});var G0=dt((Xwe,H0)=>{"use strict";u();l();H0.exports=t=>{if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}});var Z0=dt((K0,W0)=>{"use strict";u();l();var _u=G0(),{hasOwnProperty:$0}=Object.prototype,{propertyIsEnumerable:l1}=Object,ro=a((t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0}),"defineProperty"),d1=K0,V0={concatArrays:!1,ignoreUndefined:!1},Fu=a(t=>{let e=[];for(let r in t)$0.call(t,r)&&e.push(r);if(Object.getOwnPropertySymbols){let r=Object.getOwnPropertySymbols(t);for(let n of r)l1.call(t,n)&&e.push(n)}return e},"getEnumerableOwnPropertyKeys");function no(t){return Array.isArray(t)?p1(t):_u(t)?m1(t):t}a(no,"clone");function p1(t){let e=t.slice(0,0);return Fu(t).forEach(r=>{ro(e,r,no(t[r]))}),e}a(p1,"cloneArray");function m1(t){let e=Object.getPrototypeOf(t)===null?Object.create(null):{};return Fu(t).forEach(r=>{ro(e,r,no(t[r]))}),e}a(m1,"cloneOptionObject");var j0=a((t,e,r,n)=>(r.forEach(s=>{typeof e[s]>"u"&&n.ignoreUndefined||(s in t&&t[s]!==Object.getPrototypeOf(t)?ro(t,s,Kp(t[s],e[s],n)):ro(t,s,no(e[s])))}),t),"mergeKeys"),f1=a((t,e,r)=>{let n=t.slice(0,0),s=0;return[t,e].forEach(o=>{let c=[];for(let d=0;d<o.length;d++)$0.call(o,d)&&(c.push(String(d)),o===t?ro(n,s++,o[d]):ro(n,s++,no(o[d])));n=j0(n,o,Fu(o).filter(d=>!c.includes(d)),r)}),n},"concatArrays");function Kp(t,e,r){return r.concatArrays&&Array.isArray(t)&&Array.isArray(e)?f1(t,e,r):!_u(e)||!_u(t)?no(e):j0(t,e,Fu(e),r)}a(Kp,"merge");W0.exports=function(...t){let e=Kp(no(V0),this!==d1&&this||{},V0),r={_:{}};for(let n of t)if(n!==void 0){if(!_u(n))throw new TypeError("`"+n+"` is not an Option Object");r=Kp(r,{_:n},e)}return r._}});var sA=dt((hBe,nA)=>{u();l();function $N(t,e,r,n){for(var s=-1,o=t==null?0:t.length;++s<o;){var c=t[s];e(n,c,r(c),t)}return n}a($N,"arrayAggregator");nA.exports=$N});var iA=dt((SBe,oA)=>{u();l();var jN=UA();function KN(t,e,r,n){return jN(t,function(s,o,c){e(n,s,r(s),c)}),n}a(KN,"baseAggregator");oA.exports=KN});var cA=dt((ABe,aA)=>{u();l();var WN=sA(),ZN=iA(),XN=LA(),JN=BA();function YN(t,e){return function(r,n){var s=JN(r)?WN:ZN,o=e?e():{};return s(r,t,XN(n,2),o)}}a(YN,"createAggregator");aA.exports=YN});var lA=dt((CBe,uA)=>{u();l();var eB=NA(),tB=cA(),rB=tB(function(t,e,r){eB(t,r,e)});uA.exports=rB});u();l();u();l();var Fh=U(Ah(),1),Ph=U(_h(),1),Hl=U(PA(),1);var da=(t=>(t.BLOCK="BLOCK",t.NONE="NONE",t))(da||{});function qA(t,e){for(let r=0;r<t.k;r++){let n=(0,Ph.default)(`${t.salt}_${e}_${r}`,{asBytes:!0}),o=Hl.Buffer.from(n).subarray(0,4).readUInt32BE(0)%t.bits,c=Math.floor(o/24),d=Hl.Buffer.from(t.bitVector.slice(c*4,c*4+4),"base64"),m=o%24,p=Math.floor(m/8),f=m%8;if(!(d[p]&1<<7-f))return!1}return!0}a(qA,"lookup");var ZB=typeof self<"u"&&self.fetch?self.fetch:Fh.default;function vh(t,e,r,n){let o=new URL(n).hostname.toLowerCase().replace(/\.$/,"").split(".");for(let c=0;c<o.length-1;c++){let d=o.slice(c).join(".");if(e.includes(d))return{action:"BLOCK",hostname:d};if(qA(t,d)&&!r.includes(d))return{action:"BLOCK",hostname:d}}return{action:"NONE",hostname:null}}a(vh,"scanDomainWithHostname");u();l();var Rh="https://blowfish-blocklist-proxy.phantom.app",zA="https://github.com/phantom-labs/blocklist",Gl=a((t=3)=>({retry:t,retryDelay:a(e=>Math.min(1e3*2**e,3e4),"retryDelay")}),"reactQueryExponentialBackoff"),ur={SLIPPAGE_EXCEEDED:"SLIPPAGE_EXCEEDED",INSUFFICIENT_FUNDS:"INSUFFICIENT_FUNDS",INSUFFICIENT_GAS:"INSUFFICIENT_GAS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SIMULATION_FAILED:"SIMULATION_FAILED",TRANSACTION_EXPIRED:"TRANSACTION_EXPIRED",ACCOUNT_FROZEN:"ACCOUNT_FROZEN",SIMULATION_TIMEOUT:"SIMULATION_TIMEOUT",STALE_QUOTE:"STALE_QUOTE"},rn;(function(t){t[t.info=5]="info",t[t.error=4]="error",t[t.criticalError=3]="criticalError",t[t.alert=2]="alert",t[t.criticalAlert=1]="criticalAlert"})(rn||(rn={}));function QA(t){return{[rn.criticalAlert]:"1-critical-alert",[rn.alert]:"2-alert",[rn.criticalError]:"3-critical-error",[rn.error]:"4-error",[rn.info]:"5-information"}[t]}a(QA,"scanWarningVariantToUiLevel");var HA=6e4,lL=i.object({type:i.union([i.literal("all"),i.literal("blocklist"),i.literal("whitelist"),i.literal("error"),i.literal("fuzzy"),i.literal("blowfishBloomFilter")]),result:i.boolean(),source:i.optional(i.string()),match:i.string().optional(),isSubdomainDomainWhitelisted:i.boolean().optional()}),dL=i.object({localHash:i.any(),cursor:i.any()}),$l=i.object({bitVector:i.string(),k:i.number(),hash:i.string(),bits:i.number(),salt:i.string()}),GA=i.union([i.object({bloomFilter:$l,bloomFilterHash:i.string(),recentlyAdded:i.array(i.string()),recentlyRemoved:i.array(i.string()),nextCursor:i.string()}),i.object({bloomFilter:$l.optional(),bloomFilterHash:i.optional(i.string()),recentlyAdded:i.array(i.string()),recentlyRemoved:i.array(i.string()),nextCursor:i.string()})]),VA=i.object({bloomFilter:$l,lastUpdated:i.number()}).nullish(),$A=i.object({recentlyAdded:i.array(i.string()),recentlyRemoved:i.array(i.string()),lastUpdated:i.number().optional()}).nullish(),jA=a(t=>{let e=new URL(t).hostname.replace(/\.$/,"").split(".");return e.slice(0).slice(-(e.length===4?3:2)).join(".")},"removeSubdomainFromDomain"),jl=a(async(t,e,r)=>{try{return KA(r,t,e)}catch{return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}}},"detectPhishing"),KA=a(async(t,e,r)=>{if(!t)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let n=await e.getAll([et.CachedBloomFilter,et.CachedBloomFilterHash,et.CachedScanDataRecents,et.CachedScanDataCursor]),s=n[et.CachedBloomFilter]??null,o=n[et.CachedBloomFilterHash]??null,c=n[et.CachedScanDataCursor]??null,d=n[et.CachedScanDataRecents]??null,m=null,p={recentlyAdded:[],recentlyRemoved:[],lastUpdated:0},f=null;if(s){let y=VA.safeParse(s);y.success?m=y.data:await Vl(e)}if(d){let y=$A.safeParse(d);y.success?p=y.data:await Vl(e)}if(c){let S=i.string().safeParse(c);S.success?f=S.data:await Vl(e)}if(!p||p.lastUpdated==null||Date.now()>p.lastUpdated+HA){let y={localHash:o,cursor:f},S=await H.noBearer().post(Rh,y);if(S.status!==200)return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let x=S.data,T,_=GA.safeParse(x);if(_.success)T=_.data;else return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let k=[],P=[],v=typeof o=="string"&&T.bloomFilterHash?o!==T.bloomFilterHash:!1;p!=null&&!v&&(k=p.recentlyAdded,P=p.recentlyRemoved),k=k.concat(T.recentlyAdded),P=P.concat(T.recentlyRemoved),k=k.filter(Q=>T.recentlyRemoved.indexOf(Q)<0),P=P.filter(Q=>T.recentlyAdded.indexOf(Q)<0);let z={recentlyAdded:k,recentlyRemoved:P,lastUpdated:Date.now()};if(await e.set(et.CachedScanDataRecents,z),p=z,T.nextCursor!==f&&await e.set(et.CachedScanDataCursor,T.nextCursor),T.bloomFilter!=null){let Q={bloomFilter:T.bloomFilter,lastUpdated:Date.now()};await Promise.all([e.set(et.CachedBloomFilter,Q),e.set(et.CachedBloomFilterHash,T.bloomFilterHash)]),m=Q}}if(!m)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let{action:g,hostname:w}=vh(m.bloomFilter,p.recentlyAdded,p.recentlyRemoved,t);if(g===da.BLOCK){let y={result:!0,source:w,type:"blowfishBloomFilter"};return r.capture("blockedDomain",{data:y}),y}else if(g===da.NONE)return{result:!1,type:"all",isSubdomainDomainWhitelisted:!1};return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}},"checkBlowfishBlocklist");async function Vl(t){await t.remove([et.CachedBloomFilter,et.CachedBloomFilterHash,et.CachedScanDataRecents,et.CachedScanDataCursor])}a(Vl,"resetState");u();l();u();l();var WA=a(t=>t/1e8,"satsToBTC");u();l();u();l();var An;(function(t){t.Plus="PLUS",t.Minus="MINUS",t.Equal="EQUAL"})(An||(An={}));var Kl;(function(t){t.fungible="fungible",t.collectible="collectible",t.native="native",t.unknown="unknown"})(Kl||(Kl={}));var Wl;(function(t){t.approval="approval",t.revokal="revokal",t.transfer="transfer",t.mint="mint",t.unknown="unknown"})(Wl||(Wl={}));var cs;(function(t){t.Green="GREEN",t.Red="RED",t.White="WHITE"})(cs||(cs={}));var pa={[cs.Green]:"spotPositive",[cs.Red]:"spotNegative",[cs.White]:"textBase"};function ZA(t){switch(t){case An.Plus:return pa.GREEN;case An.Minus:return pa.RED;case An.Equal:return pa.WHITE;default:return pa.WHITE}}a(ZA,"getColorForStateChangeSign");function XA(t){let e=t?.advancedDetails&&"safeguard"in t.advancedDetails?t?.advancedDetails?.safeguard:void 0;if(e?.recommended&&!e?.shouldBundle&&!e.error&&!e.verifyError&&e?.transactions&&e.transactions.length>0)return e.transactions}a(XA,"extractSafeguardTransactions");function Dh(t,e){if(t.params&&"safeguard"in t.params&&t.params.safeguard&&e?.advancedDetails&&"safeguard"in e.advancedDetails&&e.advancedDetails.safeguard?.transactions){let r=e.advancedDetails.safeguard;if(r.error)return r.error;let n=t.params.transactions,s=r.transactions;if(s){let o;try{Zf(n,s)}catch(c){c instanceof os?o=c:c instanceof Error?o=os.createUnknownError(c.message):o=os.createUnknownError("Non error type",c)}if(o)return e.advancedDetails.safeguard.verifyError=o,o}}}a(Dh,"processSafeguardErrors");function Nh(t){if(t.advancedDetails&&"requestId"in t.advancedDetails)return t.advancedDetails.requestId}a(Nh,"extractRequestId");u();l();var Zl=a(async(t,e,r)=>{let n=`/simulation/v1?language=${t}`,s=await H.api().post(n,{...r,chainId:r.networkID,appVersion:nt,platform:bt,deviceId:e});if(!ee(s))throw new Error("Failed to scan message");return s.data},"getScanMessage"),xn=a(async(t,e,r)=>{let n=`/simulation/v1?language=${t}`,s={...r.params,...r.params&&"safeguard"in r.params?{safeguard:{...r.params.safeguard,lighthouseProgramId:Wf}}:{}};try{let o=await H.api().post(n,{...r,chainId:r.networkID,params:s,metadata:r.metadata,appVersion:nt,platform:bt,deviceId:e});if(!ee(o)){let m=await JA(o),p=`Failed to scan transaction: ${o.status} ${m}`;throw new Error(p)}let c=o.data,d=Dh(r,c);if(d instanceof os){let m=Nh(c);E.captureMessage(`Verify error ${m??""}: ${d.message}`,I.Safeguard)}return c}catch(o){throw E.captureError(o,I.Simulation),o}},"getScanTransaction");async function JA(t){let{data:e,blob:r}=t;if(typeof e=="string")return e;if(e&&typeof e=="object")return JSON.stringify(e);try{return await r?.text()??"Unknown error"}catch{return"Unknown error"}}a(JA,"getResponseErrorMessage");var ML=i.union([i.literal("signTransaction"),i.literal("signAllTransactions"),i.literal("signAndSendTransaction"),i.literal("signAndSendAllTransactions")]);u();l();u();l();var xo="Auto";var De={buyFungible:void 0,buyUsdValue:void 0,sellFungible:void 0,sellUsdValue:void 0,sellAmount:"",uiSellAmountCryptoInput:"",amountType:"sell",quoteResponse:void 0,selectedProviderIndex:0,selectedBaseProvider:xo,gasEstimation:{isFetching:!1,estimate:void 0,estimateWithBuffer:void 0},hasNoRoutes:!1,isFetchingQuote:!1,error:null,searchQuery:"",numSearchResults:0,primaryCurrency:"crypto",uiSellAmountLocalFiatInput:"",uiBuyAmountCryptoInput:"",uiBuyAmountLocalFiatInput:"",canInputFiatSellAmount:!1,swapFilter:void 0},j=ft(t=>({...De,resetQuote:a(()=>t({quoteResponse:De.quoteResponse,isFetchingQuote:De.isFetchingQuote,hasNoRoutes:De.hasNoRoutes,selectedProviderIndex:De.selectedProviderIndex,error:De.error,uiSellAmountLocalFiatInput:De.uiSellAmountLocalFiatInput,selectedBaseProvider:De.selectedBaseProvider}),"resetQuote"),resetSwapper:a(()=>t({quoteResponse:De.quoteResponse,gasEstimation:De.gasEstimation,error:De.error,sellAmount:"",uiSellAmountCryptoInput:"",uiBuyAmountCryptoInput:De.uiBuyAmountCryptoInput,swapFilter:De.swapFilter,selectedBaseProvider:De.selectedBaseProvider,selectedProviderIndex:De.selectedProviderIndex}),"resetSwapper"),setBuyFungible:a(e=>t({buyFungible:e}),"setBuyFungible"),setBuyUsdValue:a(e=>t({buyUsdValue:e}),"setBuyUsdValue"),setHasNoRoutes:a(e=>t({hasNoRoutes:e}),"setHasNoRoutes"),setIsFetchingQuote:a(e=>t({isFetchingQuote:e}),"setIsFetchingQuote"),setQuoteResponse:a(e=>t({quoteResponse:e,hasNoRoutes:!1}),"setQuoteResponse"),setSelectedProviderIndex:a(e=>t({selectedProviderIndex:e}),"setSelectedProviderIndex"),setSelectedBaseProvider:a(e=>t({selectedBaseProvider:e}),"setSelectedBaseProvider"),setGasEstimation:a(({estimate:e,estimateWithBuffer:r,isFetching:n})=>t(s=>({gasEstimation:{...s.gasEstimation,...e!==void 0&&{estimate:e},...r!==void 0&&{estimateWithBuffer:r},...n!==void 0&&{isFetching:n}}})),"setGasEstimation"),setSellAmount:a(e=>t({sellAmount:e}),"setSellAmount"),setAmountType:a(e=>t({amountType:e}),"setAmountType"),setSellUsdValue:a(e=>t({sellUsdValue:e}),"setSellUsdValue"),setSellFungible:a(e=>t({sellFungible:e}),"setSellFungible"),setUiSellAmountCryptoInput:a(e=>t({uiSellAmountCryptoInput:e}),"setUiSellAmountCryptoInput"),setError:a(e=>t({error:e}),"setError"),setSearchQuery:a(e=>t({searchQuery:e}),"setSearchQuery"),setNumSearchResults:a(e=>t({numSearchResults:e}),"setNumSearchResults"),setPrimaryCurrency:a(e=>t({primaryCurrency:e}),"setPrimaryCurrency"),setUiSellAmountLocalFiatInput:a(e=>t({uiSellAmountLocalFiatInput:e}),"setUiSellAmountLocalFiatInput"),setUiBuyAmountCryptoInput:a(e=>t({uiBuyAmountCryptoInput:e}),"setUiBuyAmountCryptoInput"),setUiBuyAmountLocalFiatInput:a(e=>t({uiBuyAmountLocalFiatInput:e}),"setUiBuyAmountLocalFiatInput"),setCanInputFiatSellAmount:a(e=>t({canInputFiatSellAmount:e}),"setCanInputFiatSellAmount"),setSwapFilter:a(e=>t({swapFilter:e}),"setSwapFilter"),switchTokensForSell:a(()=>{t(e=>{let r=e.sellFungible??e.buyFungible,n=e.buyFungible??e.sellFungible,s=e.uiBuyAmountCryptoInput,o=e.uiBuyAmountLocalFiatInput;return{sellFungible:n,buyFungible:r,uiSellAmountCryptoInput:s,uiSellAmountLocalFiatInput:o,uiBuyAmountCryptoInput:De.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:De.uiBuyAmountLocalFiatInput,sellAmount:s,swapFilter:void 0,selectedBaseProvider:e.selectedBaseProvider}})},"switchTokensForSell"),switchTokensForBuy:a(()=>{t(e=>{let r=e.sellFungible??e.buyFungible,n=e.buyFungible??e.sellFungible,s=e.uiSellAmountCryptoInput,o=e.uiSellAmountLocalFiatInput;return{sellFungible:n,buyFungible:r,uiSellAmountCryptoInput:De.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:De.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:s,uiBuyAmountLocalFiatInput:o,sellAmount:s,swapFilter:void 0,selectedBaseProvider:e.selectedBaseProvider}})},"switchTokensForBuy"),resetUiAmounts:a(()=>t({uiSellAmountCryptoInput:De.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:De.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:De.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:De.uiBuyAmountLocalFiatInput,sellAmount:De.sellAmount,selectedBaseProvider:De.selectedBaseProvider}),"resetUiAmounts"),setPairAndAmount:a(({sell:e,buy:r,swapAmount:n})=>t(s=>{let o;return n.perspective==="sell"?s.primaryCurrency==="crypto"?o="uiSellAmountCryptoInput":o="uiSellAmountLocalFiatInput":s.primaryCurrency==="crypto"?o="uiBuyAmountCryptoInput":o="uiBuyAmountLocalFiatInput",{...s,sellFungible:e,buyFungible:r,[o]:n.amount,sellAmount:n.amount}}),"setPairAndAmount")}));u();l();var ma=i.object({name:i.string(),message:i.string()}),Oh=i.object({chainId:kr,name:i.string(),symbol:i.string(),decimals:i.number(),logoURI:i.optional(i.string()),includesBridge:i.optional(i.boolean())}),YA=Oh.extend({address:i.string(),resourceType:i.literal(W.address)}),ex=Oh.extend({slip44:i.string(),resourceType:i.literal(W.nativeToken)}),cO=i.union([YA,ex]),Uh=i.object({id:i.string(),name:i.string(),logoUri:i.string()}),tx=i.union([i.enum(["network","phantom","gasless","ata","gasless_network","tips","priority_fee","prediction_fee_per_contract"]),i.string()]),rx=i.object({name:i.string(),percentage:i.number(),amount:i.number(),token:i.optional(qt),type:tx}),nx=i.object({name:i.string(),proportion:i.string()}),Mh=i.object({sellAmount:i.string(),buyAmount:i.string(),rfqProps:i.optional(i.object({expireAt:i.number(),quoteId:i.string()})),analyticsContext:i.optional(i.string())}),fa=Mh.extend({priceImpact:i.number(),sources:i.array(nx),fees:i.array(rx),slippageTolerance:i.optional(i.number()),baseProvider:Uh}),sx=i.object({success:i.boolean(),error:i.string().optional(),data:i.object({ataFeeUSD:i.number().optional(),networkFeeUSD:i.number().optional(),totalAmountUSD:i.number().optional()}).optional()}),ox=i.enum(["sync","async"]),Bh;(function(t){t.PreinitializePredictionMarkets="ppm"})(Bh||(Bh={}));var ha=fa.extend({transactionData:i.array(i.string()),gaslessSignature:i.optional(i.string()),cashQuoteSignerSignature:i.optional(i.string()),gaslessSwapFeeResult:i.optional(sx),executionMode:i.optional(ox),preInitializeSignerSignature:i.optional(i.string())}),ix=ha,uO=fa.extend({transactionData:i.array(i.string())}),ed=fa.extend({allowanceTarget:i.string(),exchangeAddress:i.string(),gas:i.number(),value:i.string(),transactionData:i.string()}),td=fa.extend({transactionData:i.array(i.string())}),Lh=i.object({name:i.string(),amount:i.string(),token:qt,percentage:i.string(),included:i.boolean(),amountUSD:i.optional(i.string())}),ax=i.object({name:i.string(),key:i.string(),logoURI:i.string()}),qh=i.object({name:i.string(),symbol:i.string()}),cx=i.object({transactionData:i.string(),buyToken:qt,sellToken:qt,nonIncludedNonGasFees:i.string(),feeCosts:i.array(Lh),chainId:kr,tool:ax,value:i.optional(i.string()),allowanceTarget:i.optional(i.string()),approvalMetadata:i.optional(qh),approvalExactAmount:i.optional(i.string()),exchangeAddress:i.optional(i.string()),gasCosts:i.optional(i.array(i.number())),includedFeeCosts:i.optional(i.array(Lh))}),rd=Mh.extend({baseProvider:Uh,executionDuration:i.number(),tags:i.array(i.string()),steps:i.array(cx)}),ux=i.union([ha,ed,td,rd,ix]),Io=i.enum(["solana","eip155","sui","xchain"]),ko=i.object({type:Io,taker:qt,buyToken:qt,sellToken:qt,slippageTolerance:i.number(),simulationTolerance:i.optional(i.number()),gasBuffer:i.optional(i.number()),quotes:i.array(ux),tradeFee:i.optional(i.array(i.number())),estimateGasFee:i.optional(i.array(i.number())),includesAllProviders:i.optional(i.boolean())}),lx=i.enum(["swap-approval","swap","bridge-approval","bridge"]),dx=i.enum(["swap","bridge"]),px=i.enum(["swap","bridge"]),mx=i.enum(["bridge"]),ga=i.object({sellToken:qt,buyToken:qt,approvalMetadata:i.optional(qh)}),fx=i.object({type:i.literal("solana"),transactions:i.array(i.string()),transactionTypes:i.array(dx),transactionPairs:i.optional(i.array(ga))});var hx=i.object({type:i.literal("evm"),transactions:i.array(Xn),transactionTypes:i.array(lx),transactionPairs:i.optional(i.array(ga))}),gx=i.object({type:i.literal("sui"),transactions:i.array(i.string()),transactionTypes:i.array(px),transactionPairs:i.optional(i.array(ga))}),yx=i.object({type:i.literal("bitcoin"),transactions:i.array(i.string()),transactionTypes:i.array(mx),transactionPairs:i.optional(i.array(ga))}),lO=i.union([fx,hx,gx,yx]),Xl;(function(t){t.Pricing="pricing",t.Provider="provider",t.ProviderPressable="providerPressable",t.ExchangeRate="exchangeRate",t.PriceImpact="priceImpact",t.Network="network",t.ExecutionDuration="executionDuration",t.Slippage="slippage",t.SlippagePressable="slippagePressable",t.Fees="fees",t.HighPriceImpact="highPriceImpact",t.HighSlippage="highSlippage",t.TransferFees="transferFees"})(Xl||(Xl={}));var nd=i.object({name:i.string(),amount:i.string()}).strict(),ya=i.object({name:i.string(),feeUsd:i.number().nullish(),amount:i.string(),time:i.object({text:i.string(),isFast:i.boolean()}),logoURI:i.string()}),dO=i.union([nd,ya]),Jl;(function(t){t.Buy="buy",t.Sell="sell"})(Jl||(Jl={}));var Yl;(function(t){t.SwapProviders="SwapProviders",t.SwapReview="SwapReview",t.SwapTermsOfService="SwapTermsOfService",t.SwapConfirmation="SwapConfirmation",t.InsufficientBalance="InsufficientBalance"})(Yl||(Yl={}));u();l();var wx=a(t=>ya.safeParse(t).success,"isBridgeProviderRow");u();l();function de(t){return rd.safeParse(t).success}a(de,"isBridgeQuote");var Qt=a(t=>ha.safeParse(t).success,"isSolanaSwapQuote"),zh=a(t=>Qt(t),"isCashSwapQuote");function rr(t){return ed.safeParse(t).success}a(rr,"isEvmSwapQuote");function _r(t){return td.safeParse(t).success}a(_r,"isSuiSwapQuote");function Qh(t){return t?"gaslessSignature"in t:!1}a(Qh,"isGaslessSwapQuote");function lr(t){return Qt(t)||rr(t)||_r(t)}a(lr,"isSingleNetworkSwapQuote");u();l();var Te;(function(t){t.Idle="idle",t.Started="started",t.Simulating="simulating",t.SimulationRequestErrored="simulationRequestErrored",t.SimulationFailed="simulationFailed",t.SimulationSkipped="simulationSkipped",t.Simulated="simulated",t.SubmittingTransaction="submittingTransaction",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionSubmitted="transactionSubmitted",t.ConfirmingTransaction="confirmingTransaction",t.TransactionNotConfirmed="transactionNotConfirmed",t.TransactionConfirmed="transactionConfirmed"})(Te||(Te={}));u();l();var X;(function(t){t.ExecuteSwapStarted="executeSwapStarted",t.SimulationRequestStarted="simulationRequestStarted",t.SimulationPassed="simulationPassed",t.SimulationFailed="simulationFailed",t.SimulationSkipped="simulationSkipped",t.SubmittingTransaction="submittingTransaction",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionSubmissionStarted="transactionSubmissionStarted",t.TransactionSubmissionSuccess="transactionSubmissionSuccess",t.TransactionConfirmationStarted="transactionConfirmationStarted",t.TransactionConfirmationFailed="transactionConfirmationFailed",t.TransactionConfirmed="transactionConfirmed"})(X||(X={}));u();l();function Tt(t){return t.type==="pair"||t.type==="changingToken"||t.type==="refreshing"}a(Tt,"hasPair");u();l();var ap=U(So());var Kt=U($());u();l();u();l();u();l();u();l();var dr="cash-account",Sx="grouped-balances",Co=[dr,Sx],sd=[dr,"cash-activity"],Ht={account:a((t,e)=>[dr,"account",{userId:t,isCashEnabled:e}],"account"),balance:a((t,e)=>[dr,"balance",{userId:t,isCashEnabled:e}],"balance"),cashKMSAccount:a(t=>[dr,"kms-account",{user:t}],"cashKMSAccount"),bankDetails:a(t=>[dr,"bankDetails",{user:t}],"bankDetails"),enrollment:a(t=>[dr,"enrollment",{userId:t}],"enrollment"),groupedBalances:a((t,e,r)=>[...Co,{userID:t,addresses:e,isCashEnabled:r}],"groupedBalances"),lastBroadcastDate:a(()=>[dr,"lastBroadcastDate"],"lastBroadcastDate"),cashActivity:a((t,e)=>[...sd,{userID:t?.userID,params:e}],"cashActivity"),waitlistEntry:a(t=>[dr,"waitlist-entry",t],"waitlistEntry"),forceVerifiedAccount:a(t=>[dr,"force-verified-account",t??""],"forceVerifiedAccount")};var wa=a(async(t,e)=>t.invalidateQueries({queryKey:Ht.balance(e)}),"invalidateCashBalance"),Hh=a(async t=>t.invalidateQueries({queryKey:Co}),"invalidateGroupedBalances"),Gh=a(async t=>t.invalidateQueries({queryKey:sd}),"invalidateCashActivity");var Vh=a(async(t,e)=>{let r=new Date().toISOString();await e.set("cash-account:lastBroadcastDate",r),t.setQueryData(Ht.lastBroadcastDate(),r),await t.invalidateQueries({queryKey:Ht.lastBroadcastDate()})},"invalidateLastBroadcastDate");u();l();u();l();u();l();var nn;(function(t){t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified",t.Suspended="suspended",t.Closed="closed"})(nn||(nn={}));var od;(function(t){t.Crypto="crypto",t.CryptoRecover="crypto_recover",t.Banking="banking",t.Fiat="fiat",t.Cards="cards",t.PaymentLinks="payment_links",t.AccountManagement="account_management"})(od||(od={}));var _o;(function(t){t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified"})(_o||(_o={}));var Fr;(function(t){t.PhantomUsername="phantom_username",t.Signup="signup",t.Tos="tos",t.Kyc="kyc",t.EmailVerification="email_verification",t.DataSharingConsent="data_sharing_consent",t.L1KycVerification="l1_kyc_verification",t.L2DocumentVerification="l2_document_verification"})(Fr||(Fr={}));var Sa;(function(t){t.Pending="pending",t.Completed="completed",t.Verified="verified",t.Failed="failed",t.Rejected="rejected",t.NotStarted="not_started",t.Expired="expired",t.NotApplicable="not_applicable"})(Sa||(Sa={}));var $h=i.nativeEnum(nn),bx=i.nativeEnum(od),jh=i.nativeEnum(_o),Tx=i.nativeEnum(Fr),Ex=i.nativeEnum(Sa),Ax=i.object({type:Tx,status:Ex.nullish().transform(O),description:i.string().nullish().transform(O),url:i.string().nullish().transform(O),errorMessage:i.string().nullish().transform(O),metadata:i.record(i.string(),i.any()).nullish().transform(O)}),ba;(function(t){t.NotStarted="not_started",t.Pending="pending",t.Failed="failed",t.Rejected="rejected",t.Verified="verified"})(ba||(ba={}));var xx=i.object({kycStartedAt:i.string().nullish().transform(O),idVerificationStatus:i.nativeEnum(ba).nullish().transform(O),kycVerificationStatus:i.nativeEnum(ba).nullish().transform(O)}),Ix=i.object({consentTimestamp:i.string().nullish().transform(O),consented:i.boolean().nullish().transform(O)}),kx=i.object({authIntentId:i.string().nullish().transform(O)}),Cx=i.object({kycMetadata:xx.nullish().transform(O),dataSharing:Ix.nullish().transform(O),authIntent:kx.nullish().transform(O)}),_x=i.object({type:i.string(),required:i.boolean(),description:i.string().nullish().transform(O)}),Fx=i.object({type:i.nativeEnum(Fr),required:i.boolean(),description:i.string(),data:i.object({type:i.union([i.literal(Fr.DataSharingConsent),i.literal(Fr.L1KycVerification),i.literal(Fr.L2DocumentVerification)]).nullish().transform(O),currentStatus:i.nativeEnum(Sa).nullish().transform(O),authIntentId:i.string().nullish().transform(O),consentRequired:i.boolean().nullish().transform(O)}).nullish().transform(O)}),us;(function(t){t.NotStarted="not_started",t.Pending="pending",t.Failed="failed",t.RegionLocked="region_locked",t.NeedsMoreInfo="needs_more_info",t.Completed="completed",t.CardReady="card_ready"})(us||(us={}));var Po=i.object({accountStatus:$h.nullish().transform(O),features:i.array(bx).optional().default([]),availableTransitions:i.array($h).optional().default([]),canAdvance:i.boolean().optional().default(!1),currentTier:jh.nullish().transform(O),nextTier:jh.nullish().transform(O),nextTierDescription:i.string().nullish().transform(O),nextTierRequirements:i.array(Ax).optional().default([]),nextTierRequiredFields:i.record(i.string(),_x).nullish().transform(O),nextSteps:i.array(Fx).optional().default([]),verificationState:i.nativeEnum(us).nullish().transform(O),metadata:Cx.nullish().transform(O)}),Fo=class extends Error{static{a(this,"EnrollmentNotFoundError")}constructor(e){super(`Enrollment data not found for user ${e}. User is not enrolled.`),this.name="EnrollmentNotFoundError"}},Ta=class extends Error{static{a(this,"EnrollmentValidationError")}zodError;responseData;constructor(e,r){let n=e.issues.map(s=>`${s.path.length>0?s.path.join("."):"root"}: ${s.message}`).join("; ");super(`Enrollment validation failed: ${n}`),this.name="EnrollmentValidationError",this.zodError=e,this.responseData=r}};var _a=bo,id;(function(t){t.NotSubmitted="not_submitted",t.Accepted="accepted",t.NotAccepted="not_accepted"})(id||(id={}));var ad;(function(t){t.NotSubmitted="not_submitted",t.Incomplete="incomplete",t.PendingReview="pending",t.Approved="approved",t.Rejected="rejected"})(ad||(ad={}));var cd;(function(t){t.Crypto="crypto",t.CryptoRecover="crypto_recover",t.Banking="banking",t.Fiat="fiat",t.Cards="cards",t.PaymentLinks="payment_links",t.AccountManagement="account_management"})(cd||(cd={}));var Px=a(t=>Object.values(cd).includes(t),"canUseCashAccountFeature"),Be;(function(t){t.Pending="pending",t.Processing="processing",t.Completed="completed",t.Refunded="refunded",t.Failed="failed",t.Canceled="canceled",t.Unknown="unknown"})(Be||(Be={}));var Ea;(function(t){t.Debit="debit",t.Credit="credit"})(Ea||(Ea={}));var Aa;(function(t){t.Transfer="transfer",t.Swap="swap",t.PerpsFunding="perps_funding",t.Refund="refund",t.KycUpdate="kyc_update",t.AccountUpdate="account_update",t.Microdeposit="microdeposit",t.UserCardLock="user_card_lock",t.UserCardUnlock="user_card_unlock",t.PhantomCardLock="phantom_card_lock",t.PhantomCardUnlock="phantom_card_unlock",t.CardTransaction="card_transaction",t.CardPinUpdated="card_pin_updated",t.Onramp="onramp",t.Delegation="delegation",t.Recovery="recovery",t.Unknown="unknown"})(Aa||(Aa={}));var ls=class extends Error{static{a(this,"CashAccountNotFoundError")}constructor(e){super(`Cash account not found for user ${e}. User is not enrolled in cash account.`),this.name="CashAccountNotFoundError"}},xa=class extends Error{static{a(this,"CashAccountValidationError")}zodError;responseData;constructor(e,r){let n=e.issues.map(s=>`${s.path.length>0?s.path.join("."):"root"}: ${s.message}`).join("; ");super(`Cash account validation failed: ${n}`),this.name="CashAccountValidationError",this.zodError=e,this.responseData=r}},Fa=i.object({id:i.string(),primaryEmail:i.string().nullish().transform(O),accountStatus:i.string().nullish().transform(O),createdAt:i.string().nullish().transform(O),addressDetails:i.object({address:i.string()}),features:i.array(i.string()).transform(t=>t.filter(Px)),limits:i.object({dailyFiatTransfer:i.string().nullish().transform(O),monthlyFiatTransfer:i.string().nullish().transform(O)}).nullish().transform(O),waitlistDetails:i.object({waitlist:i.boolean(),priorityWaitlist:i.boolean()}).nullish().transform(O),isRegionLocked:i.boolean().nullish().transform(O),linkDetails:i.object({cryptoCustomerId:i.string().nullish().transform(O),authIntentId:i.string().nullish().transform(O),linkEmail:i.string().nullish().transform(O)}).nullish().transform(O),authFactor:i.object({type:i.enum(["s","pk","sl"]).nullish().transform(O),solanaAddresses:i.array(i.string()).nullish().transform(O),publicKey:i.string().nullish().transform(O),orgId:i.string().nullish().transform(O),tag:i.string().nullish().transform(O),walletId:i.string().nullish().transform(O)}).nullish().transform(O)});var tU=i.object({sourceCurrency:i.string().nullish().transform(O),destinationCurrency:i.string().nullish().transform(O),destinationBlockchain:i.string().nullish().transform(O),destinationAddress:i.string().nullish().transform(O),accountNumber:i.string().nullish().transform(O),routingNumber:i.string().nullish().transform(O),accountType:i.string().nullish().transform(O),bankName:i.string().nullish().transform(O),bankAddress:i.string().nullish().transform(O),bankBeneficiaryName:i.string().transform(gf).nullish().transform(O),bankBeneficiaryAddress:i.string().nullish().transform(O)}),vx=i.object({price:i.number(),priceChange24h:i.number(),lastUpdatedAt:i.string().transform(t=>new Date(t))}),Rx=i.object({account:i.string(),quantity:i.number(),quantityString:i.string()}),Dx=i.object({address:i.string(),quantity:i.number(),quantityString:i.string(),lastTransferredDate:i.string().nullish().transform(O),subaccounts:i.array(Rx).nullish().transform(O)}),Nx=i.object({isMutable:i.boolean().nullish().transform(O),creators:i.array(i.string()).nullish().transform(O),tokenProgram:i.string().nullish().transform(O),extensions:i.array(i.any()).nullish().transform(O),compression:i.record(i.any()).nullish().transform(O)}),rU=i.object({caip19:i.string(),name:i.string(),symbol:i.string(),decimals:i.number(),spamStatus:_a.nullish().default(null),logoUri:i.string().nullish().default(""),totalQuantity:i.number(),totalQuantityString:i.string(),price:vx.nullish().transform(O),queriedWalletBalances:i.array(Dx),extraMetadata:Nx}),nU=i.object({email:i.string().email(),cashAccountAddress:i.string(),idempotencyKey:i.string()}),sU=i.object({enrollmentDetails:i.object({kycStatus:i.nativeEnum(ad),kycUrl:i.string(),tosStatus:i.nativeEnum(id),tosUrl:i.string()})}),Ia;(function(t){t.TRANSFER_TO_BANK="transfer_to_bank",t.TRANSFER_TO_USERNAME="transfer_to_username",t.TRANSFER_TO_WALLET="transfer_to_wallet",t.WITHDRAWAL_TO_WALLET="withdrawal_to_wallet",t.SELL_TOKENS="sell_tokens",t.CARD_BANK_DEPOSIT="card_bank_deposit",t.VIRTUAL_ACCOUNT_DEPOSIT="virtual_account_deposit",t.DELEGATE_WALLET_ACCOUNT="delegate_wallet_account"})(Ia||(Ia={}));var Bx=i.object({account:i.string(),quantity:i.number(),quantityString:i.string()}),Lx=i.object({address:i.string(),quantity:i.number(),quantityString:i.string(),lastTransferredDate:i.string().nullish().transform(O),subaccounts:i.array(Bx).nullish().transform(O)}),Ox=i.object({isMutable:i.boolean().nullish().default(null),creators:i.array(i.unknown()).nullish().transform(O),tokenProgram:i.string().nullish().transform(O),extensions:i.array(i.unknown()).nullish().transform(O)}),Kh=i.object({caip19:i.string(),name:i.string(),symbol:i.string(),decimals:i.number(),logoUri:i.string(),spamStatus:_a,totalQuantity:i.number(),totalQuantityString:i.string(),queriedWalletBalances:i.array(Lx),extraMetadata:Ox.nullish().transform(O),price:i.object({price:i.number(),priceChange24h:i.number().nullish().transform(O),lastUpdatedAt:i.coerce.date(),marketCap:i.number().nullish().transform(O)}).nullish()}),oU=i.object({stablecoins:i.array(Kh),otherTokens:i.array(Kh),totalStablecoinsValueUsd:i.string().nullish().transform(O),totalOtherTokensValueUsd:i.string().nullish().transform(O)}),ka;(function(t){t.UNVERIFIED="unverified",t.VERIFIED="verified"})(ka||(ka={}));var Wh;(function(t){t.AlreadyExists="already_exists",t.InProgress="in_progress",t.Pending="pending",t.Completed="completed"})(Wh||(Wh={}));var Ux=i.object({targetState:i.nativeEnum(ka),data:i.object({email:i.string().email().optional(),cashAccountAddress:i.string().optional()}),idempotencyKey:i.string().optional()}),Mx=Po.extend({account:Fa}),qx=i.object({requirementType:i.nativeEnum(Fr),evidence:i.object({authIntentId:i.string(),providerCustomerId:i.string(),dataSharing:i.object({consented:i.boolean()})})}),zx=Po.extend({account:Fa}),pr;(function(t){t.BankAccountId="bank_account_id",t.Bank="bank",t.Crypto="crypto",t.PhantomUsername="phantom_username",t.Merchant="merchant",t.PaymentCard="payment_card"})(pr||(pr={}));var Qx=i.nativeEnum(pr),Hx=i.object({type:i.literal("fiat"),currency:i.string(),value:i.string()}),Gx=i.object({type:i.literal("token"),token:i.string(),symbol:i.string(),value:i.string(),decimals:i.number()}),Jh=i.discriminatedUnion("type",[Hx,Gx]),Zh;(function(t){t.Fiat="fiat",t.Token="token"})(Zh||(Zh={}));var Vx=i.record(i.string(),Jh),Yh=i.object({accountHolderName:i.string().nullish().transform(O),accountNumber:i.string().nullish().transform(O),accountType:i.string().nullish().transform(O),bankName:i.string().nullish().transform(O),nickname:i.string().nullish().transform(O)}),ds=i.object({type:Qx,currency:i.string(),name:i.string().nullish().transform(O),phantomUsername:i.string().nullish().transform(O)}),$x=ds.extend({type:i.literal(pr.BankAccountId),bankDetails:Yh.nullish().transform(O)}),jx=ds.extend({type:i.literal(pr.Bank),bankDetails:Yh.nullish().transform(O)}),Kx=ds.extend({type:i.literal(pr.Crypto),address:i.string().nullish().transform(O),phantomUsername:i.string().nullish().transform(O)}),Wx=i.object({merchantName:i.string().nullish().transform(O),merchantCategoryCode:i.string().nullish().transform(O)}),Zx=i.object({name:i.string().nullish().transform(O),categoryPrimary:i.string().nullish().transform(O),categoryDetailed:i.string().nullish().transform(O),icon:i.string().nullish().transform(O),website:i.string().nullish().transform(O),location:i.any().nullish().transform(O)}),Xx=ds.extend({type:i.literal(pr.Merchant),merchantDetails:Wx.nullish().transform(O),enrichedMerchantDetails:Zx.nullish().transform(O),category:i.string().nullish().transform(O),icon:i.string().nullish().transform(O),website:i.string().nullish().transform(O)}),ud;(function(t){t.Following="following"})(ud||(ud={}));var Jx=ds.extend({type:i.literal(pr.PhantomUsername),phantomUsername:i.string().nullish().transform(O),icon:i.string().nullish().transform(O),relationship:i.nativeEnum(ud).nullish().transform(O)}),Yx=ds.extend({type:i.literal(pr.PaymentCard),paymentRail:i.string().nullish().transform(O),displayLabel:i.string().nullish().transform(O)}),eI=i.union([$x,jx,Kx,Jx,Xx,Yx]),Xh=i.object({amount:i.string(),decimals:i.number(),logoUri:i.string().nullish().transform(O),mint:i.string(),name:i.string().nullish().transform(O),owner:i.string(),symbol:i.string().nullish().transform(O),spamStatus:_a.nullish().transform(O)}),In;(function(t){t.CashOut="cash_out",t.Swap="swap"})(In||(In={}));var tI=i.object({input:Xh,output:Xh,quoteId:i.string().nullish().transform(O),quoteSource:i.string().nullish().transform(O),type:i.nativeEnum(In).nullish().transform(O)}),iU=i.object({type:i.nativeEnum(Aa),id:i.string(),state:i.nativeEnum(Be),occurredAt:i.string(),counterparty:eI,direction:i.nativeEnum(Ea),amount:Jh,feeBreakdown:Vx.nullish().default(null),spamStatus:_a.nullish().transform(O),metadata:i.object({swapInfo:tI.nullish().default(null),merchant:i.any().nullish().default(null),enrichment:i.object({lastEnrichedAt:i.string().nullish().transform(O),source:i.string().nullish().transform(O)}).nullish().transform(O)}).nullish().default(null),onchainTxId:i.string().nullish().transform(O)}),Ca;(function(t){t.PENDING="pending",t.ACTIVATED="activated",t.REJECTED="rejected"})(Ca||(Ca={}));var vo;(function(t){t.EXTERNAL="external",t.USER="user"})(vo||(vo={}));var rI=a(t=>Object.values(Ca).includes(t),"canUseWaitlistStatus"),nI=a(t=>Object.values(vo).includes(t),"canUseWaitlistSource"),aU=i.object({email:i.string().email(),country:i.string().length(2).nullish().transform(O),state:i.string().nullish().transform(O),referralCode:i.string().nullish().transform(O),marketingOptIn:i.boolean().default(!0),source:i.string().refine(nI).default(vo.USER)}),cU=i.object({id:i.string(),referralCode:i.string(),position:i.number().nullish().transform(O)}),uU=i.object({id:i.string(),referralBoost:i.number(),referralCode:i.string(),referralCount:i.number(),status:i.string().refine(rI)});u();l();u();l();var eg=a(t=>{if(!t?.accountStatus)return!1;let{accountStatus:e}=t;return e===nn.Unverified||e===nn.Verified},"hasCashAccount");u();l();var sg=U($());u();l();u();l();u();l();var sI=a(t=>t.join(":"),"deriveStorageKey");function tg(t,e){let r=Ke(),n=sI(t);return ne({queryKey:t,queryFn:a(async()=>{try{return await r.get(n)??e}catch{return e}},"queryFn")})}a(tg,"useStoredValue");function rg(t){let e=tg(t,!1);return{...e,data:!!e.data}}a(rg,"useStoredBoolean");var ng=a(()=>{let t=Sf();return rg(Ht.forceVerifiedAccount(t))},"useForceVerifiedAccount");var oI=K({seconds:5}),og=a(t=>{let{data:e}=Vi(),{userID:r}=e??{},{data:n=!1}=ng(),s=iI();return ne({...t,queryKey:Ht.enrollment(r),queryFn:r?async()=>{try{let o=await H.api().bearer(!0).get(`/cash/v1/users/${r}/cash-account/enrollment`);if(o.status===204||o.status===404)throw new Fo(r);if(o.status===403)throw new Error(`Access denied to enrollment data for user ${r}`);let c=Po.safeParse(o.data);if(!c.success)throw new Ta(c.error,o.data);return c.data}catch(o){throw o instanceof Fo||(await s(),E.captureError(o,I.Cash)),o}}:rf,select:a(o=>n?{...o,accountStatus:nn.Verified,currentTier:_o.Verified,canAdvance:!1,nextTier:void 0,verificationState:us.Completed}:o,"select"),retry:!0,retryDelay:oI})},"useEnrollment");function iI(){let t=Wr(),e=Pe();return(0,sg.useCallback)(async()=>{E.addBreadcrumb(I.Cash,"Invalidating auth for cash due to 401",F.Debug),await t.logOut(),await Promise.all([yf(e),Ef(e)]),await Promise.all([wf(e),Af(e)])},[t,e])}a(iI,"useInvalidateAuthIfNeeded");var ld=a(()=>{let{data:t,isPending:e}=og();return{hasCashAccount:eg(t),isLoading:e}},"useHasCashAccount");var Ro=a(t=>{let{data:e}=Vi(),{userID:r}=e??{},{canUseCash:n}=If(),s=n&&bt!=="extension",{data:o}=xf(),c=!!o?.username,{hasCashAccount:d}=ld(),m=!!(r&&t?.enabled!==!1&&s&&c);return ne({...t,queryKey:Ht.account(r,s),enabled:m,queryFn:a(async()=>{if(!r)throw new Error("useCashAccount: userID is required");let p=r;try{if(!d)throw new ls(r);let f=await H.api().bearer(!0).get(`/cash/v1/users/${p}/cash-account`),g=Fa.safeParse(f.data);if(!g.success)throw new xa(g.error,f.data);return g.data}catch(f){switch(f?.response?.status||f?.response?.data?.statusCode){case 204:case 404:case 403:throw new ls(p);default:break}throw f instanceof ls||E.captureError(f,I.Cash),f}},"queryFn")})},"useCashAccount");u();l();var aI=U($());var cI=a((t,e,r)=>{let n=a(c=>{if(c.caip19!==e)return c;let m=new b(c.totalQuantity).plus(r),p=m.isLessThan(0)?new b(0):m;return{...c,totalQuantity:p.toNumber(),totalQuantityString:p.toString(),queriedWalletBalances:c.queriedWalletBalances}},"updateTokenBalance"),s=t.stablecoins.some(c=>c.caip19===e),o=t.otherTokens.some(c=>c.caip19===e);return!s&&!o?t:{...t,stablecoins:s?t.stablecoins.map(n):t.stablecoins,otherTokens:o?t.otherTokens.map(n):t.otherTokens}},"transformGroupedBalances");function dd(t,e,r){t.getQueriesData({queryKey:Co,exact:!1}).forEach(([s,o])=>{if(o){let c=cI(o,e,r);t.setQueryData(s,c)}})}a(dd,"updateGroupedBalances");u();l();u();l();function pd(t,e,r){if($r("kill-cash-balance-optimistic-update")||!r)return;let s=Ht.balance(r,!0);t.setQueryData(s,o=>{if(!o)return o;let d=new b(o.totalQuantity).plus(e);return{...o,totalQuantity:d.toNumber(),totalQuantityString:d.toString()}}),wa(t,r)}a(pd,"updateCashBalance");var uI=K({seconds:3}),md=a(async({queryClient:t,storage:e,authRepository:r,sellCaip19:n,sellAddress:s,sellAmountBN:o,buyCaip19:c,buyAddress:d,buyAmountBN:m,cashAccountAddress:p})=>{let g=(await r.getUser())?.userID??"";dI({queryClient:t,sellCaip19:n,sellAmountBN:o,sellAddress:s,buyCaip19:c,buyAmountBN:m,buyAddress:d,cashAccountAddress:p,userId:g}),await Vh(t,e),await new Promise(w=>setTimeout(w,uI)),await lI(t,g)},"invalidateCashSwap"),lI=a(async(t,e)=>Promise.all([Hh(t),wa(t,e),Gh(t)]),"invalidateCashSwapQueries"),dI=a(({queryClient:t,sellCaip19:e,sellAmountBN:r,sellAddress:n,buyCaip19:s,buyAmountBN:o,buyAddress:c,cashAccountAddress:d,userId:m})=>{if(!m)return;let p=D(e),f=D(s);d&&n===d?pd(t,r.negated(),m):dd(t,p,r.negated()),d&&c===d?pd(t,o,m):dd(t,f,o),pI({sellCaip19:e,sellAmountBN:r,sellAddress:n,buyCaip19:s,buyAmountBN:o,buyAddress:c,cashAccountAddress:d})},"optimisticUpdate"),pI=a(({sellCaip19:t,sellAmountBN:e,sellAddress:r,buyCaip19:n,buyAmountBN:s,buyAddress:o,cashAccountAddress:c})=>{let d=$r("kill-cash-balance-optimistic-update");r===c?E.addBreadcrumb(I.Cash,`[optimisticUpdate] buying ${s.toString()} ${n} w/ ${e.toString()} cash, isKillSwitchEnabled: ${d}`,F.Debug):o===c?E.addBreadcrumb(I.Cash,`[optimisticUpdate] buying ${s.toString()} (cash) w/ ${e.toString()} ${t}, isKillSwitchEnabled: ${d}`,F.Debug,{amount:s.toString()}):E.addBreadcrumb(I.Cash,`[optimisticUpdate] [non-cash] buying ${s.toString()} ${n} w/ ${e.toString()} ${t}`,F.Debug)},"logOptimisticUpdate");var ig=U($());u();l();var Do=a(t=>{let e=t?.addressDetails?.address;return e?{[te.Solana.Mainnet]:e}:{}},"createSwapperCashAddresses");var ag=a(()=>{let{data:t}=Ro();return(0,ig.useMemo)(()=>Do(t),[t])},"useSwapperCashAddresses");u();l();u();l();u();l();u();l();var nr;(function(t){t.SwapperNoQuotes="SwapperNoQuotes",t.InsufficientSellAmount="InsufficientSellAmount",t.CrossChainUnavailable="CrossChainUnavailable",t.TokenNotTradable="TokenNotTradable",t.NotEnoughSuiObjects="NotEnoughSuiObjects",t.FromTokenIsHoneyPotToken="FromTokenIsHoneyPotToken",t.ToTokenIsHoneyPotToken="ToTokenIsHoneyPotToken",t.InsufficientLiquidity="InsufficientLiquidity",t.SwapInitializationFailed="SwapInitializationFailed",t.pSolHighImpactError="pSolHighImpactError",t.TokenizedStocksUnavailableForJurisdiction="TokenizedStocksUnavailableForJurisdiction"})(nr||(nr={}));var mI="tokenized-stocks-georestriction",Pa=class t extends Error{static{a(this,"QuoteError")}name;type;constructor(e,r,n){super(r),this.name=e,this.type=n}static fromErrorResponse(e,r){return e.toLowerCase()===mI?new t(nr.TokenizedStocksUnavailableForJurisdiction,r,nr.TokenizedStocksUnavailableForJurisdiction):a(s=>Object.values(nr).includes(s),"isValidType")(e)?new t(e,r,e):new t(e,r)}};var fI=[nr.SwapperNoQuotes,nr.InsufficientLiquidity,nr.TokenNotTradable,nr.CrossChainUnavailable,nr.InsufficientSellAmount,"UnsupportedCountry","UnknownError"],fd=a(t=>t instanceof We&&fI.includes(t.code),"shouldSkipTelemetry"),cg=a((t,e,r,n)=>{fd(t)||(!e||e>=400&&e<500)&&E.addBreadcrumb(r,JSON.stringify(n),F.Info)},"captureClientError");u();l();var ug=a(async(t,e,r=void 0)=>{if(ee(t))return Promise.resolve();let n;try{n=t.data}catch{throw new We({key:r})}let s=ma.safeParse(n);throw s.success?(E.addBreadcrumb(e,JSON.stringify(s.data),F.Info),new We({key:s.data.name})):new We({key:r})},"handleBadResponse");u();l();var lg=a(t=>{let e=new We({key:"SwapperNoQuotes"});if(Io.safeParse(t?.type).success===!1)throw E.captureError(new Error("Failed to parse a valid quote type."),I.Swapper),new Error("Invalid input");let r=ko.safeParse(t);if(!r.success)throw E.captureError(new Error("Failed to parse a valid swap quotes response."),I.Swapper),e;if(r.data.quotes.length===0)throw e;return r.data},"parseSwapQuotesResponse");var dg="swap-quotes";async function va({sellTokenCaip19:t,buyTokenCaip19:e,taker:r,takerDestination:n,exactOut:s,sellAmount:o,sellAmountUsd:c,slippageTolerance:d,signal:m,enableAutoSlippage:p,priorityFee:f,tipAmount:g,phantomCashAccount:w,isPrediction:y,predictions:S}){let x;try{wo(r)&&(r.address=r.address.toLowerCase()),n&&wo(n)&&(n.address=n.address.toLowerCase()),wo(e)&&(e.address=e.address.toLowerCase()),wo(t)&&(t.address=t.address.toLowerCase());let T="/swap/v2/quotes",_={sellToken:t,buyToken:e,taker:r,takerDestination:n,exactOut:s,sellAmount:o,sellAmountUsd:c,slippageTolerance:d,autoSlippage:p,priorityFee:f,tipAmount:g,phantomCashAccount:w,isPrediction:y,predictions:S},k=await H.api().post(T,_,{signal:m});return x=k.status,await ug(k,dg,"SwapperNoQuotes"),lg(k.data)}catch(T){let _=T instanceof We?T:new We;throw cg(_,x,dg,{sellToken:t,buyToken:e,sellAmount:o,sellAmountUsd:c,slippageTolerance:d}),_}}a(va,"getSwapQuotes");var Ra=class{static{a(this,"WalletSwapApiClient")}getQuotes(e){return va({sellTokenCaip19:e.sell,buyTokenCaip19:e.buy,taker:e.taker,takerDestination:e.takerDestination,sellAmount:e.amount,sellAmountUsd:e.amountUsd,slippageTolerance:e.slippageTolerance,signal:e.signal,exactOut:e.exactOutEnabled,priorityFee:e.priorityFee,tipAmount:e.tipAmount,enableAutoSlippage:e.autoSlippageEnabled,phantomCashAccount:e.phantomCashAccount})}};u();l();u();l();var Da=class{static{a(this,"BridgeTrackingSwapCommand")}inner;bridgeStatusManager;executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,n){this.inner=e,this.bridgeStatusManager=r,this.executingQuote=n,this.takerAddress=e.takerAddress,this.networkId=e.networkId,this.quote=e.quote,this.executionId=e.executionId}createTransaction(){return this.inner.createTransaction()}swap(e,r,n,s,o){return this.inner.swap(e,r,n,s,o)}async waitForConfirmation(e){await this.bridgeStatusManager.track({executionId:this.executionId,executingQuote:this.executingQuote,transactionHash:e.id}),await this.inner.waitForConfirmation(e)}};u();l();u();l();u();l();var It="swapper",tt;(function(t){t.quotes="quotes",t.transactions="transactions",t.slippageTolerance="slippageTolerance",t.priorityFee="priorityFee",t.tipAmount="tipAmount",t.presence="presence",t.lastSubmittedPairs="lastSubmittedPairsV2",t.lastSelectedTokens="lastSelectedTokens",t.slippageSettings="slippageSettings",t.priorityFeeSettings="priorityFeeSettings",t.tipSettings="tipSettings",t.hasViewedAutoSlippageOptIn="hasViewedAutoSlippageOptIn",t.optimisticUpdates="optimisticUpdates",t.autoSlippageMigrationVersion="autoSlippageMigrationVersion"})(tt||(tt={}));var pg=[It,tt.quotes],pe={quotesScope:a(()=>pg,"quotesScope"),quotes:a(({sellTokenCaip19:t,buyTokenCaip19:e,taker:r,amountValue:n,amountType:s,slippageTolerance:o,priorityFee:c,tipAmount:d,takerDestination:m,enableAutoSlippage:p,preferredProvider:f,phantomCashAccount:g})=>[...pg,{sellToken:t,buyToken:e,taker:r,takerDestination:m,amountValue:n,amountType:s,slippageTolerance:o,priorityFee:c,tipAmount:d,enableAutoSlippage:p,preferredProvider:f,phantomCashAccount:g}],"quotes"),transactions:a(t=>[It,tt.transactions,t],"transactions"),presence:a(t=>[It,tt.presence,t],"presence"),slippageTolerance:a(()=>[It,tt.slippageTolerance],"slippageTolerance"),priorityFee:a(()=>[It,tt.priorityFee],"priorityFee"),tipAmount:a(()=>[It,tt.tipAmount],"tipAmount"),lastSubmittedPairs:a(()=>[It,tt.lastSubmittedPairs],"lastSubmittedPairs"),lastSelectedTokens:a(()=>[It,tt.lastSelectedTokens],"lastSelectedTokens"),slippageSettings:a(()=>[It,tt.slippageSettings],"slippageSettings"),priorityFeeSettings:a(()=>[It,tt.priorityFeeSettings],"priorityFeeSettings"),tipSettings:a(()=>[It,tt.tipSettings],"tipSettings"),hasViewedAutoSlippageOptIn:a(()=>[It,tt.hasViewedAutoSlippageOptIn],"hasViewedAutoSlippageOptIn"),optimisticUpdates:a(()=>[It,tt.optimisticUpdates],"optimisticUpdates"),autoSlippageMigrationVersion:a(()=>[It,tt.autoSlippageMigrationVersion],"autoSlippageMigrationVersion")};u();l();var Na;(function(t){t[t.Always=1/0]="Always",t[t.Short=K({days:1})]="Short",t[t.Medium=K({days:3})]="Medium",t[t.Long=K({days:7})]="Long"})(Na||(Na={}));var Ba;(function(t){t[t.Immediate=0]="Immediate",t[t.Short=K({minutes:1})]="Short",t[t.Medium=K({minutes:2.5})]="Medium",t[t.Long=K({minutes:60})]="Long",t[t.Never=1/0]="Never"})(Ba||(Ba={}));var ps;(function(t){t[t.Short=K({seconds:20})]="Short",t[t.Medium=K({minutes:2.5})]="Medium",t[t.Long=K({minutes:5})]="Long"})(ps||(ps={}));var mg=a(async({callerAddress:t,contractAddress:e,networkId:r,sellAmount:n,allowanceTarget:s,approvalExactAmount:o,exchangeAddress:c,value:d,transactionData:m,type:p})=>{let f=[],g=[];if(e&&(await Hf({callerAddress:t,spender:s,networkId:r,contractAddress:e})).lt(o??n.toString())){let S=await Gf({callerAddress:t,spender:s,networkId:r,contractAddress:e,exactAmount:o});f.push(S),g.push(`${p}-approval`)}let w=Xn.parse({type:Wm.eip1559,from:t,data:m,chainId:A.getEVMNetworkIDValue(r),to:c,...d==="0"?{}:{value:`0x${new V(d).toString(16)}`}});return f.push(w),g.push(p),{transactions:f,transactionTypes:g}},"createEVMTransactions"),No=a(async({networkId:t,callerAddress:e,quote:r})=>{let{sellAmount:n,steps:s}=r,o=[],c=[],d=[];for(let m of s){let{allowanceTarget:p,exchangeAddress:f,value:g,transactionData:w,sellToken:y,buyToken:S,approvalMetadata:x}=m,T=y.resourceType===W.address?y.address:null,_=A.compareNetworkID(y.chainId,S.chainId)===0?"swap":"bridge";if(!p||!f||!w||!g)throw new Error("Missing bridge step data for EVM bridge quote.");let k=await mg({callerAddress:e,contractAddress:T,networkId:t,sellAmount:n,allowanceTarget:p,approvalExactAmount:m.approvalExactAmount,exchangeAddress:f,value:g,transactionData:w,type:_});o.push(...k.transactions),c.push(...k.transactionTypes),d.push({sellToken:y,buyToken:S,approvalMetadata:x}),k.transactionTypes.length==2&&k.transactionTypes.find(P=>P.includes("approval"))&&d.push({sellToken:y,buyToken:S,approvalMetadata:x})}return{type:"evm",transactions:o,transactionTypes:c,transactionPairs:d}},"processEVMBridgeQuote"),Bo=a(async({quote:t,connection:e})=>{let r=[],n=[],s=[];for(let o of t.steps){let{transactionData:c,sellToken:d,buyToken:m}=o,p=A.compareNetworkID(d.chainId,m.chainId)===0?"swap":"bridge",f=await fg(c,e);r.push(Ul.serialize(f).transaction),n.push(p),s.push({sellToken:d,buyToken:m})}return{type:"solana",transactions:r,transactionTypes:n,transactionPairs:s}},"processSolanaBridgeQuote"),Lo=a(async({networkId:t,callerAddress:e,quote:r,sellFungible:n})=>{let s=n.type===ae.ERC20&&n?.data.tokenAddress?n.data.tokenAddress:null,{allowanceTarget:o,exchangeAddress:c,sellAmount:d,value:m}=r;return{type:"evm",...await mg({callerAddress:e,contractAddress:s,networkId:t,sellAmount:d,allowanceTarget:o,exchangeAddress:c,value:m,transactionData:r.transactionData,type:"swap"})}},"processEVMSwapQuote"),Oo=a(async({quote:t})=>{let e=[],r=[],n=[];for(let s of t.steps){let{transactionData:o,sellToken:c,buyToken:d}=s,m=A.compareNetworkID(c.chainId,d.chainId)===0?"swap":"bridge";e.push(o),r.push(m),n.push({sellToken:c,buyToken:d})}return{type:"sui",transactions:e,transactionTypes:r,transactionPairs:n}},"processSuiBridgeQuote"),La=a(async({quote:t})=>{let e=[],r=[],n=[];for(let s of t.steps){let{transactionData:o,sellToken:c,buyToken:d}=s;e.push(o),r.push("bridge"),n.push({sellToken:c,buyToken:d})}return{type:"bitcoin",transactions:e,transactionTypes:r,transactionPairs:n}},"processBitcoinBridgeQuote"),fg=a(async(t,e)=>{let r=mt(t,"bs58");return await Yi(r,{connection:e,transactionType:rs.Swap})},"addPriorityFeeToEncodedTx"),ms=a(async({quote:t,connection:e})=>{let r=t.transactionData.map(c=>fg(c,e)),s=(await Promise.all(r)).map(c=>Ul.serialize(c).transaction);return{type:"solana",transactionTypes:s.map(()=>"swap"),transactions:s}},"processSolanaSwapQuote"),hg=a(async({quote:t,connection:e})=>ms({quote:t,connection:e}),"processCashSwapQuote"),Uo=a(async({quote:t})=>({type:"sui",transactionTypes:Array(t.transactionData.length).fill("swap"),transactions:t.transactionData}),"processSuiSwapQuote"),fs=a(({callerAddress:t,sellFungible:e,quote:r})=>{let{connection:n}=tn(),s=pe.transactions(r);return ne({queryKey:s,enabled:!!r&&!!e,gcTime:0,staleTime:0,refetchInterval:ps.Short,async queryFn(){try{if(!r)throw new Error("Missing quote");if(!e)throw new Error("Missing sell token");let o=e.data.chain.id;if(lr(r)){if(A.isEVMNetworkID(o)&&rr(r))return await Lo({networkId:o,callerAddress:t,quote:r,sellFungible:e});if(A.isSolanaNetworkID(o)&&Qt(r))return ms({quote:r,connection:n});if(A.isSuiNetworkID(o)&&_r(r))return Uo({quote:r});throw new Error(`Single network swap quote not supported for network ID ${o}`)}if(de(r)){if(A.isEVMNetworkID(o))return await No({networkId:o,callerAddress:t,quote:r});if(A.isSolanaNetworkID(o))return await Bo({quote:r,connection:n});if(A.isSuiNetworkID(o))return await Oo({quote:r});throw new Error(`Bridge quote not supported for network ID ${o}`)}throw new Error("Swap quote type not supported")}catch(o){throw o instanceof Error&&E.captureError(o,I.Swapper),o}}})},"useSwapTransactions");u();l();var sn=U(Xm());u();l();var Tg=U($());u();l();var gg=U($());u();l();function ve(t){let e=t.reduce((r,n)=>r.add(n.name),new Set);return Array.from(e).join(" + ")}a(ve,"parseSwapSources");function yg(t){return(0,gg.useMemo)(()=>ve(t),[t])}a(yg,"useProvider");u();l();var Sg=U($());u();l();var Mo=U($());var wg=a(()=>{let[t,e]=(0,Mo.useState)(!1),r=j(m=>m.selectedProviderIndex),n=j(m=>m.selectedBaseProvider),s=j(m=>m.quoteResponse),o=(0,Mo.useMemo)(()=>s?s.quotes:[],[s]),c=(0,Mo.useMemo)(()=>{if(go){if(!s||s.quotes.length===0)return 0;let m=hI(s,n);return m===-1?(e(n!==xo),0):(e(!1),m)}return r},[s,n,r]),d=o.length>0?o[c]:void 0;return{selectedQuoteIndex:c,selectedBaseProvider:go?n:"",currentQuote:d,hasDefaultedToBestQuote:t}},"useSelectedQuote"),hI=a((t,e)=>t.quotes.findIndex(r=>r.baseProvider.id===e),"getQuoteIndexByProvider");function Ie(){let t=j(p=>p.quoteResponse),e=j(p=>p.hasNoRoutes),r=j(p=>p.isFetchingQuote),n=(0,Sg.useMemo)(()=>t?t.quotes:[],[t]),s=n[0]?.buyAmount??"",{selectedQuoteIndex:o,selectedBaseProvider:c,currentQuote:d,hasDefaultedToBestQuote:m}=wg();return{bestBuyAmount:s,currentQuote:d,hasNoRoutes:e,quoteResponse:t,quotes:n,selectedProviderIndex:o,selectedBaseProvider:c,isFetchingQuote:r,hasDefaultedToBestQuote:m}}a(Ie,"useQuote");u();l();u();l();var hs=a(t=>t.steps.map(e=>e.tool),"getBridgeTools");var Le=a(t=>t?de(t)?hs(t):t?.sources??[]:[],"getSwapQuoteSources");function Eg({sender:t}){let{t:e}=Kr(),{currentQuote:r}=Ie(),n=j(g=>g.buyFungible),s=j(g=>g.sellFungible),o=yg(Le(r)),{data:c}=fs({callerAddress:t,quote:r,sellFungible:s}),d=c?.transactionPairs?.flatMap(g=>[...En(g.sellToken)??[],...En(g.buyToken)??[]])??[],m=[...new Set(d)],{fungibles:p}=is({keys:m});return{pendingActivityRows:(0,Tg.useMemo)(()=>sr({swapTransactions:c,sellFungible:s,buyFungible:n,fungibles:p,t:e,currentQuote:r,provider:o}),[c,s,n,p,e,r,o])}}a(Eg,"usePendingActivity");function sr({swapTransactions:t,sellFungible:e,buyFungible:r,fungibles:n,currentQuote:s,provider:o,t:c}){let d={pendingSwapActivityRows:[],pendingApprovalActivityRows:[]};return t?t.type==="evm"?t.transactionTypes.reduce((m,p,f)=>{let g=e,w=r,y,S=t.transactionPairs;if(S&&S[f]){let x=S[f];g=Oa(x.sellToken,n)??e,w=Oa(x.buyToken,n)??r,y=x.approvalMetadata}if(p.includes("approval")){let x=g?.data.symbol??"";m.pendingApprovalActivityRows.push({topLeft:y?{text:`${c("transactionsPendingApproving")} ${y.symbol}`}:{text:`${c("transactionsPendingApproving")} ${x}`}})}else g&&w&&m.pendingSwapActivityRows.push(bg({sellFungible:g,buyFungible:w,sellAmount:s?.sellAmount,buyAmount:s?.buyAmount,provider:o,isBridge:p.includes("bridge"),t:c}));return m},d):t.transactionTypes.reduce((m,p,f)=>{let g=e,w=r,y=t.transactionPairs;if(y&&y[f]){let S=y[f];g=Oa(S.sellToken,n)??e,w=Oa(S.buyToken,n)??r}return g&&w&&m.pendingSwapActivityRows.push(bg({sellFungible:g,buyFungible:w,sellAmount:s?.sellAmount,buyAmount:s?.buyAmount,provider:o,isBridge:p.includes("bridge"),t:c})),m},d):d}a(sr,"getPendingActivityRows");var bg=a(({sellFungible:t,buyFungible:e,sellAmount:r,buyAmount:n,provider:s,isBridge:o,t:c})=>{let d=t.data.symbol,m=e.data.symbol,p=Re(r??0,t.data.decimals??0),f=Re(n??0,e.data.decimals??0);return{topLeft:{text:`${c(o?"transactionsPendingBridging":"transactionsPendingSwapping")} on ${s}`},topRight:{text:`${f} ${m}`,color:"spotPositive"},bottomLeft:{text:`${d} \u2192 ${m}`},bottomRight:{text:`${p} ${d}`}}},"getPendingSwapActivityRows"),Oa=a((t,e)=>e.find(r=>(En(t)??[]).includes(r.data.key)),"getFungibleFromFungibleCaip19");var Ua=class{static{a(this,"BitcoinSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,n,s,o){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o}async createTransaction(){return La({quote:this.quote})}async swap(e,r,n,s,o){let c=r.transactions[0];if(!c)throw new Error("No transaction found");let d=sn.Psbt.fromHex(c),m=this.analyzePsbtInputs(d,this.takerAddress),p=await zf({accountSigner:s,storage:o,accountIdentifier:e,pendingTransactionInput:this.parsePendingTransactionInput(this.executingQuote,r,d),psbt:d,psbtChain:void 0,inputsToSign:m,utxoManager:qf(new Mf(o))});return{networkID:this.networkId,id:p}}async waitForConfirmation(e){await Qf(this.networkId,e.id)}analyzePsbtInputs(e,r){let n=[];if(e.data.inputs.forEach((s,o)=>{let c;if(s.witnessUtxo?c=s.witnessUtxo.script:s.nonWitnessUtxo&&(c=sn.Transaction.fromBuffer(s.nonWitnessUtxo).outs[e.txInputs[o].index].script),c)try{sn.address.fromOutputScript(c,sn.networks.bitcoin)===r&&n.push(o)}catch(d){console.warn(`Could not decode script for input ${o}:`,d)}}),n.length===0)throw new Error(`No inputs found for user address ${r}`);return[{address:r,signingIndexes:n}]}parsePendingTransactionInput(e,r,n){let s=ve(Le(e.quote)),c=sr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:s,t:L.t}).pendingSwapActivityRows[0];return{ownerAddress:this.takerAddress,networkID:this.networkId,data:{txID:"",psbtHex:n.toHex()},type:st.Swap,display:{summary:{topLeft:c.topLeft,topRight:c.topRight,bottomLeft:c.bottomLeft,bottomRight:c.bottomRight}}}}};var Ma=class{static{a(this,"BtcBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;bitcoinSwapCommand;constructor(e,r,n,s,o){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.bitcoinSwapCommand=new Ua(e,r,n,s,o)}async createTransaction(){return La({quote:this.quote})}async swap(e,r,n,s,o){return this.bitcoinSwapCommand.swap(e,r,n,s,o)}async waitForConfirmation(e){return this.bitcoinSwapCommand.waitForConfirmation(e)}};u();l();u();l();u();l();u();l();u();l();function gI(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let p=0;p<e.length;p++)e[p]=255;for(let p=0;p<t.length;p++){let f=t.charAt(p),g=f.charCodeAt(0);if(e[g]!==255)throw new TypeError(f+" is ambiguous");e[g]=p}let r=t.length,n=t.charAt(0),s=Math.log(r)/Math.log(256),o=Math.log(256)/Math.log(r);function c(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";let f=0,g=0,w=0,y=p.length;for(;w!==y&&p[w]===0;)w++,f++;let S=(y-w)*o+1>>>0,x=new Uint8Array(S);for(;w!==y;){let k=p[w],P=0;for(let v=S-1;(k!==0||P<g)&&v!==-1;v--,P++)k+=256*x[v]>>>0,x[v]=k%r>>>0,k=k/r>>>0;if(k!==0)throw new Error("Non-zero carry");g=P,w++}let T=S-g;for(;T!==S&&x[T]===0;)T++;let _=n.repeat(f);for(;T<S;++T)_+=t.charAt(x[T]);return _}a(c,"encode");function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;let f=0,g=0,w=0;for(;p[f]===n;)g++,f++;let y=(p.length-f)*s+1>>>0,S=new Uint8Array(y);for(;p[f];){let k=e[p.charCodeAt(f)];if(k===255)return;let P=0;for(let v=y-1;(k!==0||P<w)&&v!==-1;v--,P++)k+=r*S[v]>>>0,S[v]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");w=P,f++}let x=y-w;for(;x!==y&&S[x]===0;)x++;let T=new Uint8Array(g+(y-x)),_=g;for(;x!==y;)T[_++]=S[x++];return T}a(d,"decodeUnsafe");function m(p){let f=d(p);if(f)return f;throw new Error("Non-base"+r+" character")}return a(m,"decode"),{encode:c,decodeUnsafe:d,decode:m}}a(gI,"base");var Ag=gI;var yI="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",qa=Ag(yI);u();l();var wI=i.object({id:i.string(),state:i.nativeEnum(Be)}).passthrough(),hd=class extends Error{static{a(this,"CashActivityError")}activityId;userId;constructor(e,r,n){super(e),this.activityId=r,this.userId=n,this.name="CashActivityError"}},qo=class extends Error{static{a(this,"CashActivityNotFoundError")}constructor(e,r){super(`Cash activity ${e} not found for user ${r}`),this.name="CashActivityNotFoundError"}},xg=a(async({userID:t,activityId:e,accessToken:r})=>{let n=await H.api().bearer(r).get(`/cash/v1/users/${t}/cash-activity/${e}`);if(n.status===404)throw new qo(e,t);let s=wI.safeParse(n.data);if(!s.success)throw new hd(`Failed to parse cash activity response: ${s.error.message}`,e,t);return s.data},"fetchCashActivity");u();l();var gd;(function(t){t.Base58="base58",t.Base64="base64"})(gd||(gd={}));var SI=i.object({activityId:i.string(),transactionId:i.string()}),bI=i.object({message:i.string().optional(),statusCode:i.number()}),TI=3,EI=1e3,Ig=a(async({accessToken:t,userID:e,idempotencyKey:r,signedTransaction:n,skipActivityRecording:s,skipNotification:o,cashQuoteSignerSignature:c,swapInfo:d,perpsInfo:m,skipPreflight:p,awaitConfirmation:f})=>{if(!t)throw new Error("Access token is required");if(!e)throw new Error("User ID is required");return Gi(async()=>{let g=await H.api().bearer(t).post(`/cash/v1/users/${e}/cash-account/send`,{idempotencyKey:r,chainId:_t.Mainnet,signedTransaction:qa.encode(Gm(n)?n.serialize():n.serialize({requireAllSignatures:!1,verifySignatures:!1})),encoding:gd.Base58,skipActivityRecording:s,skipNotification:o,...c&&{cashQuoteSignerSignature:c},...d&&{swapInfo:d},...m&&{perpsInfo:m},...p!==void 0&&{skipPreflight:p},...f!==void 0&&{awaitConfirmation:f}}),w=bI.safeParse(g.data);if(w.success){let S=w.data.message??`Status ${w.data.statusCode}`;throw E.captureError(new Error(`Transaction broadcast failed: ${S}`),I.Cash),new Error("Transaction failed. Please try again.")}let y=SI.safeParse(g.data);if(!y.success)throw E.captureError(new Error(`Failed to parse transaction response: ${JSON.stringify(g.data)}`),I.Cash),new Error("Transaction failed. Please try again.");return y.data},()=>!0,TI,EI)},"broadcastTransaction");var AI=8,xI=K({seconds:1.5}),II=a(t=>{switch(t){case Be.Failed:case Be.Canceled:case Be.Completed:case Be.Processing:case Be.Refunded:return!0;case Be.Pending:case Be.Unknown:return!1}},"isTerminalState"),kI=a(t=>{switch(t){case Be.Completed:case Be.Processing:case Be.Refunded:return!0;case Be.Failed:case Be.Canceled:case Be.Pending:case Be.Unknown:return!1}},"isSuccessTerminalState");var zo=a(async({unsignedTransaction:t,vaultProxy:e,accountIdentifier:r,signerAddress:n,idempotencyKey:s,isCash:o=!0,accessToken:c,userID:d,skipActivityRecording:m,skipNotification:p,cashQuoteSignerSignature:f,swapInfo:g,perpsInfo:w,skipPreflight:y,awaitConfirmation:S})=>{let x;typeof t=="string"?x=mt(t,"bs58"):x=t,o&&await e.updateCashAccountMapping(n);let T=o&&await CI(e,n);E.addBreadcrumb(I.Cash,"Signing transaction ...",F.Info),E.addBreadcrumb(I.Cash,`Using vault proxy signing (isCash: ${o}, isCashKMS: ${T})`,F.Info);let _;o&&T?_={isCash:o,isCashKMS:T,cashAccountAddress:n,data:{chainType:ie.Solana,signingType:"transaction",message:new Uint8Array(Oi(x))}}:o?_={isCash:o,data:{chainType:ie.Solana,signingType:"transaction",message:new Uint8Array(Oi(x))}}:_={chainType:ie.Solana,signingType:"transaction",message:new Uint8Array(Oi(x))};let k=await e.sign(r,_);if(k.status==="error")throw new Error(k.message);let{signature:P}=k;if(!P)throw new Error("Failed to sign transaction: No signature returned");x.addSignature(new ue.PublicKey(n),qa.decode(P));let v=x;if(E.addBreadcrumb(I.Cash,"Signed transaction",F.Info),!$r("kill-cash-out-tx-simulation")){E.addBreadcrumb(I.Cash,"Simulating transaction before broadcast...",F.Info);try{let R={type:"transaction",userAccount:n,params:{transactions:[t],method:"signAndSendTransaction"},url:"https://phantom.com",networkID:_t.Mainnet,context:"swap"},G=await xn("en","deviceId",R);if(G.error){let M=new Error(`Simulation error: ${G.error}`);throw E.addBreadcrumb(I.Cash,`Simulation failed: ${G.error}`,F.Error),M}E.addBreadcrumb(I.Cash,"Simulation passed",F.Info)}catch(R){throw E.captureError(R,I.Cash),R}}E.addBreadcrumb(I.Cash,"Broadcasting transaction ...",F.Info);let{activityId:z,transactionId:Q}=await Ig({accessToken:c,userID:d,idempotencyKey:s,signedTransaction:v,skipActivityRecording:m,skipNotification:p,cashQuoteSignerSignature:f,swapInfo:g,perpsInfo:w,skipPreflight:y,awaitConfirmation:S});E.addBreadcrumb(I.Cash,"Polling for cash activity...",F.Info);try{await Gi(async()=>{let R=await xg({userID:d,activityId:z,accessToken:c});if(II(R.state)){if(kI(R.state))return E.addBreadcrumb(I.Cash,`Activity reached success terminal state: ${R.state}`,F.Info),R;{let G=`Activity reached failed terminal state: ${R.state}.`;throw E.addBreadcrumb(I.Cash,G,F.Info),new Error(G)}}else throw new Error(`Activity state is ${R.state}, waiting for a terminal state.`)},R=>R instanceof qo||!!(R instanceof Error&&R.message.includes("waiting for")),AI,xI,!0)}catch(R){E.addBreadcrumb(I.Cash,`Failed to poll for cash activity: ${R}`,F.Error);let G=new Error(`Transaction broadcast succeeded but activity confirmation failed: ${R}`);throw E.captureError(G,I.Cash),G}return E.addBreadcrumb(I.Cash,"Broadcasted transaction",F.Info),Q},"signAndBroadcastTransaction");async function CI(t,e){try{E.addBreadcrumb(I.Cash,"Fetching Cash KMS account...",F.Info);let n=(await t.getCashKMSAccount({cashAccountAddress:e})).account.address;return e!==n&&E.addBreadcrumb(I.Cash,"Cash-KMS account mismatch",F.Error,{cashAddress:e?.slice(0,5),kmsAddress:n?.slice(0,5)}),e===n}catch{return E.addBreadcrumb(I.Cash,"Unable to get Cash-KMS account.",F.Error),!1}}a(CI,"isCashKMSEnabled");u();l();var _I=i.object({activityId:i.string()}),yd=a(async({accessToken:t,userID:e,idempotencyKey:r,swapInfo:n,chainId:s,signedTransaction:o,encoding:c,onchainTxId:d,failureReason:m,skipActivityRecording:p,skipNotification:f,occurredAt:g})=>{if(!t)throw new Error("Access token is required");if(!e)throw new Error("User ID is required");let w=await H.api().bearer(t).post(`/cash/v1/users/${e}/cash-account/transaction/failed`,{idempotencyKey:r,swapInfo:n,...s&&{chainId:s},...o&&{signedTransaction:o},...c&&{encoding:c},...d&&{onchainTxId:d},...m&&{failureReason:m},...p!==void 0&&{skipActivityRecording:p},...f!==void 0&&{skipNotification:f},...g&&{occurredAt:g}}),y=_I.safeParse(w.data);if(!y.success)throw new Error("Failed to parse record failed swap response");return y.data},"recordFailedCashSwap");u();l();var Qo=a((t,e)=>!t||!e?{}:{sellAmount:e.sellAmount,buyAmount:e.buyAmount,sellToken:t.sell.data.symbol||"unknown",buyToken:t.buy.data.symbol||"unknown"},"swapTelemetryMetadata"),za=class{static{a(this,"CashSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;authRepository;cashAccount;constructor(e,r,n,s,o,c,d,m){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.connection=c,this.authRepository=d,this.cashAccount=m}async createTransaction(){E.addBreadcrumb(I.Cash,"Creating cash swap transaction",F.Info,Qo(this.executingQuote,this.quote));try{return await hg({quote:this.quote,connection:this.connection})}catch(e){throw E.addBreadcrumb(I.Cash,"Failed to create cash swap transaction",F.Error,Qo(this.executingQuote,this.quote)),e}}async swap(e,r,n,s,o){E.addBreadcrumb(I.Cash,"Starting cash swap",F.Info,Qo(this.executingQuote,this.quote));let c=r.transactions[0],d=mt(c,"bs58"),m=Km(d),p=d.message.header.numRequiredSignatures,f=m.slice(0,p),g=this.cashAccount?.addressDetails.address;if(!g)throw new Error("Cash account address not found");let w=f[0]?.toBase58(),y=w===this.takerAddress?"taker address":w===g?"cash account address":null;y&&E.addBreadcrumb(I.Cash,`Fee payer is ${y}`,F.Info,Qo(this.executingQuote,this.quote));let S=f.some(v=>v.toBase58()===g),x=S?g:this.takerAddress,T=await this.authRepository?.getUser();if(!T)throw new Error("User not found for swap");let{accessToken:_,userID:k}=T,P=this.getSwapInfo(this.executingQuote,this.quote);try{return{id:await zo({unsignedTransaction:c,vaultProxy:s,accountIdentifier:e,signerAddress:x,idempotencyKey:this.executionId,isCash:S,accessToken:_,userID:k,skipActivityRecording:!1,skipNotification:!0,cashQuoteSignerSignature:this.quote.cashQuoteSignerSignature,swapInfo:P,waitForActivityState:Be.Completed}),networkID:this.networkId}}catch(v){throw E.addBreadcrumb(I.Cash,"Swap failed",F.Error,Qo(this.executingQuote,this.quote)),v}}async waitForConfirmation(e){}parsePendingActivity(e,r){let n=ve(Le(e.quote));return sr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:n,t:L.t})}getSwapInfo(e,r){let n=e.sell,s=e.buy,o=e.quoteInput,c=n.data.walletAddress,d=s.data.walletAddress;if(!c&&o?.taker){let m=je(o?.taker);m.resourceType===W.address&&(c=m.address)}if(!d&&o?.takerDestination){let m=je(o?.takerDestination);m.resourceType===W.address&&(d=m.address)}return{type:In.Swap,input:{owner:c,mint:n.data.tokenAddress??"",amount:r.sellAmount,symbol:n.data.symbol??void 0,name:n.data.name??void 0,decimals:n.data.decimals,logoUri:n.data.logoUri??void 0},output:{owner:d,mint:s.data.tokenAddress??"",amount:r.buyAmount,symbol:s.data.symbol??void 0,name:s.data.name??void 0,decimals:s.data.decimals,logoUri:s.data.logoUri??void 0},quoteId:r.rfqProps?.quoteId,quoteSource:Le(r).map(m=>m.name).join(",")}}};u();l();var Qa=class{static{a(this,"EvmBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;evmSwapCommand;constructor(e,r,n,s,o,c){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.evmSwapCommand=c}createTransaction(){return No({networkId:this.networkId,callerAddress:this.takerAddress,quote:this.quote})}async swap(e,r,n,s,o){return this.evmSwapCommand.swap(e,r,n,s,o)}async waitForConfirmation(e){return this.evmSwapCommand.waitForConfirmation(e)}};u();l();u();l();var FI=1.3,PI=a(t=>{switch(t){case te.Ethereum.Mainnet:case te.Ethereum.Sepolia:return 8e5;case te.Polygon.Mainnet:case te.Polygon.Amoy:return 5e5;case te.Base.Mainnet:case te.Base.Sepolia:return 5e5;case te.Arbitrum.Mainnet:case te.Arbitrum.Sepolia:return 5e5;case te.Hyperevm.Mainnet:case te.Hyperevm.Testnet:return 5e5;case te.Monad.Mainnet:case te.Monad.Testnet:return 5e5;default:return 0}},"getDefaultBridgeGasLimit"),vI=a(t=>{switch(t){case te.Ethereum.Mainnet:case te.Ethereum.Sepolia:return 6e4;case te.Polygon.Mainnet:case te.Polygon.Amoy:return 6e4;case te.Base.Mainnet:case te.Base.Sepolia:return 6e4;case te.Arbitrum.Mainnet:case te.Arbitrum.Sepolia:return 6e4;case te.Hyperevm.Mainnet:case te.Hyperevm.Testnet:return 6e4;case te.Monad.Mainnet:case te.Monad.Testnet:return 6e4;default:return 0}},"getDefaultApprovalGasLimit"),RI=a((t,e)=>t.steps.flatMap(r=>r.gasCosts??[PI(e)]),"getBridgeGasLimit"),DI=a((t,e,r)=>{let n=rr(e)?[e.gas]:RI(e,r);return t?t.transactionTypes.map(s=>s.includes("approval")?vI(r):n.shift()??0):n},"getQuoteGasLimit"),gs={estimateGas:a(({swapTransactions:t,evmGasEstimation:e,currentQuote:r,scanResult:n,networkID:s,includeGasBuffer:o,gasBuffer:c})=>{let{maxFeePerGas:d,maxPriorityFeePerGas:m}=e,p=DI(t,r,s),f=n?.advancedDetails?.gas;return n?.advancedDetails?.gasLimit>0&&(p=f),p.map(w=>({maxFeePerGas:d,maxPriorityFeePerGas:m,networkID:s,gasLimit:new b(w).multipliedBy(o?c??FI:1).integerValue(b.ROUND_CEIL)}))},"estimateGas")};u();l();var NI=a(({networkID:t,unsignedTransaction:e,pendingActivityRows:r,accountIdentifier:n,accountSigner:s,storage:o,includeCallPayload:c})=>({accountSigner:s,accountIdentifier:n,networkID:t,unsignedTransaction:e,...c&&{callPayload:{from:e.from,to:e.to,data:e.data,value:e.value}},pendingTransactionInput:{ownerAddress:e.from,networkID:t,data:{nonce:"",unsignedTransaction:e,hash:""},type:st.Swap,display:{summary:r}},storage:o}),"buildArgs"),Ha=a(async({transactions:t,transactionTypes:e,networkID:r,gasEstimation:n,pendingApprovalActivityRows:s,pendingSwapActivityRows:o,accountIdentifier:c,accountSigner:d,storage:m})=>{let p=!0,f="";for(let[g,w]of t.entries()){let y=n[g],S={gas:`0x${y.gasLimit.toString(16)}`,maxFeePerGas:`0x${y.maxFeePerGas.toString(16)}`,maxPriorityFeePerGas:`0x${y.maxPriorityFeePerGas.toString(16)}`},x=Xn.parse({...w,...S}),_=e[g].includes("approval")?s:o,k=NI({networkID:r,accountIdentifier:c,pendingActivityRows:_.shift(),accountSigner:d,storage:m,unsignedTransaction:x,includeCallPayload:p});try{f="",f=await Vf(k)}catch(P){return{signature:f,error:P instanceof Error?P:new Error("Failed to process EVM swap transaction")}}p&&(p=!1)}return{signature:f}},"swapTransactionEvm");var kg=Xr.standard,Ga=class{static{a(this,"EvmSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;gasEstimation;constructor(e,r,n,s,o,c){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.gasEstimation=c}createTransaction(){return Lo({quote:this.quote,callerAddress:this.takerAddress,networkId:this.networkId,sellFungible:this.executingQuote.sell})}async swap(e,r,n,s,o){let c=this.gasEstimation??await this.estimateGas(this.quote,this.executingQuote.response,kg,r,n);if(!c)throw new Error(`No gas estimation found for ${kg}`);let d=this.parsePendingActivity(this.executingQuote,r),{signature:m,error:p}=await E.startSpan("Process EVM Swap Txns",()=>Ha({transactions:r.transactions,transactionTypes:r.transactionTypes,networkID:this.networkId,gasEstimation:c,pendingSwapActivityRows:d.pendingSwapActivityRows,pendingApprovalActivityRows:d.pendingApprovalActivityRows,accountIdentifier:e,accountSigner:s,storage:o}));if(p)throw p;return{networkID:this.networkId,id:m}}async waitForConfirmation(e){await Df(e.networkID,e.id)}async estimateGas(e,r,n,s,o){let c=await ns(this.networkId,!0);if(!c)return;let d=c[n];if(!d)return;let m={networkID:this.networkId,gasLimit:new V(1),maxFeePerGas:d.maxFeePerGas,maxPriorityFeePerGas:d.maxPriorityFeePerGas};return gs.estimateGas({swapTransactions:s,evmGasEstimation:m,currentQuote:e,scanResult:o??void 0,includeGasBuffer:!0,networkID:this.networkId,gasBuffer:r.gasBuffer})}parsePendingActivity(e,r){let n=ve(Le(e.quote));return sr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:n,t:L.t})}};u();l();var Cg=U(vA());u();l();u();l();var BI=a(({networkID:t,transaction:e,feePayer:r,connection:n,pendingActivityRows:s,accountIdentifier:o,accountSigner:c,storage:d})=>({accountSigner:c,accountIdentifier:o,transaction:e,feePayer:r,connection:n,opts:{skipPreflight:!0},pendingTransactionInput:{ownerAddress:r.toBase58(),networkID:t,data:{signature:""},type:st.Swap,display:{summary:s}},storage:d}),"buildArgs"),Va=a(async({callerAddress:t,connection:e,networkID:r,transactions:n,pendingSwapActivityRows:s,accountIdentifier:o,accountSigner:c,storage:d})=>{let m=new ue.PublicKey(t),p="";for(let[f,g]of n.entries()){let w=mt(g,"bs58"),y=BI({networkID:r,transaction:w,feePayer:m,connection:e,pendingActivityRows:s[f],accountIdentifier:o,accountSigner:c,storage:d});try{p="",p=await ss(y),f!==n.length-1&&await Yr({connection:e,signature:p})}catch(S){return{signature:p??"",error:S instanceof Error?S:new Error("Failed to process solana swap transaction")}}}return{signature:p??""}},"swapTransactionSolana");var mr=class{static{a(this,"SolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;constructor(e,r,n,s,o,c){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.connection=c}async createTransaction(){return ms({quote:this.quote,connection:this.connection})}async swap(e,r,n,s,o){let c=this.parsePendingActivity(this.executingQuote,r),{signature:d,error:m}=await Va({callerAddress:this.takerAddress,connection:this.connection,networkID:this.networkId,transactions:r.transactions,pendingSwapActivityRows:c.pendingSwapActivityRows,accountIdentifier:e,accountSigner:s,storage:o});if(m)throw m;return{networkID:this.networkId,id:d}}async waitForConfirmation(e){let r=Jr(e.networkID);await Yr({connection:r,signature:e.id})}parsePendingActivity(e,r){let n=ve(Le(e.quote));return sr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:n,t:L.t})}};var LI=i.object({signature:i.string()}),$a=class extends mr{static{a(this,"GaslessSolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;gaslessSignature;constructor(e,r,n,s,o,c,d){super(e,r,n,s,o,c),this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.connection=c,this.gaslessSignature=d}async swap(e,r,n,s,o){let c=this.quote.transactionData[0];if(!c)throw new Error("No transaction data found in quote");let d=new ue.PublicKey(this.takerAddress),p=this.parsePendingActivity(this.executingQuote,r).pendingSwapActivityRows[0];if(!p)throw new Error("Unable to create pending activity for gasless");let f=await ra({accountIdentifier:e,feePayer:d,connection:this.connection,accountSigner:s,transaction:mt(c,"bs58"),pendingTransactionInput:{ownerAddress:d.toBase58(),networkID:this.networkId,data:{signature:this.gaslessSignature},type:st.Swap,display:{summary:p}},storage:o,opts:{}});return{id:(await this.submitGaslessSwap(this.gaslessSignature,f)).signature,networkID:this.networkId}}async submitGaslessSwap(e,r){let n=await H.api().post("/gasless-swap/v1/submit",{quoteSignature:e,encoding:"bs58",chainId:this.networkId,transaction:Cg.default.encode(r.serialize())}),s=LI.safeParse(n.data);if(!s.success)throw new Error("Failed to submit gasless swap");return s.data}};u();l();var OI=i.object({quoteId:i.string(),transactionId:i.string()}),ja=class extends mr{static{a(this,"RFQSolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;constructor(e,r,n,s,o,c){super(e,r,n,s,o,c),this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.connection=c}async swap(e,r,n,s,o){let c=this.quote.transactionData[0];if(!c)throw new Error("No transaction data found in quote");let d=new ue.PublicKey(this.takerAddress),p=this.parsePendingActivity(this.executingQuote,r).pendingSwapActivityRows[0];if(!p)throw new Error("Unable to create pending activity for rfq");let f=await ra({accountIdentifier:e,feePayer:d,connection:this.connection,accountSigner:s,transaction:mt(c,"bs58"),pendingTransactionInput:{ownerAddress:d.toBase58(),networkID:this.networkId,data:{signature:""},type:st.Swap,display:{summary:p}},storage:o,opts:{}});return{id:(await this.submitRFQSwap(f)).transactionId,networkID:this.networkId}}async submitRFQSwap(e){let r=Buffer.from(e.serialize()).toString("base64"),n=await H.api().post("/v0/rfq/swap",{chainId:this.networkId,quoteId:this.quote.rfqProps?.quoteId,signedPayload:r},{headers:{"X-Request-Id":this.executionId}}),s=OI.safeParse(n.data);if(!s.success)throw new Error("Failed to submit rfq swap");return s.data}};u();l();var Ka=class{static{a(this,"SolanaBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;solanaSwapCommand;constructor(e,r,n,s,o,c){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.connection=c,this.solanaSwapCommand=new mr(e,r,n,e.quote,o,c)}createTransaction(){return Bo({quote:this.quote,connection:this.connection})}async swap(e,r,n,s,o){return this.solanaSwapCommand.swap(e,r,n,s,o)}async waitForConfirmation(e){return this.solanaSwapCommand.waitForConfirmation(e)}};u();l();u();l();u();l();var UI=a(({networkID:t,transaction:e,feePayer:r,pendingActivityRows:n,accountIdentifier:s,accountSigner:o,storage:c})=>({accountSigner:o,accountIdentifier:s,transaction:e,pendingTransactionInput:{ownerAddress:r,networkID:t,data:{digest:""},type:st.Swap,display:{summary:n}},storage:c}),"buildArgs"),Wa=a(async({callerAddress:t,networkID:e,transactions:r,pendingSwapActivityRows:n,accountIdentifier:s,accountSigner:o,storage:c})=>{let d="";for(let[m,p]of r.entries()){let f=UI({networkID:e,transaction:ea.deserializeTransactionString(p),feePayer:t,pendingActivityRows:n[m],accountIdentifier:s,accountSigner:o,storage:c});try{d=(await jf(f)).digest,m!==r.length-1&&await ta(e,d)}catch(g){return{signature:d??"",error:g instanceof Error?g:new Error("Failed to process sui swap transaction")}}}return{signature:d??""}},"swapTransactionSui");var ys=class{static{a(this,"SuiSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,n,s,o){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o}async createTransaction(){return Uo({quote:this.quote})}async swap(e,r,n,s,o){let c=this.parsePendingActivity(this.executingQuote,r),{signature:d,error:m}=await Wa({callerAddress:this.takerAddress,networkID:this.networkId,transactions:r.transactions,pendingSwapActivityRows:c.pendingSwapActivityRows,accountIdentifier:e,accountSigner:s,storage:o});if(m)throw m;return{networkID:this.networkId,id:d}}async waitForConfirmation(e){await ta(this.networkId,e.id)}parsePendingActivity(e,r){let n=ve(Le(e.quote));return sr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:n,t:L.t})}};var Za=class{static{a(this,"SuiBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;suiSwapCommand;constructor(e,r,n,s,o){this.executingQuote=e,this.takerAddress=r,this.networkId=n,this.quote=s,this.executionId=o,this.suiSwapCommand=new ys(e,r,n,e.quote,o)}async createTransaction(){return Oo({quote:this.quote})}async swap(e,r,n,s,o){return this.suiSwapCommand.swap(e,r,n,s,o)}async waitForConfirmation(e){return this.suiSwapCommand.waitForConfirmation(e)}};var Xa=class{static{a(this,"WalletSwapCommandFactory")}bridgeStatusManager;constructor(e){this.bridgeStatusManager=e}create(e,r,n,s,o,c,d){if(zh(e.quote)&&(Ne(e.buy)||Ne(e.sell)))return new za(e,r,n,e.quote,be(),s,o,c);if(A.isSolanaNetworkID(n)&&Qt(e.quote)){let m=new mr(e,r,n,e.quote,be(),s);return e.quote.rfqProps?new ja(e,r,n,e.quote,be(),s):e.quote.gaslessSignature?new $a(e,r,n,e.quote,be(),s,e.quote.gaslessSignature):m}else{if(A.isEVMNetworkID(n)&&rr(e.quote))return this.createEvmSwapCommand(e,r,n,d);if(A.isSuiNetworkID(n)&&_r(e.quote))return new ys(e,r,n,e.quote,be());if(de(e.quote)){if(A.isSolanaNetworkID(n))return this.wrapBridgeTrackingCommand(new Ka(e,r,n,e.quote,be(),s),e);if(A.isEVMNetworkID(n)){let m=this.createEvmSwapCommand(e,r,n,d);return this.wrapBridgeTrackingCommand(new Qa(e,r,n,e.quote,be(),m),e)}else{if(A.isSuiNetworkID(n))return this.wrapBridgeTrackingCommand(new Za(e,r,n,e.quote,be()),e);if(A.isBitcoinNetworkID(n))return this.wrapBridgeTrackingCommand(new Ma(e,r,n,e.quote,be()),e)}}}throw new Error("Unsupported SwapQuote}")}createEvmSwapCommand(e,r,n,s){let o=s?s.filter(Xi):void 0;return o&&o.length===0&&(o=void 0),new Ga(e,r,n,e.quote,be(),o)}wrapBridgeTrackingCommand(e,r){return!this.bridgeStatusManager||!de(r.quote)?e:new Da(e,this.bridgeStatusManager,r)}};u();l();u();l();var MI="x-supported-action",Ho={name:"SwapperNoQuotes",message:"No quotes found"},ws=class extends oh{static{a(this,"SwapperQuoteStreamEventProducer")}createStreamUrl({amount:e,amountUsd:r,buy:n,sell:s,taker:o,takerDestination:c,slippageTolerance:d,exactOut:m,autoSlippage:p,priorityFee:f,tipAmount:g,isLedger:w,phantomCashAccount:y,isPrediction:S,predictions:x}){let T=new URLSearchParams({taker:o,takerDestination:c,buyToken:D(Y(n)),sellToken:D(Y(s)),sellAmount:e,sellAmountUsd:r??"",exactOut:m?"true":"false",autoSlippage:p?"true":"false",clientEnableGaslessSwap:"true",phantomCashAccount:y?"true":"false"});return d&&T.set("slippageTolerance",String(d)),f&&T.set("priorityFee",String(f)),g&&T.set("tipAmount",String(g)),w!==void 0&&T.set("isLedger",String(w)),S&&T.set("isPrediction","true"),x&&(T.set("predictionsPlatform",x.platform),T.set("predictionsMintAddress",x.mintAddress),T.set("predictionsTokenPerspective",x.tokenPerspective)),`${this.getApiEnvironment()}/swap/v2/stream/quotes?${T.toString()}`}getAdditionalHeaders(e){let r={};return e.supportedActions&&e.supportedActions.length>0&&(r[MI]=e.supportedActions.join(",")),r}handleNewQuoteResponse(e,r){let n=this.safeJsonParse(e);if(!n.success||!n.data){r({type:"error",errorResponse:Ho});return}try{let s=this.parseSwapQuotesResponse(n.data);r({type:"newQuoteResponse",quoteResponse:s})}catch{r({type:"error",errorResponse:Ho})}}handleErrorQuoteResponse(e,r){let n=this.safeJsonParse(e);if(!n.success||!n.data){r({type:"error",errorResponse:Ho});return}try{let s=ma.safeParse(n.data);r({type:"error",errorResponse:s.success?s.data:Ho})}catch{r({type:"error",errorResponse:Ho})}}parseSwapQuotesResponse(e){let r=new We({key:"SwapperNoQuotes"});if(Io.safeParse(e?.type).success===!1)throw E.captureError(new Error("Failed to parse a valid quote type."),I.Swapper),new Error("Invalid input");let n=ko.safeParse(e);if(!n.success)throw E.captureError(new Error("Failed to parse a valid swap quotes response."),I.Swapper),r;if(n.data.includesAllProviders&&n.data.quotes.length===0)throw r;return n.data}};var Ja=class extends ws{static{a(this,"EventStreamQuoteStreamProducer")}eventSource;open(e,r){this.close();let n=this.createStreamUrl(e),s=this.getAdditionalHeaders(e);this.eventSource=new ca(n,this.getOptionsWithAuth(n,{headers:s}));let o=a(c=>{switch(c.type){case"new-quote-response":this.handleNewQuoteResponse(c.data,r);break;case"error-quote-response":this.handleErrorQuoteResponse(c.data,r);break;case"open":r({type:"open"});break;case"error":r({type:"error",errorResponse:{name:"UnknownError",message:c.message}});break;case"close":r({type:"close"});break}},"eventSourceListener");this.eventSource.addEventListener("new-quote-response",o),this.eventSource.addEventListener("error-quote-response",o),this.eventSource.addEventListener("open",o),this.eventSource.addEventListener("error",o),this.eventSource.addEventListener("close",o)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};u();l();var Ya=class extends ws{static{a(this,"NativeEventStreamQuoteStreamProducer")}eventSource;open(e,r){this.close();let n=this.createStreamUrl(e),s=this.getAdditionalHeaders(e);this.eventSource=new ca(n,this.getOptionsWithAuth(n,{headers:s}));let o=a(c=>{switch(c.type){case"new-quote-response":this.handleNewQuoteResponse(c.data,r);break;case"error-quote-response":this.handleErrorQuoteResponse(c.data,r);break;case"open":r({type:"open"});break;case"error":r({type:"error",errorResponse:{name:"UnknownError",message:c.message}});break;case"close":r({type:"close"});break}},"eventSourceListener");this.eventSource.addEventListener("new-quote-response",o),this.eventSource.addEventListener("error-quote-response",o),this.eventSource.addEventListener("open",o),this.eventSource.addEventListener("error",o),this.eventSource.addEventListener("close",o)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};u();l();var ec=class{static{a(this,"QuoteStreamer")}producer;supportedActions;listeners=new Set;constructor(e,r=[]){this.producer=e,this.supportedActions=r}openStream(e){e.supportedActions=this.supportedActions,this.listeners.forEach(r=>r.onEvent({type:"openRequested"})),this.producer.close(),this.producer.open(e,r=>{this.listeners.forEach(n=>n.onEvent(r)),r.type==="error"&&this.closeStream()})}closeStream(){this.producer.close()}subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}};u();l();u();l();function _g(t){return t<3e5?1e4:t<6e5?15e3:3e4}a(_g,"getBridgeStatusPollInterval");function qI(t){let e="pending";switch(t.status){case"DONE":e="completed";break;case"FAILED":e="failed";break;case"PENDING":case"NOT_FOUND":default:break}return{state:e,rawStatus:t.status,updatedAt:Date.now(),fromAddress:t.fromAddress,toAddress:t.toAddress}}a(qI,"normalizeSwapperStatus");var wd=class{static{a(this,"BridgeStatusPoller")}args;timeoutId=null;isActive=!1;client;constructor(e){this.args=e,this.client=e.client}start(){this.isActive||(this.isActive=!0,this.scheduleNext(0))}stop(){this.isActive=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}scheduleNext(e){this.isActive&&(this.timeoutId=setTimeout(()=>{this.poll()},e))}async poll(){if(this.isActive)try{let e=await this.client.fetchStatus(this.args.record.transactionHash),r=qI(e),n;switch(r.state){case"completed":n={type:"completed",status:r},this.stop();break;case"failed":n={type:"failed",status:r},this.stop();break;case"pending":default:{n={type:"pending",status:r};let s=Date.now()-this.args.record.startedAt;this.scheduleNext(_g(s));break}}this.args.onEvent(n)}catch(e){this.args.onEvent({type:"error",error:e});let r=Date.now()-this.args.record.startedAt;this.scheduleNext(_g(r))}}};function Fg(t){return new wd(t)}a(Fg,"createBridgeStatusPoller");u();l();var zI=i.object({status:i.string(),sending:i.object({txHash:i.string().optional()}).optional(),receiving:i.object({txHash:i.string().optional()}).optional(),fromAddress:i.string().optional(),toAddress:i.string().optional()}).passthrough(),tc=class{static{a(this,"SwapperStatusClient")}async fetchStatus(e){let r=await H.api().get("/swap/v2/status/lifi",{params:{txHash:e}}),n=r?.data??r,s=zI.safeParse(n);if(!s.success)throw new Error("Unable to parse bridge status response");return s.data}};u();l();var Sd="sdk.bridgeStatus.pending";var bd=class{static{a(this,"BridgeStatusManager")}storage;client;createPoller;records=new Map;pollers=new Map;listeners=new Set;hydratePromise;constructor(e,r={}){this.storage=e,this.client=r.client??new tc,this.createPoller=r.createPoller??Fg}async initialize(){this.hydratePromise||(this.hydratePromise=this.hydrate()),await this.hydratePromise}destroy(){this.pollers.forEach(e=>e.stop()),this.pollers.clear(),this.records.clear()}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}getPendingRecords(){return Array.from(this.records.values())}getPendingActivityRows(e,r){return this.getPendingBridgeActivities(e,r).map(n=>n.row)}getPendingBridgeActivities(e,r){return this.filterRecordsByAddresses(r?.addresses).map(s=>({record:s,row:Dg(s,e)}))}getPendingBridgeTransactions(e,r){return this.filterRecordsByAddresses(r?.addresses).map(s=>Pg(s,e))}getPendingBridgeTransactionById(e,r){let n=this.records.get(e);if(n)return Pg(n,r)}isPendingBridgeTransaction(e){return this.records.has(e)}async track(e){if(await this.initialize(),!this.shouldTrackQuote(e.executingQuote))return;let r=QI(e.executingQuote),n=this.records.get(e.executionId),s={executionId:e.executionId,transactionHash:e.transactionHash,startedAt:n?.startedAt??Date.now(),quote:r,status:n?.status};this.records.set(e.executionId,s),this.restartPoller(s),await this.persistRecords()}async hydrate(){try{let e=await this.storage.get(Sd)??"[]",r=JSON.parse(e);for(let n of r){let s=this.normalizePersistedRecord(n);s&&(this.records.set(s.executionId,s),this.startPoller(s))}}catch(e){console.error("Failed to hydrate bridge status records",e)}}shouldTrackQuote(e){if(!de(e.quote))return!1;let r=e.sell?.data?.chain?.id,n=e.buy?.data?.chain?.id;return n&&A.isBitcoinNetworkID(n)||r&&A.isBitcoinNetworkID(r)||!1}startPoller(e){let r=this.createPoller({record:e,client:this.client,onEvent:a(n=>this.handlePollerEvent(e.executionId,n),"onEvent")});this.pollers.set(e.executionId,r),r.start()}restartPoller(e){this.stopPoller(e.executionId),this.startPoller(e)}stopPoller(e){let r=this.pollers.get(e);r&&(r.stop(),this.pollers.delete(e))}async persistRecords(){try{let e=Array.from(this.records.values()).map(r=>({executionId:r.executionId,transactionHash:r.transactionHash,startedAt:r.startedAt,quote:r.quote,status:r.status}));await this.storage.set(Sd,JSON.stringify(e))}catch(e){console.error("Failed to persist bridge status records",e)}}removeRecord(e){this.records.delete(e),this.stopPoller(e),this.persistRecords()}normalizePersistedRecord(e){return"quote"in e&&HI(e.quote)?e:null}handlePollerEvent(e,r){let n=this.records.get(e);if(n)switch(r.type){case"pending":n.status=r.status,this.notifyListeners({type:"pending",record:n,status:r.status}),this.persistRecords();break;case"completed":n.status=r.status,this.notifyListeners({type:"completed",record:n,status:r.status}),this.removeRecord(e);break;case"failed":n.status=r.status,this.notifyListeners({type:"failed",record:n,status:r.status}),this.removeRecord(e);break;case"error":this.notifyListeners({type:"error",record:n,error:r.error});break}}notifyListeners(e){this.listeners.forEach(r=>{try{r.onBridgeStatusChange(e)}catch(n){console.error("BridgeStatusListener error",n)}})}filterRecordsByAddresses(e){if(!e?.length)return this.getPendingRecords();let r=GI(e);return this.getPendingRecords().filter(n=>n.quote.accountAddresses.some(s=>r.has(Rg(s))))}};function QI(t){if(!de(t.quote))throw new Error("Non-bridge quotes cannot be tracked");return{sell:t.sell,buy:t.buy,quote:t.quote,amount:t.amount,accountAddresses:t.account.addresses}}a(QI,"createQuoteSnapshot");function HI(t){return!!(t&&de(t.quote))}a(HI,"isValidSnapshot");function GI(t){return new Set(t.map(Rg))}a(GI,"createAddressLookup");function Rg(t){return`${t.networkID}:${VI(t.address,t.networkID)}`}a(Rg,"createAddressKey");function VI(t,e){return A.isEVMNetworkID(e)?t.toLowerCase():t}a(VI,"normalizeAddress");function Dg(t,e){let r=t.quote.quote,n=t.quote.sell,s=t.quote.buy,o=Re(r.sellAmount,n?.data.decimals??0),c=Re(r.buyAmount,s?.data.decimals??0),d=n?.data.symbol??"",m=s?.data.symbol??"",p=t.startedAt+K({minutes:20}),f=Date.now(),g=p-f,w=Math.max(0,Math.ceil(g/(60*1e3))),y=w>0?`Est. ${w}m`:"Est. <1m";return{topLeft:{text:e("transactionsPendingSwapping")},topRight:{text:`${c} ${m}`,color:"spotPositive"},bottomLeft:{text:y},bottomRight:{text:`${o} ${d}`}}}a(Dg,"createPendingBridgeActivityRow");function $I(t,e){if(A.isEVMNetworkID(t))return{nonce:0,transactions:[{hash:e.transactionHash,timestamp:e.startedAt,unsignedTransaction:{},confirmations:0}]};if(A.isBitcoinNetworkID(t))return{txID:e.transactionHash,psbtHex:"",confirmations:0};if(A.isSolanaNetworkID(t))return{signature:e.transactionHash};if(A.isSuiNetworkID(t))return{digest:e.transactionHash};throw new Error(`Unsupported network for bridge transaction: ${t}`)}a($I,"createBridgePendingTransactionData");function Pg(t,e){let r=t.quote.sell,n=t.quote.buy,s=r?.data.chain?.id;if(!s)throw new Error("Cannot create pending transaction: missing network ID");let o=Dg(t,e),c=t.quote.accountAddresses.find(y=>y.networkID===s)?.address??"",d=n?.data.chain?.id,m=d?t.quote.accountAddresses.find(y=>y.networkID===d)?.address:void 0,p=m?cf(m,4):"",f=Re(t.quote.quote.buyAmount,n?.data.decimals??0),g=n?.data.symbol??"",w=`${f} ${g}`;return{id:t.executionId,timestamp:t.startedAt,ownerAddress:c,networkID:s,type:st.Swap,display:{summary:{topLeft:o.topLeft,topRight:o.topRight,bottomLeft:o.bottomLeft,bottomRight:o.bottomRight},detail:{header:w,assetSymbol:g,uiRecipient:p}},data:$I(s,t)}}a(Pg,"createPendingTransactionFromBridgeRecord");var rc=null,vg=null;function Ng(t){return rc||(rc=new bd(t)),vg||(vg=rc.initialize()),rc}a(Ng,"getBridgeStatusManager");u();l();u();l();var ht=a((t,e)=>!!t&&!!e&&A.compareNetworkID(t,e)!==0,"isBridgeSwap");u();l();var sc=U(Xm()),Bg=U(DA()),oc=U(RA());u();l();u();l();function vt(t,e,r){if(e.lte(0))return null;let n=D({chainId:t,resourceType:W.nativeToken,slip44:A.getSlip44(t)}),s=A.getTokenDecimals(t),o=A.getTokenSymbol(t);if(!n||!s||!o)return null;let c=e.div(pf(s)),d=r[n];return d?.usd?c.times(d.usd).toNumber():null}a(vt,"getFeeInUsd");var jI={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"};function KI(t,e){return{type:t,amountUsd:new b(e.amountUSD??0),amount:new b(e.amount??0)}}a(KI,"bridgeFeeToFee");function on(t){return t.steps.flatMap(e=>e.includedFeeCosts).reduce((e,r)=>{if(!r)return e;let n=jI[r.name];return n&&new b(r.amount).gt(0)&&e.push(KI(n,r)),e},[])}a(on,"getIncludedBridgeFees");function an(t,e,r){let n=t.steps.reduce((s,o)=>s.plus(o.nonIncludedNonGasFees),new b(0));return n.isZero()?[]:[{type:"nonIncludedNonGas",amountUsd:new b(vt(e,n,r)??0),amount:n}]}a(an,"getNonIncludedBridgeFees");var nc=class{static{a(this,"BtcProcessBridgeQuoteCommand")}networkID;priceClient;constructor(e,r){this.networkID=e,this.priceClient=r}getNativeTokenCaip19(){return D({chainId:this.networkID,resourceType:W.nativeToken,slip44:A.getSlip44(this.networkID)})}async processQuote(e,r,n){let s=await this.createSwapTransactions(e),o=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!o.usd)throw new Error("Price data not found");let c=await this.calculateNetworkFee(e,o),d=this.appendBridgeFees([c],e,o),m=this.appendPhantomFee(d,e);return{quote:e,fees:{totalFees:this.sumFees(m),fees:m},swapTransactions:s}}createSwapTransactions(e){let r=[],n=[],s=[];for(let o of e.steps){let{transactionData:c,sellToken:d,buyToken:m}=o;r.push(c),n.push("bridge"),s.push({sellToken:d,buyToken:m})}return Promise.resolve({type:"bitcoin",transactions:r,transactionTypes:n,transactionPairs:s})}appendPhantomFee(e,r){let n=r.steps.flatMap(s=>s.feeCosts).find(s=>s.name==="phantom");return n?[...e,{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)}]:e}appendBridgeFees(e,r,n){let s={[this.getNativeTokenCaip19()]:n},o=an(r,this.networkID,s),c=on(r);return[...e,...c,...o]}async calculateNetworkFee(e,r){if(!r.usd)throw new Error("Price data not found");let n=e.steps.flatMap(s=>s.gasCosts??[]);if(n.length>0){let s=n.reduce((d,m)=>d+m,0);return{type:"bitcoinNetwork",amountUsd:new b(s).shiftedBy(-8).times(r.usd),amount:new b(s)}}try{let s=e.steps[0];if(!s?.transactionData)throw new Error("No transaction data available for fee estimation");let o=sc.Psbt.fromHex(s.transactionData),c=WI(o),m=(await ih(this.networkID))[Xr.standard]?.btcPerKilobyte;if(!m)throw new Error("Failed to get standard fee rate");let f=Nf(m).times(c).integerValue(b.ROUND_UP);return{type:"bitcoinNetwork",amountUsd:f.shiftedBy(-8).times(r.usd),amount:f}}catch{let o=new b(1e4);return{type:"bitcoinNetwork",amountUsd:o.shiftedBy(-8).times(r.usd),amount:o}}}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};function WI(t){let{header:e,perInput:r}=Zi[Bf(t)],{inputs:n}=t.data,s=new b(e),o=new b(n.length).times(r),c=t.txOutputs.reduce((d,m)=>{let p=oc.decompile(m.script);if(p&&p[0]===oc.OPS.OP_RETURN)return d;let f;if(m.address)f=m.address;else try{f=(0,Bg.fromOutputScript)(m.script,sc.networks.bitcoin)}catch{return d.plus(Zi[ie.BitcoinNativeSegwit].perOutput)}let g=ef(te.Bitcoin.Mainnet,f);return d.plus(Zi[g].perOutput)},new b(0));return s.plus(o).plus(c)}a(WI,"calculateVirtualBytes");u();l();u();l();var Lg=U($());u();l();var ke;(function(t){t.SlippageTolerance="slippageTolerance",t.PriorityFee="priorityFee",t.TipAmount="tipAmount",t.LastSubmittedPairs="lastSubmittedPairsV2",t.LastSelectedTokens="lastSelectedTokens",t.SlippageSettings="slippageSettings",t.HasViewedAutoSlippageOptIn="hasViewedAutoSlippageOptIn",t.PriorityFeeSettings="priorityFeeSettings",t.TipSettings="tipSettings"})(ke||(ke={}));function gt({key:t,queryKey:e,defaultValue:r=null}){let n=Ke();return ne({enabled:!0,queryKey:e,gcTime:Na.Long,staleTime:Ba.Never,async queryFn(){try{return await n.get(t)}catch(s){return s instanceof Error&&E.captureError(s,I.Swapper),r}}})}a(gt,"useSwapStorageValue");function yt({key:t,queryKey:e}){let r=Ke(),n=Pe();return Vr({async mutationFn(s){try{return await r.set(t,s)}catch(o){o instanceof Error&&E.captureError(o,I.Swapper);return}},async onMutate(s){await n.cancelQueries({queryKey:e});let o=n.getQueryData(e);return n.setQueryData(e,s),{previousValue:o}},onError(s,o,c){n.setQueryData(e,c?.previousValue)}})}a(yt,"useSetSwapStorageValue");var fe;(function(t){t.Auto="auto",t.Fixed="fixed"})(fe||(fe={}));var ZI={type:fe.Auto},Gt=a(()=>{let{slippageSetting:t,isFetched:e,save:r}=XI();return{isFetched:e,selectedSetting:t??ZI,setSlippageSetting:r}},"useSlippageSettings"),XI=a(()=>{let{data:t,isFetched:e}=gt({key:ke.SlippageSettings,queryKey:pe.slippageSettings()}),{mutateAsync:r}=yt({key:ke.SlippageSettings,queryKey:pe.slippageSettings()}),n=(0,Lg.useCallback)(async s=>{await r(s)},[r]);return{isFetched:e,slippageSetting:t,save:n}},"useSlippageSettingsStore");u();l();async function Ss({transactions:t,url:e,deviceId:r,takerAddress:n,networkId:s,slippageType:o,quote:c,quoteResponse:d,isSimulationKilled:m}){try{if(m)return{status:"skipped",skipReason:"isSimulationKilled"};if(A.isHyperevmNetworkID(s))return{status:"skipped",skipReason:"unsupportedNetwork"};let p=Ft(L.language)??"en";return{status:"success",result:await xn(p,r,{type:"transaction",userAccount:n,params:JI(t),url:e,networkID:s,context:de(c)?"bridge":Qh(c)?"gaslessSwap":"swap",provider:YI(c),slippageType:o,metadata:{swapper:{quoteOutputAmount:c.buyAmount,quoteOutputToken:D(d.buyToken),quoteInputAmount:c.sellAmount,quoteInputToken:D(d.sellToken)}}})}}catch(p){return{status:"error",error:p,skipReason:"simulationError"}}}a(Ss,"simulateSwap");var JI=a(t=>{switch(t.type){case"evm":return{transactions:t.transactions};case"solana":return{transactions:t.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}};case"sui":case"bitcoin":return{transactions:t.transactions,method:"signAndSendTransaction"}}},"getScannedTransactionParams"),YI=a(t=>{let e=de(t)?hs(t):t?.sources??[];return ve(e)},"getProvider");var ic=class{static{a(this,"EVMProcessBridgeQuoteCommand")}networkID;account;priceClient;quoteInput;quoteResponse;constructor(e,r,n,s,o){this.networkID=e,this.account=r,this.priceClient=n,this.quoteInput=s,this.quoteResponse=o}getNativeTokenCaip19(){return D({chainId:this.networkID,resourceType:W.nativeToken,slip44:A.getSlip44(this.networkID)})}async processQuote(e,r,n){let s=await this.createSwapTransactions(e),o=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!o.usd)throw new Error("Price data not found");let c=await this.calculateNetworkFee(s,e,o,r,n),d=this.appendBridgeFees([c],e,o),m=this.appendPhantomFee(d,e);return{quote:e,fees:{totalFees:this.sumFees(m),fees:m},swapTransactions:s}}createSwapTransactions(e){return No({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:e})}appendPhantomFee(e,r){let n=r.steps.flatMap(s=>s.feeCosts).find(s=>s.name==="phantom");return n?[...e,{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)}]:e}appendBridgeFees(e,r,n){let s={[this.getNativeTokenCaip19()]:n},o=an(r,this.networkID,s),c=on(r);return[...e,...c,...o]}async calculateNetworkFee(e,r,n,s,o){let c=await this.estimateGas(r,e,s,o);if(!c)throw new Error("Unable to estimate gas");if(!n.usd)throw new Error("Price data not found");let d=c[0],m=A.getTokenDecimals(this.networkID),p=d.gasLimit.times(d.maxFeePerGas),f=new b(p).shiftedBy(-m).times(n.usd);return{type:"evmGas",network:this.networkID,amountUsd:f,amount:p}}async estimateGas(e,r,n,s){let o=await ns(this.networkID,!0);if(!o)return;let c=o[Xr.standard];if(!c)return;let d={networkID:this.networkID,gasLimit:new b(1),maxFeePerGas:c.maxFeePerGas,maxPriorityFeePerGas:c.maxPriorityFeePerGas},m=await Ss({transactions:r,url:"https://phantom.app",deviceId:s,takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?fe.Auto:fe.Fixed,quote:e,quoteResponse:this.quoteResponse,isSimulationKilled:n});return gs.estimateGas({swapTransactions:r,evmGasEstimation:d,currentQuote:e,scanResult:m.status==="success"?m.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let e=this.account.addresses.find(n=>n.networkID===this.networkID);if(!e)throw new Error(`No address found for chain ${this.networkID}`);let r={...e};return cr(r)&&(r.address=r.address.toLowerCase()),r}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};u();l();var ac=class{static{a(this,"EVMProcessQuoteCommand")}networkID;account;priceClient;quoteInput;quoteResponse;constructor(e,r,n,s,o){this.networkID=e,this.account=r,this.priceClient=n,this.quoteInput=s,this.quoteResponse=o}getNativeTokenCaip19(){return D({chainId:this.networkID,resourceType:W.nativeToken,slip44:A.getSlip44(this.networkID)})}async processQuote(e,r,n){let s=await this.createSwapTransactions(e),o=await this.calculateNetworkFee(s,e,r,n),c=this.appendPhantomFee([o],e);return{quote:e,fees:{totalFees:this.sumFees(c),fees:c},swapTransactions:s}}createSwapTransactions(e){return Lo({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:e,sellFungible:this.quoteInput.sell})}appendPhantomFee(e,r){let n=r.fees.find(s=>s.type==="phantom");return n?[...e,{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)}]:e}async calculateNetworkFee(e,r,n,s){let o=await this.estimateGas(r,e,n,s);if(!o)throw new Error("Unable to estimate gas");let c=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!c.usd)throw new Error("Price data not found");let d=o[0],m=A.getTokenDecimals(this.networkID),p=d.gasLimit.times(d.maxFeePerGas),f=new b(p).shiftedBy(-m).times(c.usd);return{type:"evmGas",network:this.networkID,amountUsd:f,amount:p}}async estimateGas(e,r,n,s){let o=await ns(this.networkID,!0);if(!o)return;let c=o[Xr.standard];if(!c)return;let d={networkID:this.networkID,gasLimit:new b(1),maxFeePerGas:c.maxFeePerGas,maxPriorityFeePerGas:c.maxPriorityFeePerGas},m=await Ss({transactions:r,url:"https://phantom.app",deviceId:s,takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?fe.Auto:fe.Fixed,quote:e,quoteResponse:this.quoteResponse,isSimulationKilled:n});return gs.estimateGas({swapTransactions:r,evmGasEstimation:d,currentQuote:e,scanResult:m.status==="success"?m.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let e=this.account.addresses.find(n=>n.networkID===this.networkID);if(!e)throw new Error(`No address found for chain ${this.networkID}`);let r={...e};return cr(r)&&(r.address=r.address.toLowerCase()),r}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};u();l();var cc=class{static{a(this,"SolanaProcessBridgeQuoteCommand")}networkID;priceClient;connection;constructor(e,r,n){this.networkID=e,this.priceClient=r,this.connection=n}getNativeTokenCaip19(){return D({chainId:this.networkID,resourceType:W.nativeToken,slip44:A.getSlip44(this.networkID)})}async processQuote(e,r,n){let s=await this.createSwapTransactions(e),o=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!o.usd)throw new Error("Price data not found");let c=await this.calculateNetworkFee(s,o),d=this.appendBridgeFees([c],e,o),m=this.appendPhantomFee(d,e);return{quote:e,fees:{totalFees:this.sumFees(m),fees:m},swapTransactions:s}}createSwapTransactions(e){return Bo({quote:e,connection:this.connection})}appendPhantomFee(e,r){let n=r.steps.flatMap(s=>s.feeCosts).find(s=>s.name==="phantom");return n?[...e,{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)}]:e}appendBridgeFees(e,r,n){let s={[this.getNativeTokenCaip19()]:n},o=an(r,this.networkID,s),c=on(r);return[...e,...c,...o]}async calculateNetworkFee(e,r){if(!r.usd)throw new Error("Price data not found");let n=e.transactions.map(p=>this.processEncodedTx(p,this.networkID,this.connection)),o=(await Promise.all(n)).map(p=>p.networkFeeEstimation.value),c=new b(o[0]),m=c.div(new b(ue.LAMPORTS_PER_SOL)).times(r.usd);return{type:"solanaNetwork",network:this.networkID,amountUsd:m,amount:c}}async processEncodedTx(e,r,n){let s=mt(e,"bs58");return await Ui(s,n),{networkFeeEstimation:await Kf(r,[s.message])}}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};u();l();u();l();function Og(t,e,r){return ek(t.fees,n=>{switch(n.type){case"gasless":return{type:"gasless",amountUsd:new b(0),amount:new b(0),percentage:new b(n.percentage)};case"phantom":return{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)};case"ata":return new b(n.amount).isZero()?void 0:{type:"ata",amountUsd:new b(n.amount),amount:new b(0)};case"gasless_network":return{type:"solanaGaslessNetwork",amountUsd:new b(n.amount),amount:new b(0)};case"network":{let{amountUsd:s,amount:o}=Td(n,e);return{type:"solanaNetwork",network:r,amountUsd:s,amount:o}}case"tips":{let{amountUsd:s,amount:o}=Td(n,e);return{type:"tips",amountUsd:s,amount:o}}case"priority_fee":{let{amountUsd:s,amount:o}=Td(n,e);return{type:"priorityFee",amountUsd:s,amount:o}}case"prediction_fee_per_contract":return{type:"predictionFeePerContract",amountUsd:new b(n.amount),amount:new b(n.amount)};default:return}})}a(Og,"parseFees");function Td(t,e){let r=new b(t.amount);return{amountUsd:r.div(new b(ue.LAMPORTS_PER_SOL)).times(e),amount:r}}a(Td,"getAmountsFromNativeAmount");function ek(t,e){return t.reduce((r,n,s)=>{let o=e(n,s,t);return o!=null&&r.push(o),r},[])}a(ek,"compactMap");var tk=["solanaNetwork","tips","priorityFee"],rk=["solanaNetwork","tips"],uc=class{static{a(this,"SolanaProcessQuoteCommand")}networkID;priceClient;connection;constructor(e,r,n){this.networkID=e,this.priceClient=r,this.connection=n}getNativeTokenCaip19(){return D({chainId:this.networkID,resourceType:W.nativeToken,slip44:A.getSlip44(this.networkID)})}async processQuote(e,r,n){let o=(await this.priceClient.getPrice(this.getNativeTokenCaip19())).usd;if(!o)throw new Error(`Price data not found for native token ${this.getNativeTokenCaip19()}`);let c=await this.createSwapTransactions(e),d=Og(e,o,this.networkID),m=await this.processParsedFees(d,o);return{quote:e,fees:{totalFees:this.sumFees(m),fees:m},swapTransactions:c}}async processParsedFees(e,r){if(e.find(m=>m.type==="solanaGaslessNetwork"))return e;let n=e.filter(m=>!tk.includes(m.type)),s=e.filter(m=>rk.includes(m.type)),o=e.find(m=>m.type==="priorityFee"),c=await this.calculateNetworkFee(o,r),d=this.sumNetworkFees(c,s);return[...n,d]}sumNetworkFees(e,r){return r.reduce((n,s)=>({...n,amount:n.amount.plus(s.amount),amountUsd:n.amountUsd.plus(s.amountUsd)}),e)}createSwapTransactions(e){return ms({quote:e,connection:this.connection})}getAmountsFromNativeAmount(e,r){let n=new b(e.amount);return{amountUsd:n.div(new b(ue.LAMPORTS_PER_SOL)).times(r),amount:n}}async calculateNetworkFee(e,r){let n=new b(e?.amount??0),o=n.div(new b(ue.LAMPORTS_PER_SOL)).times(r);return{type:"solanaNetwork",network:this.networkID,amountUsd:o,amount:n}}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};u();l();u();l();var bs=class{static{a(this,"SuiProcessQuoteCommand")}networkID;priceClient;constructor(e,r){this.networkID=e,this.priceClient=r}getNativeTokenCaip19(){return D({chainId:this.networkID,resourceType:W.nativeToken,slip44:A.getSlip44(this.networkID)})}async processQuote(e,r,n){let s=await this.createSwapTransactions(e),o=await this.calculateNetworkFee(s),c=this.appendPhantomFee([o],e);return{quote:e,fees:{totalFees:this.sumFees(c),fees:c},swapTransactions:s}}createSwapTransactions(e){return Uo({quote:e})}appendPhantomFee(e,r){let n=r.fees.find(s=>s.type==="phantom");return n?[...e,{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)}]:e}async calculateNetworkFee(e){let r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let n=new b(0),s=new b(0);try{let o=await Promise.all(e.transactions.map(c=>$f({networkID:this.networkID,transaction:ea.deserializeTransactionString(c)})));s=new b(o.reduce((c,d)=>c+d.gasBudget.toNumber(),0)),n=s.dividedBy(1e9).multipliedBy(r.usd)}catch{return{type:"suiNetwork",network:this.networkID,amountUsd:new b(0),amount:new b(0)}}return{type:"suiNetwork",network:this.networkID,amountUsd:n,amount:s}}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};var lc=class{static{a(this,"SuiBridgeProcessQuoteCommand")}networkID;priceClient;suiProcessQuoteCommand;constructor(e,r){this.networkID=e,this.priceClient=r,this.suiProcessQuoteCommand=new bs(e,r)}getNativeTokenCaip19(){return this.suiProcessQuoteCommand.getNativeTokenCaip19()}async processQuote(e,r,n){let s=await this.createSwapTransactions(e),o=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!o.usd)throw new Error("Price data not found");let c=await this.suiProcessQuoteCommand.calculateNetworkFee(s),d=this.appendBridgeFees([c],e,o),m=this.appendPhantomFee(d,e);return{quote:e,fees:{totalFees:this.sumFees(m),fees:m},swapTransactions:s}}appendBridgeFees(e,r,n){let s={[this.getNativeTokenCaip19()]:n},o=an(r,this.networkID,s),c=on(r);return[...e,...c,...o]}appendPhantomFee(e,r){let n=r.steps.flatMap(s=>s.feeCosts).find(s=>s.name==="phantom");return n?[...e,{type:"phantom",percentage:new b(n.percentage),amountUsd:new b(0),amount:new b(0)}]:e}createSwapTransactions(e){return Oo({quote:e})}sumFees(e){return e.reduce((r,n)=>r.plus(n.amountUsd),new b(0))}};var dc=class{static{a(this,"ProcessQuoteCommandFactoryImpl")}create(e,r,n,s){let o=r.sell.data.chain.id,c=r.buy.data.chain.id,d=ht(o,c);if(A.isSolanaNetworkID(o)){let m=ah(e).connection;return d?new cc(o,this.priceClient,m):new uc(o,this.priceClient,m)}else{if(A.isEVMNetworkID(o))return d?new ic(o,e,this.priceClient,r,n):new ac(o,e,this.priceClient,r,n);if(A.isSuiNetworkID(o))return d?new lc(o,this.priceClient):new bs(o,this.priceClient);if(A.isBitcoinNetworkID(o)&&d)return new nc(o,this.priceClient)}throw new Error(`Unsupported network ID: ${o}`)}priceClient={getPrice:a(async e=>(await aa({tokens:[je(e)]}))[e],"getPrice")};isSupportedNetwork(e){return A.isSolanaNetworkID(e)||A.isEVMNetworkID(e)}},pc=class{static{a(this,"NoOpProcessQuoteCommandFactory")}create(e,r,n,s){return{processQuote:a(async(o,c,d)=>({quote:o,fees:{totalFees:new b(0),fees:[]}}),"processQuote")}}};u();l();u();l();u();l();var Ug="CASH";u();l();var Mg=a(t=>t.reduce((e,r)=>{if(!r||r.type!==ae.SPL)return e;let n;return r.type===ae.SPL&&(n=nk(r)),n?{fees:[...e.fees,n],totalPercentFees:e.totalPercentFees+n.percentFee}:e},{fees:[],totalPercentFees:0}),"getSwapTransferFees"),nk=a(t=>{if(t.type!==ae.SPL)return;let r=(t.data.mintExtensions??[]).find(n=>n.extension===sa.transferFeeConfig);if(r)return{caip19:D(Y(t)),fungibleKey:t.data.key,symbol:t.data.symbol??"",name:t.data.name??"",percentFee:r.state.newerTransferFee.transferFeeBasisPoints/100}},"getSplTransferFee");u();l();var sk=a(t=>t.isGreaterThanOrEqualTo(1)?"0,0.[00]":"0,0.[00000]","getFormatString"),Ed=a(t=>{let e=b(t);return df(t,sk(e))},"formatTokenAmountGreaterThan1");var ok=.05,ik=5,ak=.5;function Ad(t,e,r,n){let{priceImpact:s,quoteSlippageTolerance:o}=ck(t),c=e.autoSlippage?o??r.slippageTolerance:r.slippageTolerance,d={type:"slippage",slippage:c,slippageType:e.autoSlippage?fe.Auto:fe.Fixed,alert:c&&c>=ik?"highSlippage":void 0},m={type:"priceImpact",priceImpactPercentage:s.gt(0)?mf(s.toNumber()):"-",alert:s&&s.gte(ok)?"highPriceImpact":void 0,warning:s&&s.gte(ak)?"veryHighPriceImpact":void 0},f=[xd(t,e.buy,e.sell),d,m],g=Mg([e.sell,e.buy]);return g.fees.length>0&&f.push({type:"transferFees",transferFees:g.totalPercentFees,transferTokenSymbol:e.sell.data.symbol??"",alert:"transferFees"}),n&&f.push({type:"fees",quoteFees:n}),f}a(Ad,"entriesForQuote");function ck(t){return Qt(t)?{priceImpact:t.priceImpact?b(t.priceImpact):b(0),quoteSlippageTolerance:t.slippageTolerance}:rr(t)?{priceImpact:t.priceImpact?b(t.priceImpact):b(0),quoteSlippageTolerance:t.slippageTolerance}:_r(t)?{priceImpact:t.priceImpact?b(t.priceImpact):b(0),quoteSlippageTolerance:t.slippageTolerance}:{priceImpact:b(0),quoteSlippageTolerance:void 0}}a(ck,"extractQuoteInfo");function xd(t,e,r){let{buyAmount:n,sellAmount:s}=t,o=b(n).shiftedBy(-e.data.decimals).dividedBy(b(s).shiftedBy(-r.data.decimals));return{type:"pricing",ratio:o,exchangeRate:`1 ${mc(r)} \u2248 ${Ed(o)} ${mc(e)}`,exchangeRateFlipped:`1 ${mc(e)} \u2248 ${Ed(b(1).dividedBy(o))} ${mc(r)}`}}a(xd,"parsePricing");function mc(t){return ia(t)?Ug:t.data.symbol??""}a(mc,"cashDeobfuscatedSymbol");u();l();var fc=class{static{a(this,"AsyncQueue")}queue=[];processing=!1;enqueue(e){this.queue.push(e),this.processNext()}clearQueue(){this.queue=[],this.processing=!1}async processNext(){if(this.processing||this.queue.length===0)return;this.processing=!0;let e=this.queue.shift();if(e)try{await e()}catch(r){console.error("Error processing task:",r)}this.processing=!1,this.processNext()}};u();l();var Go=class{static{a(this,"QuoteDetails")}entries;alerts=[];warnings=[];constructor(e){this.entries=e;for(let r of e)r.alert&&this.alerts.push(r.alert),r.warning&&this.warnings.push(r.warning)}};var uk="swap-quotes",hc=class{static{a(this,"QuoteProcessor")}quoteStreamer;commandFactory;getDeviceId;state={type:"idle"};listeners=[];swapTransactionQueue=new fc;constructor(e,r,n){this.quoteStreamer=e,this.commandFactory=r,this.getDeviceId=n}start(e,r){this.setState({type:"starting",input:e,account:r}),this.quoteStreamer.subscribe(this.quoteStreamListener),this.quoteStreamer.openStream(e)}stop(){this.swapTransactionQueue.clearQueue(),this.setState({type:"idle"}),this.quoteStreamer.closeStream(),this.quoteStreamer.unsubscribe(this.quoteStreamListener)}setQuoteStreamer(e){this.stop(),this.quoteStreamer=e}quoteStreamListener={onEvent:a(e=>{switch(e.type){case"newQuoteResponse":switch(this.state.type){case"starting":let s=this.findPreferredQuote(this.state.input,e.quoteResponse);this.setState({type:"firstQuoteReceived",input:this.state.input,quote:s,response:e.quoteResponse,account:this.state.account,quoteDetails:new Go(Ad(s,this.state.input,e.quoteResponse))}),this.enqueueQuoteToProcess(this.state.input,e.quoteResponse,this.state.account);break;case"quoteProcessed":this.enqueueQuoteToProcess(this.state.input,e.quoteResponse,this.state.account,this.state.prevProcessedQuote);break}break;case"error":let r=Pa.fromErrorResponse(e.errorResponse.name,e.errorResponse.message),n=new We({key:r.name});switch(E.addBreadcrumb(uk,JSON.stringify(r.name),F.Info),this.state.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"error",error:n,quoteError:r,account:this.state.account,input:this.state.input});break}break;case"openRequested":break;case"close":this.setState({type:"idle"});break}},"onEvent")};enqueueQuoteToProcess(e,r,n,s){this.swapTransactionQueue.enqueue(()=>this.processQuote(r,e,n,s))}async processQuote(e,r,n,s){try{let o=this.findPreferredQuote(r,e),c=this.commandFactory.create(n,r,e,r.isSimulationKilled),d=await this.getDeviceId(),m=await c.processQuote(o,r.isSimulationKilled,d);switch(this.state.type){case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"quoteProcessed",input:r,response:e,quote:o,prevProcessedQuote:s,nextProcessedQuote:m,account:n,quoteDetails:new Go(Ad(o,r,e,m.fees))});break}return m}catch(o){throw fd(o)||E.captureError(o,I.Swapper),o}}subscribe(e){this.listeners.push(e)}unsubscribe(e){this.listeners=this.listeners.filter(r=>r!==e)}getState(){return this.state}findPreferredQuote(e,r){let n=e.preferredProvider;return n&&r.quotes.find(s=>s.baseProvider.id===n)||r.quotes[0]}setState(e){let r=this.state;this.state=e,this.listeners.forEach(n=>n.onStateChange(r,e))}};u();l();u();l();u();l();u();l();function ks(t){let e=t.length;for(;--e>=0;)t[e]=0}a(ks,"zero$1");var lk=0,xy=1,dk=2,pk=3,mk=258,Kd=29,oi=256,Xo=oi+1+Kd,As=30,Wd=19,Iy=2*Xo+1,kn=15,Id=16,fk=7,Zd=256,ky=16,Cy=17,_y=18,Md=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Tc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hk=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Fy=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gk=512,vr=new Array((Xo+2)*2);ks(vr);var Ko=new Array(As*2);ks(Ko);var Jo=new Array(gk);ks(Jo);var Yo=new Array(mk-pk+1);ks(Yo);var Xd=new Array(Kd);ks(Xd);var Ec=new Array(As);ks(Ec);function kd(t,e,r,n,s){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=t&&t.length}a(kd,"StaticTreeDesc");var Py,vy,Ry;function Cd(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}a(Cd,"TreeDesc");var Dy=a(t=>t<256?Jo[t]:Jo[256+(t>>>7)],"d_code"),ei=a((t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},"put_short"),kt=a((t,e,r)=>{t.bi_valid>Id-r?(t.bi_buf|=e<<t.bi_valid&65535,ei(t,t.bi_buf),t.bi_buf=e>>Id-t.bi_valid,t.bi_valid+=r-Id):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},"send_bits"),hr=a((t,e,r)=>{kt(t,r[e*2],r[e*2+1])},"send_code"),Ny=a((t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},"bi_reverse"),yk=a(t=>{t.bi_valid===16?(ei(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},"bi_flush"),wk=a((t,e)=>{let r=e.dyn_tree,n=e.max_code,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,m=e.stat_desc.max_length,p,f,g,w,y,S,x=0;for(w=0;w<=kn;w++)t.bl_count[w]=0;for(r[t.heap[t.heap_max]*2+1]=0,p=t.heap_max+1;p<Iy;p++)f=t.heap[p],w=r[r[f*2+1]*2+1]+1,w>m&&(w=m,x++),r[f*2+1]=w,!(f>n)&&(t.bl_count[w]++,y=0,f>=d&&(y=c[f-d]),S=r[f*2],t.opt_len+=S*(w+y),o&&(t.static_len+=S*(s[f*2+1]+y)));if(x!==0){do{for(w=m-1;t.bl_count[w]===0;)w--;t.bl_count[w]--,t.bl_count[w+1]+=2,t.bl_count[m]--,x-=2}while(x>0);for(w=m;w!==0;w--)for(f=t.bl_count[w];f!==0;)g=t.heap[--p],!(g>n)&&(r[g*2+1]!==w&&(t.opt_len+=(w-r[g*2+1])*r[g*2],r[g*2+1]=w),f--)}},"gen_bitlen"),By=a((t,e,r)=>{let n=new Array(kn+1),s=0,o,c;for(o=1;o<=kn;o++)s=s+r[o-1]<<1,n[o]=s;for(c=0;c<=e;c++){let d=t[c*2+1];d!==0&&(t[c*2]=Ny(n[d]++,d))}},"gen_codes"),Sk=a(()=>{let t,e,r,n,s,o=new Array(kn+1);for(r=0,n=0;n<Kd-1;n++)for(Xd[n]=r,t=0;t<1<<Md[n];t++)Yo[r++]=n;for(Yo[r-1]=n,s=0,n=0;n<16;n++)for(Ec[n]=s,t=0;t<1<<Tc[n];t++)Jo[s++]=n;for(s>>=7;n<As;n++)for(Ec[n]=s<<7,t=0;t<1<<Tc[n]-7;t++)Jo[256+s++]=n;for(e=0;e<=kn;e++)o[e]=0;for(t=0;t<=143;)vr[t*2+1]=8,t++,o[8]++;for(;t<=255;)vr[t*2+1]=9,t++,o[9]++;for(;t<=279;)vr[t*2+1]=7,t++,o[7]++;for(;t<=287;)vr[t*2+1]=8,t++,o[8]++;for(By(vr,Xo+1,o),t=0;t<As;t++)Ko[t*2+1]=5,Ko[t*2]=Ny(t,5);Py=new kd(vr,Md,oi+1,Xo,kn),vy=new kd(Ko,Tc,0,As,kn),Ry=new kd(new Array(0),hk,0,Wd,fk)},"tr_static_init"),Ly=a(t=>{let e;for(e=0;e<Xo;e++)t.dyn_ltree[e*2]=0;for(e=0;e<As;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Wd;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Zd*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},"init_block"),Oy=a(t=>{t.bi_valid>8?ei(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},"bi_windup"),qg=a((t,e,r,n)=>{let s=e*2,o=r*2;return t[s]<t[o]||t[s]===t[o]&&n[e]<=n[r]},"smaller"),_d=a((t,e,r)=>{let n=t.heap[r],s=r<<1;for(;s<=t.heap_len&&(s<t.heap_len&&qg(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!qg(e,n,t.heap[s],t.depth));)t.heap[r]=t.heap[s],r=s,s<<=1;t.heap[r]=n},"pqdownheap"),zg=a((t,e,r)=>{let n,s,o=0,c,d;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+o++]&255,n+=(t.pending_buf[t.sym_buf+o++]&255)<<8,s=t.pending_buf[t.sym_buf+o++],n===0?hr(t,s,e):(c=Yo[s],hr(t,c+oi+1,e),d=Md[c],d!==0&&(s-=Xd[c],kt(t,s,d)),n--,c=Dy(n),hr(t,c,r),d=Tc[c],d!==0&&(n-=Ec[c],kt(t,n,d)));while(o<t.sym_next);hr(t,Zd,e)},"compress_block"),qd=a((t,e)=>{let r=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.elems,c,d,m=-1,p;for(t.heap_len=0,t.heap_max=Iy,c=0;c<o;c++)r[c*2]!==0?(t.heap[++t.heap_len]=m=c,t.depth[c]=0):r[c*2+1]=0;for(;t.heap_len<2;)p=t.heap[++t.heap_len]=m<2?++m:0,r[p*2]=1,t.depth[p]=0,t.opt_len--,s&&(t.static_len-=n[p*2+1]);for(e.max_code=m,c=t.heap_len>>1;c>=1;c--)_d(t,r,c);p=o;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],_d(t,r,1),d=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=d,r[p*2]=r[c*2]+r[d*2],t.depth[p]=(t.depth[c]>=t.depth[d]?t.depth[c]:t.depth[d])+1,r[c*2+1]=r[d*2+1]=p,t.heap[1]=p++,_d(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],wk(t,e),By(r,m,t.bl_count)},"build_tree"),Qg=a((t,e,r)=>{let n,s=-1,o,c=e[0*2+1],d=0,m=7,p=4;for(c===0&&(m=138,p=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)o=c,c=e[(n+1)*2+1],!(++d<m&&o===c)&&(d<p?t.bl_tree[o*2]+=d:o!==0?(o!==s&&t.bl_tree[o*2]++,t.bl_tree[ky*2]++):d<=10?t.bl_tree[Cy*2]++:t.bl_tree[_y*2]++,d=0,s=o,c===0?(m=138,p=3):o===c?(m=6,p=3):(m=7,p=4))},"scan_tree"),Hg=a((t,e,r)=>{let n,s=-1,o,c=e[0*2+1],d=0,m=7,p=4;for(c===0&&(m=138,p=3),n=0;n<=r;n++)if(o=c,c=e[(n+1)*2+1],!(++d<m&&o===c)){if(d<p)do hr(t,o,t.bl_tree);while(--d!==0);else o!==0?(o!==s&&(hr(t,o,t.bl_tree),d--),hr(t,ky,t.bl_tree),kt(t,d-3,2)):d<=10?(hr(t,Cy,t.bl_tree),kt(t,d-3,3)):(hr(t,_y,t.bl_tree),kt(t,d-11,7));d=0,s=o,c===0?(m=138,p=3):o===c?(m=6,p=3):(m=7,p=4)}},"send_tree"),bk=a(t=>{let e;for(Qg(t,t.dyn_ltree,t.l_desc.max_code),Qg(t,t.dyn_dtree,t.d_desc.max_code),qd(t,t.bl_desc),e=Wd-1;e>=3&&t.bl_tree[Fy[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},"build_bl_tree"),Tk=a((t,e,r,n)=>{let s;for(kt(t,e-257,5),kt(t,r-1,5),kt(t,n-4,4),s=0;s<n;s++)kt(t,t.bl_tree[Fy[s]*2+1],3);Hg(t,t.dyn_ltree,e-1),Hg(t,t.dyn_dtree,r-1)},"send_all_trees"),Ek=a(t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<oi;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},"detect_data_type"),Gg=!1,Ak=a(t=>{Gg||(Sk(),Gg=!0),t.l_desc=new Cd(t.dyn_ltree,Py),t.d_desc=new Cd(t.dyn_dtree,vy),t.bl_desc=new Cd(t.bl_tree,Ry),t.bi_buf=0,t.bi_valid=0,Ly(t)},"_tr_init$1"),Uy=a((t,e,r,n)=>{kt(t,(lk<<1)+(n?1:0),3),Oy(t),ei(t,r),ei(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},"_tr_stored_block$1"),xk=a(t=>{kt(t,xy<<1,3),hr(t,Zd,vr),yk(t)},"_tr_align$1"),Ik=a((t,e,r,n)=>{let s,o,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Ek(t)),qd(t,t.l_desc),qd(t,t.d_desc),c=bk(t),s=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=s&&(s=o)):s=o=r+5,r+4<=s&&e!==-1?Uy(t,e,r,n):t.strategy===4||o===s?(kt(t,(xy<<1)+(n?1:0),3),zg(t,vr,Ko)):(kt(t,(dk<<1)+(n?1:0),3),Tk(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),zg(t,t.dyn_ltree,t.dyn_dtree)),Ly(t),n&&Oy(t)},"_tr_flush_block$1"),kk=a((t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(Yo[r]+oi+1)*2]++,t.dyn_dtree[Dy(e)*2]++),t.sym_next===t.sym_end),"_tr_tally$1"),Ck=Ak,_k=Uy,Fk=Ik,Pk=kk,vk=xk,Rk={_tr_init:Ck,_tr_stored_block:_k,_tr_flush_block:Fk,_tr_tally:Pk,_tr_align:vk},Dk=a((t,e,r,n)=>{let s=t&65535|0,o=t>>>16&65535|0,c=0;for(;r!==0;){c=r>2e3?2e3:r,r-=c;do s=s+e[n++]|0,o=o+s|0;while(--c);s%=65521,o%=65521}return s|o<<16|0},"adler32"),ti=Dk,Nk=a(()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},"makeTable"),Bk=new Uint32Array(Nk()),Lk=a((t,e,r,n)=>{let s=Bk,o=n+r;t^=-1;for(let c=n;c<o;c++)t=t>>>8^s[(t^e[c])&255];return t^-1},"crc32"),ot=Lk,Fn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Rn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Ok,_tr_stored_block:zd,_tr_flush_block:Uk,_tr_tally:ln,_tr_align:Mk}=Rk,{Z_NO_FLUSH:dn,Z_PARTIAL_FLUSH:qk,Z_FULL_FLUSH:zk,Z_FINISH:Vt,Z_BLOCK:Vg,Z_OK:at,Z_STREAM_END:$g,Z_STREAM_ERROR:gr,Z_DATA_ERROR:Qk,Z_BUF_ERROR:Fd,Z_DEFAULT_COMPRESSION:Hk,Z_FILTERED:Gk,Z_HUFFMAN_ONLY:gc,Z_RLE:Vk,Z_FIXED:$k,Z_DEFAULT_STRATEGY:jk,Z_UNKNOWN:Kk,Z_DEFLATED:Ic}=Rn,Wk=9,Zk=15,Xk=8,Jk=29,Yk=256,Qd=Yk+1+Jk,eC=30,tC=19,rC=2*Qd+1,nC=15,he=3,un=258,yr=un+he+1,sC=32,xs=42,Jd=57,Hd=69,Gd=73,Vd=91,$d=103,Cn=113,$o=666,Et=1,Cs=2,Pn=3,_s=4,oC=3,_n=a((t,e)=>(t.msg=Fn[e],e),"err"),jg=a(t=>t*2-(t>4?9:0),"rank"),cn=a(t=>{let e=t.length;for(;--e>=0;)t[e]=0},"zero"),iC=a(t=>{let e,r,n,s=t.w_size;e=t.hash_size,n=e;do r=t.head[--n],t.head[n]=r>=s?r-s:0;while(--e);e=s,n=e;do r=t.prev[--n],t.prev[n]=r>=s?r-s:0;while(--e)},"slide_hash"),aC=a((t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,"HASH_ZLIB"),pn=aC,Rt=a(t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},"flush_pending"),Dt=a((t,e)=>{Uk(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Rt(t.strm)},"flush_block_only"),Ce=a((t,e)=>{t.pending_buf[t.pending++]=e},"put_byte"),Vo=a((t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},"putShortMSB"),jd=a((t,e,r,n)=>{let s=t.avail_in;return s>n&&(s=n),s===0?0:(t.avail_in-=s,e.set(t.input.subarray(t.next_in,t.next_in+s),r),t.state.wrap===1?t.adler=ti(t.adler,e,s,r):t.state.wrap===2&&(t.adler=ot(t.adler,e,s,r)),t.next_in+=s,t.total_in+=s,s)},"read_buf"),My=a((t,e)=>{let r=t.max_chain_length,n=t.strstart,s,o,c=t.prev_length,d=t.nice_match,m=t.strstart>t.w_size-yr?t.strstart-(t.w_size-yr):0,p=t.window,f=t.w_mask,g=t.prev,w=t.strstart+un,y=p[n+c-1],S=p[n+c];t.prev_length>=t.good_match&&(r>>=2),d>t.lookahead&&(d=t.lookahead);do if(s=e,!(p[s+c]!==S||p[s+c-1]!==y||p[s]!==p[n]||p[++s]!==p[n+1])){n+=2,s++;do;while(p[++n]===p[++s]&&p[++n]===p[++s]&&p[++n]===p[++s]&&p[++n]===p[++s]&&p[++n]===p[++s]&&p[++n]===p[++s]&&p[++n]===p[++s]&&p[++n]===p[++s]&&n<w);if(o=un-(w-n),n=w-un,o>c){if(t.match_start=e,c=o,o>=d)break;y=p[n+c-1],S=p[n+c]}}while((e=g[e&f])>m&&--r!==0);return c<=t.lookahead?c:t.lookahead},"longest_match"),Is=a(t=>{let e=t.w_size,r,n,s;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-yr)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),iC(t),n+=e),t.strm.avail_in===0)break;if(r=jd(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=he)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=pn(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=pn(t,t.ins_h,t.window[s+he-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<he)););}while(t.lookahead<yr&&t.strm.avail_in!==0)},"fill_window"),qy=a((t,e)=>{let r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,s,o,c=0,d=t.strm.avail_in;do{if(n=65535,o=t.bi_valid+42>>3,t.strm.avail_out<o||(o=t.strm.avail_out-o,s=t.strstart-t.block_start,n>s+t.strm.avail_in&&(n=s+t.strm.avail_in),n>o&&(n=o),n<r&&(n===0&&e!==Vt||e===dn||n!==s+t.strm.avail_in)))break;c=e===Vt&&n===s+t.strm.avail_in?1:0,zd(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Rt(t.strm),s&&(s>n&&(s=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,n-=s),n&&(jd(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return d-=t.strm.avail_in,d&&(d>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=d&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-d,t.strm.next_in),t.strstart),t.strstart+=d,t.insert+=d>t.w_size-t.insert?t.w_size-t.insert:d),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?_s:e!==dn&&e!==Vt&&t.strm.avail_in===0&&t.strstart===t.block_start?Cs:(o=t.window_size-t.strstart,t.strm.avail_in>o&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,o+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),o>t.strm.avail_in&&(o=t.strm.avail_in),o&&(jd(t.strm,t.window,t.strstart,o),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.high_water<t.strstart&&(t.high_water=t.strstart),o=t.bi_valid+42>>3,o=t.pending_buf_size-o>65535?65535:t.pending_buf_size-o,r=o>t.w_size?t.w_size:o,s=t.strstart-t.block_start,(s>=r||(s||e===Vt)&&e!==dn&&t.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,c=e===Vt&&t.strm.avail_in===0&&n===s?1:0,zd(t,t.block_start,n,c),t.block_start+=n,Rt(t.strm)),c?Pn:Et)},"deflate_stored"),Pd=a((t,e)=>{let r,n;for(;;){if(t.lookahead<yr){if(Is(t),t.lookahead<yr&&e===dn)return Et;if(t.lookahead===0)break}if(r=0,t.lookahead>=he&&(t.ins_h=pn(t,t.ins_h,t.window[t.strstart+he-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-yr&&(t.match_length=My(t,r)),t.match_length>=he)if(n=ln(t,t.strstart-t.match_start,t.match_length-he),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=he){t.match_length--;do t.strstart++,t.ins_h=pn(t,t.ins_h,t.window[t.strstart+he-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=pn(t,t.ins_h,t.window[t.strstart+1]);else n=ln(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Dt(t,!1),t.strm.avail_out===0))return Et}return t.insert=t.strstart<he-1?t.strstart:he-1,e===Vt?(Dt(t,!0),t.strm.avail_out===0?Pn:_s):t.sym_next&&(Dt(t,!1),t.strm.avail_out===0)?Et:Cs},"deflate_fast"),Ts=a((t,e)=>{let r,n,s;for(;;){if(t.lookahead<yr){if(Is(t),t.lookahead<yr&&e===dn)return Et;if(t.lookahead===0)break}if(r=0,t.lookahead>=he&&(t.ins_h=pn(t,t.ins_h,t.window[t.strstart+he-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=he-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-yr&&(t.match_length=My(t,r),t.match_length<=5&&(t.strategy===Gk||t.match_length===he&&t.strstart-t.match_start>4096)&&(t.match_length=he-1)),t.prev_length>=he&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-he,n=ln(t,t.strstart-1-t.prev_match,t.prev_length-he),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=pn(t,t.ins_h,t.window[t.strstart+he-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=he-1,t.strstart++,n&&(Dt(t,!1),t.strm.avail_out===0))return Et}else if(t.match_available){if(n=ln(t,0,t.window[t.strstart-1]),n&&Dt(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Et}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ln(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<he-1?t.strstart:he-1,e===Vt?(Dt(t,!0),t.strm.avail_out===0?Pn:_s):t.sym_next&&(Dt(t,!1),t.strm.avail_out===0)?Et:Cs},"deflate_slow"),cC=a((t,e)=>{let r,n,s,o,c=t.window;for(;;){if(t.lookahead<=un){if(Is(t),t.lookahead<=un&&e===dn)return Et;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=he&&t.strstart>0&&(s=t.strstart-1,n=c[s],n===c[++s]&&n===c[++s]&&n===c[++s])){o=t.strstart+un;do;while(n===c[++s]&&n===c[++s]&&n===c[++s]&&n===c[++s]&&n===c[++s]&&n===c[++s]&&n===c[++s]&&n===c[++s]&&s<o);t.match_length=un-(o-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=he?(r=ln(t,1,t.match_length-he),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=ln(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Dt(t,!1),t.strm.avail_out===0))return Et}return t.insert=0,e===Vt?(Dt(t,!0),t.strm.avail_out===0?Pn:_s):t.sym_next&&(Dt(t,!1),t.strm.avail_out===0)?Et:Cs},"deflate_rle"),uC=a((t,e)=>{let r;for(;;){if(t.lookahead===0&&(Is(t),t.lookahead===0)){if(e===dn)return Et;break}if(t.match_length=0,r=ln(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Dt(t,!1),t.strm.avail_out===0))return Et}return t.insert=0,e===Vt?(Dt(t,!0),t.strm.avail_out===0?Pn:_s):t.sym_next&&(Dt(t,!1),t.strm.avail_out===0)?Et:Cs},"deflate_huff");function fr(t,e,r,n,s){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=s}a(fr,"Config");var jo=[new fr(0,0,0,0,qy),new fr(4,4,8,4,Pd),new fr(4,5,16,8,Pd),new fr(4,6,32,32,Pd),new fr(4,4,16,16,Ts),new fr(8,16,32,32,Ts),new fr(8,16,128,128,Ts),new fr(8,32,128,256,Ts),new fr(32,128,258,1024,Ts),new fr(32,258,258,4096,Ts)],lC=a(t=>{t.window_size=2*t.w_size,cn(t.head),t.max_lazy_match=jo[t.level].max_lazy,t.good_match=jo[t.level].good_length,t.nice_match=jo[t.level].nice_length,t.max_chain_length=jo[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=he-1,t.match_available=0,t.ins_h=0},"lm_init");function dC(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ic,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(rC*2),this.dyn_dtree=new Uint16Array((2*eC+1)*2),this.bl_tree=new Uint16Array((2*tC+1)*2),cn(this.dyn_ltree),cn(this.dyn_dtree),cn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(nC+1),this.heap=new Uint16Array(2*Qd+1),cn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Qd+1),cn(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}a(dC,"DeflateState");var ii=a(t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.status!==xs&&e.status!==Jd&&e.status!==Hd&&e.status!==Gd&&e.status!==Vd&&e.status!==$d&&e.status!==Cn&&e.status!==$o?1:0},"deflateStateCheck"),zy=a(t=>{if(ii(t))return _n(t,gr);t.total_in=t.total_out=0,t.data_type=Kk;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Jd:e.wrap?xs:Cn,t.adler=e.wrap===2?0:1,e.last_flush=-2,Ok(e),at},"deflateResetKeep"),Qy=a(t=>{let e=zy(t);return e===at&&lC(t.state),e},"deflateReset"),pC=a((t,e)=>ii(t)||t.state.wrap!==2?gr:(t.state.gzhead=e,at),"deflateSetHeader"),Hy=a((t,e,r,n,s,o)=>{if(!t)return gr;let c=1;if(e===Hk&&(e=6),n<0?(c=0,n=-n):n>15&&(c=2,n-=16),s<1||s>Wk||r!==Ic||n<8||n>15||e<0||e>9||o<0||o>$k||n===8&&c!==1)return _n(t,gr);n===8&&(n=9);let d=new dC;return t.state=d,d.strm=t,d.status=xs,d.wrap=c,d.gzhead=null,d.w_bits=n,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=s+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+he-1)/he),d.window=new Uint8Array(d.w_size*2),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<s+6,d.pending_buf_size=d.lit_bufsize*4,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=(d.lit_bufsize-1)*3,d.level=e,d.strategy=o,d.method=r,Qy(t)},"deflateInit2"),mC=a((t,e)=>Hy(t,e,Ic,Zk,Xk,jk),"deflateInit"),fC=a((t,e)=>{if(ii(t)||e>Vg||e<0)return t?_n(t,gr):gr;let r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===$o&&e!==Vt)return _n(t,t.avail_out===0?Fd:gr);let n=r.last_flush;if(r.last_flush=e,r.pending!==0){if(Rt(t),t.avail_out===0)return r.last_flush=-1,at}else if(t.avail_in===0&&jg(e)<=jg(n)&&e!==Vt)return _n(t,Fd);if(r.status===$o&&t.avail_in!==0)return _n(t,Fd);if(r.status===xs&&r.wrap===0&&(r.status=Cn),r.status===xs){let s=Ic+(r.w_bits-8<<4)<<8,o=-1;if(r.strategy>=gc||r.level<2?o=0:r.level<6?o=1:r.level===6?o=2:o=3,s|=o<<6,r.strstart!==0&&(s|=sC),s+=31-s%31,Vo(r,s),r.strstart!==0&&(Vo(r,t.adler>>>16),Vo(r,t.adler&65535)),t.adler=1,r.status=Cn,Rt(t),r.pending!==0)return r.last_flush=-1,at}if(r.status===Jd){if(t.adler=0,Ce(r,31),Ce(r,139),Ce(r,8),r.gzhead)Ce(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ce(r,r.gzhead.time&255),Ce(r,r.gzhead.time>>8&255),Ce(r,r.gzhead.time>>16&255),Ce(r,r.gzhead.time>>24&255),Ce(r,r.level===9?2:r.strategy>=gc||r.level<2?4:0),Ce(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(Ce(r,r.gzhead.extra.length&255),Ce(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=ot(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Hd;else if(Ce(r,0),Ce(r,0),Ce(r,0),Ce(r,0),Ce(r,0),Ce(r,r.level===9?2:r.strategy>=gc||r.level<2?4:0),Ce(r,oC),r.status=Cn,Rt(t),r.pending!==0)return r.last_flush=-1,at}if(r.status===Hd){if(r.gzhead.extra){let s=r.pending,o=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let d=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>s&&(t.adler=ot(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex+=d,Rt(t),r.pending!==0)return r.last_flush=-1,at;s=0,o-=d}let c=new Uint8Array(r.gzhead.extra);r.pending_buf.set(c.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>s&&(t.adler=ot(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=Gd}if(r.status===Gd){if(r.gzhead.name){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(t.adler=ot(t.adler,r.pending_buf,r.pending-s,s)),Rt(t),r.pending!==0)return r.last_flush=-1,at;s=0}r.gzindex<r.gzhead.name.length?o=r.gzhead.name.charCodeAt(r.gzindex++)&255:o=0,Ce(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(t.adler=ot(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=Vd}if(r.status===Vd){if(r.gzhead.comment){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(t.adler=ot(t.adler,r.pending_buf,r.pending-s,s)),Rt(t),r.pending!==0)return r.last_flush=-1,at;s=0}r.gzindex<r.gzhead.comment.length?o=r.gzhead.comment.charCodeAt(r.gzindex++)&255:o=0,Ce(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(t.adler=ot(t.adler,r.pending_buf,r.pending-s,s))}r.status=$d}if(r.status===$d){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Rt(t),r.pending!==0))return r.last_flush=-1,at;Ce(r,t.adler&255),Ce(r,t.adler>>8&255),t.adler=0}if(r.status=Cn,Rt(t),r.pending!==0)return r.last_flush=-1,at}if(t.avail_in!==0||r.lookahead!==0||e!==dn&&r.status!==$o){let s=r.level===0?qy(r,e):r.strategy===gc?uC(r,e):r.strategy===Vk?cC(r,e):jo[r.level].func(r,e);if((s===Pn||s===_s)&&(r.status=$o),s===Et||s===Pn)return t.avail_out===0&&(r.last_flush=-1),at;if(s===Cs&&(e===qk?Mk(r):e!==Vg&&(zd(r,0,0,!1),e===zk&&(cn(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Rt(t),t.avail_out===0))return r.last_flush=-1,at}return e!==Vt?at:r.wrap<=0?$g:(r.wrap===2?(Ce(r,t.adler&255),Ce(r,t.adler>>8&255),Ce(r,t.adler>>16&255),Ce(r,t.adler>>24&255),Ce(r,t.total_in&255),Ce(r,t.total_in>>8&255),Ce(r,t.total_in>>16&255),Ce(r,t.total_in>>24&255)):(Vo(r,t.adler>>>16),Vo(r,t.adler&65535)),Rt(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?at:$g)},"deflate$2"),hC=a(t=>{if(ii(t))return gr;let e=t.state.status;return t.state=null,e===Cn?_n(t,Qk):at},"deflateEnd"),gC=a((t,e)=>{let r=e.length;if(ii(t))return gr;let n=t.state,s=n.wrap;if(s===2||s===1&&n.status!==xs||n.lookahead)return gr;if(s===1&&(t.adler=ti(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){s===0&&(cn(n.head),n.strstart=0,n.block_start=0,n.insert=0);let m=new Uint8Array(n.w_size);m.set(e.subarray(r-n.w_size,r),0),e=m,r=n.w_size}let o=t.avail_in,c=t.next_in,d=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Is(n);n.lookahead>=he;){let m=n.strstart,p=n.lookahead-(he-1);do n.ins_h=pn(n,n.ins_h,n.window[m+he-1]),n.prev[m&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=m,m++;while(--p);n.strstart=m,n.lookahead=he-1,Is(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=he-1,n.match_available=0,t.next_in=c,t.input=d,t.avail_in=o,n.wrap=s,at},"deflateSetDictionary"),yC=mC,wC=Hy,SC=Qy,bC=zy,TC=pC,EC=fC,AC=hC,xC=gC,IC="pako deflate (from Nodeca project)",Wo={deflateInit:yC,deflateInit2:wC,deflateReset:SC,deflateResetKeep:bC,deflateSetHeader:TC,deflate:EC,deflateEnd:AC,deflateSetDictionary:xC,deflateInfo:IC},kC=a((t,e)=>Object.prototype.hasOwnProperty.call(t,e),"_has"),CC=a(function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let n in r)kC(r,n)&&(t[n]=r[n])}}return t},"assign"),_C=a(t=>{let e=0;for(let n=0,s=t.length;n<s;n++)e+=t[n].length;let r=new Uint8Array(e);for(let n=0,s=0,o=t.length;n<o;n++){let c=t[n];r.set(c,s),s+=c.length}return r},"flattenChunks"),kc={assign:CC,flattenChunks:_C},Gy=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Gy=!1}var ri=new Uint8Array(256);for(let t=0;t<256;t++)ri[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;ri[254]=ri[254]=1;var FC=a(t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,s,o,c=t.length,d=0;for(s=0;s<c;s++)r=t.charCodeAt(s),(r&64512)===55296&&s+1<c&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),d+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(d),o=0,s=0;o<d;s++)r=t.charCodeAt(s),(r&64512)===55296&&s+1<c&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|r&63):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|r&63):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|r&63);return e},"string2buf"),PC=a((t,e)=>{if(e<65534&&t.subarray&&Gy)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r},"buf2binstring"),vC=a((t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,s,o=new Array(r*2);for(s=0,n=0;n<r;){let c=t[n++];if(c<128){o[s++]=c;continue}let d=ri[c];if(d>4){o[s++]=65533,n+=d-1;continue}for(c&=d===2?31:d===3?15:7;d>1&&n<r;)c=c<<6|t[n++]&63,d--;if(d>1){o[s++]=65533;continue}c<65536?o[s++]=c:(c-=65536,o[s++]=55296|c>>10&1023,o[s++]=56320|c&1023)}return PC(o,s)},"buf2string"),RC=a((t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+ri[t[r]]>e?r:e},"utf8border"),ni={string2buf:FC,buf2string:vC,utf8border:RC};function DC(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}a(DC,"ZStream");var Vy=DC,$y=Object.prototype.toString,{Z_NO_FLUSH:NC,Z_SYNC_FLUSH:BC,Z_FULL_FLUSH:LC,Z_FINISH:OC,Z_OK:Ac,Z_STREAM_END:UC,Z_DEFAULT_COMPRESSION:MC,Z_DEFAULT_STRATEGY:qC,Z_DEFLATED:zC}=Rn;function ai(t){this.options=kc.assign({level:MC,method:zC,chunkSize:16384,windowBits:15,memLevel:8,strategy:qC},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vy,this.strm.avail_out=0;let r=Wo.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Ac)throw new Error(Fn[r]);if(e.header&&Wo.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=ni.string2buf(e.dictionary):$y.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=Wo.deflateSetDictionary(this.strm,n),r!==Ac)throw new Error(Fn[r]);this._dict_set=!0}}a(ai,"Deflate$1");ai.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,s,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?OC:NC,typeof t=="string"?r.input=ni.string2buf(t):$y.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===BC||o===LC)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(s=Wo.deflate(r,o),s===UC)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=Wo.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Ac;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};ai.prototype.onData=function(t){this.chunks.push(t)};ai.prototype.onEnd=function(t){t===Ac&&(this.result=kc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Yd(t,e){let r=new ai(e);if(r.push(t,!0),r.err)throw r.msg||Fn[r.err];return r.result}a(Yd,"deflate$1");function QC(t,e){return e=e||{},e.raw=!0,Yd(t,e)}a(QC,"deflateRaw$1");function HC(t,e){return e=e||{},e.gzip=!0,Yd(t,e)}a(HC,"gzip$1");var GC=ai,VC=Yd,$C=QC,jC=HC,KC=Rn,WC={Deflate:GC,deflate:VC,deflateRaw:$C,gzip:jC,constants:KC},yc=16209,ZC=16191,XC=a(function(e,r){let n,s,o,c,d,m,p,f,g,w,y,S,x,T,_,k,P,v,z,Q,R,G,M,C,N=e.state;n=e.next_in,M=e.input,s=n+(e.avail_in-5),o=e.next_out,C=e.output,c=o-(r-e.avail_out),d=o+(e.avail_out-257),m=N.dmax,p=N.wsize,f=N.whave,g=N.wnext,w=N.window,y=N.hold,S=N.bits,x=N.lencode,T=N.distcode,_=(1<<N.lenbits)-1,k=(1<<N.distbits)-1;e:do{S<15&&(y+=M[n++]<<S,S+=8,y+=M[n++]<<S,S+=8),P=x[y&_];t:for(;;){if(v=P>>>24,y>>>=v,S-=v,v=P>>>16&255,v===0)C[o++]=P&65535;else if(v&16){z=P&65535,v&=15,v&&(S<v&&(y+=M[n++]<<S,S+=8),z+=y&(1<<v)-1,y>>>=v,S-=v),S<15&&(y+=M[n++]<<S,S+=8,y+=M[n++]<<S,S+=8),P=T[y&k];r:for(;;){if(v=P>>>24,y>>>=v,S-=v,v=P>>>16&255,v&16){if(Q=P&65535,v&=15,S<v&&(y+=M[n++]<<S,S+=8,S<v&&(y+=M[n++]<<S,S+=8)),Q+=y&(1<<v)-1,Q>m){e.msg="invalid distance too far back",N.mode=yc;break e}if(y>>>=v,S-=v,v=o-c,Q>v){if(v=Q-v,v>f&&N.sane){e.msg="invalid distance too far back",N.mode=yc;break e}if(R=0,G=w,g===0){if(R+=p-v,v<z){z-=v;do C[o++]=w[R++];while(--v);R=o-Q,G=C}}else if(g<v){if(R+=p+g-v,v-=g,v<z){z-=v;do C[o++]=w[R++];while(--v);if(R=0,g<z){v=g,z-=v;do C[o++]=w[R++];while(--v);R=o-Q,G=C}}}else if(R+=g-v,v<z){z-=v;do C[o++]=w[R++];while(--v);R=o-Q,G=C}for(;z>2;)C[o++]=G[R++],C[o++]=G[R++],C[o++]=G[R++],z-=3;z&&(C[o++]=G[R++],z>1&&(C[o++]=G[R++]))}else{R=o-Q;do C[o++]=C[R++],C[o++]=C[R++],C[o++]=C[R++],z-=3;while(z>2);z&&(C[o++]=C[R++],z>1&&(C[o++]=C[R++]))}}else if(v&64){e.msg="invalid distance code",N.mode=yc;break e}else{P=T[(P&65535)+(y&(1<<v)-1)];continue r}break}}else if(v&64)if(v&32){N.mode=ZC;break e}else{e.msg="invalid literal/length code",N.mode=yc;break e}else{P=x[(P&65535)+(y&(1<<v)-1)];continue t}break}}while(n<s&&o<d);z=S>>3,n-=z,S-=z<<3,y&=(1<<S)-1,e.next_in=n,e.next_out=o,e.avail_in=n<s?5+(s-n):5-(n-s),e.avail_out=o<d?257+(d-o):257-(o-d),N.hold=y,N.bits=S},"inflate_fast"),Es=15,Kg=852,Wg=592,Zg=0,vd=1,Xg=2,JC=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),YC=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),e_=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t_=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),r_=a((t,e,r,n,s,o,c,d)=>{let m=d.bits,p=0,f=0,g=0,w=0,y=0,S=0,x=0,T=0,_=0,k=0,P,v,z,Q,R,G=null,M,C=new Uint16Array(Es+1),N=new Uint16Array(Es+1),Z=null,oe,re,J;for(p=0;p<=Es;p++)C[p]=0;for(f=0;f<n;f++)C[e[r+f]]++;for(y=m,w=Es;w>=1&&C[w]===0;w--);if(y>w&&(y=w),w===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,d.bits=1,0;for(g=1;g<w&&C[g]===0;g++);for(y<g&&(y=g),T=1,p=1;p<=Es;p++)if(T<<=1,T-=C[p],T<0)return-1;if(T>0&&(t===Zg||w!==1))return-1;for(N[1]=0,p=1;p<Es;p++)N[p+1]=N[p]+C[p];for(f=0;f<n;f++)e[r+f]!==0&&(c[N[e[r+f]]++]=f);if(t===Zg?(G=Z=c,M=20):t===vd?(G=JC,Z=YC,M=257):(G=e_,Z=t_,M=0),k=0,f=0,p=g,R=o,S=y,x=0,z=-1,_=1<<y,Q=_-1,t===vd&&_>Kg||t===Xg&&_>Wg)return 1;for(;;){oe=p-x,c[f]+1<M?(re=0,J=c[f]):c[f]>=M?(re=Z[c[f]-M],J=G[c[f]-M]):(re=96,J=0),P=1<<p-x,v=1<<S,g=v;do v-=P,s[R+(k>>x)+v]=oe<<24|re<<16|J|0;while(v!==0);for(P=1<<p-1;k&P;)P>>=1;if(P!==0?(k&=P-1,k+=P):k=0,f++,--C[p]===0){if(p===w)break;p=e[r+c[f]]}if(p>y&&(k&Q)!==z){for(x===0&&(x=y),R+=g,S=p-x,T=1<<S;S+x<w&&(T-=C[S+x],!(T<=0));)S++,T<<=1;if(_+=1<<S,t===vd&&_>Kg||t===Xg&&_>Wg)return 1;z=k&Q,s[z]=y<<24|S<<16|R-o|0}}return k!==0&&(s[R+k]=p-x<<24|64<<16|0),d.bits=y,0},"inflate_table"),Zo=r_,n_=0,jy=1,Ky=2,{Z_FINISH:Jg,Z_BLOCK:s_,Z_TREES:wc,Z_OK:vn,Z_STREAM_END:o_,Z_NEED_DICT:i_,Z_STREAM_ERROR:$t,Z_DATA_ERROR:Wy,Z_MEM_ERROR:Zy,Z_BUF_ERROR:a_,Z_DEFLATED:Yg}=Rn,Cc=16180,ey=16181,ty=16182,ry=16183,ny=16184,sy=16185,oy=16186,iy=16187,ay=16188,cy=16189,xc=16190,Pr=16191,Rd=16192,uy=16193,Dd=16194,ly=16195,dy=16196,py=16197,my=16198,Sc=16199,bc=16200,fy=16201,hy=16202,gy=16203,yy=16204,wy=16205,Nd=16206,Sy=16207,by=16208,Ue=16209,Xy=16210,Jy=16211,c_=852,u_=592,l_=15,d_=l_,Ty=a(t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24),"zswap32");function p_(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}a(p_,"InflateState");var Dn=a(t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.mode<Cc||e.mode>Jy?1:0},"inflateStateCheck"),Yy=a(t=>{if(Dn(t))return $t;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Cc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(c_),e.distcode=e.distdyn=new Int32Array(u_),e.sane=1,e.back=-1,vn},"inflateResetKeep"),ew=a(t=>{if(Dn(t))return $t;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Yy(t)},"inflateReset"),tw=a((t,e)=>{let r;if(Dn(t))return $t;let n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?$t:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,ew(t))},"inflateReset2"),rw=a((t,e)=>{if(!t)return $t;let r=new p_;t.state=r,r.strm=t,r.window=null,r.mode=Cc;let n=tw(t,e);return n!==vn&&(t.state=null),n},"inflateInit2"),m_=a(t=>rw(t,d_),"inflateInit"),Ey=!0,Bd,Ld,f_=a(t=>{if(Ey){Bd=new Int32Array(512),Ld=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Zo(jy,t.lens,0,288,Bd,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Zo(Ky,t.lens,0,32,Ld,0,t.work,{bits:5}),Ey=!1}t.lencode=Bd,t.lenbits=9,t.distcode=Ld,t.distbits=5},"fixedtables"),nw=a((t,e,r,n)=>{let s,o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>n&&(s=n),o.window.set(e.subarray(r-n,r-n+s),o.wnext),n-=s,n?(o.window.set(e.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0},"updatewindow"),h_=a((t,e)=>{let r,n,s,o,c,d,m,p,f,g,w,y,S,x,T=0,_,k,P,v,z,Q,R,G,M=new Uint8Array(4),C,N,Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Dn(t)||!t.output||!t.input&&t.avail_in!==0)return $t;r=t.state,r.mode===Pr&&(r.mode=Rd),c=t.next_out,s=t.output,m=t.avail_out,o=t.next_in,n=t.input,d=t.avail_in,p=r.hold,f=r.bits,g=d,w=m,G=vn;e:for(;;)switch(r.mode){case Cc:if(r.wrap===0){r.mode=Rd;break}for(;f<16;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(r.wrap&2&&p===35615){r.wbits===0&&(r.wbits=15),r.check=0,M[0]=p&255,M[1]=p>>>8&255,r.check=ot(r.check,M,2,0),p=0,f=0,r.mode=ey;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((p&255)<<8)+(p>>8))%31){t.msg="incorrect header check",r.mode=Ue;break}if((p&15)!==Yg){t.msg="unknown compression method",r.mode=Ue;break}if(p>>>=4,f-=4,R=(p&15)+8,r.wbits===0&&(r.wbits=R),R>15||R>r.wbits){t.msg="invalid window size",r.mode=Ue;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=p&512?cy:Pr,p=0,f=0;break;case ey:for(;f<16;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(r.flags=p,(r.flags&255)!==Yg){t.msg="unknown compression method",r.mode=Ue;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=Ue;break}r.head&&(r.head.text=p>>8&1),r.flags&512&&r.wrap&4&&(M[0]=p&255,M[1]=p>>>8&255,r.check=ot(r.check,M,2,0)),p=0,f=0,r.mode=ty;case ty:for(;f<32;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}r.head&&(r.head.time=p),r.flags&512&&r.wrap&4&&(M[0]=p&255,M[1]=p>>>8&255,M[2]=p>>>16&255,M[3]=p>>>24&255,r.check=ot(r.check,M,4,0)),p=0,f=0,r.mode=ry;case ry:for(;f<16;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}r.head&&(r.head.xflags=p&255,r.head.os=p>>8),r.flags&512&&r.wrap&4&&(M[0]=p&255,M[1]=p>>>8&255,r.check=ot(r.check,M,2,0)),p=0,f=0,r.mode=ny;case ny:if(r.flags&1024){for(;f<16;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}r.length=p,r.head&&(r.head.extra_len=p),r.flags&512&&r.wrap&4&&(M[0]=p&255,M[1]=p>>>8&255,r.check=ot(r.check,M,2,0)),p=0,f=0}else r.head&&(r.head.extra=null);r.mode=sy;case sy:if(r.flags&1024&&(y=r.length,y>d&&(y=d),y&&(r.head&&(R=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+y),R)),r.flags&512&&r.wrap&4&&(r.check=ot(r.check,n,y,o)),d-=y,o+=y,r.length-=y),r.length))break e;r.length=0,r.mode=oy;case oy:if(r.flags&2048){if(d===0)break e;y=0;do R=n[o+y++],r.head&&R&&r.length<65536&&(r.head.name+=String.fromCharCode(R));while(R&&y<d);if(r.flags&512&&r.wrap&4&&(r.check=ot(r.check,n,y,o)),d-=y,o+=y,R)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=iy;case iy:if(r.flags&4096){if(d===0)break e;y=0;do R=n[o+y++],r.head&&R&&r.length<65536&&(r.head.comment+=String.fromCharCode(R));while(R&&y<d);if(r.flags&512&&r.wrap&4&&(r.check=ot(r.check,n,y,o)),d-=y,o+=y,R)break e}else r.head&&(r.head.comment=null);r.mode=ay;case ay:if(r.flags&512){for(;f<16;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(r.wrap&4&&p!==(r.check&65535)){t.msg="header crc mismatch",r.mode=Ue;break}p=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=Pr;break;case cy:for(;f<32;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}t.adler=r.check=Ty(p),p=0,f=0,r.mode=xc;case xc:if(r.havedict===0)return t.next_out=c,t.avail_out=m,t.next_in=o,t.avail_in=d,r.hold=p,r.bits=f,i_;t.adler=r.check=1,r.mode=Pr;case Pr:if(e===s_||e===wc)break e;case Rd:if(r.last){p>>>=f&7,f-=f&7,r.mode=Nd;break}for(;f<3;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}switch(r.last=p&1,p>>>=1,f-=1,p&3){case 0:r.mode=uy;break;case 1:if(f_(r),r.mode=Sc,e===wc){p>>>=2,f-=2;break e}break;case 2:r.mode=dy;break;case 3:t.msg="invalid block type",r.mode=Ue}p>>>=2,f-=2;break;case uy:for(p>>>=f&7,f-=f&7;f<32;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if((p&65535)!==(p>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Ue;break}if(r.length=p&65535,p=0,f=0,r.mode=Dd,e===wc)break e;case Dd:r.mode=ly;case ly:if(y=r.length,y){if(y>d&&(y=d),y>m&&(y=m),y===0)break e;s.set(n.subarray(o,o+y),c),d-=y,o+=y,m-=y,c+=y,r.length-=y;break}r.mode=Pr;break;case dy:for(;f<14;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(r.nlen=(p&31)+257,p>>>=5,f-=5,r.ndist=(p&31)+1,p>>>=5,f-=5,r.ncode=(p&15)+4,p>>>=4,f-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Ue;break}r.have=0,r.mode=py;case py:for(;r.have<r.ncode;){for(;f<3;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}r.lens[Z[r.have++]]=p&7,p>>>=3,f-=3}for(;r.have<19;)r.lens[Z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},G=Zo(n_,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,G){t.msg="invalid code lengths set",r.mode=Ue;break}r.have=0,r.mode=my;case my:for(;r.have<r.nlen+r.ndist;){for(;T=r.lencode[p&(1<<r.lenbits)-1],_=T>>>24,k=T>>>16&255,P=T&65535,!(_<=f);){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(P<16)p>>>=_,f-=_,r.lens[r.have++]=P;else{if(P===16){for(N=_+2;f<N;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(p>>>=_,f-=_,r.have===0){t.msg="invalid bit length repeat",r.mode=Ue;break}R=r.lens[r.have-1],y=3+(p&3),p>>>=2,f-=2}else if(P===17){for(N=_+3;f<N;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}p>>>=_,f-=_,R=0,y=3+(p&7),p>>>=3,f-=3}else{for(N=_+7;f<N;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}p>>>=_,f-=_,R=0,y=11+(p&127),p>>>=7,f-=7}if(r.have+y>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Ue;break}for(;y--;)r.lens[r.have++]=R}}if(r.mode===Ue)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Ue;break}if(r.lenbits=9,C={bits:r.lenbits},G=Zo(jy,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,G){t.msg="invalid literal/lengths set",r.mode=Ue;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},G=Zo(Ky,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,G){t.msg="invalid distances set",r.mode=Ue;break}if(r.mode=Sc,e===wc)break e;case Sc:r.mode=bc;case bc:if(d>=6&&m>=258){t.next_out=c,t.avail_out=m,t.next_in=o,t.avail_in=d,r.hold=p,r.bits=f,XC(t,w),c=t.next_out,s=t.output,m=t.avail_out,o=t.next_in,n=t.input,d=t.avail_in,p=r.hold,f=r.bits,r.mode===Pr&&(r.back=-1);break}for(r.back=0;T=r.lencode[p&(1<<r.lenbits)-1],_=T>>>24,k=T>>>16&255,P=T&65535,!(_<=f);){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(k&&!(k&240)){for(v=_,z=k,Q=P;T=r.lencode[Q+((p&(1<<v+z)-1)>>v)],_=T>>>24,k=T>>>16&255,P=T&65535,!(v+_<=f);){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}p>>>=v,f-=v,r.back+=v}if(p>>>=_,f-=_,r.back+=_,r.length=P,k===0){r.mode=wy;break}if(k&32){r.back=-1,r.mode=Pr;break}if(k&64){t.msg="invalid literal/length code",r.mode=Ue;break}r.extra=k&15,r.mode=fy;case fy:if(r.extra){for(N=r.extra;f<N;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}r.length+=p&(1<<r.extra)-1,p>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=hy;case hy:for(;T=r.distcode[p&(1<<r.distbits)-1],_=T>>>24,k=T>>>16&255,P=T&65535,!(_<=f);){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(!(k&240)){for(v=_,z=k,Q=P;T=r.distcode[Q+((p&(1<<v+z)-1)>>v)],_=T>>>24,k=T>>>16&255,P=T&65535,!(v+_<=f);){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}p>>>=v,f-=v,r.back+=v}if(p>>>=_,f-=_,r.back+=_,k&64){t.msg="invalid distance code",r.mode=Ue;break}r.offset=P,r.extra=k&15,r.mode=gy;case gy:if(r.extra){for(N=r.extra;f<N;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}r.offset+=p&(1<<r.extra)-1,p>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Ue;break}r.mode=yy;case yy:if(m===0)break e;if(y=w-m,r.offset>y){if(y=r.offset-y,y>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Ue;break}y>r.wnext?(y-=r.wnext,S=r.wsize-y):S=r.wnext-y,y>r.length&&(y=r.length),x=r.window}else x=s,S=c-r.offset,y=r.length;y>m&&(y=m),m-=y,r.length-=y;do s[c++]=x[S++];while(--y);r.length===0&&(r.mode=bc);break;case wy:if(m===0)break e;s[c++]=r.length,m--,r.mode=bc;break;case Nd:if(r.wrap){for(;f<32;){if(d===0)break e;d--,p|=n[o++]<<f,f+=8}if(w-=m,t.total_out+=w,r.total+=w,r.wrap&4&&w&&(t.adler=r.check=r.flags?ot(r.check,s,w,c-w):ti(r.check,s,w,c-w)),w=m,r.wrap&4&&(r.flags?p:Ty(p))!==r.check){t.msg="incorrect data check",r.mode=Ue;break}p=0,f=0}r.mode=Sy;case Sy:if(r.wrap&&r.flags){for(;f<32;){if(d===0)break e;d--,p+=n[o++]<<f,f+=8}if(r.wrap&4&&p!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=Ue;break}p=0,f=0}r.mode=by;case by:G=o_;break e;case Ue:G=Wy;break e;case Xy:return Zy;case Jy:default:return $t}return t.next_out=c,t.avail_out=m,t.next_in=o,t.avail_in=d,r.hold=p,r.bits=f,(r.wsize||w!==t.avail_out&&r.mode<Ue&&(r.mode<Nd||e!==Jg))&&nw(t,t.output,t.next_out,w-t.avail_out),g-=t.avail_in,w-=t.avail_out,t.total_in+=g,t.total_out+=w,r.total+=w,r.wrap&4&&w&&(t.adler=r.check=r.flags?ot(r.check,s,w,t.next_out-w):ti(r.check,s,w,t.next_out-w)),t.data_type=r.bits+(r.last?64:0)+(r.mode===Pr?128:0)+(r.mode===Sc||r.mode===Dd?256:0),(g===0&&w===0||e===Jg)&&G===vn&&(G=a_),G},"inflate$2"),g_=a(t=>{if(Dn(t))return $t;let e=t.state;return e.window&&(e.window=null),t.state=null,vn},"inflateEnd"),y_=a((t,e)=>{if(Dn(t))return $t;let r=t.state;return r.wrap&2?(r.head=e,e.done=!1,vn):$t},"inflateGetHeader"),w_=a((t,e)=>{let r=e.length,n,s,o;return Dn(t)||(n=t.state,n.wrap!==0&&n.mode!==xc)?$t:n.mode===xc&&(s=1,s=ti(s,e,r,0),s!==n.check)?Wy:(o=nw(t,e,r,r),o?(n.mode=Xy,Zy):(n.havedict=1,vn))},"inflateSetDictionary"),S_=ew,b_=tw,T_=Yy,E_=m_,A_=rw,x_=h_,I_=g_,k_=y_,C_=w_,__="pako inflate (from Nodeca project)",Rr={inflateReset:S_,inflateReset2:b_,inflateResetKeep:T_,inflateInit:E_,inflateInit2:A_,inflate:x_,inflateEnd:I_,inflateGetHeader:k_,inflateSetDictionary:C_,inflateInfo:__};function F_(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}a(F_,"GZheader");var P_=F_,sw=Object.prototype.toString,{Z_NO_FLUSH:v_,Z_FINISH:R_,Z_OK:si,Z_STREAM_END:Od,Z_NEED_DICT:Ud,Z_STREAM_ERROR:D_,Z_DATA_ERROR:Ay,Z_MEM_ERROR:N_}=Rn;function ci(t){this.options=kc.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vy,this.strm.avail_out=0;let r=Rr.inflateInit2(this.strm,e.windowBits);if(r!==si)throw new Error(Fn[r]);if(this.header=new P_,Rr.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ni.string2buf(e.dictionary):sw.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=Rr.inflateSetDictionary(this.strm,e.dictionary),r!==si)))throw new Error(Fn[r])}a(ci,"Inflate$1");ci.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,s=this.options.dictionary,o,c,d;if(this.ended)return!1;for(e===~~e?c=e:c=e===!0?R_:v_,sw.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=Rr.inflate(r,c),o===Ud&&s&&(o=Rr.inflateSetDictionary(r,s),o===si?o=Rr.inflate(r,c):o===Ay&&(o=Ud));r.avail_in>0&&o===Od&&r.state.wrap>0&&t[r.next_in]!==0;)Rr.inflateReset(r),o=Rr.inflate(r,c);switch(o){case D_:case Ay:case Ud:case N_:return this.onEnd(o),this.ended=!0,!1}if(d=r.avail_out,r.next_out&&(r.avail_out===0||o===Od))if(this.options.to==="string"){let m=ni.utf8border(r.output,r.next_out),p=r.next_out-m,f=ni.buf2string(r.output,m);r.next_out=p,r.avail_out=n-p,p&&r.output.set(r.output.subarray(m,m+p),0),this.onData(f)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===si&&d===0)){if(o===Od)return o=Rr.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};ci.prototype.onData=function(t){this.chunks.push(t)};ci.prototype.onEnd=function(t){t===si&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=kc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ep(t,e){let r=new ci(e);if(r.push(t),r.err)throw r.msg||Fn[r.err];return r.result}a(ep,"inflate$1");function B_(t,e){return e=e||{},e.raw=!0,ep(t,e)}a(B_,"inflateRaw$1");var L_=ci,O_=ep,U_=B_,M_=ep,q_=Rn,z_={Inflate:L_,inflate:O_,inflateRaw:U_,ungzip:M_,constants:q_},{Deflate:Q_,deflate:H_,deflateRaw:G_,gzip:V_}=WC,{Inflate:$_,inflate:j_,inflateRaw:K_,ungzip:W_}=z_,Z_=Q_,X_=H_,J_=G_,Y_=V_,eF=$_,tF=j_,rF=K_,nF=W_,sF=Rn,tp={Deflate:Z_,deflate:X_,deflateRaw:J_,gzip:Y_,Inflate:eF,inflate:tF,inflateRaw:rF,ungzip:nF,constants:sF};u();l();var _c=class{static{a(this,"StreamedQuoteQueue")}maxSize=5;items=[];enqueue(e,r,n){let s=this.processQuoteResponse(e,r,n?.join(","));this.items.push(s),this.items.length>this.maxSize&&this.items.shift()}getItems(){return[...this.items]}size(){return this.items.length}clear(){this.items=[]}processQuoteResponse(e,r,n){return{quotes:e.quotes.map(o=>({amountIn:o.sellAmount,amountOut:o.buyAmount,tokenIn:D(e.sellToken),tokenOut:D(e.buyToken),provider:o.baseProvider.name})),timestamp:Date.now(),selectedProvider:r,alerts:n}}};var oF="Sq+",rp=class{static{a(this,"StreamedQuoteLogger")}queue=new _c;addQuoteResponse(e,r,n){this.queue.enqueue(e,r,n)}reset(){this.queue.clear()}getQuotes(){return this.queue.getItems()}logState(e){let r=this.getStateData(e);E.addBreadcrumb(I.Generic,`${oF}${r}`,F.Info)}processQuoteProcessorState(e){switch(e.type){case"starting":this.reset();break;case"quoteProcessed":this.addQuoteResponse(e.response,e.input.preferredProvider,[...e.quoteDetails.alerts,...e.quoteDetails.warnings].map(r=>r.toString()));break;default:break}}getStateData(e){let r=this.queue.getItems(),n=this.compactData(r,e),s=tp.gzip(JSON.stringify(n));return Buffer.from(s).toString("base64")}compactData(e,r){return e.length===0?null:{items:e.map(n=>({q:n.quotes.map(s=>({i:s.amountIn,o:s.amountOut,p:s.provider,ti:s.tokenIn,to:s.tokenOut})),t:n.timestamp,sp:n.selectedProvider,a:n.alerts})),th:r}}expandData(e){return e.items.map(r=>({quotes:r.q.map(n=>({amountIn:n.i,amountOut:n.o,tokenIn:n.ti,tokenOut:n.to,provider:n.p})),timestamp:r.t,selectedProvider:r.sp,alerts:r.a}))}decode(e){try{let r=Buffer.from(e,"base64"),n=tp.inflate(r,{to:"string"}),s=JSON.parse(n);return s?{items:this.expandData(s),txnHash:s.th}:{items:[]}}catch(r){return console.error("Failed to decode compressed data:",r),{items:[]}}}},mn=new rp;u();l();u();l();var B;(function(t){t.AccountFrozen="AccountFrozen",t.NoCurrentQuoteError="Trying to execute swap with no current quote",t.NoQuoteResponseError="Trying to execute swap with no quote response",t.NoGasEstimation="No gas estimation available",t.NoSwapTransactions="No swap transactions available",t.InsufficientFunds="INSUFFICIENT_FUNDS",t.InsufficientGas="INSUFFICIENT_GAS",t.SlippageExceeded="slippageToleranceExceeded",t.SimulationTimeout="SIMULATION_TIMEOUT",t.NotValidScanResultsError="Scan results are not valid",t.StaleQuote="STALE_QUOTE",t.NotEnoughSol="NotEnoughSol",t.TransactionConfirmationFailed="Transaction confirmation failed",t.SimulationUnknownError="SimulationUnknownError",t.UnknownError="UnknownError",t.MissingArgument="MissingArgument",t.EmptyRoute="EmptyRoute",t.InvalidCalculation="InvalidCalculation",t.MissingPlatformFeeAccount="MissingPlatformFeeAccount",t.InvalidSlippage="InvalidSlippage",t.NotEnoughPercent="NotEnoughPercent",t.InvalidInputIndex="InvalidInputIndex",t.InvalidOutputIndex="InvalidOutputIndex",t.NotEnoughAccountKeys="NotEnoughAccountKeys",t.NonZeroMinimumOutAmountNotSupported="NonZeroMinimumOutAmountNotSupported",t.InvalidRoutePlan="InvalidRoutePlan",t.InvalidReferralAuthority="InvalidReferralAuthority",t.LedgerTokenAccountDoesNotMatch="LedgerTokenAccountDoesNotMatch",t.InvalidTokenLedger="InvalidTokenLedger",t.IncorrectTokenProgramID="IncorrectTokenProgramID",t.TokenProgramNotProvided="TokenProgramNotProvided",t.SwapNotSupported="SwapNotSupported",t.ExactOutAmountNotMatched="ExactOutAmountNotMatched",t.SourceAndDstinationMintCannotBeTheSame="SourceAndDstinationMintCannotBeTheSame",t.LedgerConnectionError="LedgerConnectionError",t.LedgerRejectAction="LedgerRejectAction",t.LedgerUnknownSignError="LedgerUnknownSignError",t.LedgerUnknownError="LedgerUnknownError"})(B||(B={}));var _e=class extends Error{static{a(this,"SwapperError")}code;detailMessage;constructor(e,r){super(e),this.code=e,this.detailMessage=r}};var iF=B.SlippageExceeded,aF=B.InsufficientFunds,cF=Rf,uF="insufficient lamports",lF="lower balance than rent-exempt minimum",dF=vf,pF="Transaction confirmation failed",mF=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],fF="Ledger user rejected action",hF="Ledger Sign Error";function gF(t){try{return Number(t.split('"Custom":')[1].split("}")[0])}catch{return null}}a(gF,"parseProgramErrorCode");var yF={301:B.SlippageExceeded,6e3:B.EmptyRoute,6001:B.SlippageExceeded,6002:B.InvalidCalculation,6003:B.MissingPlatformFeeAccount,6004:B.InvalidSlippage,6005:B.NotEnoughPercent,6006:B.InvalidInputIndex,6007:B.InvalidOutputIndex,6008:B.NotEnoughAccountKeys,6009:B.NonZeroMinimumOutAmountNotSupported,6010:B.InvalidRoutePlan,6011:B.InvalidReferralAuthority,6012:B.LedgerTokenAccountDoesNotMatch,6013:B.InvalidTokenLedger,6014:B.IncorrectTokenProgramID,6015:B.TokenProgramNotProvided,6016:B.SwapNotSupported,6017:B.ExactOutAmountNotMatched,6018:B.SourceAndDstinationMintCannotBeTheSame},wF={6019:B.InvalidSlippage,6020:B.MissingArgument,6021:B.MissingArgument,6022:B.SwapNotSupported,6023:B.SwapNotSupported,6024:B.SwapNotSupported,6025:B.SwapNotSupported,6026:B.SwapNotSupported,6027:B.MissingArgument,6028:B.InvalidCalculation,6035:B.MissingPlatformFeeAccount,6036:B.InsufficientFunds,6038:B.MissingArgument,6039:B.MissingPlatformFeeAccount,6047:B.MissingArgument,6048:B.MissingArgument,6049:B.MissingArgument,6051:B.MissingPlatformFeeAccount,6072:B.InsufficientFunds,6073:B.InsufficientFunds,6080:B.InsufficientFunds,6074:B.IncorrectTokenProgramID,6077:B.TokenProgramNotProvided},SF={15e3:B.SwapNotSupported,15001:B.SlippageExceeded,15004:B.InsufficientFunds,15006:B.StaleQuote,15015:B.InvalidCalculation,15016:B.InvalidCalculation,15017:B.InvalidCalculation,15021:B.MissingArgument,15022:B.TokenProgramNotProvided,15025:B.SlippageExceeded,15028:B.MissingArgument};function bF(t){let e=gF(t.message);return e===null?null:yF[e]??wF[e]??SF[e]??null}a(bF,"parseProgramError");function TF(t){return mF.some(r=>t.message.includes(r))?B.LedgerConnectionError:t.message.includes(fF)?B.LedgerRejectAction:t.message.includes(hF)?B.LedgerUnknownSignError:t.message.toLowerCase().includes("ledger")?B.LedgerUnknownError:null}a(TF,"parseLedgerError");function fn(t){if(t===void 0)return new _e(B.UnknownError,"No error provided");if(t instanceof _e)return t;let e=EF(t);if(e.message.includes(aF))return new _e(B.InsufficientFunds);if(AF(e.message))return new _e(B.SlippageExceeded);if(e.message===B.NotValidScanResultsError)return new _e(B.NotValidScanResultsError);if([cF,uF,dF,lF].some(m=>e.message.includes(m)))return new _e(B.NotEnoughSol);let o=bF(e);if(o!==null)return new _e(o);if(e.message.includes(pF))return new _e(B.TransactionConfirmationFailed);let d=TF(e);return d!==null?new _e(d):new _e(B.UnknownError,e.message)}a(fn,"parseSwapError");function EF(t){return typeof t=="string"?new Error(t):typeof t=="object"&&"logs"in t&&t.logs?.length?new Error(t.logs.join(`
`)):t}a(EF,"normalizeError");function AF(t){return t.includes(iF)}a(AF,"errorMessageFailsFromSlippage");u();l();u();l();var ow=3;function Fc(){try{let t=er.getMultivariateAssignment("swapper-high-slippage-threshold"),e=Number(t);return!t||isNaN(e)?ow:e}catch{return ow}}a(Fc,"getHighSlippageThreshold");var iw=a(({currentQuote:t,quoteResponse:e,gasEstimation:r,swapTransactions:n,scanResults:s,isSwapSimulationDisabled:o,slippageTolerance:c})=>{if(!t)throw new _e(B.NoCurrentQuoteError);if(!e)throw new _e(B.NoQuoteResponseError);if(A.isEVMNetworkID(e.sellToken.chainId)&&(!r||r?.length===0||r?.length<(n?.transactions.length??1)))throw new _e(B.NoGasEstimation);if(!n)throw new _e(B.NoSwapTransactions);if(s.state!=="valid"&&(E.addBreadcrumb(I.Swapper,"swapSimulationNotValid",F.Info,Jn({scanResults:s.state})),!o)){let m=[B.NotValidScanResultsError,B.AccountFrozen,B.InsufficientFunds,B.InsufficientGas,B.SlippageExceeded,B.SimulationTimeout,B.MissingArgument,B.StaleQuote,B.SimulationUnknownError];if(IF(s.state)&&m.includes(s.state.code)){if(xF(s.state,c))return;throw s.state}else throw new _e(B.NotValidScanResultsError)}},"validateSwap");function xF(t,e){return t.code===B.SlippageExceeded&&e&&e>=Fc()}a(xF,"shouldSuppressError");function IF(t){return t instanceof _e}a(IF,"isSwapperError");var kF={swap:{solana:"executeSolanaSwap",evm:"executeEvmSwap",sui:"executeSuiSwap",bitcoin:"executeBitcoinSwap"},bridge:{solana:"executeSolanaBridge",evm:"executeEvmBridge",sui:"executeSuiBridge",bitcoin:"executeBitcoinBridge"}},np=a((t,e)=>kF[t?"bridge":"swap"][e??"solana"],"getExecuteSwapSpanName"),aw=a(async({isBridge:t,addressType:e,isSwapSimulationDisabled:r,sender:n,currentQuote:s,quoteResponse:o,gasEstimation:c,swapTransactions:d,scanResults:m,pendingActivityRows:p,connection:f,logSwapFailureNoSignature:g,logTransactionSubmitted:w,onTransactionReceiptReceived:y,onTransactionSubmissionError:S,resetToInitialState:x,slippageTolerance:T,swapFungibles:_})=>{await E.startSpan(np(t,d?.type),async()=>{x();let k;try{iw({currentQuote:s,quoteResponse:o,gasEstimation:c,swapTransactions:d,scanResults:m,isSwapSimulationDisabled:r,slippageTolerance:T});let P=await _({type:e,callerAddress:n,swapTransactions:d,pendingSwapActivityRows:p.pendingSwapActivityRows,pendingApprovalActivityRows:p.pendingApprovalActivityRows,gasEstimation:c,connection:f});if(y(P),P.error)throw P.id||g(),k=P.id,P.error;w(P),mn.logState(P.id)}catch(P){let v=fn(P);S(v,k)}})},"executeSwap");u();l();var ct;(function(t){t.SetPair="setPair",t.QuoteRequestStarted="quoteRequestStarted",t.QuoteResponseReceived="quoteResponseReceived",t.QuoteResponseStreamed="quoteResponseStreamed",t.QuoteRequestError="quoteRequestError",t.UserSelectedQuote="userSelectedQuote"})(ct||(ct={}));u();l();u();l();var Ee;(function(t){t.SlippageExceeded="SLIPPAGE_EXCEEDED",t.InsufficientFunds="INSUFFICIENT_FUNDS",t.InsufficientGas="INSUFFICIENT_GAS",t.AccountFrozen="ACCOUNT_FROZEN",t.SimulationTimeout="SIMULATION_TIMEOUT",t.StaleQuote="STALE_QUOTE",t.UnknownError="UNKNOWN_ERROR",t.SimulationFailed="SIMULATION_FAILED"})(Ee||(Ee={}));var Fs=class t extends Error{static{a(this,"SimulationError")}scannedTransactionResult;type;detailMessage;constructor(e,r,n){super(e),this.scannedTransactionResult=r,this.type=n,r&&(this.detailMessage=r.simulationError?.humanReadableError??(r.warnings.length>0?r.warnings[0].message:void 0)),this.type=n}static fromError(e){return e instanceof t?e:new t(e.message)}static fromScannedTransactionResult(e,r){return a(s=>Object.values(Ee).includes(s),"isSimulationErrorType")(e)?new t(e,r,e):new t(e,r)}};u();l();var Ps=class t extends Error{static{a(this,"SubmissionError")}type;constructor(e,r){super(e),this.type=r}static fromError(e){return new t(e.message)}static fromType(e){return new t(e,e)}};var cw="https://phantom.com",Pc=class{static{a(this,"EventfulSwapCommand")}swapCommand;send;executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,n){this.swapCommand=e,this.send=r,this.executingQuote=n,this.takerAddress=e.takerAddress,this.networkId=e.networkId,this.quote=e.quote,this.executionId=e.executionId}createTransaction(){return this.send({type:X.ExecuteSwapStarted,executionId:this.executionId,executingQuote:this.executingQuote}),this.swapCommand.createTransaction()}async fetchSimulation(e){let{transactions:r,deviceId:n,isSimulationKilled:s}=e;if(A.isSuiNetworkID(this.networkId))return{result:{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0}};if(A.isBitcoinNetworkID(this.networkId))return{result:{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0}};let o=await Ss({transactions:r,url:cw,deviceId:n,takerAddress:this.takerAddress,networkId:this.networkId,slippageType:this.executingQuote.slippageType,quote:this.quote,quoteResponse:this.executingQuote.response,isSimulationKilled:s});return o.status==="success"?{result:o.result}:{result:null,skipReason:o.skipReason}}async simulate(e,r,n,s){try{this.send({type:X.SimulationRequestStarted,executionId:this.executionId,executingQuote:this.executingQuote,networkId:this.networkId});let o=await this.fetchSimulation({transactions:e,deviceId:n,isSimulationKilled:s});if(!o.result)return this.send({type:X.SimulationSkipped,executionId:this.executionId,networkId:this.networkId,skipReason:o.skipReason}),null;let c=o.result;switch(c.error){case void 0:break;case Ee.SimulationFailed:break;case Ee.SlippageExceeded:if(this.executingQuote.response.slippageTolerance>=Fc())break;default:throw Fs.fromScannedTransactionResult(c.error,c)}return this.send({type:X.SimulationPassed,scannedTransactionResult:c,executionId:this.executionId,networkId:this.networkId}),c}catch(o){throw this.send({type:X.SimulationFailed,error:Fs.fromError(o),executionId:this.executionId,networkId:this.networkId,url:cw}),o}}async swap(e,r,n,s,o){this.send({type:X.TransactionSubmissionStarted,executionId:this.executionId});try{let c=await this.swapCommand.swap(e,r,n,s,o);if(!c.id)throw Ps.fromType("noSignature");return this.send({type:X.TransactionSubmissionSuccess,txReceipt:c,executionId:this.executionId}),c}catch(c){let d=c instanceof Ps?c:Ps.fromError(c);throw this.send({type:X.TransactionSubmissionFailed,error:d,executionId:this.executionId}),d}}async waitForConfirmation(e){this.send({type:X.TransactionConfirmationStarted,executionId:this.executionId,txReceipt:e});try{let r=await this.swapCommand.waitForConfirmation(e);return this.send({type:X.TransactionConfirmed,executionId:this.executionId,txReceipt:e}),r}catch(r){throw this.send({type:X.TransactionConfirmationFailed,error:r,txReceipt:e,executionId:this.executionId}),r}}};u();l();var vc=class extends Error{static{a(this,"ExecuteSwapIllegalTransitionError")}constructor(e,r){let s=(Array.isArray(r)?r:[r]).join(", ");super(`Can't transition to ${s} from ${e.type}`)}},Rc=class{static{a(this,"ExecuteSwapStateMachine")}state=new Map;listeners=new Set;send(e){e.type===X.ExecuteSwapStarted&&this.state.set(e.executionId,{type:Te.Idle,executingQuote:e.executingQuote});let r=this.state.get(e.executionId);if(!r)throw new Error(`No previous state found for execution id: ${e.executionId}`);let n=r;try{return n=this.detectNextState(r,e),n.type===Te.TransactionConfirmed?this.state.delete(e.executionId):this.state.set(e.executionId,n),n}catch{return r}finally{this.notifyListeners(e,r,n,this.state)}}notifyListeners(e,r,n,s){this.listeners.forEach(o=>{try{o.onStateChange(e,r,n,s)}catch(c){console.error("Error notifying ExecuteSwapStateListener:",c)}})}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}detectNextState(e,r){switch(r.type){case X.ExecuteSwapStarted:return wr(e,Te.Idle),{type:Te.Started,executingQuote:r.executingQuote};case X.SimulationRequestStarted:return wr(e,Te.Started),{type:Te.Simulating,executingQuote:e.executingQuote};case X.SimulationPassed:return wr(e,Te.Simulating),{type:Te.Simulated,scannedTransactionResult:r.scannedTransactionResult,executingQuote:e.executingQuote};case X.SimulationFailed:return wr(e,Te.Simulating),{type:Te.SimulationFailed,error:r.error,executingQuote:e.executingQuote};case X.SimulationSkipped:return wr(e,Te.Simulating),{type:Te.SimulationSkipped,executingQuote:e.executingQuote};case X.TransactionSubmissionStarted:return CF(e,[Te.Simulated,Te.SimulationSkipped]),{type:Te.SubmittingTransaction,executingQuote:e.executingQuote,scannedTransactionResult:e.type===Te.Simulated?e.scannedTransactionResult:void 0};case X.TransactionSubmissionFailed:return wr(e,Te.SubmittingTransaction),{type:Te.TransactionSubmissionFailed,error:r.error,executingQuote:e.executingQuote,scannedTransactionResult:e.scannedTransactionResult};case X.TransactionSubmissionSuccess:return wr(e,Te.SubmittingTransaction),{type:Te.TransactionSubmitted,txReceipt:r.txReceipt,executingQuote:e.executingQuote,scannedTransactionResult:e.scannedTransactionResult};case X.TransactionConfirmationStarted:return wr(e,Te.TransactionSubmitted),{type:Te.ConfirmingTransaction,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,executingQuote:e.executingQuote};case X.TransactionConfirmationFailed:return wr(e,Te.TransactionSubmitted),{type:Te.TransactionNotConfirmed,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,error:r.error,executingQuote:e.executingQuote};case X.TransactionConfirmed:return wr(e,Te.ConfirmingTransaction),{type:Te.TransactionConfirmed,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,executingQuote:e.executingQuote}}}};function wr(t,e){if(t.type!==e)throw new vc(t,e)}a(wr,"checkState");function CF(t,e){if(!e.includes(t.type))throw new vc(t,e)}a(CF,"checkStateAny");u();l();var Me;(function(t){t.Idle="idle",t.Pair="pair",t.FetchingQuote="fetchingQuote",t.QuoteError="quoteError",t.Quote="quote",t.ExecutingSwap="executingSwap",t.SwapConfirmed="swapConfirmed"})(Me||(Me={}));function uw(t){return t.type===Me.Quote}a(uw,"isExecutableSwapState");u();l();u();l();var _F={"Could not find any routes":"noRoute"},Dc=class t extends Error{static{a(this,"QuoteError")}type;constructor(e,r){super(r??e),this.type=e}static fromMessage(e){let r=e?_F[e]??"undefinedError":"undefinedError";return new t(r,e)}};var Nn=class extends Error{static{a(this,"SwapperIllegalTransitionError")}constructor(e,r){super(`Can't transition to ${r} from ${e.type}`)}},Nc=class{static{a(this,"SwapperStateMachine")}state;listeners=new Set;constructor(e){this.state=e??{type:Me.Idle}}send(e){let r=this.state;try{return r=this.detectNextState(this.state,e),this.state=r,r}catch{return this.state}finally{this.notifyListeners(e,this.state,r)}}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e,r,n){try{this.listeners.forEach(s=>s.onStateChange(e,r,n))}catch{}}detectNextState(e,r){switch(r.type){case ct.SetPair:return{type:Me.Pair,buy:r.buy,sell:r.sell,amount:r.amount};case ct.QuoteRequestStarted:switch(e.type){case Me.Pair:case Me.Quote:case Me.QuoteError:return{type:Me.FetchingQuote,buy:e.buy,sell:e.sell,amount:r.amount,slippageType:r.slippageType};default:throw new Nn(e,r.type)}case ct.QuoteRequestError:if(e.type!==Me.FetchingQuote)throw new Nn(e,r.type);return{type:Me.QuoteError,buy:e.buy,sell:e.sell,amount:e.amount,error:r.error,slippageType:e.slippageType};case ct.QuoteResponseReceived:if(e.type!==Me.FetchingQuote)throw new Nn(e,r.type);let n=r.response.quotes[0];return n?{type:Me.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:n,amount:e.amount,slippageType:e.slippageType}:{type:Me.QuoteError,buy:e.buy,sell:e.sell,amount:e.amount,error:new Dc("noRoute"),slippageType:e.slippageType};case ct.QuoteResponseStreamed:switch(e.type){case Me.Pair:case Me.FetchingQuote:case Me.Quote:case Me.QuoteError:return{type:Me.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:r.quote,amount:{amount:r.quoteInput.amount,perspective:r.quoteInput.exactOut?"buy":"sell"},slippageType:r.quoteInput.autoSlippage?fe.Auto:fe.Fixed,input:r.quoteInput};default:throw new Nn(e,r.type)}case ct.UserSelectedQuote:if(e.type!==Me.Quote)throw new Nn(e,r.type);return{type:Me.Quote,quote:r.quote,buy:e.buy,sell:e.sell,response:e.response,amount:e.amount,slippageType:e.slippageType}}}};u();l();u();l();function lw(t){switch(t.type){case"buy":return je(t.buyCaip19).chainId;case"sell":return je(t.sellCaip19).chainId;case"swap":return t.network;case"prediction":return t.network}}a(lw,"getNetworkFromSwapMode");function Bc(t,e){if(t.type!==e.type)return!1;switch(t.type){case"buy":return e.type!=="buy"?!1:t.buyCaip19===e.buyCaip19&&t.sellCaip19===e.sellCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options&&t.buyFungibleKey===e.buyFungibleKey;case"sell":return e.type!=="sell"?!1:t.sellCaip19===e.sellCaip19&&t.buyCaip19===e.buyCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options&&t.sellFungibleKey===e.sellFungibleKey;case"swap":return e.type!=="swap"?!1:t.network===e.network&&t.sellCaip19===e.sellCaip19&&t.buyCaip19===e.buyCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options;case"prediction":{if(e.type!=="prediction"||t.mode.direction!==e.mode.direction||t.outcomeType!==e.outcomeType||t.network!==e.network||t.takerCaip19!==e.takerCaip19||t.takerDestinationCaip19!==e.takerDestinationCaip19||t.options!==e.options)return!1;if(t.mode.direction==="buy"){if(e.mode.direction!=="buy"||t.mode.sellCaip19!==e.mode.sellCaip19)return!1}else if(e.mode.direction!=="sell"||t.mode.sellMintAddress!==e.mode.sellMintAddress)return!1;return t.mintAccounts===e.mintAccounts}default:{let r=t;return!1}}}a(Bc,"isSwapModeEqual");var r5=i.object({buyToken:i.custom(),sellToken:i.custom(),takerCaip19:i.string(),takerDestinationCaip19:i.string(),buyTokenPrice:i.custom().optional(),sellTokenPrice:i.custom().optional(),maxSellAmount:i.custom(),quoteParams:i.object({phantomCashAccount:i.boolean(),isPrediction:i.boolean(),predictions:i.object({platform:i.literal("kalshi"),mintAddress:i.string(),tokenPerspective:i.enum(["buy","sell"])}).optional()})}),ui=class t extends Error{static{a(this,"SwapInitializationError")}type;constructor(e,r){super(r??e.name),this.type=e}static fromError(e){return new t({name:"unknown"},e.message)}};u();l();function dw(t){if(!Tt(t))return;let{mode:e,buyToken:r,sellToken:n}=t;if(e.type!=="swap")throw new Error("Can't switch swap mode for: "+e.type);let s=D(Y(t.buyToken)),o=D(Y(t.sellToken)),c=t.takerDestinationCaip19,d=t.takerCaip19,m=r.data.key,p=n.data.key;return{type:"swap",network:s?je(s).chainId:A.solana.mainnetID,sellCaip19:s,buyCaip19:o,takerCaip19:c,takerDestinationCaip19:d,sellFungibleKey:m,buyFungibleKey:p}}a(dw,"switchSwapMode");u();l();u();l();u();l();u();l();u();l();u();l();var sp={id:A.solana.mainnetID,imageUrl:A.solana.iconUrl,name:A.solana.name,symbol:A.solana.tokenSymbol},Bn={type:ae.SolanaNative,data:{amount:"0",balance:new V(0),chain:sp,decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:ce.Verified}},pw={type:ae.SPL,data:{amount:"0",balance:new V(0),chain:sp,decimals:6,key:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",name:"USD Coin",splTokenAccountPubkey:"EAF7dH8Jy43Xgp68PhyybKhfKxk46NFRkWN4PMCLqMfS",symbol:"USDC",tokenAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",walletAddress:"",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:ce.Verified}},S5={type:ae.SPL,data:{amount:"0",balance:new V(0),chain:sp,decimals:6,key:"cash-account",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"CASHx9KJUStyftLFWGvEVf59SGeG9sh5FfcnZMVPCASH",name:"Cash",splTokenAccountPubkey:"8mK7wXFmkUYZnXmKWyKvP3jN9vQxT4R2pLsD6aGcHqYz",symbol:"Cash",tokenAddress:"CASHx9KJUStyftLFWGvEVf59SGeG9sh5FfcnZMVPCASH",walletAddress:"9vKHN2wXQPzJ4mR5sYtL3bUfD6eWcX7aGpMqS8hV4nTz",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:ce.Verified}},mw={type:ae.SuiNative,data:{chain:{id:A.sui.mainnetID,name:A.sui.name,symbol:A.sui.tokenSymbol,imageUrl:A.sui.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/sui/info/logo.png",name:"Sui",symbol:"SUI",balance:new V(0),key:"SuiNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:ce.Verified}},fw={type:ae.SuiCoin,data:{chain:{id:A.sui.mainnetID,name:A.sui.name,symbol:A.sui.tokenSymbol,imageUrl:A.sui.iconUrl},walletAddress:"",contractAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",decimals:6,amount:"0",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new V(0),key:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",tokenAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:ce.Verified}},hw={type:ae.PolygonNative,data:{chain:{id:A.polygon.mainnetID,name:A.polygon.name,symbol:A.polygon.tokenSymbol,imageUrl:A.polygon.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://wallet-asset.matic.network/img/tokens/matic.svg",name:"Polygon",symbol:A.polygon.tokenSymbol,balance:new V(0),key:"PolygonNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:ce.Verified}},gw={type:ae.BaseNative,data:{chain:{id:A.base.mainnetID,name:A.base.name,symbol:A.base.tokenSymbol,imageUrl:A.base.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Base",symbol:A.base.tokenSymbol,balance:new V(0),key:"BaseNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:ce.Verified}},yw={type:ae.ArbitrumNative,data:{chain:{id:A.arbitrum.mainnetID,name:A.arbitrum.name,symbol:A.arbitrum.tokenSymbol,imageUrl:A.arbitrum.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new V(0),key:"ArbitrumNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:ce.Verified}},ww={type:ae.MonadNative,data:{chain:{id:A.monad.mainnetID,name:A.monad.name,symbol:A.monad.tokenSymbol,imageUrl:A.monad.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://assets.phantom.app/assets/monad.png",name:"Monad",symbol:A.monad.tokenSymbol,balance:new V(0),key:"MonadNative",usd:0,price:0,usd_24h_change:0,tokenAddress:void 0,spamStatus:ce.Verified}},Sw={type:ae.ERC20,data:{amount:"0",balance:new V(0),decimals:6,key:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",walletAddress:"",chain:{id:A.polygon.mainnetID,imageUrl:A.polygon.iconUrl,name:A.polygon.name,symbol:A.polygon.tokenSymbol},contractAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",spamStatus:ce.Verified}},bw={type:ae.ERC20,data:{amount:"0",balance:new V(0),decimals:6,key:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",walletAddress:"",chain:{id:A.base.mainnetID,imageUrl:A.base.iconUrl,name:A.base.name,symbol:A.base.tokenSymbol},contractAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",spamStatus:ce.Verified}},Tw={type:ae.ERC20,data:{amount:"0",balance:new V(0),decimals:6,key:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",walletAddress:"",chain:{id:A.arbitrum.mainnetID,imageUrl:A.arbitrum.iconUrl,name:A.arbitrum.name,symbol:A.arbitrum.tokenSymbol},contractAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",spamStatus:ce.Verified}},Ew={type:ae.ERC20,data:{amount:"0",balance:new V(0),decimals:6,key:"0x0000000000000000000000000000000000000000",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x0000000000000000000000000000000000000000",walletAddress:"",chain:{id:A.monad.mainnetID,imageUrl:A.monad.iconUrl,name:A.monad.name,symbol:A.monad.tokenSymbol},contractAddress:"0x0000000000000000000000000000000000000000",spamStatus:ce.Verified}},Aw={type:ae.HyperevmNative,data:{chain:{id:A.hyperevm.mainnetID,name:A.hyperevm.name,symbol:A.hyperevm.tokenSymbol,imageUrl:A.hyperevm.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"",name:"Ethereum",symbol:"ETH",balance:new V(0),key:"HyperevmNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:ce.Verified}},xw={type:ae.ERC20,data:{amount:"0",balance:new V(0),decimals:6,key:"0xb88339cb7199b77e23db6e890353e22632ba630f",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xb88339cb7199b77e23db6e890353e22632ba630f",walletAddress:"",chain:{id:A.hyperevm.mainnetID,imageUrl:A.hyperevm.iconUrl,name:A.hyperevm.name,symbol:A.hyperevm.tokenSymbol},contractAddress:"0xb88339cb7199b77e23db6e890353e22632ba630f",spamStatus:ce.Verified}},Iw={type:ae.EthereumNative,data:{chain:{id:A.ethereum.mainnetID,name:A.ethereum.name,symbol:A.ethereum.tokenSymbol,imageUrl:A.ethereum.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new V(0),key:"EthereumNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:ce.Verified}},kw={type:ae.ERC20,data:{chain:{id:A.ethereum.mainnetID,name:A.ethereum.name,symbol:A.ethereum.tokenSymbol,imageUrl:A.ethereum.iconUrl},walletAddress:"",contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",decimals:6,amount:"1881092",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new V(0),key:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",tokenAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:ce.Verified}};var Lc="https://help.phantom.com/hc/en-us/articles/5985106844435",Cw="https://help.phantom.com/hc/en-us/articles/29763090277139";var hn={amount:new V(0),amountUsd:null,pct:0};u();l();var jt={};var _w={...jt,bridgeMinimumUsdAmounts:0,swapDefaultFee:new V(15e-5*10**18),bridgeDefaultFee:new V(.025*10**18),averageNetworkFee:new V(15e-5*10**18),nativeFungible:yw,usdcFungible:Tw};u();l();var Fw={...jt,bridgeMinimumUsdAmounts:0,swapDefaultFee:new V(15e-5*10**18),bridgeDefaultFee:new V(.025*10**18),averageNetworkFee:new V(15e-5*10**18),nativeFungible:gw,usdcFungible:bw};u();l();var Pw={bridgeMinimumUsdAmounts:10,swapDefaultFee:new V(1e4),bridgeDefaultFee:new V(15e3),averageNetworkFee:new V(1500),nativeFungible:{type:ae.BitcoinNative,data:{chain:{id:A.bitcoin.mainnetID,name:A.bitcoin.name,symbol:A.bitcoin.tokenSymbol,imageUrl:A.bitcoin.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Bitcoin",symbol:"BTC",balance:new V(0),key:"BitcoinNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:ce.Verified}},usdcFungible:{type:ae.BitcoinNative,data:{chain:{id:A.bitcoin.mainnetID,name:A.bitcoin.name,symbol:A.bitcoin.tokenSymbol,imageUrl:A.bitcoin.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Bitcoin",symbol:"BTC",balance:new V(0),key:"BitcoinNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:ce.Verified}}};u();l();var vw={...jt,bridgeMinimumUsdAmounts:20,swapDefaultFee:new V(2.5*10**16),bridgeDefaultFee:new V(3.75*10**16),averageNetworkFee:new V(0),nativeFungible:Iw,usdcFungible:kw};u();l();var Rw={...jt,bridgeMinimumUsdAmounts:0,swapDefaultFee:new V(15e-5*10**18),bridgeDefaultFee:new V(.025*10**18),averageNetworkFee:new V(15e-5*10**18),nativeFungible:Aw,usdcFungible:xw};u();l();var Dw={...jt,bridgeMinimumUsdAmounts:0,swapDefaultFee:new V(.015*10**18),bridgeDefaultFee:new V(.025*10**18),averageNetworkFee:new V(.0021*10**18),nativeFungible:ww,usdcFungible:Ew,requiredFeatureFlag:"enable-monad-swapper"};u();l();var Nw={...jt,bridgeMinimumUsdAmounts:2,swapDefaultFee:new V(6*10**16),bridgeDefaultFee:new V(6*10**16),averageNetworkFee:new V(.0015*10**18),nativeFungible:hw,usdcFungible:Sw};u();l();var Bw={bridgeMinimumUsdAmounts:1,swapDefaultFee:new V(3*10**6),bridgeDefaultFee:new V(30*10**6),averageNetworkFee:new V(15e3),nativeFungible:Bn,usdcFungible:pw};u();l();var Lw={bridgeMinimumUsdAmounts:1,swapDefaultFee:new V(50*10**6),bridgeDefaultFee:new V(50*10**6),averageNetworkFee:new V(50*10**6),nativeFungible:mw,usdcFungible:fw};var B$=[we.Solana,we.Ethereum,we.Polygon,we.Monad,we.Base,we.Sui,we.Arbitrum,we.Hyperevm,we.Bitcoin],FF=new qi({[we.Solana]:Bw,[we.Ethereum]:vw,[we.Polygon]:Nw,[we.Monad]:Dw,[we.Base]:Fw,[we.Sui]:Lw,[we.Arbitrum]:_w,[we.Hyperevm]:Rw,[we.Bitcoin]:Pw}),Dr=Mi(FF);var li=a((t,e)=>{let r=[];if(PF(t)&&r.push({type:"permanentDelegate",level:"warn",titleKey:"swapAssetWarningPermanentDelegate",shortTitleKey:"swapAssetWarningPermanentDelegateShort",modalTitleKey:"swapAssetWarningPermanentDelegateModalTitle"}),(t.data.spamStatus===ce.NotVerified||t.data.spamStatus===ce.Spam||t.data.spamStatus===ce.PossibleSpam)&&r.push({type:"unverified",level:"info",titleKey:"swapAssetWarningUnverified",shortTitleKey:"swapAssetWarningUnverifiedShort",modalTitleKey:"swapAssetWarningUnverifiedModalTitle"}),!Pt(t.type)&&e&&vF(e)){let n=Dr.get(t.data.chain.id).nativeFungible;r.push({type:"lowBalance",level:"info",titleKey:"swapAssetWarningLowTokenBalance",shortTitleKey:"swapAssetWarningLowTokenBalanceShort",modalTitleKey:"swapAssetWarningLowTokenBalanceModalTitle",options:{token:n.data.symbol??"",network:n.data.chain.name}})}return r},"detectAssetWarnings");function PF(t){let e=t.data;return e?.mintExtensions?e.mintExtensions.some(r=>r.extension===sa.permanentDelegate):!1}a(PF,"hasPermanentDelegateExtension");function vF(t){let e=Dr.get(t.data.chain.id);return new b(t.data.amount?t.data.amount:0).lt(e.swapDefaultFee)}a(vF,"isLowNativeTokenBalance");u();l();var RF=3,DF=new b(2039280),NF=new b(2e6),BF=new b(356190);function Oc(t,e){if(!Pt(t.type))return new b(t.data.balance);let{balance:r,decimals:n}=t.data,s=r?new b(r).multipliedBy(10**n):new b(0),o=LF(t,e);return(s.gt(o)?s.minus(o):s).dividedBy(10**n)}a(Oc,"getMaxSellAmountWithDefaults");function LF(t,e){let r=t.data.chain.id;if(A.isSolanaNetworkID(r))return OF(t,e);if(A.isEVMNetworkID(r))return UF(t,e);if(A.isSuiNetworkID(r)||A.isBitcoinNetworkID(r))return Ow(t,e);throw new Error("Chain not supported by swapper")}a(LF,"calculateFees");function OF(t,e){let{defaultSwapFee:r,networkFeeBuffer:n}=op(t,e),s=r.plus(n).plus(NF),o=!e||new b(e.data.balance).isZero()?DF:new b(0);return s.plus(o)}a(OF,"calculateSolanaFees");function UF(t,e){let{networkFeeBuffer:r}=op(t,e),n=MF(t.data.chain.id),s=new b(n.maxFeePerGas),o=new b(n.maxPriorityFeePerGas);return BF.multipliedBy(s.plus(o)).plus(r)}a(UF,"calculateEVMFees");function Ow(t,e){let{defaultSwapFee:r,networkFeeBuffer:n}=op(t,e);return r.plus(n)}a(Ow,"calculateDefaultFees");function op(t,e){let r=ht(t.data.chain.id,e?.data.chain.id),n=Dr.get(t.data.chain.id),s=r?n.bridgeDefaultFee:n.swapDefaultFee,o=n.averageNetworkFee.multipliedBy(RF);return{defaultSwapFee:s,networkFeeBuffer:o}}a(op,"getCommonFeeComponents");function MF(t){if(A.isEthereumNetworkID(t))return{maxFeePerGas:new b("5000000000"),maxPriorityFeePerGas:new b("79000000")};if(A.isPolygonNetworkID(t))return{maxFeePerGas:new b("30000000000"),maxPriorityFeePerGas:new b("30000000000")};if(A.isBaseNetworkID(t))return{maxFeePerGas:new b("25000000"),maxPriorityFeePerGas:new b("1100000")};if(A.isArbitrumNetworkID(t))return{maxFeePerGas:new b("29000000"),maxPriorityFeePerGas:new b("0")};throw new Error("Chain not supported by swapper")}a(MF,"getEVMDefaultTransactionUnitCost");var Uc=class{static{a(this,"TokenStateMachine")}state={type:"idle"};eventListeners=[];send(e){let r=this.state,n=r;try{return n=this.detectNextState(e),this.state=n,n}catch{return r}finally{this.eventListeners.forEach(s=>s.onStateChange(e,r,n))}}detectNextState(e){switch(e.type){case"initializeStarted":return{type:"initializing",mode:e.mode};case"initializeCompleted":if(this.state.type==="initializing"||this.state.type==="refreshing")return{type:"pair",mode:this.state.mode,warnings:li(e.result.buyToken),...e.result};throw new Error("Invalid state");case"initializeFailed":if(this.state.type!=="initializing")throw new Error("Invalid state");return{type:"error",error:e.error,mode:e.mode,addresses:e.addresses,cashAddresses:e.cashAddresses};case"switchTokens":{if(!Tt(this.state))throw new Error("Invalid state");let r=this.state.buyToken,n=this.state.sellToken,s=this.state.buyTokenPrice,o=this.state.sellTokenPrice;return{type:"pair",mode:e.mode,sellToken:r,buyToken:n,sellTokenPrice:s,buyTokenPrice:o,maxSellAmount:Oc(r,n),warnings:li(n),takerCaip19:this.state.takerDestinationCaip19,takerDestinationCaip19:this.state.takerCaip19,quoteParams:this.state.quoteParams}}case"changeToken":{if(this.state.type!=="pair")throw new Error("Invalid state");let r=e.perspective==="sell"?e.token:this.state.sellToken,n=e.perspective==="buy"?e.token:this.state.buyToken;return{type:"pair",mode:e.mode,sellToken:r,buyToken:n,sellTokenPrice:e.sellTokenPrice??this.state.buyTokenPrice,buyTokenPrice:e.buyTokenPrice??this.state.sellTokenPrice,maxSellAmount:Oc(r,n),warnings:li(e.perspective==="buy"?e.token:this.state.buyToken),takerCaip19:e.mode.takerCaip19??this.state.takerCaip19,takerDestinationCaip19:e.mode.takerDestinationCaip19??this.state.takerDestinationCaip19,quoteParams:this.state.quoteParams}}case"updateBalances":{if(this.state.type!=="pair")throw new Error("Invalid state");if(D(Y(this.state.sellToken))!==e.sellTokenCaip19)throw new Error("Invalid state");let r={...this.state.sellToken,data:{...this.state.sellToken.data,balance:e.sellTokenBalance}},n=this.state.buyToken;return{type:"pair",mode:this.state.mode,sellToken:r,buyToken:n,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,warnings:li(n),maxSellAmount:Oc(r,n),takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,quoteParams:this.state.quoteParams}}case"refreshing":if(this.state.type!=="pair")throw new Error("Invalid state");return{...this.state,type:"refreshing"}}}getState(){return this.state}subscribe(e){this.eventListeners.push(e)}unsubscribe(e){this.eventListeners=this.eventListeners.filter(r=>r!==e)}};var Mc=class{static{a(this,"Swapper")}apiClient;swapCommandFactory;quoteProcessor;swapInitializer;stateMachine=new Nc;executeSwapStateMachine=new Rc;account;cashAccount;config={slippageType:fe.Auto,slippageTolerance:1.3,isSimulationKilled:!1};tokenStateMachine=new Uc;accountChangeListeners=[];initializeAbortController=null;constructor(e,r,n,s,o){this.apiClient=e,this.swapCommandFactory=r,this.quoteProcessor=n,this.swapInitializer=s,this.quoteProcessor.subscribe(this.quoteProcessorListener),this.tokenStateMachine.subscribe(this.tokenStateListener),o&&(this.account=o)}tokenStateListener={onStateChange:a((e,r,n)=>{n.type==="pair"&&(this.setPair(n.buyToken,n.sellToken,{amount:"0",perspective:"sell"}),r.type==="refreshing"&&e.type==="initializeCompleted"&&this.refreshQuoteProcessor())},"onStateChange")};refreshPair({swapMode:e,cashAddresses:r,settings:n}){this.initializeSwap({swapMode:e,cashAddresses:r,settings:n,refresh:!0})}initializeSwap({swapMode:e,cashAddresses:r,settings:n,refresh:s=!1}){let o=this.checkAccount(),c=this.getTokenState();this.initializeAbortController&&this.initializeAbortController.abort(),this.initializeAbortController=new AbortController;let{signal:d}=this.initializeAbortController;c.type==="pair"&&s?this.tokenStateMachine.send({type:"refreshing"}):this.tokenStateMachine.send({type:"initializeStarted",mode:e}),this.swapInitializer.initialize(e,o.addresses,r,n).then(m=>{d.aborted||this.tokenStateMachine.send({type:"initializeCompleted",result:m})}).catch(m=>{d.aborted||(E.captureError(m,I.Swapper),m instanceof ui?this.tokenStateMachine.send({type:"initializeFailed",error:m,mode:e,addresses:o.addresses,cashAddresses:r}):this.tokenStateMachine.send({type:"initializeFailed",error:ui.fromError(m),mode:e,addresses:o.addresses,cashAddresses:r}))})}updateBalances({sellTokenBalance:e,sellTokenCaip19:r}){this.getTokenState().type==="pair"&&this.tokenStateMachine.send({type:"updateBalances",sellTokenBalance:e,sellTokenCaip19:r})}getTokenState(){return this.tokenStateMachine.getState()}subscribeToken(e){return this.tokenStateMachine.subscribe(e),()=>this.unsubscribeToken(e)}unsubscribeToken(e){this.tokenStateMachine.unsubscribe(e)}quoteProcessorListener={onStateChange:a((e,r)=>{(r.type==="firstQuoteReceived"||r.type==="quoteProcessed")&&this.send({type:ct.QuoteResponseStreamed,response:r.response,quoteInput:r.input,quote:r.quote})},"onStateChange")};isValidAmount(e){try{let r=b(e);return r.isFinite()?!r.isNegative():!1}catch{return!1}}setAmount(e,r){let n=this.getTokenState();if(!Tt(n))return;let{amount:s}=e;if(s===""&&(s="0"),!this.isValidAmount(s))return;this.quoteProcessor.stop();let o=this.checkAccount(),c={...this.config,...r,isSimulationKilled:r?.isSimulationKilled??this.config.isSimulationKilled??!1};if(s==="0"||s===""){this.send({type:ct.SetPair,buy:n.buyToken,sell:n.sellToken,amount:e});return}let{buyToken:d,sellToken:m,takerCaip19:p,takerDestinationCaip19:f,quoteParams:g}=n;try{let w={amount:b(e.amount).shiftedBy(e.perspective==="buy"?d.data.decimals:m.data.decimals).toString(),amountUsd:b(e.amount).times(e.perspective==="buy"?d.data.price??0:m.data.price??0).toString(),buy:d,sell:m,taker:p,takerDestination:f,slippageTolerance:c.slippageTolerance,autoSlippage:c.slippageType===fe.Auto,exactOut:e.perspective==="buy",priorityFee:c.priorityFee,tipAmount:c.tipAmount,preferredProvider:c.preferredProvider,isLedger:o.type==="ledger",phantomCashAccount:g.phantomCashAccount,isSimulationKilled:c.isSimulationKilled,isPrediction:g.isPrediction,predictions:g.predictions};this.quoteProcessor.start(w,o)}catch(w){console.error("Error when streaming quotes",w)}}setPair(e,r,n){this.send({type:ct.SetPair,buy:e,sell:r,amount:n})}switchTokens(){let e=this.getTokenState();if(!Tt(e))return;let r=dw(e);r&&this.tokenStateMachine.send({type:"switchTokens",mode:r})}setAccount(e){this.account=e,this.accountChangeListeners.forEach(r=>r.onAccountChange(e))}setCashAccount(e){this.cashAccount=e}getAccount(){return this.account}getInitializer(){return this.swapInitializer}setInitializer(e){this.swapInitializer=e}async fetchQuotes({amount:e,amountUsd:r,buy:n,sell:s,slippageTolerance:o,autoSlippageEnabled:c,priorityFee:d,tipAmount:m,signal:p,phantomCashAccount:f}){let g=Y(s),w=Y(n),y=e.perspective==="buy",S=b(e.amount).shiftedBy(e.perspective==="buy"?n.data.decimals:s.data.decimals).toString();this.send({type:ct.QuoteRequestStarted,amount:e,slippageType:c?fe.Auto:fe.Fixed});let x=this.checkChainAddress(s.data),T={chainId:x.networkID,resourceType:W.address,address:x.address},_;if(ht(s.data.chain.id,n.data.chain.id)){let k=this.checkChainAddress(n.data);_={chainId:k.networkID,resourceType:W.address,address:k.address}}try{let k=await this.apiClient.getQuotes({sell:g,buy:w,amount:S,amountUsd:r,taker:T,takerDestination:_,slippageTolerance:o??0,autoSlippageEnabled:c,exactOutEnabled:y,priorityFee:d,tipAmount:m,signal:p,phantomCashAccount:f});return this.send({type:ct.QuoteResponseReceived,response:k}),k}catch(k){throw this.send({type:ct.QuoteRequestError,error:k}),k}}async swap(e){let{signer:r,storage:n,locale:s,deviceId:o,connection:c,authRepository:d,isSimulationKilled:m,gasEstimation:p,preprocessor:f}=e,g=this.getState();if(!uw(g))throw new Error(`Can't swap from ${g.type}`);this.quoteProcessor.stop();let w=this.checkAccount(),y=this.getTokenState(),S={account:w,buy:g.buy,sell:g.sell,amount:g.amount,quote:g.quote,response:g.response,slippageType:g.slippageType,quoteInput:g.input,swapMode:Tt(y)?y.mode:void 0},x=this.getAddressFromCaip19({caip19:g.response.taker}),T=this.swapCommandFactory.create(S,x,g.sell.data.chain.id,c,d,this.cashAccount,p),_=new Pc(T,P=>this.executeSwapStateMachine.send(P),S),k=await _.createTransaction();await E.startSpan(np(de(g.quote),k.type),async()=>{let P=await _.simulate(k,s,o,m),v=a(async()=>{let z=await _.swap(w.identifier,k,P,r,n);await _.waitForConfirmation(z)},"performSwap");f?await f(v):await v()})}changeToken(e,r,n){let s=this.getTokenState();if(s.type!=="pair")return;let o=r==="buy"?e:s.buyToken,c=r==="sell"?e:s.sellToken,d=Y(c),m=Y(o),p;s.mode.type==="swap"?p={...s.mode,network:c.data.chain.id,sellCaip19:D(d),buyCaip19:D(m),takerCaip19:r==="sell"?n:s.mode.takerCaip19,takerDestinationCaip19:r==="buy"?n:s.mode.takerDestinationCaip19,sellFungibleKey:r==="sell"?e.data.key:s.mode.sellFungibleKey,buyFungibleKey:r==="buy"?e.data.key:s.mode.buyFungibleKey}:s.mode.type==="buy"?p={...s.mode,buyCaip19:D(m),sellCaip19:D(d),takerCaip19:r==="buy"?n:s.mode.takerCaip19}:s.mode.type==="sell"&&(p={...s.mode,sellCaip19:D(d),buyCaip19:D(m),takerDestinationCaip19:r==="sell"?n:s.mode.takerDestinationCaip19}),aa({tokens:[m,d]}).then(f=>{let g=f[D(m)],w=f[D(d)];this.tokenStateMachine.send({type:"changeToken",mode:p,token:e,perspective:r,buyTokenPrice:g,sellTokenPrice:w})}).catch(f=>{E.captureError(f,I.Swapper),this.tokenStateMachine.send({type:"changeToken",mode:p,token:e,perspective:r})})}selectQuote(e){this.send({type:ct.UserSelectedQuote,quote:e})}setQuoteConfig(e){this.config={...this.config,...e},this.refreshQuoteProcessor()}refreshQuoteProcessor(){let e=this.getLastQuoteProcessorSwapAmount();e&&this.setAmount(e)}getLastQuoteProcessorSwapAmount(){let e=this.getQuoteProcessorState();switch(e.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":let r=e.input;return{amount:b(r.amount).shiftedBy(-1*(r.exactOut?r.buy.data.decimals:r.sell.data.decimals)).toString(),perspective:r.exactOut?"buy":"sell"};default:return}}getState(){return this.stateMachine.getState()}getExecuteState(){return this.executeSwapStateMachine.getState()}stopProcessingQuotes(){this.quoteProcessor.stop()}subscribeExecution(e){return this.executeSwapStateMachine.addListener(e),()=>this.unsubscribeExecution(e)}unsubscribeExecution(e){this.executeSwapStateMachine.removeListener(e)}getQuoteProcessorState(){return this.quoteProcessor.getState()}subscribeQuoteProcessor(e){return this.quoteProcessor.subscribe(e),()=>this.unsubscribeQuoteProcessor(e)}unsubscribeQuoteProcessor(e){this.quoteProcessor.unsubscribe(e)}stopQuoteProcessor(){this.quoteProcessor.stop()}subscribeAccountChange(e){return this.accountChangeListeners.push(e),()=>this.unsubscribeAccountChange(e)}unsubscribeAccountChange(e){this.accountChangeListeners=this.accountChangeListeners.filter(r=>r!==e)}setQuoteStreamer(e){this.quoteProcessor.setQuoteStreamer(e)}getSwapCommandFactory(){return this.swapCommandFactory}setSwapCommandFactory(e){this.swapCommandFactory=e}send(e){return this.stateMachine.send(e)}checkAccount(){if(!this.account)throw new Error("Must set a MultiChainAccount");return this.account}checkChainAddress({chain:e,walletAddress:r}){let{id:n}=e;if(r)return{networkID:n,address:r};let o=this.checkAccount().addresses.find(d=>d.networkID===n);if(!o)throw new Error(`No address found for chain ${n}`);let c={...o};return cr(c)&&(c.address=c.address.toLowerCase()),c}getAddressFromCaip19(e){let r;if("encodedCaip19"in e?r=je(e.encodedCaip19):r=e.caip19,r.resourceType===W.address)return r.address;throw new Error(`CAIP19 ${r} is not an address`)}};u();l();var qc=U($());var Uw=(0,qc.createContext)(null),Mw=Uw.Provider;function vs(){let t=(0,qc.useContext)(Uw);if(!t)throw new Error("useBridgeStatusManager must be used within a BridgeStatusManagerProvider");return t}a(vs,"useBridgeStatusManager");u();l();var qw=U($());u();l();var zc=class{static{a(this,"BitcoinSwapInitializer")}proxyInitializer;constructor(e){this.proxyInitializer=e}async initialize(e,r,n,s){let o=this.getBitcoinAddressTypeForKey(e);if(!o)return this.proxyInitializer.initialize(e,r,n,s);let{key:c,addressType:d,direction:m}=o,p=qF(r,w=>{if(!(Ym(w)&&w.addressType!==d))return w}),f=r.find(w=>w.addressType===d);if(!f)return this.proxyInitializer.initialize(e,r,n,s);switch(m){case"buy":e.takerDestinationCaip19=D({chainId:f.networkID,resourceType:W.address,address:f.address});break;case"sell":e.takerCaip19=D({chainId:f.networkID,resourceType:W.address,address:f.address});break}let g=await this.proxyInitializer.initialize(e,p,n,s);switch(m){case"buy":g.buyToken.data.key=c;break;case"sell":g.sellToken.data.key=c;break}switch(m){case"buy":g.takerCaip19=this.takerCaip19ForToken({token:g.sellToken,addresses:p});break;case"sell":g.takerDestinationCaip19=this.takerCaip19ForToken({token:g.buyToken,addresses:p});break}return g}keyToAddressType={"BitcoinNative-bip122_p2wpkh":ie.BitcoinNativeSegwit,"BitcoinNative-bip122_p2tr":ie.BitcoinTaproot,BitcoinNative:ie.BitcoinTaproot};getBitcoinAddressTypeForKey(e){if(!(e.type!=="buy"&&e.type!=="sell"&&e.type!=="swap")){if(e.sellFungibleKey){let r=this.keyToAddressType[e.sellFungibleKey];if(r)return{key:e.sellFungibleKey,addressType:r,direction:"sell"}}if(e.buyFungibleKey){let r=this.keyToAddressType[e.buyFungibleKey];if(r)return{key:e.buyFungibleKey,addressType:r,direction:"buy"}}}}takerCaip19ForToken({token:e,addresses:r}){if(e.data.walletAddress)return D({chainId:e.data.chain.id,resourceType:W.address,address:e.data.walletAddress});let n=this.findChainAddress({chain:e.data.chain,addresses:r});return D({chainId:n.networkID,resourceType:W.address,address:n.address})}findChainAddress({chain:e,addresses:r}){let{id:n}=e,s=r.find(c=>c.networkID===n);if(!s)throw new Error(`No address found for chain ${n}`);let o={...s};return cr(o)&&(o.address=o.address.toLowerCase()),o}};function qF(t,e){return t.reduce((r,n)=>{let s=e(n);return s!=null&&r.push(s),r},[])}a(qF,"compactMap");u();l();var zF=i.object({buyToken:i.custom(),sellToken:i.custom(),buyTokenPrice:i.custom().optional(),sellTokenPrice:i.custom().optional(),maxSellAmount:i.string().optional()}),Ln=class{static{a(this,"LegacySwapInitializer")}async initialize(e,r,n,s){let o=r.reduce((f,g)=>(f[g.networkID]=g.address,f),{}),c=await H.api().headers({"Content-Type":"application/json"}).timeout(K({seconds:20})).post("/swap/v2/initialize",{...e,addresses:o,cashAddresses:pt?n:void 0,...s?{settings:s}:{}});if(c.status!==200)throw new We({key:"SwapInitializationFailed"});let d=zF.safeParse(c.data);if(!d.success)throw new We({key:"SwapInitializationFailed"});let{buyToken:m,sellToken:p}=d.data;return{buyToken:m,sellToken:p,buyTokenPrice:d.data.buyTokenPrice,sellTokenPrice:d.data.sellTokenPrice,maxSellAmount:new V(d.data.maxSellAmount??p.data.balance),takerCaip19:this.takerCaip19ForToken({token:p,addresses:r}),takerDestinationCaip19:this.takerCaip19ForToken({token:m,addresses:r}),quoteParams:{phantomCashAccount:Ne(m)||Ne(p),isPrediction:!1}}}takerCaip19ForToken({token:e,addresses:r}){if(e.data.walletAddress&&ia(e))return D({chainId:e.data.chain.id,resourceType:W.address,address:e.data.walletAddress});let n=this.findChainAddress({chain:e.data.chain,addresses:r});return D({chainId:n.networkID,resourceType:W.address,address:n.address})}findChainAddress({chain:e,addresses:r}){let{id:n}=e,s=r.find(c=>c.networkID===n);if(!s)throw new Error(`No address found for chain ${n}`);let o={...s};return cr(o)&&(o.address=o.address.toLowerCase()),o}};u();l();u();l();var di=class{static{a(this,"WarmSwapAnalytics")}analytics;constructor(e){this.analytics=e}warmingStarted(e){this.analytics.capture("swapperWarmingStarted",{data:{mode:e.type,caip19:this.getCaip19(e)}})}warmingCompleted(e,r){this.analytics.capture("swapperWarmingCompleted",{data:{mode:e.type,caip19:this.getCaip19(e),durationMs:r}})}warmingFailed(e){this.analytics.capture("swapperWarmingFailed",{data:{mode:e.type,caip19:this.getCaip19(e)}})}cacheHit(e){this.analytics.capture("swapperWarmCacheHit",{data:{mode:e.type,caip19:this.getCaip19(e)}})}cacheMiss(e){this.analytics.capture("swapperWarmCacheMiss",{data:{mode:e.type,caip19:this.getCaip19(e)}})}warmingAwaited(e){this.analytics.capture("swapperWarmingAwaited",{data:{mode:e.type,caip19:this.getCaip19(e)}})}getCaip19(e){switch(e.type){case"buy":return e.buyCaip19;case"sell":return e.sellCaip19;default:return}}};var Qc=class{static{a(this,"WarmSwapInitializer")}proxyInitializer;multiChainAccount;cashAddresses;cache;analytics;constructor(e,r,n){this.proxyInitializer=e,this.cache=new ip(r),this.analytics=n?new di(n):void 0}async initialize(e,r,n,s){let o=this.cache.get(e);if(!o)return this.analytics?.cacheMiss(e),this.proxyInitializer.initialize(e,r,n,s);switch(o.type){case"idle":return this.analytics?.cacheMiss(e),this.proxyInitializer.initialize(e,r,n,s);case"warming":return this.analytics?.warmingAwaited(e),o.promise.catch(()=>this.proxyInitializer.initialize(e,r,n,s)).finally(()=>{this.cache.delete(e)});case"warmed":return this.analytics?.cacheHit(e),this.cache.delete(e),o.initializationResult}}warmInitialization(e){if(!this.multiChainAccount)return;let r=this.cache.peek(e);if(r&&r.type==="warmed"&&Bc(r.swapMode,e))return;this.analytics?.warmingStarted(e);let n=Date.now(),s=this.proxyInitializer.initialize(e,this.multiChainAccount.addresses,this.cashAddresses??{},{});this.cache.set(e,{type:"warming",swapMode:e,promise:s}),s.then(o=>{let c=Date.now()-n;this.analytics?.warmingCompleted(e,c),this.cache.set(e,{type:"warmed",swapMode:e,initializationResult:o})}).catch(()=>{this.analytics?.warmingFailed(e),this.cache.delete(e)})}setMultiChainAccount(e){this.cache.clear(),this.multiChainAccount=e}setCashAddresses(e){this.cache.clear(),this.cashAddresses=e}setAnalytics(e){this.analytics||(this.analytics=new di(e))}},ip=class{static{a(this,"Cache")}capacity;entries=new Map;constructor(e){this.capacity=e}getKey(e){let r={type:e.type},n=a(s=>{if(s?.minimumOrderSize)return{minimumOrderSize:{base:s.minimumOrderSize.base?.toString(),quote:s.minimumOrderSize.quote?.toString()}}},"serializeOptions");switch(e.type){case"buy":return JSON.stringify({...r,buyCaip19:e.buyCaip19,sellCaip19:e.sellCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:n(e.options)});case"sell":return JSON.stringify({...r,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:n(e.options)});case"swap":return JSON.stringify({...r,network:e.network,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:n(e.options)});case"prediction":return JSON.stringify({...r,network:e.network,mode:e.mode,outcomeType:e.outcomeType,mintAccounts:e.mintAccounts,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:n(e.options)});default:let s=e;return JSON.stringify(r)}}get(e){return this.entries.get(this.getKey(e))}peek(e){return this.entries.get(this.getKey(e))}set(e,r){let n=this.getKey(e);if(this.entries.set(n,r),this.entries.size>this.capacity){let s=Array.from(this.entries.keys())[0];this.entries.delete(s)}}delete(e){this.entries.delete(this.getKey(e))}clear(){this.entries.clear()}};var QF=2,Hc=new Qc(new zc(new Ln),QF);var zw=(0,Kt.createContext)(null);function HF({children:t,processorMode:e="noOp",quoteStreamer:r,supportedActions:n}){let{data:s}=Fe(),o=Se(),c=Ke(),d=(0,Kt.useMemo)(()=>Ng(c),[c]);(0,Kt.useEffect)(()=>{d.initialize()},[d]);let m=(0,Kt.useMemo)(()=>Qw(e,d,o,n),[e,d,o,n]);(0,Kt.useEffect)(()=>{s&&(m.setAccount(s),Hc.setMultiChainAccount(s))},[s,m]),(0,Kt.useEffect)(()=>{r&&m.setQuoteStreamer(r)},[r,m]);let p=ag();return(0,Kt.useEffect)(()=>{p&&Hc.setCashAddresses(p)},[p,m]),(0,ap.jsx)(Mw,{value:d,children:(0,ap.jsx)(zw.Provider,{value:m,children:t})})}a(HF,"SwapperProvider");function Nt(){let t=(0,Kt.useContext)(zw),e=Se();return t||Qw("noOp",void 0,e)}a(Nt,"useSwapper");function Qw(t,e,r,n=[]){return new Mc(new Ra,new Xa(e),new hc(new ec(pt?new Ya:new Ja,n),t==="noOp"?new pc:new dc,()=>r.getDeviceId()),Hc)}a(Qw,"createSwapper");u();l();var Hw=U($());var GF=a(t=>{let e=Ke(),r=vs(),{t:n}=Kr(),s=(0,Hw.useRef)(void 0),o=Pf.pendingTransactionById(t);return ne({queryKey:o,queryFn:a(async()=>{try{let m=(await Uf(e))[t],p=m?void 0:r.getPendingBridgeTransactionById(t,n),f=m??p;return f?(Xf(f,s.current)||(s.current=f),s.current):void 0}catch(d){throw E.captureError(d,I.Transaction),d}},"queryFn"),refetchInterval:K({milliseconds:200}),staleTime:K({milliseconds:200}),gcTime:0,refetchOnMount:!0})},"usePendingTransactionByIdWithBridge");u();l();var Wt=U($());u();l();var Rs=a(t=>{let e=Math.floor(t/3600),r=Math.floor((t-e*3600)/60),n=t%60;if(e>0)return L.t("swapProviderEstimatedTimeHM",{hours:e,minutes:r});if(r>0){let s=n>0?r+1:r;return L.t("swapProviderEstimatedTimeM",{minutes:s})}return L.t("swapProviderEstimatedTimeS",{seconds:n})},"formatSecondsAsSwapTime");u();l();var Gc=a(t=>t.steps.reduce((e,r)=>e.plus(new V(r.nonIncludedNonGasFees)),new V(0)),"getBridgeStepsFees"),Gw=a(t=>t.steps.flatMap(r=>r.feeCosts).reduce((r,n)=>r.plus(n.amountUSD??0),new V(0)),"getBridgeStepsFeesInUsd");u();l();var Vc=a(t=>t&&de(t)?t.executionDuration:0,"getSwapExecutionDuration");u();l();var Ds=ft(t=>({preferredProvider:void 0,setPreferredProvider:a(e=>t({preferredProvider:e}),"setPreferredProvider"),isSaving:!1,setIsSaving:a(e=>t({isSaving:e}),"setIsSaving")}));var Vw=a((t,e)=>(t==="firstQuoteReceived"||t==="quoteProcessed")&&e==="pair","isQuoteStateValid"),VF=a(({selectProvider:t,dismiss:e})=>{let{currencySymbol:r,fromUsd:n}=ch(),s=Nt(),[o,c]=(0,Wt.useState)(!1),[d,m]=(0,Wt.useState)(s.getQuoteProcessorState());(0,Wt.useEffect)(()=>{let y=s.subscribeQuoteProcessor({onStateChange(S,x){m(x)}});return()=>y()},[s]);let[p,f]=(0,Wt.useState)(s.getTokenState());(0,Wt.useEffect)(()=>{let y=s.subscribeToken({onStateChange(S,x,T){f(T)}});return()=>y()},[s]);let g=(0,Wt.useRef)(Vw(d.type,p.type));return(0,Wt.useEffect)(()=>{Vw(d.type,p.type)?g.current=!0:g.current&&e&&(Ds.getState().isSaving||e())},[d.type,p.type,e]),{details:(0,Wt.useMemo)(()=>{if(d.type!=="quoteProcessed"&&d.type!=="firstQuoteReceived"||p.type!=="pair")return[];let y=d.quote,S=WF(y),x=y.baseProvider.name,T=KF({currentQuote:y,buyToken:p.buyToken,sellToken:p.sellToken,isFlipped:o,setIsFlipped:c});return de(y)?jF({quote:y,selectProvider:t,exchangeRate:T,currencySymbol:r,fromUsd:n}):$F({provider:x,sources:S,exchangeRate:T,selectProvider:t})},[d,p,t,r,n,o]),footnote:L.t("swapProviderPricingFootnote")}},"useSwapPricing"),$F=a(({provider:t,sources:e,exchangeRate:r,selectProvider:n})=>[{label:L.t("swapProviderPricingProvider"),value:t,icon:"chevron-right",onPress:n},{label:L.t("swapProviderPricingMarket"),value:e},{label:L.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip}],"getStandardRows"),jF=a(({quote:t,selectProvider:e,exchangeRate:r,currencySymbol:n,fromUsd:s})=>{let o=t.baseProvider.name,c=Gw(t).toString(),d=Rs(Vc(t));return[{label:L.t("swapProviderPricingProvider"),value:o,icon:"chevron-right",onPress:e},{label:L.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip},{label:L.t("swapProviderPricingFees"),value:`${n}${s(Number(c),2)} ${L.t("swapProvidersFee")}`},{label:L.t("swapProviderPricingTime"),value:d}]},"getBridgeRows");function KF({currentQuote:t,buyToken:e,sellToken:r,isFlipped:n,setIsFlipped:s}){let{exchangeRate:o,exchangeRateFlipped:c}=xd(t,e,r);return{rate:n?c:o,flip:a(()=>s(!n),"flip")}}a(KF,"getExchangeRate");function WF(t){return ve(Le(t))}a(WF,"getSources");u();l();u();l();var Nr=U($());function ZF(t){let e=vs(),{t:r}=Kr(),[n,s]=(0,Nr.useState)(0),[o,c]=(0,Nr.useState)(0),[d,m]=(0,Nr.useState)(0);return(0,Nr.useEffect)(()=>{let f={onBridgeStatusChange:a(g=>{s(w=>w+1),(g.type==="completed"||g.type==="failed")&&c(w=>w+1)},"onBridgeStatusChange")};return e.addListener(f),()=>{e.removeListener(f)}},[e]),(0,Nr.useEffect)(()=>{let f=setInterval(()=>{m(g=>g+1)},K({minutes:1}));return()=>clearInterval(f)},[]),{pendingBridgeTransactions:(0,Nr.useMemo)(()=>t.length?e.getPendingBridgeTransactions(r,{addresses:t}):[],[e,t,r,n,d,o])}}a(ZF,"useBridgePendingActivities");u();l();var Br=U($());var XF={"BitcoinNative-bip122_p2wpkh":ie.BitcoinNativeSegwit,"BitcoinNative-bip122_p2tr":ie.BitcoinTaproot,BitcoinNative:ie.BitcoinTaproot};function $w(t){return XF[t]??null}a($w,"normalizeBitcoinFungibleKey");function jw(t,e){let r=$w(t),n=$w(e);return r&&n?r===n:t===e}a(jw,"doBitcoinFungibleKeysMatch");function JF(t,e,r){let n=vs(),{t:s}=Kr(),[o,c]=(0,Br.useState)(0),[d,m]=(0,Br.useState)(0);(0,Br.useEffect)(()=>{let w={onBridgeStatusChange:a(y=>{c(S=>S+1),(y.type==="completed"||y.type==="failed")&&m(S=>S+1)},"onBridgeStatusChange")};return n.addListener(w),()=>{n.removeListener(w)}},[n]);let p=(0,Br.useMemo)(()=>t.length?n.getPendingBridgeActivities(s,{addresses:t}):[],[n,t,s,o,d]),f=(0,Br.useMemo)(()=>t.length?n.getPendingBridgeTransactions(s,{addresses:t}):[],[n,t,s,o,d]);return{pendingBridgeTransactions:(0,Br.useMemo)(()=>{if(!f.length||!p.length||!r)return[];let w=new Map(p.map(x=>[x.record.executionId,x.record])),y=A.isBitcoinNetworkID(r),S=e;return f.filter(x=>{let T=w.get(x.id);if(!T)return!1;let _=T.quote.sell,k=T.quote.buy;if(!_&&!k)return!1;if(_){let P=_.data.key;if(y&&jw(S,P))return!0;let v=Y(_),z=En(v)?.[0];if(z&&S===z)return!0}if(k){let P=k.data.key;if(y&&jw(S,P))return!0;let v=Y(k),z=En(v)?.[0];if(z&&S===z)return!0}return!1})},[f,p,e,r])}}a(JF,"useFungibleBridgePendingActivities");u();l();u();l();function Lr(t){return{chain:we.Solana,type:"fungible",address:t.type===ae.SPL?t.data.mintAddress:void 0,symbol:t.data.symbol??""}}a(Lr,"getAnalyticsAsset");var On;(function(t){t.Home="home",t.Explore="explore",t.ActivityItemDetail="activityItemDetail",t.ExploreInSwap="exploreInSwap",t.ShareStory="shareStory",t.SwapAssetSelect="swapAssetSelect",t.Profile="profile",t.Chat="chat",t.TradeHub="tradeHub",t.CashQuickSellCrypto="cashQuickSellCrypto",t.CashActivityDetail="cashActivityDetail",t.PredictionMarketOrder="predictionMarketOrder",t.FungibleDetail="fungibleDetail",t.DeepLink="deepLink"})(On||(On={}));var Ns=class{static{a(this,"NextGenAnalytics")}analytics;additionalAnalyticsTags;constructor(e,r){this.analytics=e,this.additionalAnalyticsTags=r}captureEvent(e,r){let n={...r,data:{...r.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,n)}swapperOpen(e,r,n){this.captureEvent("swapperOpen",{data:{uiContext:n??"swapperInterstitial",swapMode:e,comingFrom:r}})}swapperClose(e,r){this.captureEvent("swapperClose",{data:{uiContext:r??"swapperInterstitial",reason:e}})}swapperUpdateAsset(e,r){switch(e.type){case"sell":this.captureEvent("swapperUpdateToAsset",{data:Lr(r)});break;case"buy":this.captureEvent("swapperUpdateFromAsset",{data:Lr(r)});break}}swapperSwapDefaultQuoteSelected(e){this.captureEvent("swapperSwapDefaultQuoteSelected",{data:{quotePercentageValue:e}})}swapperDetailPanelClicked(){this.captureEvent("swapperDetailPanelClicked",{data:{uiContext:"swapperInterstitial"}})}swapperToggleQuoteCurrency(){this.captureEvent("swapperToggleQuoteCurrency",{data:{uiContext:"swapperInterstitial"}})}swapperQuotesResult(e,r,n){this.captureEvent("swapperQuotesResult",{data:{...pi(e,n),numQuotes:r.quotes.length,sellToken:D(Y(e.sell)),buyToken:D(Y(e.buy)),fromNetworkId:e.sell.data.chain.id,toNetworkId:e.buy.data.chain.id,isGasless:r.quotes.some(s=>"gaslessSwapFeeResult"in s&&s.gaslessSwapFeeResult?.success===!0)}})}swapperQuotesError({input:e,quoteError:r}){this.captureEvent("swapperQuotesError",{data:{...pi(e),error:r.name}})}};function YF(t,e){if(!e||!Pt(t.type))return;let r=new b(t.data.balance);if(!r.isZero())return e.eq(r)}a(YF,"checkIsMaxSellFullBalance");function pi(t,e,r){let n=e?eP(e):void 0;return{isSellTokenVerified:t.sell.data.spamStatus&&na({minimum:ce.Verified,spamStatus:t.sell.data.spamStatus}),sellTokenCaip19:D(Y(t.sell)),sellTokenNetworkId:t.sell.data.chain.id,sellTokenSymbol:t.sell.data.symbol??void 0,sellTokenMarketCap:t.sell.data.marketCap,sellTokenAmount:t.amount,buyTokenCaip19:D(Y(t.buy)),buyTokenNetworkId:t.buy.data.chain.id,buyTokenSymbol:t.buy.data.symbol??void 0,isAutoSlippageEnabled:t.autoSlippage,manualSlippagePercent:t.slippageTolerance,isExactOut:t.exactOut,isManualTipInput:t.tipAmount!==void 0,gaslessError:n?.error,gaslessAtaFeeUSD:n?.data?.ataFeeUSD,gaslessNetworkFeeUSD:n?.data?.networkFeeUSD,gaslessTotalAmountUSD:n?.data?.totalAmountUSD,isCash:t.phantomCashAccount,isMaxSellFullBalance:YF(t.sell,r?.maxSellAmount),totalNativeRequirement:r?.totalNativeRequirement?.toString(),nativeBalance:r?.nativeBalance?.toString()}}a(pi,"createSwapperAnalyticsFields");function cp(t,e){if(t.type==="quoteProcessed")return pi(t.input,t.quote,e)}a(cp,"createSwapperAnalyticsFieldsFromQuoteProcessorState");function eP(t){if(Qt(t))return t.gaslessSwapFeeResult}a(eP,"getGaslessSwapFeeResult");u();l();var tP=U(So());var mi=U($());var rP=(0,mi.createContext)(void 0);var Kw=a(()=>{let t=(0,mi.useContext)(rP);if(!t)throw new Error("useSwapToken must be used within a SwapTokenProvider");return t},"useSwapToken");u();l();function Ww(t,e,r,n){let o=e.find(d=>d.percentage===1)?.amount;if(n==="sell"&&o&&new V(t).gt(o))return["insufficientBalance"];let c=r.type==="buy"?r.options?.minimumOrderSize?.quote:r.options?.minimumOrderSize?.base;return c!=null&&new V(t).lt(c)?["minimumBalance"]:[]}a(Ww,"createQuoteInputErrors");u();l();var nP=[.25,.5,1],up=class{static{a(this,"SellPercentage")}percentage;amount;fiatAmount;constructor(e,r,n){this.percentage=e,this.amount=r,this.fiatAmount=n}getAmountForDenomination(e){return e==="crypto"?this.amount:this.fiatAmount}};function Zw({maxSellAmount:t,sellTokenPrice:e,allowedPercentages:r=nP}){return r.map(n=>{let s=t.multipliedBy(n);return new up(n,s,s.multipliedBy(e?.usd??0))})}a(Zw,"getSellPercentages");u();l();var nS=U($());u();l();var Xw=a(()=>gt({key:ke.PriorityFee,queryKey:pe.priorityFee()}),"usePriorityFee"),F7=a(()=>yt({key:ke.PriorityFee,queryKey:pe.priorityFee()}),"useSetPriorityFee");u();l();var $c=a(()=>gt({key:ke.SlippageTolerance,queryKey:pe.slippageTolerance()}),"useSlippageTolerance"),L7=a(()=>yt({key:ke.SlippageTolerance,queryKey:pe.slippageTolerance()}),"useSetSlippageTolerance");u();l();var Jw=a(()=>gt({key:ke.TipAmount,queryKey:pe.tipAmount()}),"useTip"),H7=a(()=>yt({key:ke.TipAmount,queryKey:pe.tipAmount()}),"useSetTip");u();l();var Yw=U($());var Bs;(function(t){t.Auto="auto",t.Fixed="fixed"})(Bs||(Bs={}));var sP={type:Bs.Auto},eS=a(()=>{let{priorityFeeSetting:t,isFetched:e,save:r}=oP();return{isFetched:e,selectedSetting:t,setPriorityFeeSetting:r}},"usePriorityFeeSettings"),oP=a(()=>{let{data:t,isFetched:e}=gt({key:ke.PriorityFeeSettings,queryKey:pe.priorityFeeSettings()}),{mutateAsync:r}=yt({key:ke.PriorityFeeSettings,queryKey:pe.priorityFeeSettings()}),n=(0,Yw.useCallback)(async s=>{await r(s)},[r]);return{isFetched:e,priorityFeeSetting:t??sP,save:n}},"usePriorityFeeSettingsStore");u();l();var tS=U($());var Ls;(function(t){t.Auto="auto",t.Fixed="fixed"})(Ls||(Ls={}));var iP={type:Ls.Auto},rS=a(()=>{let{tipSetting:t,isFetched:e,save:r}=aP();return{isFetched:e,selectedSetting:t,setTipSetting:r}},"useTipSettings"),aP=a(()=>{let{data:t,isFetched:e}=gt({key:ke.TipSettings,queryKey:pe.tipSettings()}),{mutateAsync:r}=yt({key:ke.TipSettings,queryKey:pe.tipSettings()}),n=(0,tS.useCallback)(async s=>{await r(s)},[r]);return{isFetched:e,tipSetting:t??iP,save:n}},"useTipSettingsStore");var sS=a(()=>{let{selectedSetting:t}=Gt(),{data:e}=$c(),{data:r}=Xw(),{selectedSetting:n}=eS(),{data:s}=Jw(),{selectedSetting:o}=rS(),c=Ds(m=>m.preferredProvider),d=Yn("kill-swapper-simulation")??!1;return(0,nS.useMemo)(()=>({slippageTolerance:e??void 0,priorityFee:n.type==="fixed"?r??void 0:void 0,tipAmount:o.type==="fixed"?s??void 0:void 0,slippageType:t.type,preferredProvider:c,isSimulationKilled:d}),[e,r,n.type,s,o.type,t,c,d])},"useQuoteConfig");u();l();function oS(t){switch(t.type){case"solanaNetwork":case"evmGas":case"suiNetwork":return!0;default:return!1}}a(oS,"isNetworkFee");function cP(t){let e=t.fees.filter(r=>!["gasless","phantom"].includes(r.type));return e.length>0&&e.every(oS)}a(cP,"hasOnlyNetworkFees");u();l();var wt=U($());var uP=a((t,e=[],r)=>{let n=Nt(),s=Se(),o;try{o=Kw().nextGenAnalytics}catch{}let c=(0,wt.useMemo)(()=>o||new Ns(s,r),[s,r,o]),[d,m]=(0,wt.useState)([]),[p,f]=(0,wt.useState)(n.getTokenState());(0,wt.useEffect)(()=>{let M=n.subscribeToken({onStateChange(C,N,Z){f(Z)}});return()=>M()},[n,f]);let[g,w]=(0,wt.useState)(n.getQuoteProcessorState());(0,wt.useEffect)(()=>{let M=n.subscribeQuoteProcessor({onStateChange:a((C,N)=>{N.type==="firstQuoteReceived"&&c.swapperQuotesResult(N.input,N.response,N.quote),w(N),mn.processQuoteProcessorState(N)},"onStateChange")});return()=>{n.stopQuoteProcessor(),M()}},[n,c]);let y=(0,wt.useMemo)(()=>dP(p,g),[p,g]),S=sS();(0,wt.useEffect)(()=>{n.setQuoteConfig(S)},[S,n]);let x=(0,wt.useMemo)(()=>Tt(p)?Zw({sellTokenPrice:p.sellTokenPrice,allowedPercentages:e,maxSellAmount:p.maxSellAmount}):[],[p,e]),T=Ds(M=>M.setPreferredProvider);(0,wt.useEffect)(()=>{let M=n.subscribeToken({onStateChange(C,N,Z){C.type==="initializeStarted"&&T(void 0)}});return()=>M()},[n,T]);let _=(0,wt.useCallback)(({amount:M,denomination:C,perspective:N,tokenStateOverride:Z})=>{try{let oe=lP(Z??p,M,C,N),re=Ww(oe,x,t,N);m(re),T(void 0),n.setAmount({amount:oe,perspective:N},{...S,preferredProvider:void 0})}catch(oe){E.captureError(oe,I.Swapper)}},[p,x,t,T,n,S]),{connection:k}=tn(),P=Ke(),v=jr(),z=Wr(),Q=L.language,R=Yn("kill-swapper-simulation")??!1,G=(0,wt.useCallback)(async M=>{M.forEach(N=>n.subscribeExecution(N));let C=await s.getDeviceId();await n.swap({signer:v,storage:P,locale:Q,deviceId:C,connection:k,authRepository:z,isSimulationKilled:R}),M.forEach(N=>n.unsubscribeExecution(N))},[n,s,v,P,Q,k,z,R]);return{setAmount:_,swap:G,tokenState:p,quoteProcessorState:g,quotedAmounts:y,inputErrors:d,sellPercentages:x}},"useSwapperQuotes");function lP(t,e,r,n){if(!Tt(t))throw new Error("Token state is not a pair");let{sellTokenPrice:s,sellToken:o,buyToken:c,buyTokenPrice:d}=t;switch(r){case"fiat":switch(n){case"buy":if(!d?.usd)throw new Error("Token price not found");return new b(e).dividedBy(d.usd).decimalPlaces(c.data.decimals).toString();case"sell":if(!s?.usd)throw new Error("Token price not found");return new b(e).dividedBy(s.usd).decimalPlaces(o.data.decimals).toString()}break;case"crypto":switch(n){case"buy":return new b(e).decimalPlaces(c.data.decimals).toString();case"sell":return new b(e).decimalPlaces(o.data.decimals).toString()}break}}a(lP,"parseAmount");function dP(t,e){if(!Tt(t)||e.type!=="firstQuoteReceived"&&e.type!=="quoteProcessed")return;let r=e.quote,{sellToken:n,buyToken:s,sellTokenPrice:o,buyTokenPrice:c}=t;return{buyAmount:new b(r.buyAmount).shiftedBy(-s.data.decimals),buyAmountUsd:c?.usd?new b(r.buyAmount).shiftedBy(-s.data.decimals).multipliedBy(c.usd):void 0,sellAmount:new b(r.sellAmount).shiftedBy(-n.data.decimals),sellAmountUsd:o?.usd?new b(r.sellAmount).shiftedBy(-n.data.decimals).multipliedBy(o.usd):void 0}}a(dP,"parseQuoteAmounts");u();l();function lp(t){switch(t.type){case Ee.SlippageExceeded:return L.t("swapTxConfirmationSwapFailedSlippageLimit");case Ee.InsufficientFunds:return L.t("swapTxConfirmationSwapFailedInsufficientBalance");case Ee.InsufficientGas:return L.t("swapTxConfirmationSwapFailedInsufficientGas");case Ee.AccountFrozen:return L.t("swapTxConfirmationSwapFailedAcountFrozen");case Ee.SimulationTimeout:return L.t("swapTxConfirmationSwapFailedSimulationTimeout");case Ee.StaleQuote:return L.t("swapTxConfirmationSwapFailedStaleQuote");case Ee.UnknownError:return L.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return L.t("swapTxConfirmationSwapFailedTryAgain")}}a(lp,"getSimulationErrorMessage");u();l();var zS=U(So());var Or=U($());u();l();var dp=class{static{a(this,"FullBalanceDisplayStrategy")}format(e,r){return`${Eo(e)} ${r}`}},pp=class{static{a(this,"CompactBalanceDisplayStrategy")}format(e,r){return`${ts(e,{compact:!0})} ${r}`}},mp=class{static{a(this,"CompactNoSymbolBalanceDisplayStrategy")}format(e){return ts(e,{compact:!0})}};function fp(t){switch(t){case"full":return new dp;case"compact":return new pp;case"compactNoSymbol":return new mp}}a(fp,"createBalanceDisplayStrategy");u();l();var jc=class{static{a(this,"DefaultGetSwapQuotesStrategy")}async fetch(e){return await va(e)}stopFetching(){}getFetchInterval(e){return e}};u();l();u();l();var Os=class{static{a(this,"QuoteLoggerExecuteSwapStateListener")}streamedQuoteLogger;constructor(e){this.streamedQuoteLogger=e}onStateChange(e,r,n){n.type===Te.TransactionSubmitted&&this.streamedQuoteLogger.logState(n.txReceipt.id)}};u();l();u();l();u();l();var Kc=a((t,e,r)=>{if(r)return Re(t,e).times(b(r)).toNumber()},"getAssetVolumeUsd"),iS=a((t,e)=>e&&t?e>t?e:t:e??t,"getTotalUsdVolume");function aS({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:n,buyAmount:s,sellAmount:o,phantomFeeUiAmount:c,priceImpact:d,provider:m,baseProvider:p,slippageTolerance:f,slippageType:g,sellSwapFilter:w,isRetry:y,analyticsContext:S,tradeDirection:x=void 0}){if(e&&n){let T=Kc(s,e.data.decimals,t),_=Kc(o,n.data.decimals,r),k=iS(T,_);return{networkId:n.data.chain.id,chainId:A.getChainID(n.data.chain.id),toNetworkId:e.data.chain.id,toChainId:A.getChainID(e.data.chain.id),isBridge:n.data.chain.id!==e.data.chain.id,marketName:`${n.data.symbol}/${e.data.symbol}`,tradeDirection:x,swapSource:m,baseProvider:p,priceImpact:d,fromAssetSymbol:n.data.symbol??"",fromAssetAddress:n.data.tokenAddress,fromAssetAmount:Re(o,n.data.decimals),fromAssetUsdPrice:r,fromAssetUsdVolume:_,toAssetSymbol:e.data.symbol??"",toAssetAddress:e.data.tokenAddress,toAssetAmount:Re(s,e.data.decimals),toAssetUsdPrice:t,toAssetUsdVolume:T,totalUsdVolume:k,feeUsd:c,slippageTolerance:f,slippageType:g,sellSwapFilter:w,isRetry:y,analyticsContext:S}}return null}a(aS,"legacyAnalyticsPayload");function Wc({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:n,quote:s,slippageTolerance:o,slippageType:c,sellSwapFilter:d,isRetry:m,analyticsContext:p,baseProvider:f}){if(e&&n){let{buyAmount:g,sellAmount:w}=s,y="priceImpact"in s?s.priceImpact:0,S="sources"in s?ve(s.sources):"",x=("fees"in s?s.fees.find(P=>P.type==="phantom")?.amount.toString():"")??"",T=Kc(g,e.data.decimals,t),_=Kc(w,n.data.decimals,r),k=iS(T,_);return{chainId:n.data.chain.id??e.data.chain.id,swap:{marketName:`${n.data.symbol}/${e.data.symbol}`,tradeDirection:"sell",swapSource:S,priceImpact:y,fromAssetSymbol:n.data.symbol??"",fromAssetAddress:n.data.tokenAddress??"",fromAssetAmount:Re(w,n.data.decimals),fromAssetUsdPrice:r??0,fromAssetUsdVolume:_??0,toAssetSymbol:e.data.symbol??"",toAssetAddress:e.data.tokenAddress??"",toAssetAmount:Re(g,e.data.decimals),toAssetUsdPrice:t,toAssetUsdVolume:T,totalUsdVolume:k??0,feeUsd:Number(x),slippageTolerance:o,slippageType:c,sellSwapFilter:d,isRetry:m,analyticsContext:p,baseProvider:f}}}return null}a(Wc,"analyticsPayload");function Zc({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:n,buyAmount:s,sellAmount:o,phantomFeeUiAmount:c,priceImpact:d,provider:m,baseProvider:p,slippageTolerance:f,transactionId:g,slippageType:w,sellSwapFilter:y,isRetry:S,analyticsContext:x,tradeDirection:T}){let _=aS({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:n,buyAmount:s,sellAmount:o,phantomFeeUiAmount:c,priceImpact:d,provider:m,baseProvider:p,slippageTolerance:f,slippageType:w,sellSwapFilter:y,isRetry:S,analyticsContext:x,tradeDirection:T});return _?{data:{..._,id:g}}:{}}a(Zc,"getAnalyticsPayload");u();l();var Xc=a(({txReceipt:t,networkID:e,amountType:r,swapAnalytics:n,walletAddress:s})=>{let o=Zr(e);E.addBreadcrumb(I.Swapper,"submittedTransaction",F.Info,{...o,txReceipt:t.id,method:o.chainType===ie.Solana?"signAndSendTransaction":o.chainType===ie.EVM?"eth_sendRawTransaction":o.chainType===ie.Sui?"signAndExecuteTransaction":"UNKNOWN"}),o.chainType===ie.Solana?n.submittedTransaction(t.id,{...o,method:"signAndSendTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:s}):o.chainType===ie.EVM?n.submittedTransaction(t.id,{...o,method:"eth_sendRawTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:s}):o.chainType===ie.Sui&&n.submittedTransaction(t.id,{...o,method:"signAndExecuteTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:s})},"logTransactionSubmitted");u();l();var cS=U($());var pP={calculate(t){let e=(t?.fees??[]).find(r=>r.type==="phantom");return{amount:new b(e?.amount??0),amountUsd:null,pct:e?.percentage??0}}},mP={calculate(t){let e=t.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return{amount:new b(e?.amount??0),amountUsd:null,pct:parseFloat(e?.percentage??"0")}}},uS=a(()=>{let{currentQuote:t}=Ie();return{phantomFee:(0,cS.useMemo)(()=>hp(t),[t])}},"usePhantomFee");function hp(t){return lr(t)?pP.calculate(t):de(t)?mP.calculate(t):hn}a(hp,"calculatePhantomFee");u();l();var Jc=a(t=>t?de(t)?void 0:t.priceImpact:0,"getSwapPriceImpact");u();l();var lS=ft(t=>({lastFailedSwap:void 0,setLastFailedSwap:a(e=>{t({lastFailedSwap:e})},"setLastFailedSwap")}));function dS(){return lS.getState().lastFailedSwap}a(dS,"getLastFailedSwap");function gp(t){lS.getState().setLastFailedSwap(t)}a(gp,"setLastFailedSwap");var Us=class{static{a(this,"AnalyticsExecuteSwapStateListener")}swapAnalytics;analytics;uiContext;additionalAnalyticsTags;constructor(e,r,n="swapperClassic",s){this.swapAnalytics=e,this.analytics=r,this.uiContext=n,this.additionalAnalyticsTags=s}captureEvent(e,r){let n={...r,data:{...r?.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,n)}onStateChange(e,r,n,s){switch(e.type){case X.ExecuteSwapStarted:this.captureEvent("swapperSwap",{data:{...this.createAnalyticsPayload(n.executingQuote).data,uiContext:this.uiContext}});let o=Wc({buyAssetUsdValue:n.executingQuote.buy.data.usd,buyToken:n.executingQuote.buy,sellAssetUsdValue:n.executingQuote.sell.data.usd,sellToken:n.executingQuote.sell,quote:n.executingQuote.quote,slippageTolerance:this.parseSlippageTolerance(n.executingQuote.slippageType,n.executingQuote.quote,n.executingQuote.response),slippageType:n.executingQuote.slippageType,sellSwapFilter:j.getState().swapFilter,isRetry:this.isRetry(n.executingQuote),analyticsContext:n.executingQuote.quote.analyticsContext,baseProvider:n.executingQuote.quote.baseProvider?.id??""});o&&(E.addBreadcrumb(I.Swapper,"approved",F.Info,Jn(o.swap)),this.swapAnalytics.approved(o));break;case X.SimulationFailed:e.error.type!==Ee.SlippageExceeded&&E.captureError(e.error,I.Swapper),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(n.executingQuote).data,error:fP(e.error)}});break;case X.TransactionSubmissionFailed:E.captureError(e.error,I.Swapper),e.error.type==="noSignature"&&this.captureEvent("swapperSwapFailureNoSignature"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(n.executingQuote).data,error:e.error.message,uiContext:this.uiContext}});break;case X.TransactionSubmissionSuccess:Xc({txReceipt:e.txReceipt,networkID:e.txReceipt.networkID,amountType:n.executingQuote.amount.perspective==="buy"?"buy":"sell",swapAnalytics:this.swapAnalytics});break;case X.TransactionConfirmationFailed:let c=fn(e.error);E.captureError(e.error,I.Swapper),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(n.executingQuote).data,error:c.message,uiContext:this.uiContext}});let d=Zr(e.txReceipt.networkID),m={chainId:A.getChainID(e.txReceipt.networkID),networkId:e.txReceipt.networkID},p=e.txReceipt;switch(this.captureEvent("waitForTransactionConfirmationError",{data:{...m,errorMessage:c.message}}),d.chainType){case ie.EVM:case ie.Solana:case ie.Sui:E.addBreadcrumb(I.Swapper,"transactionStatus",F.Error,{...d,txReceipt:p.id}),this.swapAnalytics.transactionStatus(p.id,{...d,status:{type:"error"}});break}break;case X.TransactionConfirmed:this.captureEvent("swapperSwapSuccess",{data:{...this.createAnalyticsPayload(n.executingQuote,e.txReceipt).data,uiContext:this.uiContext}});let f=Zr(e.txReceipt.networkID);switch(E.addBreadcrumb(I.Swapper,"transactionStatus",F.Info,{...f,txReceipt:e.txReceipt.id}),f.chainType){case ie.EVM:case ie.Solana:case ie.Sui:this.swapAnalytics.transactionStatus(e.txReceipt.id,{...f,status:{type:"confirmed"}});break}break}this.isFailureEvent(e)?gp(n.executingQuote):e.type===X.TransactionSubmissionSuccess&&gp(void 0)}createAnalyticsPayload(e,r){let n=e.quote,s=j.getState(),o=Zc({buyToken:e.buy,sellToken:e.sell,buyAmount:n.buyAmount.toString(),sellAmount:n.sellAmount.toString(),phantomFeeUiAmount:hp(n).amountUsd?.toString()??"",priceImpact:Jc(n),provider:ve(Le(n)),buyAssetUsdValue:s.buyUsdValue,sellAssetUsdValue:s.sellUsdValue,slippageTolerance:this.parseSlippageTolerance(e.slippageType,n,e.response),transactionId:r?.id??"",slippageType:e.slippageType,sellSwapFilter:s.swapFilter,isRetry:this.isRetry(e),analyticsContext:e.quote.analyticsContext,baseProvider:e.quote.baseProvider?.id??"",tradeDirection:e.swapMode?.type}),c=e.quoteInput,d=Ne(e.buy)||Ne(e.sell);return c?{data:{...o.data,...pi(c,n),isCashSwap:d}}:{data:{...o.data,isCashSwap:d}}}parseSlippageTolerance(e,r,n){switch(e){case fe.Fixed:return n.slippageTolerance;case fe.Auto:return lr(r)?r.slippageTolerance:n.slippageTolerance}}isRetry(e){let r=dS();if(!r)return!1;let n=D(Y(r.buy)),s=D(Y(r.sell)),o=D(Y(e.buy)),c=D(Y(e.sell));return n===o&&s===c}isFailureEvent(e){switch(e.type){case X.SimulationFailed:case X.TransactionSubmissionFailed:case X.TransactionConfirmationFailed:return!0;default:return!1}}};function fP(t){switch(t.type){case Ee.SlippageExceeded:return B.SlippageExceeded;case Ee.InsufficientFunds:return B.InsufficientFunds;case Ee.InsufficientGas:return B.InsufficientGas;case Ee.AccountFrozen:return B.AccountFrozen;case Ee.StaleQuote:return B.StaleQuote;case Ee.SimulationTimeout:return B.SimulationTimeout;case Ee.UnknownError:return B.SimulationUnknownError;case Ee.SimulationFailed:return"SIMULATION_FAILED";default:return B.NotValidScanResultsError}}a(fP,"toSimulationErrorMessage");u();l();u();l();function Yc(t,e){let r=pe.optimisticUpdates(),n=t.getQueryData(r)??[];t.setQueryData(r,[...n.filter(s=>s.id!==e.id),e])}a(Yc,"pushOptimisticUpdate");function eu(t){return`${t.type}-${t.data.key}`}a(eu,"getOptimisticUpdateKey");var Ms=class{static{a(this,"ConfirmationExecuteSwapStateListener")}queryClient;storage;authRepository;constructor(e,r,n){this.queryClient=e,this.storage=r,this.authRepository=n}onStateChange(e,r,n,s){let{sell:o,quote:c,account:d}=n.executingQuote;if(e.type===X.TransactionConfirmed){this.storage.set(ke.PriorityFee,null),this.storage.set(ke.PriorityFeeSettings,{type:Bs.Auto}),this.queryClient.setQueryData(pe.priorityFee(),null),this.queryClient.setQueryData(pe.priorityFeeSettings(),{type:Bs.Auto}),this.storage.set(ke.TipAmount,null),this.storage.set(ke.TipSettings,{type:Ls.Auto}),this.queryClient.setQueryData(pe.tipAmount(),null),this.queryClient.setQueryData(pe.tipSettings(),{type:Ls.Auto});let m=new V(o.data.amount),p=new V(c.sellAmount),f=m.minus(p).toString();Yc(this.queryClient,{id:eu(o),amount:f}),this.queryClient.invalidateQueries({queryKey:th.tokens(d.addresses)}),this.queryClient.invalidateQueries({queryKey:hh.tokenBalance({wallets:d.addresses,encodedCaip19:D(Y(o))})})}}};u();l();u();l();var Un=class{static{a(this,"SimulationAnalytics")}#e;constructor(e){this.#e=e}onScannedMessageByUser=a(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"message",status:"success"}}})},"onScannedMessageByUser");onFailedScannedMessageByUser=a(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"message",status:"error"}}})},"onFailedScannedMessageByUser");onScannedTransactionByUser=a(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"success"}}})},"onScannedTransactionByUser");onFailedScannedTransactionByUser=a(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"error"}}})},"onFailedScannedTransactionByUser");onSkippedTransactionByUser=a(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"skipped"}}})},"onSkippedTransactionByUser")};var pS="swap-validation",qs=class{static{a(this,"SimulationAnalyticsExecuteSwapStateListener")}simulationAnalytics;constructor(e){this.simulationAnalytics=new Un(e)}onStateChange(e,r,n){switch(e.type){case X.SimulationPassed:let s=e.scannedTransactionResult;this.simulationAnalytics.onScannedTransactionByUser({networkId:e.networkId,warnings:s.warnings.map(c=>c.severity),shouldBlock:!!s.block,errorCode:s.error??""});break;case X.SimulationFailed:let o=e.error.scannedTransactionResult;if(o){this.simulationAnalytics.onScannedTransactionByUser({networkId:e.networkId,warnings:o.warnings.map(c=>c.severity),shouldBlock:!!o.block,errorCode:o.error??""}),o?.error&&E.addBreadcrumb(pS,`Simulation error: ${JSON.stringify({error:o.error})}`,F.Info);return}this.simulationAnalytics.onFailedScannedTransactionByUser({networkId:e.networkId,url:e.url}),E.addBreadcrumb("simulation",`networkID: ${e.networkId}, url: ${e.url}, type: transaction`,F.Info);break;case X.SimulationSkipped:this.simulationAnalytics.onSkippedTransactionByUser({networkId:e.networkId,skipReason:e.skipReason}),E.addBreadcrumb(pS,`Simulation skipped for networkID: ${e.networkId}, reason: ${e.skipReason}`,F.Info);break}}};u();l();u();l();u();l();var me;(function(t){t.Idle="idle",t.FetchingQuote="fetchingQuote",t.Quote="quote",t.SimulationRequestErrored="simulationRequestErrored",t.SimulationFailed="simulationFailed",t.Simulated="simulated",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionNotConfirmed="transactionNotConfirmed"})(me||(me={}));var hP=10,gP=ft(t=>({transitions:[],addTransition:a((e,r)=>t(n=>{let s=yP(r,e);return s?{transitions:[s,...n.transitions].slice(0,hP)}:n}),"addTransition")}));function ru(t,e){gP.getState().addTransition(t,e)}a(ru,"addSwapperTransition");function yP(t,e){switch(e.type){case me.Idle:return;case me.FetchingQuote:return;case me.Quote:return{sell:Sr(e.response,e.sell,"sell"),buy:Sr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:fi(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,timestamp:Date.now()};case me.SimulationRequestErrored:return{sell:Sr(e.response,e.sell,"sell"),buy:Sr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:fi(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,error:e.error,quoteTransactionData:tu(e.quote),timestamp:Date.now()};case me.Simulated:return;case me.SimulationFailed:return{sell:Sr(e.response,e.sell,"sell"),buy:Sr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:fi(e.quote),slippage:e.response.slippageTolerance,simulationError:e.simulationError,stateType:e.type,eventType:t.type,simulationWarning:e.scannedTransactionResult?.warnings,quoteTransactionData:tu(e.quote),simulationHumanReadableError:e.scannedTransactionResult?.simulationError?.humanReadableError,simulationRequestId:e.scannedTransactionResult?.advancedDetails?.requestId,timestamp:Date.now()};case me.TransactionSubmissionFailed:return{sell:Sr(e.response,e.sell,"sell"),buy:Sr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:fi(e.quote),slippage:e.response.slippageTolerance,error:e.error,stateType:e.type,eventType:t.type,quoteTransactionData:tu(e.quote),timestamp:Date.now()};case me.TransactionNotConfirmed:return{sell:Sr(e.response,e.sell,"sell"),buy:Sr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:fi(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,quoteTransactionData:tu(e.quote),timestamp:Date.now(),error:e.error};default:return}}a(yP,"toSparseTransition");var fi=a(t=>{let e=Le(t);return ve(e)},"parseProvider"),Sr=a((t,e,r)=>{switch(r){case"sell":return{caip19:t.sellToken,symbol:e.data.symbol??void 0};case"buy":return{caip19:t.buyToken,symbol:e.data.symbol??void 0}}},"parseTokens"),tu=a(t=>{if(!de(t))return t.transactionData},"parseQuoteTransactionData");u();l();var Ve;(function(t){t.QuoteRequestStarted="quoteRequestStarted",t.QuoteResponseReceived="quoteResponseReceived",t.QuoteSelected="quoteSelected",t.SimulationResponseReceived="simulationResponseReceived",t.SimulationRequestError="simulationRequestError",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionConfirmationFailed="transactionConfirmationFailed"})(Ve||(Ve={}));var zs=class{static{a(this,"TransitionsExecuteSwapStateListener")}onStateChange(e,r,n,s){let o=this.toLegacyTransition(e,n);o&&ru(o.nextState,o.event)}toLegacyTransition(e,r){let{buy:n,sell:s,quote:o,response:c}=r.executingQuote;switch(e.type){case X.SimulationFailed:return{event:{type:Ve.SimulationRequestError,error:e.error},nextState:{type:me.SimulationFailed,buy:n,sell:s,response:c,quote:o,scannedTransactionResult:e.error.scannedTransactionResult,simulationError:e.error.message}};case X.TransactionSubmissionFailed:return{event:{type:Ve.TransactionSubmissionFailed,error:e.error},nextState:{type:me.TransactionSubmissionFailed,buy:n,sell:s,response:c,quote:o,error:e.error}};case X.TransactionConfirmationFailed:return{event:{type:Ve.TransactionConfirmationFailed,error:e.error,txReceipt:e.txReceipt},nextState:{type:me.TransactionNotConfirmed,buy:n,sell:s,response:c,quote:o,error:e.error,txReceipt:e.txReceipt}};default:return}}};u();l();u();l();u();l();u();l();u();l();var mS=a(t=>{let e,r=new Set,n=a((f,g)=>{let w=typeof f=="function"?f(e):f;if(!Object.is(w,e)){let y=e;e=g??(typeof w!="object"||w===null)?w:Object.assign({},e,w),r.forEach(S=>S(e,y))}},"setState"),s=a(()=>e,"getState"),m={setState:n,getState:s,getInitialState:a(()=>p,"getInitialState"),subscribe:a(f=>(r.add(f),()=>r.delete(f)),"subscribe"),destroy:a(()=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()},"destroy")},p=e=t(n,s,m);return m},"createStoreImpl"),fS=a(t=>t?mS(t):mS,"createStore");var kS=U($(),1),CS=U(AS(),1);var{useDebugValue:BP}=kS.default,{useSyncExternalStoreWithSelector:LP}=CS.default,xS=!1,OP=a(t=>t,"identity");function UP(t,e=OP,r){(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&r&&!xS&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),xS=!0);let n=LP(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return BP(n),n}a(UP,"useStore");var IS=a(t=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let e=typeof t=="function"?fS(t):t,r=a((n,s)=>UP(e,n,s),"useBoundStore");return Object.assign(r,e),r},"createImpl"),MP=a(t=>t?IS(t):IS,"create"),_S=a(t=>((import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`."),MP(t)),"react");u();l();var gn;(function(t){t.Failed="Failed",t.Progress="Progress",t.Success="Success",t.Default="Default"})(gn||(gn={}));var qP=3e3,Ze=_S(t=>({toast:void 0,toastId:void 0,visible:!1,currentTimer:null,hideToast(e){t(r=>e&&r.toastId!==e?r:(r.currentTimer&&clearTimeout(r.currentTimer),{visible:!1,currentTimer:null}))},removeToast(){t(e=>(e.currentTimer&&clearTimeout(e.currentTimer),{toast:void 0,toastId:void 0,visible:!1,currentTimer:null}))},success(e){t(r=>{r.currentTimer&&clearTimeout(r.currentTimer);let n=setTimeout(()=>{t({visible:!1,currentTimer:null})},qP);return{toast:{type:gn.Success,...e},toastId:e.id??be(),visible:!0,currentTimer:n}})},failed(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:gn.Failed,...e},toastId:e.id??be(),visible:!0,currentTimer:null}))},progress(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:gn.Progress,...e},toastId:e.id??be(),visible:!0,currentTimer:null}))},message(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:gn.Default,...e},toastId:e.id??be(),visible:!0,currentTimer:null}))}}));u();l();var Mn=a(t=>{let e=Vc(t);return Rs(e)},"getEstimatedTime");u();l();function FS(t,e,r,n){let s=Ne(t),o=s?t:e,c=s?e:t,d=s?r.sellAmount:r.buyAmount,m=Re(d,o.data.decimals),p=kf(m,!0),f=c.data.symbol,g="";return n?g=s?"swapTokenConfirmationBuyToast":"swapTokenConfirmationSellToast":g=s?"swapSwappingCashBuyToast":"swapSwappingCashSellToast",L.t(g,{amount:p,symbol:f})}a(FS,"cashSwapToastMessage");u();l();u();l();function PS({sell:t,buy:e,onBuyFungiblePress:r}){let n=`${L.t("swapTxConfirmationSwapFailed")} ${t.data.symbol} \u2192 ${e.data.symbol}`,s=A.getChainDefinition(t.data.chain.id).tokenSymbol,o=L.t("buyAssetInterpolated",{tokenSymbol:s});return{title:n,message:L.t("swapTabInsufficientFunds"),onPress:r,buttonText:o}}a(PS,"getInsufficientFundsToastProps");function vS(t,e,r,n,s,o){let{sell:c,buy:d}=e,m=zP(t,c,d,s,n,r,o);return m||{title:`${L.t("swapTxConfirmationSwapFailed")} ${c.data.symbol} \u2192 ${d.data.symbol}`,message:lp(t),onPress:a(()=>{Ze.getState().hideToast(),n()},"onPress"),buttonText:L.t("commandRetry")}}a(vS,"createSimulationErrorToast");function zP(t,e,r,n,s,o,c){if(!(t.type&&!c.includes(t.type)))switch(t.type){case Ee.InsufficientFunds:return PS({sell:e,buy:r,onBuyFungiblePress:a(()=>{Ze.getState().hideToast(),o()},"onBuyFungiblePress")});case Ee.SlippageExceeded:return n.selectedSetting.type===fe.Auto?void 0:{title:L.t("swapEnableAutoSlippageTitleToast",{sellSymbol:e.data.symbol,buySymbol:r.data.symbol}),buttonText:L.t("swapEnableAutoSlippageButtonToast"),message:"",onPress:a(()=>{n.setSlippageSetting({type:fe.Auto}),s(),Ze.getState().hideToast()},"onPress")}}}a(zP,"createCustomSimulationErrorToast");u();l();u();l();var QP=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],HP="Ledger user rejected action",GP="Ledger Sign Error";function RS(t){return QP.some(r=>t.message.includes(r))?L.t("swapTxConfirmationSwapFailedLedgerConnectionError"):t.message.includes(HP)?L.t("swapTxConfirmationSwapFailedLedgerReject"):t.message.includes(GP)?L.t("swapTxConfirmationSwapFailedLedgerSignError"):t.message.toLowerCase().includes("ledger")?L.t("swapTxConfirmationSwapFailedLedgerError"):null}a(RS,"parseLedgerError");function DS({sellSymbol:t,buySymbol:e,error:r,onPress:n}){let s=L.t("unknownToken"),o=`${L.t("swapTxConfirmationSwapFailed")} ${t??s} \u2192 ${e??s}`,c=L.t("commandRetry"),d=L.t("swapTxConfirmationSwapFailedUnknownError"),m=RS(r);return m&&(d=m),{title:o,message:d,onPress:n,buttonText:c}}a(DS,"createSwapFailedToast");var Hs=class{static{a(this,"ToastExecuteSwapStateListener")}showFungibleDetails;showBuyFungibleScreen;slippageSettings;supportedCustomSimulationToastErrorTypes;retryAndNavigateToSwapper;toastMessageParser;constructor(e,r,n,s,o,c=$P){this.showFungibleDetails=e,this.showBuyFungibleScreen=r,this.slippageSettings=n,this.supportedCustomSimulationToastErrorTypes=s,this.retryAndNavigateToSwapper=o,this.toastMessageParser=c}onStateChange(e,r,n,s){let{sell:o,buy:c,quote:d}=n.executingQuote;switch(e.type){case X.ExecuteSwapStarted:let m;if(de(d)){if(A.isBitcoinNetworkID(o.data.chain.id)){NS(L.t("swapBitcoinSellBridgeProgressToast",{estimatedTime:Mn(d)}),()=>{this.showFungibleDetails(c)});return}A.isBitcoinNetworkID(c.data.chain.id)?m=L.t("swapBitcoinBuyingToast"):m=L.t("swapInitiatingBridgeToast",{sellSymbol:o.data.symbol,sellChain:o.data.chain.name,buySymbol:c.data.symbol,buyChain:c.data.chain.name})}else Ne(o)||Ne(c)?m=FS(o,c,d,!1):m=L.t("swapSwappingToast",{sellSymbol:o.data.symbol,buySymbol:c.data.symbol});VP(m);break;case X.TransactionConfirmed:NS(this.toastMessageParser.parseTransactionConfirmed(o,c,d),()=>this.showFungibleDetails(c));break;case X.SimulationFailed:BS(vS(e.error,n.executingQuote,this.showBuyFungibleScreen,()=>this.handleRetryPress(n.executingQuote),this.slippageSettings,this.supportedCustomSimulationToastErrorTypes));break;case X.TransactionSubmissionFailed:case X.TransactionConfirmationFailed:BS(DS({sellSymbol:o.data.symbol,buySymbol:c.data.symbol,error:e.error,onPress:a(()=>this.handleRetryPress(n.executingQuote),"onPress")}));break}}handleRetryPress(e){Ze.getState().hideToast(),this.retryAndNavigateToSwapper(e)}};function VP(t){Ze.getState().progress({message:t,onPress:a(()=>{Ze.getState().hideToast()},"onPress")})}a(VP,"progress");function NS(t,e){Ze.getState().success({id:"swap-success",message:t,onPress:a(()=>{Ze.getState().hideToast(),e()},"onPress")})}a(NS,"success");function BS(t){Ze.getState().failed(t)}a(BS,"failed");var $P={parseTransactionConfirmed(t,e,r){return de(r)?A.isBitcoinNetworkID(t.data.chain.id)?L.t("swapBitcoinSellBridgeProgressToast",{estimatedTime:Mn(r)}):A.isBitcoinNetworkID(e.data.chain.id)?L.t("swapBitcoinBuyBridgeProgressToast",{estimatedTime:Mn(r)}):L.t("swapBridgeInitiatedToast",{sellSymbol:t.data.symbol,sellChain:t.data.chain.name,buySymbol:e.data.symbol,buyChain:e.data.chain.name,estimatedTime:Mn(r)}):L.t("swapSwappedToast",{sellSymbol:t.data.symbol,buySymbol:e.data.symbol})}};var su=class{static{a(this,"ToastsSwapReviewInterceptor")}intercept(e){let{swapper:r,connection:n,storage:s,vaultProxy:o,locale:c,analytics:d,resetSwapper:m,queryClient:p,showFungibleDetails:f,showBuyFungibleScreen:g,swapAnalytics:w,gasEstimation:y,slippageSettings:S,supportedCustomSimulationToastErrorTypes:x,navigateToSwapper:T,storePairs:_,isMobile:k,enableExtSwapCommands:P,authRepository:v,isSimulationKilled:z}=e;if(r.getAccount()?.type===af.Ledger||!k&&!P)return"continue";let R=r.getState();if(R.type!==Me.Quote)return"continue";let{quote:G,sell:M,buy:C}=R;return this.isSupportedQuote(G)&&(async()=>{_(M,C);let N=await d.getDeviceId(),Z=new Hs(f,g,S,x,St=>{T(St)}),oe=new Ms(p,s,v),re=new Us(w,d),J=new qs(d),Ge=new zs,xe=new Os(mn);try{r.subscribeExecution(oe),r.subscribeExecution(J),r.subscribeExecution(re),r.subscribeExecution(Z),r.subscribeExecution(Ge),r.subscribeExecution(xe),await r.swap({signer:o,storage:s,locale:c,deviceId:N,connection:n,authRepository:v,isSimulationKilled:z,gasEstimation:y}),m()}catch{}finally{r.unsubscribeExecution(oe),r.unsubscribeExecution(J),r.unsubscribeExecution(re),r.unsubscribeExecution(Z),r.unsubscribeExecution(Ge),r.unsubscribeExecution(xe)}})(),"continue"}isSupportedQuote(e){return Qt(e)||rr(e)||_r(e)||de(e)}};u();l();var ou=class{static{a(this,"StreamGetSwapQuotesStrategy")}swapper;queryClient;constructor(e,r){this.swapper=e,this.queryClient=r}queryKey;quoteProcessorListener={onStateChange:a((e,r)=>{if(!this.queryKey){console.error("queryKey is not set");return}r.type==="quoteProcessed"&&this.queryClient.setQueryData(this.queryKey,r.response)},"onStateChange")};async fetch(e,r){return this.queryKey=r,this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener),new Promise((n,s)=>{let o=jP(e.amount,e.sell,e.buy),c={onStateChange:a((d,m)=>{switch(m.type){case"firstQuoteReceived":n(m.response),this.swapper.unsubscribeQuoteProcessor(c);break;case"error":s(m.error),this.swapper.unsubscribeQuoteProcessor(c),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener);break}},"onStateChange")};this.swapper.subscribeQuoteProcessor(this.quoteProcessorListener),this.swapper.subscribeQuoteProcessor(c),this.swapper.setPair(LS(e.buy),LS(e.sell),o),this.swapper.setAmount(o,{slippageTolerance:e.slippageTolerance,slippageType:e.enableAutoSlippage?fe.Auto:fe.Fixed,priorityFee:e.priorityFee,tipAmount:e.tipAmount,preferredProvider:e.preferredProvider})})}stopFetching(){this.swapper.getQuoteProcessorState().type!=="idle"&&(this.swapper.stopProcessingQuotes(),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener))}getFetchInterval(e){return!1}};function jP(t,e,r){let n=t.type==="sell"?e:r;return{amount:new b(t.value).shiftedBy(-n.data.decimals).toString(),perspective:t.type}}a(jP,"normalizeAmount");function LS(t){return{...t,data:{...t.data,walletAddress:""}}}a(LS,"removeWalletAddress");u();l();u();l();var iu;(function(t){t.AutoSlippageOptIn="autoSlippageOptIn"})(iu||(iu={}));var au=class{static{a(this,"AutoSlippageOptInInterceptor")}intercept({hasViewedAutoSlippageOptIn:e,selectedSetting:r,setHasViewedAutoSlippageOptIn:n,showOverlay:s}){return!e&&r!==fe.Auto?(s(iu.AutoSlippageOptIn),n(!0),"interrupt"):"continue"}};u();l();var Ap=U($());u();l();var US=U($());u();l();var KP=i.object({swapper:i.number(),review:i.number().nullish().default(null)}),cu={swapper:ps.Short,review:null},OS=a(()=>{let t=er.getMultivariateAssignment("swapper-poll-interval-json");if(!t)return cu;try{let e=JSON.parse(t);return KP.parse(e)}catch{return cu}},"getQuotePollIntervalConfig");var qn=a(()=>{let t=hi(s=>s.intervalMs),e=hi(s=>s.state),r=hi(s=>s.setState),n=(0,US.useCallback)(s=>{r("resumed",s??MS())},[r]);return{state:e,pause:a(()=>r("paused"),"pause"),resume:n,intervalMs:t}},"useQuotePoller"),Tp=a(t=>{hi.getState().setState("resumed",t??MS())},"resumePoller"),Ep=a(()=>{hi.getState().setState("paused")},"pausePoller"),MS=a(()=>OS().swapper,"getDefaultInterval"),hi=ft(t=>({state:"resumed",intervalMs:cu.swapper,setState(e,r){t(r?{state:e,intervalMs:r}:{state:e})}}));var qS=a(()=>{let t=(0,Ap.useCallback)(()=>{Tp()},[]),e=(0,Ap.useCallback)(()=>{Ep()},[]);return{onSwapTabEnter:t,onSwapTabExit:e}},"useSwapTabSwitchActions");var QS=(0,Or.createContext)(void 0),WP=a(({children:t})=>{let e=[fe.Auto,fe.Fixed],r=[Ee.SlippageExceeded],n=(0,Or.useMemo)(()=>[new au,new su],[]),s=!0,o=Nt(),c=Pe(),d=(0,Or.useMemo)(()=>go?new ou(o,c):new jc,[o,c]),{onSwapTabEnter:m,onSwapTabExit:p}=qS(),f=Qi("trade-hub-variant"),g=At("enable-replace-classic-ngs"),w=(0,Or.useMemo)(()=>{if(g||f==="remove-buy-sell")return"remove-buy-sell";if(f==="swapper-modal")return"swapper-modal";if(f==="trade-menu")return"trade-menu"},[f,g]),y=(0,Or.useMemo)(()=>pt?fp("full"):fp("compactNoSymbol"),[]);return(0,zS.jsx)(QS.Provider,{value:{slippageSettingTypes:e,reviewInterceptors:n,showStickyCTAButton:s,getSwapQuotesStrategy:d,supportedCustomSimulationToastErrorTypes:r,onSwapTabEnter:m,onSwapTabExit:p,balanceDisplayStrategy:y,tradeHubVariant:w},children:t})},"SwapTabProvider"),ZP=a(()=>{let t=(0,Or.useContext)(QS);if(!t)throw new Error("useSwapTab must be used within a SwapTabProvider");return t},"useSwapTab");u();l();var zn=U($());u();l();u();l();var XP=i.enum(["pumpFun","moonshot"]),JP=i.object({type:XP,programId:i.string(),name:i.string(),iconUrl:i.string()}),YP=i.object({programs:i.array(JP)}),HS=a(t=>{try{return YP.parse(t)}catch{return}},"parseUgcPrograms");var ev={type:"pumpFun",programId:"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P",name:"Pump.fun",iconUrl:"https://dhc7eusqrdwa0.cloudfront.net/assets/pumpfun.svg"},xp=[],Ur=a(()=>{try{let t=er.getMultivariateAssignment("enabled-ugc-programs");if(!t)return er.isFeatureEnabled("enabled-ugc-programs")?[ev]:xp;let e=JSON.parse(t);return HS(e)?.programs??xp}catch{return xp}},"getSupportedUgcPrograms");var tv=i.object({programId:i.string(),complete:i.boolean(),progress:i.string()}),rv=i.object({bondingCurves:i.record(i.string(),tv)}),Zt;(function(t){t.Loading="Loading",t.BondingCurve="BondingCurve",t.BondingCurveRefreshing="BondingCurveRefreshing",t.NoBondingCurve="NoBondingCurve",t.Graduated="Graduated",t.Error="Error"})(Zt||(Zt={}));function nv(t){let e=GS(t),n=Pe().getQueryData(e.queryKey),{data:s,isFetching:o,isError:c}=ne({...e,initialData:n,staleTime:0}),d=(0,zn.useMemo)(()=>Ur(),[]);return(0,zn.useMemo)(()=>{let m=n===s;if(o&&!m)return{type:Zt.Loading};if(c)return{type:Zt.Error};let p=rv.safeParse(s);if(!p.success)return{type:Zt.Error};let f=p.data.bondingCurves[t];if(!f)return{type:Zt.NoBondingCurve};let g=d.find(y=>y.programId===f.programId);if(!g)return{type:Zt.NoBondingCurve};let w=iv(f.progress);return w?f.complete?{type:Zt.Graduated,ugcProgram:g}:{type:m&&o?Zt.BondingCurveRefreshing:Zt.BondingCurve,progressPercentage:w,ugcProgram:g}:{type:Zt.Error}},[n,t,s,c,o,d])}a(nv,"useBondingCurveProgress");var sv=a(t=>{let e=Pe(),r=GS(t);return(0,zn.useCallback)(async()=>{await e.refetchQueries({queryKey:r.queryKey,type:"active"})},[e,r.queryKey])},"useUgcEnabledAwareBondingCurveRefetch"),GS=a(t=>{let e=(0,zn.useMemo)(()=>Ur(),[]),r=(0,zn.useMemo)(()=>e.map(s=>s.programId),[e]);return{queryKey:["bonding-curve",t,r],queryFn:a(async()=>ov(t,r),"queryFn")}},"useQueryOptions"),ov=a(async(t,e)=>{let r=encodeURIComponent(t),n=encodeURIComponent(e.join(","));return(await H.api().get(`/ugc/v1/bonding-curve/${r}/${n}`)).data},"queryFn"),iv=a(t=>{let e=Number(t);if(!isNaN(e))return Math.round(e*100)},"parseProgressPercentage");u();l();var av="https://help.phantom.com/hc/en-us/articles/33745013398675";u();l();u();l();var $S=U($());u();l();var Ip=U($());u();l();var cv=i.object({blocked:i.array(i.nativeEnum(we))}),VS=a(()=>{let t=Qi("blocked-swapper-chains"),e=cv.safeParse(t);return e.success?e.data.blocked:[]},"useBlockedSwapperChains");u();l();function yn(){return Dr.supportedChains.filter(t=>{let e=Dr.get(t);return e.requiredFeatureFlag?zi(e.requiredFeatureFlag):!0})}a(yn,"useSwapperChains");var gi=a(()=>{let{data:t}=Fe(),e=yn(),r=VS(),n=(0,Ip.useMemo)(()=>e.filter(s=>!r.includes(s)).map(s=>A.getMainnetNetworkID(s)),[e,r]);return(0,Ip.useMemo)(()=>uv(t,n),[t,n])},"useSupportedNetworkIDs"),uv=a((t,e)=>[...new Set((t?.addresses??[]).map(r=>r.networkID).filter(r=>e.includes(r)))],"getSupportedNetworkIDs");var kp=a(()=>{let t=gi(),e=At("enable-bitcoin-swap");return(0,$S.useCallback)(r=>!e&&r&&A.isBitcoinNetworkID(r)?!1:!!r&&t.includes(r),[t,e])},"useIsSupportedNetworkId");u();l();var du=U($());u();l();u();l();var uu=class{static{a(this,"SwapperTransitionsStateListener")}onStateChange(e,r,n){ru(n,e)}};u();l();var lu=class{static{a(this,"SwapperStateMachine")}listeners;constructor(e){this.listeners=e}transition(e,r){try{let n=this.detectNextState(e,r);return this.listeners.forEach(s=>s.onStateChange(r,e,n)),n}catch{return e}}detectNextState(e,r){switch(r.type){case Ve.QuoteRequestStarted:return{type:me.FetchingQuote,buy:r.buy,sell:r.sell,amount:r.amount};case Ve.QuoteResponseReceived:switch(e.type){case me.FetchingQuote:case me.Quote:case me.Simulated:case me.SimulationRequestErrored:case me.TransactionSubmissionFailed:case me.TransactionNotConfirmed:let n=r.response.quotes[r.quoteIndex];if(!n)throw new Error("Quote index out of bounds");return{type:me.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:n};default:throw new Error("Can't transition from this state")}case Ve.QuoteSelected:switch(e.type){case me.Quote:let n=e.response.quotes[r.quoteIndex];if(!n)throw new Error("Quote index out of bounds");return{type:me.Quote,quote:n,buy:e.buy,sell:e.sell,response:e.response};default:throw new Error("Can only transition to QuoteChanged from Quote")}case Ve.SimulationResponseReceived:switch(e.type){case me.Quote:return r.scannedTransactionResult.error?{type:me.SimulationFailed,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:r.scannedTransactionResult,simulationError:r.scannedTransactionResult.error}:{type:me.Simulated,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:r.scannedTransactionResult};default:throw new Error("Can only transition to Simulated from Simulating")}case Ve.SimulationRequestError:switch(e.type){case me.Quote:return{type:me.SimulationRequestErrored,buy:e.buy,sell:e.sell,quote:e.quote,response:e.response,error:r.error};default:throw new Error("Can only transition to SimulationRequestErrored from Simulating")}case Ve.TransactionSubmissionFailed:switch(e.type){case me.Simulated:case me.SimulationFailed:return{type:me.TransactionSubmissionFailed,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:e.scannedTransactionResult,error:r.error};default:throw new Error("Can only transition to SwapSubmitFailed from SubmittingSwap")}case Ve.TransactionConfirmationFailed:switch(e.type){case me.Simulated:return{type:me.TransactionNotConfirmed,quote:e.quote,buy:e.buy,sell:e.sell,txReceipt:r.txReceipt,response:e.response,scannedTransactionResult:e.scannedTransactionResult,error:r.error};default:throw new Error("Can only transition to TransactionNotConfirmed from ConfirmingTransaction")}}}};var lv=new lu(new Set([new uu])),jS=ft(t=>({state:{type:me.Idle},transition:a(e=>{t(r=>{let n=r.state;return{state:lv.transition(n,e)}})},"transition")}));var Gs=a(()=>{let t=jS(r=>r.state),e=jS(r=>r.transition);return{state:t,transition:e}},"useSwapperState");u();l();var dv=5*60,KS=a(t=>{if(de(t))return ve(hs(t));let{sources:e}=t;return ve(e)},"getProviderLabel"),WS=a(({quotes:t,buyTokenNetworkId:e,buyTokenDecimals:r,buyTokenSymbol:n})=>t.map(s=>{let{buyAmount:o}=s,c=To.get(e).formDisplayPrecision;return{name:KS(s),amount:`${Eo(Re(o,r),c)} ${n}`}}),"parseSwapProviders"),ZS=a(({quotes:t,buyTokenNetworkId:e,buyTokenDecimals:r,buyTokenSymbol:n,networkIDForFees:s,networkFee:o,priceMap:c})=>t.filter(de).map(d=>{let{buyAmount:m,executionDuration:p,steps:f}=d,w=Gc(d).plus(o),y=f.find(x=>!!x.tool.logoURI),S=To.get(e).formDisplayPrecision;return{name:KS(d),feeUsd:s&&c?vt(s,w,c):null,amount:`${Eo(Re(m,r),S)} ${n}`,time:{text:Rs(p),isFast:p<=dv},logoURI:y?.tool.logoURI??""}}),"parseBridgeProviders");u();l();var pv={aggregate(t){return t.reduce((e,r)=>({...e,gasLimit:e.gasLimit.plus(r.gasLimit)}),{networkID:A.ethereum.mainnetID,gasLimit:new V(0),maxFeePerGas:t[0].maxFeePerGas,maxPriorityFeePerGas:t[0].maxPriorityFeePerGas})}},mv={aggregate(t){return t.reduce((e,r)=>({...e,value:e.value+r.value}),{networkID:A.solana.mainnetID,value:0})}},fv={aggregate(t){return t.reduce((e,r)=>({...e,gasBudget:e.gasBudget.plus(r.gasBudget)}),{networkID:A.sui.mainnetID,gasBudget:new V(0)})}},yi=a(t=>{if(!(!t||t.length===0)){if(Xi(t[0]))return pv.aggregate(t);if(Lf(t[0]))return mv.aggregate(t);if(Of(t[0]))return fv.aggregate(t)}},"aggregateGasEstimation");function hv({selectQuote:t}){let{quoteResponse:e,isFetchingQuote:r,quotes:n,selectedProviderIndex:s}=Ie(),o=j(P=>P.setSelectedProviderIndex),c=j(P=>P.gasEstimation.estimateWithBuffer),d=j(P=>P.sellFungible),m=j(P=>P.buyFungible),p=d?.data.chain.id,{data:f}=Ao(p,yi(c)),w=yn().map(P=>zt(P)),{data:y={}}=en({query:{data:w}}),S=e?.type==="xchain",x=(0,du.useMemo)(()=>m?S?ZS({quotes:n,buyTokenNetworkId:m.data.chain.id,buyTokenDecimals:m.data.decimals,buyTokenSymbol:m.data.symbol,networkIDForFees:p,networkFee:f?.gasEstimationAmount??new V(0),priceMap:y}):WS({quotes:n,buyTokenNetworkId:m.data.chain.id,buyTokenDecimals:m.data.decimals,buyTokenSymbol:m.data.symbol}):[],[m,S,n,p,f?.gasEstimationAmount,y]),T=Se(),{transition:_}=Gs(),k=(0,du.useCallback)(P=>{let v=x[P];T.capture("swapperProviderSelected",{data:{provider:v.name}}),o(P),t(n,P),_({type:Ve.QuoteSelected,quoteIndex:P})},[o,x,T,_,n,t]);return{rows:x,selectedProviderIndex:s,isLoadingProviders:r,setSelectedProviderIndex:k}}a(hv,"useSwapProvidersProps");u();l();var fu=U($());u();l();var JS=U($());u();l();var XS=U($());var pu=a(()=>{let t=Pe();return{cancelQuotes:(0,XS.useCallback)(async()=>{await t.cancelQueries({queryKey:pe.quotesScope()}),await ff(1)},[t])}},"useSwapCancelQuotes");u();l();function Qn(t,e){return t.data.key===e.data.key}a(Qn,"areFungiblesEqual");function Cp(){let t=Se(),e=j(s=>s.setBuyFungible),r=j(s=>s.buyFungible),{cancelQuotes:n}=pu();return(0,JS.useCallback)(async s=>{if(r&&Qn(s,r))return;await n();let o=Lr(s);t.capture("swapperUpdateToAsset",{data:o}),e(s)},[t,r,n,e])}a(Cp,"useSwapSetBuyAsset");u();l();var gv=a((t,e)=>{mu.getState().setAsset(t,e)},"setUgcSelectedAsset"),mu=ft(t=>({asset:void 0,onConfirm:void 0,setAsset(e,r){t({asset:e,onConfirm:r})}}));var yv=a(({onClose:t})=>{let e=Nt(),r=Cp(),n=mu(d=>d.asset),s=mu(d=>d.onConfirm),o=(0,fu.useMemo)(()=>Ur().find(m=>m.programId===n?.data?.ugcTokenMeta?.programId),[n]),c=(0,fu.useCallback)(async()=>{n&&(e.changeToken(n,"buy"),await r(n),s?.(),t())},[r,e,n,s,t]);return{asset:n,program:o,handleConfirmPress:c}},"useUGCTradeWarningProps");u();l();var tb=U($());u();l();var wv="swap",Sv=a(t=>new Ff(t,wv),"createSwapAnalytics"),Vs=Hi(Se,t=>Sv(t));u();l();function $s(t,e,r){if(!r)return;if(e===fe.Fixed)return r.slippageTolerance;let n=r.quotes[t];if(n)return de(n)?r.slippageTolerance:lr(n)?n.slippageTolerance:r.slippageTolerance}a($s,"parseSlippage");u();l();var hu=U($());var eb=a(()=>{let{data:t,isFetching:e}=gt({key:ke.LastSubmittedPairs,queryKey:pe.lastSubmittedPairs()}),r=(0,hu.useMemo)(()=>t??null,[t]),{mutateAsync:n}=yt({key:ke.LastSubmittedPairs,queryKey:pe.lastSubmittedPairs()}),s=(0,hu.useCallback)(async(o,c)=>{await n({sellFungible:YS(o),buyFungible:YS(c)})},[n]);return{pairs:r,isLoading:e,storePairs:s}},"useLastSubmittedPairs");function YS(t){return{...t,data:{...t.data,walletAddress:""}}}a(YS,"removeWalletAddress");var bv=a(({goToConfirmation:t})=>{let e=j(x=>x.sellUsdValue),r=j(x=>x.buyUsdValue),{currentQuote:n,quoteResponse:s,selectedProviderIndex:o,selectedBaseProvider:c}=Ie(),d=j(x=>x.sellFungible),m=j(x=>x.buyFungible),p=j(x=>x.swapFilter),{selectedSetting:f}=Gt(),{storePairs:g}=eb(),w=Se(),y=Vs(),{pause:S}=qn();return(0,tb.useCallback)(()=>{if(!n||!d||!m)return;let x=$s(o,f.type,s);w.capture("swapperSwap");let T=Wc({buyToken:m,sellToken:d,sellAssetUsdValue:e,buyAssetUsdValue:r,quote:n,slippageTolerance:x,slippageType:f.type,sellSwapFilter:p,baseProvider:c});T&&(E.addBreadcrumb(I.Swapper,"approved",F.Info,Jn(T.swap)),y.approved(T)),S(),t(),A.compareNetworkID(d.data.chain.id,m.data.chain.id)===0&&g(d,m)},[n,d,m,o,f.type,s,w,e,r,S,t,y,g,p,c])},"useOnSwap");u();l();u();l();var _p=a(()=>{let t=Pe(),e=j();return{clearQuotes:a(async()=>{e.resetQuote(),await t.invalidateQueries({queryKey:pe.quotesScope()})},"clearQuotes")}},"useSwapClearQuotes");u();l();var rb=a(({accountIdentifier:t,networkID:e})=>{let r=Ke(),n=jr();return Vr({mutationFn:a(async o=>{let{swapTransactions:c,type:d}=o;if(c.type==="evm"&&d===ie.EVM){let{gasEstimation:m,pendingApprovalActivityRows:p,pendingSwapActivityRows:f}=o,{signature:g,error:w}=await E.startSpan("Process EVM Swap Txns",()=>Ha({transactions:c.transactions,transactionTypes:c.transactionTypes,networkID:e,gasEstimation:m,pendingSwapActivityRows:f,pendingApprovalActivityRows:p,accountIdentifier:t,accountSigner:n,storage:r}));return{networkID:e,chainType:d,id:g,error:w}}else if(c.type==="solana"&&d===ie.Solana){let{callerAddress:m,connection:p,pendingSwapActivityRows:f}=o;if(!p)throw new Error("missing connection");let{signature:g,error:w}=await E.startSpan("Process Solana Swap Txns",()=>Va({callerAddress:m,connection:p,networkID:e,transactions:c.transactions,pendingSwapActivityRows:f,accountIdentifier:t,accountSigner:n,storage:r}));return{networkID:e,chainType:d,id:g,error:w}}else if(c.type==="sui"&&d===ie.Sui){let{callerAddress:m,pendingSwapActivityRows:p}=o,{signature:f,error:g}=await E.startSpan("Process Sui Swap Txns",()=>Wa({callerAddress:m,networkID:e,transactions:c.transactions,pendingSwapActivityRows:p,accountIdentifier:t,accountSigner:n,storage:r}));return{networkID:e,chainType:d,id:f,error:g}}throw new Error("unsupported")},"mutationFn")})},"useSwapFungibles");u();l();u();l();u();l();u();l();u();l();var wi;(function(t){t.Fungible="fungible"})(wi||(wi={}));var Tv=i.object({type:i.literal(wi.Fungible),data:Yf}),nb=i.object({results:i.array(i.any()).transform(t=>t.reduce((e,r)=>{let n=Tv.safeParse(r);return n.success&&e.push(n.data),e},[])),prevCursor:i.string().nullish().default(null),nextCursor:i.string().nullish().default(null),hasMore:i.boolean()});async function sb(t){let{query:e,networkIds:r,searchContext:n,supportedNetworkIds:s,pageSize:o=50,cursor:c}=t,d=await H.api().noBearer().headers({"Content-Type":"application/json"}).get("/search/v1",{params:{query:e.trim(),chainIds:r.join(","),platform:bt,pageSize:o.toString(),searchTypes:wi.Fungible,searchContext:n,...c&&{cursor:c},...s&&{supportedNetworkIds:s.join(",")}}});if(!ee(d))throw new We({key:"UnknownError"});let m=nb.safeParse(d.data);if(m.success)return m.data;throw new We({key:"UnknownError"})}a(sb,"getFungibleSearch");u();l();var ob=a(t=>{let e=t.data,r=Ml(e)??void 0;return{type:e.type,data:{...e.data,tokenAddress:Ml(e)??void 0,key:r}}},"searchResultToFungible");u();l();var Ev="search",ib={searchResults:a((t,e,r,n,s)=>[Ev,{query:t,networkIds:e,supportedNetworkIds:n,chainAddresses:r,cursor:s}],"searchResults")};u();l();var gu;(function(t){t[t.Always=1/0]="Always",t[t.Short=K({minutes:5})]="Short",t[t.Medium=K({minutes:30})]="Medium",t[t.Long=K({hours:1})]="Long",t[t.Never=0]="Never"})(gu||(gu={}));var yu;(function(t){t[t.Immediate=0]="Immediate",t[t.Short=K({minutes:5})]="Short",t[t.Medium=K({minutes:30})]="Medium",t[t.Long=K({hours:1})]="Long"})(yu||(yu={}));var Av=a(async t=>(await sb(t)).results.map(r=>ob(r)),"queryFn"),Si=a(({query:t,networkIds:e,enableQuery:r=!0,keepPreviousData:n=!1,searchContext:s,supportedNetworkIds:o,chainAddresses:c,pageSize:d})=>{let m=ib.searchResults(t,e,c,o);return ne({queryKey:m,gcTime:gu.Short,staleTime:yu.Short,enabled:r,placeholderData:n?tf:void 0,queryFn:a(async()=>Av({query:t,networkIds:e,searchContext:s,supportedNetworkIds:o,pageSize:d}),"queryFn")})},"useFungibleSearch");var Bt=U($());u();l();var Fp=a(t=>{let{spamStatus:e}=t.data;return e===ce.Spam||e===ce.PossibleSpam},"isSpamFungible"),xv=50,ab=a(({includeOwnedAssets:t,sellAsset:e,sellCaip19:r,ownedAssets:n,searchAssets:s})=>{if(!t||!e)return s.filter(w=>!Fp(w));let o=a(w=>D(Y(w)),"getEncodedCaip19"),c=o(e)??r,d=e.data.chain.id??(r&&je(r).chainId),m=n.filter(w=>!Fp(w)&&o(w)!==c&&A.compareNetworkID(d,w.data.chain.id)===0&&w.type!==ae.CompressedSPL).slice(0,xv-1),p=m.map(w=>[o(w),w]),f=new Map(p),g=s.filter(w=>!Fp(w)&&!f.has(o(w)));return[...m,...g]},"getDisplayedBuyAssets");function Iv({enableQuery:t=!0,chainFilter:e,sellCaip19:r}={}){let n=(0,Bt.useMemo)(()=>r?je(r):void 0,[r]),{sellFungible:s,searchQuery:o,setSearchQuery:c,setNumSearchResults:d}=j(),m=uf(o,150),{fungibles:p,isLoadingTokens:f,isRefetchingTokens:g,tokensError:w}=is(),y=gi(),[S,x]=(0,Bt.useState)(""),{data:T}=Fe(),_=(0,Bt.useMemo)(()=>T?.addresses??[],[T]),{data:k,isSuccess:P,isFetching:v,error:z}=Si({query:m,networkIds:e?[e]:[n?.chainId??s?.data.chain.id??A.solana.mainnetID],enableQuery:t,keepPreviousData:!0,searchContext:"swapper",supportedNetworkIds:y,chainAddresses:_}),Q=!P&&v,R=(0,Bt.useMemo)(()=>p.filter(oe=>oe.type!==ae.CompressedSPL).map(oe=>[D(Y(oe)),oe]),[p]),G=(0,Bt.useMemo)(()=>{let oe=Qm(R.map(([J])=>J).join("~")),re=sf(oe);return zm(re)},[R]),M=(0,Bt.useMemo)(()=>new Map(R),[G]),C=(0,Bt.useMemo)(()=>{if(!k||k.length===0)return[];x(be());let oe=k.reduce((re,J)=>{let Ge="";if(Pt(J.type)){if(s&&Pt(s.type)&&J.data.chain.id===s.data.chain.id||n&&n.chainId===J.data.chain.id&&n.resourceType===W.nativeToken)return re;Ge=D(zt(A.getChainID(J.data.chain.id)))}else{if(s&&J.data.tokenAddress===s.data.tokenAddress&&!e||n&&n.chainId===J.data.chain.id&&n.resourceType===W.address&&n.address===J.data.tokenAddress)return re;Ge=D(Y(J))}let xe,St=M.get(Ge);return St&&St.data.balance?xe=St:xe=J,xe&&re.push(xe),re},[]);return d(oe.length),oe},[M,k,s,d,e,n]),N=Se();(0,Bt.useEffect)(()=>{P&&C.length===0&&N.capture("swapperNullSearchResult",{data:{searchQuery:m}})},[P,C,m,N]);let Z=(0,Bt.useMemo)(()=>ab({includeOwnedAssets:!m,sellAsset:s,sellCaip19:r,ownedAssets:p,searchAssets:C}),[m,p,C,s,r]);return(0,Bt.useMemo)(()=>({assets:Z,initialFilterKey:e??s?.data.chain.id??n?.chainId,isLoading:f||Q,isFetching:f||Q||g,error:w??z,searchRef:S,setSearchQuery:c,searchQuery:o}),[Z,f,Q,g,w,z,s,S,c,n?.chainId,e,o])}a(Iv,"useLiveSwapBuyAssetList");u();l();var wu=U($());u();l();var _ae="https://help.phantom.com/hc/en-us/articles/27085326202515";var kv=[.3,.5,1],Cv=kv.map(t=>`${t}%`),_v=[...Cv,"custom"],Fv=[.5,1,2],Pv=Fv.map(t=>`${t}%`),Rae=[...Pv,"custom"],Dae=_v.length-1,Nae=5,Bae=2,cb=.1,ub=30,vv=2,Lae=a((t,e)=>{if(!t)return;let r=parseFloat(t);if(isNaN(r))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(r>ub)return{message:e("swapSlippageSettingsCustomMaxError",{maxSlippage:ub}),severity:"critical"};if(r>vv)return{message:e("swapSlippageSettingsHighSlippageWarning"),severity:"warning"};if(r<cb)return{message:e("swapSlippageSettingsCustomMinError",{minSlippage:cb}),severity:"critical"}},"getCustomSlippageError");u();l();var js=U($());var Rv={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},Hae=a((t,e,r)=>{let n=parseFloat(t);if(isNaN(n))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(n>r.max)return{message:e("swapPriorityFeeSettingsCustomMaxError",{maxPriorityFee:r.max}),severity:"critical"};if(n<r.min)return{message:e("swapPriorityFeeSettingsCustomMinError",{minPriorityFee:r.min}),severity:"critical"};if(n>r.high)return{message:e("swapPriorityFeeSettingsHighFeeWarning"),severity:"warning"};if(n<r.low)return{message:e("swapPriorityFeeSettingsLowFeeWarning"),severity:"warning"}},"validatePriorityFee"),Gae=a(()=>{let[t,e]=(0,js.useState)(Rv.bounds);return(0,js.useEffect)(()=>{a(async()=>{try{let n=await Ji({accounts:[],transactionType:rs.Swap});e({min:n.min,low:n.low,high:n.high,max:n.max})}catch(n){E.captureError(n instanceof Error?n:new Error("Unable to fetch priority fee bounds."),I.Swapper)}},"fetchBounds")()},[]),t},"usePriorityFeeBounds");u();l();var Ks=U($());var Dv={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},Xae=a((t,e,r)=>{let n=parseFloat(t);if(isNaN(n))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(n>r.max)return{message:e("swapTipSettingsCustomMaxError",{maxTip:r.max}),severity:"critical"};if(n<r.min)return{message:e("swapTipSettingsCustomMinError",{minTip:r.min}),severity:"critical"};if(n>r.high)return{message:e("swapTipSettingsHighFeeWarning"),severity:"warning"};if(n<r.low)return{message:e("swapTipSettingsLowFeeWarning"),severity:"warning"}},"validateTip"),Jae=a(()=>{let[t,e]=(0,Ks.useState)(Dv.bounds);return(0,Ks.useEffect)(()=>{a(async()=>{try{let n=await Ji({accounts:[],transactionType:rs.Swap});e({min:n.min,low:n.low,high:n.high,max:n.max})}catch(n){E.captureError(n instanceof Error?n:new Error("Unable to fetch tip bounds."),I.Swapper)}},"fetchBounds")()},[]),t},"useTipBounds");u();l();var Pp=U($());function Nv({enablePrices:t,enableSorting:e}){let{fungibles:r,isLoadingTokens:n,tokensError:s,refetch:o}=is({enablePrices:t,enableSorting:e}),c=kp(),d=j(f=>f.sellFungible),m=r.filter(f=>c(f.data.chain.id)&&f.type!==ae.CompressedSPL),p=(0,Pp.useMemo)(()=>{if(d){let f=m.findIndex(w=>Qn(w,d)),g=m[f];g&&g.data.amount!==d.data.amount&&(m[f]=d)}return m.filter(f=>f.data.amount!=="0")},[m,d]);return(0,Pp.useMemo)(()=>({assets:p,isLoading:n,error:s,refetchTokens:o}),[p,n,s,o])}a(Nv,"useSwapSellAssetList");u();l();var Bv=[tt.lastSubmittedPairs,tt.slippageTolerance],Lv=a(t=>{let e=String(t.queryKey[1]);return Bv.includes(e)},"swapperShouldDehydrateQueryPredicate");u();l();var db=U($());u();l();function lb(){return[new vp,new Dp,new Rp]}a(lb,"getBuyAmountEditableRules");var vp=class{static{a(this,"SwapAssetEditableRule")}isEditable({sellAsset:e}){return!!e&&A.isSolanaNetworkID(e.data.chain.id)}},Rp=class{static{a(this,"CryptoCurrencyDenominationEditableRule")}isEditable({currencyDenomination:e}){return e==="crypto"}},Dp=class{static{a(this,"BridgeSwapAssetEditableRule")}isEditable({sellAsset:e,buyAsset:r}){return!ht(e?.data.chain.id,r?.data.chain.id)}};var Ice=a(({sellAsset:t,buyAsset:e,currencyDenomination:r})=>{let n=At("enable-swapper-exact-out"),s=(0,db.useMemo)(()=>lb(),[]);return!e||!n?!1:s.every(o=>o.isEditable({sellAsset:t,buyAsset:e,currencyDenomination:r}))},"useBuyAmountEditableRules");u();l();var Ab=U($());u();l();var pb=U($());var Ov={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"},mb=a(()=>{let{currentQuote:t}=Ie(),{destinationNetworkFee:e,liquidityFee:r}=(0,pb.useMemo)(()=>{function n(o){return o?{amount:new b(o.amount??0),amountUsd:o.amountUSD?parseFloat(o.amountUSD):null,pct:parseFloat(o.percentage??"0")}:hn}a(n,"bridgeFeeToFee");let s=new Map([]);return t&&de(t)&&(s=t.steps.flatMap(o=>o.includedFeeCosts).reduce((o,c)=>{if(!c)return o;let d=Ov[c.name];return d&&o.set(d,c),o},s)),{destinationNetworkFee:n(s.get("destinationNetwork")),liquidityFee:n(s.get("liquidityProvider"))}},[t]);return{destinationNetworkFee:e,liquidityFee:r}},"useBridgeFees");u();l();var fb=U($());var Uv={calculate({currentQuote:t,gasEstimationPriceData:e}){return{amount:(t&&e?.gasEstimationAmount)??new b(0),amountUsd:(t&&e?.gasEstimationPriceUSDNumber)??null,pct:0}}},Mv={calculate({currentQuote:t,gasEstimationPriceData:e,priceMap:r,networkID:n}){let s=(t?.fees??[]).find(d=>d.type==="tips"||d.type==="network"&&d.name!=="Token account deposits"),o=(t&&e?.gasEstimationAmount)??new b(0),c=(t&&e?.gasEstimationPriceUSDNumber)??null;if(s&&s.amount&&(o=o.plus(new b(s.amount)),c)){let d=vt(n,new b(s.amount),r);d&&(c+=d)}return{amount:o,amountUsd:c,pct:0}}},qv={calculate({currentQuote:t,gasEstimationPriceData:e,maxGasEstimationPriceData:r}){return{amount:(t&&e?.gasEstimationAmount)??new b(0),amountUsd:(t&&e?.gasEstimationPriceUSDNumber)??null,maxAmount:(t&&r?.gasEstimationAmount)??new b(0),maxAmountUsd:(t&&r?.gasEstimationPriceUSDNumber)??null,pct:0}}},hb=a(({priceMap:t})=>{let{currentQuote:e}=Ie(),r=j(p=>p.sellFungible),n=j(p=>p.gasEstimation),s=r?.data.chain.id??te.Solana.Mainnet,{data:o,isLoading:c}=Ao(s,yi(n.estimate)),{data:d}=Ao(s,yi(n.estimateWithBuffer));return{networkFee:(0,fb.useMemo)(()=>A.isEVMNetworkID(s)?qv.calculate({currentQuote:e,gasEstimationPriceData:o,maxGasEstimationPriceData:d}):A.isSolanaNetworkID(s)?Mv.calculate({currentQuote:e,gasEstimationPriceData:o,networkID:s,priceMap:t}):Uv.calculate({currentQuote:e,gasEstimationPriceData:o}),[e,o,d,s,t]),isFetchingGasEstimationPrice:c}},"useNetworkFee");u();l();var gb=U($());var zv={calculate(){return hn}},Qv={calculate({currentQuote:t,networkID:e,priceMap:r}){let n=Gc(t);return{amount:n,amountUsd:vt(e,n,r),pct:0}}},yb=a(({priceMap:t})=>{let{currentQuote:e}=Ie(),n=j(o=>o.sellFungible)?.data.chain.id??te.Solana.Mainnet;return{nonIncludedFees:(0,gb.useMemo)(()=>e&&de(e)?Qv.calculate({currentQuote:e,networkID:n,priceMap:t}):zv.calculate(),[n,e,t])}},"useNonIncludedFees");u();l();var wb=U($());var Hv={calculate({currentQuote:t,networkID:e,priceMap:r}){let n=(t?.fees??[]).find(s=>s.name==="Token account deposits");return{amount:new b(n?.amount??0),amountUsd:n?.amount?vt(e,new b(n.amount),r):null,pct:n?.percentage??0}}},Gv={calculate(){return hn}},Sb=a(({priceMap:t})=>{let{currentQuote:e}=Ie(),n=j(o=>o.sellFungible)?.data.chain.id??te.Solana.Mainnet;return{tokenAccountFee:(0,wb.useMemo)(()=>lr(e)?Hv.calculate({currentQuote:e,networkID:n,priceMap:t}):Gv.calculate(),[e,n,t])}},"useTokenAccountFee");u();l();var bb=U($());var Tb={calculate:a(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:n,priceMap:s})=>{let o=t.amount.plus(e.amount).plus(r.amount);return{amount:o,amountUsd:vt(n,o,s),pct:0}},"calculate")},Vv={calculate:a(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:n,priceMap:s})=>{let o=Tb.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:n,priceMap:s}),c=t.amount.plus(e.maxAmount??0).plus(r.amount);return{...o,maxAmount:c,maxAmountUsd:vt(n,c,s)}},"calculate")},Eb=a(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,priceMap:n})=>{let o=j(d=>d.sellFungible)?.data.chain.id??te.Solana.Mainnet;return{totalFees:(0,bb.useMemo)(()=>A.isEVMNetworkID(o)?Vv.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n}):Tb.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n}),[e,o,r,n,t])}},"useTotalFees");var Np=a(()=>{let t=j(w=>w.gasEstimation.isFetching),e=yn(),{data:r={}}=en({query:{data:e.map(w=>zt(w))}}),{networkFee:n,isFetchingGasEstimationPrice:s}=hb({priceMap:r}),o=t||s,{phantomFee:c}=uS(),{tokenAccountFee:d}=Sb({priceMap:r}),{nonIncludedFees:m}=yb({priceMap:r}),{totalFees:p}=Eb({tokenAccountFee:d,networkFee:n,nonIncludedFees:m,priceMap:r}),{destinationNetworkFee:f,liquidityFee:g}=mb();return(0,Ab.useMemo)(()=>({phantomFee:c,networkFee:n,tokenAccountFee:d,totalFees:p,nonIncludedFees:m,destinationNetworkFee:f,liquidityFee:g,isFetchingFees:o}),[c,n,d,p,m,f,g,o])},"useFees");u();l();var xb=U($());var Hn=a(()=>{let{resume:t}=qn(),e=j(r=>r.resetSwapper);return(0,xb.useCallback)(()=>{t(),e()},[e,t])},"useResetSwapper");u();l();var Ib=U($());function $v(){let t=Se(),e=j(g=>g.buyFungible),r=j(g=>g.sellFungible),n=j(g=>g.setBuyFungible),s=j(g=>g.setSellFungible),o=j(g=>g.setSellAmount),c=j(g=>g.setUiSellAmountCryptoInput),d=j(g=>g.resetQuote),m=j(g=>g.setSwapFilter),p=r?.data.amount,{cancelQuotes:f}=pu();return(0,Ib.useCallback)(async g=>{if(r&&Qn(g,r)){g&&g.data.amount!==p&&(s(g),m(void 0));return}await f();let w=Lr(g);t.capture("swapperUpdateFromAsset",{data:w}),s(g),m(void 0),e&&r&&Qn(g,e)&&n(r),g&&r?.data.chain.id!==g.data.chain.id&&(d(),n(void 0),o(""),c(""))},[t,e,f,p,d,r,n,o,s,m,c])}a($v,"useSwapSetSellAsset");u();l();var Gn=U($());u();l();var Mr;(function(t){t.Collapsible="collapsible",t.Static="static"})(Mr||(Mr={}));u();l();var Cb=U(So()),Ws=U($());u();l();u();l();var Su=class{static{a(this,"UgcAwareAssetsSectionAdapter")}sections(e){let r=Ur().map(o=>o.programId),n=e.reduce((o,c)=>{if(na({minimum:ce.Verified,spamStatus:c.data.spamStatus}))return o.verified.push(c),o;if(c.type!==ae.SPL||!c.data.ugcTokenMeta||c.data.ugcTokenMeta.status===Jf.Graduated||!r.includes(c.data.ugcTokenMeta.programId))return o.unverified.push(c),o;let d=c.data.ugcTokenMeta.programId,m=o[d]??[];return m.push(c),o[d]=m,o},{verified:[],unverified:[]}),s=Ur().map(o=>{let c=n[o.programId]??[];return{id:o.programId,header:{title:L.t("swapSectionTitleTokens",{section:o.name}),iconUrl:o.iconUrl},data:c,behavior:Mr.Collapsible}});return[{id:"verified",data:n.verified,behavior:Mr.Static},{id:"unverified",header:{title:L.t("swapUnverifiedTokens")},data:n.unverified,behavior:Mr.Collapsible},...s]}};function kb(){return new Su}a(kb,"getBuyAssetsSectionAdapter");var _b=(0,Ws.createContext)(void 0),jv=a(({children:t})=>{let e=(0,Ws.useMemo)(()=>kb(),[]);return(0,Cb.jsx)(_b.Provider,{value:{buyAssetSectionAdapter:e},children:t})},"SwapAssetSelectProvider"),Bp=a(()=>{let t=(0,Ws.useContext)(_b);if(!t)throw new Error("useSwapAssetSelect must be used within a SwapAssetSelectProvider");return t},"useSwapAssetSelect");var Fb=3;function Lp(t){return{id:t.id,data:t.data,...t.header?{header:t.header}:{}}}a(Lp,"convertToBaseSection");var Kv=a(t=>{let[e,r]=(0,Gn.useState)({}),n=(0,Gn.useCallback)((c,d)=>r(m=>({...m,[c]:d})),[]),{buyAssetSectionAdapter:s}=Bp(),o=(0,Gn.useMemo)(()=>s.sections(t),[s,t]);return(0,Gn.useMemo)(()=>o.map(c=>{switch(c.behavior){case Mr.Static:return Lp(c);case Mr.Collapsible:{if(c.data.length<=Fb)return Lp(c);let d=e[c.id],m=d?c.data:c.data.slice(0,Fb),p=a(()=>n(c.id,!d),"onClick"),f=Lp(c);return{...f,header:{...f.header,title:f.header?.title||"",button:{label:d?L.t("commandShowLess"):L.t("commandShowMore"),onClick:p}},data:m}}}}),[o,e,n])},"useSwapAssetCollapsibleSections");u();l();var Tu=U($());u();l();var bi=U($());u();l();var Op=U($());var Wv=.05,Zv=a(({sellNetworkId:t,buyNetworkId:e,destinationMinRequiredBalance:r,priceMap:n})=>{if(!t||!e||!n)return new b(0);let s=D(zt(A.getChainID(t))),o=D(zt(A.getChainID(e))),c=n[s]?.usd,d=n[o]?.usd;if(!c||!d)return new b(0);let m=Re(r.toNumber(),A.getTokenDecimals(e)),p=lh(m.toNumber(),d),f=dh(p,c,A.getTokenDecimals(t));return new b(f).times(1+Wv)},"getSourceBridgeFeeForMinRequiredBalance"),Pb=a(({sellFungible:t,buyFungible:e})=>{let r=t?.data.chain.id,n=e?.data.chain.id,s=n??r,o=ht(r,n),{fungible:c}=ua({key:e?.data.key}),{data:d}=Fe(),m=(0,Op.useMemo)(()=>d?.addresses.find(y=>y.networkID===s),[d,s]),f=yn().map(y=>zt(y)),{data:g}=en({query:{data:f},queryOptions:{refetchInterval:!1}}),{data:w=0}=rh(m);return(0,Op.useMemo)(()=>{if(c)return new b(0);let y=new b(w);return o?Zv({sellNetworkId:r,buyNetworkId:n,destinationMinRequiredBalance:y,priceMap:g}):y},[c,w,o,r,n,g])},"useDestinationMinRequiredBalance");u();l();function vb({sellFungible:t,sellNativeFungible:e,totalNativeRequirement:r}){let n=t?.data.chain.id,s=e?es(e.data.amount,e.data.decimals):"-",o=e?es(r,e.data.decimals):"-";return{networkId:n,balance:s,required:o}}a(vb,"getInsufficientBalanceArgs");u();l();function Rb({sellFungible:t,totalFees:e,destinationMinRequiredBalance:r,currentQuote:n}){if(t?.type?Pt(t?.type):!1){let o=new b(n?.sellAmount??0);return e.plus(o)}else return e.plus(r)}a(Rb,"getTotalNativeRequirement");u();l();var Xv=new b(890880);function bu({nativeBalance:t,totalRequired:e,networkId:r}){if(!r||!A.isSolanaNetworkID(r))return!1;let n=t.minus(e);return n.gt(0)&&n.lt(Xv)}a(bu,"isInSolanaForbiddenZone");var Db=a((t,e)=>{let{sellFungible:r,buyFungible:n,maxSellAmount:s}=Jv(t),o=eR(e),c=Pb({sellFungible:r,buyFungible:n}),d=(0,bi.useMemo)(()=>Yv(e),[e]),m=(0,bi.useMemo)(()=>{if(r&&Pt(r.type)&&A.isBitcoinNetworkID(r.data.chain.id))return r.data.key;let g=r?.data.chain.id;return g?nh(g,void 0):void 0},[r]),{fungible:p}=ua({key:m,enableSorting:!1,enablePrices:!1}),f=(0,bi.useMemo)(()=>s?{maxSellAmount:s}:void 0,[s]);return(0,bi.useMemo)(()=>{if(!r||!p||!n||!o)return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:void 0,totalNativeRequirement:void 0,sellNativeFungible:void 0};if(Ne(r)||Ne(n))return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:cp(e,f),totalNativeRequirement:void 0,sellNativeFungible:void 0};let g=Rb({sellFungible:r,totalFees:d,destinationMinRequiredBalance:c,currentQuote:o}),w=new b(p?.data.amount??0),y=bu({nativeBalance:w,totalRequired:g,networkId:r.data.chain.id}),S=cp(e,{...f,totalNativeRequirement:g,nativeBalance:w});return{hasInsufficientFunds:w.lt(g)||y,insufficientFundsArgs:vb({sellFungible:r,sellNativeFungible:p,totalNativeRequirement:g}),analyticsFields:S,totalNativeRequirement:g,sellNativeFungible:p}},[r,n,o,d,c,p,e,f])},"useHasInsufficientFunds");function Jv(t){return t.type!=="pair"?{sellFungible:void 0,buyFungible:void 0,maxSellAmount:void 0}:{sellFungible:t.sellToken,buyFungible:t.buyToken,maxSellAmount:t.maxSellAmount}}a(Jv,"getTokens");function Yv(t){return t.type!=="quoteProcessed"?new b(0):t.nextProcessedQuote.fees.fees.reduce((e,r)=>e.plus(r.amount),new b(0))}a(Yv,"getTotalFees");function eR(t){if(t.type==="quoteProcessed")return t.quote}a(eR,"getQuote");u();l();var tR=2e3;async function rR(t,e,r){let n,s=new Promise((o,c)=>{n=setTimeout(()=>c(new Error(r)),e)});try{return await Promise.race([t,s])}finally{n&&clearTimeout(n)}}a(rR,"withTimeout");async function nR(t,e){try{let r=Jr(e),n=new ue.PublicKey(t);return{success:!0,balance:(await r.getBalance(n,"confirmed")).toString()}}catch(r){return{success:!1,balance:void 0,error:r instanceof Error?r.message:String(r)}}}a(nR,"fetchSolanaBalanceViaRpc");async function sR(t,e){try{let r=D({chainId:e,address:t,resourceType:W.address}),n=A.getChainID(e),s=zt(n),o=D(s),c=await Sh({walletCaip19s:[r],fungibleCaip19s:[o]});return!c.tokens||c.tokens.length===0?{success:!1,balance:void 0,error:"No balance data in response"}:{success:!0,balance:c.tokens[0]?.totalQuantityString??"0"}}catch(r){return{success:!1,balance:void 0,error:r instanceof Error?r.message:String(r)}}}a(sR,"fetchBalanceViaPortfolioApi");async function oR({walletAddress:t,chainId:e}){let r=sR(t,e);if(A.isSolanaNetworkID(e)){let n=await nR(t,e);if(n.success)return n}return await r}a(oR,"fetchNativeTokenBalanceInternal");async function Nb({walletAddress:t,chainId:e}){try{return await rR(oR({walletAddress:t,chainId:e}),tR,"Balance request timed out")}catch(r){return{success:!1,balance:void 0,error:r instanceof Error?r.message:String(r)}}}a(Nb,"fetchNativeTokenBalance");async function iR(t,e,r){let n=await Nb({walletAddress:t,chainId:e});if(!n.success||n.balance===void 0)return;let s=new b(n.balance),o=s.gte(r),c=bu({nativeBalance:s,totalRequired:r,networkId:e});return{hasSufficientFunds:o&&!c,freshBalance:n.balance}}a(iR,"checkFreshBalance");function vde({tokenState:t,quoteProcessorState:e,enableFreshBalanceCheck:r}){let{hasInsufficientFunds:n,insufficientFundsArgs:s,analyticsFields:o,totalNativeRequirement:c,sellNativeFungible:d}=Db(t,e),m=(0,Tu.useMemo)(()=>({hasInsufficientFunds:n,insufficientFundsArgs:s,analyticsFields:o}),[n,s,o]);return{checkBalance:(0,Tu.useCallback)(async()=>{if(!r||!c||!d)return m;let f=await iR(d.data.walletAddress,d.data.chain.id,c);if(!f)return m;let g=o?{...o,nativeBalance:f.freshBalance}:void 0,w={networkId:d.data.chain.id,balance:es(f.freshBalance,d.data.decimals),required:es(c,d.data.decimals)};return f.hasSufficientFunds?{hasInsufficientFunds:!1,insufficientFundsArgs:w,analyticsFields:g}:{hasInsufficientFunds:!0,insufficientFundsArgs:w,analyticsFields:g}},[r,c,d,m,o])}}a(vde,"useNativeBalance");u();l();var Eu=a(({networkID:t,txReceipt:e,preferredExplorers:r})=>{let n=e?.id??"";if(!n)return;let s=r?.explorers[t];return Cf({networkID:t,endpoint:"transaction",explorerType:s,param:n})},"getExploreUrl");u();l();u();l();var qr=U($());u();l();function Bb(t,e){if(e){let r=aR(t),n=uR(t,e),s=lR(t,e);return{notEnoughSol:e.message===B.NotEnoughSol,txErrorTitle:r,txErrorMessage:n,txErrorHelpButtonLink:s}}return{notEnoughSol:!1,txErrorTitle:"",txErrorMessage:"",txErrorHelpButtonLink:""}}a(Bb,"getSwapErrorDetails");var aR=a(t=>t?L.t("swapTxBridgeFailed"):L.t("swapTxConfirmationSwapFailed"),"getErrorTitle"),cR=a(t=>{switch(t.message){case B.LedgerConnectionError:return L.t("swapTxConfirmationSwapFailedLedgerConnectionError");case B.LedgerRejectAction:return L.t("swapTxConfirmationSwapFailedLedgerReject");case B.LedgerUnknownSignError:return L.t("swapTxConfirmationSwapFailedLedgerSignError");case B.LedgerUnknownError:return L.t("swapTxConfirmationSwapFailedLedgerError");default:return null}},"getLedgerErrorMessage"),uR=a((t,e)=>{let r=cR(e);if(r!==null)return r;if(t)switch(e.message){case B.SlippageExceeded:return L.t("swapTxConfirmationSwapFailedSlippageLimit");default:return L.t("swapTxBridgeFailedDescription")}else switch(e.message){case B.InsufficientFunds:return L.t("swapTxConfirmationSwapFailedInsufficientBalance");case B.SlippageExceeded:return L.t("swapTxConfirmationSwapFailedSlippageLimit");case B.EmptyRoute:return L.t("swapTxConfirmationSwapFailedEmptyRoute");case B.AccountFrozen:return L.t("swapTxConfirmationSwapFailedAcountFrozen");case B.SimulationTimeout:return L.t("swapTxConfirmationSwapFailedSimulationTimeout");case B.InsufficientGas:return L.t("swapTxConfirmationSwapFailedInsufficientGas");case B.NotValidScanResultsError:return L.t("swapTxConfirmationSwapFailedUnknownError");case B.StaleQuote:return L.t("swapTxConfirmationSwapFailedStaleQuote");case B.SimulationUnknownError:return L.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return L.t("swapTxConfirmationSwapFailedTryAgain")}},"getErrorMessage"),lR=a((t,e)=>t?Lc:e.message===B.AccountFrozen?Cw:Lc,"getHelpButtonLink");u();l();var Lb=a(({sellAmount:t,sellFungible:e,buyAmount:r,buyFungible:n,txStatus:s,txReceipt:o,swapTransactions:c,isReadyToExecute:d,uiEstimatedTime:m,isBridge:p,isLedger:f,notEnoughSol:g,txError:w,txErrorTitle:y,txErrorMessage:S,explorerUrl:x,txErrorHelpButtonLink:T,addressType:_})=>{let k=Re(t,e?.data.decimals??0).toNumber(),P=Re(r,n?.data.decimals??0).toNumber(),v=s==="success",z=s==="error",Q=!!o,R=c?.transactions.length||0;return{sellAsset:{amount:k,symbol:e?.data.symbol??"",networkID:e?.data.chain.id??te.Solana.Mainnet},buyAsset:{amount:P,symbol:n?.data.symbol??"",networkID:n?.data.chain.id??te.Solana.Mainnet},estimatedTime:m,isBridge:p,isSuccess:v,isFailure:z,isLedger:f,isClosable:Q,notEnoughSol:g,txError:w,txErrorTitle:y,txErrorMessage:w?.detailMessage?`${S}

${w?.detailMessage}`:S,txLink:x??"",txErrorHelpButtonLink:T,numberOfTransactions:R,isReadyToExecute:d,addressType:_}},"mapToSwapConfirmationViewState");var Up=a(({sellFungible:t,txReceipt:e,swapTransactions:r,isBridge:n,txError:s,txStatus:o,isReadyToExecute:c,isLedger:d})=>{let m=t?.data.chain.id??te.Solana.Mainnet,{notEnoughSol:p,txErrorTitle:f,txErrorMessage:g,txErrorHelpButtonLink:w}=(0,qr.useMemo)(()=>Bb(n,s),[n,s]),y=(0,qr.useMemo)(()=>A.getAddressType(m),[m]),{currentQuote:S}=Ie(),[x]=(0,qr.useState)(S),{buyAmount:T,sellAmount:_}=x??{buyAmount:"0",sellAmount:"0"},k=j(R=>R.buyFungible),{data:P}=_f(),v=(0,qr.useMemo)(()=>Eu({txReceipt:e,networkID:m,preferredExplorers:P}),[e,m,P]),z=(0,qr.useMemo)(()=>Mn(x),[x]);return(0,qr.useCallback)(()=>Lb({sellFungible:t,txReceipt:e,addressType:y,swapTransactions:r,isBridge:n,txError:s,sellAmount:_,buyAmount:T,buyFungible:k,txStatus:o,isReadyToExecute:c,uiEstimatedTime:z,isLedger:d,notEnoughSol:p,txErrorTitle:f,txErrorMessage:g,explorerUrl:v,txErrorHelpButtonLink:w}),[t,e,y,r,n,s,_,T,k,o,c,z,d,p,f,g,v,w])()},"useSwapConfirmationViewState");u();l();var Lt=U($());u();l();var Zs=U($());var Vn=a(()=>{let t=Se(),e=Vs(),{currentQuote:r,quoteResponse:n,selectedProviderIndex:s,selectedBaseProvider:o}=Ie(),{analyticsContext:c}=r??{analyticsContext:void 0},d=j(R=>R.buyFungible),m=j(R=>R.sellFungible),p=j(R=>R.buyUsdValue),f=j(R=>R.sellUsdValue),g=j(R=>R.swapFilter),{selectedSetting:w}=Gt(),y=j.getState().amountType,S=m?.data.chain.id??te.Solana.Mainnet,x=Np(),{transition:T}=Gs(),_=(0,Zs.useCallback)(R=>{let G=$s(s,w.type,n);return Zc({buyToken:d,sellToken:m,buyAmount:r?.buyAmount.toString()??"",sellAmount:r?.sellAmount.toString()??"",phantomFeeUiAmount:x.phantomFee.amountUsd?.toString()??"",priceImpact:Jc(r),provider:ve(Le(r)),baseProvider:o,buyAssetUsdValue:p,sellAssetUsdValue:f,slippageTolerance:G,transactionId:R??"",slippageType:w.type,sellSwapFilter:g,analyticsContext:c,tradeDirection:y})},[d,m,r,x.phantomFee.amountUsd,p,f,n,s,w.type,g,c,o,y]),k=(0,Zs.useCallback)(R=>{Xc({txReceipt:R,networkID:S,amountType:y,swapAnalytics:e,walletAddress:m?.data.walletAddress})},[S,y,e,m?.data.walletAddress]),P=(0,Zs.useCallback)((R,G)=>{T({type:Ve.TransactionSubmissionFailed,error:R}),R.message!==B.NotValidScanResultsError&&R.message!==B.SlippageExceeded&&E.captureError(R,I.Swapper);let M=_(G);t.capture("swapperSwapFailure",{data:{...M.data,error:R.message}})},[t,_,T]),v=a(()=>{t.capture("swapperSwapFailureNoSignature")},"logSwapFailureNoSignature"),z=(0,Zs.useCallback)(R=>{let G=_(R.id);t.capture("swapperSwapSuccess",G);let M=Zr(R.networkID);E.addBreadcrumb(I.Swapper,"transactionStatus",F.Info,{...M,txReceipt:R.id}),(M.chainType===ie.EVM||M.chainType===ie.Solana||M.chainType===ie.Sui)&&e.transactionStatus(R.id,{...M,status:{type:"confirmed"}})},[t,_,e]),Q=(0,Zs.useCallback)((R,G)=>{let M=R?.networkID?Zr(R.networkID):null;(M?.chainType===ie.EVM||M?.chainType===ie.Solana||M?.chainType===ie.Sui)&&R?.id&&(E.addBreadcrumb(I.Swapper,"transactionStatus",F.Error,{...M,txReceipt:R.id}),e.transactionStatus(R.id,{...M,status:{type:"error"}}),T({type:Ve.TransactionConfirmationFailed,error:G,txReceipt:R}))},[e,T]);return{logTransactionSubmitted:k,logTransactionSubmissionError:P,logSwapFailureNoSignature:v,logTransactionConfirmed:z,logTransactionConfirmationFailed:Q}},"useSwapConfirmationAnalytics");u();l();var Qb=U($());u();l();var Ob=a(()=>{let{selectedSetting:t}=Gt(),{selectedProviderIndex:e,quoteResponse:r}=Ie(),n=$s(e,t.type,r),{data:s}=$c();return{slippageSetting:t,slippageTolerance:n??s??void 0}},"useAutoSlippageAwareSlippageTolerance");u();l();u();l();u();l();u();l();var dR=a(t=>{let e=Ke(),r=Se(),{data:n,isPending:s}=ne({gcTime:0,queryKey:["originIsBlocklisted",t],queryFn:a(async()=>{let{result:o}=await jl(e,r,t);return o},"queryFn")});return t===void 0?{isLoading:!1,originIsBlocklisted:!1}:{isLoading:s,originIsBlocklisted:n??!1}},"useOriginIsBlocklisted");u();l();var Mp=U($());function pR(t,e){let{data:r}=Fe(),{params:n,networkID:s}=t,[o,c]=(0,Mp.useState)(null),d=["scan-message",{url:t.url,message:n.message}],m=r?.addresses.find(S=>S.networkID===s)?.address,p=Ft(L.language)??"en",f=Se(),g=new Un(f),w=Mb(),y=ne({queryKey:d,queryFn:a(async()=>{try{let S=await Zl(p,await f.getDeviceId(),{...t,userAccount:m});return c(null),g.onScannedMessageByUser({networkId:s,warnings:S.warnings.map(x=>x.severity),shouldBlock:!!S.block,errorCode:S.error??""}),S}catch(S){c(S),g.onFailedScannedMessageByUser({networkId:s,url:t.url}),E.addBreadcrumb("simulation",`networkID: ${s}, url: ${t.url}, type: message`,F.Info),E.captureError(y.error,I.Simulation)}},"queryFn"),enabled:!!m&&!!t.url&&!!n.message&&!e?.disabled,refetchInterval:e?.disableRefetch?!1:w,staleTime:1e3*10,...Gl()});return{isFetched:y.isFetched,isFetching:y.isFetching,data:y.data,isLoading:y.isPending&&!e?.disabled,isError:y.isError||!!o,error:y.error||o}}a(pR,"useScannedMessage");function qp(t,e){let{params:r}=t,[n,s]=(0,Mp.useState)(null),o=Se(),c=["scan-transaction",t.networkID,t.url,r?r.transactions??r.transaction:""],d=Mb(),m=!1;A.isEVMNetworkID(t.networkID)||A.isSolanaNetworkID(t.networkID)?m=!!r&&r.transactions.length>0&&!!t.userAccount:A.isBitcoinNetworkID(t.networkID)?m=!!r&&!!r.transaction&&!!r.userAddresses&&r.userAddresses.length>0:A.isSuiNetworkID(t.networkID)&&(m=!!r&&!!t.userAccount);let p=Ft(L.language)??"en",f=new Un(o),g=m&&!e?.disabled,w=ne({queryKey:c,queryFn:a(async()=>{try{let y=await xn(p,await o.getDeviceId(),t);return f.onScannedTransactionByUser({networkId:t.networkID,warnings:y.warnings.map(S=>S.severity),shouldBlock:!!y.block,errorCode:y.error??""}),s(null),e?.onSettled?.(y,void 0),y}catch(y){f.onFailedScannedTransactionByUser({networkId:t.networkID,url:t.url}),E.addBreadcrumb("simulation",`networkID: ${t.networkID}, url: ${t.url}, type: transaction`,F.Info),s(y),e?.onSettled?.(void 0,y),E.captureError(y,I.Simulation)}},"queryFn"),enabled:g,refetchInterval:e?.disableRefetch?!1:d,staleTime:1e3*10,...Gl()});return{isFetched:w.isFetched,isFetching:w.isFetching,data:w.data,isLoading:w.isPending&&g,isError:w.isError||!!n,error:w.error||n}}a(qp,"useScannedTransaction");var Ub=5e3;function Mb(){let t=er.getMultivariateAssignment("transactions-simulation-interval-ms");if(!t)return Ub;let e=parseInt(t,10);return Number.isNaN(e)?Ub:e}a(Mb,"getSimulationRefetchInterval");var Au=U($());u();l();var zp="swap-validation",qb=a(({scanResult:t,scanResultError:e,quote:r,sellToken:n,buyToken:s})=>{if(e)return"valid";if(!r||!n||!s)return E.addBreadcrumb(zp,`Missing necessary args: ${JSON.stringify({quote:!!r,scanResult:!!t,sellToken:n,buyToken:s})}`,F.Info),new _e(B.MissingArgument);if(t?.error===ur.SIMULATION_FAILED)return"valid";if(t?.error){if(E.addBreadcrumb(zp,`Simulation error: ${JSON.stringify({error:t.error})}`,F.Info),t.error===ur.SLIPPAGE_EXCEEDED)return new _e(B.SlippageExceeded);if(t.error===ur.INSUFFICIENT_FUNDS)return new _e(B.InsufficientFunds);if(t.error===ur.INSUFFICIENT_GAS)return new _e(B.InsufficientGas);if(t.error===ur.ACCOUNT_FROZEN)return new _e(B.AccountFrozen);if(t.error===ur.SIMULATION_TIMEOUT)return new _e(B.SimulationTimeout);if(t.error===ur.STALE_QUOTE)return new _e(B.StaleQuote);if(t.error===ur.UNKNOWN_ERROR){let o=mR(t);return new _e(B.SimulationUnknownError,o)}return new _e(B.NotValidScanResultsError)}return t?"valid":(E.addBreadcrumb(zp,`Missing necessary args: ${JSON.stringify({quote:!!r,scanResult:!1,sellToken:n,buyToken:s})}`,F.Info),new _e(B.MissingArgument))},"validateScanResult");function mR(t){return t.simulationError?t.simulationError.humanReadableError:t.warnings[0]?.message}a(mR,"parseScanErrorDetail");var zb=a(({swapTransactions:t})=>{let e=j(x=>x.sellFungible),r=j(x=>x.buyFungible),n=e?.data.chain.id??te.Solana.Mainnet,{selectedSetting:s}=Gt(),{currentQuote:o,quoteResponse:c}=Ie(),d=ve(Le(o)),m=ht(e?.data.chain.id,r?.data.chain.id),p=c?.buyToken?D(c?.buyToken):void 0,f=c?.sellToken?D(c?.sellToken):void 0,g={type:"transaction",userAccount:e?.data.walletAddress??"",params:void 0,url:"https://phantom.com",networkID:n,context:m?"bridge":"swap",provider:d,slippageType:s.type,metadata:{swapper:{quoteOutputAmount:o?.buyAmount,quoteOutputToken:p,quoteInputAmount:o?.sellAmount,quoteInputToken:f}}};t?.type==="evm"&&A.isEVMNetworkID(n)&&(g.params={transactions:t.transactions}),t?.type==="solana"&&A.isSolanaNetworkID(n)&&(g.params={transactions:t.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}});let{transition:w}=Gs(),y=(0,Au.useCallback)((x,T)=>{T&&w({type:Ve.SimulationRequestError,error:T}),x&&w({type:Ve.SimulationResponseReceived,scannedTransactionResult:x})},[w]),S=qp(g,{disableRefetch:!0,onSettled:y,disabled:t?.type==="sui"});return(0,Au.useMemo)(()=>{if(S.isLoading)return{isLoading:!0,state:"loading"};if(t?.type==="sui")return{isLoading:!1,state:"valid"};let x=qb({scanResult:S.data,scanResultError:S.isError,quote:o,sellToken:c?.sellToken,buyToken:c?.buyToken,simulationTolerance:c?.simulationTolerance});return{isLoading:S.isLoading,state:x}},[S,o,c,t?.type])},"useSwapScanTransaction");function Hb({isBridge:t,addressType:e,isSwapSimulationDisabled:r,onTransactionReceiptReceived:n,onTransactionSubmissionError:s,resetToInitialState:o,sender:c}){let{logTransactionSubmitted:d,logSwapFailureNoSignature:m}=Vn(),{connection:p}=tn(),{data:f}=Fe(),{currentQuote:g,quoteResponse:w}=Ie(),{slippageTolerance:y}=Ob(),S=j(C=>C.gasEstimation.estimateWithBuffer),x=j(C=>C.sellFungible),T=x?.data.chain.id??te.Solana.Mainnet,{data:_,isSuccess:k}=fs({callerAddress:c,quote:g,sellFungible:x}),P=zb({swapTransactions:_}),{pendingActivityRows:v}=Eg({sender:c}),{mutateAsync:z}=rb({accountIdentifier:f?.identifier??"",networkID:T}),[Q,R]=(0,Qb.useState)(!1),G=a(async()=>(R(!0),aw({isBridge:t,addressType:e,isSwapSimulationDisabled:r,sender:c,currentQuote:g,quoteResponse:w,gasEstimation:S,swapTransactions:_,scanResults:P,pendingActivityRows:v,connection:p,slippageTolerance:y,logSwapFailureNoSignature:m,logTransactionSubmitted:d,swapFungibles:z,onTransactionSubmissionError:s,onTransactionReceiptReceived:n,resetToInitialState:o})),"executeSwapAndTrack");return{isReadyToExecute:Q||(!P.isLoading||r)&&k,executeSwap:G}}a(Hb,"useExecuteSwap");u();l();var xu=U($());var Gb=a(({goToSwapTab:t,goToActivityTab:e})=>{let{resume:r}=qn(),{clearQuotes:n}=_p(),s=Hn(),o=(0,xu.useCallback)(()=>{r(),n(),t()},[t,r,n]),c=(0,xu.useCallback)(()=>{r()},[r]),d=(0,xu.useCallback)(()=>{s(),e()},[e,s]);return{onClose:o,onRetry:c,onSwapSuccess:d}},"useSwapConfirmationActions");u();l();function Vb(){let{data:[t]}=xt(["kill-swapper-simulation"]);return t}a(Vb,"useSwapSimulationInterceptor");u();l();var Xs=U($());var $b=a(({onTransactionConfirmationSuccess:t,onTransactionConfirmationError:e,txReceipt:r})=>{let n=Pe(),{data:s}=Fe(),o=(0,Xs.useMemo)(()=>s?.addresses??[],[s]),c=bh(o),d=Hn(),{logTransactionConfirmed:m,logTransactionConfirmationFailed:p,logTransactionSubmissionError:f}=Vn(),g=j(P=>P.sellFungible),{currentQuote:w}=Ie(),{sellAmount:y}=w??{sellAmount:"0"},S=gh({wallets:o,encodedCaip19:g?D(Y(g)):""}),x=(0,Xs.useCallback)(async P=>{if(m(P),d(),g){let v=new V(g.data.amount),z=new V(y),Q=v.minus(z).toString();Yc(n,{id:eu(g),amount:Q})}c(),S()},[m,d,y,g,c,S,n]),{isSuccess:T,isError:_,error:k}=uh(x,r);(0,Xs.useEffect)(()=>{if(T)t();else if(_){let P=fn(k);e(P),p(r,P),f(P,r?.id)}},[T,_,k,r,p,t,e,f])},"useSwapTransactionConfirmation");function jb({isLedger:t,goToSwapTab:e,goToActivityTab:r}){let{currentQuote:n}=Ie(),s=j(xe=>xe.buyFungible),o=j(xe=>xe.sellFungible),c=Hn(),d=Vb(),{logTransactionSubmissionError:m}=Vn(),[p]=(0,Lt.useState)(ht(o?.data.chain.id,s?.data.chain.id)),f=o?.data.chain.id??te.Solana.Mainnet,{data:g}=Fe(),w=(0,Lt.useMemo)(()=>g?.addresses??[],[g]),y=(0,Lt.useMemo)(()=>w.find(xe=>xe.networkID===o?.data.chain.id)?.address??"",[w,o]),S=(0,Lt.useMemo)(()=>A.getAddressType(f),[f]),{data:x}=fs({callerAddress:y,quote:n,sellFungible:o}),[T,_]=(0,Lt.useState)(),[k,P]=(0,Lt.useState)("loading"),[v,z]=(0,Lt.useState)(),Q=a(()=>{P("loading"),z(void 0),_(void 0)},"resetToInitialState"),R=a(xe=>{_(xe)},"onTransactionReceiptReceived"),G=(0,Lt.useCallback)((xe,St)=>{P("error"),z(xe),m(xe,St)},[m]),M=(0,Lt.useCallback)(()=>{P("success")},[]),C=(0,Lt.useCallback)(xe=>{P("error"),z(fn(xe))},[]);$b({onTransactionConfirmationSuccess:M,onTransactionConfirmationError:C,txReceipt:k==="error"?void 0:T});let{executeSwap:N,isReadyToExecute:Z}=Hb({isBridge:p,addressType:S,isSwapSimulationDisabled:d,onTransactionSubmissionError:G,onTransactionReceiptReceived:R,resetToInitialState:Q,sender:y}),{onClose:oe,onRetry:re,onSwapSuccess:J}=Gb({goToSwapTab:e,goToActivityTab:r});return{...Up({sellFungible:o,txReceipt:T,swapTransactions:x,isBridge:p,txStatus:k,isReadyToExecute:Z,isLedger:t,txError:v}),executeSwap:N,resetSwapper:c,onClose:oe,onRetry:re,onSwapSuccess:J}}a(jb,"useSwapConfirmationProps");u();l();u();l();var Kb=U($());var fR=a(()=>{let t=Nt();return{selectQuote:(0,Kb.useCallback)((r,n)=>{let s=r[n];s&&t.selectQuote(s)},[t])}},"useSelectQuote");u();l();u();l();u();l();var Ti=K({days:1}),Qp=K({seconds:5}),Wb=K({seconds:30}),Fhe=K({seconds:30}),Phe=K({seconds:5}),vhe=K({seconds:5}),Rhe=K({seconds:30}),Dhe=K({seconds:2}),Nhe=K({seconds:10}),Bhe=K({seconds:30}),Lhe=K({seconds:2}),Ohe=K({seconds:10}),Zb=a(t=>`/v1/actors-search?query=${encodeURIComponent(t)}`,"actorSearchEndpoint");u();l();var c0=i.object({actors:tr.array()}),Js;(function(t){t.Buy="Buy",t.Sell="Sell",t.TokenFollow="TokenFollow"})(Js||(Js={}));var hR=i.object({type:i.literal("followers")}),gR=i.object({type:i.literal("actor"),id:i.string()}),yR=i.union([hR,gR]),u0=i.object({actorId:i.string(),id:i.string(),published:i.coerce.string(),storyType:i.nativeEnum(Js),destinations:i.array(yR)}),l0=u0.extend({chainId:kr}),wR=l0.extend({storyType:i.literal(Js.Buy),tokenBoughtAmount:i.string().nullish(),tokenBoughtUsdValue:i.string().nullish(),tokenBoughtPrice:i.string().nullish(),tokenBoughtAddress:i.string()}),SR=l0.extend({storyType:i.literal(Js.Sell),tokenSoldAmount:i.string().nullish(),tokenSoldUsdValue:i.string().nullish(),tokenSoldPrice:i.string().nullish(),tokenSoldAddress:i.string()}),bR=u0.extend({storyType:i.literal(Js.TokenFollow),tokenId:i.string(),otherTokenFollowers:i.array(i.string())}),jhe=i.union([wR,SR,bR]),Iu;(function(t){t.TokenMetadataV2="TokenMetadataV2",t.Actor="Actor"})(Iu||(Iu={}));var TR=eh.pick({name:!0,symbol:!0,decimals:!0,logoUri:!0,extraMetadata:!0,price:!0}),d0=i.object({id:i.string(),type:i.string()}),p0=d0.extend({type:i.literal(Iu.TokenMetadataV2),attributes:TR}),ER=d0.extend({type:i.literal(Iu.Actor),attributes:tr});var Xb;(function(t){t.SUGGESTED="suggested",t.BY_LIST="by-list"})(Xb||(Xb={}));var Jb;(function(t){t.EXPLORE="explore",t.ONBOARDING="onboarding",t.PROFILE="profile",t.TOKEN="token"})(Jb||(Jb={}));var Yb;(function(t){t.TOP_PNL_1W="top_pnl_1w",t.TOP_PNL_1M="top_pnl_1m",t.SOCIAL_ONBOARDING="social_onboarding"})(Yb||(Yb={}));var ku;(function(t){t.PNL="pnl",t.PNL_BY_TOKEN="pnl-by-token",t.FOLLOWS_YOU="follows-you",t.SEND_INTERACTION="send-interaction"})(ku||(ku={}));var m0=i.object({actorId:i.string()}),AR=m0.extend({type:i.literal(ku.PNL),percentChange:i.number().optional()}),xR=m0.extend({type:i.literal(ku.PNL_BY_TOKEN),caip19:Gr,percentChange:i.number().optional()}),IR=i.discriminatedUnion("type",[AR,xR]),Khe=i.object({items:IR.array().default([]),included:ER.array().default([]),next:i.string().nullish()}),Whe=i.object({data:i.string().array().default([]),meta:i.object({model:i.string()}),included:p0.array().default([])}),Zhe=i.object({orderedItems:tr.array().default([]),next:i.string().optional()}),Xhe=i.object({orderedItems:tr.array().default([]),next:i.string().optional()}),Jhe=i.object({orderedItems:tr.array().default([]),next:i.string().optional()}),e0;(function(t){t.ABUSE_AND_HARASSMENT="abuse_and_harassment",t.PRIVACY_AND_IMPERSONATION="privacy_and_impersonation",t.SPAM="spam"})(e0||(e0={}));var Yhe=i.object({orderedItems:tr.array().default([]),next:i.string().optional()}),ege=i.object({orderedItems:tr.array().default([]),next:i.string().optional()}),kR=i.object({id:i.string(),username:i.string(),icon:i.string().nullish()}),tge=i.object({followingHolders:kR.array().default([])}),CR=i.object({targetId:i.string(),actorId:i.string(),type:i.string(),content:i.string()}),_R=i.object({targetId:i.string(),content:i.string(),type:i.string(),count:i.number({coerce:!0})}),se;(function(t){t.Bear="\u{1F43B}",t.Bull="\u{1F402}",t.CashFlying="\u{1F4B8}",t.Celebrate="\u{1F389}",t.ChartDown="\u{1F4C9}",t.ChartUp="\u{1F4C8}",t.Coin="\u{1FA99}",t.Cool="\u{1F60E}",t.CreditCard="\u{1F4B3}",t.CryLaughing="\u{1F602}",t.Crying="\u{1F62D}",t.DevilHappy="\u{1F608}",t.DevilMad="\u{1F47F}",t.Diamond="\u{1F48E}",t.Disgusted="\u{1F922}",t.Distressed="\u{1F62B}",t.Eggplant="\u{1F346}",t.Expressionless="\u{1F611}",t.Eyes="\u{1F440}",t.Fire="\u{1F525}",t.Flag="\u{1F3C1}",t.HeartEyes="\u{1F60D}",t.Heart="\u2764\uFE0F",t.Mad="\u{1F620}",t.MiddleFinger="\u{1F595}",t.MoneyBag="\u{1F4B0}",t.Moon="\u{1F319}",t.OkHand="\u{1F44C}",t.OpenMouth="\u{1F62E}",t.Peace="\u270C\uFE0F",t.Peach="\u{1F351}",t.PointUp="\u{1F446}",t.PileOfPoo="\u{1F4A9}",t.Pray="\u{1F64F}",t.Rocket="\u{1F680}",t.Siren="\u{1F6A8}",t.Skull="\u{1F480}",t.SmileWithTear="\u{1F972}",t.Smile="\u{1F600}",t.StopSign="\u{1F6D1}",t.Surprised="\u{1F632}",t.SweatDrops="\u{1F4A6}",t.Ufo="\u{1F6F8}",t.UpsideDownFace="\u{1F643}",t.Whale="\u{1F40B}"})(se||(se={}));var f0=[se.CryLaughing,se.Disgusted,se.Mad,se.Distressed,se.HeartEyes,se.OpenMouth,se.SmileWithTear,se.UpsideDownFace,se.Smile,se.Crying,se.Surprised,se.Expressionless,se.Cool,se.DevilHappy,se.DevilMad,se.Skull,se.Eyes,se.Diamond,se.Fire,se.Eggplant,se.Peach,se.CreditCard,se.Heart,se.SweatDrops,se.Coin,se.Siren,se.MoneyBag,se.PileOfPoo,se.Celebrate,se.OkHand,se.MiddleFinger,se.PointUp,se.Peace,se.Pray,se.Rocket,se.Ufo,se.Moon,se.ChartUp,se.ChartDown,se.Flag,se.StopSign,se.Bear,se.Bull,se.CashFlying,se.Whale];function FR(t,e){return t==="emoji"&&f0.includes(e)}a(FR,"canUseReactionCount");var PR=CR.transform(t=>({...t,content:f0.includes(t.content)?t.content:se.Eyes})),rge=i.object({reactions:i.array(PR),counts:i.array(_R).transform(t=>t.filter(e=>FR(e.type,e.content))).optional()}),nge=i.object({actors:tr.array().default([]),nextCursor:i.string().optional()}),sge=i.object({isFollowing:i.boolean()}),t0;(function(t){t.Blocking="blocking",t.Chat="chat",t.CompetitionLeaderboard="competitionLeaderboard",t.Deeplink="deeplink",t.Feed="feed",t.Followers="followers",t.FollowRequest="followRequest",t.ManageAccounts="manageAccounts",t.Notifications="notifications",t.Nux="nux",t.Onboarding="onboarding",t.PerpsLeaderboard="perpsLeaderboard",t.ReactionsDetails="reactionsDetails",t.Search="search",t.SuggestedFollows="suggestedFollows",t.SuggestedFollowsByList="suggestedFollowsByList"})(t0||(t0={}));var r0;(function(t){t.VolumeDistribution="volumeDistribution",t.VolumeDistributionAllocations="volumeDistributionAllocations",t.OpenPositions="openPositions",t.ClosedPositions="closedPositions"})(r0||(r0={}));var n0;(function(t){t.Profile="profile",t.ShareStory="shareStory"})(n0||(n0={}));var oge=i.object({channelType:i.string(),channelId:i.string(),enabled:i.boolean()}),vR=i.object({userId:i.string(),username:i.string(),text:i.string(),createdAt:i.coerce.string()}),RR=i.object({id:i.string(),name:i.string(),image:i.string().nullish()}),ige=i.object({channelId:i.string(),watcherCount:i.number(),watchers:i.array(RR).default([]),lastMessages:i.array(vR)}),age=i.object({quantity:i.number(),quantityString:i.string(),decimals:i.number(),price:i.number().nullish()}),cge=i.object({positions:i.array(i.record(i.string(),i.any()))}),DR=i.object({profileId:i.string(),username:i.string(),quantity:i.number()}),uge=i.object({channelId:i.string(),leaderboard:i.array(DR)}),s0;(function(t){t.Buy="buy",t.Sell="sell",t.PredictionMarketBuy="prediction_market_position_buy",t.PredictionMarketSell="prediction_market_position_sell"})(s0||(s0={}));var NR=i.object({id:i.string(),tokenId:i.string(),createdAt:i.string(),updatedAt:i.string()}),lge=i.object({data:i.array(NR),included:p0.array().default([]),nextCursor:i.string().nullish()}),h0=i.object({channelId:i.string(),channelType:i.string(),watcherCount:i.number()}),BR=h0.extend({eventId:i.string()}),LR=h0.extend({tokenId:i.string()}),dge=i.union([BR,LR]),o0;(function(t){t.TokenPage="tokenPage",t.TrendingList="trendingList",t.RecentList="recentList",t.Banner="banner",t.Notification="notification",t.PredictionMarket="predictionMarket",t.Perps="perps"})(o0||(o0={}));var i0;(function(t){t.Chat="chat"})(i0||(i0={}));var OR=i.object({profileId:i.string(),userId:i.string(),username:i.string(),icon:of}),UR=i.object({accountValueUsd:i.number().nullish().default(null),pnlUsd:i.number(),roiPct:i.number(),volumeUsd:i.number()}),a0=i.object({rank:i.number(),isViewer:i.boolean(),actor:OR,performance:UR}),pge=i.object({leaderboard:i.array(a0),viewer:a0.nullish()}),mge=i.object({accountValueUsd:i.number(),pnlUsd:i.number(),roiPct:i.number(),volumeUsd:i.number(),error:i.string().optional()}),g0=i.object({market:i.string(),name:i.string(),image:i.string(),pnlUsd:i.number()}),MR=g0.extend({margin:i.number(),roiPct:i.number(),leverage:i.string(),direction:i.string()}),qR=g0.extend({id:i.string(),valueUsd:i.number(),timestamp:i.number(),type:i.string()}),zR=i.object({market:i.string(),name:i.string(),image:i.string(),color:i.string().optional(),volumePct:i.number()}),fge=i.object({portfolio:i.object({pnlUsd:i.number(),volumeUsd:i.number()}),openPositions:i.object({positions:i.array(MR)}),closedPositions:i.object({volumeByMarket:i.array(zR),positions:i.array(qR)})}),hge=i.object({totalSwapVolumeUsd:i.number(),totalPerpsVolumeUsd:i.number(),totalVolumeUsd:i.number()}),QR=i.object({caip19:i.string(),name:i.string(),symbol:i.string(),logoUri:i.string().nullish().default(null),balancePct:i.number()}),gge=i.object({tradeCount:i.number(),fungibles:i.array(QR)}),Ei;(function(t){t.PredictionMarket="predictionMarket",t.Perps="perps",t.Token="token"})(Ei||(Ei={}));u();l();var Ys=a(({name:t,response:e,current:r,target:n})=>{let s=`Failed to ${t}: 
`,o=[r!==void 0?`Current: ${r}`:null,n!==void 0?`Target: ${n}`:null].filter(Boolean);return o.length>0&&(s+=`${o.join(" | ")} 
`),s+=`${e.status} ${e.statusText} 
`,s+=`${JSON.stringify(e.data)}`,s},"getFetcherErrorMessage"),y0=a(({name:t,error:e,current:r,target:n})=>{let s=`Failed to parse ${t}: 
`,o=[r!==void 0?`Current: ${r}`:null,n!==void 0?`Target: ${n}`:null].filter(Boolean);return o.length>0&&(s+=`${o.join(" | ")} 
`),s+=`${JSON.stringify(e)}`,s},"getParserErrorMessage");var w0=a(async t=>{E.addBreadcrumb(I.Network,"User is searching for actors.",F.Info,{query:t});let e=await H.api().bearer(!0).get(Zb(t));if(!ee(e)){let n=new Error(Ys({name:"searchForActor",response:e}));throw E.captureError(n,I.UserSearch),n}let r=c0.safeParse(e.data);return r.success?{actors:r.data.actors}:{actors:[]}},"searchForActor");u();l();u();l();function S0(t){let e=t.match(/\/v1\/actors\/([^/]+)/)?.[1];return e?Ki.parse(e):void 0}a(S0,"userProfileIdFromUrl");u();l();function b0(t){return S0(t)??Ki.parse(t)}a(b0,"userProfileIdFromUrlOrProfileId");u();l();var ge="social",ye="@phantom/social",br={actor(t){return[ge,`${ye}:actor`,{profileId:t}]},actorVolume(t){return[ge,`${ye}:actor-volume`,{profileId:t}]},actorAndFollowers(t){return[ge,`${ye}:actor-and-followers`,{profileId:t}]},actorAndFollowing(t){return[ge,`${ye}:actor-and-following`,{profileId:t}]},userProfileByUsernameOrUserProfileId(t){return[ge,`${ye}:user-profile-by-username-or-user-profile-id`,{usernameOrUserProfileId:t}]},followUser(t,e){return[ge,`${ye}:follow-user`,{currentId:t,targetId:e}]},followingTokens(t){return[ge,`${ye}:following-tokens`,{limit:t}]},feedStory(t){return[ge,`${ye}:feed-story`,{storyId:t}]},searchForActorBase(){return[ge,`${ye}:search`]},searchForActor(t){return[ge,`${ye}:search`,{query:t}]},followRequests(t){return[ge,`${ye}:follow-requests`,{profileId:t}]},suggestedActors(t,e){return[ge,`${ye}:suggested-follows`,{profileId:e,source:t}]},actorList(t,e,r){return[ge,`${ye}:actor-list`,{profileId:r,listName:e,source:t}]},blocking(t){return[ge,`${ye}:blocking`,{profileId:t}]},pendingFollowRequests(t,e){return[ge,`${ye}:pending-follow-requests`,{profileId:t,targetId:e}]},reaction(t){return t?[ge,`${ye}:reaction`,{targetId:t}]:[ge,`${ye}:reaction`]},reactionDetails(t){return t.targetId?[ge,`${ye}:reaction-details`,t]:[ge,`${ye}:reaction-details`,{content:t.content}]},followingHolders(t,e){return[ge,`${ye}:following-holders`,{profileId:t,caip19:e}]},tokenFollows(t,e){return[ge,`${ye}:token-follows`,{profileId:t,caip19:e}]},userProfileFeed(t,e){return[ge,`${ye}:user-profile-feed`,{username:t,userEnabledNetworks:e}]},chatEnabled(t){return[ge,`${ye}:chat-enabled`,{chatId:t}]},chatStats(t){return[ge,`${ye}:chat-stats`,{chatId:t}]},tokenChatBalance(t,e){return[ge,`${ye}:token-chat-balance`,{caip19:t,userId:e}]},predictionMarketPosition(t,e){return[ge,`${ye}:prediction-market-position`,{eventId:t,profileId:e}]},chatLeaderboard(t){return[ge,`${ye}:chat-leaderboard`,{caip19:t}]},similarTokens(t,e,r){return[ge,`${ye}:similar-tokens`,{caip19:t,profileId:r,limit:e}]},popularChats(){return[ge,`${ye}:popular-chats`]},chatChannel(t,e){return[ge,`${ye}:chat-channel`,{channelType:t,channelId:e}]},perpsLeaderboard(t,e){return[ge,`${ye}:perps-leaderboard`,{limit:t,windowPeriod:e}]},perpsPortfolio(t,e){return[ge,`${ye}:perps-portfolio`,{windowPeriod:t,userId:e}]},perpsProfile(t,e,r){return[ge,`${ye}:perps-profile`,{profileId:t,openLimit:e,closedLimit:r}]},fungiblesPortfolio(t,e){return[ge,`${ye}:fungibles-portfolio`,{profileId:t,limit:e}]},chatBlockList(t){return[ge,`${ye}:chat-block-list`,{userId:t}]}};var T0=a((t,e)=>{let r=b0(e.id);r&&t.setQueryData(br.actor(r),e)},"setActorInQueryCache");var E0=a(async(t,e)=>{let r=e?.startsWith("@")?e.slice(1):e;if(!r)throw new Error("No sanitized username or user profile id");let n=await t.getUserProfileByUsernameOrUserProfileId(r);if(!n)throw new Error("No user profile");return n},"getUserProfileByUsernameOrUserProfileIdQueryFn");function HR({usernameOrUserProfileId:t}){let e=Tf(),r=br.userProfileByUsernameOrUserProfileId(t);return ne({enabled:!!t,queryKey:r,queryFn:a(async()=>E0(e,t),"queryFn"),gcTime:Ti,staleTime:Qp})}a(HR,"useGetUserProfileByUsernameOrUserProfileId");function GR({query:t}){let e=Pe(),r=t?.startsWith("@")?t.slice(1).trim():t.trim(),n=br.searchForActor(r),s=a(async()=>{let{actors:o}=await w0(r);for(let c of o)T0(e,c);return o.sort((c,d)=>c.isFollowing?-1:d.isFollowing?1:0),{actors:o}},"queryFn");return $i({enabled:r.length>1,queryKey:n,queryFn:s,gcTime:Ti,staleTime:Qp})}a(GR,"useSearchForActor");u();l();u();l();u();l();var A0;(function(t){t.BID="B",t.ASK="A"})(A0||(A0={}));var x0;(function(t){t.OPEN="open",t.FILLED="filled",t.CANCELED="canceled",t.TRIGGERED="triggered",t.REJECTED="rejected",t.MARGIN_CANCELED="margin_canceled"})(x0||(x0={}));var He=i.string().regex(/^(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?$/,"Invalid numeric string"),it=i.string().regex(/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?$/,"Invalid signed numeric string");var eo=Jm.extend({chainId:Hm,address:i.string()}),I0=i.object({tokenIndex:i.number(),pairIndex:i.number()}),Ai=i.object({symbol:i.string(),name:i.string(),token:eo,logoUri:i.string(),szDecimals:i.number(),maxLeverage:i.number(),price:it,priceChange24h:i.object({amount:it,percentage:it}),volume24h:He,openInterest:He,fundingRate:it,assetId:i.number(),isAtOpenInterestCap:i.boolean().optional(),description:i.string().optional(),collateralToken:I0.optional()}),k0=i.object({markets:i.array(Ai).transform(t=>t.reduce((e,r)=>{let n=Ai.safeParse(r);return n.success&&(e[D(n.data.token)]=n.data),e},{}))}),wye=i.object({id:i.string(),name:i.string(),logoUri:i.string(),currentPrice:i.number(),maxLeverage:i.number(),szDecimals:i.number(),assetId:i.number(),symbol:i.string(),collateralToken:I0.optional()});u();l();var Xt="perps",to={historicalOrders:a((t,e)=>[Xt,"historical-orders",t,e],"historicalOrders"),market:a(t=>[Xt,"market",t],"market"),markets:a(t=>[Xt,"markets",t.sort()],"markets"),defaultLeverage:a(()=>[Xt,"default-leverage"],"defaultLeverage"),assetLeverage:a(()=>[Xt,"asset-leverage"],"assetLeverage"),permissions:a(()=>[Xt,"config"],"permissions"),fungibleToPerpMap:a(()=>[Xt,"fungible-to-perp-map"],"fungibleToPerpMap"),fundsInTransitBanner:a(t=>[Xt,"funds-in-transit-banner",t],"fundsInTransitBanner"),fundsInTransitBannerDismissed:a(()=>[Xt,"funds-in-transit-banner-dismissed"],"fundsInTransitBannerDismissed"),getStartedCardDismissed:a(()=>[Xt,"get-started-card-dismissed"],"getStartedCardDismissed"),learnItems:a(()=>[Xt,"learn-items"],"learnItems"),orderbook:a(t=>[Xt,"orderbook",t.toUpperCase()],"orderbook")};u();l();var VR={perp:6,spot:8};function C0(t,e,r="perp",n=b.ROUND_HALF_UP){let s=new b(t);if(s.isInteger())return s.toString();let o=VR[r],c=Math.max(o-e,0);return s.precision(5,n).toFixed(c,n).replace(/(\.\d*[1-9])0+$|\.0+$/,"$1")}a(C0,"formatUiPrice");var _0=K({days:1}),F0=K({minutes:5}),$R=a(async t=>{if(!t)return null;try{return(await P0([t]))[t]??null}catch(e){throw E.addBreadcrumb(I.Perps,"Failed to get perp market",F.Error,{caip19:t,error:e instanceof Error?e.message:"Unknown error"}),e}},"getPerpMarketQueryFn");function jR(t){return{enabled:!!t,queryKey:to.market(t),gcTime:_0,staleTime:F0,queryFn:a(()=>$R(t),"queryFn")}}a(jR,"getPerpMarketQueryOptions");var KR=a(t=>ne(jR(t)),"useGetPerpMarket"),Hp=a((t,e=!1)=>ne({enabled:t.length>0,queryKey:to.markets(t),gcTime:_0,staleTime:F0,async queryFn(){try{return await P0(t,e)}catch(r){throw E.addBreadcrumb(I.Perps,"Failed to get perp markets",F.Error,{caip19s:t.join(","),error:r instanceof Error?r.message:"Unknown error"}),r}}}),"useGetPerpMarkets");async function P0(t,e=!1){let r=await H.api().get("/swap/v2/perp/markets",{params:{tokens:t.join(",")}});if(!ee(r))throw new Error("Failed to get perp markets: response is not okay");let n=r.data,s=k0.safeParse(n);if(!s.success)throw new Error("Failed to get perp markets: schema validation failed");if(e){let o=s.data.markets,c={};for(let[d,m]of Object.entries(o))c[d]={...m,price:C0(m.price,m.szDecimals),priceChange24h:{...m.priceChange24h,percentage:String(Number(m.priceChange24h.percentage)/100)}};return c}return s.data.markets}a(P0,"getPerpMarkets");u();l();u();l();u();l();async function v0(t){let e=await H.api().bearer(!0).headers({Accept:"application/activity+json"}).get(`/v1/actors/${t}`);if(!ee(e)){let n=new Error(Ys({name:"getActor",response:e,target:t}));throw E.captureError(n,I.Profiles),n}let r=tr.safeParse(e.data);if(r.success)return r.data;{let n=new Error(y0({name:"getActor",error:r.error,target:t}));throw E.captureError(n,I.Profiles),n}}a(v0,"getActor");function Gp(t,e=!0){let r=a(async()=>{if(!t)throw new Error("No profile ID or access token");return v0(t)},"queryFn");return $i({queryKey:br.actor(t),queryFn:r,enabled:e&&!!t,gcTime:Ti,staleTime:Wb})}a(Gp,"useGetActor");u();l();u();l();var WR=i.object({name:i.string(),shortName:i.string()}).passthrough(),ZR=i.object({type:i.string(),eventTicker:i.string(),ui:WR}).passthrough(),XR=i.enum(["YES","NO"]).transform(t=>t.toLowerCase()),JR=i.object({outcome:XR,size:i.coerce.number(),platformData:ZR,signature:i.string().optional(),time:i.string().optional(),activityType:i.enum(["BUY","SELL","synthesizedResolvedLost"]),escrowMintAmount:i.coerce.number().optional(),escrowMintAddress:i.string().optional(),outputMintAmount:i.number().optional(),outputMintAddress:i.string().optional(),exposure:i.coerce.number().optional()}).passthrough(),R0=i.object({activities:i.array(JR),offset:i.number().optional()}).passthrough();u();l();var YR=i.object({timestamp:i.number(),price:i.number(),volume:i.number().optional()}),uwe=i.object({marketId:i.string(),prices:i.array(YR)}),D0=i.object({price:i.number(),shares:i.number(),total:i.number()}),lwe=i.object({marketId:i.string(),yes:i.array(D0),no:i.array(D0)}),e1=i.enum(["1-critical-alert","2-alert","3-critical-error","4-error","5-information","6-notice","7-confirmation"]),Vp=i.object({text:i.string(),level:e1}),N0=i.object({feedBanner:Vp.optional(),eventBanner:Vp.optional(),marketBanners:i.record(i.string(),Vp).optional()});u();l();u();l();var $p=i.object({marketLedger:i.string(),yesMint:i.string(),noMint:i.string(),isInitialized:i.boolean()}),t1=i.object({ticker:i.string(),eventTicker:i.string(),marketType:i.string(),title:i.string(),subtitle:i.string().optional(),yesSubTitle:i.string(),noSubTitle:i.string(),openTime:i.number(),closeTime:i.number(),expirationTime:i.number(),status:i.string(),volume:i.number(),result:i.string().nullish().default(null),openInterest:i.number(),canCloseEarly:i.boolean(),earlyCloseCondition:i.string().optional(),rulesPrimary:i.string(),rulesSecondary:i.string().optional(),accounts:i.record(i.string(),$p)}),hwe=i.object({markets:i.array(t1),cursor:i.string().nullish().default(null)});u();l();var jp=i.object({backgroundColor:i.string(),textColor:i.string(),translucentBackgroundColor:i.string(),actionButtonColor:i.string().optional(),actionButtonTextColor:i.string().optional(),name:i.string(),shortName:i.string(),subtitle:i.string(),imageUrl:i.string().nullish().default(null).optional().transform(t=>t??void 0),competitionType:i.string().nullish().transform(t=>t??void 0),binaryOutcomeColors:i.object({yes:i.object({backgroundColor:i.string(),textColor:i.string()}),no:i.object({backgroundColor:i.string(),textColor:i.string()})}).optional()}),r1=i.object({enabled:i.literal(!1),reason:i.enum(["noLiquidity","buysDisabled"])}),B0=i.discriminatedUnion("enabled",[i.object({enabled:i.literal(!0)}),r1]),n1=i.object({label:i.string(),price:i.number().optional(),chance:i.number().optional(),bestBid:i.number().optional(),bestAsk:i.number().optional(),binaryType:i.enum(["yes","no"]).optional()}),s1=i.object({id:i.string(),title:i.string(),subtitle:i.string().optional(),slug:i.string().optional(),image:i.string().optional(),status:i.string(),outcomes:i.array(n1),startTime:i.string().optional(),endDate:i.string(),volume:i.number(),volume24h:i.number().optional(),liquidity:i.number(),openInterest:i.number().optional(),dflowAccounts:i.record(i.any()).optional(),custom_strike:i.record(i.any()).optional(),ui:jp.optional()}),o1=i.object({type:i.string()}).passthrough(),L0=i.object({id:i.string(),title:i.string(),subtitle:i.string().optional(),description:i.string().optional(),category:i.string(),image:i.string().optional(),icon:i.string().optional(),startDate:i.string(),endDate:i.string(),active:i.boolean(),closed:i.boolean(),markets:i.array(s1),volume:i.number(),volume24h:i.number(),liquidity:i.number(),openInterest:i.number().optional(),live:i.boolean().optional(),ended:i.boolean().optional(),score:i.string().optional(),elapsed:i.string().optional(),period:i.string().optional(),platformData:o1,product_metadata:i.object({competition:i.string().optional()}).passthrough().optional()}),Twe=i.object({events:i.array(L0),nextKalshiCursor:i.string().optional()}),Ewe=L0.extend({subcategory:i.string().optional(),featuredImage:i.string().optional(),resolutionSource:i.string().optional(),creationDate:i.string().optional(),closedTime:i.string().optional(),archived:i.boolean().optional(),new:i.boolean().optional(),featured:i.boolean().optional(),restricted:i.boolean().optional(),volume1wk:i.number().optional(),volume1mo:i.number().optional(),volume1yr:i.number().optional(),liquidityAmm:i.number().optional(),liquidityClob:i.number().optional(),commentsEnabled:i.boolean().optional(),commentCount:i.number().optional(),competitive:i.number().optional(),tags:i.array(i.object({id:i.string(),label:i.string()})).optional(),categories:i.array(i.object({id:i.string(),label:i.string()})).optional(),collections:i.array(i.object({id:i.string(),title:i.string(),slug:i.string()})).optional(),series:i.array(i.object({id:i.string(),title:i.string(),ticker:i.string(),slug:i.string()})).optional(),subEvents:i.array(i.string()).optional(),parentEvent:i.string().optional(),createdBy:i.string().optional(),updatedBy:i.string().optional(),createdAt:i.string().optional(),updatedAt:i.string().optional(),publishedAt:i.string().optional()}).passthrough();var i1=i.discriminatedUnion("type",[i.object({type:i.literal("open")}),i.object({type:i.literal("claimable")}),i.object({type:i.literal("pending")}),i.object({type:i.literal("resolved"),result:i.enum(["won","lost"])})]),a1=i.object({marketId:i.string(),marketTitle:i.string(),eventId:i.string(),outcome:i.enum(["YES","NO"]).transform(t=>t.toLowerCase()),endDate:i.string(),size:i.number(),exposure:i.number().nullish().transform(t=>t??void 0),currentValue:i.number().nullish().transform(t=>t??void 0),platformData:i.object({type:i.literal("kalshi"),mint:i.string(),position:i.enum(["YES","NO"]),marketTicker:i.string(),eventTicker:i.string(),accounts:i.record(i.string(),$p),isLive:i.boolean(),eventStartDate:i.string().optional(),marketTitle:i.string(),marketSubtitle:i.string().optional(),status:i1,marketResult:i.enum(["yes","no"]).optional(),marketAvailability:B0.optional(),ui:jp.optional()}),lastUpdated:i.string()}),O0=i.object({positions:i.array(a1)});u();l();var U0=i.object({wonResolvedCount:i.number(),totalResolvedCount:i.number(),totalPnl:i.number(),volume:i.number()}).passthrough();u();l();var $n;(function(t){t.Kalshi="kalshi",t.Polymarket="polymarket"})($n||($n={}));var M0;(function(t){t.Volume="volume",t.Volume24hr="volume24hr",t.StartTime="startTime",t.EventDate="eventDate"})(M0||(M0={}));var q0;(function(t){t.Sports="Sports",t.Politics="Politics",t.Finance="Finance",t.Crypto="Crypto",t.Earnings="Earnings",t.Tech="Tech",t.World="World",t.Economy="Economy",t.Elections="Elections",t.Mentions="Mentions",t.Culture="Pop-Culture",t.Geopolitics="Geopolitics",t.Entertainment="Entertainment",t.Health="Health",t.ScienceAndTechnology="Science and Technology",t.Social="Social",t.Transportation="Transportation",t.Companies="Companies",t.ClimateAndWeather="Climate and Weather",t.Financials="Financials",t.Economics="Economics"})(q0||(q0={}));var z0;(function(t){t.Soccer="Soccer",t.Basketball="Basketball",t.Football="Football",t.Baseball="Baseball",t.Hockey="Hockey",t.Tennis="Tennis",t.Golf="Golf",t.Boxing="Boxing",t.Mma="MMA",t.Esports="Esports",t.Motorsports="Motorsports",t.Cricket="Cricket",t.Chess="Chess",t.Weekly="Weekly",t.Recurring="Recurring",t.Stocks="Stocks",t.Equities="Equities",t.Daily="Daily",t.UpOrDown="Up or Down",t.Earnings="Earnings",t.Indicies="Indicies",t.Commodities="Commodities",t.Forex="Forex",t.Acquisitions="Acquisitions",t.Ipos="Ipos",t.FedRate="Fed Rate",t.Treasuries="Treasuries",t.Bitcoin="Bitcoin",t.Ethereum="Ethereum",t.Solana="Solana"})(z0||(z0={}));var c1="http://localhost:3017/predictions",u1="/predictions",Je=a(()=>u1,"getBasePath"),Ye=a(()=>{let t=H.api(),e=L.language;return e?t.headers({"Accept-Language":e}):t},"getRequestBuilder"),Cu=class{static{a(this,"BackendPredictionsClient")}async getEvents(e){try{let n=(await Ye().get(`${Je()}/v2/events`,{params:e})).data;if(n&&(n.error||n.statusCode)&&!n.events)throw console.error("[BackendPredictionsClient] getEvents received error response:",n),new Error(n.message||n.error||"Failed to fetch events");return n}catch(r){throw console.error("[BackendPredictionsClient] getEvents failed:",r),r}}async getEvent(e,r=$n.Kalshi){try{let s=(await Ye().get(`${Je()}/v2/event/${r}/${e}`)).data;if(s&&(s.error||s.statusCode))throw console.error(`[BackendPredictionsClient] getEvent received error response for ${e}:`,s),new Error(s.message||s.error||"Failed to fetch event");return s}catch(n){throw console.error(`[BackendPredictionsClient] getEvent failed for ${e} on ${r}:`,n),n}}async getMarket(e,r){try{return(await Ye().get(`${Je()}/v2/market/${e}/${r}`)).data}catch(n){throw console.error(`[BackendPredictionsClient] getMarket failed for ${r}:`,n),n}}async searchEvents(e){try{let n=(await Ye().get(`${Je()}/v2/events/search`,{params:e})).data;if(n&&(n.error||n.statusCode)&&!n.events)throw console.error("[BackendPredictionsClient] searchEvents received error response:",n),new Error(n.message||n.error||"Failed to search events");return n}catch(r){throw console.error("[BackendPredictionsClient] searchEvents failed:",r),r}}async getHistoricalPrices(e,r,n){try{return(await Ye().get(`${Je()}/v2/historical-prices/${e}/${r}`,{params:n})).data}catch(s){throw console.error(`[BackendPredictionsClient] getHistoricalPrices failed for ${r}:`,s),s}}async getOrderbook(e,r,n){try{return(await Ye().get(`${Je()}/v2/orderbook/${e}/${r}`,{params:n})).data}catch(s){throw console.error(`[BackendPredictionsClient] getOrderbook failed for ${r}:`,s),s}}async getPositions({address:e,venue:r,status:n,forceRefresh:s}){try{let o={user:e,status:n};s&&(o["force-refresh"]="true");let c=await Ye().get(`${Je()}/v2/positions/${r}`,{params:o});return!c||!c.data?{positions:[]}:O0.parse(c.data)}catch(o){throw console.error("[BackendPredictionsClient] getPositions failed:",o),o}}async getActivities(e){try{return(await Ye().get(`${Je()}/v2/activities`,{params:e})).data}catch(r){throw console.error("[BackendPredictionsClient] getActivities failed:",r),r}}async getUserActivities({address:e,venue:r,limit:n,offset:s}){try{let o={user:e,venue:r,includeLossTokens:"true",...n!==void 0&&{limit:n},...s!==void 0&&{offset:s}},c=await Ye().get(`${Je()}/v2/user-activities`,{params:o});return R0.parse(c.data)}catch(o){throw console.error("[BackendPredictionsClient] getUserActivities failed:",o),o}}async getActiveOrders(e){try{return(await Ye().get(`${Je()}/v2/active-orders`,{params:e})).data}catch(r){throw console.error("[BackendPredictionsClient] getActiveOrders failed:",r),r}}async getTabs(e){try{let n=e??!1?{test:"true"}:void 0;return(await Ye().get(`${Je()}/v2/tabs`,{params:n})).data}catch(r){throw console.error("[BackendPredictionsClient] getTabs failed:",r),r}}async getPortfolio(){try{return(await Ye().get(`${Je()}/v2/portfolio`)).data}catch(e){throw console.error("[BackendPredictionsClient] getPortfolio failed:",e),e}}async getUserStats({address:e,venue:r}){try{let n=await Ye().get(`${Je()}/v2/user-stats`,{params:{user:e,venue:r}});return U0.parse(n.data)}catch(n){throw console.error("[BackendPredictionsClient] getUserStats failed:",n),n}}async getTrades(e,r,n,s){try{return(await Ye().get(`${Je()}/v2/trades/${e}`,{params:{marketTickers:r.join(","),limit:n,after_ts:s}})).data}catch(o){throw console.error(`[BackendPredictionsClient] getTrades failed for ${e}:`,o),o}}async getForecastHistory(e,r,n){try{let s={start_ts:n.start_ts,period_interval:n.period_interval,candlestick_function:n.candlestick_function};return n.end_ts!==null&&(s.end_ts=n.end_ts),(await Ye().get(`${Je()}/v2/forecast-history/${e}/${r}`,{params:s})).data}catch(s){throw console.error(`[BackendPredictionsClient] getForecastHistory failed for ${r}:`,s),s}}async getScoreV3(e,r){try{return(await Ye().get(`${Je()}/v2/score/${e}/${r}`)).data}catch(n){throw console.error("[BackendPredictionsClient] getScoreV3 failed:",n),n}}async getHomeFeaturedItems(){try{return(await Ye().get(`${Je()}/v2/home-featured-items`)).data}catch(e){throw console.error("[BackendPredictionsClient] getHomeFeaturedItems failed:",e),e}}async getFeed(){try{return(await Ye().get(`${Je()}/v2/feed`)).data}catch(e){throw console.error("[BackendPredictionsClient] getFeed failed:",e),e}}async getBanners(e){try{let r=e?Object.fromEntries(Object.entries(e).filter(([s,o])=>o!==void 0)):void 0,n=await Ye().get(`${Je()}/v2/banners`,{params:r});return N0.parse(n.data)}catch(r){return console.error("[BackendPredictionsClient] getBanners failed:",r),{}}}MARKET_MINT_DECIMALS=6;async postOptimisticPosition(e,r,n){let s=await this.getMarket($n.Kalshi,n),o=new b(e.outAmount).shiftedBy(-this.MARKET_MINT_DECIMALS).toNumber(),c=s.platformData;if(c.type!==$n.Kalshi)throw new Error("Only Kalshi markets are supported");let d=s.dflowAccounts,m=s.outcomes.find(p=>p.binaryType===r)?.price;return{marketId:s.id,marketTitle:s.title,eventId:c.eventTicker,outcome:r,endDate:s.endDate,size:o,exposure:m?o*m:void 0,platformData:{type:$n.Kalshi,mint:e.outputMint,position:r==="yes"?"YES":"NO",marketTicker:c.ticker,eventTicker:c.eventTicker,accounts:d??{},isLive:!1,eventStartDate:s.startTime,marketTitle:s.title,marketSubtitle:s.ui?.name??s.subtitle,status:{type:"open"},marketAvailability:s.marketAvailability,ui:s.ui},lastUpdated:new Date().toISOString()}}async getHub({hubId:e}){let r=await Ye().get(`${Je()}/v2/hub/${e}`);if(!ee(r))throw new Error(`[BackendPredictionsClient] getHub failed with status ${r.status}`);return r.data}};u();l();u();l();u();l();u();l();u();l();var X0=U(Z0(),1),J0=X0.default;var h1=J0.bind({concatArrays:!0,ignoreUndefined:!0});function g1(t,e){let r=self.localStorage.getItem(t);if(r){let n=JSON.parse(r),s=JSON.parse(e),o=JSON.stringify(h1(n,s));self.localStorage.setItem(t,o)}else self.localStorage.setItem(t,e)}a(g1,"mergeLocalStorageItem");function so(t,e){return new Promise((r,n)=>{try{let s=t();e?.(null,s),r(s)}catch(s){e?.(s),n(s)}})}a(so,"createPromise");function Pu(t,e,r){return Promise.all(t).then(n=>{let s=r?.(n)??null;return e?.(null,s),Promise.resolve(s)},n=>(e?.(n),Promise.reject(n)))}a(Pu,"createPromiseAll");var xi={getItem:a((t,e)=>so(()=>self.localStorage.getItem(t),e),"getItem"),setItem:a((t,e,r)=>so(()=>self.localStorage.setItem(t,e),r),"setItem"),removeItem:a((t,e)=>so(()=>self.localStorage.removeItem(t),e),"removeItem"),mergeItem:a((t,e,r)=>so(()=>g1(t,e),r),"mergeItem"),clear:a(t=>so(()=>self.localStorage.clear(),t),"clear"),getAllKeys:a(t=>so(()=>{let e=self.localStorage.length,r=[];for(let n=0;n<e;n+=1){let s=self.localStorage.key(n)||"";r.push(s)}return r},t),"getAllKeys"),flushGetRequests:a(()=>{},"flushGetRequests"),multiGet:a((t,e)=>{let r=t.map(s=>xi.getItem(s));return Pu(r,e,a(s=>s.map((o,c)=>[t[c],o]),"processResult"))},"multiGet"),multiSet:a((t,e)=>{let r=t.map(n=>xi.setItem(n[0],n[1]));return Pu(r,e)},"multiSet"),multiRemove:a((t,e)=>{let r=t.map(n=>xi.removeItem(n));return Pu(r,e)},"multiRemove"),multiMerge:a((t,e)=>{let r=t.map(n=>xi.mergeItem(n[0],n[1]));return Pu(r,e)},"multiMerge")},Wp=xi;u();l();var Y0=Wp;u();l();var y1=Object.defineProperty,eT=Object.getOwnPropertySymbols,w1=Object.prototype.hasOwnProperty,S1=Object.prototype.propertyIsEnumerable,tT=a((t,e,r)=>e in t?y1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,"__defNormalProp"),oo=a((t,e)=>{for(var r in e||(e={}))w1.call(e,r)&&tT(t,r,e[r]);if(eT)for(var r of eT(e))S1.call(e,r)&&tT(t,r,e[r]);return t},"__spreadValues"),vu=a(t=>e=>{try{let r=t(e);return r instanceof Promise?r:{then(n){return vu(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return vu(n)(r)}}}},"toThenable"),rT=a((t,e)=>(r,n,s)=>{let o=oo({getStorage:a(()=>localStorage,"getStorage"),serialize:JSON.stringify,deserialize:JSON.parse,partialize:a(T=>T,"partialize"),version:0,merge:a((T,_)=>oo(oo({},_),T),"merge")},e);(o.blacklist||o.whitelist)&&console.warn(`The ${o.blacklist?"blacklist":"whitelist"} option is deprecated and will be removed in the next version. Please use the 'partialize' option instead.`);let c=!1,d=new Set,m=new Set,p;try{p=o.getStorage()}catch{}if(p)p.removeItem||console.warn(`[zustand persist middleware] The given storage for item '${o.name}' does not contain a 'removeItem' method, which will be required in v4.`);else return t((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...T)},n,s);let f=vu(o.serialize),g=a(()=>{let T=o.partialize(oo({},n()));o.whitelist&&Object.keys(T).forEach(P=>{var v;!((v=o.whitelist)!=null&&v.includes(P))&&delete T[P]}),o.blacklist&&o.blacklist.forEach(P=>delete T[P]);let _,k=f({state:T,version:o.version}).then(P=>p.setItem(o.name,P)).catch(P=>{_=P});if(_)throw _;return k},"setItem"),w=s.setState;s.setState=(T,_)=>{w(T,_),g()};let y=t((...T)=>{r(...T),g()},n,s),S,x=a(()=>{var T;if(!p)return;c=!1,d.forEach(k=>k(n()));let _=((T=o.onRehydrateStorage)==null?void 0:T.call(o,n()))||void 0;return vu(p.getItem.bind(p))(o.name).then(k=>{if(k)return o.deserialize(k)}).then(k=>{if(k)if(typeof k.version=="number"&&k.version!==o.version){if(o.migrate)return o.migrate(k.state,k.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return k.state}).then(k=>{var P;return S=o.merge(k,(P=n())!=null?P:y),r(S,!0),g()}).then(()=>{_?.(S,void 0),c=!0,m.forEach(k=>k(S))}).catch(k=>{_?.(void 0,k)})},"hydrate");return s.persist={setOptions:a(T=>{o=oo(oo({},o),T),T.getStorage&&(p=T.getStorage())},"setOptions"),clearStorage:a(()=>{var T;(T=p?.removeItem)==null||T.call(p,o.name)},"clearStorage"),rehydrate:a(()=>x(),"rehydrate"),hasHydrated:a(()=>c,"hasHydrated"),onHydrate:a(T=>(d.add(T),()=>{d.delete(T)}),"onHydrate"),onFinishHydration:a(T=>(m.add(T),()=>{m.delete(T)}),"onFinishHydration")},x(),S||y},"persist");var b1=10,nT={chatJoinTimestamps:new Map,chatHistory:[]},T1=ft(rT((t,e)=>({...nT,recordChatJoin:a(r=>{t(n=>{let s=new Map(n.chatJoinTimestamps);return s.set(r,Date.now()),{chatJoinTimestamps:s}})},"recordChatJoin"),recordChatLeave:a(r=>{t(n=>{let s=new Map(n.chatJoinTimestamps);return s.delete(r),{chatJoinTimestamps:s}})},"recordChatLeave"),recordChatMessage:a((r,n)=>{t(s=>({chatHistory:[{chatId:r,chatType:n,lastMessageTimestamp:Date.now()},...s.chatHistory.filter(d=>d.chatId!==r)].slice(0,b1)}))},"recordChatMessage"),clearChatHistory:a(()=>{t(r=>({...r,chatHistory:[]}))},"clearChatHistory"),removeChatFromHistory:a(r=>{t(n=>({...n,chatHistory:n.chatHistory.filter(s=>s.chatId!==r)}))},"removeChatFromHistory"),reset:a(()=>t(nT),"reset")}),{name:"chat-activity",getStorage:a(()=>Y0,"getStorage"),partialize:a(t=>({chatHistory:t.chatHistory}),"partialize"),version:2,migrate(t,e){if(e===0){let r=t.chatHistory.map(n=>({chatId:n.chatId,chatType:n.chatId.startsWith("hypercore")?Ei.Perps:Ei.Token,lastMessageTimestamp:n.lastJoinedTimestamp??0}));return{...t,chatHistory:r}}if(e===1){let r=t.chatHistory.map(n=>({chatId:n.chatId,chatType:n.chatType,lastMessageTimestamp:n.lastJoinedTimestamp??0}));return{...t,chatHistory:r}}return t}})),sT=a(t=>T1.getState().chatJoinTimestamps.get(t),"getChatJoinTimestamp");var Zp=a(async({chatTokenId:t,transactionId:e,networkId:r,tokenBoughtCaip19:n,tokenBoughtAmount:s,tokenBoughtUsdValue:o,tokenSoldCaip19:c,tokenSoldAmount:d,tokenSoldUsdValue:m,walletCaip19:p,chatTokenBalance:f,system:g})=>{if(!sT(t))return;let y=await H.api().bearer(!0).post("/social/v1/events/trades",{chatTokenId:t,networkId:r,tokenBoughtCaip19:n,tokenBoughtAmount:s,tokenBoughtUsdValue:o,tokenSoldCaip19:c,tokenSoldAmount:d,tokenSoldUsdValue:m,transactionId:e,walletCaip19:p,chatTokenBalance:f,system:g});if(!ee(y)){let S=new Error(Ys({name:"publishSystemChatTradeMessage",response:y}));throw E.captureError(S,I.Chat),S}},"publishSystemChatTradeMessage");u();l();var oT=a(t=>{let e={followers:t?.followers&&typeof t.followers=="object"&&t?.followers?.totalItems||0,following:t?.following&&typeof t.following=="object"&&t?.following?.totalItems||0};return{...e,formattedFollowers:ts(e.followers||0,{compact:!0}),formattedFollowing:ts(e.following||0,{compact:!0})}},"getFollowersAndFollowingCount"),E1=a(t=>{let{data:e}=Gp(t);return oT(e)},"useFollowersAndFollowingCount");u();l();var iT=U($());var A1=a(async(t,e,r)=>{try{await H.api().post("/swap/v2/presence",{caip19:t,visitorId:e,source:r})}catch(n){throw n instanceof Error&&E.captureError(n,I.Swapper),n}},"postTokenPresence"),x1=a((t,e)=>{let r=Se(),n=At("enable-swapper-presence"),s=(0,iT.useCallback)(async()=>{if(!t||!n)return null;let o=await r.getDeviceId();return await A1(t,o,e),{success:!0,timestamp:Date.now()}},[t,e,r,n]);return ne({queryKey:[...pe.presence(t),"post",e],queryFn:s,enabled:!!t&&n,refetchInterval:5e3,gcTime:0,staleTime:0})},"usePostTokenPresence");u();l();u();l();var cT=U($());u();l();var I1=1500,Ru=class{static{a(this,"ActivitiesSwapStateListener")}uiContext;showActivity;constructor(e,r){this.uiContext=e,this.showActivity=r}onStateChange(e,r,n,s){if(this.uiContext!=="swapperClassic")return;let{sell:o,buy:c}=n.executingQuote,d=ht(o.data.chain.id,c.data.chain.id),m=e.type===X.TransactionConfirmationStarted&&A.isBitcoinNetworkID(o.data.chain.id),p=e.type===X.TransactionConfirmed&&A.isBitcoinNetworkID(c.data.chain.id);d&&(m||p)&&setTimeout(()=>{this.showActivity()},I1)}};u();l();var Du=class{static{a(this,"CashSwapStateListener")}queryClient;storage;authRepository;cashAccount;constructor(e,r,n,s){this.queryClient=e,this.storage=r,this.authRepository=n,this.cashAccount=s}onStateChange(e,r,n,s){if(e.type===X.TransactionConfirmed){let{sell:o,buy:c,quote:d}=n.executingQuote,m=new V(d.sellAmount),p=new V(d.buyAmount);md({queryClient:this.queryClient,storage:this.storage,authRepository:this.authRepository,sellCaip19:Y(o),sellAmountBN:m,sellAddress:o.data.walletAddress,buyCaip19:Y(c),buyAmountBN:p,buyAddress:c.data.walletAddress,cashAccountAddress:this.cashAccount?.addressDetails.address})}}};u();l();var Nu=class{static{a(this,"FailedCashSwapExecuteSwapStateListener")}authRepository;constructor(e){this.authRepository=e}onStateChange(e,r,n,s){let{executingQuote:o}=n,{sell:c,buy:d}=o;if(!(!Ne(c)&&!Ne(d)))switch(e.type){case X.SimulationFailed:E.addBreadcrumb(I.Cash,"Cash swap simulation failure detected, recording...",F.Info,{sellToken:c.data.symbol,buyToken:d.data.symbol}),this.recordFailure(o,"simulation",e.error,e.executionId);break;case X.TransactionSubmissionFailed:E.addBreadcrumb(I.Cash,"Cash swap submission failure detected, recording...",F.Info,{sellToken:c.data.symbol,buyToken:d.data.symbol}),this.recordFailure(o,"submission",e.error,e.executionId);break}}async recordFailure(e,r,n,s){try{let o=await this.authRepository?.getUser();if(!o){E.addBreadcrumb(I.Cash,"Cannot record failed cash swap: user not found",F.Info);return}let{accessToken:c,userID:d}=o,m=e.sell,p=e.buy,f=e.quote,g=e.quoteInput,w=m.data.walletAddress,y=p.data.walletAddress;if(!w&&g?.taker){let _=je(g.taker);_.resourceType===W.address&&(w=_.address)}if(!y&&g?.takerDestination){let _=je(g.takerDestination);_.resourceType===W.address&&(y=_.address)}let S={type:In.Swap,input:{owner:w,mint:m.data.tokenAddress??"",amount:f.sellAmount,symbol:m.data.symbol??void 0,name:m.data.name??void 0,decimals:m.data.decimals,logoUri:m.data.logoUri??void 0},output:{owner:y,mint:p.data.tokenAddress??"",amount:f.buyAmount,symbol:p.data.symbol??void 0,name:p.data.name??void 0,decimals:p.data.decimals,logoUri:p.data.logoUri??void 0},quoteId:f.rfqProps?.quoteId,quoteSource:Le(f).map(_=>_.name).join(",")},x=m.data.chain.id,T=n?.message||n?.type||"Unknown error";await yd({accessToken:c,userID:d,idempotencyKey:s,swapInfo:S,chainId:x,failureReason:T,skipNotification:!0,occurredAt:new Date().toISOString()}),E.addBreadcrumb(I.Cash,"Recorded failed cash swap",F.Info,{failureType:r,sellToken:m.data.symbol,buyToken:p.data.symbol})}catch(o){E.addBreadcrumb(I.Cash,"Failed to record failed cash swap",F.Error,o instanceof Error?{error:o.message}:{})}}};u();l();var Bu=class{static{a(this,"SocialExecuteSwapStateListener")}swapMode;queryClient;constructor(e,r){this.swapMode=e,this.queryClient=r}onStateChange(e,r,n,s){if(e.type===X.TransactionConfirmed){let{buy:o,sell:c,quote:d,account:m}=n.executingQuote,p=o.data.chain.id,f=m.addresses.find(g=>g.networkID===p);if(f){let g=Y(o),w=Y(c),y=Re(d.buyAmount,o.data.decimals).toNumber(),S=Re(d.sellAmount,c.data.decimals).toNumber(),x=D({chainId:f.networkID,address:f.address,resourceType:W.address}),T=this.swapMode.type==="buy"?D(g):D(w),k=this.queryClient.getQueryData(bf.userProfile())?.id??"",P=this.queryClient.getQueryData(br.tokenChatBalance(T,k)),v=0;P&&(v=P.quantity>0?P.quantity/10**P.decimals:0),Zp({chatTokenId:T,transactionId:e.txReceipt.id,networkId:e.txReceipt.networkID,tokenBoughtCaip19:D(g),tokenBoughtAmount:y,tokenBoughtUsdValue:o.data.price?y*o.data.price:0,tokenSoldCaip19:D(w),tokenSoldAmount:S,tokenSoldUsdValue:c.data.price?S*c.data.price:0,walletCaip19:x,chatTokenBalance:v,system:{messages:["trades"]}})}}}};var aT=a(()=>{},"noop"),S0e=a(t=>{let e=Nt(),{connection:r}=tn(),n=Ke(),s=jr(),o=L.language,c=Se(),d=Pe(),m=Vs(),p=Gt(),f=Wr(),g=Yn("kill-swapper-simulation")??!1,{data:w}=Ro();return(0,cT.useCallback)(async({showFungibleDetails:y,showBuyFungibleScreen:S=aT,showRetrySwap:x,showActivity:T=aT,swapMode:_,executeSwapStateListeners:k,toastMessageParser:P,uiContext:v="swapperInterstitial",preprocessor:z})=>{let Q=new Hs(y,S,p,[Ee.SlippageExceeded],x,P),R=new Ms(d,n,f),G=new Du(d,n,f,w),M=new Us(m,c,v,t),C=new qs(c),N=new zs,Z=new Os(mn),oe=new Bu(_,d),re=new Nu(f),J=new Ru(v,T);try{e.subscribeExecution(R),e.subscribeExecution(G),e.subscribeExecution(C),e.subscribeExecution(M),e.subscribeExecution(Q),e.subscribeExecution(N),e.subscribeExecution(Z),e.subscribeExecution(re),e.subscribeExecution(J),pt&&e.subscribeExecution(oe),k.forEach(xe=>e.subscribeExecution(xe));let Ge=await c.getDeviceId();await e.swap({signer:s,storage:n,locale:o,deviceId:Ge,connection:r,authRepository:f,isSimulationKilled:g,preprocessor:z})}catch{}finally{e.unsubscribeExecution(R),e.unsubscribeExecution(G),e.unsubscribeExecution(C),e.unsubscribeExecution(M),e.unsubscribeExecution(Q),e.unsubscribeExecution(N),e.unsubscribeExecution(Z),e.unsubscribeExecution(re),e.unsubscribeExecution(oe),e.unsubscribeExecution(J),k.forEach(Ge=>e.unsubscribeExecution(Ge))}},[p,d,m,c,e,s,n,o,r,f,g,t,w])},"useExecuteSwapTokenSwap");u();l();var Xp=class{static{a(this,"SwapTokenOnSelectResultStrategy")}getNavigationParams({initiatingSwapMode:e,selectedToken:r,initialSwapAmount:n,swapper:s,comingFrom:o}){let c=s.getTokenState();if(!Tt(c))return{swapMode:e,initialSwapAmount:n,comingFrom:o??On.SwapAssetSelect};if(e.type!=="buy"&&e.type!=="sell")return{swapMode:e,initialSwapAmount:n,comingFrom:o??On.SwapAssetSelect};let d=Ne(r),m=s.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),p=d?D(oa(r)):D({chainId:m.networkID,address:m.address,resourceType:W.address});return{swapMode:{type:e.type,buyCaip19:e.type==="buy"?e.buyCaip19:D(Y(r)),sellCaip19:e.type==="sell"?e.sellCaip19:D(Y(r)),takerCaip19:e.type==="buy"?p:c.takerCaip19,takerDestinationCaip19:e.type==="sell"?p:c.takerDestinationCaip19,sellFungibleKey:e.type==="buy"?r.data.key:c.sellToken.data.key,buyFungibleKey:e.type==="sell"?r.data.key:c.buyToken.data.key},initialSwapAmount:n,comingFrom:o??On.SwapAssetSelect}}captureAnalytics(e,r,n){new Ns(e).swapperUpdateAsset(n,r)}},Jp=class{static{a(this,"SwapModalSelectStrategy")}selectToken({swapper:e,selectedToken:r,currentTokens:n,perspective:s,cashAddresses:o,dismiss:c}){uT.selectToken({swapper:e,selectedToken:r,currentTokens:n,perspective:s,navigateToSwapper:a(({sellFungible:d})=>{if(!d)return;let m=e.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),p=Ne(r)?D(oa(r)):D({chainId:m.networkID,address:m.address,resourceType:W.address}),f={type:"swap",network:d.data.chain.id,sellCaip19:D(Y(d)),buyCaip19:void 0,takerCaip19:p,takerDestinationCaip19:void 0};e.initializeSwap({swapMode:f,cashAddresses:o,settings:{}}),c()},"navigateToSwapper"),dismiss:a(()=>c(),"dismiss")})}},Yp=class{static{a(this,"ClassicOnSelectResultStrategy")}selectToken({swapper:e,selectedToken:r,currentTokens:n,perspective:s,navigateToSwapper:o,dismiss:c}){let d=s==="sell"?n.buyCaip19:n.sellCaip19;if(this.isSameSelectedToken(d,r))return this.handleTokenSwitch(e,c);let m=Ne(r),p=e.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),f=m?D(oa(r)):D({chainId:p.networkID,address:p.address,resourceType:W.address});e.changeToken(r,s,f),c()}handleTokenSwitch(e,r){e.switchTokens(),r()}isSameSelectedToken(e,r){let n=D(Y(r));return e!==n?!1:!Ne(r)}};var k1=new Xp,uT=new Yp,_0e=new Jp;u();l();var Lu=class{static{a(this,"AssetSelectAnalytics")}analytics;additionalAnalyticsTags;constructor(e,r){this.analytics=e,this.additionalAnalyticsTags=r}captureEvent(e,r){let n={...r,data:{...r.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,n)}assetSelectionClosed(e){this.captureEvent("swapperAssetSelectionClosed",{data:e})}assetInfoPressed(e,r){this.captureEvent("swapperAssetInfoPressed",{data:{...Lr(e),type:r}})}assetFilterChanged(e,r){this.captureEvent("swapperAssetFilterChanged",{data:{filterId:e,type:r}})}assetSearchQueryChanged(e,r){this.captureEvent("swapperAssetSearchQueryChanged",{data:{searchQuery:e,type:r}})}},C1=Hi(Se,t=>new Lu(t));u();l();var Ou=U($());var _1=a(()=>{let{data:t}=gt({key:ke.LastSelectedTokens,queryKey:pe.lastSelectedTokens()}),e=(0,Ou.useMemo)(()=>t?JSON.parse(t):{},[t]),{mutateAsync:r}=yt({key:ke.LastSelectedTokens,queryKey:pe.lastSelectedTokens()}),n=(0,Ou.useCallback)(async s=>{let o={...e,[s]:!0};await r(JSON.stringify(o))},[e,r]);return{lastSelectedTokens:e,storeSelectedToken:n}},"useLastSelectedTokens");u();l();var lE=U(So());var Ar=U($());u();l();u();l();var ut=i.string().regex(/^(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?$/,"Invalid numeric string"),Uu=i.string().regex(/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?$/,"Invalid signed numeric string"),lT=i.object({accountValue:Uu,totalMarginUsed:ut,totalNtlPos:ut,totalRawUsd:Uu}),_Te=i.object({marginSummary:lT,withdrawable:ut,assetPositions:i.array(i.any()).optional(),crossMaintenanceMarginUsed:ut.optional(),crossMarginSummary:lT.optional(),guaranteedUntil:i.number().optional(),isAccountSolvent:i.boolean().optional(),pendingCashAdjusts:i.array(i.any()).optional(),totalCrossCollateral:ut.optional(),totalIsolatedCollateral:ut.optional(),totalMaintenanceMarginUsed:ut.optional()}),dT=i.object({coin:i.string(),side:i.enum(["B","A"]),limitPx:ut,sz:ut,oid:i.number(),timestamp:i.number(),origSz:ut,cloid:i.string().optional()}),FTe=i.array(dT),F1=i.object({position:dT,status:i.string(),statusTimestamp:i.number()}),PTe=i.array(F1),P1=i.object({status:i.literal("ok"),response:i.object({type:i.string()}).optional()}),pT=i.object({error:i.string()}),vTe=i.union([P1,pT]),v1=i.enum(["withdraw","deposit"]),R1=i.object({id:i.string(),type:v1,timestamp:i.string(),delta:i.object({usdAmount:Uu,token:i.object({caip19:i.string(),symbol:i.string(),image:i.string(),amount:Uu})})}),RTe=i.array(R1),D1=i.object({resting:i.object({oid:i.number()})}),N1=i.object({filled:i.object({totalSz:ut,avgPx:ut,oid:i.number()})}),B1=i.object({error:i.string()}),L1=i.union([D1,N1,B1]),O1=i.object({status:i.literal("ok"),response:i.object({type:i.literal("order"),data:i.object({statuses:i.array(L1)})})}),DTe=i.union([O1,pT]),mT=i.array(i.object({t:i.number(),T:i.number(),s:i.string(),i:i.string(),o:ut,h:ut,l:ut,c:ut,v:ut,n:i.number()}));u();l();var U1=i.object({accountValue:He,availableBalance:He,availableToTrade:He}),M1=i.object({tokenIndex:i.number(),pairIndex:i.number().optional(),symbol:i.string(),total:He,hold:He}),fT=i.object({accountValue:He,availableBalance:He,availableToTrade:He,dexAbstraction:i.boolean().optional(),dexs:i.record(i.string(),U1).optional(),collateralBalances:i.array(M1).optional()});u();l();var q1=i.enum(["withdrawal","deposit","reward"]),z1=i.object({id:i.string(),type:q1,timestamp:i.number(),usdcAmount:it}),hT=i.object({depositAndWithdrawals:i.array(i.any()).transform(t=>t.reduce((e,r)=>{let n=z1.safeParse(r);return n.success&&e.push(n.data),e},[]))});u();l();var ZTe=i.enum(["success","failed"]),XTe=i.enum(["close","liquidation","take_profit","stop_loss"]),JTe=i.literal("open"),gT=i.object({id:i.string(),market:i.object({token:eo,logoUri:i.string(),szDecimals:i.number().optional()}),type:i.string(),timestamp:i.number(),price:He,size:it,tradeValue:He,fee:it,closedPnl:i.optional(it)}),yT=i.object({tradeHistory:i.array(gT).transform(t=>t.reduce((e,r)=>{let n=gT.safeParse(r);return n.success&&e.push(n.data),e},[]))});u();l();var ST=i.enum(["long","short"]),Mu=i.object({direction:ST,leverage:He,size:it,margin:He,entryPrice:He,fundingPayments:it,market:i.object({token:eo,logoUri:i.string()}),value:He,unrealizedPnl:i.object({amount:it,percentage:it}),liquidationPrice:it}),bT=i.object({positions:i.array(Mu).transform(t=>t.reduce((e,r)=>{let n=Mu.safeParse(r);return n.success&&e.push(n.data),e},[]))}),wT=i.object({id:i.string(),market:i.object({token:eo,logoUri:i.string()}),isTrigger:i.boolean(),direction:ST,type:i.enum(["take_profit_market","stop_market","limit"]),reduceOnly:i.boolean(),triggerPrice:He,limitPrice:He,timestamp:He,size:it}),TT=i.object({positions:i.array(Mu).transform(t=>t.reduce((e,r)=>{let n=Mu.safeParse(r);return n.success&&e.push(n.data),e},[])),openOrders:i.array(wT).transform(t=>t.reduce((e,r)=>{let n=wT.safeParse(r);return n.success&&e.push(n.data),e},[]))});u();l();function qe(t,e){return t+Math.random()*e}a(qe,"getRetryDelayWithJitter");u();l();var Q1=i.object({address:i.string(),registered:i.boolean()}),H1=i.object({code:i.string(),registered:i.boolean()}).optional(),ET=i.object({providerFee:i.string(),phantomFee:i.string(),referral:H1.optional(),builder:Q1.optional()});u();l();var G1=i.object({depositAddress:i.object({address:i.string()}),requestId:i.string()}),V1=i.object({name:i.string(),version:i.string(),chainId:i.number(),verifyingContract:i.string()}),$1=i.object({id:i.literal("authorize"),domain:V1,types:i.record(i.array(i.object({name:i.string(),type:i.string()}))),primaryType:i.string(),message:i.record(i.unknown()),postEndpoint:i.string(),postBody:i.record(i.unknown())}),j1=i.object({id:i.literal("deposit"),action:i.record(i.unknown()),nonce:i.number(),eip712Types:i.record(i.array(i.object({name:i.string(),type:i.string()}))),eip712PrimaryType:i.string(),checkEndpoint:i.string()}),K1=i.object({amountIn:i.string(),amountOut:i.string(),amountOutUsd:i.string().optional()}),W1=i.object({requestId:i.string(),authorizeStep:$1,depositStep:j1,details:K1}),xT=i.union([W1,G1]);function IT(t){return"authorizeStep"in t}a(IT,"isDirectSigningBridgeResponse");function kT(t){return"depositAddress"in t}a(kT,"isLegacyBridgeResponse");var wEe=i.object({type:i.string(),walletChainId:i.number(),wallet:i.string(),nonce:i.number(),id:i.string(),signatureChainId:i.number(),signature:i.string()}),SEe=i.object({message:i.string().optional()}),Z1=i.object({destinationAmount:i.string().optional(),sourceTxHash:i.string().optional(),state:i.enum(["done","sourceTxDiscovered","waitForSrcTxFinalization","buildingDstTx","signTx","broadcastTx","waitForDstTxFinalization","readyForWithdrawQueue","queuedForWithdraw","failure","additionalChecks"]),opCreatedAt:i.string().optional(),operationId:i.string().optional(),protocolAddress:i.string().optional(),sourceAddress:i.string().optional(),destinationAddress:i.string().optional(),sourceChain:i.string().optional(),destinationChain:i.string().optional(),sourceAmount:i.string().optional(),destinationFeeAmount:i.string().optional(),sweepFeeAmount:i.string().optional(),stateStartedAt:i.string().optional(),stateUpdatedAt:i.string().optional(),stateNextAttemptAt:i.string().optional(),destinationTxHash:i.string().optional(),asset:i.string().optional()}),CT=i.object({usdcPrice:i.string(),orderAssetId:i.number(),operations:i.array(Z1)}),_T=i.discriminatedUnion("status",[i.object({status:i.literal("ok"),response:i.object({type:i.string()})}),i.object({status:i.literal("err"),response:i.string()})]),FT=i.discriminatedUnion("status",[i.object({status:i.literal("ok"),response:i.object({type:i.string()})}),i.object({status:i.literal("err"),response:i.string()})]),PT=i.object({status:i.enum(["ok","err"])}),vT=i.object({name:i.string(),midPx:i.string()}),X1=i.object({unixTime:i.number(),value:i.string(),open:i.string(),high:i.string(),low:i.string(),close:i.string(),volume:i.string()}),bEe=i.object({history:i.array(X1)}),RT=i.object({role:i.enum(["missing","user"])}),AT=i.object({px:i.string(),sz:i.string(),n:i.number()}),DT=i.object({coin:i.string(),time:i.number(),levels:i.tuple([i.array(AT),i.array(AT)])}),NT=i.object({fundingCaip19Address:Gr,spotAssetId:i.number(),spotTokenId:i.string(),spotTokenName:i.string(),spotSzDecimals:i.number(),eta:i.string(),fee:i.string(),minimumAmount:i.string()}),BT=i.object({tokens:i.array(qt)}),$e;(function(t){t.Hyperunit="hyperunit",t.Relay="relay",t.RelayV2="relayV2"})($e||($e={}));var LT=i.object({providers:i.array(i.object({name:i.nativeEnum($e),max:i.number(),initializingCaip19Address:i.optional(Gr)}))});var J1={[$e.Hyperunit]:"Hyperunit",[$e.Relay]:"Relay",[$e.RelayV2]:"RelayV2"},qu=class{static{a(this,"PerpsClient")}async getSpotBridgeInitialize(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/bridge-initialize",{params:{...e,bridgeProvider:J1[e.bridgeProvider]}}),n=xT.safeParse(r.data);if(!n.success)throw new Error(`Failed to parse spot bridge initialize response: ${JSON.stringify(n.error.errors,null,2)}`);return n.data}async postAuthorize(e){let r=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/spot/authorize",e);if(!ee(r))throw new Error(`Relay authorize failed: ${JSON.stringify(r.data)}`);return r.data}async postExchange(e){let r=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/exchange",e);if(!ee(r))throw new Error("Failed to post exchange: response is not okay")}async getOperations(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/bridge-operations",{params:e}),n=CT.safeParse(r.data);if(!n.success)throw new Error(`Failed to parse operations response: ${n.error}`);return n.data}async getAccountBalance(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/perp/balance",{params:{user:D(e)}});if(!ee(r))throw new Error("Failed to get account balance: response is not okay");let n=r.data,s=fT.safeParse(n);if(!s.success)throw new Error("Failed to get account balance: schema validation failed");return s.data}async getUserFundingHistory(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/perp/deposits-and-withdrawals",{params:{user:D(e)}});if(!ee(r))throw new Error("Failed to get deposits and withdrawals: response is not okay");let n=r.data,s=hT.safeParse(n);if(!s.success)throw new Error("Failed to get deposits and withdrawals: schema validation failed");return s.data.depositAndWithdrawals}async getPositions(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/perp/positions",{params:{user:D(e)}});if(!ee(r))throw new Error("Failed to get positions: response is not okay");let n=r.data,s=bT.safeParse(n);if(!s.success)throw new Error("Failed to get positions: schema validation failed");return s.data.positions}async getPositionsAndOpenOrders(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/perp/positions-and-open-orders",{params:{user:D(e)}});if(!ee(r))throw new Error("Failed to get positions: response is not okay");let n=r.data,s=TT.safeParse(n);if(!s.success)throw new Error("Failed to get positions: schema validation failed");return s.data}async getHistoricalOrders(e,r){let n={user:D(e)};r&&r.length>0&&(n.markets=r.join(","));let s=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/perp/trade-history",{params:n});if(!ee(s))throw new Error("Failed to get historical orders: response is not okay");let o=s.data,c=yT.safeParse(o);if(!c.success)throw new Error("Failed to get historical orders: schema validation failed");return c.data.tradeHistory}async postSpotSend(e){let r=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/spot/send",e);if(!ee(r))throw new Error("Failed to post spot send: response is not okay");let n=r.data,s=_T.safeParse(n);if(!s.success)throw new Error("Failed to post spot send: schema validation failed");return s.data}async postPerpsSend(e){let r=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/perps/send",e);if(!ee(r))throw new Error("Failed to post perps send: response is not okay");let n=r.data,s=FT.safeParse(n);if(!s.success)throw new Error("Failed to post perps send: schema validation failed");return s.data}async postTransferUsdcSpotPerp(e){let r=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/transfer-usdc-spot-perp",e);if(!ee(r))throw new Error("Failed to post spot send: response is not okay");let n=r.data,s=PT.safeParse(n);if(!s.success)throw new Error("Failed to post spot send: schema validation failed");return s.data}async getTokenDetails(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/token-details",{params:{tokenId:e.tokenId,type:"tokenDetails"}});if(!ee(r))throw new Error("Failed to get token info: response is not okay");let n=r.data,s=vT.safeParse(n);if(!s.success)throw new Error("Failed to get token info: schema validation failed");return s.data}async getUserRole(e){let r=await fetch("https://api.hyperliquid.xyz/info",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:"userRole",user:e})});if(!r.ok)throw new Error("Failed to get token info");let n=await r.json(),s=RT.safeParse(n);if(!s.success)throw new Error("Failed to get user role: schema validation failed");return s.data}async getL2Book(e){let r=await fetch("https://api.hyperliquid.xyz/info",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:"l2Book",coin:e})});if(!r.ok)throw new Error("Failed to get l2 book");let n=await r.json(),s=DT.safeParse(n);if(!s.success)throw new Error("Failed to get l2 book: schema validation failed");return s.data}async postFunding(e){let r=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/spot/funding",e);if(!ee(r))throw new Error("Failed to get funding");let n=r.data,s=NT.safeParse(n);if(!s.success)throw new Error("Failed to post funding: schema validation failed");return s.data}async getPriceHistory(e){let r={coin:e.coin,interval:e.interval,startTime:e.startTime.toString(),endTime:e.endTime.toString()};e.isTestnet&&(r.isTestnet="true");let n=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/candles",{params:r});if(!ee(n))throw new Error("Failed to get price history: response is not okay");let s=n.data,o=mT.safeParse(s);if(!o.success)throw new Error("Failed to get price history: schema validation failed");return o.data}async getSpotBalances(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/balances",{params:e});if(!ee(r))throw new Error("Failed to get spot balances: response is not okay");return r.data}async getPositionFees(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/perp/fees",{params:{user:D(e)}});if(!ee(r))throw new Error("Failed to get position fees: response is not okay");let n=r.data,s=ET.safeParse(n);if(!s.success)throw new Error("Failed to get position fees: schema validation failed");return s.data}async getBridgeableTokens(e){if(!e)throw new Error("No addresses provided to get bridgeable tokens");let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/bridgeable-tokens",{params:{addresses:e.join(",")}});if(!ee(r))throw new Error("Failed to get bridgeable tokens: response is not okay");let n=r.data,s=BT.safeParse(n);if(!s.success)throw new Error("Failed to get bridgeable tokens: schema validation failed");return s.data}async getPreferredBridges(){let e=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/preferred-bridges");if(!ee(e))throw new Error("Failed to get preferred bridge: response is not okay");let r=e.data,n=LT.safeParse(r);if(!n.success)throw new Error("Failed to get preferred bridge: schema validation failed");return n.data}};u();l();u();l();var ze=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}];var zu=[{name:"hyperliquidChain",type:"string"},{name:"maxFeeRate",type:"string"},{name:"builder",type:"address"},{name:"nonce",type:"uint64"}],Ot=[{name:"source",type:"string"},{name:"connectionId",type:"bytes32"}];u();l();var Y1=i.object({totalSz:i.string(),avgPx:i.string(),oid:i.number()}),eD=i.object({oid:i.number()}),tD=i.union([i.object({error:i.string()}),i.object({filled:Y1}),i.literal("success"),i.object({resting:eD})]),rD=i.object({status:i.literal("ok"),response:i.object({type:i.string(),data:i.object({statuses:i.array(tD)}).optional()})}),nD=i.union([i.object({status:i.literal("err"),response:i.string()}),rD]),VEe=i.object({action:i.any(),nonce:i.number(),signature:i.object({r:i.string(),s:i.string(),v:i.number()}),isTestnet:i.boolean().optional()});var sD=3e4,oD=2,iD=1500,jn=class{static{a(this,"HyperliquidExchange")}async postExchange(e){return await E.startSpan("hyperliquid.exchange.post",async()=>{let n=(await H.api().timeout(sD).retry(oD,iD).post("/swap/v2/exchange",e)).data,s=nD.safeParse(n);if(!s.success)throw new Error(`Invalid exchange response: ${s.error.message}`);return s.data})}};u();l();function em(t){return t.map(e=>({time:e.t/1e3,open:Number(e.o),high:Number(e.h),low:Number(e.l),close:Number(e.c),volume:Number(e.v)}))}a(em,"mapRawCandleSnapshotToCandleSnapshot");u();l();var Qu=class{static{a(this,"AccountBalanceStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingAccountBalanceStart":switch(this.state.type){case"accountBalance":return{type:"refreshing",accountBalance:this.state.accountBalance};case"refreshing":return{type:"refreshing",accountBalance:this.state.accountBalance};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let r=this.state;throw new Error(`Invalid state ${r.type} for fetchingAccountBalanceStart`)}}case"fetchingAccountBalanceSuccess":switch(this.state.type){case"loading":case"refreshing":case"accountBalance":return{type:"accountBalance",accountBalance:e.accountBalance};default:throw new Error(`Invalid state ${this.state.type} for fetchingAccountBalanceSuccess`)}case"fetchingAccountBalanceError":return{type:"error",error:e.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onAccountBalanceStateChange(this.state)})}};u();l();var Hu=class{static{a(this,"FundingHistoryStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingFundingHistoryStart":switch(this.state.type){case"history":return{type:"refreshing",history:this.state.history};case"refreshing":return{type:"refreshing",history:this.state.history};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistoryStart`)}case"fetchingFundingHistorySuccess":switch(this.state.type){case"loading":case"refreshing":case"history":return{type:"history",history:e.history};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistorySuccess`)}case"fetchingFundingHistoryError":switch(this.state.type){case"history":case"refreshing":return{type:"history",history:this.state.history};default:return{type:"error",error:e.error}}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onFundingHistoryStateChange(this.state)})}};u();l();var Gu=class{static{a(this,"HistoricalOrdersStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingHistoricalOrdersStart":switch(this.state.type){case"historicalOrders":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"refreshing":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersStart`)}case"fetchingHistoricalOrdersSuccess":switch(this.state.type){case"loading":case"refreshing":case"historicalOrders":return{type:"historicalOrders",historicalOrders:e.historicalOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersSuccess`)}case"fetchingHistoricalOrdersError":return{type:"error",error:e.error}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onHistoricalOrdersStateChange(this.state)})}};u();l();var Vu=class{static{a(this,"PositionsStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingPositionsStart":switch(this.state.type){case"positions":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"refreshing":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let r=this.state;throw new Error(`Invalid state ${r.type} for fetchingPositionsStart`)}}case"fetchingPositionsSuccess":switch(this.state.type){case"loading":case"refreshing":case"positions":return{type:"positions",positions:e.positions,openOrders:e.openOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionsSuccess`)}case"fetchingPositionsError":return{type:"error",error:e.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPositionStateChange(this.state)})}};u();l();var $u=0;function Xe(){let t=Date.now();return $u=t>$u?t:$u+1,$u}a(Xe,"nextNonce");u();l();u();l();u();l();u();l();u();l();u();l();function OT(t){let e=t.length,r=0,n=0;for(;n<e;){let s=t.charCodeAt(n++);if(s&4294967168)if(!(s&4294965248))r+=2;else{if(s>=55296&&s<=56319&&n<e){let o=t.charCodeAt(n);(o&64512)===56320&&(++n,s=((s&1023)<<10)+(o&1023)+65536)}s&4294901760?r+=4:r+=3}else{r++;continue}}return r}a(OT,"utf8Count");function aD(t,e,r){let n=t.length,s=r,o=0;for(;o<n;){let c=t.charCodeAt(o++);if(c&4294967168)if(!(c&4294965248))e[s++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&o<n){let d=t.charCodeAt(o);(d&64512)===56320&&(++o,c=((c&1023)<<10)+(d&1023)+65536)}c&4294901760?(e[s++]=c>>18&7|240,e[s++]=c>>12&63|128,e[s++]=c>>6&63|128):(e[s++]=c>>12&15|224,e[s++]=c>>6&63|128)}else{e[s++]=c;continue}e[s++]=c&63|128}}a(aD,"utf8EncodeJs");var cD=new TextEncoder,uD=50;function lD(t,e,r){cD.encodeInto(t,e.subarray(r))}a(lD,"utf8EncodeTE");function UT(t,e,r){t.length>uD?lD(t,e,r):aD(t,e,r)}a(UT,"utf8Encode");var bAe=new TextDecoder;u();l();u();l();var Kn=class{static{a(this,"ExtData")}constructor(e,r){this.type=e,this.data=r}};u();l();u();l();var ju=class t extends Error{static{a(this,"DecodeError")}constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};u();l();function MT(t,e,r){let n=r/4294967296,s=r;t.setUint32(e,n),t.setUint32(e+4,s)}a(MT,"setUint64");function Ku(t,e,r){let n=Math.floor(r/4294967296),s=r;t.setUint32(e,n),t.setUint32(e+4,s)}a(Ku,"setInt64");function qT(t,e){let r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}a(qT,"getInt64");var dD=-1,pD=4294967296-1,mD=17179869184-1;function fD({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=mD)if(e===0&&t<=pD){let r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{let r=t/4294967296,n=t&4294967295,s=new Uint8Array(8),o=new DataView(s.buffer);return o.setUint32(0,e<<2|r&3),o.setUint32(4,n),s}else{let r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),Ku(n,4,t),r}}a(fD,"encodeTimeSpecToTimestamp");function hD(t){let e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,s=Math.floor(n/1e9);return{sec:r+s,nsec:n-s*1e9}}a(hD,"encodeDateToTimeSpec");function gD(t){if(t instanceof Date){let e=hD(t);return fD(e)}else return null}a(gD,"encodeTimestampExtension");function yD(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let r=e.getUint32(0),n=e.getUint32(4),s=(r&3)*4294967296+n,o=r>>>2;return{sec:s,nsec:o}}case 12:{let r=qT(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new ju(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}a(yD,"decodeTimestampToTimeSpec");function wD(t){let e=yD(t);return new Date(e.sec*1e3+e.nsec/1e6)}a(wD,"decodeTimestampExtension");var zT={type:dD,encode:gD,decode:wD};var io=class{static{a(this,"ExtensionCodec")}constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(zT)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{let s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){let s=this.builtInEncoders[n];if(s!=null){let o=s(e,r);if(o!=null){let c=-1-n;return new Kn(c,o)}}}for(let n=0;n<this.encoders.length;n++){let s=this.encoders[n];if(s!=null){let o=s(e,r);if(o!=null){let c=n;return new Kn(c,o)}}}return e instanceof Kn?e:null}decode(e,r,n){let s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,n):new Kn(r,e)}};io.defaultCodec=new io;u();l();function SD(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}a(SD,"isArrayBufferLike");function QT(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):SD(t)?new Uint8Array(t):Uint8Array.from(t)}a(QT,"ensureUint8Array");var bD=100,TD=2048,Wu=class t{static{a(this,"Encoder")}constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??io.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??bD,this.initialBufferSize=e?.initialBufferSize??TD,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){let r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){let r=new ArrayBuffer(e),n=new Uint8Array(r),s=new DataView(r);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let n=OT(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),UT(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){let n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);let n=QT(e);this.writeU8a(n)}encodeArray(e,r){let n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(let s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let n=0;for(let s of r)e[s]!==void 0&&n++;return n}encodeMap(e,r){let n=Object.keys(e);this.sortKeys&&n.sort();let s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(let o of n){let c=e[o];this.ignoreUndefined&&c===void 0||(this.encodeString(o),this.doEncode(c,r+1))}}encodeExtension(e){if(typeof e.data=="function"){let n=e.data(this.pos+6),s=n.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(n);return}let r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),MT(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Ku(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function or(t,e){return new Wu(e).encodeSharedRef(t)}a(or,"encode");var HT=U(yo());var Zu=class{static{a(this,"UpdateIsolatedMarginAction")}type="updateIsolatedMargin";asset;isBuy;ntli;constructor(e){this.asset=e.asset,this.isBuy=e.isBuy,this.ntli=e.ntli}hash(e,r){let n=or(this),s=e===null?9:29,o=new Uint8Array(n.length+s);o.set(n);let c=new DataView(o.buffer,o.byteOffset,o.byteLength);return c.setBigUint64(n.length,BigInt(r)),e===null?c.setUint8(n.length+8,0):(c.setUint8(n.length+8,1),o.set(ED(e),n.length+9)),`0x${(0,HT.keccak256)(o)}`}};function ED(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}a(ED,"addressToBytes");u();l();function tm(t){switch(t.type){case"preparingTransaction":case"managingMargin":case"manageMarginSucceeded":return GT(t);case"manageMarginFailed":return{...GT(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}a(tm,"getManageMarginStateLogsDetails");var GT=a(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbol:t.market.symbol,assetId:t.market.assetId.toString(),positionDirection:t.position.direction,positionSize:t.position.size.toString(),currentMargin:t.position.margin.toString(),marginDelta:t.marginDelta.toString(),marginAction:t.marginDelta.isPositive()?"increase":"decrease",newMargin:new b(t.position.margin).plus(t.marginDelta).toString(),fee:t.fee?.toString()||"N/A"},"getBaseLogsDetails");u();l();var Xu=class{static{a(this,"ManageMarginStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in ManageMarginStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateManageMargin":{let{position:n,market:s,marginDelta:o,fee:c}=r.payload;return{type:"preparingTransaction",...{position:n,market:s,marginDelta:o,fee:c}}}case"ManageMarginInitiated":{if(e.type==="preparingTransaction")return{type:"managingMargin",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee};break}case"ManageMarginSuccess":{if(e.type==="managingMargin")return{type:"manageMarginSucceeded",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee};break}case"ManageMarginFailure":{if(e.type==="managingMargin")return{type:"manageMarginFailed",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee,error:r.error};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onManageMarginStateChange(e,this.state)})}};var AD=6,Ju=class{static{a(this,"ManageMarginOrchestrator")}stateMachine=new Xu;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManageMarginStateChange:a((e,r)=>{this.handleStateChange(e,r)},"onManageMarginStateChange")};stateLogsListener={onManageMarginStateChange:a((e,r)=>{switch(r.type){case"manageMarginSucceeded":E.addBreadcrumb(I.Perps,`Manage margin succeeded: ${r.type}`,F.Info,tm(r));break;case"manageMarginFailed":E.addBreadcrumb(I.Perps,`Manage margin failed: ${r.type}`,F.Error,tm(r));break;default:E.addBreadcrumb(I.Perps,`Manage margin state change: ${e.type} -> ${r.type}`,F.Info);break}(r.type==="manageMarginSucceeded"||r.type==="manageMarginFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onManageMarginStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateManageMargin":this.stateMachine.send({type:"ManageMarginInitiated"});break;case"ManageMarginInitiated":r.type==="managingMargin"&&await this.manageMargin(r);break}}async manageMargin(e){try{let{position:r,market:n,marginDelta:s}=e,o=s.multipliedBy(new b(10).pow(AD)).toNumber(),c=new Zu({asset:n.assetId,isBuy:r.direction==="long",ntli:o}),d=Xe(),m={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:c.hash(null,d)}},p=await this.perps.exchangeAction(c,m,d),f=p.response.data?.statuses?.find(w=>typeof w=="object"&&"error"in w);if(f&&typeof f=="object"&&"error"in f)throw new Error(f.error);let g=JSON.stringify(p.response.data?.statuses||"unknown");this.stateMachine.send({type:"ManageMarginSuccess",payload:g})}catch(r){this.stateMachine.send({type:"ManageMarginFailure",error:r})}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){return this.stateMachine.addListener(e),()=>this.stateMachine.removeListener(e)}removeListener(e){this.stateMachine.removeListener(e)}};u();l();u();l();var VT=U(yo());var zr=class{static{a(this,"OrderAction")}type="order";orders;grouping;builder;constructor(e,r){this.orders=e,this.grouping="na",r&&(this.builder=r)}hash(e,r){let n=or(this),s=e===null?9:29,o=new Uint8Array(n.length+s);o.set(n);let c=new DataView(o.buffer,o.byteOffset,o.byteLength);return c.setBigUint64(n.length,BigInt(r)),e===null?c.setUint8(n.length+8,0):(c.setUint8(n.length+8,1),o.set(xD(e),n.length+9)),`0x${(0,VT.keccak256)(o)}`}};function xD(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}a(xD,"addressToBytes");var Yu=class{static{a(this,"SpotSendAction")}hyperliquidChain;signatureChainId;amount;destination;time;token;type="spotSend";constructor(e){this.hyperliquidChain=e.hyperliquidChain,this.signatureChainId=e.signatureChainId,this.token=e.token,this.amount=e.amount,this.destination=e.destination,this.time=e.time}},el=class{static{a(this,"PerpsSendAction")}hyperliquidChain;signatureChainId;amount;destination;time;type="usdSend";constructor(e){this.hyperliquidChain=e.hyperliquidChain,this.signatureChainId=e.signatureChainId,this.amount=e.amount,this.destination=e.destination,this.time=e.time}};u();l();var $T=U(yo());var ao=class{static{a(this,"ApproveReferralAction")}type="setReferrer";code;constructor(e){this.code=e.code}hash(e,r){let n=or(this),s=e===null?9:29,o=new Uint8Array(n.length+s);o.set(n);let c=new DataView(o.buffer,o.byteOffset,o.byteLength);return c.setBigUint64(n.length,BigInt(r)),e===null?c.setUint8(n.length+8,0):(c.setUint8(n.length+8,1),o.set(ID(e),n.length+9)),`0x${(0,$T.keccak256)(o)}`}};function ID(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}a(ID,"addressToBytes");u();l();var Ut=class{static{a(this,"OrderBuilder")}_order={};asset(e){return this._order.a=e,this}isBuy(e){return this._order.b=e,this}buy(){return this.isBuy(!0)}sell(){return this.isBuy(!1)}price(e){return this._order.p=e.toString(),this}size(e){return this._order.s=e.toString(),this}reduceOnly(e){return this._order.r=e,this}clientOrderId(e){return this._order.c=e,this}limitOrder(e="Gtc"){return this._order.t={limit:{tif:e}},this}postOnly(){return this.limitOrder("Alo")}immediateOrCancel(){return this.limitOrder("Ioc")}triggerOrder(e,r=!0,n="sl"){return this._order.t={trigger:{isMarket:r,triggerPx:e.toString(),tpsl:n}},this}stopLoss(e,r=!0){return this.triggerOrder(e,r,"sl")}takeProfit(e,r=!0){return this.triggerOrder(e,r,"tp")}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.b===void 0)throw new Error("Buy/sell direction is required");if(this._order.p===void 0)throw new Error("Price is required");if(this._order.s===void 0)throw new Error("Size is required");if(this._order.t===void 0)throw new Error("Order type is required");return this._order.r===void 0&&(this._order.r=!1),this._order}};u();l();function Mt(t,e,r=!0,n=b.ROUND_HALF_UP){let s=new b(t);if(s.isInteger())return s.toString();let o=kD(e,r);return s.precision(5,n).toFixed(o,n).replace(/(\.\d*[1-9])0+$|\.0+$/,"$1")}a(Mt,"formatPrice");function kD(t,e=!0){return Math.max((e?6:8)-t,0)}a(kD,"maxAllowedDecimalsInPrice");u();l();function Ii(t,e,r=b.ROUND_HALF_UP){return new b(t).toFixed(e,r).replace(/(\.\d*[1-9])0+$|\.0+$/,"$1")}a(Ii,"formatSize");u();l();var tl=class{static{a(this,"CancelOrderBuilder")}_order={};asset(e){return this._order.a=e,this}orderId(e){return this._order.o=e,this}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.o===void 0)throw new Error("Order ID is required");return this._order}};u();l();var jT=U(yo());var rl=class{static{a(this,"CancelOrderAction")}type="cancel";cancels;constructor(e){this.cancels=e}hash(e,r){let n=or(this),s=e===null?9:29,o=new Uint8Array(n.length+s);o.set(n);let c=new DataView(o.buffer,o.byteOffset,o.byteLength);return c.setBigUint64(n.length,BigInt(r)),e===null?c.setUint8(n.length+8,0):(c.setUint8(n.length+8,1),o.set(CD(e),n.length+9)),`0x${(0,jT.keccak256)(o)}`}};function CD(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}a(CD,"addressToBytes");u();l();function rm(t){switch(t.type){case"preparingTransaction":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"managingPosition":case"managePositionSucceeded":return KT(t);case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":return{...KT(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}a(rm,"getManagePositionStateLogsDetails");var KT=a(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbols:t.markets.map(e=>e.symbol).join(", "),assetIds:t.markets.map(e=>e.assetId.toString()).join(", "),positionDirections:t.positions.map(e=>e.direction).join(", "),positionSizes:t.positions.map(e=>e.size.toString()).join(", "),updateType:t.update.type,fees:t.fees.map(e=>e.toString()).join(", "),...t.update.type==="close"&&{closeSize:t.update.size.toString()},...t.update.type==="addAutoClose"&&{tpTriggerPrice:t.update.autoClose.tp?.triggerPrice.toString()||"N/A",slTriggerPrice:t.update.autoClose.sl?.triggerPrice.toString()||"N/A"},...t.update.type==="removeAutoClose"&&{tpOrderId:t.update.autoClose.tp?.orderId?.toString()||"N/A",slOrderId:t.update.autoClose.sl?.orderId?.toString()||"N/A"}},"getBaseLogsDetails");u();l();var nl=class{static{a(this,"ManagePositionStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in ManagePositionStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateManagePosition":{let{positions:n,update:s,markets:o,fees:c,autoClose:d}=r.payload;return{type:"preparingTransaction",...{positions:n,update:s,markets:o,fees:c,autoClose:d}}}case"RegisterBuilderCodeInitiated":{if(e.type==="preparingTransaction")return{type:"registeringBuilder",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(e.type==="registeringBuilder")return{type:"builderRegistered",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterBuilderCodeFailure":{if(e.type==="registeringBuilder")return{type:"builderRegistrationFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralInitiated":{if(e.type==="builderRegistered")return{type:"registeringReferral",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(e.type==="registeringReferral")return{type:"referralRegistered",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralFailure":{if(e.type==="registeringReferral")return{type:"referralRegistrationFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionInitiated":{if(e.type==="preparingTransaction"||e.type==="referralRegistered")return{type:"managingPosition",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionSuccess":{if(e.type==="managingPosition")return{type:"managePositionSucceeded",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionFailure":{if(e.type==="managingPosition")return{type:"managePositionFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onManagePositionStateChange(e,this.state)})}};var co=.1;function _D(t){let e=t.match(/Order value too large\.?\s*Max is \$?([\d,]+)/i);if(e){let r=e[1];return L.t("perpsErrorOrderValueTooLarge",{maxValue:`$${r}`})}return t}a(_D,"parseHyperliquidError");var sl=class{static{a(this,"ManagePositionOrchestrator")}stateMachine=new nl;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManagePositionStateChange:a((e,r)=>{this.handleStateChange(e,r)},"onManagePositionStateChange")};stateLogsListener={onManagePositionStateChange:a((e,r)=>{switch(r.type){case"managePositionSucceeded":E.addBreadcrumb(I.Perps,`Manage position succeeded: ${r.type}`,F.Info,rm(r));break;case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":E.addBreadcrumb(I.Perps,`Manage position failed: ${r.type}`,F.Error,rm(r));break;default:E.addBreadcrumb(I.Perps,`Manage position state change: ${e.type} -> ${r.type}`,F.Info);break}(r.type==="managePositionSucceeded"||r.type==="managePositionFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onManagePositionStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateManagePosition":e.payload.update.type==="close"?this.stateMachine.send({type:"RegisterBuilderCodeInitiated"}):this.stateMachine.send({type:"ManagePositionInitiated"});break;case"RegisterBuilderCodeInitiated":r.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":r.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":r.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":r.type==="referralRegistered"&&this.stateMachine.send({type:"ManagePositionInitiated"});break;case"ManagePositionInitiated":r.type==="managingPosition"&&await this.managePosition(r);break}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){this.stateMachine.addListener(e)}removeListener(e){this.stateMachine.removeListener(e)}async registerBuilder(){try{if(!bn()){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing"||!e.positionFees.builder)throw new Error("position fees not found");if(e.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let r=e.positionFees.builder.address,n=`${Number(e.positionFees.phantomFee.toString())*100}%`,s=Xe(),o={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:n,builder:r,nonce:s},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ze,"HyperliquidTransaction:ApproveBuilderFee":zu},message:o},m=(await this.perps.exchangeAction(o,c,s)).response.data?.statuses?.find(p=>typeof p=="object"&&"error"in p);if(m&&typeof m=="object"&&"error"in m)throw new Error(m.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:e})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing")throw new Error("position fees not found");if(!e.positionFees.referral||e.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let r=e.positionFees.referral.code,n=new ao({code:r}),s=Xe(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:n.hash(null,s)}},d=(await this.perps.exchangeAction(n,o,s)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error);this.stateMachine.send({type:"RegisterReferralSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterReferralFailure",error:e})}}async managePosition(e){try{let{positions:r,update:n,markets:s}=e,o="",d=r.map(m=>m.direction==="long").map(m=>m);if(n.type==="removeAutoClose"){let m=await this.removeOrders(s[0].assetId,[n.autoClose.tp?.orderId,n.autoClose.sl?.orderId].filter(Boolean));if(!m)throw new Error("Failed to cancel auto close orders");o=m}else if(n.type==="removeLimitOrder"){let m=await this.removeOrders(s[0].assetId,[n.limitOrder.orderId].filter(Boolean));if(!m)throw new Error("Failed to cancel auto close orders");o=m}else if(n.type==="removeAllOrders"){let m=await this.removeOrders(s[0].assetId,[...n.limitOrders.map(p=>p.orderId).filter(Boolean),...[n.autoClose.tp?.orderId,n.autoClose.sl?.orderId].filter(Boolean)]);if(!m)throw new Error("Failed to cancel auto close orders");o=m}else if(n.type==="close"||n.type==="closeAll")o=await this.closePositions(s.map(p=>p.assetId),n.size instanceof b?[n.size.abs().toString()]:n.size.map(p=>p.abs().toString()),d,s.map(p=>p.currentPrice.toString()),s.map(p=>p.szDecimals));else if(n.type==="addAutoClose"){let m={tp:n.autoClose.tp?.orderId,sl:n.autoClose.sl?.orderId},p=await this.createAutoClose(m,s[0].assetId,d[0],s[0].szDecimals,n.autoClose);if(!p)throw new Error("Failed to cancel auto close orders");o=p}this.stateMachine.send({type:"ManagePositionSuccess",payload:o})}catch(r){this.stateMachine.send({type:"ManagePositionFailure",error:r})}}async closePositions(e,r,n,s,o){let c;if(bn()){let S=this.perps.getPositionFeesState();if(S.type!=="positionFees"&&S.type!=="refreshing"||!S.positionFees.builder)throw new Error("position fees not found");c={b:S.positionFees.builder.address.toLowerCase(),f:Number(S.positionFees.phantomFee)*100*100*10}}let d=[];for(let S=0;S<e.length;S++){let x=Mt(new b(s[S]).multipliedBy(n[S]?1-co:1+co),o[S]),T=Ii(new b(r[S]),o[S],b.ROUND_DOWN),_=new Ut().asset(e[S]).isBuy(!n[S]).price(x).size(T).reduceOnly(!0).immediateOrCancel().build();d.push(_)}let m=new zr(d,c),p=Xe(),f={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:m.hash(null,p)}},g=await this.perps.exchangeAction(m,f,p),w=g.response.data?.statuses.find(S=>S==="error"||S?.error);if(w){let S=typeof w=="string"?"Operation failed":w.error,x=_D(S);throw new Error(x)}if(g.response.data?.statuses.find(S=>S==="filled"||S?.filled))return JSON.stringify(g.response.data?.statuses);throw new Error("No filled status found")}async createAutoClose(e,r,n,s,o){let c=[e.tp,e.sl].filter(Boolean).filter(k=>k!==-1);if(c.length>0&&!await this.removeOrders(r,c))throw new Error("Failed to cancel auto close orders");let d;if(bn()){let k=this.perps.getPositionFeesState();if(k.type!=="positionFees"&&k.type!=="refreshing"||!k.positionFees.builder)throw new Error("position fees not found");d={b:k.positionFees.builder.address.toLowerCase(),f:Number(k.positionFees.phantomFee)*100*100*10}}let m="0",p;if(o?.tp){let k=Mt(new b(o.tp.triggerPrice).multipliedBy(n?1-co:1+co),s),P=Mt(new b(o.tp.triggerPrice),s).toString();p=new Ut().asset(r).isBuy(!n).price(k).size(m).reduceOnly(!0).triggerOrder(P,!0,"tp").build()}let f;if(o?.sl){let k=Mt(new b(o.sl.triggerPrice).multipliedBy(n?1-co:1+co),s),P=Mt(new b(o.sl.triggerPrice),s).toString();f=new Ut().asset(r).isBuy(!n).price(k).size(m).reduceOnly(!0).triggerOrder(P,!0,"sl").build()}let g=[p,f].filter(Boolean),w=new zr(g,d),y=Xe(),S={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:w.hash(null,y)}},x=await this.perps.exchangeAction(w,S,y),T=x.response.data?.statuses.find(k=>k==="error"||k?.error);if(T){let k=typeof T=="string"?"Operation failed":T.error;throw new Error(k)}let _=x.response.data?.statuses.find(k=>k==="resting"||k?.resting);if(_&&typeof _=="object"&&_.resting&&_.resting.oid)return JSON.stringify(x.response.data?.statuses);throw new Error("No order status found")}async removeOrders(e,r){let n=r.map(p=>new tl().asset(e).orderId(Number(p)).build()),s=new rl(n),o=Xe(),c={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:s.hash(null,o)}},d=await this.perps.exchangeAction(s,c,o),m=d.response.data?.statuses.find(p=>p==="error"||p?.error);if(m){let p=typeof m=="string"?"Operation failed":m.error;throw new Error(p)}if(d.response.data?.statuses&&d.response.data?.statuses.length>0&&d.response.data?.statuses.every(p=>p==="success"||p?.success))return JSON.stringify({orderIds:n});throw new Error("Cancel operation failed")}};u();l();u();l();var WT=U(yo());var ol=class{static{a(this,"UpdateLeverageAction")}type="updateLeverage";asset;isCross;leverage;constructor(e){this.asset=e.asset,this.isCross=e.isCross,this.leverage=e.leverage}hash(e,r){let n=or(this),s=e===null?9:29,o=new Uint8Array(n.length+s);o.set(n);let c=new DataView(o.buffer,o.byteOffset,o.byteLength);return c.setBigUint64(n.length,BigInt(r)),e===null?c.setUint8(n.length+8,0):(c.setUint8(n.length+8,1),o.set(FD(e),n.length+9)),`0x${(0,WT.keccak256)(o)}`}};function FD(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}a(FD,"addressToBytes");u();l();function nm(t){switch(t.type){case"preparingTransaction":case"updatingLeverage":case"leverageUpdated":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"creatingPosition":case"orderSucceeded":return ZT(t);case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":return{...ZT(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}a(nm,"getOpenPositionStateLogsDetails");var ZT=a(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbol:t.market.symbol,assetId:t.market.assetId.toString(),direction:t.direction,margin:t.margin.toString(),leverage:t.leverage.toString(),size:t.size.toString(),sizeInCoin:t.sizeInCoin.toString(),estimatedLiquidationPrice:t.estimatedLiquidationPrice?.toString()||"N/A",fee:t.fee?.toString()||"N/A",action:t.action,stopLoss:t.autoClose?.sl?.dollar||"N/A",takeProfit:t.autoClose?.tp?.dollar||"N/A"},"getBaseLogsDetails");u();l();var il=class{static{a(this,"OpenPositionStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in OpenPositionStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateOpenPosition":{let{market:n,direction:s,margin:o,leverage:c,autoClose:d,estimatedLiquidationPrice:m,fee:p,action:f,limitPrice:g,sizeInCoin:w}=r.payload,y=new b(n.currentPrice),S,x,T;return f==="reverse"&&w?(x=w.abs().multipliedBy(2),T=w.abs(),S=x.multipliedBy(y)):(S=new b(o).multipliedBy(c),x=y.isGreaterThan(0)?S.dividedBy(y):new b(0),T=x),{type:"preparingTransaction",...{market:n,direction:s,margin:o,leverage:c,autoClose:d,size:S,sizeInCoin:x,displaySizeInCoin:T,estimatedLiquidationPrice:m,fee:p,action:f,limitPrice:g}}}case"PrepareCollateralInitiated":{if(e.type==="preparingTransaction")return{type:"preparingCollateral",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PrepareCollateralNotRequired":case"PrepareCollateralSuccess":{if(e.type==="preparingCollateral"||e.type==="preparingTransaction"){let n=r.type==="PrepareCollateralSuccess"?r.effectiveMargin:void 0,s=n??e.margin,o=n?n.multipliedBy(e.leverage):e.size,c=new b(e.market.currentPrice),d=e.sizeInCoin;n&&(d=c.isGreaterThan(0)?o.dividedBy(c):new b(0));let m=n?d:e.displaySizeInCoin;return{type:"collateralPrepared",market:e.market,direction:e.direction,margin:s,leverage:e.leverage,autoClose:e.autoClose,size:o,sizeInCoin:d,displaySizeInCoin:m,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice}}break}case"PrepareCollateralFailure":{if(e.type==="preparingCollateral")return{type:"collateralPreparationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"InitiateUpdateLeverage":{if(e.type==="collateralPrepared")return e;break}case"UpdateLeverageInitiated":{if(e.type==="collateralPrepared")return{type:"updatingLeverage",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"UpdateLeverageSuccess":{if(e.type==="updatingLeverage")return{type:"leverageUpdated",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"UpdateLeverageFailure":{if(e.type==="updatingLeverage")return{type:"leverageUpdateFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeInitiated":{if(e.type==="leverageUpdated"||e.type==="collateralPrepared")return{type:"registeringBuilder",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(e.type==="registeringBuilder")return{type:"builderRegistered",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeFailure":{if(e.type==="registeringBuilder")return{type:"builderRegistrationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralInitiated":{if(e.type==="builderRegistered")return{type:"registeringReferral",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(e.type==="registeringReferral")return{type:"referralRegistered",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralFailure":{if(e.type==="registeringReferral")return{type:"referralRegistrationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationInitiated":{if(e.type==="referralRegistered")return{type:"creatingPosition",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationSuccess":{if(e.type==="creatingPosition")return{type:"orderSucceeded",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationFailure":{if(e.type==="creatingPosition")return{type:"orderFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,displaySizeInCoin:e.displaySizeInCoin,error:r.error,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){let r=this.state;this.listeners.forEach(n=>{queueMicrotask(()=>{n.onOpenPositionStateChange(e,r)})})}};var uo=.1,al=class{static{a(this,"OpenPositionOrchestrator")}stateMachine=new il;perps;warmedLeverage=new Map;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onOpenPositionStateChange:a((e,r)=>{this.handleStateChange(e,r)},"onOpenPositionStateChange")};stateLogsListener={onOpenPositionStateChange:a((e,r)=>{switch(r.type){case"orderSucceeded":E.addBreadcrumb(I.Perps,`Open position succeeded: ${r.type}`,F.Info,nm(r));break;case"collateralPreparationFailed":case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":E.addBreadcrumb(I.Perps,`Open position failed: ${r.type}`,F.Error,nm(r));break;default:E.addBreadcrumb(I.Perps,`Open position state change: ${e.type} -> ${r.type}`,F.Info);break}(r.type==="orderSucceeded"||r.type==="orderFailed"||r.type==="collateralPreparationFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onOpenPositionStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateOpenPosition":this.stateMachine.send({type:"PrepareCollateralInitiated"});break;case"PrepareCollateralInitiated":r.type==="preparingCollateral"&&await this.prepareCollateral(r);break;case"PrepareCollateralNotRequired":case"PrepareCollateralSuccess":r.type==="collateralPrepared"&&(r.action==="reduce"||r.action==="reverse"?this.stateMachine.send({type:"RegisterBuilderCodeInitiated"}):this.stateMachine.send({type:"InitiateUpdateLeverage",payload:{isCross:!1,leverage:r.leverage}}));break;case"InitiateUpdateLeverage":this.stateMachine.send({type:"UpdateLeverageInitiated"});break;case"UpdateLeverageInitiated":r.type==="updatingLeverage"&&await this.ensureLeverage(r);break;case"UpdateLeverageSuccess":r.type==="leverageUpdated"&&this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"InitiateRegisterBuilder":this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"RegisterBuilderCodeInitiated":r.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":r.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"InitiateRegisterReferral":this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":r.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":r.type==="referralRegistered"&&this.stateMachine.send({type:"PositionCreationInitiated"});break;case"PositionCreationInitiated":r.type==="creatingPosition"&&await this.createPosition(r);break}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){this.stateMachine.addListener(e)}removeListener(e){this.stateMachine.removeListener(e)}warmLeverage(e){let r=this.getLeverageWarmKey(e.assetId,e.leverage);if(!r||this.warmedLeverage.has(r))return;let n=this.updateLeverage(e.assetId,e.leverage).catch(s=>{throw this.warmedLeverage.delete(r),E.addBreadcrumb(I.Perps,"Warm leverage failed",F.Error,{error:s instanceof Error?s.message:"Unknown error"}),s});this.warmedLeverage.set(r,n)}async prepareCollateral(e){try{let{collateralToken:r}=e.market,{action:n}=e;if(!r||n==="reduce"||n==="reverse"){this.stateMachine.send({type:"PrepareCollateralNotRequired"});return}let s=e.margin;await this.perps.transfer({toPerp:!1,amount:s}),E.addBreadcrumb(I.Perps,"Transferred USDC from perp to spot for collateral",F.Info,{amount:s.toString()});let o=await this.perps.spot.swapUsdcToCollateral(r.pairIndex,s),c=new b(o.totalSz).multipliedBy(o.avgPx);E.addBreadcrumb(I.Perps,"Swapped USDC to collateral token",F.Info,{pairIndex:r.pairIndex,requestedAmount:s.toString(),effectiveMargin:c.toString(),totalSz:o.totalSz,avgPx:o.avgPx}),this.stateMachine.send({type:"PrepareCollateralSuccess",effectiveMargin:c})}catch(r){E.addBreadcrumb(I.Perps,"Failed to prepare collateral",F.Error,{error:r instanceof Error?r.message:"Unknown error"}),this.stateMachine.send({type:"PrepareCollateralFailure",error:r})}}getLeverageWarmKey(e,r){let n=this.perps.getUser();return n?JSON.stringify({user:n.address.toLowerCase(),assetId:e,leverage:r.toString(),isCross:!1,isTestnet:this.perps.isTestnet}):null}async ensureLeverage(e){try{let r=e.market.assetId,n=e.leverage,s=this.getLeverageWarmKey(r,n);if(!s){await this.updateLeverage(r,n),this.stateMachine.send({type:"UpdateLeverageSuccess"});return}let o=this.warmedLeverage.get(s);o?await o:await this.updateLeverage(r,n),this.stateMachine.send({type:"UpdateLeverageSuccess"})}catch(r){this.stateMachine.send({type:"UpdateLeverageFailure",error:r})}}async updateLeverage(e,r){let n=new ol({asset:e,isCross:!1,leverage:r.toNumber()}),s=Xe(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:n.hash(null,s)}},d=(await this.perps.exchangeAction(n,o,s)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error)}async registerBuilder(){try{if(!bn()){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing"||!e.positionFees.builder)throw new Error("position fees not found");if(e.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let r=e.positionFees.builder.address,n=`${Number(e.positionFees.phantomFee.toString())*100}%`,s=Xe(),o={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:n,builder:r,nonce:s},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ze,"HyperliquidTransaction:ApproveBuilderFee":zu},message:o},m=(await this.perps.exchangeAction(o,c,s)).response.data?.statuses?.find(p=>typeof p=="object"&&"error"in p);if(m&&typeof m=="object"&&"error"in m)throw new Error(m.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:e})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing")throw new Error("position fees not found");if(!e.positionFees.referral||e.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let r=e.positionFees.referral.code,n=new ao({code:r}),s=Xe(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:n.hash(null,s)}},d=(await this.perps.exchangeAction(n,o,s)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error);this.stateMachine.send({type:"RegisterReferralSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterReferralFailure",error:e})}}async createPosition(e){try{let r=e.action==="reverse",n=r?e.sizeInCoin.toString():e.size.toString(),s=await this.createOrder(e.market.assetId,n,e.direction==="long",e.limitPrice?e.limitPrice.toString():e.market.currentPrice.toString(),e.market.szDecimals,e.autoClose,e.action==="reduce",e.limitPrice?"limit":"market",r);this.stateMachine.send({type:"PositionCreationSuccess",payload:s})}catch(r){this.stateMachine.send({type:"PositionCreationFailure",error:r})}}async createOrder(e,r,n,s,o,c,d,m="market",p=!1){let f=m==="limit"?Mt(new b(s),o):Mt(new b(s).multipliedBy(n?1+uo:1-uo),o),g;if(bn()){let G=this.perps.getPositionFeesState();if(G.type!=="positionFees"&&G.type!=="refreshing"||!G.positionFees.builder)throw new Error("position fees not found");g={b:G.positionFees.builder.address.toLowerCase(),f:Number(G.positionFees.phantomFee)*100*100*10}}let w=p?Ii(new b(r),o,b.ROUND_DOWN):Ii(new b(r).dividedBy(new b(s)),o,b.ROUND_DOWN),y;m==="limit"?y=new Ut().asset(e).isBuy(n).price(f).size(w).reduceOnly(d??!1).limitOrder().build():y=new Ut().asset(e).isBuy(n).price(f).size(w).reduceOnly(d??!1).immediateOrCancel().build();let S;if(c?.tp?.dollar){let G=Mt(new b(c.tp.dollar),o).toString(),M=Mt(new b(c.tp.dollar).multipliedBy(n?1+uo:1-uo),o);S=new Ut().asset(e).isBuy(!n).price(M).size(w).reduceOnly(!0).triggerOrder(G,!0,"tp").build()}let x;if(c?.sl?.dollar){let G=Mt(new b(c.sl.dollar),o).toString(),M=Mt(new b(c.sl.dollar).multipliedBy(n?1+uo:1-uo),o);x=new Ut().asset(e).isBuy(!n).price(M).size(w).reduceOnly(!0).triggerOrder(G,!0,"sl").build()}let T=[y,S,x].filter(Boolean),_=new zr(T,g),k=Xe(),P={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:_.hash(null,k)}},v=await this.perps.exchangeAction(_,P,k),z=v.response.data?.statuses?.find(G=>typeof G=="object"&&"error"in G);if(z&&typeof z=="object"&&"error"in z)throw new Error(z.error);let Q=v.response.data?.statuses.find(G=>typeof G=="object"&&"filled"in G),R=v.response.data?.statuses.find(G=>typeof G=="object"&&"resting"in G);if(Q&&typeof Q=="object"&&"filled"in Q||R)return JSON.stringify(v.response.data?.statuses);throw new Error("No filled status found")}};u();l();var cl=class{static{a(this,"PositionFeesStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingPositionFeesStart":switch(this.state.type){case"positionFees":return{type:"refreshing",positionFees:this.state.positionFees};case"refreshing":return{type:"refreshing",positionFees:this.state.positionFees};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesStart`)}case"fetchingPositionFeesSuccess":switch(this.state.type){case"loading":case"refreshing":case"positionFees":return{type:"positionFees",positionFees:e.fees};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesSuccess`)}case"fetchingPositionFeesError":return{type:"error",error:e.error}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPositionFeesStateChange(this.state)})}};u();l();var sm=["1H","1D","1W","1M","YTD","ALL"],ul=class{static{a(this,"PricingStateMachine")}listeners=[];state={type:"indeterminate"};nextRequestId=1;send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"initiateSequentialFetch":{let r={"1H":{type:"idle"},"1D":{type:"idle"},"1W":{type:"idle"},"1M":{type:"idle"},YTD:{type:"idle"},ALL:{type:"idle"}};return{type:"multiInterval",activeCoin:e.coin,requestId:this.nextRequestId++,intervals:r,currentlyFetchingInterval:null,sequenceComplete:!1}}case"fetchingIntervalStart":return this.state.type!=="multiInterval"?this.state:e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin?this.state:{...this.state,intervals:{...this.state.intervals,[e.interval]:{type:"loading"}},currentlyFetchingInterval:e.interval};case"fetchingIntervalSuccess":{if(this.state.type!=="multiInterval")return this.state;if(e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin)return this.state;let r={...this.state.intervals,[e.interval]:{type:"loaded",candleSnapshots:e.candleSnapshots}},n=sm.every(s=>{let o=r[s];return o.type==="loaded"||o.type==="error"});return{type:"multiInterval",activeCoin:this.state.activeCoin,requestId:this.state.requestId,intervals:r,currentlyFetchingInterval:null,sequenceComplete:n}}case"fetchingIntervalError":{if(this.state.type!=="multiInterval")return this.state;if(e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin)return this.state;let r={...this.state.intervals,[e.interval]:{type:"error",error:e.error}},n=sm.every(s=>{let o=r[s];return o.type==="loaded"||o.type==="error"});return{type:"multiInterval",activeCoin:this.state.activeCoin,requestId:this.state.requestId,intervals:r,currentlyFetchingInterval:null,sequenceComplete:n}}case"sequentialFetchComplete":return this.state.type!=="multiInterval"?this.state:{...this.state,sequenceComplete:!0};default:return this.state}}getState(){return this.state}getNextIntervalToFetch(){if(this.state.type!=="multiInterval")return null;for(let e of sm)if(this.state.intervals[e].type==="idle")return e;return null}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPricingStateChange(this.state)})}};u();l();var ll=.98,dl=class{static{a(this,"Spot")}perps;perpsClient;constructor(e,r){this.perps=e,this.perpsClient=r}async getSpotBalances(e){let r=D({address:e,chainId:Tn.Mainnet,resourceType:W.address});return(await this.perpsClient.getSpotBalances({user:r})).balances}async buy(e,r,n){let s=new b(n).dividedBy(ll).decimalPlaces(2);return this.placeBuySellOrder(e,r,!0,s.toString())}async sell(e,r,n){let s=new b(n).multipliedBy(ll).decimalPlaces(2);return this.placeBuySellOrder(e,r,!1,s.toString())}async placeBuySellOrder(e,r,n,s){if(!this.perps.user?.address)throw new Error("User not found");let c=new Ut().asset(e).isBuy(n).price(s).size(r).reduceOnly(!1).immediateOrCancel().build(),d=new zr([c]),m=Xe(),p={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ze,Agent:Ot},message:{source:this.perps.isTestnet?"b":"a",connectionId:d.hash(null,m)}},f=await this.perps.exchangeAction(d,p,m),g=f.response.data?.statuses.find(y=>typeof y=="object"&&"error"in y);if(g&&typeof g=="object"&&"error"in g)throw new Error(g.error);let w=f.response.data?.statuses.find(y=>typeof y=="object"&&"filled"in y);if(w&&typeof w=="object"&&"filled"in w)return{totalSz:w.filled.totalSz,avgPx:w.filled.avgPx};throw new Error("No filled status found")}async send(e,r,n,s){let o=`${e}:${r}`,c=Xe(),d=new Yu({hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",token:o,amount:n.toString(),destination:s.toLowerCase(),time:c}),m={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SpotSend",types:{EIP712Domain:ze,"HyperliquidTransaction:SpotSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:d},{splitSignature:p}=await this.perps.sign(m),f=await this.perpsClient.postSpotSend({action:d,nonce:c,signature:p});if(f.status==="err")throw new Error(f.response);return f.response}async getTokenMidPrice(e){let r=await this.perpsClient.getTokenDetails({tokenId:e});return new b(r.midPx)}async swapCollateralToUsdc(e,r,n){let s=new b(1),o=await this.sell(e,n.decimalPlaces(2,b.ROUND_DOWN).toString(),s);return{symbol:r,amount:n.toString(),usdcReceived:new b(o.totalSz).multipliedBy(o.avgPx).toString()}}async swapUsdcToCollateral(e,r){let n=new b(1);return this.buy(e,r.decimalPlaces(2,b.ROUND_DOWN).toString(),n)}async pollForUsdcBalance(e,r=10,n=1e3){for(let s=0;s<r;s++){let c=(await this.getSpotBalances(e)).find(d=>d.token.address==="USDC");if(c&&new b(c.amount).gte(.01))return new b(c.amount);s<r-1&&await new Promise(d=>setTimeout(d,n))}return null}};var pl=class{static{a(this,"Perps")}client;accountBalanceStateMachine=new Qu;positionsStateMachine=new Vu;pricingStateMachine=new ul;positionFeesStateMachine=new cl;signer=void 0;fundingHistoryStateMachine=new Hu;historicalOrdersStateMachine=new Gu;openPositionOrchestrator;managePositionOrchestrator;manageMarginOrchestrator;accountChangeListeners=[];account;user;isTestnet;spot;fundingPool;relayFundingTaskFactory;hyperunitFundingTaskFactory;sequentialPricingCoin=null;pricingRequestId=null;authRepository;constructor({client:e,isTestnet:r,fundingPool:n,relayFundingTaskFactory:s,hyperunitFundingTaskFactory:o,authRepository:c}){this.client=e,this.isTestnet=r,this.spot=new dl(this,this.client),this.fundingPool=n,this.fundingPool.addListener(this.fundingPoolListener),this.relayFundingTaskFactory=s,this.hyperunitFundingTaskFactory=o,this.openPositionOrchestrator=new al(this),this.managePositionOrchestrator=new sl(this),this.manageMarginOrchestrator=new Ju(this),this.authRepository=c,this.pricingStateMachine.addListener({onPricingStateChange:this.handlePricingStateChange.bind(this)}),this.accountBalanceStateMachine.addListener({onAccountBalanceStateChange:a(d=>{this.enableDexAbstraction(d),this.autoConsolidateCollateral(d)},"onAccountBalanceStateChange")})}setSigner(e){this.signer=e}createRelayFundingTask(e,r,n,s){return this.relayFundingTaskFactory.createTask(this,e,this.authRepository,r,n,wn(this.signer),wn(this.user),s)}createHyperunitFundingTask(e,r,n,s){return this.hyperunitFundingTaskFactory.createTask(this,e,this.authRepository,r,n,wn(this.signer),wn(this.user),s)}executeFundingTask(e,r,n,s,o){this.fundingPool.submit(e,r,n,s,o)}fundingPoolListener={onFundingPoolStateChange:a((e,r)=>{(e.type==="fundingCompleted"||e.type==="fundingStarted")&&(this.syncAccountBalance(),this.syncFundingHistory())},"onFundingPoolStateChange")};setAccount(e){this.resetAllState(),this.account=e;let{address:r}=e.addresses?.find(n=>A.isEVMNetworkID(n.networkID))??{addressType:ie.EVM,networkID:te.Ethereum.Mainnet};r&&(this.user={resourceType:W.address,chainId:this.isTestnet?"hypercore:testnet":A.hypercore.mainnetID,address:r},this.fundingPool.setAccountId(r)),this.accountChangeListeners.forEach(n=>n.onAccountChange(e))}resetAllState(){this.accountBalanceStateMachine.reset(),this.positionsStateMachine.reset(),this.fundingHistoryStateMachine.reset(),this.historicalOrdersStateMachine.reset(),this.positionFeesStateMachine.reset()}getAccount(){return this.account}getUser(){return this.user}subscribeAccountChange(e){return this.accountChangeListeners.push(e),()=>this.unsubscribeAccountChange(e)}unsubscribeAccountChange(e){this.accountChangeListeners=this.accountChangeListeners.filter(r=>r!==e)}getAccountBalanceState(){return this.accountBalanceStateMachine.getState()}syncAccountBalance(){if(!this.user)return;let e=this.accountBalanceStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceStart"}),this.client.getAccountBalance(this.user).then(r=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceSuccess",accountBalance:r})}).catch(r=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceError",error:r}),E.addBreadcrumb(I.Perps,"Error fetching account balance",F.Info,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribeAccountBalanceState(e){return this.accountBalanceStateMachine.addListener(e),()=>{this.unsubscribeAccountBalanceState(e)}}unsubscribeAccountBalanceState(e){this.accountBalanceStateMachine.removeListener(e)}getPositionFeesState(){return this.positionFeesStateMachine.getState()}syncPositionFees(){if(!this.user)return;let e=this.positionFeesStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.positionFeesStateMachine.send({type:"fetchingPositionFeesStart"}),this.client.getPositionFees(this.user).then(r=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesSuccess",fees:r})}).catch(r=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesError",error:r}),E.addBreadcrumb(I.Perps,"Error fetching position fees",F.Info,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribePositionFees(e){return this.positionFeesStateMachine.addListener(e),()=>{this.unsubscribePositionFees(e)}}unsubscribePositionFees(e){this.positionFeesStateMachine.removeListener(e)}getPositionsState(){return this.positionsStateMachine.getState()}syncPositions(){if(!this.user)return;let e=this.positionsStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.positionsStateMachine.send({type:"fetchingPositionsStart"}),this.client.getPositionsAndOpenOrders(this.user).then(r=>{this.positionsStateMachine.send({type:"fetchingPositionsSuccess",positions:r.positions,openOrders:r.openOrders})}).catch(r=>{this.positionsStateMachine.send({type:"fetchingPositionsError",error:r}),E.addBreadcrumb(I.Perps,"Error fetching positions",F.Info,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribePositions(e){return this.positionsStateMachine.addListener(e),()=>{this.unsubscribePositions(e)}}unsubscribePositions(e){this.positionsStateMachine.removeListener(e)}getFundingHistoryState(){return this.fundingHistoryStateMachine.getState()}syncFundingHistory(){if(!this.user)return;let e=this.fundingHistoryStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryStart"}),this.client.getUserFundingHistory(this.user).then(r=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistorySuccess",history:r})}).catch(r=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryError",error:r}),E.addBreadcrumb(I.Perps,"Error fetching funding history",F.Info,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribeFundingHistory(e){return this.fundingHistoryStateMachine.addListener(e),()=>{this.unsubscribeFundingHistory(e)}}unsubscribeFundingHistory(e){this.fundingHistoryStateMachine.removeListener(e)}getHistoricalOrdersState(){return this.historicalOrdersStateMachine.getState()}syncHistoricalOrders(e){if(!this.user)return;let r=this.historicalOrdersStateMachine.getState();r.type==="loading"||r.type==="refreshing"||(this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersStart"}),this.client.getHistoricalOrders(this.user,e).then(n=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersSuccess",historicalOrders:n})}).catch(n=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersError",error:n}),E.addBreadcrumb(I.Perps,"Error fetching historical orders",F.Info,{error:n instanceof Error?n.message:"Unknown error",markets:e?.join(",")??"No markets"})}))}subscribeHistoricalOrders(e){return this.historicalOrdersStateMachine.addListener(e),()=>{this.unsubscribeHistoricalOrders(e)}}unsubscribeHistoricalOrders(e){this.historicalOrdersStateMachine.removeListener(e)}getPricingState(){return this.pricingStateMachine.getState()}syncPricing(e,r,n,s){if(!this.user)return;let o;switch(r){case"1m":o="1H";break;case"15m":o="1D";break;case"1h":o="1W";break;case"4h":o="1M";break;case"1d":o="ALL";break;default:o="1D"}let c=this.pricingStateMachine.getState();(c.type!=="multiInterval"||c.activeCoin!==e)&&this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:e});let d=this.pricingStateMachine.getState(),m=d.type==="multiInterval"?d.requestId:null;m!=null&&(this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:o,coin:e,requestId:m,apiInterval:r,startTime:n,endTime:s}),this.client.getPriceHistory({coin:e,interval:o,startTime:n,endTime:s,isTestnet:this.isTestnet}).then(p=>{let f=em(p);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:o,coin:e,requestId:m,candleSnapshots:f})}).catch(p=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:o,coin:e,requestId:m,error:p}),E.addBreadcrumb(I.Perps,"Error fetching pricing",F.Info,{error:p instanceof Error?p.message:"Unknown error",coin:e,interval:r,startTime:n,endTime:s})}))}getTimeFrameDetails(e,r){let n=r,s,o;switch(e){case"1H":s=r-1e3*60*60*1,o="1m";break;case"1D":s=r-1e3*60*60*24,o="30m";break;case"1W":s=r-1e3*60*60*24*7,o="4h";break;case"1M":s=r-1e3*60*60*24*30,o="12h";break;case"YTD":s=new Date(new Date().getFullYear(),0,1).getTime(),o="1d";break;case"ALL":s=r-1e3*60*60*24*365*10,o="1d";break}return{startTime:s,endTime:n,apiInterval:o}}startSequentialPricingSync(e){this.sequentialPricingCoin=e,this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:e});let r=this.pricingStateMachine.getState();this.pricingRequestId=r.type==="multiInterval"?r.requestId:null,this.fetchNextInterval()}fetchNextInterval(){let e=this.pricingStateMachine.getNextIntervalToFetch();if(!e||!this.sequentialPricingCoin)return;let r=this.pricingRequestId;if(r==null)return;let n=new Date().getTime(),{startTime:s,endTime:o,apiInterval:c}=this.getTimeFrameDetails(e,n);this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:e,coin:this.sequentialPricingCoin,requestId:r,apiInterval:c,startTime:s,endTime:o}),this.client.getPriceHistory({coin:this.sequentialPricingCoin,interval:c,startTime:s,endTime:o,isTestnet:this.isTestnet}).then(d=>{let m=em(d);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:e,coin:this.sequentialPricingCoin,requestId:r,candleSnapshots:m})}).catch(d=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:e,coin:this.sequentialPricingCoin,requestId:r,error:d}),E.addBreadcrumb(I.Perps,"Error fetching next pricing interval",F.Info,{error:d instanceof Error?d.message:"Unknown error",coin:this.sequentialPricingCoin,interval:e,apiInterval:c,startTime:s,endTime:new Date(o).toISOString()})})}handlePricingStateChange(e){e.type==="multiInterval"&&!e.currentlyFetchingInterval&&!e.sequenceComplete&&setTimeout(()=>{this.fetchNextInterval()},100)}isEnablingDexAbstraction=!1;dexAbstractionRetryCount=0;isConsolidatingCollateral=!1;async enableDexAbstraction(e){if(e.type==="accountBalance"){if(e.accountBalance.dexAbstraction){this.dexAbstractionRetryCount=0;return}if(new b(e.accountBalance.accountValue).gt(0)&&!(this.dexAbstractionRetryCount>=5)&&this.user&&!this.isEnablingDexAbstraction){this.isEnablingDexAbstraction=!0,this.dexAbstractionRetryCount++;try{await this.setUserDexAbstraction({enabled:!0}),E.addBreadcrumb(I.Perps,"DEX abstraction enabled",F.Info),this.dexAbstractionRetryCount=0}catch(r){E.addBreadcrumb(I.Perps,"Failed to enable DEX abstraction",F.Info,{error:r instanceof Error?r.message:"Unknown error",retryAttempt:this.dexAbstractionRetryCount})}finally{this.isEnablingDexAbstraction=!1}}}}async autoConsolidateCollateral(e){if(!(e.type!=="accountBalance"||!(e.accountBalance.collateralBalances??[]).some(s=>s.pairIndex!==void 0&&new b(s.total).minus(s.hold).gt(.01)))&&!(!this.user||this.isConsolidatingCollateral))try{let s=await this.consolidateCollateralBalances();(s.swapped.length>0||s.transferred!=="0")&&E.addBreadcrumb(I.Perps,"Auto-consolidated collateral balances",F.Info,{swappedCount:s.swapped.length,transferred:s.transferred,errorsCount:s.errors.length})}catch(s){E.addBreadcrumb(I.Perps,"Failed to auto-consolidate collateral",F.Info,{error:s instanceof Error?s.message:"Unknown error"})}}subscribePricing(e){return this.pricingStateMachine.addListener(e),()=>{this.unsubscribePricing(e)}}unsubscribePricing(e){this.pricingStateMachine.removeListener(e)}async sign(e){let r=wn(this.signer),n=wn(this.account),{signature:s}=await r.sign(n.identifier,{chainType:ie.EVM,signingType:"typedData",version:4,data:e});return{splitSignature:XT(s),rawSignature:s}}async exchangeAction(e,r,n){let s=new jn,o=wn(this.signer),c=wn(this.account),{signature:d}=await o.sign(c.identifier,{chainType:ie.EVM,signingType:"typedData",version:4,data:r}),m=XT(d),p=await s.postExchange({action:e,nonce:n,signature:{r:m.r,s:m.s,v:m.v},isTestnet:this.isTestnet});if(p.status==="err")throw new Error(p.response);if(p.status==="ok")return p;throw new Error("Unknown response status")}async transfer(e){let{toPerp:r,amount:n}=e,s=Xe(),o={type:"usdClassTransfer",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:n.toString(),toPerp:r,nonce:s},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdClassTransfer",types:{EIP712Domain:ze,"HyperliquidTransaction:UsdClassTransfer":[{name:"hyperliquidChain",type:"string"},{name:"amount",type:"string"},{name:"toPerp",type:"bool"},{name:"nonce",type:"uint64"}]},message:o},{splitSignature:d}=await this.sign(c),p=await new jn().postExchange({action:o,nonce:s,signature:d,isTestnet:this.isTestnet});if(p.status==="err")throw new Error(p.response);return p}async sendAsset(e){let{destination:r,sourceDex:n,destinationDex:s,token:o,amount:c,vaultAddress:d}=e,m=Xe(),p={type:"sendAsset",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",destination:r.toLowerCase(),sourceDex:n,destinationDex:s,token:o,amount:c.toString(),fromSubAccount:d?d.toLowerCase():"",nonce:m},f={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SendAsset",types:{EIP712Domain:ze,"HyperliquidTransaction:SendAsset":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"sourceDex",type:"string"},{name:"destinationDex",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"fromSubAccount",type:"string"},{name:"nonce",type:"uint64"}]},message:p},{splitSignature:g}=await this.sign(f),y=await new jn().postExchange({action:p,nonce:m,signature:g,isTestnet:this.isTestnet});if(y.status==="err")throw new Error(y.response);return y}async setUserDexAbstraction(e){let{enabled:r}=e;if(!this.user)throw new Error("User not set");let n=Xe(),s={type:"userDexAbstraction",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",user:this.user.address,enabled:r,nonce:n},o={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UserDexAbstraction",types:{EIP712Domain:ze,"HyperliquidTransaction:UserDexAbstraction":[{name:"hyperliquidChain",type:"string"},{name:"user",type:"address"},{name:"enabled",type:"bool"},{name:"nonce",type:"uint64"}]},message:s},{splitSignature:c}=await this.sign(o),m=await new jn().postExchange({action:s,nonce:n,signature:c});if(m.status==="err")throw new Error(m.response);return m}async consolidateCollateralBalances(){if(!this.user)throw new Error("User not set");if(this.isConsolidatingCollateral)throw new Error("Collateral consolidation already in progress");this.isConsolidatingCollateral=!0;try{let e=await this.client.getAccountBalance(this.user),{swapped:r,errors:n}=await this.swapCollateralBalancesToUsdc(e.collateralBalances??[]),s=await this.transferSpotUsdcToPerp(r.length>0);return this.syncAccountBalance(),{swapped:r,transferred:s,errors:n}}finally{this.isConsolidatingCollateral=!1}}async swapCollateralBalancesToUsdc(e){let r=[],n=[];for(let s of e){if(s.pairIndex===void 0)continue;let o=new b(s.total).minus(s.hold);if(!o.lte(.01))try{let c=await this.spot.swapCollateralToUsdc(s.pairIndex,s.symbol,o);r.push(c),E.addBreadcrumb(I.Perps,"Swapped collateral to USDC",F.Info,{symbol:s.symbol,amount:o.toString(),usdcReceived:c.usdcReceived})}catch(c){let d=c instanceof Error?c.message:"Unknown error";n.push({symbol:s.symbol,error:d}),E.addBreadcrumb(I.Perps,"Failed to swap collateral to USDC",F.Info,{symbol:s.symbol,error:d})}}return{swapped:r,errors:n}}async transferSpotUsdcToPerp(e){if(!this.user)return"0";let r=e?10:1,n=await this.spot.pollForUsdcBalance(this.user.address,r);if(!n||n.lte(.01))return"0";let s=n.decimalPlaces(2,b.ROUND_DOWN);return await this.transfer({toPerp:!0,amount:s}),E.addBreadcrumb(I.Perps,"Transferred USDC from spot to perp",F.Info,{amount:s.toString()}),s.toString()}async usdSendPerps(e){let{destination:r,amount:n}=e,s=Xe(),o=new el({hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:n.toString(),destination:r.toLowerCase(),time:s}),c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdSend",types:{EIP712Domain:ze,"HyperliquidTransaction:UsdSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:o},{splitSignature:d}=await this.sign(c),m=await this.client.postPerpsSend({action:o,nonce:s,signature:d});if(m.status==="err")throw new Error(m.response);return m.response}openPosition(e){this.openPositionOrchestrator.send({type:"InitiateOpenPosition",payload:e})}resetOpenPosition(){this.openPositionOrchestrator.send({type:"Reset"})}getOpenPositionState(){return this.openPositionOrchestrator.getState()}subscribeOpenPosition(e){return this.openPositionOrchestrator.addListener(e),()=>{this.unsubscribeOpenPosition(e)}}unsubscribeOpenPosition(e){this.openPositionOrchestrator.removeListener(e)}warmOpenPositionLeverage(e){this.openPositionOrchestrator.warmLeverage(e)}managePosition(e){this.managePositionOrchestrator.send({type:"InitiateManagePosition",payload:e})}resetManagePosition(){this.managePositionOrchestrator.send({type:"Reset"})}getManagePositionState(){return this.managePositionOrchestrator.getState()}subscribeManagePosition(e){return this.managePositionOrchestrator.addListener(e),()=>{this.unsubscribeManagePosition(e)}}unsubscribeManagePosition(e){this.managePositionOrchestrator.removeListener(e)}manageMargin(e){this.manageMarginOrchestrator.send({type:"InitiateManageMargin",payload:e})}resetManageMargin(){this.manageMarginOrchestrator.send({type:"Reset"})}getManageMarginState(){return this.manageMarginOrchestrator.getState()}subscribeManageMargin(e){return this.manageMarginOrchestrator.addListener(e)}};function wn(t,e){if(t==null)throw new Error(e||"Required value is undefined or null");return t}a(wn,"check");function XT(t){let e=`0x${t.slice(2,66)}`,r=`0x${t.slice(66,130)}`,n=parseInt(t.slice(130,132),16);return{r:e,s:r,v:n}}a(XT,"splitSignature");u();l();var Wn=U($());u();l();var q;(function(t){t.INSUFFICIENT_MARGIN="insufficient_margin",t.INSUFFICIENT_BALANCE="insufficient_balance",t.ORDER_VALUE_ERROR="order_value_error",t.NETWORK_ERROR="network_error",t.TIMEOUT_ERROR="timeout_error",t.RPC_ERROR="rpc_error",t.ACCOUNT_ERROR="account_error",t.POSITION_FEES_ERROR="position_fees_error",t.LEVERAGE_ERROR="leverage_error",t.ORDER_SIZE_ERROR="order_size_error",t.PRICE_ERROR="price_error",t.OPEN_INTEREST_CAP="open_interest_cap",t.REDUCE_ONLY_ERROR="reduce_only_error",t.NONCE_ERROR="nonce_error",t.RATE_LIMIT_ERROR="rate_limit_error",t.PARSING_ERROR="parsing_error",t.MULTI_SIG_REQUIRED="multi_sig_required",t.TRANSACTION_ERROR="transaction_error",t.SWAP_ERROR="swap_error",t.KEY_STORAGE_ERROR="key_storage_error",t.REFERRER_ERROR="referrer_error",t.INVALID_ORDER="invalid_order",t.WALLET_CONNECTION_ERROR="wallet_connection_error",t.RELAY_BRIDGE_ERROR="relay_bridge_error",t.DFLOW_ERROR="dflow_error",t.SYSTEM_PROGRAM_ERROR="system_program_error",t.TOKEN_ACCOUNT_ERROR="token_account_error",t.SLIPPAGE_ERROR="slippage_error",t.USER_CANCELLED="user_cancelled",t.UNKNOWN="unknown"})(q||(q={}));var JT={"99vQwtBwYtrqqD9YSXbdum3KBdxPAVxYTaQ3cfnJSrN2":{name:"Relay",category:q.RELAY_BRIDGE_ERROR},DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:{name:"DFlow",category:q.DFLOW_ERROR},ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL:{name:"Token Account",category:q.TOKEN_ACCOUNT_ERROR},"11111111111111111111111111111111":{name:"System Program",category:q.SYSTEM_PROGRAM_ERROR},JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:{name:"Jupiter Swap",category:q.SWAP_ERROR}},PD={"JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:6024":{message:"Swap slippage exceeded",category:q.SLIPPAGE_ERROR},"JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:6025":{message:"Swap slippage exceeded",category:q.SLIPPAGE_ERROR},"JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:6001":{message:"Swap route expired"},"JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:17":{message:"Swap arithmetic overflow"},"JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:18":{message:"Swap arithmetic underflow"},"JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4:13":{message:"Swap invalid input"},"99vQwtBwYtrqqD9YSXbdum3KBdxPAVxYTaQ3cfnJSrN2:1":{message:"Insufficient balance for deposit",category:q.INSUFFICIENT_BALANCE},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:1":{message:"DFlow instruction failed"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:17":{message:"DFlow arithmetic overflow"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:18":{message:"DFlow arithmetic underflow"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:15001":{message:"DFlow invalid account"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:15016":{message:"DFlow invalid signer"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:15020":{message:"DFlow invalid amount"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:15021":{message:"DFlow invalid token"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:3005":{message:"DFlow slippage exceeded",category:q.SLIPPAGE_ERROR},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:6027":{message:"DFlow quote expired"},"DF1ow4tspfHX9JwWJsAb9epbkA8hmpSEAtxXy1V27QBH:4294967295":{message:"DFlow program error"},"11111111111111111111111111111111:1":{message:"System program instruction failed"},"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL:1":{message:"Token account creation failed",category:q.INSUFFICIENT_BALANCE}},YT=[{pattern:/Insufficient margin to place order/i,category:q.INSUFFICIENT_MARGIN,humanReadable:"Insufficient margin to place order"},{pattern:/Isolated position does not have sufficient margin/i,category:q.INSUFFICIENT_MARGIN,humanReadable:"Insufficient margin for isolated position"},{pattern:/Insufficient balance for withdrawal/i,category:q.INSUFFICIENT_BALANCE,humanReadable:"Insufficient balance for withdrawal"},{pattern:/cpeInsufficientFundsForRent/i,category:q.INSUFFICIENT_BALANCE,humanReadable:"Deposit would leave insufficient SOL for account rent"},{pattern:/createAssociatedTokenAccountErrorInsufficientFunds/i,category:q.INSUFFICIENT_BALANCE,humanReadable:"Insufficient funds for token account"},{pattern:/InsufficientFunds/i,category:q.INSUFFICIENT_BALANCE,humanReadable:"Insufficient funds"},{pattern:/Order must have minimum value of \$\d+/i,category:q.ORDER_VALUE_ERROR,humanReadable:"Order below minimum value"},{pattern:/Order value too large/i,category:q.ORDER_VALUE_ERROR,humanReadable:"Order value too large"},{pattern:/Network request failed/i,category:q.NETWORK_ERROR,humanReadable:"Network request failed"},{pattern:/Network request timed out/i,category:q.TIMEOUT_ERROR,humanReadable:"Network request timed out"},{pattern:/fetchWithTimeoutAndRetry\(\).*timeout/i,category:q.TIMEOUT_ERROR,humanReadable:"Request timeout"},{pattern:/SolanaJSONRPCError/i,category:q.RPC_ERROR,humanReadable:"Solana RPC error"},{pattern:/An unknown RPC error occurred/i,category:q.RPC_ERROR,humanReadable:"RPC error"},{pattern:/Failed to fetch/i,category:q.NETWORK_ERROR,humanReadable:"Network request failed"},{pattern:/Load failed/i,category:q.NETWORK_ERROR,humanReadable:"Network request failed"},{pattern:/failed to get signature status:\s*Internal error/i,category:q.RPC_ERROR,humanReadable:"Failed to get signature status"},{pattern:/Error confirming transaction:\s*\{"InstructionError":\[\d+,\{"Custom":1\}\]\}/i,category:q.INSUFFICIENT_BALANCE,humanReadable:"Insufficient balance for deposit"},{pattern:/Must deposit before performing actions/i,category:q.ACCOUNT_ERROR,humanReadable:"Must deposit before performing actions"},{pattern:/User or API Wallet 0x[a-f0-9]+ does not exist/i,category:q.ACCOUNT_ERROR,humanReadable:"Account does not exist"},{pattern:/position fees not found/i,category:q.POSITION_FEES_ERROR,humanReadable:"Position fees not found"},{pattern:/Cannot switch leverage type with open position/i,category:q.LEVERAGE_ERROR,humanReadable:"Cannot change leverage with open position"},{pattern:/Invalid leverage value/i,category:q.LEVERAGE_ERROR,humanReadable:"Invalid leverage value"},{pattern:/Max leverage at current position/i,category:q.LEVERAGE_ERROR,humanReadable:"Position exceeds leverage limit"},{pattern:/Order has zero size/i,category:q.ORDER_SIZE_ERROR,humanReadable:"Order has zero size"},{pattern:/Price too far from oracle/i,category:q.PRICE_ERROR,humanReadable:"Price too far from oracle"},{pattern:/Order price cannot be more than 95% away/i,category:q.PRICE_ERROR,humanReadable:"Order price too far from reference"},{pattern:/Asset open interest is at cap/i,category:q.OPEN_INTEREST_CAP,humanReadable:"Asset open interest at cap"},{pattern:/Reduce only order would increase position/i,category:q.REDUCE_ONLY_ERROR,humanReadable:"Reduce-only order would increase position"},{pattern:/Invalid nonce: duplicate nonce/i,category:q.NONCE_ERROR,humanReadable:"Duplicate nonce"},{pattern:/Too many cumulative requests sent/i,category:q.RATE_LIMIT_ERROR,humanReadable:"Rate limit exceeded"},{pattern:/No quotes available for bridge/i,category:q.RELAY_BRIDGE_ERROR,humanReadable:"No bridge route available for this deposit"},{pattern:/No request ID found in Relay quote/i,category:q.RELAY_BRIDGE_ERROR,humanReadable:"Bridge quote missing request identifier"},{pattern:/Relay bridge failed with status:\s*refund/i,category:q.RELAY_BRIDGE_ERROR,humanReadable:"Bridge transfer was refunded"},{pattern:/Relay bridge failed with status:\s*failure/i,category:q.RELAY_BRIDGE_ERROR,humanReadable:"Bridge transfer failed"},{pattern:/Relay bridge status polling timed out/i,category:q.TIMEOUT_ERROR,humanReadable:"Bridge confirmation timed out"},{pattern:/Unexpected Relay bridge status/i,category:q.RELAY_BRIDGE_ERROR,humanReadable:"Unexpected bridge status"},{pattern:/Failed to get bridge status/i,category:q.NETWORK_ERROR,humanReadable:"Failed to fetch bridge status"},{pattern:/Failed to parse bridge status/i,category:q.PARSING_ERROR,humanReadable:"Failed to parse bridge status"},{pattern:/Failed to parse operations response/i,category:q.PARSING_ERROR,humanReadable:"Failed to parse bridge operations response"},{pattern:/Destination amount is required/i,category:q.PARSING_ERROR,humanReadable:"Bridge operation missing destination amount"},{pattern:/^Operation failed$/i,category:q.RELAY_BRIDGE_ERROR,humanReadable:"Bridge operation failed"},{pattern:/No source address found for networkID/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"Source wallet address not found"},{pattern:/Unsupported chain for deposit transfer/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"Unsupported network for deposit transfer"},{pattern:/No Solana address found for account/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"Solana wallet address not found"},{pattern:/No EVM address found for account/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"EVM wallet address not found"},{pattern:/User not found for swap/i,category:q.RPC_ERROR,humanReadable:"User session not found for swap"},{pattern:/Failed to parse spot bridge initialize response/i,category:q.PARSING_ERROR,humanReadable:"Failed to parse spot bridge initialize response, received undefined"},{pattern:/Failed to post perps send/i,category:q.PARSING_ERROR,humanReadable:"Response not okay from HL"},{pattern:/Multi-sig required/i,category:q.MULTI_SIG_REQUIRED,humanReadable:"Multi-sig required"},{pattern:/Invalid exchange response/i,category:q.PARSING_ERROR,humanReadable:"Invalid exchange response. Received undefined"},{pattern:/ZodError/i,category:q.PARSING_ERROR,humanReadable:"Response parsing error"},{pattern:/Cannot read propert/i,category:q.PARSING_ERROR,humanReadable:"Parsing error"},{pattern:/Cannot read properties of undefined/i,category:q.PARSING_ERROR,humanReadable:"Parsing error"},{pattern:/base64 encoded.*too large/i,category:q.TRANSACTION_ERROR,humanReadable:"Transaction too large"},{pattern:/VersionedTransaction too large/i,category:q.TRANSACTION_ERROR,humanReadable:"Transaction too large"},{pattern:/JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4.*customErrorCode/i,category:q.SWAP_ERROR,humanReadable:"Swap failed"},{pattern:/programId.*JUP/i,category:q.SWAP_ERROR,humanReadable:"Swap failed"},{pattern:/ExpoSecureStorage/i,category:q.KEY_STORAGE_ERROR,humanReadable:"Secure storage error"},{pattern:/No private key exists in storage/i,category:q.KEY_STORAGE_ERROR,humanReadable:"Private key not found"},{pattern:/Referrer already set/i,category:q.REFERRER_ERROR,humanReadable:"Referrer already set"},{pattern:/Only post-only orders allowed immediately after network upgrade/i,category:q.INVALID_ORDER,humanReadable:"Only post-only orders allowed after upgrade"},{pattern:/Invalid order$/i,category:q.INVALID_ORDER,humanReadable:"Invalid order"},{pattern:/Connect wallet/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"Connect wallet"},{pattern:/Provider is not connected to the requested chain/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"Wallet not connected to chain"},{pattern:/Missing client/i,category:q.WALLET_CONNECTION_ERROR,humanReadable:"Wallet client missing"},{pattern:/Missing assetId/i,category:q.INVALID_ORDER,humanReadable:"Missing assetId"},{pattern:/No active session found/i,category:q.RPC_ERROR,humanReadable:"RPC error"},{pattern:/Authenticator expired/i,category:q.RPC_ERROR,humanReadable:"RPC error"},{pattern:/Failed to sign typed data/i,category:q.RPC_ERROR,humanReadable:"RPC error"},{pattern:/Order has invalid price/i,category:q.PRICE_ERROR,humanReadable:"Order has invalid price"},{pattern:/Order could not immediately match against any resting orders/i,category:q.INVALID_ORDER,humanReadable:"Order could not immediately match against any resting orders"},{pattern:/Builder fee has not been approved/i,category:q.INVALID_ORDER,humanReadable:"Builder fee has not been approved"},{pattern:/^CancelledError$/i,category:q.USER_CANCELLED,humanReadable:"User cancelled"}];function vD(t){if(!t)return;let e=t.match(/Instruction #(\d+)/i);return e?parseInt(e[1],10):void 0}a(vD,"extractInstructionNumber");function RD(t){try{let e=JSON.parse(t);if(e?.data?.programId)return{programId:e.data.programId,errorCode:e.data.customErrorCode?.toString(),errorReason:e.data.errorReason,customErrorReason:e.data.customErrorReason,instructionNumber:vD(e.data.errorReason)}}catch{}return null}a(RD,"extractSolanaProgramError");function eE(t){try{let e=JSON.parse(t);if(e?.data?.errorReason)return e.data.errorReason;if(e?.data?.customErrorReason&&e.data.customErrorReason!=="Unknown Error")return e.data.customErrorReason;if(e?.message)return e.message;if(e?.transactionMessage)return e.transactionMessage;if(e?.name)return e.name}catch{}return null}a(eE,"extractErrorFromJson");function DD(t){let e=t.trim();if(!e||e==="{}")return"Unexpected error";if(e.startsWith("{")||e.startsWith("[")){let n=eE(e);return n&&n.trim()?n.trim():"Unexpected service error"}return e.replace(/^Error:\s*/i,"").replace(/\s+/g," ").trim()||"Unexpected error"}a(DD,"getGenericHumanReadableError");var ND="99vQwtBwYtrqqD9YSXbdum3KBdxPAVxYTaQ3cfnJSrN2";function BD(t){let e=RD(t);if(!e)return null;let{programId:r,errorCode:n,customErrorReason:s,instructionNumber:o}=e;if(r===ND&&(o===1||o===3))return{category:q.INSUFFICIENT_BALANCE,humanReadable:"Insufficient balance for deposit",rawError:t};if(n){let d=`${r}:${n}`,m=PD[d];if(m){let p=JT[r];return{category:m.category||p?.category||q.UNKNOWN,humanReadable:m.message,rawError:t}}}if(s&&s!=="Unknown Error"&&s==="createAssociatedTokenAccountErrorInsufficientFunds")return{category:q.INSUFFICIENT_BALANCE,humanReadable:"Insufficient funds for token account",rawError:t};let c=JT[r];if(c){let d=n?` (code ${n})`:"";return{category:c.category,humanReadable:`${c.name} error${d}`,rawError:t}}return null}a(BD,"parseSolanaProgramError");function om(t){if(!t||t==="{}"||t.trim()==="")return{category:q.UNKNOWN,humanReadable:"Unexpected error",rawError:t||""};let e=t;if(t.startsWith("{")||t.startsWith("[")){let r=eE(t);r&&(e=r)}for(let{pattern:r,category:n,humanReadable:s}of YT)if(r.test(e)||r.test(t))return{category:n,humanReadable:s,rawError:t};if(t!==e){for(let{pattern:r,category:n,humanReadable:s}of YT)if(r.test(t))return{category:n,humanReadable:s,rawError:t}}if(t.startsWith("{")){let r=BD(t);if(r)return r;try{let n=JSON.parse(t);if(n?.data?.errorReason&&/Program Error.*Instruction #\d+ Failed/i.test(n.data.errorReason)&&!n?.data?.programId)return{category:q.TRANSACTION_ERROR,humanReadable:"Solana program error",rawError:t}}catch{}}return{category:q.UNKNOWN,humanReadable:DD(t),rawError:t}}a(om,"parsePerpsError");u();l();function LD(){return be()}a(LD,"generateActionId");function Tr(t,e){let{action:r,status:n,action_id:s,metadata:o,failure_reason:c}=e,d={action:r,status:n,action_id:s,metadata:o};n==="failed"&&c!==void 0&&(d.failure_reason=c),t.capture("actionLifecycle",{data:d})}a(Tr,"captureLifecycleEvent");function ml(t,e){let r=LD();return{payload:{action:t,status:"attempted",action_id:r,metadata:e},actionId:r}}a(ml,"createAttemptedPayload");function fl(t,e,r){return{action:t,status:"succeeded",action_id:e,metadata:r}}a(fl,"createSucceededPayload");function hl(t,e,r,n){return{action:t,status:"failed",action_id:e,metadata:r,failure_reason:n}}a(hl,"createFailedPayload");var im=class{static{a(this,"ActionIdStore")}store=new Map;set(e,r){this.store.set(e,r)}get(e){let r=this.store.get(e);return r&&this.store.delete(e),r}peek(e){return this.store.get(e)}remove(e){this.store.delete(e)}clear(){this.store.clear()}},Er=new im;var Ae;(function(t){t.FUNDING_INITIALIZED="perpsDepositInitialized",t.FUNDING_INITIATED="perpsDepositInitiated",t.FUNDING_COMPLETED="perpsDepositCompleted",t.FUNDING_FAILED="perpsDepositFailed",t.FUNDING_PAUSED="perpsDepositPaused",t.FUNDING_RESUMED="perpsDepositResumed",t.DEPOSIT_TRANSFER_STARTED="perpsHyperunitDepositTransferStarted",t.DEPOSIT_TRANSFER_COMPLETED="perpsHyperunitDepositTransferCompleted",t.DEPOSIT_STREAM_OPERATIONS_STARTED="perpsHyperunitDepositStreamOperationsStarted",t.DEPOSIT_STREAM_OPERATIONS_COMPLETED="perpsHyperunitDepositStreamOperationsCompleted",t.DEPOSIT_SELL_SPOT_STARTED="perpsHyperunitDepositSellSpotStarted",t.DEPOSIT_SELL_SPOT_COMPLETED="perpsHyperunitDepositSellSpotCompleted",t.DEPOSIT_TRANSFER_TO_PERP_STARTED="perpsHyperunitDepositTransferToPerpStarted",t.DEPOSIT_TRANSFER_TO_PERP_COMPLETED="perpsHyperunitDepositTransferToPerpCompleted"})(Ae||(Ae={}));var le;(function(t){t.FUNDING_INITIALIZED="perpsWithdrawInitialized",t.FUNDING_INITIATED="perpsWithdrawInitiated",t.FUNDING_COMPLETED="perpsWithdrawCompleted",t.FUNDING_FAILED="perpsWithdrawFailed",t.FUNDING_PAUSED="perpsWithdrawPaused",t.FUNDING_RESUMED="perpsWithdrawResumed",t.PERPS_TO_SPOT_STARTED="perpsHyperunitWithdrawPerpsToSpotStarted",t.PERPS_TO_SPOT_COMPLETED="perpsHyperunitWithdrawPerpsToSpotCompleted",t.BUY_ASSET_STARTED="perpsHyperunitWithdrawBuyAssetStarted",t.BUY_ASSET_COMPLETED="perpsHyperunitWithdrawBuyAssetCompleted",t.SEND_TO_WITHDRAW_ADDRESS_STARTED="perpsHyperunitWithdrawSendToWithdrawAddressStarted",t.SEND_TO_WITHDRAW_ADDRESS_COMPLETED="perpsHyperunitWithdrawSendToWithdrawAddressCompleted",t.WITHDRAW_STREAM_OPERATIONS_STARTED="perpsHyperunitWithdrawStreamOperationsStarted",t.WITHDRAW_STREAM_OPERATIONS_COMPLETED="perpsHyperunitWithdrawStreamOperationsCompleted"})(le||(le={}));var ki;(function(t){t.INITIALIZATION_STARTED="perpsFundingInitializationStarted",t.INITIALIZED="perpsFundingInitialized",t.INITIALIZATION_ERROR="perpsFundingInitializationError",t.BELOW_MINIMUM_INPUT_AMOUNT="perpsFundingBelowMinimumInputAmount",t.INSUFFICIENT_BALANCE="perpsFundingInsufficientBalance",t.INSUFFICIENT_SOL_FOR_GAS="perpsFundingInsufficientSolForGas",t.EXCEEDS_MAXIMUM_LIMIT="perpsFundingExceedsMaximumLimit",t.FUNDABLE="perpsFundingFundable"})(ki||(ki={}));function Qr(t){return{type:t.type,fundingType:t.fundingType,fundingRoute:t.fundingRoute,amount:t.amount,amountUsd:t.amountUsd,fee:t.fee,estimatedTime:t.estimatedTime,depositId:t.depositId,depositTokenCaip19:t.depositTokenCaip19,depositTokenWalletCaip19:t.depositTokenWalletCaip19,depositAddress:t.depositAddress,withdrawId:t.withdrawId,withdrawAddress:t.withdrawAddress,withdrawAddressRole:t.withdrawAddressRole,withdrawNetworkId:t.withdrawNetworkId,assetId:t.assetId,spotTokenId:t.spotTokenId,spotTokenName:t.spotTokenName,isPhantomCash:t.isPhantomCash,openPositionFromSpotId:t.openPositionFromSpotId,minimumUiAmount:t.minimumUiAmount,minimumInputAmountUsd:t.minimumInputAmountUsd,minimumInputAmountSol:t.minimumInputAmountSol,maximumLimitUsd:t.maximumLimitUsd,maxAmountUsd:t.maxAmountUsd,tokenBalanceUsd:t.tokenBalanceUsd,tokenPriceUsd:t.tokenPriceUsd,feeUsd:t.feeUsd,percentages:t.percentages,token:t.token,currentProvider:t.currentProvider,error:t.error,errorCategory:t.errorCategory,errorRaw:t.errorRaw,fromToken:t.fromToken,toToken:t.toToken,fromChain:t.fromChain,toChain:t.toChain,requestId:t.requestId,funding_type:t.type??t.fundingType,funding_route:t.fundingRoute,amount_usd:t.amountUsd,estimated_time:t.estimatedTime,deposit_id:t.depositId,deposit_token_caip19:t.depositTokenCaip19,deposit_token_wallet_caip19:t.depositTokenWalletCaip19,deposit_address:t.depositAddress,withdraw_id:t.withdrawId,withdraw_address:t.withdrawAddress,withdraw_address_role:t.withdrawAddressRole,withdraw_network_id:t.withdrawNetworkId,asset_id:t.assetId,spot_token_id:t.spotTokenId,spot_token_name:t.spotTokenName,is_phantom_cash:t.isPhantomCash,open_position_from_spot_id:t.openPositionFromSpotId,minimum_ui_amount:t.minimumUiAmount,minimum_input_amount_usd:t.minimumInputAmountUsd,minimum_input_amount_sol:t.minimumInputAmountSol,maximum_limit_usd:t.maximumLimitUsd,max_amount_usd:t.maxAmountUsd,token_balance_usd:t.tokenBalanceUsd,token_price_usd:t.tokenPriceUsd,fee_usd:t.feeUsd,current_provider:t.currentProvider,error_category:t.errorCategory,error_raw:t.errorRaw,from_token:t.fromToken,to_token:t.toToken,from_chain:t.fromChain,to_chain:t.toChain,request_id:t.requestId}}a(Qr,"buildFundingMetadata");var tE=a(()=>{let t=Se(),e=(0,Wn.useCallback)((o,c)=>{let d=c,p=(o===Ae.FUNDING_FAILED||o===le.FUNDING_FAILED)&&c.error?om(String(c.error)):void 0;p&&(d={...c,error:p.humanReadable,errorCategory:p.category,errorRaw:p.rawError}),t.capture(o,{data:{...d}});let f=c.depositId;if(o===Ae.FUNDING_INITIATED&&f){let S=Qr(d),{payload:x,actionId:T}=ml("perps_deposit",S);Er.set(`deposit:${f}`,T),Tr(t,x)}else if(o===Ae.FUNDING_COMPLETED&&f){let S=Er.get(`deposit:${f}`);if(S){let x=Qr(d),T=fl("perps_deposit",S,x);Tr(t,T)}}else if(o===Ae.FUNDING_FAILED&&f){let S=Er.get(`deposit:${f}`);if(S){let x=Qr(d),T=p?{...x,error_category:p.category,error_raw:p.rawError}:x,_=p?.humanReadable??"Unknown error",k=hl("perps_deposit",S,T,_);Tr(t,k)}}let g=c.withdrawId;if(o===le.FUNDING_INITIATED&&g){let S=Qr(d),{payload:x,actionId:T}=ml("perps_withdraw",S);Er.set(`withdraw:${g}`,T),Tr(t,x)}else if(o===le.FUNDING_COMPLETED&&g){let S=Er.get(`withdraw:${g}`);if(S){let x=Qr(d),T=fl("perps_withdraw",S,x);Tr(t,T)}}else if(o===le.FUNDING_FAILED&&g){let S=Er.get(`withdraw:${g}`);if(S){let x=Qr(d),T=p?{...x,error_category:p.category,error_raw:p.rawError}:x,_=p?.humanReadable??"Unknown error",k=hl("perps_withdraw",S,T,_);Tr(t,k)}}let w=c.type??c.fundingType,y=w?`funding_init:${w}`:"funding_init:unknown";if(o===ki.INITIALIZATION_STARTED){let S=Qr(d),{payload:x,actionId:T}=ml("perps_funding_initialization",S);Er.set(y,T),Tr(t,x)}else if(o===ki.INITIALIZED){let S=Er.get(y);if(S){let x=Qr(d),T=fl("perps_funding_initialization",S,x);Tr(t,T)}}else if(o===ki.INITIALIZATION_ERROR){let S=Er.get(y);if(S){let x=c.error?om(String(c.error)):void 0,T=Qr(d),_=x?{...T,error_category:x.category,error_raw:x.rawError}:T,k=x?.humanReadable??"Initialization failed",P=hl("perps_funding_initialization",S,_,k);Tr(t,P)}}o===Ae.FUNDING_FAILED&&E.addBreadcrumb(I.Perps,"Deposit failed",F.Info),o===le.FUNDING_FAILED&&E.addBreadcrumb(I.Perps,"Withdrawal failed",F.Info)},[t]),r=(0,Wn.useCallback)((o,c)=>{e(o,c)},[e]),n=(0,Wn.useCallback)((o,c)=>{e(o,c)},[e]),s=(0,Wn.useCallback)((o,c)=>{e(o,c)},[e]);return(0,Wn.useMemo)(()=>({reportDeposit:r,reportWithdraw:n,reportFundingUIState:s}),[r,n,s])},"useFundingAnalytics");u();l();var gl=class{static{a(this,"FundingBalanceInvalidationListener")}queryClient;constructor(e){this.queryClient=e}onFundingPoolStateChange(e,r,n){e.type==="fundingCompleted"&&Promise.all([this.queryClient.invalidateQueries({queryKey:ph}),this.queryClient.invalidateQueries({queryKey:mh}),this.queryClient.invalidateQueries({queryKey:fh})]).catch(()=>{})}};u();l();var yl=class{static{a(this,"FundingStateLogsListener")}onFundingPoolStateChange(e,r,n){switch(e.type){case"fundingFailed":E.addBreadcrumb(I.Perps,`FundingPool: ${r.type} funding failed`,F.Info,{error:e.error.message,fundingTaskState:r.getState().type});break;case"fundingStarted":case"fundingBridgingStarted":case"fundingCompleted":E.addBreadcrumb(I.Perps,`FundingPool: ${r.type} ${e.type}`,F.Info);break}}};u();l();var wl=class{static{a(this,"FundingToastListener")}onFundingPoolStateChange(e,r,n){switch(r.type){case"deposit":this.onDepositEvent(e,r);break;case"withdraw":this.onWithdrawEvent(e,r);break}}onDepositEvent(e,r){if(!r.silentToasts)switch(e.type){case"fundingStarted":this.progress(L.t("perpsToastInitiatingFunding"));break;case"fundingBridgingStarted":break;case"fundingCompleted":this.success(L.t("perpsToastFundsAdded"));break;case"fundingFailed":{(e.error?.message||"").includes("Transaction is null")?(E.addBreadcrumb(I.Perps,"Funding failed: Insufficient SOL for transaction fees",F.Info),this.failed(L.t("perpsToastFundingFailed"),L.t("perpsInsufficientGasForFunding"),L.t("commandOK"),()=>{Ze.getState().hideToast()})):this.failed(L.t("perpsToastFundingFailed"),L.t("perpsFundingFailedDescription"),L.t("commandOK"),()=>{Ze.getState().hideToast()});break}}}onWithdrawEvent(e,r){switch(e.type){case"fundingStarted":this.progress(L.t("perpsToastInitiatingWithdrawal"));break;case"fundingBridgingStarted":break;case"fundingCompleted":this.success(L.t("perpsToastWithdrawalComplete"));break;case"fundingFailed":this.failed(L.t("perpsToastWithdrawalFailed"),e.error.message,L.t("commandOK"),()=>{Ze.getState().hideToast()});break}}success(e){setTimeout(()=>{Ze.getState().success({message:e,onPress:a(()=>{Ze.getState().hideToast()},"onPress")})},100)}failed(e,r,n,s){setTimeout(()=>{Ze.getState().failed({title:e,message:r,buttonText:n,onPress:s})},100)}progress(e){setTimeout(()=>{Ze.getState().progress({message:e,onPress:a(()=>{Ze.getState().hideToast()},"onPress")})},100)}};u();l();u();l();u();l();u();l();u();l();u();l();u();l();var Ci=class{static{a(this,"RelayBridge")}account;authRepository;cashAccount;signer;solanaConnection;storage;constructor(e){this.account=e.account,this.authRepository=e.authRepository,this.cashAccount=e.cashAccount,this.signer=e.signer,this.solanaConnection=e.solanaConnection,this.storage=e.storage}getSolanaAddress(){let e=this.account.addresses.find(r=>r.addressType===ie.Solana);if(!e)throw new Error("No Solana address found for account");return e.address}isCash(e){return e?.resourceType!==W.address||!this.cashAccount?!1:this.cashAccount.addressDetails.address===e.address}getTakerAddress(e){return e?.resourceType===W.address&&this.isCash(e)?e.address:this.getSolanaAddress()}getEvmAddress(){let e=this.account.addresses.find(r=>r.addressType===ie.EVM);if(!e)throw new Error("No EVM address found for account");return e.address}async fetchQuotes(e){let r=this.getTakerAddress(e.fromTokenOwner),n=$r("kill-cash-perps-quote-chain-addresses"),s=this.getEvmAddress(),o=this.isCash(e.fromTokenOwner),c=this.account.addresses.reduce((m,p)=>({...m,[p.networkID]:p.address}),{}),d={sellToken:e.fromToken,buyToken:e.toToken,taker:{chainId:e.fromChain,address:r,resourceType:W.address},takerDestination:{chainId:e.toChain,address:s.toLowerCase(),resourceType:W.address},sellAmount:e.amount.toString(),slippageTolerance:(e.slippageBps??100)/100,phantomCashAccount:o,chainAddresses:n?void 0:c};E.addBreadcrumb(I.Perps,"Fetching Relay quotes",F.Info,{sellAmount:d.sellAmount,sellToken:D(d.sellToken),buyToken:D(d.buyToken),fromChain:d.sellToken.chainId,toChain:d.buyToken.chainId});try{let m=await H.api().retry(1,qe(1e3,1e3)).post("/swap/v2/quotes",d);if(m.status!==200)throw new Error(`Failed to fetch quotes: ${m.status}`);let p=m.data;return E.addBreadcrumb(I.Perps,"Relay quotes fetched",F.Info,{quotesCount:p.quotes.length,firstQuoteBuyAmount:p.quotes[0]?.buyAmount}),p.quotes}catch(m){throw E.addBreadcrumb(I.Perps,"Failed to fetch Relay quotes",F.Error,{error:m instanceof Error?m.message:"Unknown error"}),m}}async executeSwap(e,r,n=_t.Mainnet,s){let o=this.getTakerAddress(r),c=this.isCash(r),d=await OD(o,e,this.solanaConnection,c);try{E.addBreadcrumb(I.Perps,"Executing Relay swap",F.Info,{buyAmount:e.buyAmount,sellAmount:e.sellAmount});let m;if(c){let p=be(),f=await this.authRepository?.getUser();if(!f)throw new Error("User not found for swap");let{accessToken:g,userID:w}=f,y=e.steps[0]?.cashQuoteSignerSignature,S=this.createPerpsInfo({takerAddress:o,quote:e,perpsMetadata:s?.perpsMetadata});m=await zo({unsignedTransaction:Vm(d),vaultProxy:this.signer,accountIdentifier:this.account.identifier,signerAddress:o,idempotencyKey:p,isCash:!0,accessToken:g,userID:w,skipActivityRecording:!1,swapInfo:void 0,perpsInfo:S,waitForActivityState:Be.Completed,cashQuoteSignerSignature:y})}else{m=await ss({accountIdentifier:this.account.identifier,accountSigner:this.signer,transaction:d,feePayer:new ue.PublicKey(o),connection:this.solanaConnection,storage:this.storage,pendingTransactionInput:{ownerAddress:o,networkID:n,data:{signature:""},type:st.DappInteraction,display:{summary:{topLeft:{text:"Deposit"}}}}});try{await Yr({connection:this.solanaConnection,signature:m})}catch(p){let f=p instanceof Error?p:new Error(String(p)),g=f.message.toLowerCase();if(g.includes("failed to get signature status")&&g.includes("internal error"))E.addBreadcrumb(I.Perps,"Relay tx confirmation status check failed; continuing with submitted signature",F.Info,{signature:m,error:f.message});else throw f}}return E.addBreadcrumb(I.Perps,"Relay swap transaction sent",F.Info,{signature:m}),m}catch(m){throw E.addBreadcrumb(I.Perps,"Failed to send Relay swap transaction",F.Info),m}}createPerpsInfo({takerAddress:e,quote:r,perpsMetadata:n}){let s=r.steps[0];if(!s)throw new Error("Relay quote is missing step[0], cannot build perpsInfo");let o=this.getAddressMintFromQuoteToken(s.sellToken,"sell"),c=this.getAddressMintFromQuoteToken(s.buyToken,"buy"),d={owner:e,mint:o,symbol:n?.fromToken?.symbol,name:n?.fromToken?.name,amount:r.sellAmount,decimals:n?.fromToken?.decimals,logoUri:n?.fromToken?.logoUri},m=n?.order;return m?{type:"order",input:d,output:{owner:e,marketId:m.marketId,size:m.size,direction:m.direction,symbol:m.symbol,name:m.name,leverage:m.leverage,decimals:m.decimals,logoUri:m.logoUri}}:{type:"funding",input:d,output:{owner:e,mint:c,symbol:n?.toToken?.symbol,name:n?.toToken?.name,amount:r.buyAmount,decimals:n?.toToken?.decimals,logoUri:n?.toToken?.logoUri}}}getAddressMintFromQuoteToken(e,r){if(e.resourceType!==W.address)throw new Error(`Relay ${r} token must be address resourceType for perpsInfo mint. Received resourceType=${e.resourceType}, token=${D(e)}`);return e.address}};async function OD(t,e,r,n){let s=mt(e.steps[0]?.transactionData,"bs58");if(n)return s;let o=new ue.PublicKey(t);return await Ui(s,r),jm(s,o),s}a(OD,"transactionFromQuote");u();l();var UD=i.object({status:i.enum(["waiting","success","failure","refund","delayed","pending"]),requestId:i.string().optional()}),Hr=class{static{a(this,"RelayBridgeStatusPoller")}pollInterval=null;listeners=new Set;POLL_INTERVAL_MS=1e3;MAX_POLL_ATTEMPTS=45;pollAttempts=0;subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}startPolling(e){this.pollAttempts=0,this.poll(e)}stopPolling(){this.pollInterval&&(clearTimeout(this.pollInterval),this.pollInterval=null)}async poll(e){this.pollAttempts++;try{let r=await this.fetchBridgeStatus(e);if(this.listeners.forEach(n=>n.onStatusUpdate(r)),r.status==="success"){E.addBreadcrumb(I.Perps,`Relay bridge completed for request: ${e}`,F.Info,{requestId:e}),this.listeners.forEach(n=>n.onCompleted(r)),this.stopPolling();return}if(r.status==="failure"||r.status==="refund"){let n=new Error(`Relay bridge failed with status: ${r.status} for request: ${e}`);E.addBreadcrumb(I.Perps,"Relay bridge failed",F.Info),this.listeners.forEach(s=>s.onError(n)),this.stopPolling();return}if(r.status!=="waiting"&&r.status!=="pending"&&r.status!=="delayed"){let n=new Error(`Unexpected Relay bridge status: ${r.status} for request: ${e}`);E.addBreadcrumb(I.Perps,"Relay bridge unexpected status",F.Error,{requestId:e,status:r.status}),this.listeners.forEach(s=>s.onError(n)),this.stopPolling();return}if(this.pollAttempts>=this.MAX_POLL_ATTEMPTS){let n=new Error(`Relay bridge status polling timed out with status: ${r.status} for request: ${e}`);E.addBreadcrumb(I.Perps,"Relay bridge polling timeout",F.Error,{requestId:e,finalStatus:r.status,attempts:this.pollAttempts}),this.listeners.forEach(s=>s.onError(n)),this.stopPolling();return}this.pollInterval=setTimeout(()=>{this.poll(e)},this.POLL_INTERVAL_MS)}catch(r){E.addBreadcrumb(I.Perps,`Error polling Relay bridge status for request: ${e}`,F.Error,{error:r instanceof Error?r.message:"Unknown error",requestId:e,attempts:this.pollAttempts}),this.listeners.forEach(n=>n.onError(r)),this.stopPolling()}}async fetchBridgeStatus(e){let r=await H.api().retry(1,qe(1e3,1e3)).get("/swap/v2/spot/get-intents-status",{params:{requestId:e}});if(!ee(r))throw E.addBreadcrumb(I.Perps,"Failed to fetch bridge status",F.Error,{requestId:e,status:r.status,statusText:r.statusText}),new Error(`Failed to get bridge status: ${r.status} ${r.statusText}`);let n=r.data,s=UD.safeParse(n);if(!s.success)throw E.addBreadcrumb(I.Perps,"Failed to parse bridge status response",F.Error,{requestId:e,error:s.error.message,receivedData:JSON.stringify(n)}),new Error(`Failed to parse bridge status: ${s.error.message}`);return s.data}};u();l();var Ct=class{static{a(this,"FundingTask")}startedAt;type;minimumUiAmount;amount;amountUsd;estimatedTime;fee;withdrawAddress;withdrawAddressRole;openPositionFromSpotId;perpsOrderInfo;state={type:"indeterminate"};listeners=new Set;constructor(e,r,n,s,o,c){this.startedAt=Date.now(),this.type=e,this.minimumUiAmount=r,this.estimatedTime=n,this.fee=s,this.withdrawAddress=o,this.withdrawAddressRole=c}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notify(e,r){this.listeners.forEach(n=>n.onFundingTaskStateChange(this,e,r))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var rE=250,MD=.05,_i=class t extends Ct{static{a(this,"RelayBridgeTask")}perps;account;authRepository;cashAccount;signer;storage;fromToken;fromTokenOwner;fromTokenDecimals;toToken;toTokenDecimals;fromTokenMetadata;toTokenMetadata;fromChain;toChain;relayBridge;connection;bridgeListeners=new Set;quote;isFetchingQuote=!1;fetchQuotePromise=null;statusPoller;analytics;depositId;constructor(e,r,n,s,o,c,d,m,p,f,g,w,y,S,x,T,_,k,P){super("deposit",e,"",r),this.perps=n,this.account=s,this.authRepository=o,this.cashAccount=c,this.signer=d,this.storage=m,this.fromToken=p,this.fromTokenOwner=f,this.fromTokenDecimals=g,this.toToken=w,this.toTokenDecimals=y,this.fromTokenMetadata=S,this.toTokenMetadata=x,this.fromChain=T,this.toChain=_,this.analytics=k,this.depositId=P||be(),this.connection=Jr(_t.Mainnet),this.relayBridge=new Ci({account:s,authRepository:o,cashAccount:c,signer:d,solanaConnection:this.connection,storage:m}),this.statusPoller=new Hr,this.reportAnalytics(Ae.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){this.analytics.reportDeposit(e,{fundingType:"deposit",fundingRoute:$e.Relay,amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,fromToken:D(this.fromToken),toToken:D(this.toToken),fromChain:this.fromChain,toChain:this.toChain,depositId:this.depositId,isPhantomCash:this.relayBridge.isCash(this.fromTokenOwner),...this.openPositionFromSpotId&&{openPositionFromSpotId:this.openPositionFromSpotId},...r})}addBridgeListener(e){this.bridgeListeners.add(e)}removeBridgeListener(e){this.bridgeListeners.delete(e)}notifyBridgeListeners(e,...r){this.bridgeListeners.forEach(n=>{let s=n[e];typeof s=="function"&&s.call(n,...r)})}async fetchQuote(e,r){if(this.getState().type==="executing")return E.addBreadcrumb(I.Perps,"Skipping quote fetch - task is executing",F.Info),this.quote||null;this.isFetchingQuote=!0;let s;this.fetchQuotePromise=new Promise(o=>{s=o});try{let o=e.shiftedBy(this.fromTokenDecimals),c=await this.relayBridge.fetchQuotes({amount:o.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:rE});return c.length===0?(this.isFetchingQuote=!1,null):this.getState().type==="executing"?(E.addBreadcrumb(I.Perps,"Discarding fetched quote - execution started during fetch",F.Info),this.isFetchingQuote=!1,c[0]):(this.quote=c[0],this.fee=new b(this.quote.steps[0]?.feeCosts?.[0]?.value??MD),E.addBreadcrumb(I.Perps,"Relay quote fetched",F.Info,{inputAmount:e.toString(),tokenPrice:r.toString(),inputUsd:e.toString(),outputUsd:e.toString(),feeUsd:this.fee.toString(),buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount,fromTokenDecimals:this.fromTokenDecimals,toTokenDecimals:this.toTokenDecimals,requestId:this.quote.steps[0]?.id}),this.notifyBridgeListeners("onQuoteFetched",this.quote),this.quote)}catch(o){return E.addBreadcrumb(I.Perps,"Failed to fetch Relay quote",F.Info,{error:o instanceof Error?o.message:"Unknown error"}),this.isFetchingQuote=!1,null}finally{this.isFetchingQuote=!1,s?.(),this.fetchQuotePromise=null}}async execute(e,r,n){if(this.state.type!=="executing"){this.startedAt=Date.now(),this.amount=n,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics(Ae.FUNDING_INITIATED,{});try{this.fetchQuotePromise&&await this.fetchQuotePromise,E.addBreadcrumb(I.Perps,"Fetching Relay bridge quotes",F.Info,{amount:n,fromChain:this.fromChain,toChain:this.toChain});let s=new b(n).shiftedBy(this.fromTokenDecimals),o=await this.fetchQuotesForExecution(s.toNumber());if(o.length===0)throw E.addBreadcrumb(I.Perps,"No quotes available for Relay bridge",F.Error),new Error("No quotes available for bridge");let c=o[0];this.quote=c,this.notifyBridgeListeners("onQuoteFetched",c);let d=c.steps[0]?.id;if(!d)throw E.addBreadcrumb(I.Perps,"No request ID found in Relay quote",F.Info,{depositId:this.depositId,hasStep:!!c.steps[0]}),new Error("No request ID found in Relay quote");E.addBreadcrumb(I.Perps,"Request ID extracted from quote",F.Info,{requestId:d,depositId:this.depositId,quoteStepId:c.steps[0]?.id}),this.notify({type:"fundingBridgingStarted"},this.state),this.notifyBridgeListeners("onBridgeStarted"),E.addBreadcrumb(I.Perps,"Executing Relay bridge swap",F.Info,{buyAmount:c.buyAmount,sellAmount:c.sellAmount,requestId:d});let m={fromToken:{decimals:this.fromTokenDecimals,...this.fromTokenMetadata},toToken:{decimals:this.toTokenDecimals,...this.toTokenMetadata},order:this.openPositionFromSpotId?this.perpsOrderInfo:void 0},p=await this.relayBridge.executeSwap(c,this.fromTokenOwner,_t.Mainnet,{perpsMetadata:m});E.addBreadcrumb(I.Perps,"Relay bridge transaction submitted",F.Info,{txHash:p,requestId:d}),this.notifyBridgeListeners("onBridgeCompleted",p),E.addBreadcrumb(I.Perps,"Starting Relay bridge status polling",F.Info,{requestId:d,depositId:this.depositId,txHash:p}),this.startPollingForCompletion(d)}catch(s){let o=s;this.state={type:"failed",error:o},this.notify({type:"fundingFailed",error:o},this.state),this.notifyBridgeListeners("onBridgeFailed",o),E.addBreadcrumb(I.Perps,`Relay bridge failed: ${o.message}`,F.Info),this.reportAnalytics(Ae.FUNDING_FAILED,{error:o instanceof Error?o.message:String(o)})}}}async fetchQuotesForExecution(e){let n;for(let s=0;s<=2;s++)try{return await this.relayBridge.fetchQuotes({amount:e,fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:rE})}catch(o){n=o,s<2&&(E.addBreadcrumb(I.Perps,`Execution quote fetch attempt ${s+1} failed, retrying: ${o instanceof Error?o.message:"Unknown error"}`,F.Info),await new Promise(c=>setTimeout(c,1e3*(s+1))))}throw n??new Error("Failed to fetch quotes after retries")}pause(){this.statusPoller.stopPolling(),E.addBreadcrumb(I.Perps,"Relay bridge pause requested - stopped polling",F.Info),this.reportAnalytics(Ae.FUNDING_PAUSED,{})}resume(){E.addBreadcrumb(I.Perps,"Relay bridge resume requested (no-op)",F.Info),this.reportAnalytics(Ae.FUNDING_RESUMED,{})}getFee(){return this.fee}startPollingForCompletion(e){let r={onStatusUpdate:a(n=>{E.addBreadcrumb(I.Perps,"Relay bridge status update",F.Info,{requestId:e,status:n.status})},"onStatusUpdate"),onCompleted:a(n=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),E.addBreadcrumb(I.Perps,"Relay bridge funds received",F.Info,{requestId:e}),this.reportAnalytics(Ae.FUNDING_COMPLETED,{}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:a(n=>{E.addBreadcrumb(I.Perps,"Relay bridge polling error",F.Info,{error:n.message,requestId:e,depositId:this.depositId}),this.state={type:"failed",error:n},this.notify({type:"fundingFailed",error:n},this.state),this.statusPoller.unsubscribe(r),this.reportAnalytics(Ae.FUNDING_FAILED,{error:n.message,requestId:e})},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}static create({minimumUiAmount:e,fee:r,perps:n,account:s,authRepository:o,cashAccount:c,signer:d,storage:m,fromToken:p,fromTokenOwner:f,fromTokenDecimals:g,toToken:w,toTokenDecimals:y,fromTokenMetadata:S,toTokenMetadata:x,fromChain:T,toChain:_,analytics:k,depositId:P}){return new t(e,r,n,s,o,c,d,m,p,f,g,w,y,S??{},x??{},T,_,k,P)}};u();l();var Fi=class extends Ct{static{a(this,"RelayLegacyWithdrawTask")}withdrawNetworkId;toTokenDecimals;perps;analytics;statusPoller;requestId;toTokenCaip19;withdrawId;constructor(e,r,n,s,o,c,d,m,p,f){super("withdraw",s,o,c,m,"user"),this.withdrawNetworkId=e,this.toTokenDecimals=r,this.perps=n,this.analytics=d,this.toTokenCaip19=p,this.withdrawId=f||be(),this.statusPoller=new Hr,this.reportAnalytics(le.FUNDING_INITIALIZED,{provider:$e.Relay})}reportAnalytics(e,r){let n={fundingType:"withdraw",fundingRoute:$e.Relay,amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress??"",withdrawNetworkId:this.withdrawNetworkId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString(),withdrawId:this.withdrawId};this.analytics.reportWithdraw(e,{...n,...r})}pause(){this.statusPoller.stopPolling(),E.addBreadcrumb(I.Perps,"Relay withdrawal pause requested - stopped polling",F.Info),this.reportAnalytics(le.FUNDING_PAUSED,{})}resume(){E.addBreadcrumb(I.Perps,"Relay withdrawal resume requested (no-op)",F.Info),this.reportAnalytics(le.FUNDING_RESUMED,{})}async execute(e,r,n,s){this.amount=n,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics(le.FUNDING_INITIATED,{});try{if(E.addBreadcrumb(I.Perps,"Starting relay withdrawal",F.Info,{amount:n,amountUsd:r,withdrawAddress:this.withdrawAddress??""}),!this.perps.user)throw new Error("No perps user available");let o=D(this.toTokenCaip19),c=e.shiftedBy(this.toTokenDecimals??8).toFixed(0),d=D({chainId:this.withdrawNetworkId,resourceType:W.address,address:this.withdrawAddress??""});E.addBreadcrumb(I.Perps,"Initializing relay bridge for withdrawal",F.Info,{sellAmount:c,buyToken:o,takerDestination:d});let m=await this.perps.client.getSpotBridgeInitialize({buyToken:o,sellAmount:c,takerDestination:d,bridgeProvider:$e.Relay,sourceWallet:D(this.perps.user)});if(!kT(m))throw new Error("Expected legacy bridge response with deposit address");this.requestId=m.requestId;let p=m.depositAddress.address;E.addBreadcrumb(I.Perps,"Relay bridge initialized",F.Info,{requestId:this.requestId,depositAddress:p}),this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),E.addBreadcrumb(I.Perps,"Sending USDC from perps to relay deposit address",F.Info,{depositAddress:p,amount:e.toString()}),this.reportAnalytics(le.SEND_TO_WITHDRAW_ADDRESS_STARTED,{depositAddress:p,requestId:this.requestId}),await this.perps.usdSendPerps({destination:p,amount:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),E.addBreadcrumb(I.Perps,"Sent USDC from perps to relay deposit address",F.Info,{depositAddress:p,amount:e.toString()}),this.reportAnalytics(le.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,{depositAddress:p}),this.startPollingForCompletion(this.requestId)}catch(o){let c=o instanceof Error?o:new Error("Unknown error");E.addBreadcrumb(I.Perps,"Relay withdrawal failed",F.Error,{error:c.message}),this.state={type:"failed",error:c},this.notify({type:"fundingFailed",error:c},this.state),this.reportAnalytics(le.FUNDING_FAILED,{error:c.message})}}startPollingForCompletion(e){let r={onStatusUpdate:a(n=>{E.addBreadcrumb(I.Perps,"Relay withdrawal status update",F.Info,{requestId:e,status:n.status})},"onStatusUpdate"),onCompleted:a(n=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),E.addBreadcrumb(I.Perps,"Relay withdrawal completed",F.Info,{requestId:e}),this.reportAnalytics(le.FUNDING_COMPLETED,{requestId:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:a(n=>{E.addBreadcrumb(I.Perps,"Relay withdrawal polling error",F.Error,{error:n.message,requestId:e}),this.state={type:"failed",error:n},this.notify({type:"fundingFailed",error:n},this.state),this.statusPoller.unsubscribe(r),this.reportAnalytics(le.FUNDING_FAILED,{error:n.message,requestId:e})},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}};u();l();var Pi=class extends Ct{static{a(this,"RelayWithdrawTask")}withdrawNetworkId;toTokenDecimals;perps;analytics;statusPoller;requestId;toTokenCaip19;withdrawId;constructor(e,r,n,s,o,c,d,m,p,f){super("withdraw",s,o,c,m,"user"),this.withdrawNetworkId=e,this.toTokenDecimals=r,this.perps=n,this.analytics=d,this.toTokenCaip19=p,this.withdrawId=f||be(),this.statusPoller=new Hr,this.reportAnalytics(le.FUNDING_INITIALIZED,{provider:$e.Relay})}reportAnalytics(e,r){let n={fundingType:"withdraw",fundingRoute:$e.Relay,amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress??"",withdrawNetworkId:this.withdrawNetworkId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString(),withdrawId:this.withdrawId};this.analytics.reportWithdraw(e,{...n,...r})}pause(){this.statusPoller.stopPolling(),E.addBreadcrumb(I.Perps,"Relay V2 withdrawal pause requested - stopped polling",F.Info),this.reportAnalytics(le.FUNDING_PAUSED,{})}resume(){E.addBreadcrumb(I.Perps,"Relay V2 withdrawal resume requested (no-op)",F.Info),this.reportAnalytics(le.FUNDING_RESUMED,{})}async execute(e,r,n,s){this.amount=n,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics(le.FUNDING_INITIATED,{});try{if(E.addBreadcrumb(I.Perps,"Starting Relay V2 withdrawal",F.Info,{amount:n,amountUsd:r,withdrawAddress:this.withdrawAddress??""}),!this.perps.user)throw new Error("No perps user available");let o=D(this.toTokenCaip19),c=e.shiftedBy(this.toTokenDecimals??8).toFixed(0),d=D({chainId:this.withdrawNetworkId,resourceType:W.address,address:this.withdrawAddress??""});E.addBreadcrumb(I.Perps,"Initializing Relay V2 bridge for withdrawal",F.Info,{sellAmount:c,buyToken:o,takerDestination:d});let m=await this.perps.client.getSpotBridgeInitialize({buyToken:o,sellAmount:c,takerDestination:d,sourceWallet:D(this.perps.user),bridgeProvider:$e.RelayV2});if(!IT(m))throw new Error("Expected bridge response with signing steps");if(this.requestId=m.requestId,!this.requestId)throw new Error("No requestId in bridge initialize response");E.addBreadcrumb(I.Perps,"Relay V2 bridge initialized",F.Info,{requestId:this.requestId,amountIn:m.details.amountIn,amountOut:m.details.amountOut}),await this.signAndPostAuthorize(m),await this.signAndPostDeposit(m),this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),this.startPollingForCompletion(this.requestId)}catch(o){let c=o instanceof Error?o:new Error("Unknown error");E.addBreadcrumb(I.Perps,"Relay V2 withdrawal failed",F.Error,{error:c.message}),this.state={type:"failed",error:c},this.notify({type:"fundingFailed",error:c},this.state),this.reportAnalytics(le.FUNDING_FAILED,{error:c.message})}}async signAndPostAuthorize(e){let{authorizeStep:r}=e;E.addBreadcrumb(I.Perps,"Signing Relay V2 authorize step",F.Info,{requestId:this.requestId??"unknown"});let n={domain:r.domain,types:{EIP712Domain:ze,...r.types},primaryType:r.primaryType,message:r.message},{rawSignature:s}=await this.perps.sign(n);E.addBreadcrumb(I.Perps,"Posting Relay V2 authorize",F.Info,{requestId:this.requestId??"unknown"}),await this.perps.client.postAuthorize({...r.postBody,signature:s}),E.addBreadcrumb(I.Perps,"Relay V2 authorize completed",F.Info,{requestId:this.requestId??"unknown"})}async signAndPostDeposit(e){let{depositStep:r}=e;E.addBreadcrumb(I.Perps,"Signing Relay V2 deposit step",F.Info,{requestId:this.requestId??"unknown"});let n=1,s=`0x${n.toString(16)}`,o={name:"HyperliquidSignTransaction",version:"1",chainId:n,verifyingContract:"0x0000000000000000000000000000000000000000"},c=r.action,d={...c.parameters,type:c.type,signatureChainId:s},m={domain:o,types:{EIP712Domain:ze,...r.eip712Types},primaryType:r.eip712PrimaryType,message:d},{splitSignature:p}=await this.perps.sign(m);E.addBreadcrumb(I.Perps,"Posting Relay V2 exchange",F.Info,{requestId:this.requestId??"unknown"}),this.reportAnalytics(le.SEND_TO_WITHDRAW_ADDRESS_STARTED,{requestId:this.requestId??"unknown"}),await this.perps.client.postExchange({action:d,nonce:r.nonce,signature:p}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),E.addBreadcrumb(I.Perps,"Relay V2 exchange completed",F.Info,{requestId:this.requestId??"unknown"}),this.reportAnalytics(le.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,{requestId:this.requestId??"unknown"})}startPollingForCompletion(e){let r={onStatusUpdate:a(n=>{E.addBreadcrumb(I.Perps,"Relay V2 withdrawal status update",F.Info,{requestId:e,status:n.status})},"onStatusUpdate"),onCompleted:a(n=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),E.addBreadcrumb(I.Perps,"Relay V2 withdrawal completed",F.Info,{requestId:e}),this.reportAnalytics(le.FUNDING_COMPLETED,{requestId:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:a(n=>{E.addBreadcrumb(I.Perps,"Relay V2 withdrawal polling error",F.Error,{error:n.message,requestId:e}),this.state={type:"failed",error:n},this.notify({type:"fundingFailed",error:n},this.state),this.reportAnalytics(le.FUNDING_FAILED,{error:n.message,requestId:e}),this.statusPoller.unsubscribe(r)},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}};u();l();var nE=5,qD={chainId:Tn.Mainnet,address:"0x00000000000000000000000000000000",resourceType:W.address},sE=8,zD={symbol:"USDC",name:"USDC"},Sl=class{static{a(this,"RelayBridgeFundingTaskFactory")}analytics;constructor(e){this.analytics=e}async createWithdrawTask(e,r,n,s){let o=r.addresses.find(p=>p.networkID===n);if(!o)throw new Error("Couldn't find destination account address for network: "+n);let c=o.address,d={chainId:n,resourceType:W.nativeToken,slip44:A.getSlip44(n)},m=new b(nE);return s===$e.RelayV2?new Pi(n,sE,e,m,"5 seconds",new b(0),this.analytics,c,d):new Fi(n,sE,e,m,"5 seconds",new b(0),this.analytics,c,d)}async fetchTokenInfo(e,r,n,s,o){let c=e.addresses.find(w=>w.networkID===n);if(!c)throw new Error("Couldn't find result address for network: "+n);let d=new Ln,m={type:"swap",network:n,sellCaip19:D(s),buyCaip19:"solana:101/nativeToken:501",takerCaip19:o?D(o):void 0,takerDestinationCaip19:void 0},p=Do(r),f=await d.initialize(m,[c],p);if(!f.sellTokenPrice?.usd)throw new Error("No price available for token");let g=f.sellToken;return{priceUsd:new b(f.sellTokenPrice.usd),decimals:g.data.decimals,symbol:g.data.symbol??void 0,name:g.data.name??void 0,logoUri:g.data.logoUri??void 0}}async createTask(e,r,n,s,o,c,d,m){if(m.type==="withdraw")return this.createWithdrawTask(e,r,m.withdrawNetworkId,m.provider);let{depositTokenCaip19:p,depositTokenWalletCaip19:f}=m,{priceUsd:g,decimals:w,symbol:y,name:S,logoUri:x}=await this.fetchTokenInfo(r,s,p.chainId,p,f),T=new b(nE).dividedBy(g);return _i.create({minimumUiAmount:T,estimatedTime:"5 seconds",fee:new b(0),perps:e,account:r,authRepository:n,cashAccount:s,signer:c,storage:o,fromToken:p,fromTokenOwner:f,fromTokenDecimals:w,toToken:qD,toTokenDecimals:18,fromTokenMetadata:{symbol:y,name:S,logoUri:x},toTokenMetadata:zD,fromChain:_t.Mainnet,toChain:Tn.Mainnet,analytics:this.analytics,depositId:m.depositId})}};u();l();u();l();var bFe=new b(.008);var MFe=new b(5);var HD=10,um=class{static{a(this,"WarmFundingCache")}entries=new Map;refreshes=new Map;get(e,r){return this.entries.get(cm(e,r))}set(e,r,n){let s=cm(e,r);if(this.entries.set(s,n),this.entries.size>HD){let o=Array.from(this.entries.keys())[0];this.entries.delete(o)}}delete(e,r){this.entries.delete(cm(e,r))}keys(){return Array.from(this.entries.keys())}getByKey(e){return this.entries.get(e)}setRefresh(e,r){this.refreshes.set(e,r),r.finally(()=>this.refreshes.delete(e))}hasRefresh(e){return this.refreshes.has(e)}},am=new um;function cm(t,e){let n={account:[...e.account.addresses].map(o=>`${o.networkID}:${o.address}`.toLowerCase()).sort().join("|")};if(t.type==="deposit")return JSON.stringify({...n,type:"deposit",depositTokenCaip19:t.depositTokenCaip19,depositTokenWalletCaip19:t.depositTokenWalletCaip19,depositId:t.depositId});let s=e.determineProvider({type:"withdraw"},void 0);return JSON.stringify({...n,type:"withdraw",withdrawNetworkId:t.withdrawNetworkId,provider:s})}a(cm,"getFundingCacheKey");function oE(t){let e=GD(t.account);for(let r of am.keys())if(r.includes(`"account":"${e}"`)){let n=am.getByKey(r);if(n){let s={...t};am.delete(n.params,s)}}}a(oE,"invalidateAllForAccount");function GD(t){return[...t.addresses].map(e=>`${e.networkID}:${e.address}`.toLowerCase()).sort().join("|")}a(GD,"accountFingerprint");var bl=class{static{a(this,"FundingWarmCacheListener")}getContext;constructor(e){this.getContext=e}onFundingPoolStateChange(e,r,n){if(e.type!=="fundingCompleted")return;let s=this.getContext();s&&oE(s)}};u();l();var iE="failedFundingEvents";var Tl=class{static{a(this,"FailedFundingEventsCache")}storage;listeners=[];storageKey;accountId;constructor(e,r){this.storage=e,this.accountId=r,this.storageKey=this.generateStorageKey()}async setAccountId(e){if(this.accountId===e)return;this.accountId=e,this.storageKey=this.generateStorageKey();let r=await this.getEvents();this.notifyListeners(r)}generateStorageKey(){return this.accountId?`${iE}_${this.accountId}`:iE}async addEvent(e){let r=await this.getEvents(),n={id:`${e.type}_${e.startedAt}_${e.amountUsd}`,type:e.type,amountUsd:e.amountUsd||"0",timestamp:Date.now(),startedAt:e.startedAt,errorMessage:e.getState().type==="failed"?e.getState().error?.message:void 0};r.some(o=>o.id===n.id)||(r.unshift(n),r.length>25&&r.splice(25),await this.storage.set(this.storageKey,r),this.notifyListeners(r))}async getEvents(){let e=await this.storage.get(this.storageKey);return Array.isArray(e)?e:[]}async clear(){await this.storage.remove(this.storageKey),this.notifyListeners([])}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(e){for(let r of this.listeners)r.onFailedEventsChange(e)}};u();l();var El=class{static{a(this,"FundingPool")}activeTasks=new Set;listeners=new Set;failedEventsCache;constructor(e){this.failedEventsCache=e}setFailedEventsCache(e){this.failedEventsCache=e}async setAccountId(e){await this.failedEventsCache?.setAccountId(e)}submit(e,r,n,s,o){e.getState().type!=="executing"&&(e.addListener(this.taskListener),this.activeTasks.add(e),e.execute(r,n,s,o))}getActiveTasks(){return Array.from(this.activeTasks)}getFailedEventsCache(){return this.failedEventsCache}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}pauseTasks(){this.activeTasks.forEach(e=>e.pause())}resumeTasks(){this.activeTasks.forEach(e=>e.resume())}taskListener={onFundingTaskStateChange:a((e,r,n)=>{switch(r.type){case"fundingStarted":break;case"fundingCompleted":this.activeTasks.delete(e),e.removeListener(this.taskListener);break;case"fundingFailed":this.activeTasks.delete(e),e.removeListener(this.taskListener),this.failedEventsCache?.addEvent(e);break}this.listeners.forEach(s=>s.onFundingPoolStateChange(r,e,this.getActiveTasks()))},"onFundingTaskStateChange")}};u();l();u();l();u();l();u();l();var VD="perps_deposit_step";var Al=class{static{a(this,"DepositStepCache")}storage;listeners=[];userAddress=null;constructor(e){this.storage=e}setUserAddress(e){this.userAddress=e}getKey(){if(!this.userAddress)throw new Error("User address not set");return`${VD}_${this.userAddress}`}set(e,r){(async()=>{let n={step:e,startedAt:r||Date.now()};await this.storage.set(this.getKey(),n),this.notifyListeners(n)})()}clear(){(async()=>(await this.storage.remove(this.getKey()),this.notifyListeners(null)))()}async get(){if(!this.userAddress)return null;let e=await this.storage.get(this.getKey());if(!e)return null;let r=e;return Date.now()-r.startedAt>12e5?(this.clear(),null):r}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(e){for(let r of this.listeners)r.onDepositStepChange(e)}};u();l();function aE(t){return t.type==="idle"?"idle":t.type==="streamOperations"?`${t.sourceTxHash}:${t.depositAddress}`:`${t.type}:${t.depositAddress}`}a(aE,"getDepositId");var lm=null;function $D(t){return lm||(lm=new Al(t)),lm}a($D,"getDepositStepCache");var xl=class{static{a(this,"DepositRecoverer")}perps;cache;analytics;constructor(e,r,n){this.perps=e,this.cache=$D(r),this.perps.user&&this.cache.setUserAddress(D(this.perps.user)),this.analytics=n}async getStuckDeposit(){this.perps.user&&this.cache.setUserAddress(D(this.perps.user));let e=await this.cache.get();return e?.step.type==="transfer"?(this.cache.clear(),null):e}async retry(e){if(e.type!=="streamOperations"){this.cache.clear();return}let r=aE(e);try{let n=await this.pollForOperationCompletion(e);if(!n.destinationAmount)throw this.cache.clear(),new Error("Operation has no destination amount");let{destinationAmount:s}=n,o=await this.perps.spot.getTokenMidPrice(e.spotTokenId),{totalSz:c,avgPx:d}=await this.sellSpotAsset(new b(s),e.assetId,o,e.tokenDecimals,r);await this.transferToPerps(c,d,r),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.cache.clear()}catch{this.cache.clear();return}}async pollForOperationCompletion(e){let s=!1;for(let o=0;o<15;o++){let c=await this.perps.client.getOperations({taker:D(this.perps.user)}),d=`${e.sourceTxHash}:${e.depositAddress}`,m=c.operations.find(p=>p.sourceTxHash===d);if(m){if(s=!0,m.state==="failure")throw new Error("Operation failed");if(m.state==="done")return m}o<14&&await new Promise(p=>setTimeout(p,5e3))}throw s?new Error("Operation not done after maximum attempts"):new Error("Operation not found")}async sellSpotAsset(e,r,n,s,o){let c=e.shiftedBy(-s).decimalPlaces(3,b.ROUND_DOWN),d=await this.perps.spot.sell(r,c.toString(),n);return this.analytics.reportDeposit(Ae.DEPOSIT_SELL_SPOT_COMPLETED,{depositId:o,assetId:r,assetLimitPriceUsd:n,tokenDecimals:s,adjustedDepositedAmount:c}),{totalSz:new b(d.totalSz),avgPx:new b(d.avgPx)}}async transferToPerps(e,r,n){let s=e.multipliedBy(r).decimalPlaces(2,b.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:s}),this.analytics.reportDeposit(Ae.DEPOSIT_TRANSFER_TO_PERP_COMPLETED,{depositId:n,totalSz:e,avgPx:r,transferUsdcAmount:s}),s}};u();l();var Il=class{static{a(this,"HyperunitDepositStateMachine")}step={type:"idle"};listeners=[];setStep(e){this.step=e}completeStep(e){let r=this.step,n=this.detectNextStep(e);if(!n){this.listeners.forEach(s=>s.onStepCompleted(this.step,void 0)),this.listeners.forEach(s=>s.onDepositCompleted());return}this.step=n,this.listeners.forEach(s=>s.onStepCompleted(r,n))}detectNextStep(e){switch(e.stepType){case"idle":return{type:"transfer",depositAddress:e.depositAddress,depositAmount:e.amount};case"transfer":if(this.step.type!=="transfer")throw new Error("Invalid step: expected transfer, got "+this.step.type);return{...this.step,type:"streamOperations",senderAddress:e.senderAddress,networkId:e.networkId,tokenDecimals:e.tokenDecimals,sourceTxHash:e.txHash,assetId:e.assetId,spotTokenId:e.spotTokenId,assetLimitPriceUsd:e.assetLimitPriceUsd};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return{...this.step,type:"sellSpotAsset",destinationAmount:e.destinationAmount};case"sellSpotAsset":if(this.step.type!=="sellSpotAsset")throw new Error("Invalid step: expected sellSpotAsset, got "+this.step.type);return{...this.step,type:"transferToPerps",totalSz:e.totalSz,avgPx:e.avgPx};case"transferToPerps":if(this.step.type!=="transferToPerps")throw new Error("Invalid step: expected transferToPerps, got "+this.step.type);return}}failStep(e){this.listeners.forEach(r=>r.onDepositFailed(this.step,e))}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}getStep(){return this.step}};u();l();var dm=class{static{a(this,"SolanaDepositTransfer")}sourceAddress;networkId;account;constructor(e,r,n){this.sourceAddress=e,this.networkId=r,this.account=n}async execute(e,r,n,s){let o=Jr(this.networkId),c=new ue.Transaction().add(ue.SystemProgram.transfer({fromPubkey:new ue.PublicKey(this.sourceAddress),toPubkey:new ue.PublicKey(r),lamports:e.toNumber()}));c=await Yi(c,{connection:o}),c.feePayer=new ue.PublicKey(this.sourceAddress),await $m(c,o);let d=await ss({accountIdentifier:this.account.identifier,feePayer:new ue.PublicKey(this.sourceAddress),connection:o,accountSigner:s,transaction:c,pendingTransactionInput:{ownerAddress:this.sourceAddress,networkID:this.networkId,data:{signature:""},type:st.DappInteraction,display:{summary:{topLeft:{text:"Deposit"}}}},storage:n});return await Yr({connection:o,signature:d}),{senderAddress:this.sourceAddress,networkId:this.networkId,tokenDecimals:9,txHash:d}}},kl=class{static{a(this,"DepositTransferFactory")}create(e,r){let n=e.chainId,s=r.addresses.find(o=>o.networkID===n)?.address;if(!s)throw new Error(`No source address found for networkID: ${n}`);if(A.isSolanaNetworkID(n))return new dm(s,n,r);throw new Error(`Unsupported chain for deposit transfer: ${n}`)}};u();l();function pm(t){switch(t.type){case"transfer":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString()};case"streamOperations":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash};case"sellSpotAsset":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash,destinationAmount:t.destinationAmount.toString()};case"transferToPerps":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash,destinationAmount:t.destinationAmount.toString(),totalSz:t.totalSz.toString(),avgPx:t.avgPx.toString()};default:return{step:t.type}}}a(pm,"getDepositStepLogsDetails");var mm=a(t=>{switch(t.type){case"perpsToSpot":case"buyAsset":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString()};case"sendToWithdrawAddress":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString(),assetMidPrice:t.assetMidPrice.toString(),filledAmount:t.filledAmount.toString()};case"streamOperations":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString(),sendToWithdrawAmount:t.sendToWithdrawAmount.toString(),operationStartTime:t.operationStartTime.toISOString()};default:return{step:t.type}}},"getWithdrawStepLogsDetails");u();l();var lo=class{static{a(this,"OperationsStreamer")}perpsClient;streamOpen=!1;listeners=[];interval=2e3;constructor(e){this.perpsClient=e}startStream(e,r,n){this.streamOpen=!0,this.stream(D(e),r,n)}startWithdrawStream(e,r,n){this.streamOpen=!0,this.streamWithdraw(D(e),r,n)}stream(e,r,n){this.streamOpen&&(async()=>{try{let s=await this.perpsClient.getOperations({taker:e}),o=`${r}:${n}`,c=s.operations.find(d=>d.sourceTxHash===o);this.listeners.forEach(d=>{d.onOperation(s,c)}),this.streamOpen&&setTimeout(()=>this.stream(e,r,n),this.interval)}catch(s){this.listeners.forEach(o=>{o.onError(s)}),this.stopStream()}})()}streamWithdraw(e,r,n){this.streamOpen&&(async()=>{try{let s=await this.perpsClient.getOperations({taker:e}),o=this.findMatchingWithdrawOperation(s.operations,r,n);this.listeners.forEach(c=>{c.onOperation(s,o)}),this.streamOpen&&setTimeout(()=>this.streamWithdraw(e,r,n),this.interval)}catch(s){this.listeners.forEach(o=>{o.onError(s)}),this.stopStream()}})()}findMatchingWithdrawOperation(e,r,n){let s=e.filter(o=>{if(o.sourceChain!=="hyperliquid"||o.destinationChain!=="solana"||!o.opCreatedAt)return!1;let c=new Date(o.opCreatedAt).getTime(),d=Math.abs(c-r.getTime()),m=4*60*1e3;if(d>m)return!1;if(o.sourceAmount){let p=new b(o.sourceAmount).dividedBy(10**Bn.data.decimals),f=n,g=p.minus(f).abs(),w=f.multipliedBy(.1);if(g.isGreaterThan(w))return!1}return!0});if(s.length!==0)return s.sort((o,c)=>new Date(c.opCreatedAt).getTime()-new Date(o.opCreatedAt).getTime())[0]}stopStream(){this.streamOpen=!1}subscribe(e){return this.listeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){this.listeners=this.listeners.filter(r=>r!==e)}};var Cl=class t extends Ct{static{a(this,"HyperunitDepositTask")}perps;assetId;spotTokenId;depositTokenCaip19;account;depositAddress;storage;signer;stateMachine=new Il;depositTransferFactory=new kl;operationsStreamer;depositRecoverer;fundingState="active";analytics;depositId;constructor(e,r,n,s,o,c,d,m,p,f,g,w,y){super("deposit",e,r,n),this.perps=s,this.assetId=o,this.spotTokenId=c,this.depositTokenCaip19=d,this.account=m,this.depositAddress=p,this.storage=f,this.signer=g,this.analytics=w,this.stateMachine.addListener(this.stateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new lo(this.perps.client),this.depositRecoverer=new xl(this.perps,this.storage,this.analytics),this.perps.user&&this.depositRecoverer.cache.setUserAddress(D(this.perps.user)),this.depositId=y||be(),this.reportAnalytics(Ae.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let n={fundingType:"deposit",fundingRoute:$e.Hyperunit,amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,assetId:this.assetId,spotTokenId:this.spotTokenId,depositTokenCaip19:D(this.depositTokenCaip19),depositAddress:this.depositAddress,depositId:this.depositId,isPhantomCash:!1};this.analytics.reportDeposit(e,{...n,...r})}stateMachineListener={onStepCompleted:a((e,r)=>{this.fundingState!=="paused"&&(e.type==="transfer"&&this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),r&&(this.depositRecoverer.cache.set(r,this.startedAt),this.executeStep(r)))},"onStepCompleted"),onDepositCompleted:a(()=>{this.depositRecoverer.cache.clear(),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics(Ae.FUNDING_COMPLETED,{})},"onDepositCompleted"),onDepositFailed:a((e,r)=>{console.error(`Deposit failed at step: ${e.type}`,r),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"failed",error:r},this.notify({type:"fundingFailed",error:r},this.state),this.reportAnalytics(Ae.FUNDING_FAILED,{error:r instanceof Error?r.message:String(r)})},"onDepositFailed")};stateLogsListener={onStepCompleted:a((e,r)=>{E.addBreadcrumb(I.Perps,`Deposit step completed: ${e.type}`,F.Info,{...pm(e),amountUsd:this.amountUsd??""})},"onStepCompleted"),onDepositCompleted:a(()=>{this.stateMachine.removeListener(this.stateLogsListener)},"onDepositCompleted"),onDepositFailed:a((e,r)=>{E.addBreadcrumb(I.Perps,`Deposit failed at step: ${e.type}`,F.Error,{error:r instanceof Error?r.message:"Unknown error",...pm(e),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)},"onDepositFailed")};execute(e,r,n,s){if(this.amount=n,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),s){this.stateMachine.setStep(s.state),this.stateMachine.completeStep(s.completedStep);return}this.stateMachine.completeStep({stepType:"idle",depositAddress:this.depositAddress,amount:e})}pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics(Ae.FUNDING_PAUSED,{})}resume(){this.fundingState="active";let e=this.stateMachine.getStep();e.type==="streamOperations"&&((async()=>{try{if(!this.perps.user)return;let r=await this.perps.client.getOperations({taker:D(this.perps.user)}),n=`${e.sourceTxHash}:${e.depositAddress}`,s=r.operations.find(o=>o.sourceTxHash===n);s&&s.state==="done"?this.processOperation(s):this.executeStep(e)}catch{this.executeStep(e)}})(),this.reportAnalytics(Ae.FUNDING_RESUMED,{}))}executeStep(e){(async()=>{try{switch(e.type){case"transfer":this.reportAnalytics(Ae.DEPOSIT_TRANSFER_STARTED,{...e});let{senderAddress:r,networkId:n,tokenDecimals:s,txHash:o}=await this.transfer(e.depositAmount),c=await this.perps.spot.getTokenMidPrice(this.spotTokenId);this.stateMachine.completeStep({stepType:"transfer",senderAddress:r,networkId:n,tokenDecimals:s,txHash:o,assetId:this.assetId,spotTokenId:this.spotTokenId,assetLimitPriceUsd:c}),this.reportAnalytics(Ae.DEPOSIT_TRANSFER_COMPLETED,{...e,senderAddress:r,networkId:n,tokenDecimals:s,txHash:o,assetLimitPriceUsd:c});break;case"streamOperations":this.reportAnalytics(Ae.DEPOSIT_STREAM_OPERATIONS_STARTED,{...e}),this.startOperationsStream(e.sourceTxHash,e.depositAddress),this.reportAnalytics(Ae.DEPOSIT_STREAM_OPERATIONS_COMPLETED,{...e});break;case"sellSpotAsset":this.reportAnalytics(Ae.DEPOSIT_SELL_SPOT_STARTED,{...e});let d=await this.sellSpotAsset(e.depositAmount,e.tokenDecimals);this.stateMachine.completeStep({stepType:"sellSpotAsset",...d}),this.reportAnalytics(Ae.DEPOSIT_SELL_SPOT_COMPLETED,{...e,...d});break;case"transferToPerps":this.reportAnalytics(Ae.DEPOSIT_TRANSFER_TO_PERP_STARTED,{...e});let m=await this.transferToPerps(e.totalSz,e.avgPx);this.stateMachine.completeStep({stepType:"transferToPerps",transferUsdcAmount:m}),this.reportAnalytics(Ae.DEPOSIT_TRANSFER_TO_PERP_COMPLETED,{...e,transferUsdcAmount:m});break}}catch(r){this.stateMachine.failStep(r)}})()}async transfer(e){return await this.depositTransferFactory.create(this.depositTokenCaip19,this.account).execute(e,this.depositAddress,this.storage,this.signer)}startOperationsStream(e,r){if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startStream(this.perps.user,e,r)}operationsStreamListener={onOperation:a((e,r)=>{r&&this.processOperation(r)},"onOperation"),onError:a(e=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(e)},"onError")};processOperation(e){if(e.state==="failure"){this.stateMachine.failStep(new Error("Operation failed"));return}if(e.state==="done"){if(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),!e.destinationAmount)throw new Error("Destination amount is required");this.stateMachine.completeStep({stepType:"streamOperations",destinationAmount:new b(e.destinationAmount)})}}async sellSpotAsset(e,r){let n=e.shiftedBy(-r).decimalPlaces(3,b.ROUND_DOWN),s=await this.perps.spot.getTokenMidPrice(this.spotTokenId),o=await this.perps.spot.sell(this.assetId,n.toString(),s);return{totalSz:new b(o.totalSz),avgPx:new b(o.avgPx)}}async transferToPerps(e,r){let n=e.multipliedBy(r).decimalPlaces(2,b.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:n}),n}static create({minimumUiAmount:e,estimatedTime:r,fee:n,perps:s,assetId:o,spotTokenId:c,depositTokenCaip19:d,account:m,depositAddress:p,storage:f,signer:g,analytics:w,depositId:y}){return new t(e,r,n,s,o,c,d,m,p,f,g,w,y)}};u();l();u();l();var cE={1:7e-4,2:6e-4,3:5e-4,4:4e-4,5:35e-5,6:3e-4,7:.0025,8:.002};u();l();var _l=class{static{a(this,"HyperunitWithdrawStateMachine")}step;constructor(e){e?this.step=e:this.step={type:"idle"}}setStep(e){this.step=e}listeners=[];completeStep(e){let r=this.step,n=this.detectNextStep(e);if(!n){this.listeners.forEach(s=>s.onStepCompleted(this.step,void 0)),this.listeners.forEach(s=>s.onWithdrawCompleted());return}this.step=n,this.listeners.forEach(s=>s.onStepCompleted(r,n))}failStep(e){this.listeners.forEach(r=>r.onWithdrawFailed(this.step,e))}detectNextStep(e){switch(e.stepType){case"idle":return{type:"perpsToSpot",withdrawAddress:e.withdrawAddress,assetId:e.assetId,estimatedTime:e.estimatedTime,withdrawAmountUsd:e.withdrawAmountUsd};case"perpsToSpot":if(this.step.type!=="perpsToSpot")throw new Error("Invalid step: expected perpsToSpot, got "+this.step.type);return{...this.step,type:"buyAsset"};case"buyAsset":if(this.step.type!=="buyAsset")throw new Error("Invalid step: expected buyAsset, got "+this.step.type);return{...this.step,type:"sendToWithdrawAddress",assetMidPrice:e.assetMidPrice,filledAmount:e.filledAmount};case"sendToWithdrawAddress":if(this.step.type!=="sendToWithdrawAddress")throw new Error("Invalid step: expected sendToWithdrawAddress, got "+this.step.type);return{...this.step,type:"streamOperations",sendToWithdrawAmount:e.sendToWithdrawAmount,operationStartTime:new Date};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}getStep(){return this.step}};var Fl=class extends Ct{static{a(this,"HyperunitWithdrawTask")}withdrawAddress;withdrawAddressRole;assetId;spotTokenName;spotTokenId;perps;stateMachine=new _l;analytics;operationsStreamer;fundingState="active";withdrawId;constructor(e,r,n,s,o,c,d,m,p,f,g){super("withdraw",d,m,p),this.withdrawAddress=e,this.withdrawAddressRole=r,this.assetId=n,this.spotTokenName=s,this.spotTokenId=o,this.perps=c,this.analytics=f,this.withdrawId=g||be(),this.stateMachine.addListener(this.withdrawStateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new lo(this.perps.client),this.reportAnalytics(le.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let n={fundingType:"withdraw",amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole,assetId:this.assetId,spotTokenName:this.spotTokenName,spotTokenId:this.spotTokenId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString(),withdrawId:this.withdrawId};this.analytics.reportWithdraw(e,{...n,...r})}withdrawStateMachineListener={onStepCompleted:a((e,r)=>{this.fundingState!=="paused"&&(e.type==="sendToWithdrawAddress"&&this.notify({type:"fundingBridgingStarted",estimateTime:"4"},this.state),r&&this.executeStep(r))},"onStepCompleted"),onWithdrawCompleted:a(()=>{this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics(le.FUNDING_COMPLETED,{})},"onWithdrawCompleted"),onWithdrawFailed:a((e,r)=>{console.error(`Withdraw failed at step: ${e.type}`,r),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"failed",error:r},this.notify({type:"fundingFailed",error:r},this.state),this.reportAnalytics(le.FUNDING_FAILED,{error:r instanceof Error?r.message:String(r)})},"onWithdrawFailed")};stateLogsListener={onStepCompleted:a((e,r)=>{E.addBreadcrumb(I.Perps,`Withdraw step completed: ${e.type}`,F.Info,{...mm(e),amountUsd:this.amountUsd??""})},"onStepCompleted"),onWithdrawCompleted:a(()=>{this.stateMachine.removeListener(this.stateLogsListener)},"onWithdrawCompleted"),onWithdrawFailed:a((e,r)=>{E.addBreadcrumb(I.Perps,`Withdraw failed at step: ${e.type}`,F.Error,{error:r instanceof Error?r.message:"Unknown error",...mm(e),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)},"onWithdrawFailed")};pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics(le.FUNDING_PAUSED,{})}resume(){this.fundingState="active";let e=this.stateMachine.getStep();e.type==="streamOperations"&&(this.perps.user&&this.executeStep(e),this.reportAnalytics(le.FUNDING_RESUMED,{}))}execute(e,r,n,s){if(this.amount=n,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics(le.FUNDING_INITIATED,{}),s){this.stateMachine.setStep(s.state),this.stateMachine.completeStep(s.completedStep);return}this.stateMachine.completeStep({stepType:"idle",withdrawAddress:this.withdrawAddress,assetId:this.assetId,estimatedTime:this.estimatedTime??"",withdrawAmountUsd:e})}executeStep(e){(async()=>{try{switch(e.type){case"perpsToSpot":this.reportAnalytics(le.PERPS_TO_SPOT_STARTED,e),await this.transferToSpot(e.withdrawAmountUsd),this.reportAnalytics(le.PERPS_TO_SPOT_COMPLETED,e);break;case"buyAsset":this.reportAnalytics(le.BUY_ASSET_STARTED,e),await this.buyAsset(e.assetId,e.withdrawAmountUsd),this.reportAnalytics(le.BUY_ASSET_COMPLETED,e);break;case"sendToWithdrawAddress":this.reportAnalytics(le.SEND_TO_WITHDRAW_ADDRESS_STARTED,e),await this.sendToWithdrawAddress(this.spotTokenName,this.spotTokenId,e.filledAmount),this.reportAnalytics(le.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,e);break;case"streamOperations":this.reportAnalytics(le.WITHDRAW_STREAM_OPERATIONS_STARTED,e),this.startOperationsStream(e),this.reportAnalytics(le.WITHDRAW_STREAM_OPERATIONS_COMPLETED,e);break}}catch(r){this.stateMachine.failStep(r)}})()}async transferToSpot(e){let r=this.withdrawAddressRole==="missing"?new b(1):new b(0);await this.perps.transfer({toPerp:!1,amount:e.minus(r)}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.stateMachine.completeStep({stepType:"perpsToSpot"})}async buyAsset(e,r){let n=await this.perps.spot.getTokenMidPrice(this.spotTokenId),s=r.dividedBy(n.multipliedBy(ll)).decimalPlaces(3),o=await this.perps.spot.buy(e,s.toString(),n),c=cE[1];this.stateMachine.completeStep({stepType:"buyAsset",assetMidPrice:n,filledAmount:new b(o.totalSz).multipliedBy(1-c)})}async sendToWithdrawAddress(e,r,n){let s=this.fee.dividedBy(10**Bn.data.decimals),o=n.minus(s).decimalPlaces(3,b.ROUND_DOWN);await this.perps.spot.send(e,r,o,this.withdrawAddress),this.stateMachine.completeStep({stepType:"sendToWithdrawAddress",sendToWithdrawAmount:o})}startOperationsStream(e){if(e.type!=="streamOperations")throw new Error("Invalid step type for operations stream");if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startWithdrawStream(this.perps.user,e.operationStartTime,e.sendToWithdrawAmount)}operationsStreamListener={onOperation:a((e,r)=>{r&&this.processOperation(r)},"onOperation"),onError:a(e=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(e)},"onError")};processOperation(e){if(e.state==="failure"){this.stateMachine.failStep(new Error("Withdrawal operation failed"));return}e.state==="done"&&(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),this.stateMachine.completeStep({stepType:"streamOperations"}))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var Pl=class{static{a(this,"HyperunitFundingTaskFactory")}analytics;constructor(e){this.analytics=e}async createTask(e,r,n,s,o,c,d,m){switch(m.type){case"deposit":return this.createDepositTask(e,r,m.depositTokenCaip19,d,o,c,m.depositId);case"withdraw":return this.createWithdrawTask(e,m.withdrawNetworkId,r)}}async createDepositTask(e,r,n,s,o,c,d){let{fundingCaip19Address:m,spotAssetId:p,eta:f,minimumAmount:g,spotTokenId:w,fee:y}=await e.client.postFunding({type:"deposit",taker:D(s),originChain:n.chainId}),S=this.checkCaip19Address(m);return Cl.create({minimumUiAmount:new b(g),estimatedTime:f,fee:new b(y),perps:e,assetId:p,spotTokenId:w,depositTokenCaip19:n,account:r,depositAddress:S,storage:o,signer:c,analytics:this.analytics,depositId:d})}async createWithdrawTask(e,r,n){let s=n.addresses.find(S=>S.networkID===r);if(!s)throw new Error("Couldn't find destination account address for network: "+r);let{fundingCaip19Address:o,spotAssetId:c,eta:d,minimumAmount:m,spotTokenName:p,spotTokenId:f,fee:g}=await e.client.postFunding({type:"withdraw",taker:D({resourceType:W.address,chainId:s.networkID,address:s.address}),originChain:r}),w=this.checkCaip19Address(o),y=await e.client.getUserRole(w);return new Fl(w,y.role,c,p,f,e,new b(m),d,new b(g),this.analytics)}checkCaip19Address(e){let r=je(e);if(r.resourceType!==W.address)throw new Error("Funding CAIP19 is not an address");return r.address}};u();l();var fm=class extends Ct{static{a(this,"MockFundingTask")}shouldFail;constructor(e,r=!1){super(e,new b(.01),"1m",new b(8471530)),this.shouldFail=r}execute(e,r,n){this.amount=n,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),setTimeout(()=>{if(this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),this.shouldFail){setTimeout(()=>{this.state={type:"failed",error:new Error("Mock funding task failed")},this.notify({type:"fundingFailed",error:new Error("Mock funding task failed")},this.state)},3e3);return}setTimeout(()=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state)},3e3)},3e3)}pause(){}resume(){}},vi=class{static{a(this,"MockFundingTaskFactory")}createTask(e,r,n,s,o,c,d,m){return Promise.resolve(new fm(m.type,!1))}};var dE=(0,Ar.createContext)(null),uE=!1;function jD({fundingPoolFactory:t,children:e}){let r=tE(),n=Ke(),s=Wi(),o=Wr(),c=Pe(),d=(0,Ar.useMemo)(()=>{let f;if(t)f=t.create();else{let y=new Tl(n);f=new El(y)}f.addListener(new wl),f.addListener(new yl),f.addListener(new gl(c));let g=uE?new vi:new Sl(r),w=uE?new vi:new Pl(r);return new pl({client:new qu,isTestnet:s,fundingPool:f,relayFundingTaskFactory:g,hyperunitFundingTaskFactory:w,authRepository:o})},[t,r,n,s,o,c]);(0,Ar.useEffect)(()=>{let f=new bl(()=>{let g=d.account,w=d.user;if(!(!g||!w))return{account:g,user:w,cashAccount:void 0,storage:n,perps:d,determineProvider:a(()=>{},"determineProvider"),getAvailableProviders:a(()=>[],"getAvailableProviders")}});return d.fundingPool.addListener(f),()=>d.fundingPool.removeListener(f)},[d,n]);let{data:m}=Fe();(0,Ar.useEffect)(()=>{m&&d.setAccount(m)},[m,d]);let p=jr();return(0,Ar.useEffect)(()=>{d.setSigner(p)},[p,d]),(0,lE.jsx)(dE.Provider,{value:d,children:e})}a(jD,"PerpsProvider");function Ri(){let t=(0,Ar.useContext)(dE);if(!t)throw new Error("usePerps must be used within a PerpsProvider");return t}a(Ri,"usePerpsContext");u();l();var pE=U($());var KD=K({days:1}),mE=K({minutes:15}),WD=i.record(Gr,Gr),fE=a(()=>ne({queryKey:to.fungibleToPerpMap(),queryFn:a(()=>{try{return hE()}catch(t){throw E.addBreadcrumb(I.Perps,"Failed to get fungible to perp map",F.Error,{error:t instanceof Error?t.message:"Unknown error"}),t}},"queryFn"),gcTime:KD,staleTime:mE}),"useFungibleToPerpMap"),ZD=a(t=>t.prefetchQuery({queryKey:to.fungibleToPerpMap(),queryFn:hE,staleTime:mE}),"prefetchFungibleToPerpMap"),XD=a(()=>{let t=Pe();(0,pE.useEffect)(()=>{zi("enable-terminal-cta")&&ZD(t)},[t])},"usePrefetchFungibleToPerpMap"),hE=a(async()=>{let t=await H.api().get("/swap/v2/perp/fungible-to-perp-map");if(!ee(t))throw new Error("Failed to get fungible to perp map: response is not okay");let e=t.data,r=WD.safeParse(e);if(!r.success)throw new Error("Failed to get fungible to perp map: schema validation failed");return r.data},"getFungibleToPerpMap");u();l();var gE=U($());var JD=a(t=>{let{data:e}=fE();return(0,gE.useMemo)(()=>{if(!(!e||!t))return e[t]??void 0},[t,e])},"useFungibleToPerp");u();l();u();l();var Rl=U($());u();l();var yE=U($());var Zn=a(()=>{let{data:[t]}=xt(["enable-perps"]),{data:e}=Fe(),r=(0,yE.useMemo)(()=>e?.addresses.some(n=>A.isEVMNetworkID(n.networkID))??!1,[e]);return pt?t&&r:!1},"useIsPerpsSupported");u();l();var Qe=U($());var vl=a(()=>{let t=Ri(),e=(0,Qe.useCallback)(()=>{t.syncAccountBalance()},[t]),[r,n]=(0,Qe.useState)(t.getAccountBalanceState());(0,Qe.useEffect)(()=>t.subscribeAccountBalanceState({onAccountBalanceStateChange:a(Q=>{n(Q)},"onAccountBalanceStateChange")}),[t]);let s=(0,Qe.useCallback)(()=>{t.syncPositions()},[t]),[o,c]=(0,Qe.useState)(t.getPositionsState());(0,Qe.useEffect)(()=>t.subscribePositions({onPositionStateChange:a(Q=>{c(Q)},"onPositionStateChange")}),[t]);let d=(0,Qe.useCallback)(()=>{t.syncPositionFees()},[t]),[m,p]=(0,Qe.useState)(t.getPositionFeesState());(0,Qe.useEffect)(()=>t.subscribePositionFees({onPositionFeesStateChange:a(Q=>{p(Q)},"onPositionFeesStateChange")}),[t]);let f=(0,Qe.useCallback)(()=>{t.syncFundingHistory()},[t]),[g,w]=(0,Qe.useState)(t.getFundingHistoryState());(0,Qe.useEffect)(()=>t.subscribeFundingHistory({onFundingHistoryStateChange:a(Q=>{w(Q)},"onFundingHistoryStateChange")}),[t]);let y=(0,Qe.useCallback)(Q=>{t.syncHistoricalOrders(Q)},[t]),[S,x]=(0,Qe.useState)(t.getHistoricalOrdersState());(0,Qe.useEffect)(()=>t.subscribeHistoricalOrders({onHistoricalOrdersStateChange:a(Q=>{x(Q)},"onHistoricalOrdersStateChange")}),[t]);let T=(0,Qe.useCallback)((Q,R,G,M)=>{t.syncPricing(Q,R,G,M)},[t]),_=(0,Qe.useCallback)(Q=>{t.startSequentialPricingSync(Q)},[t]),[k,P]=(0,Qe.useState)(t.getPricingState());(0,Qe.useEffect)(()=>t.subscribePricing({onPricingStateChange:a(Q=>{P(Q)},"onPricingStateChange")}),[t]);let v=(0,Qe.useCallback)(()=>t.getAccountBalanceState(),[t]),z=(0,Qe.useCallback)(Q=>{t.warmOpenPositionLeverage(Q)},[t]);return{isReady:t.getUser()!==void 0,accountBalanceState:r,syncAccountBalance:e,getAccountBalanceState:v,positionsState:o,syncPositions:s,positionFeesState:m,syncPositionFees:d,warmOpenPositionLeverage:z,fundingHistoryState:g,syncFundingHistory:f,historicalOrdersState:S,syncHistoricalOrders:y,pricingState:k,syncPricing:T,startSequentialPricingSync:_}},"usePerps");var YD=a(t=>{let e=Zn(),r=t?.isSupported??e,n=Ri(),{syncAccountBalance:s,syncPositions:o,syncHistoricalOrders:c,syncPositionFees:d,accountBalanceState:m,positionsState:p,historicalOrdersState:f,positionFeesState:g,syncFundingHistory:w,fundingHistoryState:y}=vl(),S=(0,Rl.useCallback)(()=>{r&&(s(),o(),c(),d(),w())},[s,o,c,r,d,w]);return(0,Rl.useEffect)(()=>n.subscribeAccountChange({onAccountChange:a(()=>{S()},"onAccountChange")}),[n,S]),{isLoading:eN(m,p,f,g,y),isRefreshing:tN(m,p,f,g,y),isIndeterminate:rN(m,p,f,g,y),refetch:S}},"useSyncPerpsPortfolio");function eN(t,e,r,n,s){return t.type==="loading"||e.type==="loading"||r.type==="loading"||n.type==="loading"||s.type==="loading"}a(eN,"isLoading");function tN(t,e,r,n,s){return t.type==="refreshing"||e.type==="refreshing"||r.type==="refreshing"||n.type==="refreshing"||s.type==="refreshing"}a(tN,"isRefreshing");function rN(t,e,r,n,s){return t.type==="indeterminate"||e.type==="indeterminate"||r.type==="indeterminate"||n.type==="indeterminate"||s.type==="indeterminate"}a(rN,"isIndeterminate");u();l();var wE=U($());var nN=a(()=>{let{data:[t]}=xt(["enable-extension-perps"]),{data:e}=Fe(),r=(0,wE.useMemo)(()=>e?.addresses.some(n=>A.isEVMNetworkID(n.networkID))??!1,[e]);return pt?!1:t&&r},"useIsExtensionPerpsSupported");u();l();var SE=U($());var hm=a(()=>{let{data:[t]}=xt(["enable-extension-perps-explore"]),{data:e}=Fe(),r=(0,SE.useMemo)(()=>e?.addresses.some(n=>A.isEVMNetworkID(n.networkID))??!1,[e]);return pt?!1:t&&r},"useIsExtensionPerpsExploreSupported");u();l();var Jt=U($());u();l();var bE=3,m1e=ql(t=>{let e=t(gm);return{isPerpsBalanceError:e.accountBalanceErrors>=bE,isPerpsPositionsError:e.positionsErrors>=bE}}),gm=ql({accountBalanceErrors:0,positionsErrors:0});var TE=0,sN=a(({interval:t=5e3,enabled:e=!0,maxConsecutiveErrors:r=3,onSyncPaused:n,isSupported:s}={})=>{let o=Zn(),c=s??o,{syncAccountBalance:d,syncPositions:m,accountBalanceState:p,positionsState:f}=vl(),g=(0,Jt.useRef)(null),w=(0,Jt.useRef)(e),y=(0,Jt.useRef)(!1),S=sh(gm);w.current=e,(0,Jt.useEffect)(()=>{let k="consecutiveErrors"in p?p.consecutiveErrors:0,P="consecutiveErrors"in f?f.consecutiveErrors:0,z=Math.min(k,P)>=r;z&&!y.current?(y.current=!0,n&&n()):!z&&y.current&&(y.current=!1),S({accountBalanceErrors:k,positionsErrors:P})},[p,f,r,n,S]);let x=(0,Jt.useCallback)(()=>{if(c&&w.current&&!y.current){let k=Date.now();k-TE>=t&&(d(),m(),TE=k)}},[d,m,c,t]),T=(0,Jt.useCallback)(()=>{if(!c||!w.current)return;g.current&&clearTimeout(g.current);let k=a(()=>{w.current&&(x(),g.current=setTimeout(k,t))},"poll");g.current=setTimeout(k,t)},[x,t,c]),_=(0,Jt.useCallback)(()=>{g.current&&(clearTimeout(g.current),g.current=null)},[]);return(0,Jt.useEffect)(()=>(e&&c?T():_(),_),[e,c,T,_]),(0,Jt.useEffect)(()=>()=>{_()},[_]),{startPolling:T,stopPolling:_,syncPerpsData:x,isSyncPaused:y.current}},"usePerpsPolling");u();l();var Bl=U($());u();l();var FE=U(MA()),PE=U(OA());var oN=i.object({domain:i.string(),url:i.string(),name:i.string(),category:i.string(),imageUrl:i.string(),slug:i.string()}),vE=i.object({uuid:i.string(),data:i.array(oN)}),iN=i.object({type:i.literal("site"),url:i.string(),name:i.string(),category:i.string(),imageUrl:i.string(),description:i.string().optional()}),aN=i.object({type:i.literal("tokenCategory"),id:i.string(),name:i.string(),subtitle:i.string().optional(),imageUrl:i.string(),description:i.string().optional()}),RE=i.discriminatedUnion("type",[iN,aN]),q1e=a(t=>t.type==="site","isFeaturedSite");var cN=i.object({chainId:kr,address:i.string(),name:i.string(),symbol:i.string(),logoUrl:i.string(),marketCap:i.number(),price:i.number(),priceChange:i.number(),volume:i.number(),volumeChange:i.number(),spamStatus:bo.optional().default(ce.NotVerified)}),uN=i.object({chainId:kr,address:i.string(),name:i.string(),symbol:i.string(),logoUrl:i.string(),marketCap:i.number(),price:i.number(),priceChange:i.number(),volume:i.number(),volumeChange:i.number(),spamStatus:bo.optional().default(ce.NotVerified)}),z1e=i.object({id:i.string(),name:i.string(),imageUri:i.string()}),DE=i.object({items:i.array(cN)}),Q1e=i.object({items:i.array(uN)}),lN=i.object({paymentTokenId:i.string(),name:i.string(),symbol:i.string(),decimals:i.number()}),dN=i.object({verified:i.boolean(),collectionUrl:i.string(),marketplaceId:i.string(),marketplaceName:i.string(),marketplaceCollectionId:i.string()}),pN=i.object({marketplaceId:i.string(),paymentToken:lN,value:i.string()}),mN=i.object({id:i.string(),name:i.string(),volume:i.string().optional(),volumePercentChange:i.number(),marketplacePages:i.array(dN),floorPrices:i.array(pN),imageUrl:i.string()}),NE=i.object({uuid:i.string(),data:i.array(mN)}),fN=["tokens","perps","sites","collections","learn","suggested-users-to-follow","suggested-users-to-follow-by-pnl","token-categories","trending-perps","perps-market-lists"],ir=i.enum(["shortcuts","carousel",...fN]),hN=i.object({type:i.literal(ir.enum.shortcuts)}),gN=i.object({type:i.literal(ir.enum.carousel)}),yN=i.object({type:i.literal(ir.enum["suggested-users-to-follow"]),limit:i.number()}),wN=["7d","30d"],EE=i.enum(wN),SN=i.object({type:i.literal(ir.enum["suggested-users-to-follow-by-pnl"]),limit:i.number(),timeFrame:i.array(EE).refine(t=>new Set(t).size===t.length),timeFrameDefault:EE}),Di="all_networks",po=i.union([kr,i.literal(Di)]),bN=["asc","desc"],ym=i.enum(bN),TN=["rank","volume","price","price-change","market-cap"],AE=i.enum(TN),EN=["1h","24h","7d","30d"],xE=i.enum(EN),AN=i.object({type:i.literal(ir.enum.tokens),sortBy:i.array(AE).refine(t=>new Set(t).size===t.length),sortByDefault:AE,sortDirectionDefault:ym,network:i.array(po).refine(t=>new Set(t).size===t.length),networkDefault:po,timeFrame:i.array(xE).refine(t=>new Set(t).size===t.length),timeFrameDefault:xE,rankAlgo:i.string(),limit:i.number(),listLimit:i.number()}),xN=i.object({type:i.literal(ir.enum["token-categories"])}),IN=["volume","price-change","open-interest","trending"],Dl=i.enum(IN),kN=["1h","24h","7d","30d"],Nl=i.enum(kN),CN=i.object({type:i.literal(ir.enum.perps),sortBy:i.array(Dl).refine(t=>new Set(t).size===t.length),sortByDefault:Dl,sortDirectionDefault:ym,timeFrame:i.array(Nl).refine(t=>new Set(t).size===t.length),timeFrameDefault:Nl,limit:i.number(),listLimit:i.number()}),_N=i.object({type:i.literal(ir.enum["trending-perps"]),sortBy:i.array(Dl).refine(t=>new Set(t).size===t.length),sortByDefault:Dl,sortDirectionDefault:ym,timeFrame:i.array(Nl).refine(t=>new Set(t).size===t.length),timeFrameDefault:Nl,limit:i.number(),listLimit:i.number()}),FN=["top","rank"],IE=i.enum(FN),PN=["24h","7d","30d"],kE=i.enum(PN),vN=i.object({type:i.literal(ir.enum.sites),sortBy:i.array(IE).refine(t=>new Set(t).size===t.length),sortByDefault:IE,network:i.array(po).refine(t=>new Set(t).size===t.length),networkDefault:po,timeFrame:i.array(kE).refine(t=>new Set(t).size===t.length),timeFrameDefault:kE,rankAlgo:i.string(),limit:i.number(),listLimit:i.number()}),RN=["top","rank"],CE=i.enum(RN),DN=["24h","7d","30d"],_E=i.enum(DN),NN=i.object({type:i.literal(ir.enum.collections),sortBy:i.array(CE).refine(t=>new Set(t).size===t.length),sortByDefault:CE,network:i.array(po).refine(t=>new Set(t).size===t.length),networkDefault:po,timeFrame:i.array(_E).refine(t=>new Set(t).size===t.length),timeFrameDefault:_E,rankAlgo:i.string(),limit:i.number(),listLimit:i.number()}),BN=i.object({type:i.literal(ir.enum.learn),limit:i.number()}),wm=i.discriminatedUnion("type",[hN,gN,yN,SN,AN,CN,_N,vN,NN,BN,xN]),BE=i.object({sections:i.array(wm).refine(t=>(0,FE.default)(t,(0,PE.default)(t,"type")))}),H1e=i.object({uuid:i.string(),data:i.array(Zm)}),G1e=i.object({tokenAddress:i.string(),bondingCurve:i.string(),migratedPool:i.string().optional(),name:i.string(),image:i.string(),symbol:i.string(),marketCap:i.coerce.number(),liquidity:i.coerce.number(),bondingCurvePercentage:i.coerce.number(),tokenCreatedAt:i.coerce.date(),twitter:i.string(),website:i.string(),telegram:i.string(),discord:i.string(),migratedAt:i.coerce.date().optional(),type:i.enum(["NEW","ABOUT_TO_MIGRATE","MIGRATED"]).optional(),slot:i.coerce.number().optional(),devHolding:i.coerce.number(),snipersHolding:i.coerce.number(),bundlersHolding:i.coerce.number(),top10Holding:i.coerce.number(),volume:i.coerce.number(),buysCount:i.coerce.number(),sellsCount:i.coerce.number(),uniqueHolders:i.coerce.number(),telegramCallCount:i.coerce.number(),bondingCurvePlatform:i.string()});var LE=BE.parse({sections:[{type:"shortcuts"},{type:"carousel"},{type:"tokens",sortBy:["rank","volume","price","price-change","market-cap"],sortByDefault:"rank",sortDirectionDefault:"asc",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["1h","24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:100},{type:"perps",sortBy:["volume","price-change","open-interest"],sortByDefault:"volume",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"trending-perps",sortBy:["trending"],sortByDefault:"trending",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"token-categories"},{type:"suggested-users-to-follow-by-pnl",limit:3,timeFrame:["7d","30d"],timeFrameDefault:"7d"},{type:"sites",sortBy:["rank","top"],sortByDefault:"rank",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:50},{type:"learn",limit:3}]}),LN=a(t=>{try{let e=JSON.parse(t??"");return e?.sections?{sections:e.sections.filter(n=>wm.safeParse(n).success)}:LE}catch{return LE}},"parseFeatureFlagConfig"),Sm=a(()=>{let t=er.getMultivariateAssignment("explore-config"),{data:[e]}=xt(["enable-fungible-categories"]),r=Zn(),n=hm();return(0,Bl.useMemo)(()=>{let s=LN(t);return pt||(s={...s,sections:s.sections.filter(o=>o.type!=="suggested-users-to-follow")}),e||(s={...s,sections:s.sections.filter(o=>o.type!=="token-categories")}),!r&&!n&&(s={...s,sections:s.sections.filter(o=>o.type!=="perps"&&o.type!=="trending-perps")}),s},[t,e,r,n])},"useExploreConfig"),bm=a(()=>{let t=Sm();return(0,Bl.useMemo)(()=>{let e=[];for(let r of t.sections)(r.type==="collections"||r.type==="tokens"||r.type==="perps"||r.type==="sites"||r.type==="learn"||r.type==="suggested-users-to-follow"||r.type==="suggested-users-to-follow-by-pnl"||r.type==="token-categories")&&e.push(r);return e},[t.sections])},"useExploreConfigNavigatableSections"),Tm=a(t=>{let e=Sm();return(0,Bl.useMemo)(()=>e.sections.find(n=>n.type===t)??null,[e.sections,t])},"useExploreConfigSection");u();l();u();l();u();l();u();l();var OE="@phantom/fungible-categories",Ll={fungibleCategories:a(t=>[OE,"fungible-categories",t],"fungibleCategories"),fungibleCategoryById:a(t=>[OE,"fungible-category",t],"fungibleCategoryById")};u();l();var UE=i.object({items:i.array(yh)}),ME=i.object({id:i.string(),name:i.string(),imageUri:i.string().nullish().transform(t=>t??""),items:wh.array()});var Em=a(({limit:t,searchQuery:e}={})=>{let{data:[r]}=xt(["enable-fungible-categories"]);return ne({enabled:r,queryKey:Ll.fungibleCategories({enabled:r,searchQuery:e}),queryFn:a(async()=>{let n=await H.api().get("/fungibles/v1/categories",{params:{limit:"100",...e?{query:e}:{}}});return UE.parse(n.data)},"queryFn"),select:a(n=>t?n.items.slice(0,t):n.items,"select")})},"useFungibleCategories");u();l();var ON=a(({id:t})=>{let{data:[e]}=xt(["enable-fungible-categories"]);return ne({enabled:e,queryKey:Ll.fungibleCategoryById({id:t,enabled:e}),queryFn:a(async()=>{let r=await H.api().get(`/fungibles/v1/categories/${t}`,{params:{includePrices:"true"}});return ME.parse(r.data)},"queryFn")})},"useFungibleCategoryById");u();l();var xr=U($());var UN=2,MN=10,qN=300;function qE(t,e={}){let{debounceMs:r=qN,onSearchExecuted:n}=e,[s,o]=(0,xr.useState)([]),[c,d]=(0,xr.useState)(!1),m=(0,xr.useRef)(null),p=(0,xr.useMemo)(()=>new Cu,[]),f=(0,xr.useRef)(n);return f.current=n,(0,xr.useEffect)(()=>{if(m.current&&clearTimeout(m.current),t.length<UN){o([]),d(!1);return}return d(!0),m.current=setTimeout(async()=>{try{f.current?.(t);let g=await p.searchEvents({query:t,limit:MN});o(g.events||[])}catch(g){console.error("[usePredictionSearch] Search failed:",g),o([])}finally{d(!1)}},r),()=>{m.current&&clearTimeout(m.current)}},[t,p,r]),{results:s,isSearching:c}}a(qE,"usePredictionSearch");var Oe=U($());u();l();u();l();u();l();var zE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!1,"trendingTokensEnabled")};u();l();var QE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!0,"trendingTokensEnabled")};u();l();var HE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!1,"trendingTokensEnabled")};u();l();var GE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!0,"trendingTokensEnabled")};u();l();var VE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!1,"trendingTokensEnabled")};u();l();var $E={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!1,"trendingTokensEnabled")};u();l();var jE={tokenSearchEnabled:a(()=>!1,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!1,"trendingTokensEnabled")};u();l();var KE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!0,"trendingTokensEnabled")};u();l();var WE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!0,"trendingTokensEnabled")};u();l();var ZE={tokenSearchEnabled:a(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:a(()=>!1,"trendingTokensEnabled")};var zN=new qi({[we.Solana]:WE,[we.Ethereum]:GE,[we.Polygon]:KE,[we.Base]:QE,[we.Arbitrum]:zE,[we.Bitcoin]:HE,[we.Monad]:jE,[we.Sui]:ZE,[we.Hypercore]:VE,[we.Hyperevm]:$E}),Am=Mi(zN);u();l();u();l();var VNe=a(t=>t.address==="native"?D({chainId:t.chainId,resourceType:W.nativeToken,slip44:A.getSlip44(t.chainId)}):D({chainId:t.chainId,address:t.address,resourceType:W.address}),"exploreTokenToCaip19");var XE=a(t=>["explore-dapp",t],"createExploreDappQueryKey");var JE=a(t=>t.addresses.map(e=>A.getMainnetNetworkID(e.networkID))??[],"getAccountMainnetNetworkIds");function YE(t){try{return To.get(t).nonNativeFungibleTokenType}catch{return ae.SolanaNative}}a(YE,"getExploreTokenTypeFromChain");u();l();u();l();var Yt="@phantom/explore",rt={RecentlyViewedSearchItems:[Yt,"RecentlyViewedSearchItems"],sitesV2({sortBy:t,timeFrame:e,networkIDs:r,limit:n,locale:s,rankAlgo:o}){return[Yt,"sitesV2",nt,s,{sortBy:t,timeFrame:e,networkIDs:r,rankAlgo:o,limit:n}]},recommendedSites(t,e){return[Yt,"sites","recommended",nt,e,t]},featuredItems(t,e){return[Yt,"items","featured",nt,e,t]},tokensV2({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:n,limit:s,rankAlgo:o}){return[Yt,"tokensV2",{sortBy:t,sortDirection:e,timeFrame:r,networkIDs:n,rankAlgo:o,limit:s}]},curated({networkIDs:t,limit:e}){return[Yt,"curated",{networkIDs:t,limit:e}]},collectionsV2({sortBy:t,timeFrame:e,networkIDs:r,limit:n,locale:s,rankAlgo:o}){return[Yt,"collectionsV2",nt,s,{sortBy:t,timeFrame:e,networkIDs:r,rankAlgo:o,limit:n}]},featuredTransactions(t,e){return[Yt,"transactions","featured",nt,e,t]},learn(t,e){return[Yt,"learn",nt,e,t]},perpMarkets(t,e,r,n,s,o){return[Yt,"perp-markets",{chainId:t,sortBy:e,sortDirection:r,timeFrame:n,limit:s,search:o}]},perpMarketLists(t){return[Yt,"perp-market-lists",{enableMultiCollateralMarkets:t}]}};var QN=10,tA=et.RecentlyViewedSearchItems;async function HN(t){return await t.get(tA)??[]}a(HN,"getRecentlyViewedSearchItem");async function rA(t,e){await t.set(tA,e)}a(rA,"setRecentlyViewedSearchItem");function xm(t){return ne({queryKey:rt.RecentlyViewedSearchItems,queryFn:a(async()=>HN(t),"queryFn"),staleTime:0,enabled:!0})}a(xm,"useGetRecentlyViewedSearchItems");function GN(t){let e=Pe();return Vr({mutationFn:a(async n=>{let s=eA(n),c=(e.getQueryData(rt.RecentlyViewedSearchItems)??[]).filter(d=>eA(d)!==s);c.unshift(n),c=c.slice(0,QN),await rA(t,c),e.setQueryData(rt.RecentlyViewedSearchItems,c),await e.refetchQueries({queryKey:rt.RecentlyViewedSearchItems})},"mutationFn")})}a(GN,"useAddRecentlyViewedSearchItem");function VN(t){let e=Pe();return Vr({mutationFn:a(async()=>{await rA(t,[]),e.setQueryData(rt.RecentlyViewedSearchItems,[]),await e.refetchQueries({queryKey:rt.RecentlyViewedSearchItems})},"mutationFn")})}a(VN,"useClearRecentlyViewedSearchItem");function eA(t){return t.type==="token"||t.type==="perp"?D(Y(t.data)):t.data.id}a(eA,"keyFromSearchItem");u();l();var Im=U(lA()),Ol=U($());u();l();var dA={fields:["domain","name","category","tags"],storeFields:["domain","name","category","tags","imageUrl"],searchOptions:{boost:{name:2},prefix:!0,fuzzy:a(t=>t.length>3?.2:!1,"fuzzy")}};var pA=a(t=>{try{let{hostname:e,pathname:r}=new URL(t);return e+r}catch{return t}},"getHostnameAndPath"),nB=a((t=[],e=[])=>{let r=[...t,...e],n=(0,Im.default)(e,o=>pA(o.domain)),s=new Map;return r.forEach(o=>{let c=pA(o.domain);if(!s.has(c)){let d=n[c]||o;s.set(c,d)}}),Array.from(s.values())},"combineAndDeduplicateDapps"),sB=a(t=>{let e={isRecommended:"true"};return t.networkIds&&(e.chainIds=t.networkIds.join(",")),`/dapps/v1?${new URLSearchParams(e).toString()}`},"getRecommendedDappsEndpoint"),oB=a(async t=>{let e=await H.api().get(sB(t));if(!ee(e))throw new Error("Error fetching recommended dapps from registry");if(!e?.data?.data)throw new Error("No data returned from registry");let r=e.data,n=(0,Im.default)(r.data??[],o=>o.id);return Object.values(n)},"fetchRecommendedDapps"),iB=a(t=>{let e=Pe();return ne({queryKey:["dapps","recommended",t],queryFn:a(async()=>{try{let r=await oB(t);return nf.batch(()=>{for(let n of r){let s=XE(n.domain),o=e.getQueryState(s);e.setQueryData(s,()=>n??o?.data??null)}}),r}catch(r){throw E.captureError(r,I.DappRegistry),r}},"queryFn"),gcTime:K({days:1}),staleTime:K({days:1})})},"useRecommendedSearchDapps"),mA=a((t,e)=>{let{searchQuery:r,networkIds:n}=t,{data:s=[],...o}=iB({networkIds:n}),c=(0,Ol.useMemo)(()=>s.sort((g,w)=>w.recommendationScore-g.recommendationScore),[s]),d=(0,Ol.useMemo)(()=>nB(e,c),[e,c]),m=hf(r),p=lf(d,m,dA);return{data:(0,Ol.useMemo)(()=>{let g=new Map(d.map(w=>[w.id,w]));return p.map(w=>g.get(w.id)).filter(w=>w!==void 0)},[p,d]),...o}},"useRecommendedSearchDappsWithQuery");u();l();u();l();var fA=a(async({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:n,limit:s,rankAlgo:o,anonymousId:c})=>{let d=new URLSearchParams({timeFrame:r,sortBy:t,sortDirection:e,limit:s.toString(),rankAlgo:o,...c?{anonymousId:c}:{}});n.forEach(f=>{d.append("chainIds[]",f)});let m=await H.api().noBearer().get("/explore/v2/trending-tokens",{params:d});if(!ee(m))throw new Error("Failed to fetch tokens");let p=DE.safeParse(m.data);if(!p.success)throw new Error("Failed to parse tokens");return p.data},"getTokensV2");u();l();var mo=a((t,e)=>{let r=ji(),s=bm().find(c=>c.type===e),o=[];return s&&"network"in s?s.network.forEach(c=>{c!==Di&&r.includes(c)&&o.push(c)}):o=r,t!==Di&&!o.includes(t)?[]:t===Di?o:[t]},"useExploreNetwork");var aB=K({minutes:1}),cB=K({minutes:1}),uB=100,km=a(({sortBy:t,sortDirection:e,timeFrame:r,network:n,limit:s,rankAlgo:o,enableQuery:c=!0})=>{let d=Se(),m=mo(n,"tokens"),p=uB;return ne({queryKey:rt.tokensV2({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:m,limit:p,rankAlgo:o}),enabled:c,async queryFn(){let f=await d.getDeviceId();return fA({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:m,limit:p,rankAlgo:o,anonymousId:f})},gcTime:cB,staleTime:aB,retry:3,select:a(f=>s>=p?f:{...f,items:f.items.slice(0,s)},"select")})},"useTokensV2");var Sn=3,lB=15,Ni=50,hA={[ce.Trusted]:1,[ce.Verified]:2,[ce.NotVerified]:3,[ce.PossibleSpam]:4,[ce.Spam]:5},dB=a((t,e=100)=>{let[r,n]=(0,Oe.useState)(!1);return(0,Oe.useEffect)(()=>{let s;return t?s=setTimeout(()=>{n(!0)},e):n(!1),()=>{clearTimeout(s)}},[t,e]),r},"useDelayedLoading"),pB=a(t=>{let e=YE(t.chainId),r=A.getChainDefinition(t.chainId),n={name:t.name,symbol:t.symbol,logoUri:t.logoUrl,spamStatus:t.spamStatus,chain:{id:t.chainId,symbol:r.tokenSymbol,name:r.name,imageUrl:r.iconUrl}};switch(e){case ae.SPL:return{type:e,data:{...n,mintAddress:t.address}};case ae.ERC20:return{type:e,data:{...n,contractAddress:t.address}};case ae.BRC20:return{type:e,data:{...n,firstCreatedInscriptionId:t.address}};default:return null}},"mapExploreTokenToTokenMetadata"),mB=a(t=>t.reduce((e,r)=>{let n=pB(r);return n&&e.push(n),e},[]),"reduceExploreTokensToTokenMetadata"),fB=a(({searchQuery:t,networkIds:e,excludePlaceholderTokens:r=!1,extraDapps:n=[],actorSearchHook:s,enablePredictions:o=!1})=>{let[c,d]=(0,Oe.useState)(!1),[m,p]=(0,Oe.useState)(!1),[f,g]=(0,Oe.useState)(!1),[w,y]=(0,Oe.useState)(!1),[S,x]=(0,Oe.useState)(!1),[T,_]=(0,Oe.useState)(!1),k=At("enable-monad-mainnet"),P=At("enable-prediction-markets"),v=(0,Oe.useMemo)(()=>e.filter(lt=>A.isMonadNetworkID(lt)&&A.isMainnetNetworkID(lt)?k:Am.get(lt).tokenSearchEnabled()),[e,k]);(0,Oe.useEffect)(()=>{d(!1),p(!1),g(!1),y(!1),x(!1),_(!1)},[t]);let{data:z=[],isLoading:Q}=Si({query:t,networkIds:v,searchContext:"explore",enableQuery:!!t}),{data:R,isLoading:G}=Em({limit:t?void 0:10,searchQuery:t}),M=Tm("tokens"),{data:C}=km({sortBy:M?.sortByDefault??"rank",sortDirection:M?.sortDirectionDefault??"asc",timeFrame:M?.timeFrameDefault??"24h",network:M?.networkDefault??_t.Mainnet,limit:10,rankAlgo:M?.rankAlgo??"default",enableQuery:!t&&!r}),{tokens:N,perps:Z}=(0,Oe.useMemo)(()=>z.sort((ar,ho)=>hA[ar.data.spamStatus??ce.NotVerified]-hA[ho.data.spamStatus??ce.NotVerified]).reduce((ar,ho)=>(ho.type===ae.HypercoreAsset?ar.perps.push(ho):ar.tokens.push(ho),ar),{tokens:[],perps:[]}),[z]),oe=(0,Oe.useMemo)(()=>C?.items?mB(C.items):[],[C?.items]),re=t.length===0?lB:Sn,J=(0,Oe.useMemo)(()=>N.slice(0,m?Ni:re),[m,N,re]),Ge=(0,Oe.useMemo)(()=>Z.slice(0,f?Ni:re),[f,Z,re]),xe=(0,Oe.useMemo)(()=>[...J.map(lt=>D(Y(lt))),...oe.map(lt=>D(Y(lt)))],[J,oe]),{data:St={},isLoading:Cm}=en({query:{data:xe},enabled:xe.length>0}),EA=(0,Oe.useMemo)(()=>Ge.map(lt=>D(Y(lt))),[Ge]),{data:_m,isPending:Fm}=Hp(EA,!0),{data:Bi=[],isLoading:AA}=mA({networkIds:v,searchQuery:t},n),Pm=Bi.slice(0,c?Ni:Sn),xA=s??(()=>({data:void 0,isLoading:!1})),{data:vm,isLoading:IA}=xA({query:t}),{results:Rm=[],isSearching:kA}=qE(o&&P?t:"",{debounceMs:0}),Ir=!!t,Li=AA||Q||G||IA||kA,Dm=Ir&&!Li,CA=Ke(),{data:Nm}=xm(CA),{actorsAll:Bm,actors:Lm}=(0,Oe.useMemo)(()=>{let lt=vm?.actors??[],ar=lt.slice(0,w?Ni:Sn);return{actorsAll:lt,actors:ar}},[w,vm?.actors]),Om=(0,Oe.useMemo)(()=>{if(R)return S?R:R.slice(0,re)},[R,S,re]),{predictionsAll:Um,predictions:Mm}=(0,Oe.useMemo)(()=>{let lt=P?Rm:[],ar=lt.slice(0,T?Ni:Sn);return{predictionsAll:lt,predictions:ar}},[Rm,T,P]),fo=(0,Oe.useMemo)(()=>({actors:Lm,dapps:Bi,searchedDapps:Pm,renderShowMoreDappsButton:Ir&&Bi.length>Sn,isLoading:Li,tokens:J,perps:Ge,trendingTokens:oe,renderShowMoreTokensButton:Ir&&N.length>re,renderShowMorePerpsButton:Ir&&Z.length>re,renderShowMoreUsersButton:Ir&&Bm.length>Sn,priceMap:St,isPriceMapLoading:Cm,showSearchResults:Dm,showMoreTokens:m,setShowMoreTokens:p,showMorePerps:f,setShowMorePerps:g,showMoreDapps:c,setShowMoreDapps:d,showMoreUsers:w,setShowMoreUsers:y,recentlyViewedSearchItems:Nm,categories:Om,showMoreCategories:S,setShowMoreCategories:x,renderShowMoreCategoriesButton:Ir&&R&&R?.length>Sn,perpMarketMap:_m,isPerpMarketMapLoading:Fm,predictions:Mm,showMorePredictions:T,setShowMorePredictions:_,renderShowMorePredictionsButton:Ir&&Um.length>Sn}),[Lm,Bi,Pm,Ir,Li,J,Ge,oe,N.length,Z.length,re,Bm.length,St,Cm,Dm,m,f,c,w,Nm,Om,S,R,_m,Fm,Mm,Um.length,T]),[qm,_A]=(0,Oe.useState)(null),FA=dB(Li);return(0,Oe.useEffect)(()=>{fo.isLoading||_A(t?fo:null)},[fo.isLoading,t]),{...fo.isLoading&&qm?qm:fo,showSpinner:FA&&Ir}},"useExploreSearchList");u();l();u();l();u();l();var hB=i.object({trendingMarkets:i.array(Ai)}),gA=a(async({chainId:t,sortBy:e,sortDirection:r,timeFrame:n,limit:s,search:o})=>{let c=new URLSearchParams({chainId:t,sortBy:e,sortDirection:r,timeFrame:n,...s?{limit:s.toString()}:{},...o?{search:o}:{}}),d=await H.api().noBearer().get("/swap/v2/perp/trending-markets",{params:c});if(!ee(d))throw new Error("Failed to fetch perp markets");let m=hB.safeParse(d.data);if(!m.success){let p=new Error(`Failed to parse perp markets: ${JSON.stringify(m.error.flatten())}`);throw E.captureError(p,I.Perps),p}return m.data},"getPerpMarkets");var gB=K({minutes:1}),yB=K({minutes:1}),wB=a(({sortBy:t,sortDirection:e,timeFrame:r,limit:n,search:s})=>{let o=Wi(),c=o?Tn.Testnet:A.hypercore.mainnetID,d=At("enable-hip3-testnet-dogfood-filter"),m=At("enable-multi-collateral-markets");return ne({queryKey:rt.perpMarkets(c,t,e,r,void 0,s),queryFn:a(async()=>gA({chainId:c,sortBy:t,sortDirection:e,timeFrame:r,search:s}),"queryFn"),gcTime:yB,staleTime:gB,retry:3,select:a(p=>{let f=p.trendingMarkets;return m||(f=f.filter(g=>!g.collateralToken)),d&&o&&(f=f.filter(g=>g.name.includes(":"))),n?{...p,trendingMarkets:f.slice(0,n)}:{...p,trendingMarkets:f}},"select")})},"usePerpMarkets");u();l();u();l();var wA=U($());u();l();var yA=a(async(t,e)=>{let r=new URLSearchParams({appVersion:nt,limit:"6",locale:e,platform:bt});t.forEach(c=>{r.append("chainIds[]",c)});let n=await H.api().noBearer().get("/explore/v1/featured-items",{params:r});if(!ee(n))throw new Error("Failed to fetch featured items");let s=await n.data;if(!s.data||!Array.isArray(s.data))return[];let o=[];for(let c of s.data)try{let d=RE.parse(c);o.push(d)}catch{}return o},"getFeaturedItems");var SB=K({minutes:10}),bB=K({minutes:10}),TB=a(()=>{let{data:t}=Fe(),e=(0,wA.useMemo)(()=>t?JE(t):[],[t]),r=Ft(L.language)??"en",n=a(async()=>{if(!t)throw new Error("No account found");return yA(e,r)},"queryFn");return ne({queryKey:rt.featuredItems(e,r),enabled:!!t,queryFn:n,gcTime:SB,staleTime:bB})},"useExploreFeaturedItems");u();l();u();l();var EB={rank:"trending",top:"top"},SA=a(async({sortBy:t,timeFrame:e,networkIDs:r,limit:n,locale:s,rankAlgo:o})=>{let c=new URLSearchParams({appVersion:nt,limit:n.toString(),locale:s,platform:bt,rankAlgo:o,rankBy:EB[t],timeframe:e});r.forEach(p=>{c.append("chainIds[]",p)});let d=await H.api().noBearer().get("/explore/v1/trending-dapps",{params:c});if(!ee(d))throw new Error("Failed to fetch sites");let m=vE.safeParse(d.data);if(!m.success)throw new Error("Failed to parse sites");return m.data},"getSitesV2");var AB=K({minutes:10}),xB=K({minutes:10}),IB=a(({sortBy:t,timeFrame:e,network:r,limit:n,rankAlgo:s})=>{let{data:o}=Fe(),c=mo(r,"sites"),d=Ft(L.language)??"en";return ne({queryKey:rt.sitesV2({sortBy:t,timeFrame:e,networkIDs:c,locale:d,limit:n,rankAlgo:s}),enabled:!!o,async queryFn(){if(!o)throw new Error("No account found");return SA({sortBy:t,timeFrame:e,networkIDs:c,locale:d,limit:n,rankAlgo:s})},gcTime:xB,staleTime:AB,retry:3})},"useSitesV2");u();l();u();l();var kB={rank:"trending",top:"volume"},CB=a(t=>t.floorPrices.length>0&&t.marketplacePages.length>0,"collectionWithValueAndMarketPlace"),bA=a(async({sortBy:t,timeFrame:e,networkIDs:r,limit:n,locale:s,rankAlgo:o})=>{let c=new URLSearchParams({appVersion:nt,limit:n.toString(),locale:s,platform:bt,rankAlgo:o,rankBy:kB[t],timeframe:e});r.forEach(p=>{c.append("chainIds[]",p.toString())});let d=await H.api().noBearer().get("/explore/v1/trending-collections",{params:c});if(!ee(d))throw new Error("Failed to fetch collections");let m=NE.safeParse(d.data);if(!m.success)throw new Error("Failed to parse collections");return{...m.data,data:m.data.data.filter(CB)}},"getCollectionsV2");var _B=K({minutes:10}),FB=K({minutes:10}),PB=a(({sortBy:t,timeFrame:e,network:r,limit:n,rankAlgo:s})=>{let{data:o}=Fe(),c=mo(r,"collections"),d=Ft(L.language)??"en";return ne({queryKey:rt.collectionsV2({sortBy:t,timeFrame:e,networkIDs:c,locale:d,limit:n,rankAlgo:s}),enabled:!!o,async queryFn(){if(!o)throw new Error("No account found");return bA({sortBy:t,timeFrame:e,networkIDs:c,locale:d,limit:n,rankAlgo:s})},gcTime:FB,staleTime:_B,retry:3})},"useCollectionsV2");u();l();u();l();var TA=a(async(t,e)=>{let r=new URLSearchParams({appVersion:nt,locale:e,platform:bt});t.forEach(s=>{r.append("chainIds[]",s)});let n=await H.api().noBearer().get("/explore/v1/learn-grid",{params:r});if(!ee(n))throw new Error("Failed to fetch learn grid");return n.data},"getLearnItems");var vB=K({minutes:10}),RB=K({minutes:10}),DB=a(()=>{let t=ji(),e=Ft(L.language)??"en";return ne({queryKey:rt.learn(t,e),enabled:t.length>0,async queryFn(){return TA(t,e)},gcTime:RB,staleTime:vB})},"useLearnV2");export{WA as a,zA as b,ur as c,rn as d,QA as e,jA as f,jl as g,An as h,Wl as i,ZA as j,XA as k,Zl as l,xn as m,VNe as n,Yt as o,q1e as p,Di as q,TB as r,Em as s,ON as t,Zn as u,fT as v,Mu as w,wT as x,gn as y,Ze as z,ld as A,xo as B,j as C,Rs as D,Jl as E,Yl as F,wx as G,Ed as H,de as I,Qt as J,fe as K,Gt as L,Bs as M,eS as N,Te as O,Ie as P,On as Q,X as R,Le as S,Ls as T,rS as U,lw as V,Bc as W,Tt as X,ag as Y,yg as Z,HF as _,Nt as $,ZF as aa,JF as ba,GF as ca,Ds as da,Xw as ea,F7 as fa,$c as ga,L7 as ha,Jw as ia,H7 as ja,Gw as ka,Vc as la,VF as ma,oS as na,cP as oa,uP as pa,lp as qa,Tp as ra,WP as sa,ZP as ta,Zt as ua,nv as va,sv as wa,av as xa,jv as ya,gi as za,kp as Aa,Iv as Ba,_ae as Ca,Fv as Da,Nae as Ea,Bae as Fa,Lae as Ga,Rv as Ha,Hae as Ia,Gae as Ja,Dv as Ka,Xae as La,Jae as Ma,hv as Na,Nv as Oa,Lv as Pa,Ice as Qa,Cp as Ra,$v as Sa,gv as Ta,yv as Ua,Kv as Va,bv as Wa,vde as Xa,Eu as Ya,dR as Za,pR as _a,qp as $a,jb as ab,fR as bb,Gp as cb,HR as db,GR as eb,KR as fb,E1 as gb,S0e as hb,uT as ib,C1 as jb,x1 as kb,_1 as lb,jD as mb,vl as nb,YD as ob,nN as pb,hm as qb,m1e as rb,sN as sb,XD as tb,JD as ub,Sm as vb,bm as wb,Tm as xb,GN as yb,VN as zb,km as Ab,fB as Bb,IB as Cb,PB as Db,DB as Eb,wB as Fb};
/*! Bundled license information:

use-sync-external-store/cjs/use-sync-external-store-shim.production.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim.development.js:
  (**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.development.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=chunk-PQUTVVRL.js.map
