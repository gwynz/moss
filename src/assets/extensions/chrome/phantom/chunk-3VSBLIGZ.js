import{V as ye,W as me,jb as ge,o as Q}from"./chunk-F236ETGH.js";import{A as h,Eb as b,Fd as J,Gc as w,Gd as pe,Hc as S,Kb as E,Kc as T,U as M,V as R,Xa as N,_c as ie,bd as ue,df as le,ef as fe,ff as he,ob as se,p as m,qb as ae,xd as de,z as _}from"./chunk-LPV5DSV2.js";import{A as re,L as Y,Y as W}from"./chunk-JYKVQ4NC.js";import{a as p,g as G,i as P,m as Buffer,n as I}from"./chunk-TSHWMJEM.js";P();I();P();I();var v=G(Y());P();I();var Z=p(e=>e.reduce((t,o)=>{let n=t;for(let c of o.accounts){let r=c.chain.name.toLowerCase();if(t[r]?.balance&&t[r]?.history)continue;let a="amount"in c?parseFloat(c.amount)>0:!1,u=c.hasAccountActivity;if(!t[r]){n={...n,[r]:{balance:a,history:u}};continue}n={...n,[r]:{...n[r],balance:a||n[r]?.balance,history:u||n[r]?.history}}}return n},{}),"generateImportedAccountChainAnalytics");P();I();P();I();var Fe="/discover/v1",Ke={Accept:"application/json"},_e=p(e=>{if(!e||!Array.isArray(e.accounts))return!1;for(let t of e.accounts)if(!(typeof t.address=="string"&&typeof t.amount=="string"&&(!t.lastActivityTimestamp||typeof t.lastActivityTimestamp=="number")&&t.chain&&typeof t.chain.id=="string"&&new Set(E.getAllNetworkIDs()).has(t.chain.id)&&typeof t.chain.name=="string"&&typeof t.chain.symbol=="string"&&typeof t.chain.imageUrl=="string"))return!1;return!0},"isDiscoveryAccountResponse"),Ne=p(e=>!!e&&typeof e.message=="string","isErrorResponse"),k=p(async e=>{if(!e.accounts.length)throw new Error("Must send at least 1 account for discovery");let t=await ie.api().noBearer().headers(Ke).post(Fe,e),o=t.data;if(!ue(t))throw Ne(o)?new Error(o.message):new Error(`Unable to discover accounts with args: ${JSON.stringify(e)}`);if(_e(o))return o;throw new Error(`Invalid discover accounts response: ${JSON.stringify(o)}`)},"fetchDiscoverAccounts");P();I();async function X(e){return ye(e,new Uint8Array,me,J,(t,o,n,c)=>pe(J,t,o,{c:n,dkLen:c}))}p(X,"deriveLegacySha256Seed");async function z(e,t,o,n=0){let c=null,r=null;try{c=await X(e),r=new _(c);let a=[],u=new Map;if(t.includes(h.Solana)){let s=[m.Bip44ChangeSolana,m.Bip44Solana,m.DeprecatedSolana];for(let l of s)try{let d=r.derivePathType(l,n),y;switch(l){case m.Bip44ChangeSolana:case m.Bip44Solana:y=d.publicKey;break;case m.DeprecatedSolana:y=N(d.secretKey).publicKey;break;default:y=d.publicKey}let A=b({publicKey:y,addressType:h.Solana});if(!A||A.length===0)continue;a.push({chainId:M.Solana.Mainnet,address:A}),u.set(`${M.Solana.Mainnet}-${A}`,{chainType:h.Solana,pathType:l})}catch(d){T.captureMessage(`IDPLAT-295: Failed to derive Solana address for pathType ${l}: ${d instanceof Error?d.message:String(d)}`,S.Account,w.Info)}}if(t.includes(h.EVM)){let s=[m.Bip44Ethereum,m.Bip44EthereumSecondary,m.Bip44EthereumTertiary],l=o.filter(d=>E.isEVMNetworkID(E[d].mainnetID));for(let d of s)try{let{publicKey:y}=r.derivePathType(d,n),A=b({publicKey:y,addressType:h.EVM});if(!A||A.length===0)continue;for(let L of l){let O=E[L].mainnetID;a.push({chainId:O,address:A}),u.set(`${O}-${A}`,{chainType:h.EVM,pathType:d})}}catch(y){T.captureMessage(`IDPLAT-295: Failed to derive EVM address for pathType ${d}: ${y instanceof Error?y.message:String(y)}`,S.Account,w.Info)}}let i=[{type:h.BitcoinTaproot,pathType:m.BitcoinTaproot},{type:h.BitcoinNativeSegwit,pathType:m.BitcoinNativeSegwit}];for(let{type:s,pathType:l}of i)if(t.includes(s))try{let{publicKey:d}=r.derivePathType(l,n),y=b({publicKey:d,addressType:s});if(!y||y.length===0){T.captureMessage(`IDPLAT-295: Empty Bitcoin address derived for type ${s}`,S.Account,w.Info);continue}a.push({chainId:M.Bitcoin.Mainnet,address:`${y}`}),u.set(`${M.Bitcoin.Mainnet}-${y}`,{chainType:s,pathType:l})}catch(d){T.captureMessage(`IDPLAT-295: Failed to derive Bitcoin address for type ${s}: ${d instanceof Error?d.message:String(d)}`,S.Account,w.Info)}if(t.includes(h.Sui))try{let s=m.Bip44Sui,{publicKey:l}=r.derivePathType(s,n),d=b({publicKey:l,addressType:h.Sui});!d||d.length===0?T.captureMessage("IDPLAT-295: Empty Sui address derived",S.Account,w.Info):(a.push({chainId:M.Sui.Mainnet,address:`${d}`}),u.set(`${M.Sui.Mainnet}-${d}`,{chainType:h.Sui,pathType:s}))}catch(s){T.captureMessage(`IDPLAT-295: Failed to derive Sui address: ${s instanceof Error?s.message:String(s)}`,S.Account,w.Info)}if(a.length===0)return[];let f=await k({accounts:a}),g=[];for(let s of f.accounts){let l=`${s.chain.id}-${s.address}`,d=u.get(l);if(!d)continue;let y=s.amount!=="--"&&parseFloat(s.amount)>0,A=!!s.lastActivityTimestamp||y;A&&g.push({chainType:d.chainType,networkID:s.chain.id,address:s.address,amount:s.amount,hasActivity:A,derivationPathType:d.pathType,derivationIndex:n})}return g.length>0&&T.captureMessage(`IDPLAT-295: Legacy SHA256 accounts with funds discovered - count: ${g.length}`,S.Account,w.Info),g}finally{try{r&&r.cleanup()}catch(a){T.captureError(a,S.Account)}c&&c.fill(0)}}p(z,"discoverLegacyAccountsWithFunds");async function Ae(e,t,o,n){let c=null,r=null;try{c=await X(e),r=new _(c);let a=r.derivePathType(o,n);return o===m.DeprecatedSolana?N(a.secretKey).secretKey:new Uint8Array(a.secretKey)}finally{try{r&&r.cleanup()}catch(a){T.captureError(a,S.Account)}c&&c.fill(0)}}p(Ae,"deriveLegacyPrivateKey");async function ee(e,t,o,n="Legacy Recovery"){let c={imported:[],failed:[]},r=ke(t);for(let a of r){let u=null;try{u=await Ae(e,a.chainType,a.derivationPathType,a.derivationIndex);let i=He(a.chainType),f=`${n} - ${i}`,g=se.from(u),s=await o.addPrivateKeyAccount(a.chainType,g,f);c.imported.push({chainType:a.chainType,address:a.address,accountIdentifier:s.identifier}),T.captureMessage(`IDPLAT-295: Successfully imported legacy account as private key - chain: ${i}`,S.Account,w.Info)}catch(i){let f=i instanceof Error?i.message:String(i);c.failed.push({chainType:a.chainType,address:a.address,error:f}),T.captureMessage(`IDPLAT-295: Failed to import legacy account - chain: ${a.chainType}, error: ${f}`,S.Account,w.Error)}finally{u&&u.fill(0)}}return c}p(ee,"importLegacyAccountsAsPrivateKeys");function ke(e){let t=new Set,o=[];for(let n of e){let c=`${n.chainType}-${n.address}`;t.has(c)||(t.add(c),o.push(n))}return o}p(ke,"deduplicateLegacyAccounts");function He(e){switch(e){case h.Solana:return"Solana";case h.EVM:return"Ethereum";case h.BitcoinTaproot:return"Bitcoin (Taproot)";case h.BitcoinNativeSegwit:return"Bitcoin (SegWit)";case h.BitcoinNestedSegwit:return"Bitcoin (Nested SegWit)";case h.BitcoinLegacy:return"Bitcoin (Legacy)";case h.Sui:return"Sui";default:return"Unknown"}}p(He,"getChainDisplayName");P();I();var Re="fetch-multi-chain-accounts-by-seed",We=p(()=>[m.BitcoinTaproot,m.BitcoinNativeSegwit],"orderedBitcoinDerivationPathTypes"),Ue=p(()=>[m.Bip44ChangeSolana,m.Bip44Solana,m.DeprecatedSolana],"orderedSolanaDerivationPathTypes"),Ve=p(()=>[m.Bip44Ethereum,m.Bip44EthereumSecondary,m.Bip44EthereumTertiary],"orderedEVMDerivationPathTypes"),je=p(()=>[m.Bip44Sui],"orderedSuiDerivationPathTypes"),qe=p((e,t)=>We().map(o=>{let n={pathType:o,index:e},{publicKey:c}=t.derivePathType(o,e),r=R.getAddressType(o),a=b({publicKey:c,addressType:r});return{chainType:r,chainId:M.Bitcoin.Mainnet,address:a,publicKey:Buffer.from(c).toString("hex"),pathParams:n}}),"derivedBitcoinAccounts"),Ge=p((e,t)=>Ve().map(o=>{let n={pathType:o,index:e},{publicKey:c}=t.derivePathType(o,e),r=R.getAddressType(o),a=b({publicKey:c,addressType:h.EVM});return{chainType:r,pathType:o,address:a,publicKey:Buffer.from(c).toString("hex"),pathParams:n}}),"derivedEVMAccounts"),Ye=p((e,t)=>Ue().map(o=>{let n={pathType:o,index:e},c=t.derivePathType(o,e),r;switch(o){case m.Bip44RootSolana:case m.Bip44Solana:case m.Bip44ChangeSolana:r=c.publicKey;break;case m.DeprecatedSolana:r=N(c.secretKey).publicKey;break}let a=b({publicKey:r,addressType:h.Solana});return{chainType:h.Solana,chainId:M.Solana.Mainnet,address:a,publicKey:Buffer.from(r).toString("hex"),pathParams:n}}),"derivedSolanaAccounts"),Je=p((e,t)=>je().map(o=>{let n={pathType:o,index:e},{publicKey:c}=t.derivePathType(o,e),r=b({publicKey:c,addressType:h.Sui});return{chainType:h.Sui,chainId:M.Sui.Mainnet,address:r,publicKey:ae(c),pathParams:n}}),"derivedSuiAccounts"),Qe=1e4,ve=p(async(e,t=!0)=>{let o=Object.assign({},...e);try{let n=Object.values(o).map(({account:s})=>({address:s.address,chainId:s.chainId})),c;t?c=(await fe(async()=>he(k({accounts:n}),Qe),()=>!0,2)).accounts:c=(await k({accounts:n})).accounts;let r={};for(let s of c){let{account:l}=o[`${s.chain.id}-${s.address}`],d=l.publicKey,y=l.chainType,A=Q(l.pathParams),L={...s,publicKey:d,chainType:y,derivationPathType:l.pathParams.pathType,hasAccountActivity:!!s.lastActivityTimestamp||parseFloat(s.amount)>0};r[A]=[...r[A]||[],L]}Object.keys(r).forEach(s=>{r[s]=r[s].sort((l,d)=>E.compareNetworkID(l.chain.id,d.chain.id))});let a=Object.values(r),u=a.filter(s=>s.some(l=>l.hasAccountActivity)),i=!!u.length;return(i?u:a).map(s=>{let l=s[0];return{status:"discovered",seedIndex:o[`${l.chain.id}-${l.address}`].account.pathParams.index??-1,isSelectedByDefault:i,accounts:s}})}catch{let n=Object.values(o).map(({account:u})=>u),c={};for(let u of n){let{account:i}=o[`${u.chainId}-${u.address}`],f=Q(i.pathParams),g={...u,chain:{id:u.chainId,name:E.getNetworkName(u.chainId),symbol:E.getTokenSymbol(u.chainId)},chainType:R.getAddressType(i.pathParams.pathType),derivationPathType:i.pathParams.pathType,hasAccountActivity:!1};c[f]=[...c[f]||[],g]}return Object.keys(c).forEach(u=>{c[u]=c[u].sort((i,f)=>E.compareNetworkID(i.chain.id,f.chain.id))}),Object.values(c).map(u=>{let i=u[0];return{status:"undiscovered",seedIndex:o[`${i.chain.id}-${i.address}`].account.pathParams.index??-1,accounts:u,isSelectedByDefault:!1}})}},"discoverAccounts"),Ze=p(async({hdWallet:e,startIndex:t,endIndex:o,enabledAddressTypes:n,enabledChains:c})=>{let r=[];for(let a=t;a<=o;++a){let u={};if(n.includes(h.BitcoinNativeSegwit))for(let i of qe(a,e))u[`${M.Bitcoin.Mainnet}-${i.address}`]={account:i};if(n.includes(h.EVM)){let i=Ge(a,e),f=c.filter(g=>E.isEVMNetworkID(E[g].mainnetID));for(let g of f){let s=E[g];for(let{address:l,publicKey:d,chainType:y,pathParams:A}of i)u[`${s.mainnetID}-${l}`]={account:{chainType:y,chainId:s.mainnetID,address:l,publicKey:d,pathParams:A}}}}if(n.includes(h.Solana))for(let i of Ye(a,e))u[`${i.chainId}-${i.address}`]={account:i};if(n.includes(h.Sui))for(let i of Je(a,e))u[`${i.chainId}-${i.address}`]={account:i};r.push(u)}return ve(r)},"discoverAccountsBySeed");function te({batchSize:e,hdWallet:t,enabledAddressTypes:o,enabledChains:n}){let c=!!t&&o.length!=0;return de({enabled:c,queryKey:[Re,e],queryFn:p(async({pageParam:i=0})=>{try{if(e<1)throw new Error(`Need positive batchSize: ${e}`);if(!t)throw new Error("Missing HDWallet");let f=[],g=[],s=i===0,l=i,d=!0;for(;d;){let y=l,A=l+e-1,O=(await Ze({hdWallet:t,startIndex:y,endIndex:A,enabledAddressTypes:o,enabledChains:n})).flat(1);l+=e,d=!1;for(let x of O)f.push(x),(x.status==="undiscovered"||x.isSelectedByDefault)&&g.push(x),s&&x.status==="discovered"&&x.isSelectedByDefault&&(d=!0)}if(s&&g.length===0&&f.length>1){let y=f[0],A=y.accounts.map(O=>({...O,hasAccountActivity:!1})),L={status:"undiscovered",seedIndex:y.seedIndex,accounts:A,isSelectedByDefault:!1};g.push(L)}return g}catch(f){throw f instanceof Error&&T.captureError(f,S.Account),f}},"queryFn"),getNextPageParam:p((i,f)=>{let g=f.length,s=g?f[0]:[],l=s.length?Xe(s[s.length-1].seedIndex,e):0;return g===1?l:l+e*(g-1)},"getNextPageParam"),gcTime:0,staleTime:0,initialPageParam:0})}p(te,"useDiscoverMultiChainAccounts");var Xe=p((e,t)=>Math.ceil(e/t)*t+t,"roundUpByBatchSize");P();I();var U=G(Y());var Se=p(e=>{let t=ge(),o=(0,U.useCallback)(n=>t.includes(E.getChainID(n.chain.id)),[t]);return(0,U.useMemo)(()=>e?e.map(n=>n.status==="undiscovered"?{...n,accounts:n.accounts.filter(c=>o(c))}:{...n,accounts:n.accounts.filter(c=>o(c)&&c.hasAccountActivity)}):[],[o,e])},"useActiveAccounts");P();I();var V=G(Y());var Te=p(e=>{let[t,o]=(0,V.useState)(null);return(0,V.useEffect)(()=>{if(e.length){let n=new _(e);return o(n),()=>{o(null),n.cleanup()}}},[e]),t},"useCachedHDWallet");var ze=p(e=>(0,v.useMemo)(()=>e.reduce((t,o,n)=>(t[n]=n===0||o.isSelectedByDefault,t),{}),[e]),"useDefaultSelectedAccounts"),et=p((e,t)=>(0,v.useMemo)(()=>e?.reduce((o,n,c)=>t[c]?[...o,n]:o,[])??[],[e,t]),"useSelectedAccounts"),tt=p((e,t)=>{(0,v.useEffect)(()=>{t(o=>{let{length:n}=Object.keys(e),c={};for(let r=0;r<n;r++)c[r]=o[r]===void 0?e[r]:o[r];return c})},[e,t])},"useEffectUpdateSelectedAccounts"),nt=3e3,ct=p((e,t)=>{let{t:o}=W();return(0,v.useEffect)(()=>{let n;if(e){let{pages:c}=e,r=c.length>1,a=c[c.length-1].length===0;r&&a&&(t(o("onboardingSelectAccountsFindMoreNoneFound")),n=setTimeout(()=>{t(o("onboardingSelectAccountsFindMoreAccounts"))},nt))}return()=>{n&&clearTimeout(n)}},[e,t,o])},"useEffectFindMoreAccountsButtonText"),ot=p(({activeAccountsNumber:e,allAccountsNumber:t,hasDiscoveryFailed:o})=>{let{t:n}=W(),c=e>0&&!o;return(0,v.useMemo)(()=>t===0?n("onboardingImportImportingFindingAccounts"):e===0?n("onboardingImportAccountsEmptyResult"):t===1?c?n("onboardingImportAccountsFoundAccounts_one",{numberOfWallets:e}):n("onboardingImportAccountsFoundAccountsNoActivity_one",{numberOfWallets:t}):t>1?c?n("onboardingImportAccountsFoundAccounts_other",{numberOfWallets:e}):n("onboardingImportAccountsFoundAccountsNoActivity_other",{numberOfWallets:t}):"",[e,t,c,n])},"useSubtitle"),Pe={extension:7,ios:7,android:7,web:7},rt=p(({seed:e,navigationCallback:t,storageCallback:o,enabledAddressTypes:n,enabledChains:c,legacyRecovery:r})=>{let{t:a}=W(),u=a("onboardingSelectAccountsFindMoreAccounts"),[i,f]=(0,v.useState)({}),[g,s]=(0,v.useState)(!1),[l,d]=(0,v.useState)(!1),[y,A]=(0,v.useState)(u),[L,O]=(0,v.useState)([]),[x,Ie]=(0,v.useState)(!1),[De,ne]=(0,v.useState)(!1);(0,v.useEffect)(()=>{if(!r||x)return;let{entropy:D}=r;if(D.length===0)return;let B=!1;return p(async()=>{ne(!0);try{let $=await z(D,n,c,0);!B&&$.length>0&&(O($),T.captureMessage(`IDPLAT-295: Found ${$.length} legacy SHA256 accounts with funds during onboarding`,S.Account,w.Info),r.onLegacyAccountsDiscovered?.($))}catch($){T.captureMessage(`IDPLAT-295: Legacy account discovery failed: ${$ instanceof Error?$.message:String($)}`,S.Account,w.Error)}finally{B||ne(!1)}},"checkLegacyAccounts")(),()=>{B=!0}},[r,n,c,x]);let Ee=Te(e),{data:j,status:F,fetchNextPage:we,isFetchingNextPage:Be}=te({batchSize:Pe[re],hdWallet:Ee,enabledAddressTypes:n,enabledChains:c}),H=(0,v.useMemo)(()=>j?.pages.flat()??[],[j]),q=Se(H),Me=ze(q),K=et(H,i),Le=ot({activeAccountsNumber:q.length,allAccountsNumber:H.length,hasDiscoveryFailed:H[0]?.status==="undiscovered"});ct(j,A),tt(Me,f);let be=(0,v.useCallback)(()=>d(!0),[]),xe=(0,v.useCallback)(D=>{if(F!=="success")return;let B={...i};B[D]=!B[D],f(B)},[F,i,f]),$e=(0,v.useCallback)(()=>{F==="success"&&f(D=>{let B={...D},oe=Object.values(B).every(Boolean);return Object.keys(B).forEach(($,Ce)=>{B[Ce]=!oe}),B})},[F,f]),Oe=(0,v.useCallback)(async()=>{if(!g){if(s(!0),await le(0),L.length>0&&r?.vault)try{let D=await ee(r.entropy,L,r.vault,a("onboardingLegacyRecoveryAccountName",{defaultValue:"Legacy Recovery"}));D.imported.length>0&&T.captureMessage(`IDPLAT-295: Successfully imported ${D.imported.length} legacy accounts as private keys`,S.Account,w.Info),D.failed.length>0&&T.captureMessage(`IDPLAT-295: Failed to import ${D.failed.length} legacy accounts`,S.Account,w.Error)}catch(D){T.captureMessage(`IDPLAT-295: Legacy import failed: ${D instanceof Error?D.message:String(D)}`,S.Account,w.Error)}finally{Ie(!0)}await o(K,Z(K)),s(!1),t(Z(K))}},[g,K,t,o,L,r,a]),ce={expanded:l,findMoreAccountsButtonText:y,isFetchingMoreAccounts:Be,isImporting:g,renderedPages:q,selectedAccounts:i,subtitle:Le,findMoreAccounts:we,onExpand:be,onImport:Oe,onSelect:xe,onSelectAll:$e};return F!=="success"?{status:"loading",isImportButtonDisabled:!0,...ce}:{status:"success",isImportButtonDisabled:K.length===0||De,...ce}},"useSelectMultichainAccountsProps");export{ee as a,ve as b,Pe as c,rt as d};
//# sourceMappingURL=chunk-3VSBLIGZ.js.map
