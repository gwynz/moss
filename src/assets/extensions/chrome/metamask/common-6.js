LavaPack.loadBundle([[3375,{"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnNameLookupResponseStruct=n.DomainResolutionResponseStruct=n.AddressResolutionResponseStruct=n.DomainResolutionStruct=n.AddressResolutionStruct=void 0;const s=e("@metamask/superstruct");n.AddressResolutionStruct=(0,s.object)({protocol:(0,s.string)(),resolvedDomain:(0,s.string)()}),n.DomainResolutionStruct=(0,s.object)({protocol:(0,s.string)(),resolvedAddress:(0,s.string)(),domainName:(0,s.string)()}),n.AddressResolutionResponseStruct=(0,s.object)({resolvedDomains:(0,s.size)((0,s.array)(n.AddressResolutionStruct),1,Infinity)}),n.DomainResolutionResponseStruct=(0,s.object)({resolvedAddresses:(0,s.size)((0,s.array)(n.DomainResolutionStruct),1,Infinity)}),n.OnNameLookupResponseStruct=(0,s.nullable)((0,s.union)([n.AddressResolutionResponseStruct,n.DomainResolutionResponseStruct]))}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/handlers/name-lookup.cjs"}],[3376,{"./home-page.cjs":3373},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnSettingsPageResponseStruct=void 0;const s=e("./home-page.cjs");n.OnSettingsPageResponseStruct=s.OnHomePageResponseStruct}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/handlers/settings-page.cjs"}],[3377,{"./transaction.cjs":3378},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnSignatureResponseStruct=void 0;const s=e("./transaction.cjs");n.OnSignatureResponseStruct=s.OnTransactionResponseStruct}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/handlers/signature.cjs"}],[3378,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnTransactionResponseStruct=n.OnTransactionResponseWithContentStruct=n.OnTransactionResponseWithIdStruct=n.OnTransactionSeverityResponseStruct=void 0;const s=e("@metamask/snaps-sdk"),a=e("@metamask/superstruct");n.OnTransactionSeverityResponseStruct=(0,a.object)({severity:(0,a.optional)((0,a.literal)(s.SeverityLevel.Critical))}),n.OnTransactionResponseWithIdStruct=(0,a.assign)(n.OnTransactionSeverityResponseStruct,(0,a.object)({id:(0,a.string)()})),n.OnTransactionResponseWithContentStruct=(0,a.assign)(n.OnTransactionSeverityResponseStruct,(0,a.object)({content:s.ComponentOrElementStruct})),n.OnTransactionResponseStruct=(0,a.nullable)((0,a.union)([n.OnTransactionResponseWithContentStruct,n.OnTransactionResponseWithIdStruct]))}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/handlers/transaction.cjs"}],[3379,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.HandlerType=void 0,function(e){e.OnRpcRequest="onRpcRequest",e.OnSignature="onSignature",e.OnTransaction="onTransaction",e.OnCronjob="onCronjob",e.OnInstall="onInstall",e.OnUpdate="onUpdate",e.OnStart="onStart",e.OnActive="onActive",e.OnInactive="onInactive",e.OnNameLookup="onNameLookup",e.OnKeyringRequest="onKeyringRequest",e.OnHomePage="onHomePage",e.OnSettingsPage="onSettingsPage",e.OnUserInput="onUserInput",e.OnAssetsLookup="onAssetsLookup",e.OnAssetsConversion="onAssetsConversion",e.OnAssetHistoricalPrice="onAssetHistoricalPrice",e.OnAssetsMarketData="onAssetsMarketData",e.OnProtocolRequest="onProtocolRequest",e.OnClientRequest="onClientRequest",e.OnWebSocketEvent="onWebSocketEvent"}(s||(n.HandlerType=s={}))}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/handlers/types.cjs"}],[338,{"../../../shared/lib/manifestFlags":6280,"../../../shared/modules/object.utils":6329,"../constants/sentry-state":11,"../platforms/extension":608,"./stores/extension-store":354,"./stores/fixture-extension-store":355,"./stores/persistence-manager":357},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){e("../../../shared/lib/manifestFlags");var s=e("../../../shared/modules/object.utils"),a=c(e("../platforms/extension")),r=e("../constants/sentry-state"),i=(e("./stores/fixture-extension-store"),c(e("./stores/extension-store"))),o=e("./stores/persistence-manager");function c(e){return e&&e.__esModule?e:{default:e}}const u=new a.default,l=new o.PersistenceManager({localStore:new i.default});globalThis.stateHooks.getPersistedState=async function(){return await l.get({validateVault:!1})},globalThis.stateHooks.getBackupState=async function(){return await l.getBackup()};const d={data:r.SENTRY_BACKGROUND_STATE,meta:{storageKind:!0,version:!0}};globalThis.stateHooks.getSentryState=function(){const e={browser:window.navigator.userAgent,version:u.getVersion()};if(globalThis.stateHooks.getSentryAppState)return l.cleanUpMostRecentRetrievedState(),{...e,state:globalThis.stateHooks.getSentryAppState()};if(l.mostRecentRetrievedState||globalThis.stateHooks.getMostRecentPersistedState){const t=l.mostRecentRetrievedState||globalThis.stateHooks.getMostRecentPersistedState();if(t)return{...e,persistedState:(0,s.maskObject)(t,d)}}return e}}}},{package:"$root$",file:"app/scripts/lib/setup-initial-state-hooks.js"}],[3380,{"./svg.cjs":3394,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSvgDimensions=n.assertIsSnapIcon=n.SVG_MAX_BYTE_SIZE_TEXT=n.SVG_MAX_BYTE_SIZE=void 0;const s=e("@metamask/utils"),a=e("./svg.cjs");n.SVG_MAX_BYTE_SIZE=1e5,n.SVG_MAX_BYTE_SIZE_TEXT=`${Math.floor(n.SVG_MAX_BYTE_SIZE/1e3)}kb`,n.assertIsSnapIcon=function(e){(0,s.assert)(e.path.endsWith(".svg"),'Expected snap icon to end in ".svg".');const t="string"==typeof e.value?(0,s.stringToBytes)(e.value).byteLength:e.value.byteLength;(0,s.assert)(t<=n.SVG_MAX_BYTE_SIZE,`The specified SVG icon exceeds the maximum size of ${n.SVG_MAX_BYTE_SIZE_TEXT}.`),(0,s.assert)((0,a.isSvg)(e.toString()),"Snap icon must be a valid SVG.")},n.getSvgDimensions=function(e){try{const t=(0,a.parseSvg)(e),n=t["@_height"],r=t["@_width"];if(n&&r)return{height:n,width:r};const i=t["@_viewBox"];if(i){const[e,t,n,a]=i.split(" ");if(n&&a){const e=parseInt(n,10),t=parseInt(a,10);return(0,s.assert)(Number.isInteger(e)&&e>0),(0,s.assert)(Number.isInteger(t)&&t>0),{width:e,height:t}}}}catch{throw new Error("Snap icon must be a valid SVG.")}return null}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/icon.cjs"}],[3381,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createWindow=void 0,n.createWindow=async function({uri:e,id:t,sandbox:n=!0,testId:s="snaps-iframe"}){return await new Promise((a,r)=>{const i=document.createElement("iframe");i.setAttribute("id",t),i.setAttribute("data-testid",s),n&&i.setAttribute("sandbox","allow-scripts"),i.setAttribute("src",e),document.body.appendChild(i),i.addEventListener("load",()=>{i.contentWindow?a(i.contentWindow):r(new Error(`iframe.contentWindow not present on load for job "${t}".`))},{once:!0})})}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/iframe.cjs"}],[3382,{"./account.cjs":3354,"./array.cjs":3355,"./auxiliary-files.cjs":3356,"./base64.cjs":3357,"./bytes.cjs":3358,"./caveats.cjs":3359,"./checksum.cjs":3360,"./constants.cjs":3361,"./cronjob.cjs":3362,"./currency.cjs":3363,"./deep-clone.cjs":3364,"./default-endowments.cjs":3365,"./derivation-paths.cjs":3366,"./entropy.cjs":3367,"./errors.cjs":3368,"./handlers/index.cjs":3374,"./iframe.cjs":3381,"./json-rpc.cjs":3383,"./json.cjs":3384,"./localization.cjs":3385,"./logging.cjs":3386,"./manifest/index.cjs":3387,"./path.cjs":3389,"./platform-version.cjs":3390,"./snaps.cjs":3391,"./strings.cjs":3392,"./structs.cjs":3393,"./time.cjs":3395,"./types.cjs":3396,"./ui.cjs":3397,"./url.cjs":3398,"./validation.cjs":3399,"./versions.cjs":3400,"./virtual-file/index.cjs":3402},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./account.cjs"),n),a(e("./array.cjs"),n),a(e("./auxiliary-files.cjs"),n),a(e("./base64.cjs"),n),a(e("./bytes.cjs"),n),a(e("./caveats.cjs"),n),a(e("./checksum.cjs"),n),a(e("./constants.cjs"),n),a(e("./cronjob.cjs"),n),a(e("./currency.cjs"),n),a(e("./deep-clone.cjs"),n),a(e("./default-endowments.cjs"),n),a(e("./derivation-paths.cjs"),n),a(e("./entropy.cjs"),n),a(e("./errors.cjs"),n),a(e("./handlers/index.cjs"),n),a(e("./iframe.cjs"),n),a(e("./json.cjs"),n),a(e("./json-rpc.cjs"),n),a(e("./localization.cjs"),n),a(e("./logging.cjs"),n),a(e("./manifest/index.cjs"),n),a(e("./path.cjs"),n),a(e("./platform-version.cjs"),n),a(e("./snaps.cjs"),n),a(e("./strings.cjs"),n),a(e("./structs.cjs"),n),a(e("./time.cjs"),n),a(e("./types.cjs"),n),a(e("./ui.cjs"),n),a(e("./url.cjs"),n),a(e("./validation.cjs"),n),a(e("./versions.cjs"),n),a(e("./virtual-file/index.cjs"),n)}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/index.cjs"}],[3383,{"@metamask/permission-controller":2862,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.assertIsJsonRpcSuccess=n.isOriginAllowed=n.assertIsKeyringOrigins=n.KeyringOriginsStruct=n.assertIsRpcOrigins=n.RpcOriginsStruct=void 0;const s=e("@metamask/permission-controller"),a=e("@metamask/superstruct"),r=e("@metamask/utils"),i=(0,a.array)((0,a.refine)((0,a.string)(),"Allowed origin",e=>!(e.split("*").length-1>2)||'No more than two wildcards ("*") are allowed in an origin specifier.'));function o(e,t){if("*"===e||e===t)return!0;const n=function(e){const t=e.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*");return RegExp(`^${t}$`,"u")}(e);return n.test(t)}n.RpcOriginsStruct=(0,a.refine)((0,a.object)({dapps:(0,a.optional)((0,a.boolean)()),snaps:(0,a.optional)((0,a.boolean)()),allowedOrigins:(0,a.optional)(i)}),"RPC origins",e=>!!Boolean(!0===e.snaps||!0===e.dapps||e.allowedOrigins&&e.allowedOrigins.length>0)||"Must specify at least one JSON-RPC origin."),n.assertIsRpcOrigins=function(e,t){(0,r.assertStruct)(e,n.RpcOriginsStruct,"Invalid JSON-RPC origins",t)},n.KeyringOriginsStruct=(0,a.object)({allowedOrigins:(0,a.optional)(i)}),n.assertIsKeyringOrigins=function(e,t){(0,r.assertStruct)(e,n.KeyringOriginsStruct,"Invalid keyring origins",t)},n.isOriginAllowed=function(e,t,n){var a;return"metamask"===n||(!(null===(a=e.allowedOrigins)||void 0===a||!a.some(e=>o(e,n)))||(!(t!==s.SubjectType.Website||!e.dapps)||Boolean(t===s.SubjectType.Snap&&e.snaps)))},n.assertIsJsonRpcSuccess=function(e){if(!(0,r.isJsonRpcSuccess)(e)){if((0,r.isJsonRpcFailure)(e))throw new Error(`JSON-RPC request failed: ${e.error.message}`);throw new Error("Invalid JSON-RPC response.")}}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/json-rpc.cjs"}],[3384,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getJsonSizeUnsafe=n.parseJson=void 0;const s=e("@metamask/utils");n.parseJson=function(e){return(0,s.getSafeJson)(JSON.parse(e))},n.getJsonSizeUnsafe=function(e,t=!1){const n=JSON.stringify(e);return t?(new TextEncoder).encode(n).byteLength:n.length}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/json.cjs"}],[3385,{"./json.cjs":3384,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSnapManifestLocalizations=n.getLocalizedSnapManifest=n.translate=n.TRANSLATION_REGEX=n.getLocalizationFile=n.getValidatedLocalizationFiles=n.LocalizationFileStruct=n.LOCALIZABLE_FIELDS=void 0;const s=e("@metamask/snaps-sdk"),a=e("@metamask/superstruct"),r=e("./json.cjs");function i(e,t){const n=t.find(t=>t.locale===e);return n||t.find(e=>"en"===e.locale)}function o(e,t){const s=e.matchAll(n.TRANSLATION_REGEX);return Array.from(s).reduce((n,[s,a])=>{if(!t)throw new Error(`Failed to translate "${e}": No localization file found.`);const r=t.messages[a.trim()];if(!r)throw new Error(`Failed to translate "${e}": No translation found for "${a.trim()}" in "${t.locale}" file.`);return n.replace(s,r.message)},e)}function c(e,t,s){const a=i(t,s);return n.LOCALIZABLE_FIELDS.reduce((e,t)=>{const n=o(e[t],a);return{...e,[t]:n}},e)}n.LOCALIZABLE_FIELDS=["description","proposedName"],n.LocalizationFileStruct=(0,a.object)({locale:(0,a.string)(),messages:(0,a.record)((0,a.string)(),(0,a.object)({message:(0,a.string)(),description:(0,a.optional)((0,a.string)())}))}),n.getValidatedLocalizationFiles=function(e){for(const t of e)try{t.result=(0,a.create)((0,r.parseJson)(t.toString()),n.LocalizationFileStruct)}catch(e){if(e instanceof a.StructError)throw new Error(`Failed to validate localization file "${t.path}": ${e.message}.`);if(e instanceof SyntaxError)throw new Error(`Failed to parse localization file "${t.path}" as JSON.`);throw e}return e},n.getLocalizationFile=i,n.TRANSLATION_REGEX=/\{\{\s?([a-zA-Z0-9-_\s]+)\s?\}\}/gu,n.translate=o,n.getLocalizedSnapManifest=c,n.validateSnapManifestLocalizations=function(e,t){try{t.filter(e=>"en"!==e.locale).forEach(n=>{c(e,n.locale,t)}),c(e,"en",t)}catch(e){throw new Error(`Failed to localize Snap manifest: ${(0,s.getErrorMessage)(e)}`)}}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/localization.cjs"}],[3386,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.logWarning=n.logError=n.logInfo=n.snapsLogger=void 0;const s=e("@metamask/utils");n.snapsLogger=(0,s.createProjectLogger)("snaps"),n.logInfo=function(e,...t){console.log(e,...t)},n.logError=function(e,...t){console.error(e,...t)},n.logWarning=function(e,...t){console.warn(e,...t)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/logging.cjs"}],[3387,{"./validation.cjs":3388},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./validation.cjs"),n)}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/manifest/index.cjs"}],[3388,{"../array.cjs":3355,"../cronjob.cjs":3362,"../entropy.cjs":3367,"../json-rpc.cjs":3383,"../snaps.cjs":3391,"../structs.cjs":3393,"../types.cjs":3396,"@metamask/key-tree":2466,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSnapManifest=n.assertIsSnapManifest=n.isSnapManifest=n.SnapManifestStruct=n.InitialConnectionsStruct=n.SnapAuxilaryFilesStruct=n.SnapAuxiliaryFilesStruct=n.PermissionsStruct=n.EmptyObjectStruct=n.HandlerCaveatsStruct=n.ProtocolScopesStruct=n.MaxRequestTimeStruct=n.MAXIMUM_REQUEST_TIMEOUT=n.MINIMUM_REQUEST_TIMEOUT=n.LookupMatchersStruct=n.ChainIdsStruct=n.SnapIdsStruct=n.SemVerRangeStruct=n.SnapGetBip32EntropyPermissionsStruct=n.Bip32EntropyStruct=n.CurveStruct=n.bip32entropy=n.Bip32PathStruct=n.FORBIDDEN_COIN_TYPES=void 0;const s=e("@metamask/key-tree"),a=e("@metamask/superstruct"),r=e("@metamask/utils"),i=e("../array.cjs"),o=e("../cronjob.cjs"),c=e("../entropy.cjs"),u=e("../json-rpc.cjs"),l=e("../snaps.cjs"),d=e("../structs.cjs"),f=e("../types.cjs"),h=[c.SIP_6_MAGIC_VALUE,c.STATE_ENCRYPTION_MAGIC_VALUE].map(e=>["m",`${e}`]);n.FORBIDDEN_COIN_TYPES=[60];const m=n.FORBIDDEN_COIN_TYPES.map(e=>["m","44'",`${e}'`]);n.Bip32PathStruct=(0,a.refine)((0,a.array)((0,a.string)()),"BIP-32 path",e=>0===e.length?"Path must be a non-empty BIP-32 derivation path array":"m"!==e[0]?'Path must start with "m".':e.length<3?"Paths must have a length of at least three.":e.slice(1).some(e=>!(0,s.isValidBIP32PathSegment)(e))?"Path must be a valid BIP-32 derivation path array.":h.some(t=>(0,i.isDerivationPathEqual)(e.slice(0,t.length),t))?`The purpose "${e[1]}" is not allowed for entropy derivation.`:!m.some(t=>(0,i.isDerivationPathEqual)(e.slice(0,t.length),t))||`The path "${e.join("/")}" is not allowed for entropy derivation.`);n.bip32entropy=e=>(0,a.refine)(e,"BIP-32 entropy",e=>"ed25519"!==e.curve||!e.path.slice(1).some(e=>!e.endsWith("'"))||"Ed25519 does not support unhardened paths."),n.CurveStruct=(0,a.enums)(["ed25519","secp256k1","ed25519Bip32"]),n.Bip32EntropyStruct=(0,n.bip32entropy)((0,a.type)({path:n.Bip32PathStruct,curve:n.CurveStruct})),n.SnapGetBip32EntropyPermissionsStruct=(0,a.size)((0,a.array)(n.Bip32EntropyStruct),1,Infinity),n.SemVerRangeStruct=(0,a.refine)((0,a.string)(),"SemVer range",e=>!!(0,r.isValidSemVerRange)(e)||"Expected a valid SemVer range."),n.SnapIdsStruct=(0,a.refine)((0,a.record)(l.SnapIdStruct,(0,a.object)({version:(0,a.optional)(n.SemVerRangeStruct)})),"SnapIds",e=>0!==Object.keys(e).length),n.ChainIdsStruct=(0,a.size)((0,a.array)(r.CaipChainIdStruct),1,Infinity),n.LookupMatchersStruct=(0,a.union)([(0,a.object)({tlds:(0,a.size)((0,a.array)((0,a.string)()),1,Infinity)}),(0,a.object)({schemes:(0,a.size)((0,a.array)((0,a.string)()),1,Infinity)}),(0,a.object)({tlds:(0,a.size)((0,a.array)((0,a.string)()),1,Infinity),schemes:(0,a.size)((0,a.array)((0,a.string)()),1,Infinity)})]),n.MINIMUM_REQUEST_TIMEOUT=(0,r.inMilliseconds)(5,r.Duration.Second),n.MAXIMUM_REQUEST_TIMEOUT=(0,r.inMilliseconds)(3,r.Duration.Minute),n.MaxRequestTimeStruct=(0,a.size)((0,a.integer)(),n.MINIMUM_REQUEST_TIMEOUT,n.MAXIMUM_REQUEST_TIMEOUT),n.ProtocolScopesStruct=(0,a.record)(r.CaipChainIdStruct,(0,a.object)({methods:(0,a.array)((0,a.string)())})),n.HandlerCaveatsStruct=(0,a.object)({maxRequestTime:(0,a.optional)(n.MaxRequestTimeStruct)}),n.EmptyObjectStruct=(0,a.object)({}),n.PermissionsStruct=(0,a.type)({"endowment:assets":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,a.object)({scopes:n.ChainIdsStruct}))),"endowment:cronjob":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,a.object)({jobs:(0,a.optional)(o.CronjobSpecificationArrayStruct)}))),"endowment:ethereum-provider":(0,a.optional)(n.EmptyObjectStruct),"endowment:keyring":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,u.KeyringOriginsStruct)),"endowment:protocol":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,a.object)({scopes:n.ProtocolScopesStruct}))),"endowment:lifecycle-hooks":(0,a.optional)(n.HandlerCaveatsStruct),"endowment:name-lookup":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,a.object)({chains:(0,a.optional)(n.ChainIdsStruct),matchers:(0,a.optional)(n.LookupMatchersStruct)}))),"endowment:network-access":(0,a.optional)(n.EmptyObjectStruct),"endowment:page-home":(0,a.optional)(n.HandlerCaveatsStruct),"endowment:rpc":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,u.RpcOriginsStruct)),"endowment:signature-insight":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,a.object)({allowSignatureOrigin:(0,a.optional)((0,a.boolean)())}))),"endowment:transaction-insight":(0,a.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,a.object)({allowTransactionOrigin:(0,a.optional)((0,a.boolean)())}))),"endowment:webassembly":(0,a.optional)(n.EmptyObjectStruct),snap_dialog:(0,a.optional)(n.EmptyObjectStruct),snap_manageState:(0,a.optional)(n.EmptyObjectStruct),snap_manageAccounts:(0,a.optional)(n.EmptyObjectStruct),snap_notify:(0,a.optional)(n.EmptyObjectStruct),snap_getBip32Entropy:(0,a.optional)(n.SnapGetBip32EntropyPermissionsStruct),snap_getBip32PublicKey:(0,a.optional)(n.SnapGetBip32EntropyPermissionsStruct),snap_getBip44Entropy:(0,a.optional)((0,a.size)((0,a.array)((0,a.object)({coinType:(0,a.size)((0,a.integer)(),0,2**32-1)})),1,Infinity)),snap_getEntropy:(0,a.optional)(n.EmptyObjectStruct),snap_getLocale:(0,a.optional)(n.EmptyObjectStruct),wallet_snap:(0,a.optional)(n.SnapIdsStruct)}),n.SnapAuxiliaryFilesStruct=(0,a.array)((0,a.string)()),n.SnapAuxilaryFilesStruct=n.SnapAuxiliaryFilesStruct,n.InitialConnectionsStruct=(0,a.record)((0,a.intersection)([(0,a.string)(),(0,f.uri)()]),(0,a.object)({})),n.SnapManifestStruct=(0,a.object)({extends:(0,a.optional)((0,a.size)((0,a.string)(),1,Infinity)),version:r.VersionStruct,description:(0,a.size)((0,a.string)(),1,280),proposedName:(0,a.size)((0,a.string)(),1,214),repository:(0,a.optional)((0,a.type)({type:(0,a.size)((0,a.string)(),1,Infinity),url:(0,a.size)((0,a.string)(),1,Infinity)})),source:(0,a.object)({shasum:r.ChecksumStruct,location:(0,a.object)({npm:(0,a.object)({filePath:(0,a.size)((0,a.string)(),1,Infinity),iconPath:(0,a.optional)((0,a.size)((0,a.string)(),1,Infinity)),packageName:f.NameStruct,registry:(0,a.union)([(0,a.literal)("https://registry.npmjs.org"),(0,a.literal)("https://registry.npmjs.org/")])})}),files:(0,a.optional)(n.SnapAuxiliaryFilesStruct),locales:(0,a.optional)(n.SnapAuxiliaryFilesStruct)}),initialConnections:(0,a.optional)(n.InitialConnectionsStruct),initialPermissions:n.PermissionsStruct,manifestVersion:(0,a.literal)("0.1"),platformVersion:(0,a.optional)(r.VersionStruct),$schema:(0,a.optional)((0,a.string)())}),n.isSnapManifest=function(e){return(0,a.is)(e,n.SnapManifestStruct)},n.assertIsSnapManifest=function(e){(0,r.assertStruct)(e,n.SnapManifestStruct,`"${f.NpmSnapFileNames.Manifest}" is invalid`)},n.createSnapManifest=function(e){return(0,a.create)(e,n.SnapManifestStruct)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/manifest/validation.cjs"}],[3389,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeRelative=void 0;const s=e("@metamask/utils");n.normalizeRelative=function(e){return(0,s.assert)(!e.startsWith("/")),(0,s.assert)(-1===e.search(/:|\/\//u),`Path "${e}" potentially an URI instead of local relative`),e.startsWith("./")?e.slice(2):e}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/path.cjs"}],[3390,{"@metamask/snaps-sdk/package.json":3353},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getPlatformVersion=void 0;const a=s(e("@metamask/snaps-sdk/package.json"));n.getPlatformVersion=function(){return a.default.version}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/platform-version.cjs"}],[3391,{"./caveats.cjs":3359,"./checksum.cjs":3360,"./types.cjs":3396,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554,"@scure/base":3634,"fast-json-stable-stringify":4789,"validate-npm-package-name":6150},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.verifyRequestedSnapPermissions=n.isSnapPermitted=n.assertIsValidSnapId=n.isSnapId=n.stripSnapPrefix=n.getSnapPrefix=n.SnapIdStruct=n.SnapIdPrefixStruct=n.HttpSnapIdStruct=n.NpmSnapIdStruct=n.LocalSnapIdStruct=n.BaseSnapIdStruct=n.LOCALHOST_HOSTNAMES=n.validateSnapShasum=n.getSnapChecksum=n.SnapStatusEvents=n.SnapStatus=n.PROPOSED_NAME_REGEX=void 0;const a=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),i=e("@metamask/utils"),o=e("@scure/base"),c=s(e("fast-json-stable-stringify")),u=s(e("validate-npm-package-name")),l=e("./caveats.cjs"),d=e("./checksum.cjs"),f=e("./types.cjs");var h,m;function p(e){const t=e.clone();return delete t.result.source.shasum,t.value=(0,c.default)(t.result),t}async function g(e){const{manifest:t,sourceCode:n,svgIcon:s,auxiliaryFiles:a,localizationFiles:r}=e,i=[p(t),n,s,...a,...r].filter(e=>e!==undefined);return o.base64.encode(await(0,d.checksumFiles)(i))}n.PROPOSED_NAME_REGEX=/^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*\/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$/u,function(e){e.Installing="installing",e.Updating="updating",e.Running="running",e.Stopped="stopped",e.Crashed="crashed"}(h||(n.SnapStatus=h={})),function(e){e.Start="START",e.Stop="STOP",e.Crash="CRASH",e.Update="UPDATE"}(m||(n.SnapStatusEvents=m={})),n.getSnapChecksum=g,n.validateSnapShasum=async function(e,t="Invalid Snap manifest: manifest shasum does not match computed shasum."){if(e.manifest.result.source.shasum!==await g(e))throw new Error(t)},n.LOCALHOST_HOSTNAMES=["localhost","127.0.0.1","[::1]"],n.BaseSnapIdStruct=(0,i.definePattern)("Base Snap Id",/^[\x21-\x7E]*$/u);const b=(0,f.uri)({protocol:(0,r.enums)(["http:","https:"]),hostname:(0,r.enums)(n.LOCALHOST_HOSTNAMES),hash:(0,r.empty)((0,r.string)()),search:(0,r.empty)((0,r.string)())});function y(e){const t=Object.values(f.SnapIdPrefixes).find(t=>e.startsWith(t));if(t!==undefined)return t;throw new Error(`Invalid or no prefix found for "${e}"`)}n.LocalSnapIdStruct=(0,r.refine)(n.BaseSnapIdStruct,"local Snap Id",e=>{if(!e.startsWith(f.SnapIdPrefixes.local))return`Expected local snap ID, got "${e}".`;const[t]=(0,r.validate)(e.slice(f.SnapIdPrefixes.local.length),b);return t??!0}),n.NpmSnapIdStruct=(0,r.intersection)([n.BaseSnapIdStruct,(0,f.uri)({protocol:(0,r.literal)(f.SnapIdPrefixes.npm),pathname:(0,r.refine)((0,r.string)(),"package name",function*(e){const t=e.startsWith("/")?e.slice(1):e,{errors:n,validForNewPackages:s,warnings:a}=(0,u.default)(t);return s||(n===undefined?((0,i.assert)(a!==undefined),yield*a):yield*n),!0}),search:(0,r.empty)((0,r.string)()),hash:(0,r.empty)((0,r.string)())})]),n.HttpSnapIdStruct=(0,r.intersection)([n.BaseSnapIdStruct,(0,f.uri)({protocol:(0,r.enums)(["http:","https:"]),search:(0,r.empty)((0,r.string)()),hash:(0,r.empty)((0,r.string)())})]),n.SnapIdPrefixStruct=(0,r.refine)((0,r.string)(),"Snap ID prefix",e=>{if(Object.values(f.SnapIdPrefixes).some(t=>e.startsWith(t)))return!0;return`Invalid or no prefix found. Expected Snap ID to start with one of: ${Object.values(f.SnapIdPrefixes).map(e=>`"${e}"`).join(", ")}, but received: "${e}"`}),n.SnapIdStruct=(0,a.selectiveUnion)(e=>"string"==typeof e&&e.startsWith(f.SnapIdPrefixes.npm)?n.NpmSnapIdStruct:"string"==typeof e&&e.startsWith(f.SnapIdPrefixes.local)?n.LocalSnapIdStruct:n.SnapIdPrefixStruct),n.getSnapPrefix=y,n.stripSnapPrefix=function(e){return e.replace(y(e),"")},n.isSnapId=function(e){return(0,r.is)(e,n.SnapIdStruct)},n.assertIsValidSnapId=function(e){(0,i.assertStruct)(e,n.SnapIdStruct,"Invalid snap ID")},n.isSnapPermitted=function(e,t){var n,s;return Boolean(null===(n=((null==e||null===(s=e.wallet_snap)||void 0===s||null===(s=s.caveats)||void 0===s?void 0:s.find(e=>e.type===l.SnapCaveatType.SnapIds))??{}).value)||void 0===n?void 0:n[t])},n.verifyRequestedSnapPermissions=function(e){(0,i.assert)((0,i.isObject)(e),"Requested permissions must be an object.");const{wallet_snap:t}=e;(0,i.assert)((0,i.isObject)(t),"wallet_snap is missing from the requested permissions.");const{caveats:n}=t;(0,i.assert)(Array.isArray(n)&&1===n.length,"wallet_snap must have a caveat property with a single-item array value.");const[s]=n;(0,i.assert)((0,i.isObject)(s)&&s.type===l.SnapCaveatType.SnapIds&&(0,i.isObject)(s.value),`The requested permissions do not have a valid ${l.SnapCaveatType.SnapIds} caveat.`)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/snaps.cjs"}],[3392,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.indent=void 0,n.indent=function(e,t=2){return e.replace(/^/gmu," ".repeat(t))}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/strings.cjs"}],[3393,{"./strings.cjs":3392,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554,chalk:4496},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeStructs=n.createUnion=n.validateUnion=n.getStructErrorMessage=n.getStructFailureMessage=n.getStructErrorPrefix=n.getUnionStructNames=n.getStructFromPath=n.createFromStruct=n.getError=n.arrayToGenerator=n.SnapsStructError=n.named=void 0;const s=e("@metamask/snaps-sdk"),a=e("@metamask/superstruct"),r=e("@metamask/utils"),i=e("chalk"),o=e("./strings.cjs");function c(e,t,n){return n?t(e):e}n.named=function(e,t){return new a.Struct({...t,type:e})};class u extends a.StructError{constructor(e,t,n,s,a,r=!0){super(s,a),this.name="SnapsStructError",this.message=`${t}.\n\n${g(e,[...a()],r)}${n?`\n\n${n}`:""}`}}function*l(e){for(const t of e)yield t}function d({struct:e,prefix:t,suffix:n="",error:s,colorize:a}){return new u(e,t,n,s,()=>l(s.failures()),a)}function f(e,t){return t.reduce((t,n)=>(0,r.isObject)(e.schema)&&e.schema[n]?e.schema[n]:t,e)}function h(e,t=!0){return Array.isArray(e.schema)?e.schema.map(({type:e})=>c(e,i.green,t)):null}function m(e,t=!0){return"never"===e.type||0===e.path.length?"":`At path: ${c(e.path.join("."),i.bold,t)} — `}function p(e,t,n=!0){const s=c(JSON.stringify(t.value),i.red,n),a=m(t,n);if("union"===t.type){const r=h(f(e,t.path),n);return r?`${a}Expected the value to be one of: ${r.join(", ")}, but received: ${s}.`:`${a}${t.message}.`}if("literal"===t.type){return`${a}${t.message.replace(/the literal `(.+)`,/u,`the value to be \`${c("$1",i.green,n)}\`,`).replace(/, but received: (.+)/u,`, but received: ${c("$1",i.red,n)}`)}.`}if("never"===t.type)return`Unknown key: ${c(t.path.join("."),i.bold,n)}, received: ${s}.`;if("size"===t.refinement){return`${a}${t.message.replace(/length between `(\d+)` and `(\d+)`/u,`length between ${c("$1",i.green,n)} and ${c("$2",i.green,n)},`).replace(/length of `(\d+)`/u,`length of ${c("$1",i.red,n)}`).replace(/a array/u,"an array")}.`}return t.refinement!==undefined?`${a}${t.message}.`:`${a}Expected a value of type ${c(t.type,i.green,n)}, but received: ${s}.`}function g(e,t,n=!0){return t.map(t=>(0,o.indent)(`• ${p(e,t,n)}`)).join("\n")}function b(e,t,n,i=!1){(0,r.assert)(t.schema,"Expected a struct with a schema. Make sure to use `union` from `@metamask/snaps-sdk`."),(0,r.assert)(t.schema.length>0,"Expected a non-empty array of structs.");const o=t.schema.map(e=>e.schema[n]),c=(0,a.type)({[n]:(0,s.union)(o)}),[u]=(0,a.validate)(e,c,{coerce:i});if(u)throw new Error(p(c,u.failures()[0],!1));const l=e,d=t.schema.filter(e=>(0,a.is)(l[n],e.schema[n]));(0,r.assert)(d.length>0,"Expected a struct to match the value.");const f=d.map(e=>(0,a.validate)(l,e,{coerce:i})),h=f.find(([e])=>!e);if(h)return h[1];(0,r.assert)(f[0][0],"Expected at least one error.");const m=f.reduce((e,[t])=>((0,r.assert)(t,"Expected an error."),t.failures().length<e.failures().length?t:e),f[0][0]);throw new Error(p(t,m.failures()[0],!1))}n.SnapsStructError=u,n.arrayToGenerator=l,n.getError=d,n.createFromStruct=function(e,t,n,s=""){try{return(0,a.create)(e,t)}catch(e){if(e instanceof a.StructError)throw d({struct:t,prefix:n,suffix:s,error:e});throw e}},n.getStructFromPath=f,n.getUnionStructNames=h,n.getStructErrorPrefix=m,n.getStructFailureMessage=p,n.getStructErrorMessage=g,n.validateUnion=b,n.createUnion=function(e,t,n){return b(e,t,n,!0)},n.mergeStructs=function(...e){const t=a.assign(...e);return new a.Struct({...t,*refiner(t,n){for(const s of e)yield*s.refiner(t,n)}})}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/structs.cjs"}],[3394,{"@metamask/utils":3554,"fast-xml-parser":4791},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSvg=n.parseSvg=void 0;const s=e("@metamask/utils"),a=e("fast-xml-parser");function r(e){try{const t=e.trim();(0,s.assert)(t.length>0);const n=new a.XMLParser({ignoreAttributes:!1,parseAttributeValue:!0}).parse(t,!0);return(0,s.assert)((0,s.hasProperty)(n,"svg")),(0,s.isObject)(n.svg)?n.svg:{}}catch{throw new Error("Snap icon must be a valid SVG.")}}n.parseSvg=r,n.isSvg=function(e){try{return r(e),!0}catch{return!1}}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/svg.cjs"}],[3395,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,luxon:5250},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ISO8601DateStruct=n.toCensoredISO8601String=n.ISO8601DurationStruct=void 0;const s=e("@metamask/superstruct"),a=e("luxon");n.ISO8601DurationStruct=(0,s.refine)((0,s.string)(),"ISO 8601 duration",e=>!!a.Duration.fromISO(e).isValid||"Not a valid ISO 8601 duration"),n.toCensoredISO8601String=function(e){return a.DateTime.fromISO(e,{setZone:!0}).startOf("second").toISO({suppressMilliseconds:!0})};var r=e("@metamask/snaps-sdk");Object.defineProperty(n,"ISO8601DateStruct",{enumerable:!0,get:function(){return r.ISO8601DateStruct}})}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/time.cjs"}],[3396,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WALLET_SNAP_PERMISSION_KEY=n.isValidUrl=n.uri=n.SNAP_STREAM_NAMES=n.SnapIdPrefixes=n.NpmSnapPackageJsonStruct=n.NameStruct=n.NpmSnapFileNames=void 0;const s=e("@metamask/snaps-sdk"),a=e("@metamask/superstruct"),r=e("@metamask/utils");var i,o,c;!function(e){e.PackageJson="package.json",e.Manifest="snap.manifest.json"}(i||(n.NpmSnapFileNames=i={})),n.NameStruct=(0,a.size)((0,r.definePattern)("Snap Name",/^(?:@[a-z0-9-*~][a-z0-9-*._~]*\/)?[a-z0-9-~][a-z0-9-._~]*$/u),1,214),n.NpmSnapPackageJsonStruct=(0,a.type)({version:r.VersionStruct,name:n.NameStruct,main:(0,a.optional)((0,a.size)((0,a.string)(),1,Infinity)),repository:(0,a.optional)((0,a.type)({type:(0,a.size)((0,a.string)(),1,Infinity),url:(0,a.size)((0,a.string)(),1,Infinity)}))}),function(e){e.npm="npm:",e.local="local:"}(o||(n.SnapIdPrefixes=o={})),function(e){e.JSON_RPC="jsonRpc",e.COMMAND="command"}(c||(n.SNAP_STREAM_NAMES=c={}));var u=e("@metamask/snaps-sdk");Object.defineProperty(n,"uri",{enumerable:!0,get:function(){return u.uri}}),n.isValidUrl=function(e,t={}){return(0,a.is)(e,(0,s.uri)(t))},n.WALLET_SNAP_PERMISSION_KEY="wallet_snap"}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/types.cjs"}],[3397,{"./types.cjs":3396,"./url.cjs":3398,"@metamask/snaps-sdk":3265,"@metamask/snaps-sdk/jsx":3352,"@metamask/snaps-sdk/jsx-runtime":3351,"@metamask/utils":3554,marked:5251},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serialiseJsx=n.walkJsx=n.getJsxChildren=n.hasChildren=n.getTotalTextLength=n.validateJsxElements=n.validateAssetSelector=n.validateTextLinks=n.validateLink=n.getJsxElementFromComponent=n.getTextChildren=void 0;const s=e("@metamask/snaps-sdk/jsx-runtime"),a=e("@metamask/snaps-sdk"),r=e("@metamask/snaps-sdk/jsx"),i=e("@metamask/utils"),o=e("marked"),c=e("./types.cjs"),u=e("./url.cjs"),l=["https:","mailto:","metamask:"];function d(e){switch(e){case"primary":return"primary";case"secondary":return"destructive";default:return undefined}}function f(e){return 1===e.length?e[0]:e}function h(e){return e.tokens&&e.tokens.length>0?f(e.tokens.flatMap(p)):e.href}function m(e){return f(e.flatMap(p))}function p(e){switch(e.type){case"link":return(0,s.jsx)(r.Link,{href:e.href,children:h(e)});case"text":return e.text;case"strong":return(0,s.jsx)(r.Bold,{children:m(e.tokens)});case"em":return(0,s.jsx)(r.Italic,{children:m(e.tokens)});default:return null}}function g(e){const t=(0,o.lexer)(e,{gfm:!1}),n=[];return(0,o.walkTokens)(t,e=>{if("paragraph"===e.type){n.length>0&&n.push("\n\n");const{tokens:t}=e;n.push(...t.flatMap(p))}}),n.filter(e=>null!==e)}function b(e,t,n){try{const s=new URL(e);if((0,i.assert)(l.includes(s.protocol),`Protocol must be one of: ${l.join(", ")}.`),"metamask:"===s.protocol){const t=(0,u.parseMetaMaskUrl)(e);t.snapId&&(0,i.assert)(n(t.snapId),"The Snap being navigated to is not installed.")}else if("mailto:"===s.protocol){const e=s.pathname.split(",");for(const n of e){const e=n.split("@")[1];(0,i.assert)(!e.includes(":"));const s=`https://${e}`;(0,i.assert)(!t(s),"The specified URL is not allowed.")}return}(0,i.assert)(!t(s.href),"The specified URL is not allowed.")}catch(e){throw new Error(`Invalid URL: ${"ERR_ASSERTION"===(null==e?void 0:e.code)?e.message:"Unable to parse URL."}`)}}function y(e,t){const n=t(e);(0,i.assert)(n,`Could not find account for address: ${e}`)}function w(e){const{type:t}=e;switch(t){case a.NodeType.Panel:return e.children.reduce((e,t)=>e+w(t),0);case a.NodeType.Row:return w(e.value);case a.NodeType.Text:return e.value.length;default:return 0}}function T(e){return(0,i.hasProperty)(e.props,"children")}function S(e){return Boolean(e)&&!0!==e}function E(e){if(T(e)){if(Array.isArray(e.props.children))return e.props.children.filter(S).flat(Infinity);if(e.props.children)return[e.props.children]}return[]}function k(e,t,n=0){if(Array.isArray(e)){for(const s of e){const e=k(s,t,n);if(e!==undefined)return e}return undefined}const s=t(e,n);if(s!==undefined)return s;if((0,i.hasProperty)(e,"props")&&(0,i.isPlainObject)(e.props)&&(0,i.hasProperty)(e.props,"children")){const s=E(e);for(const e of s)if((0,i.isPlainObject)(e)){const s=k(e,t,n+1);if(s!==undefined)return s}}return undefined}function P(e){return Object.entries(e).filter(([e])=>"children"!==e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>{return` ${e}=${n=t,"string"==typeof n?`"${n}"`:`{${JSON.stringify(n)}}`}`;var n}).join("")}n.getTextChildren=g,n.getJsxElementFromComponent=function(e){return function(e){const t=w(e);(0,i.assert)(t<=5e4,"The text in a Snap UI may not be larger than 50 kB.")}(e),function e(t){switch(t.type){case a.NodeType.Address:return(0,s.jsx)(r.Address,{address:t.value});case a.NodeType.Button:return(0,s.jsx)(r.Button,{name:t.name,variant:d(t.variant),type:t.buttonType,children:t.value});case a.NodeType.Copyable:return(0,s.jsx)(r.Copyable,{value:t.value,sensitive:t.sensitive});case a.NodeType.Divider:return(0,s.jsx)(r.Divider,{});case a.NodeType.Form:return(0,s.jsx)(r.Form,{name:t.name,children:f(t.children.map(e))});case a.NodeType.Heading:return(0,s.jsx)(r.Heading,{children:t.value});case a.NodeType.Image:return(0,s.jsx)(r.Image,{src:t.value});case a.NodeType.Input:return(0,s.jsx)(r.Field,{label:t.label,error:t.error,children:(0,s.jsx)(r.Input,{name:t.name,type:t.inputType,value:t.value,placeholder:t.placeholder})});case a.NodeType.Panel:return(0,s.jsx)(r.Box,{children:f(t.children.map(e))});case a.NodeType.Row:return(0,s.jsx)(r.Row,{label:t.label,variant:t.variant,children:e(t.value)});case a.NodeType.Spinner:return(0,s.jsx)(r.Spinner,{});case a.NodeType.Text:return(0,s.jsx)(r.Text,{children:f(g(t.value))});default:return(0,i.assertExhaustive)(t)}}(e)},n.validateLink=b,n.validateTextLinks=function(e,t,n){const s=function(e){const t=(0,o.lexer)(e,{gfm:!1}),n=[];return(0,o.walkTokens)(t,e=>{"link"===e.type&&n.push(e)}),n}(e);for(const e of s)b(e.href,t,n)},n.validateAssetSelector=y,n.validateJsxElements=function(e,{isOnPhishingList:t,getSnap:n,getAccountByAddress:s,hasPermission:a}){k(e,e=>{switch(e.type){case"Link":b(e.props.href,t,n);break;case"AssetSelector":y(e.props.addresses[0],s);break;case"Image":{const{src:t}=e.props,n=(0,c.isValidUrl)(t);(0,i.assert)(!n||n&&a("endowment:network-access"),"Using external images is only permitted with the `endowment:network-access` permission.");break}}})},n.getTotalTextLength=w,n.hasChildren=T,n.getJsxChildren=E,n.walkJsx=k,n.serialiseJsx=function e(t,n=0){if(Array.isArray(t))return t.map(t=>e(t,n)).join("");const s="  ".repeat(n);if("string"==typeof t)return`${s}${t}\n`;if(!t)return"";const{type:a,props:r}=t,o=n>0?"\n":"";if((0,i.hasProperty)(r,"children")){const t=e(r.children,n+1);return`${s}<${a}${P(r)}>\n${t}${s}</${a}>${o}`}return`${s}<${a}${P(r)} />${o}`}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/ui.cjs"}],[3398,{"./snaps.cjs":3391,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseMetaMaskUrl=n.SNAP_PATHS=n.CLIENT_PATHS=void 0;const s=e("@metamask/utils"),a=e("./snaps.cjs");n.CLIENT_PATHS=["/"],n.SNAP_PATHS=["/home"],n.parseMetaMaskUrl=function(e){const t=new URL(e),{protocol:r}=t;if("metamask:"!==r)throw new Error(`Unable to parse URL. Expected the protocol to be "metamask:", but received "${r}".`);const[i,...o]=t.href.replace("metamask://","").split("/"),c=`/${o.join("/")}`;switch(i){case"client":return(0,s.assert)(n.CLIENT_PATHS.includes(c),`Unable to navigate to "${c}". The provided path is not allowed.`),{authority:i,path:c};case"snap":return function(e){const t="Invalid MetaMask url:",r=(0,a.stripSnapPrefix)(e.slice(1)),i=e.slice(1).startsWith("npm:")?"npm:":"local:",o=r.startsWith("@"),c=r.split("/"),u=`/${c[c.length-1]}`;let l;if("local:"===i){const[e,,...a]=c.slice(0,-1);l=`${e}//${a.join("/")}`,(0,s.assert)(n.SNAP_PATHS.includes(u),`${t} invalid snap path.`)}else l=o?`${c[0]}/${c[1]}`:c[0],(0,s.assert)(o?3===c.length&&n.SNAP_PATHS.includes(u):2===c.length&&n.SNAP_PATHS.includes(u),`${t} invalid snap path.`);const d=`${i}${l}`;return(0,a.assertIsValidSnapId)(d),{authority:"snap",snapId:d,path:u}}(c);default:throw new Error(`Expected "metamask:" URL to start with "client" or "snap", but received "${i}".`)}}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/url.cjs"}],[3399,{"./icon.cjs":3380,"./localization.cjs":3385,"./manifest/validation.cjs":3388,"./snaps.cjs":3391},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateFetchedSnap=void 0;const s=e("./icon.cjs"),a=e("./localization.cjs"),r=e("./manifest/validation.cjs"),i=e("./snaps.cjs");n.validateFetchedSnap=async function(e){(0,r.assertIsSnapManifest)(e.manifest.result),await(0,i.validateSnapShasum)(e),(0,a.validateSnapManifestLocalizations)(e.manifest.result,e.localizationFiles.map(e=>e.result)),e.svgIcon&&(0,s.assertIsSnapIcon)(e.svgIcon)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/validation.cjs"}],[3400,{"@metamask/superstruct":3415,"@metamask/utils":3554,semver:5987},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resolveVersionRange=n.getTargetVersion=n.DEFAULT_REQUESTED_SNAP_VERSION=void 0;const s=e("@metamask/superstruct"),a=e("@metamask/utils"),r=e("semver");n.DEFAULT_REQUESTED_SNAP_VERSION="*",n.getTargetVersion=function(e,t){const n=(0,r.maxSatisfying)(e,t);return n||(0,r.maxSatisfying)(e,t,{includePrerelease:!0})},n.resolveVersionRange=function(e){return e===undefined||"latest"===e?[undefined,n.DEFAULT_REQUESTED_SNAP_VERSION]:(0,s.validate)(e,a.VersionRangeStruct)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/versions.cjs"}],[3401,{"../deep-clone.cjs":3364,"@metamask/utils":3554,"@scure/base":3634},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.VirtualFile=void 0;const a=e("@metamask/utils"),r=e("@scure/base"),i=e("../deep-clone.cjs");class o{constructor(e){var t,n,a,r;let i;s(this,"value",void 0),s(this,"result",void 0),s(this,"data",void 0),s(this,"path",void 0),i="string"==typeof e||e instanceof Uint8Array?{value:e}:e,this.value=(null===(t=i)||void 0===t?void 0:t.value)??"",this.result=(null===(n=i)||void 0===n?void 0:n.result)??undefined,this.data=(null===(a=i)||void 0===a?void 0:a.data)??{},this.path=(null===(r=i)||void 0===r?void 0:r.path)??"/"}get size(){return"string"==typeof this.value?this.value.length:this.value.byteLength}toString(e){if("string"==typeof this.value)return(0,a.assert)(e===undefined,"Tried to encode string."),this.value;if(this.value instanceof Uint8Array&&"hex"===e)return(0,a.bytesToHex)(this.value);if(this.value instanceof Uint8Array&&"base64"===e)return r.base64.encode(this.value);return new TextDecoder(e).decode(this.value)}clone(){const e=new o;return"string"==typeof this.value?e.value=this.value:e.value=this.value.slice(0),e.result=(0,i.deepClone)(this.result),e.data=(0,i.deepClone)(this.data),e.path=this.path,e}}n.VirtualFile=o}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/virtual-file/VirtualFile.cjs"}],[3402,{"./VirtualFile.cjs":3401},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./VirtualFile.cjs"),n)}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/virtual-file/index.cjs"}],[3407,{"./constants.cjs":3409,"./types.cjs":3412,"@metamask/polling-controller":2889,"@metamask/transaction-controller":3473,"bignumber.js":3413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y,w=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},T=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionController=n.getDefaultSubscriptionControllerState=void 0;const S=e("@metamask/polling-controller"),E=e("@metamask/transaction-controller"),k=e("bignumber.js"),P=e("./constants.cjs"),v=e("./types.cjs");function I(){return{subscriptions:[],trialedProducts:[]}}n.getDefaultSubscriptionControllerState=I;const _={subscriptions:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastSubscription:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},customerId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},rewardAccountId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},trialedProducts:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},pricing:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lastSelectedPaymentMethod:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};class A extends((0,S.StaticIntervalPollingController)()){constructor({messenger:e,state:t,subscriptionService:n,pollingInterval:i=P.DEFAULT_POLLING_INTERVAL}){super({name:P.controllerName,metadata:_,state:{subscriptions:[],trialedProducts:[],...t},messenger:e}),s.add(this),a.set(this,void 0),this.setIntervalLength(i),w(this,a,n,"f"),T(this,s,"m",r).call(this)}async getPricing(){const e=await T(this,a,"f").getPricing();return this.update(t=>{t.pricing=e}),e}async getSubscriptions(){const e=this.state.subscriptions,t=this.state.trialedProducts,n=this.state.customerId,r=this.state.lastSubscription,i=this.state.rewardAccountId,{customerId:o,subscriptions:c,trialedProducts:u,lastSubscription:l,rewardAccountId:d}=await T(this,a,"f").getSubscriptions(),f=T(this,s,"m",g).call(this,e,c),h=T(this,s,"m",p).call(this,t,u),m=T(this,s,"m",b).call(this,r,l);return f&&m&&h&&n===o&&i===d||(this.update(e=>{e.subscriptions=c,e.customerId=o,e.trialedProducts=u,e.lastSubscription=l,e.rewardAccountId=d}),this.triggerAccessTokenRefresh()),c}getSubscriptionByProduct(e){return this.state.subscriptions.find(t=>t.products.some(t=>t.name===e))}async getSubscriptionsEligibilities(e){return await T(this,a,"f").getSubscriptionsEligibilities(e)}async cancelSubscription(e){T(this,s,"m",d).call(this,{subscriptionId:e.subscriptionId});const t=await T(this,a,"f").cancelSubscription(e);this.update(n=>{n.subscriptions=n.subscriptions.map(n=>n.id===e.subscriptionId?{...n,...t}:n)}),this.triggerAccessTokenRefresh()}async unCancelSubscription(e){T(this,s,"m",d).call(this,{subscriptionId:e.subscriptionId});const t=await T(this,a,"f").unCancelSubscription({subscriptionId:e.subscriptionId});this.update(n=>{n.subscriptions=n.subscriptions.map(n=>n.id===e.subscriptionId?{...n,...t}:n)}),this.triggerAccessTokenRefresh()}async startShieldSubscriptionWithCard(e){T(this,s,"m",l).call(this,{products:e.products});return await T(this,a,"f").startSubscriptionWithCard(e)}async startSubscriptionWithCrypto(e){T(this,s,"m",l).call(this,{products:e.products});return await T(this,a,"f").startSubscriptionWithCrypto(e)}async submitShieldSubscriptionCryptoApproval(e,t,n){if(e.type!==E.TransactionType.shieldSubscriptionApprove)return;const{chainId:a,rawTx:r}=e;if(!a||!r)throw new Error("Chain ID or raw transaction not found");const{pricing:i,trialedProducts:o,lastSelectedPaymentMethod:l}=this.state;if(!i)throw new Error("Subscription pricing not found");if(!l)throw new Error("Last selected payment method not found");const d=l[v.PRODUCT_TYPES.SHIELD];T(this,s,"m",f).call(this,d);const h=T(this,s,"m",c).call(this,v.PRODUCT_TYPES.SHIELD,d.plan),m=o?.includes(v.PRODUCT_TYPES.SHIELD);await this.getSubscriptions();const p=this.state.subscriptions.find(e=>e.products.some(e=>e.name===v.PRODUCT_TYPES.SHIELD));T(this,s,"m",u).call(this,{productType:v.PRODUCT_TYPES.SHIELD});if(Boolean(p))await this.updatePaymentMethod({paymentType:v.PAYMENT_TYPES.byCrypto,subscriptionId:p.id,chainId:a,payerAddress:e.txParams.from,tokenSymbol:d.paymentTokenSymbol,rawTransaction:r,recurringInterval:h.interval,billingCycles:h.minBillingCycles});else{const s={products:[v.PRODUCT_TYPES.SHIELD],isTrialRequested:!m,recurringInterval:h.interval,billingCycles:h.minBillingCycles,chainId:a,payerAddress:e.txParams.from,tokenSymbol:d.paymentTokenSymbol,rawTransaction:r,isSponsored:t,useTestClock:d.useTestClock,rewardAccountId:n};await this.startSubscriptionWithCrypto(s)}await this.getSubscriptions()}getCryptoApproveTransactionParams(e){const{pricing:t}=this.state;if(!t)throw new Error("Subscription pricing not found");const n=t.products.find(t=>t.name===e.productType);if(!n)throw new Error("Product price not found");const s=n.prices.find(t=>t.interval===e.interval);if(!s)throw new Error("Price not found");const a=t.paymentMethods.find(e=>e.type===v.PAYMENT_TYPES.byCrypto);if(!a)throw new Error("Chains payment info not found");const r=a.chains?.find(t=>t.chainId===e.chainId);if(!r)throw new Error("Invalid chain id");const i=r.tokens.find(t=>t.address===e.paymentTokenAddress);if(!i)throw new Error("Invalid token address");return{approveAmount:this.getTokenApproveAmount(s,i),paymentAddress:r.paymentAddress,paymentTokenAddress:e.paymentTokenAddress,chainId:e.chainId}}async updatePaymentMethod(e){if(e.paymentType===v.PAYMENT_TYPES.byCard){const{paymentType:t,...n}=e;return await T(this,a,"f").updatePaymentMethodCard(n)}if(e.paymentType===v.PAYMENT_TYPES.byCrypto){const{paymentType:t,...n}=e;return await T(this,a,"f").updatePaymentMethodCrypto(n),await this.getSubscriptions()}throw new Error("Invalid payment type")}async getBillingPortalUrl(){return await T(this,a,"f").getBillingPortalUrl()}cacheLastSelectedPaymentMethod(e,t){if(!(t.type!==v.PAYMENT_TYPES.byCrypto||t.paymentTokenAddress&&t.paymentTokenSymbol))throw new Error(P.SubscriptionControllerErrorMessage.PaymentTokenAddressAndSymbolRequiredForCrypto);this.update(n=>{n.lastSelectedPaymentMethod={...n.lastSelectedPaymentMethod,[e]:t}})}clearLastSelectedPaymentMethod(e){this.update(t=>{if(t.lastSelectedPaymentMethod){const{[e]:n,...s}=t.lastSelectedPaymentMethod;t.lastSelectedPaymentMethod=s}})}async submitSponsorshipIntents(e){if(0===e.products.length)throw new Error(P.SubscriptionControllerErrorMessage.SubscriptionProductsEmpty);T(this,s,"m",l).call(this,{products:e.products});const t=this.state.lastSelectedPaymentMethod?.[e.products[0]];T(this,s,"m",f).call(this,t);if(!T(this,s,"m",h).call(this,e.chainId,e.products))return!1;const{paymentTokenSymbol:n,plan:r}=t,i=T(this,s,"m",c).call(this,e.products[0],r).minBillingCycles;return await T(this,a,"f").submitSponsorshipIntents({...e,paymentTokenSymbol:n,billingCycles:i,recurringInterval:r}),!0}async submitUserEvent(e){await T(this,a,"f").submitUserEvent(e)}async assignUserToCohort(e){await T(this,a,"f").assignUserToCohort(e)}async linkRewards(e){T(this,s,"m",d).call(this,{subscriptionId:e.subscriptionId});if(!(await T(this,a,"f").linkRewards({rewardAccountId:e.rewardAccountId})).success)throw new Error(P.SubscriptionControllerErrorMessage.LinkRewardsFailed)}async _executePoll(){await this.getSubscriptions()}getTokenApproveAmount(e,t){const n=t.conversionRate[e.currency];if(!n)throw new Error("Conversion rate not found");const a=new k.BigNumber(T(this,s,"m",i).call(this,e)),r=new k.BigNumber(10).pow(t.decimals);return a.multipliedBy(r).div(n).toFixed(0)}getTokenMinimumBalanceAmount(e,t){const n=t.conversionRate[e.currency];if(!n)throw new Error("Conversion rate not found");const a=new k.BigNumber(T(this,s,"m",o).call(this,e)),r=new k.BigNumber(10).pow(t.decimals);return a.multipliedBy(r).div(n).toFixed(0)}clearState(){const e={subscriptions:[],trialedProducts:[]};this.update(()=>e)}triggerAccessTokenRefresh(){this.messenger.call("AuthenticationController:performSignOut")}}n.SubscriptionController=A,a=new WeakMap,s=new WeakSet,r=function(){this.messenger.registerActionHandler("SubscriptionController:getSubscriptions",this.getSubscriptions.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getSubscriptionByProduct",this.getSubscriptionByProduct.bind(this)),this.messenger.registerActionHandler("SubscriptionController:cancelSubscription",this.cancelSubscription.bind(this)),this.messenger.registerActionHandler("SubscriptionController:startShieldSubscriptionWithCard",this.startShieldSubscriptionWithCard.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getPricing",this.getPricing.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getCryptoApproveTransactionParams",this.getCryptoApproveTransactionParams.bind(this)),this.messenger.registerActionHandler("SubscriptionController:startSubscriptionWithCrypto",this.startSubscriptionWithCrypto.bind(this)),this.messenger.registerActionHandler("SubscriptionController:updatePaymentMethod",this.updatePaymentMethod.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getBillingPortalUrl",this.getBillingPortalUrl.bind(this)),this.messenger.registerActionHandler(`${P.controllerName}:submitSponsorshipIntents`,this.submitSponsorshipIntents.bind(this)),this.messenger.registerActionHandler(`${P.controllerName}:submitShieldSubscriptionCryptoApproval`,this.submitShieldSubscriptionCryptoApproval.bind(this)),this.messenger.registerActionHandler(`${P.controllerName}:linkRewards`,this.linkRewards.bind(this)),this.messenger.registerActionHandler(`${P.controllerName}:cacheLastSelectedPaymentMethod`,this.cacheLastSelectedPaymentMethod.bind(this)),this.messenger.registerActionHandler(`${P.controllerName}:clearLastSelectedPaymentMethod`,this.clearLastSelectedPaymentMethod.bind(this))},i=function(e){return new k.BigNumber(e.unitAmount).div(10**e.unitDecimals).multipliedBy(e.minBillingCycles).toString()},o=function(e){return new k.BigNumber(e.unitAmount).div(10**e.unitDecimals).multipliedBy(e.minBillingCyclesForBalance).toString()},c=function(e,t){const{pricing:n}=this.state,s=n?.products.find(t=>t.name===e),a=s?.prices.find(e=>e.interval===t);if(!a)throw new Error(P.SubscriptionControllerErrorMessage.ProductPriceNotFound);return a},u=function({productType:e}){const t=this.state.subscriptions.find(t=>t.products.some(t=>t.name===e));if(!(!t||[v.SUBSCRIPTION_STATUSES.pastDue,v.SUBSCRIPTION_STATUSES.unpaid,v.SUBSCRIPTION_STATUSES.paused,v.SUBSCRIPTION_STATUSES.provisional,v.SUBSCRIPTION_STATUSES.active,v.SUBSCRIPTION_STATUSES.trialing].includes(t.status)))throw new Error(P.SubscriptionControllerErrorMessage.SubscriptionNotValidForCryptoApproval)},l=function({products:e}){const t=this.state.subscriptions.find(t=>t.products.some(t=>e.includes(t.name)));if(t&&P.ACTIVE_SUBSCRIPTION_STATUSES.includes(t.status))throw new Error(P.SubscriptionControllerErrorMessage.UserAlreadySubscribed)},d=function(e){if(!this.state.subscriptions.find(t=>t.id===e.subscriptionId))throw new Error(P.SubscriptionControllerErrorMessage.UserNotSubscribed)},f=function(e){if(!e||e.type!==v.PAYMENT_TYPES.byCrypto||!e.paymentTokenAddress||!e.paymentTokenSymbol)throw new Error(P.SubscriptionControllerErrorMessage.PaymentMethodNotCrypto)},h=function(e,t){const n=T(this,s,"m",m).call(this,e),a=this.state.trialedProducts.some(e=>t.includes(e));return n&&!a},m=function(e){const t=this.state.pricing?.paymentMethods.find(e=>e.type===v.PAYMENT_TYPES.byCrypto),n=t?.chains?.find(t=>t.chainId===e)?.isSponsorshipSupported;return Boolean(n)},p=function(e,t){return e.length===t?.length&&e.every(e=>t?.includes(e))},g=function(e,t){if(e.length!==t.length)return!1;const n=[...e].sort((e,t)=>e.id.localeCompare(t.id)),a=[...t].sort((e,t)=>e.id.localeCompare(t.id));return n.every((e,t)=>{const n=a[t];return T(this,s,"m",b).call(this,e,n)})},b=function(e,t){return e&&t?T(this,s,"m",y).call(this,e)===T(this,s,"m",y).call(this,t):!e&&!t},y=function(e){const t={...e,products:[...e.products].sort((e,t)=>e.name.localeCompare(t.name))};return JSON.stringify(t)}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/SubscriptionController.cjs"}],[3408,{"./constants.cjs":3409,"./errors.cjs":3410,"@metamask/controller-utils":1639},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionService=n.SUBSCRIPTION_URL=void 0;const u=e("@metamask/controller-utils"),l=e("./constants.cjs"),d=e("./errors.cjs");n.SUBSCRIPTION_URL=(e,t)=>`${(0,l.getEnvUrls)(e).subscriptionApiUrl}/v1/${t}`;n.SubscriptionService=class{constructor(e){s.add(this),a.set(this,void 0),o(this,a,e.env,"f"),this.authUtils=e.auth}async getSubscriptions(){return await c(this,s,"m",r).call(this,"subscriptions")}async cancelSubscription(e){const t=`subscriptions/${e.subscriptionId}/cancel`;return await c(this,s,"m",r).call(this,t,"POST",{cancelAtPeriodEnd:e.cancelAtPeriodEnd})}async unCancelSubscription(e){const t=`subscriptions/${e.subscriptionId}/uncancel`;return await c(this,s,"m",r).call(this,t,"POST",{})}async startSubscriptionWithCard(e){if(0===e.products.length)throw new d.SubscriptionServiceError(l.SubscriptionControllerErrorMessage.SubscriptionProductsEmpty);return await c(this,s,"m",r).call(this,"subscriptions/card","POST",e)}async startSubscriptionWithCrypto(e){return await c(this,s,"m",r).call(this,"subscriptions/crypto","POST",e)}async updatePaymentMethodCard(e){const t=`subscriptions/${e.subscriptionId}/payment-method/card`;return await c(this,s,"m",r).call(this,t,"PATCH",{...e,subscriptionId:undefined})}async updatePaymentMethodCrypto(e){const t=`subscriptions/${e.subscriptionId}/payment-method/crypto`;await c(this,s,"m",r).call(this,t,"PATCH",{...e,subscriptionId:undefined})}async getSubscriptionsEligibilities(e){let t;e?.balanceCategory!==undefined&&(t={balanceCategory:e.balanceCategory});return(await c(this,s,"m",r).call(this,"subscriptions/eligibility","GET",undefined,t)).map(e=>({...e,canSubscribe:e.canSubscribe||!1,canViewEntryModal:e.canViewEntryModal||!1,cohorts:e.cohorts||[],assignedCohort:e.assignedCohort??null,hasAssignedCohortExpired:e.hasAssignedCohortExpired||!1}))}async submitUserEvent(e){await c(this,s,"m",r).call(this,"user-events","POST",e)}async assignUserToCohort(e){await c(this,s,"m",r).call(this,"cohorts/assign","POST",e)}async submitSponsorshipIntents(e){await c(this,s,"m",r).call(this,"transaction-sponsorship/intents","POST",e)}async linkRewards(e){return await c(this,s,"m",r).call(this,"rewards/link","POST",e)}async getPricing(){return await c(this,s,"m",r).call(this,"pricing")}async getBillingPortalUrl(){return await c(this,s,"m",r).call(this,"billing-portal")}},a=new WeakMap,s=new WeakSet,r=async function(e,t="GET",r,o){try{const l=await c(this,s,"m",i).call(this),d=new URL((0,n.SUBSCRIPTION_URL)(c(this,a,"f"),e));o&&Object.entries(o).forEach(([e,t])=>{d.searchParams.append(e,t)});return await(0,u.handleFetch)(d.toString(),{method:t,headers:{"Content-Type":"application/json",...l},body:r?JSON.stringify(r):undefined})}catch(e){const t=e instanceof Error?e.message:JSON.stringify(e);throw new d.SubscriptionServiceError(`failed to make request. ${t}`)}},i=async function(){return{Authorization:`Bearer ${await this.authUtils.getAccessToken()}`}}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/SubscriptionService.cjs"}],[3409,{"./types.cjs":3412},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ACTIVE_SUBSCRIPTION_STATUSES=n.DEFAULT_POLLING_INTERVAL=n.SubscriptionControllerErrorMessage=n.getEnvUrls=n.Env=n.controllerName=void 0;const s=e("./types.cjs");var a;n.controllerName="SubscriptionController",function(e){e.DEV="dev",e.UAT="uat",e.PRD="prd"}(a||(n.Env=a={}));const r={dev:{subscriptionApiUrl:"https://subscription.dev-api.cx.metamask.io"},uat:{subscriptionApiUrl:"https://subscription.uat-api.cx.metamask.io"},prd:{subscriptionApiUrl:"https://subscription.api.cx.metamask.io"}};var i;n.getEnvUrls=function(e){if(!r[e])throw new Error("invalid environment configuration");return r[e]},function(e){e.UserAlreadySubscribed="SubscriptionController - User is already subscribed",e.UserNotSubscribed="SubscriptionController - User is not subscribed",e.SubscriptionProductsEmpty="SubscriptionController - Subscription products array cannot be empty",e.PaymentTokenAddressAndSymbolRequiredForCrypto="SubscriptionController - Payment token address and symbol are required for crypto payment",e.PaymentMethodNotCrypto="SubscriptionController - Payment method is not crypto",e.ProductPriceNotFound="SubscriptionController - Product price not found",e.SubscriptionNotValidForCryptoApproval="SubscriptionController - Subscription is not valid for crypto approval",e.LinkRewardsFailed="SubscriptionController - Failed to link rewards"}(i||(n.SubscriptionControllerErrorMessage=i={})),n.DEFAULT_POLLING_INTERVAL=3e5,n.ACTIVE_SUBSCRIPTION_STATUSES=[s.SUBSCRIPTION_STATUSES.active,s.SUBSCRIPTION_STATUSES.trialing,s.SUBSCRIPTION_STATUSES.provisional]}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/constants.cjs"}],[3410,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionServiceError=void 0;class s extends Error{constructor(e){super(e),this.name="SubscriptionServiceError"}}n.SubscriptionServiceError=s}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/errors.cjs"}],[3411,{"./SubscriptionController.cjs":3407,"./SubscriptionService.cjs":3408,"./constants.cjs":3409,"./errors.cjs":3410,"./types.cjs":3412},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionService=n.SubscriptionControllerErrorMessage=n.Env=n.SubscriptionServiceError=n.MODAL_TYPE=n.BALANCE_CATEGORIES=n.COHORT_NAMES=n.SubscriptionUserEvent=n.PAYMENT_TYPES=n.RECURRING_INTERVALS=n.PRODUCT_TYPES=n.SUBSCRIPTION_STATUSES=n.CRYPTO_PAYMENT_METHOD_ERRORS=n.CANCEL_TYPES=n.getDefaultSubscriptionControllerState=n.SubscriptionController=void 0;var s=e("./SubscriptionController.cjs");Object.defineProperty(n,"SubscriptionController",{enumerable:!0,get:function(){return s.SubscriptionController}}),Object.defineProperty(n,"getDefaultSubscriptionControllerState",{enumerable:!0,get:function(){return s.getDefaultSubscriptionControllerState}});var a=e("./types.cjs");Object.defineProperty(n,"CANCEL_TYPES",{enumerable:!0,get:function(){return a.CANCEL_TYPES}}),Object.defineProperty(n,"CRYPTO_PAYMENT_METHOD_ERRORS",{enumerable:!0,get:function(){return a.CRYPTO_PAYMENT_METHOD_ERRORS}}),Object.defineProperty(n,"SUBSCRIPTION_STATUSES",{enumerable:!0,get:function(){return a.SUBSCRIPTION_STATUSES}}),Object.defineProperty(n,"PRODUCT_TYPES",{enumerable:!0,get:function(){return a.PRODUCT_TYPES}}),Object.defineProperty(n,"RECURRING_INTERVALS",{enumerable:!0,get:function(){return a.RECURRING_INTERVALS}}),Object.defineProperty(n,"PAYMENT_TYPES",{enumerable:!0,get:function(){return a.PAYMENT_TYPES}}),Object.defineProperty(n,"SubscriptionUserEvent",{enumerable:!0,get:function(){return a.SubscriptionUserEvent}}),Object.defineProperty(n,"COHORT_NAMES",{enumerable:!0,get:function(){return a.COHORT_NAMES}}),Object.defineProperty(n,"BALANCE_CATEGORIES",{enumerable:!0,get:function(){return a.BALANCE_CATEGORIES}}),Object.defineProperty(n,"MODAL_TYPE",{enumerable:!0,get:function(){return a.MODAL_TYPE}});var r=e("./errors.cjs");Object.defineProperty(n,"SubscriptionServiceError",{enumerable:!0,get:function(){return r.SubscriptionServiceError}});var i=e("./constants.cjs");Object.defineProperty(n,"Env",{enumerable:!0,get:function(){return i.Env}}),Object.defineProperty(n,"SubscriptionControllerErrorMessage",{enumerable:!0,get:function(){return i.SubscriptionControllerErrorMessage}});var o=e("./SubscriptionService.cjs");Object.defineProperty(n,"SubscriptionService",{enumerable:!0,get:function(){return o.SubscriptionService}})}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/index.cjs"}],[3412,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionUserEvent=n.BALANCE_CATEGORIES=n.COHORT_NAMES=n.MODAL_TYPE=n.CRYPTO_PAYMENT_METHOD_ERRORS=n.CANCEL_TYPES=n.SUBSCRIPTION_STATUSES=n.RECURRING_INTERVALS=n.PAYMENT_TYPES=n.PRODUCT_TYPES=void 0,n.PRODUCT_TYPES={SHIELD:"shield"},n.PAYMENT_TYPES={byCard:"card",byCrypto:"crypto"},n.RECURRING_INTERVALS={month:"month",year:"year"},n.SUBSCRIPTION_STATUSES={incomplete:"incomplete",incompleteExpired:"incomplete_expired",provisional:"provisional",trialing:"trialing",active:"active",pastDue:"past_due",unpaid:"unpaid",canceled:"canceled",paused:"paused"},n.CANCEL_TYPES={ALLOWED_IMMEDIATE:"allowed_immediate",ALLOWED_AT_PERIOD_END:"allowed_at_period_end",NOT_ALLOWED:"not_allowed",NOT_ALLOWED_PENDING_VERIFICATION:"not_allowed_pending_verification"},n.CRYPTO_PAYMENT_METHOD_ERRORS={APPROVAL_TRANSACTION_TOO_OLD:"approval_transaction_too_old",APPROVAL_TRANSACTION_REVERTED:"approval_transaction_reverted",APPROVAL_TRANSACTION_MAX_VERIFICATION_ATTEMPTS_REACHED:"approval_transaction_max_verification_attempts_reached",INSUFFICIENT_BALANCE:"insufficient_balance",INSUFFICIENT_ALLOWANCE:"insufficient_allowance"},n.MODAL_TYPE={A:"A",B:"B"},n.COHORT_NAMES={POST_TX:"post_tx",WALLET_HOME:"wallet_home"},n.BALANCE_CATEGORIES={RANGE_0_99:"0-99",RANGE_100_999:"100-999",RANGE_1K_9_9K:"1k-9.9k",RANGE_10K_99_9K:"10k-99.9k",RANGE_100K_999_9K:"100k-999.9k",RANGE_1M_PLUS:"1M+"},n.SubscriptionUserEvent={ShieldEntryModalViewed:"shield_entry_modal_viewed",ShieldCohortAssigned:"shield_cohort_assigned"}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/types.cjs"}],[3413,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,r=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,h=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,s=1,a=e.length,r=e[0]+"";s<a;){for(t=e[s++]+"",n=u-t.length;n--;t="0"+t);r+=t}for(a=r.length;48===r.charCodeAt(--a););return r.slice(0,a+1||1)}function g(e,t){var n,s,a=e.c,r=t.c,i=e.s,o=t.s,c=e.e,u=t.e;if(!i||!o)return null;if(n=a&&!a[0],s=r&&!r[0],n||s)return n?s?0:-o:i;if(i!=o)return i;if(n=i<0,s=c==u,!a||!r)return s?0:!a^n?1:-1;if(!s)return c>u^n?1:-1;for(o=(c=a.length)<(u=r.length)?c:u,i=0;i<o;i++)if(a[i]!=r[i])return a[i]>r[i]^n?1:-1;return c==u?0:c>u^n?1:-1}function b(e,t,n,s){if(e<t||e>n||e!==r(e))throw Error(i+(s||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function y(e){var t=e.c.length-1;return m(e.e/u)==t&&e.c[t]%2!=0}function w(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function T(e,t,n){var s,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(s=e.length)){for(a=n,t-=s;--t;a+=n);e+=a}else t<s&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,S,E,k,P,v,I,_,A,C,j=q.prototype={constructor:q,toString:null,valueOf:null},x=new q(1),R=20,O=4,F=-7,N=21,M=-1e7,L=1e7,G=!1,D=1,B=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",$=!0;function q(e,t){var n,a,i,c,d,f,h,m,p=this;if(!(p instanceof q))return new q(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>L?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>L?p.c=p.e=null:(p.e=c,p.c=[e]))}m=String(e)}else{if(!s.test(m=String(e)))return E(p,m,f);p.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(b(t,2,H.length,"Base"),10==t&&$)return V(p=new q(e),R+p.e+1,O);if(m=String(e),f="number"==typeof e){if(0*e!=0)return E(p,m,f,t);if(p.s=1/e<0?(m=m.slice(1),-1):1,q.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,h=m.length;d<h;d++)if(n.indexOf(a=m.charAt(d))<0){if("."==a){if(d>c){c=h;continue}}else if(!i&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){i=!0,d=-1,c=0;continue}return E(p,String(e),f,t)}f=!1,(c=(m=S(m,t,10,p.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(h=m.length;48===m.charCodeAt(--h););if(m=m.slice(d,++h)){if(h-=d,f&&q.DEBUG&&h>15&&(e>l||e!==r(e)))throw Error(o+p.s*e);if((c=c-d-1)>L)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%u,c<0&&(d+=u),d<h){for(d&&p.c.push(+m.slice(0,d)),h-=u;d<h;)p.c.push(+m.slice(d,d+=u));d=u-(m=m.slice(d)).length}else d-=h;for(;d--;m+="0");p.c.push(+m)}}else p.c=[p.e=0]}function K(e,t,n,s){var a,r,i,o,c;if(null==n?n=O:b(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=p(e.c),c=1==s||2==s&&(i<=F||i>=N)?w(c,i):T(c,i,"0");else if(r=(e=V(new q(e),t,n)).e,o=(c=p(e.c)).length,1==s||2==s&&(t<=r||r<=F)){for(;o<t;c+="0",o++);c=w(c,r)}else if(t-=i,c=T(c,r,"0"),r+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=r-o)>0)for(r+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function W(e,t){for(var n,s,a=1,r=new q(e[0]);a<e.length;a++)(!(s=new q(e[a])).s||(n=g(r,s))===t||0===n&&r.s===t)&&(r=s);return r}function z(e,t,n){for(var s=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,s++);return(n=s+n*u-1)>L?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function V(e,t,n,s){var i,o,l,f,h,m,p,g=e.c,b=d;if(g){e:{for(i=1,f=g[0];f>=10;f/=10,i++);if((o=t-i)<0)o+=u,l=t,h=g[m=0],p=r(h/b[i-l-1]%10);else if((m=a((o+1)/u))>=g.length){if(!s)break e;for(;g.length<=m;g.push(0));h=p=0,i=1,l=(o%=u)-u+1}else{for(h=f=g[m],i=1;f>=10;f/=10,i++);p=(l=(o%=u)-u+i)<0?0:r(h/b[i-l-1]%10)}if(s=s||t<0||null!=g[m+1]||(l<0?h:h%b[i-l-1]),s=n<4?(p||s)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||s||6==n&&(o>0?l>0?h/b[i-l]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,s?(t-=e.e+1,g[0]=b[(u-t%u)%u],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,f=1,m--):(g.length=m+1,f=b[u-o],g[m]=l>0?r(h/b[i-l]%b[l])*f:0),s)for(;;){if(0==m){for(o=1,l=g[0];l>=10;l/=10,o++);for(l=g[0]+=f,f=1;l>=10;l/=10,f++);o!=f&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=f,g[m]!=c)break;g[m--]=0,f=1}for(o=g.length;0===g[--o];g.pop());}e.e>L?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function J(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=F||n>=N?w(t,n):T(t,n,"0"),e.s<0?"-"+t:t)}return q.clone=e,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(b(n=e[t],0,h,t),R=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(b(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(b(n[0],-h,0,t),b(n[1],0,h,t),F=n[0],N=n[1]):(b(n,-h,h,t),F=-(N=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)b(n[0],-h,-1,t),b(n[1],1,h,t),M=n[0],L=n[1];else{if(b(n,-h,h,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(L=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw G=!n,Error(i+"crypto unavailable");G=n}else G=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(b(n=e[t],0,9,t),D=n),e.hasOwnProperty(t="POW_PRECISION")&&(b(n=e[t],0,h,t),B=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);$="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:R,ROUNDING_MODE:O,EXPONENTIAL_AT:[F,N],RANGE:[M,L],CRYPTO:G,MODULO_MODE:D,POW_PRECISION:B,FORMAT:U,ALPHABET:H}},q.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!q.DEBUG)return!0;var t,n,s=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(s)){if((1===o||-1===o)&&a>=-h&&a<=h&&a===r(a)){if(0===s[0]){if(0===a&&1===s.length)return!0;break e}if((t=(a+1)%u)<1&&(t+=u),String(s[0]).length==t){for(t=0;t<s.length;t++)if((n=s[t])<0||n>=c||n!==r(n))break e;if(0!==n)return!0}}}else if(null===s&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},q.maximum=q.max=function(){return W(arguments,-1)},q.minimum=q.min=function(){return W(arguments,1)},q.random=(k=9007199254740992,P=Math.random()*k&2097151?function(){return r(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,s,o,c,l=0,f=[],m=new q(x);if(null==e?e=R:b(e,0,h),o=a(e/u),G)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));l<o;)(c=131072*t[l]+(t[l+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[l]=n[0],t[l+1]=n[1]):(f.push(c%1e14),l+=2);l=o/2}else{if(!crypto.randomBytes)throw G=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);l<o;)(c=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(f.push(c%1e14),l+=7);l=o/7}if(!G)for(;l<o;)(c=P())<9e15&&(f[l++]=c%1e14);for(o=f[--l],e%=u,o&&e&&(c=d[u-e],f[l]=r(o/c)*c);0===f[l];f.pop(),l--);if(l<0)f=[s=0];else{for(s=-1;0===f[0];f.splice(0,1),s-=u);for(l=1,c=f[0];c>=10;c/=10,l++);l<u&&(s-=u-l)}return m.e=s,m.c=f,m}),q.sum=function(){for(var e=1,t=arguments,n=new q(t[0]);e<t.length;)n=n.plus(t[e++]);return n},S=function(){var e="0123456789";function t(e,t,n,s){for(var a,r,i=[0],o=0,c=e.length;o<c;){for(r=i.length;r--;i[r]*=t);for(i[0]+=s.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(s,a,r,i,o){var c,u,l,d,f,h,m,g,b=s.indexOf("."),y=R,w=O;for(b>=0&&(d=B,B=0,s=s.replace(".",""),h=(g=new q(a)).pow(s.length-b),B=d,g.c=t(T(p(h.c),h.e,"0"),10,r,e),g.e=g.c.length),l=d=(m=t(s,a,r,o?(c=H,e):(c=e,H))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(b<0?--l:(h.c=m,h.e=l,h.s=i,m=(h=n(h,g,y,w,r)).c,f=h.r,l=h.e),b=m[u=l+y+1],d=r/2,f=f||u<0||null!=m[u+1],f=w<4?(null!=b||f)&&(0==w||w==(h.s<0?3:2)):b>d||b==d&&(4==w||f||6==w&&1&m[u-1]||w==(h.s<0?8:7)),u<1||!m[0])s=f?T(c.charAt(1),-y,c.charAt(0)):c.charAt(0);else{if(m.length=u,f)for(--r;++m[--u]>r;)m[u]=0,u||(++l,m=[1].concat(m));for(d=m.length;!m[--d];);for(b=0,s="";b<=d;s+=c.charAt(m[b++]));s=T(s,l,c.charAt(0))}return s}}(),n=function(){function e(e,t,n){var s,a,r,i,o=0,c=e.length,u=t%f,l=t/f|0;for(e=e.slice();c--;)o=((a=u*(r=e[c]%f)+(s=l*r+(i=e[c]/f|0)*u)%f*f+o)/n|0)+(s/f|0)+l*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,s){var a,r;if(n!=s)r=n>s?1:-1;else for(a=r=0;a<n;a++)if(e[a]!=t[a]){r=e[a]>t[a]?1:-1;break}return r}function n(e,t,n,s){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*s+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(s,a,i,o,l){var d,f,h,p,g,b,y,w,T,S,E,k,P,v,I,_,A,C=s.s==a.s?1:-1,j=s.c,x=a.c;if(!(j&&j[0]&&x&&x[0]))return new q(s.s&&a.s&&(j?!x||j[0]!=x[0]:x)?j&&0==j[0]||!x?0*C:C/0:NaN);for(T=(w=new q(C)).c=[],C=i+(f=s.e-a.e)+1,l||(l=c,f=m(s.e/u)-m(a.e/u),C=C/u|0),h=0;x[h]==(j[h]||0);h++);if(x[h]>(j[h]||0)&&f--,C<0)T.push(1),p=!0;else{for(v=j.length,_=x.length,h=0,C+=2,(g=r(l/(x[0]+1)))>1&&(x=e(x,g,l),j=e(j,g,l),_=x.length,v=j.length),P=_,E=(S=j.slice(0,_)).length;E<_;S[E++]=0);A=x.slice(),A=[0].concat(A),I=x[0],x[1]>=l/2&&I++;do{if(g=0,(d=t(x,S,_,E))<0){if(k=S[0],_!=E&&(k=k*l+(S[1]||0)),(g=r(k/I))>1)for(g>=l&&(g=l-1),y=(b=e(x,g,l)).length,E=S.length;1==t(b,S,y,E);)g--,n(b,_<y?A:x,y,l),y=b.length,d=1;else 0==g&&(d=g=1),y=(b=x.slice()).length;if(y<E&&(b=[0].concat(b)),n(S,b,E,l),E=S.length,-1==d)for(;t(x,S,_,E)<1;)g++,n(S,_<E?A:x,E,l),E=S.length}else 0===d&&(g++,S=[0]);T[h++]=g,S[0]?S[E++]=j[P]||0:(S=[j[P]],E=1)}while((P++<v||null!=S[0])&&C--);p=null!=S[0],T[0]||T.splice(0,1)}if(l==c){for(h=1,C=T[0];C>=10;C/=10,h++);V(w,i+(w.e=h+f*u-1)+1,o,p)}else w.e=f,w.r=+p;return w}}(),v=/^(-?)0([xbo])(?=\w[\w.]*$)/i,I=/^([^.]+)\.$/,_=/^\.([^.]+)$/,A=/^-?(Infinity|NaN)$/,C=/^\s*\+(?=[\w.])|^\s+|\s+$/g,E=function(e,t,n,s){var a,r=n?t:t.replace(C,"");if(A.test(r))e.s=isNaN(r)?null:r<0?-1:1;else{if(!n&&(r=r.replace(v,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,s&&s!=a?e:t}),s&&(a=s,r=r.replace(I,"$1").replace(_,"0.$1")),t!=r))return new q(r,a);if(q.DEBUG)throw Error(i+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},j.absoluteValue=j.abs=function(){var e=new q(this);return e.s<0&&(e.s=1),e},j.comparedTo=function(e,t){return g(this,new q(e,t))},j.decimalPlaces=j.dp=function(e,t){var n,s,a,r=this;if(null!=e)return b(e,0,h),null==t?t=O:b(t,0,8),V(new q(r),e+r.e+1,t);if(!(n=r.c))return null;if(s=((a=n.length-1)-m(this.e/u))*u,a=n[a])for(;a%10==0;a/=10,s--);return s<0&&(s=0),s},j.dividedBy=j.div=function(e,t){return n(this,new q(e,t),R,O)},j.dividedToIntegerBy=j.idiv=function(e,t){return n(this,new q(e,t),0,1)},j.exponentiatedBy=j.pow=function(e,t){var n,s,o,c,l,d,f,h,m=this;if((e=new q(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+J(e));if(null!=t&&(t=new q(t)),l=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return h=new q(Math.pow(+J(m),l?e.s*(2-y(e)):+J(e))),t?h.mod(t):h;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new q(NaN);(s=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||l&&m.c[1]>=24e7:m.c[0]<8e13||l&&m.c[0]<=9999975e7)))return c=m.s<0&&y(e)?-0:0,m.e>-1&&(c=1/c),new q(d?1/c:c);B&&(c=a(B/u+2))}for(l?(n=new q(.5),d&&(e.s=1),f=y(e)):f=(o=Math.abs(+J(e)))%2,h=new q(x);;){if(f){if(!(h=h.times(m)).c)break;c?h.c.length>c&&(h.c.length=c):s&&(h=h.mod(t))}if(o){if(0===(o=r(o/2)))break;f=o%2}else if(V(e=e.times(n),e.e+1,1),e.e>14)f=y(e);else{if(0===(o=+J(e)))break;f=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):s&&(m=m.mod(t))}return s?h:(d&&(h=x.div(h)),t?h.mod(t):c?V(h,B,O,undefined):h)},j.integerValue=function(e){var t=new q(this);return null==e?e=O:b(e,0,8),V(t,t.e+1,e)},j.isEqualTo=j.eq=function(e,t){return 0===g(this,new q(e,t))},j.isFinite=function(){return!!this.c},j.isGreaterThan=j.gt=function(e,t){return g(this,new q(e,t))>0},j.isGreaterThanOrEqualTo=j.gte=function(e,t){return 1===(t=g(this,new q(e,t)))||0===t},j.isInteger=function(){return!!this.c&&m(this.e/u)>this.c.length-2},j.isLessThan=j.lt=function(e,t){return g(this,new q(e,t))<0},j.isLessThanOrEqualTo=j.lte=function(e,t){return-1===(t=g(this,new q(e,t)))||0===t},j.isNaN=function(){return!this.s},j.isNegative=function(){return this.s<0},j.isPositive=function(){return this.s>0},j.isZero=function(){return!!this.c&&0==this.c[0]},j.minus=function(e,t){var n,s,a,r,i=this,o=i.s;if(t=(e=new q(e,t)).s,!o||!t)return new q(NaN);if(o!=t)return e.s=-t,i.plus(e);var l=i.e/u,d=e.e/u,f=i.c,h=e.c;if(!l||!d){if(!f||!h)return f?(e.s=-t,e):new q(h?i:NaN);if(!f[0]||!h[0])return h[0]?(e.s=-t,e):new q(f[0]?i:3==O?-0:0)}if(l=m(l),d=m(d),f=f.slice(),o=l-d){for((r=o<0)?(o=-o,a=f):(d=l,a=h),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(s=(r=(o=f.length)<(t=h.length))?o:t,o=t=0;t<s;t++)if(f[t]!=h[t]){r=f[t]<h[t];break}if(r&&(a=f,f=h,h=a,e.s=-e.s),(t=(s=h.length)-(n=f.length))>0)for(;t--;f[n++]=0);for(t=c-1;s>o;){if(f[--s]<h[s]){for(n=s;n&&!f[--n];f[n]=t);--f[n],f[s]+=c}f[s]-=h[s]}for(;0==f[0];f.splice(0,1),--d);return f[0]?z(e,f,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},j.modulo=j.mod=function(e,t){var s,a,r=this;return e=new q(e,t),!r.c||!e.s||e.c&&!e.c[0]?new q(NaN):!e.c||r.c&&!r.c[0]?new q(r):(9==D?(a=e.s,e.s=1,s=n(r,e,0,3),e.s=a,s.s*=a):s=n(r,e,0,D),(e=r.minus(s.times(e))).c[0]||1!=D||(e.s=r.s),e)},j.multipliedBy=j.times=function(e,t){var n,s,a,r,i,o,l,d,h,p,g,b,y,w,T,S=this,E=S.c,k=(e=new q(e,t)).c;if(!(E&&k&&E[0]&&k[0]))return!S.s||!e.s||E&&!E[0]&&!k||k&&!k[0]&&!E?e.c=e.e=e.s=null:(e.s*=S.s,E&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(s=m(S.e/u)+m(e.e/u),e.s*=S.s,(l=E.length)<(p=k.length)&&(y=E,E=k,k=y,a=l,l=p,p=a),a=l+p,y=[];a--;y.push(0));for(w=c,T=f,a=p;--a>=0;){for(n=0,g=k[a]%T,b=k[a]/T|0,r=a+(i=l);r>a;)n=((d=g*(d=E[--i]%T)+(o=b*d+(h=E[i]/T|0)*g)%T*T+y[r]+n)/w|0)+(o/T|0)+b*h,y[r--]=d%w;y[r]=n}return n?++s:y.splice(0,1),z(e,y,s)},j.negated=function(){var e=new q(this);return e.s=-e.s||null,e},j.plus=function(e,t){var n,s=this,a=s.s;if(t=(e=new q(e,t)).s,!a||!t)return new q(NaN);if(a!=t)return e.s=-t,s.minus(e);var r=s.e/u,i=e.e/u,o=s.c,l=e.c;if(!r||!i){if(!o||!l)return new q(a/0);if(!o[0]||!l[0])return l[0]?e:new q(o[0]?s:0*a)}if(r=m(r),i=m(i),o=o.slice(),a=r-i){for(a>0?(i=r,n=l):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=l.length)<0&&(n=l,l=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+l[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),z(e,o,i)},j.precision=j.sd=function(e,t){var n,s,a,r=this;if(null!=e&&e!==!!e)return b(e,1,h),null==t?t=O:b(t,0,8),V(new q(r),e,t);if(!(n=r.c))return null;if(s=(a=n.length-1)*u+1,a=n[a]){for(;a%10==0;a/=10,s--);for(a=n[0];a>=10;a/=10,s++);}return e&&r.e+1>s&&(s=r.e+1),s},j.shiftedBy=function(e){return b(e,-9007199254740991,l),this.times("1e"+e)},j.squareRoot=j.sqrt=function(){var e,t,s,a,r,i=this,o=i.c,c=i.s,u=i.e,l=R+4,d=new q("0.5");if(1!==c||!o||!o[0])return new q(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+J(i)))||c==1/0?(((t=p(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=m((u+1)/2)-(u<0||u%2),s=new q(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):s=new q(c+""),s.c[0])for((c=(u=s.e)+l)<3&&(c=0);;)if(r=s,s=d.times(r.plus(n(i,r,l,1))),p(r.c).slice(0,c)===(t=p(s.c)).slice(0,c)){if(s.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(V(s,s.e+R+2,1),e=!s.times(s).eq(i));break}if(!a&&(V(r,r.e+R+2,0),r.times(r).eq(i))){s=r;break}l+=4,c+=4,a=1}return V(s,s.e+R+1,O,e)},j.toExponential=function(e,t){return null!=e&&(b(e,0,h),e++),K(this,e,t,1)},j.toFixed=function(e,t){return null!=e&&(b(e,0,h),e=e+this.e+1),K(this,e,t)},j.toFormat=function(e,t,n){var s,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(s=a.toFixed(e,t),a.c){var r,o=s.split("."),c=+n.groupSize,u=+n.secondaryGroupSize,l=n.groupSeparator||"",d=o[0],f=o[1],h=a.s<0,m=h?d.slice(1):d,p=m.length;if(u&&(r=c,c=u,u=r,p-=r),c>0&&p>0){for(r=p%c||c,d=m.substr(0,r);r<p;r+=c)d+=l+m.substr(r,c);u>0&&(d+=l+m.slice(r)),h&&(d="-"+d)}s=f?d+(n.decimalSeparator||"")+((u=+n.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):f):d}return(n.prefix||"")+s+(n.suffix||"")},j.toFraction=function(e){var t,s,a,r,o,c,l,f,h,m,g,b,y=this,w=y.c;if(null!=e&&(!(l=new q(e)).isInteger()&&(l.c||1!==l.s)||l.lt(x)))throw Error(i+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+J(l));if(!w)return new q(y);for(t=new q(x),h=s=new q(x),a=f=new q(x),b=p(w),o=t.e=b.length-y.e-1,t.c[0]=d[(c=o%u)<0?u+c:c],e=!e||l.comparedTo(t)>0?o>0?t:h:l,c=L,L=1/0,l=new q(b),f.c[0]=0;m=n(l,t,0,1),1!=(r=s.plus(m.times(a))).comparedTo(e);)s=a,a=r,h=f.plus(m.times(r=h)),f=r,t=l.minus(m.times(r=t)),l=r;return r=n(e.minus(s),a,0,1),f=f.plus(r.times(h)),s=s.plus(r.times(a)),f.s=h.s=y.s,g=n(h,a,o*=2,O).minus(y).abs().comparedTo(n(f,s,o,O).minus(y).abs())<1?[h,a]:[f,s],L=c,g},j.toNumber=function(){return+J(this)},j.toPrecision=function(e,t){return null!=e&&b(e,1,h),K(this,e,t,2)},j.toString=function(e){var t,n=this,s=n.s,a=n.e;return null===a?s?(t="Infinity",s<0&&(t="-"+t)):t="NaN":(null==e?t=a<=F||a>=N?w(p(n.c),a):T(p(n.c),a,"0"):10===e&&$?t=T(p((n=V(new q(n),R+a+1,O)).c),n.e,"0"):(b(e,2,H.length,"Base"),t=S(T(p(n.c),a,"0"),10,e,s,!0)),s<0&&n.c[0]&&(t="-"+t)),t},j.valueOf=j.toJSON=function(){return J(this)},j._isBigNumber=!0,null!=t&&q.set(t),q}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/subscription-controller>bignumber.js",file:"node_modules/@metamask/subscription-controller/node_modules/bignumber.js/bignumber.js"}],[3414,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StructError=void 0;class s extends TypeError{constructor(e,t){let n;const{message:s,explanation:a,...r}=e,{path:i}=e,o=0===i.length?s:`At path: ${i.join(".")} -- ${s}`;super(a??o),null!==a&&a!==undefined&&(this.cause=o),Object.assign(this,r),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}n.StructError=s}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/error.cjs"}],[3415,{"./error.cjs":3414,"./struct.cjs":3416,"./structs/coercions.cjs":3417,"./structs/refinements.cjs":3418,"./structs/types.cjs":3419,"./structs/utilities.cjs":3420},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./error.cjs"),n),a(e("./struct.cjs"),n),a(e("./structs/coercions.cjs"),n),a(e("./structs/refinements.cjs"),n),a(e("./structs/types.cjs"),n),a(e("./structs/utilities.cjs"),n)}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/index.cjs"}],[3416,{"./error.cjs":3414,"./utils.cjs":3421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validate=n.is=n.mask=n.create=n.assert=n.ExactOptionalStruct=n.Struct=void 0;const s=e("./error.cjs"),a=e("./utils.cjs");class r{constructor(e){const{type:t,schema:n,validator:s,refiner:r,coercer:i=e=>e,entries:o=function*(){}}=e;this.type=t,this.schema=n,this.entries=o,this.coercer=i,this.validator=s?(e,t)=>{const n=s(e,t);return(0,a.toFailures)(n,t,this,e)}:()=>[],this.refiner=r?(e,t)=>{const n=r(e,t);return(0,a.toFailures)(n,t,this,e)}:()=>[]}assert(e,t){return o(e,this,t)}create(e,t){return c(e,this,t)}is(e){return l(e,this)}mask(e,t){return u(e,this,t)}validate(e,t={}){return d(e,this,t)}}n.Struct=r;const i="EXACT_OPTIONAL";function o(e,t,n){const s=d(e,t,{message:n});if(s[0])throw s[0]}function c(e,t,n){const s=d(e,t,{coerce:!0,message:n});if(s[0])throw s[0];return s[1]}function u(e,t,n){const s=d(e,t,{coerce:!0,mask:!0,message:n});if(s[0])throw s[0];return s[1]}function l(e,t){return!d(e,t)[0]}function d(e,t,n={}){const r=(0,a.run)(e,t,n),i=(0,a.shiftIterator)(r);if(i[0]){return[new s.StructError(i[0],function*(){for(const e of r)e[0]&&(yield e[0])}),undefined]}const o=i[1];return[undefined,o]}n.ExactOptionalStruct=class extends r{constructor(e){super({...e,type:`exact optional ${e.type}`}),this.brand=i}static isExactOptional(e){return(0,a.isObject)(e)&&"brand"in e&&e.brand===i}},n.assert=o,n.create=c,n.mask=u,n.is=l,n.validate=d}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/struct.cjs"}],[3417,{"../struct.cjs":3416,"../utils.cjs":3421,"./types.cjs":3419},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.trimmed=n.defaulted=n.coerce=void 0;const s=e("../struct.cjs"),a=e("../utils.cjs"),r=e("./types.cjs");function i(e,t,n){return new s.Struct({...e,coercer:(a,r)=>(0,s.is)(a,t)?e.coercer(n(a,r),r):e.coercer(a,r)})}n.coerce=i,n.defaulted=function(e,t,n={}){return i(e,(0,r.unknown)(),e=>{const s="function"==typeof t?t():t;if(e===undefined)return s;if(!n.strict&&(0,a.isPlainObject)(e)&&(0,a.isPlainObject)(s)){const t={...e};let n=!1;for(const e in s)t[e]===undefined&&(t[e]=s[e],n=!0);if(n)return t}return e})},n.trimmed=function(e){return i(e,(0,r.string)(),e=>e.trim())}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/coercions.cjs"}],[3418,{"../struct.cjs":3416,"../utils.cjs":3421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refine=n.size=n.pattern=n.nonempty=n.min=n.max=n.empty=void 0;const s=e("../struct.cjs"),a=e("../utils.cjs");function r(e){return e instanceof Map||e instanceof Set?e.size:e.length}function i(e,t,n){return new s.Struct({...e,*refiner(s,r){yield*e.refiner(s,r);const i=n(s,r),o=(0,a.toFailures)(i,r,e,s);for(const e of o)yield{...e,refinement:t}}})}n.empty=function(e){return i(e,"empty",t=>{const n=r(t);return 0===n||`Expected an empty ${e.type} but received one with a size of \`${n}\``})},n.max=function(e,t,n={}){const{exclusive:s}=n;return i(e,"max",n=>s?n<t:n<=t||`Expected a ${e.type} less than ${s?"":"or equal to "}${t} but received \`${n}\``)},n.min=function(e,t,n={}){const{exclusive:s}=n;return i(e,"min",n=>s?n>t:n>=t||`Expected a ${e.type} greater than ${s?"":"or equal to "}${t} but received \`${n}\``)},n.nonempty=function(e){return i(e,"nonempty",t=>r(t)>0||`Expected a nonempty ${e.type} but received an empty one`)},n.pattern=function(e,t){return i(e,"pattern",n=>t.test(n)||`Expected a ${e.type} matching \`/${t.source}/\` but received "${n}"`)},n.size=function(e,t,n=t){const s=`Expected a ${e.type}`,a=t===n?`of \`${t}\``:`between \`${t}\` and \`${n}\``;return i(e,"size",e=>{if("number"==typeof e||e instanceof Date)return t<=e&&e<=n||`${s} ${a} but received \`${e}\``;if(e instanceof Map||e instanceof Set){const{size:r}=e;return t<=r&&r<=n||`${s} with a size ${a} but received one with a size of \`${r}\``}const{length:r}=e;return t<=r&&r<=n||`${s} with a length ${a} but received one with a length of \`${r}\``})},n.refine=i}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/refinements.cjs"}],[3419,{"../struct.cjs":3416,"../utils.cjs":3421,"./utilities.cjs":3420},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.unknown=n.union=n.type=n.tuple=n.string=n.set=n.regexp=n.record=n.exactOptional=n.optional=n.object=n.number=n.nullable=n.never=n.map=n.literal=n.intersection=n.integer=n.instance=n.func=n.enums=n.date=n.boolean=n.bigint=n.array=n.any=void 0;const s=e("../struct.cjs"),a=e("../utils.cjs"),r=e("./utilities.cjs");function i(){return(0,r.define)("never",()=>!1)}n.any=function(){return(0,r.define)("any",()=>!0)},n.array=function(e){return new s.Struct({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(const[n,s]of t.entries())yield[n,s,e]},coercer:e=>Array.isArray(e)?e.slice():e,validator:e=>Array.isArray(e)||`Expected an array value, but received: ${(0,a.print)(e)}`})},n.bigint=function(){return(0,r.define)("bigint",e=>"bigint"==typeof e)},n.boolean=function(){return(0,r.define)("boolean",e=>"boolean"==typeof e)},n.date=function(){return(0,r.define)("date",e=>e instanceof Date&&!isNaN(e.getTime())||`Expected a valid \`Date\` object, but received: ${(0,a.print)(e)}`)},n.enums=function(e){const t={},n=e.map(e=>(0,a.print)(e)).join();for(const n of e)t[n]=n;return new s.Struct({type:"enums",schema:t,validator:t=>e.includes(t)||`Expected one of \`${n}\`, but received: ${(0,a.print)(t)}`})},n.func=function(){return(0,r.define)("func",e=>"function"==typeof e||`Expected a function, but received: ${(0,a.print)(e)}`)},n.instance=function(e){return(0,r.define)("instance",t=>t instanceof e||`Expected a \`${e.name}\` instance, but received: ${(0,a.print)(t)}`)},n.integer=function(){return(0,r.define)("integer",e=>"number"==typeof e&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${(0,a.print)(e)}`)},n.intersection=function(e){return new s.Struct({type:"intersection",schema:null,*entries(t,n){for(const{entries:s}of e)yield*s(t,n)},*validator(t,n){for(const{validator:s}of e)yield*s(t,n)},*refiner(t,n){for(const{refiner:s}of e)yield*s(t,n)}})},n.literal=function(e){const t=(0,a.print)(e),n=typeof e;return new s.Struct({type:"literal",schema:"string"===n||"number"===n||"boolean"===n?e:null,validator:n=>n===e||`Expected the literal \`${t}\`, but received: ${(0,a.print)(n)}`})},n.map=function(e,t){return new s.Struct({type:"map",schema:null,*entries(n){if(e&&t&&n instanceof Map)for(const[s,a]of n.entries())yield[s,s,e],yield[s,a,t]},coercer:e=>e instanceof Map?new Map(e):e,validator:e=>e instanceof Map||`Expected a \`Map\` object, but received: ${(0,a.print)(e)}`})},n.never=i,n.nullable=function(e){return new s.Struct({...e,validator:(t,n)=>null===t||e.validator(t,n),refiner:(t,n)=>null===t||e.refiner(t,n)})},n.number=function(){return(0,r.define)("number",e=>"number"==typeof e&&!isNaN(e)||`Expected a number, but received: ${(0,a.print)(e)}`)},n.object=function(e){const t=e?Object.keys(e):[],n=i();return new s.Struct({type:"object",schema:e??null,*entries(r){if(e&&(0,a.isObject)(r)){const a=new Set(Object.keys(r));for(const n of t){a.delete(n);const t=e[n];s.ExactOptionalStruct.isExactOptional(t)&&!Object.prototype.hasOwnProperty.call(r,n)||(yield[n,r[n],e[n]])}for(const e of a)yield[e,r[e],n]}},validator:e=>(0,a.isObject)(e)||`Expected an object, but received: ${(0,a.print)(e)}`,coercer:e=>(0,a.isObject)(e)?{...e}:e})},n.optional=function(e){return new s.Struct({...e,validator:(t,n)=>t===undefined||e.validator(t,n),refiner:(t,n)=>t===undefined||e.refiner(t,n)})},n.exactOptional=function(e){return new s.ExactOptionalStruct(e)},n.record=function(e,t){return new s.Struct({type:"record",schema:null,*entries(n){if((0,a.isObject)(n))for(const s in n){const a=n[s];yield[s,s,e],yield[s,a,t]}},validator:e=>(0,a.isObject)(e)||`Expected an object, but received: ${(0,a.print)(e)}`})},n.regexp=function(){return(0,r.define)("regexp",e=>e instanceof RegExp)},n.set=function(e){return new s.Struct({type:"set",schema:null,*entries(t){if(e&&t instanceof Set)for(const n of t)yield[n,n,e]},coercer:e=>e instanceof Set?new Set(e):e,validator:e=>e instanceof Set||`Expected a \`Set\` object, but received: ${(0,a.print)(e)}`})},n.string=function(){return(0,r.define)("string",e=>"string"==typeof e||`Expected a string, but received: ${(0,a.print)(e)}`)},n.tuple=function(e){const t=i();return new s.Struct({type:"tuple",schema:null,*entries(n){if(Array.isArray(n)){const s=Math.max(e.length,n.length);for(let a=0;a<s;a++)yield[a,n[a],e[a]||t]}},validator:e=>Array.isArray(e)||`Expected an array, but received: ${(0,a.print)(e)}`})},n.type=function(e){const t=Object.keys(e);return new s.Struct({type:"type",schema:e,*entries(n){if((0,a.isObject)(n))for(const s of t)yield[s,n[s],e[s]]},validator:e=>(0,a.isObject)(e)||`Expected an object, but received: ${(0,a.print)(e)}`,coercer:e=>(0,a.isObject)(e)?{...e}:e})},n.union=function(e){const t=e.map(e=>e.type).join(" | ");return new s.Struct({type:"union",schema:null,coercer(t){for(const n of e){const[e,s]=n.validate(t,{coerce:!0});if(!e)return s}return t},validator(n,s){const r=[];for(const t of e){const[...e]=(0,a.run)(n,t,s),[i]=e;if(!i?.[0])return[];for(const[t]of e)t&&r.push(t)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${(0,a.print)(n)}`,...r]}})},n.unknown=function(){return(0,r.define)("unknown",()=>!0)}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/types.cjs"}],[3420,{"../struct.cjs":3416,"./types.cjs":3419},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.pick=n.partial=n.omit=n.lazy=n.dynamic=n.deprecated=n.define=n.assign=void 0;const s=e("../struct.cjs"),a=e("./types.cjs");n.assign=function(...e){const t="type"===e[0]?.type,n=e.map(({schema:e})=>e),s=Object.assign({},...n);return t?(0,a.type)(s):(0,a.object)(s)},n.define=function(e,t){return new s.Struct({type:e,schema:null,validator:t})},n.deprecated=function(e,t){return new s.Struct({...e,refiner:(t,n)=>t===undefined||e.refiner(t,n),validator:(n,s)=>n===undefined||(t(n,s),e.validator(n,s))})},n.dynamic=function(e){return new s.Struct({type:"dynamic",schema:null,*entries(t,n){const s=e(t,n);yield*s.entries(t,n)},validator:(t,n)=>e(t,n).validator(t,n),coercer:(t,n)=>e(t,n).coercer(t,n),refiner:(t,n)=>e(t,n).refiner(t,n)})},n.lazy=function(e){let t;return new s.Struct({type:"lazy",schema:null,*entries(n,s){t??(t=e()),yield*t.entries(n,s)},validator:(n,s)=>(t??(t=e()),t.validator(n,s)),coercer:(n,s)=>(t??(t=e()),t.coercer(n,s)),refiner:(n,s)=>(t??(t=e()),t.refiner(n,s))})},n.omit=function(e,t){const{schema:n}=e,s={...n};for(const e of t)delete s[e];return"type"===e.type?(0,a.type)(s):(0,a.object)(s)},n.partial=function(e){const t=e instanceof s.Struct,n=t?{...e.schema}:{...e};for(const e in n)n[e]=(0,a.optional)(n[e]);return t&&"type"===e.type?(0,a.type)(n):(0,a.object)(n)},n.pick=function(e,t){const{schema:n}=e,s={};for(const e of t)s[e]=n[e];return"type"===e.type?(0,a.type)(s):(0,a.object)(s)}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/utilities.cjs"}],[3421,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e){return"object"==typeof e&&null!==e}function a(e){return"symbol"==typeof e?e.toString():"string"==typeof e?JSON.stringify(e):`${e}`}function r(e,t,n,s){if(!0===e)return undefined;!1===e?e={}:"string"==typeof e&&(e={message:e});const{path:r,branch:i}=t,{type:o}=n,{refinement:c,message:u=`Expected a value of type \`${o}\`${c?` with refinement \`${c}\``:""}, but received: \`${a(s)}\``}=e;return{value:s,type:o,refinement:c,key:r[r.length-1],path:r,branch:i,...e,message:u}}Object.defineProperty(n,"__esModule",{value:!0}),n.run=n.toFailures=n.toFailure=n.shiftIterator=n.print=n.isPlainObject=n.isObject=void 0,n.isObject=s,n.isPlainObject=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},n.print=a,n.shiftIterator=function(e){const{done:t,value:n}=e.next();return t?undefined:n},n.toFailure=r,n.toFailures=function*(e,t,n,a){(function(e){return s(e)&&"function"==typeof e[Symbol.iterator]})(e)||(e=[e]);for(const s of e){const e=r(s,t,n,a);e&&(yield e)}},n.run=function*e(t,n,a={}){const{path:r=[],branch:i=[t],coerce:o=!1,mask:c=!1}=a,u={path:r,branch:i};if(o&&(t=n.coercer(t,u),c&&"type"!==n.type&&s(n.schema)&&s(t)&&!Array.isArray(t)))for(const e in t)n.schema[e]===undefined&&delete t[e];let l="valid";for(const e of n.validator(t,u))e.explanation=a.message,l="not_valid",yield[e,undefined];for(let[d,f,h]of n.entries(t,u)){const n=e(f,h,{path:d===undefined?r:[...r,d],branch:d===undefined?i:[...i,f],coerce:o,mask:c,message:a.message});for(const e of n)e[0]?(l=null===e[0].refinement||e[0].refinement===undefined?"not_valid":"not_refined",yield[e[0],undefined]):o&&(f=e[1],d===undefined?t=f:t instanceof Map?t.set(d,f):t instanceof Set?t.add(f):s(t)&&(f!==undefined||d in t)&&(t[d]=f))}if("not_valid"!==l)for(const e of n.refiner(t,u))e.explanation=a.message,l="not_refined",yield[e,undefined];"valid"===l&&(yield[undefined,t])}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/utils.cjs"}],[3422,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEventEmitterProxy=void 0;const s=()=>!0,a=["newListener","removeListener"],r=e=>!a.includes(e);n.createEventEmitterProxy=function(e,{eventFilter:t=s}={}){const n="skipInternal"===t?r:t;if("function"!=typeof n)throw new Error("createEventEmitterProxy - Invalid eventFilter");let a=[],i=e,o=e=>{const t=i;i=e,a.forEach(({name:n,handler:s,addedWith:a,filtered:r})=>{r||e[a](n,s),t.off(n,s)})};const c=(e,t)=>{a=a.filter(n=>e!==n.name||t!==n.handler&&t!==n.unwrappedHandler)};return new Proxy(i,{get(e,t,s){if("setTarget"===t)return o;const r=i[t];return"function"==typeof r?function(...e){const o=e[1];if("once"===t){const t=(...n)=>(c(e[0],t),o(...n));e[1]=t}if("on"===t||"addListener"===t||"prependListener"===t||"once"===t)a.push({addedWith:t,name:e[0],unwrappedHandler:o,handler:e[1],filtered:!n(e[0])});else if("off"===t||"removeListener"===t){const t=a.find(({name:t,unwrappedHandler:n})=>t===e[0]&&n===e[1]);if(t===undefined)return i;c(e[0],e[1]),e[1]=t.handler}return r.apply(this===s?i:this,e)}:r},set:(e,t,n)=>"setTarget"===t?(o=n,!0):(i[t]=n,!0)})}}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/createEventEmitterProxy.js"}],[3423,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSwappableProxy=void 0,n.createSwappableProxy=function(e){let t=e,n=e=>{t=e};return new Proxy(t,{get(e,s,a){if("setTarget"===s)return n;const r=t[s];return r instanceof Function?function(...e){return r.apply(this===a?t:this,e)}:r},set:(e,s,a)=>"setTarget"===s?(n=a,!0):(t[s]=a,!0)})}}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/createSwappableProxy.js"}],[3424,{"./createEventEmitterProxy":3422,"./createSwappableProxy":3423,"./types":3425},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./createEventEmitterProxy"),n),a(e("./createSwappableProxy"),n),a(e("./types"),n)}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/index.js"}],[3425,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/types.js"}],[3426,{"./constants.cjs":3428,"./errors.cjs":3429,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@toruslabs/http-helpers":3449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.authenticateUser=n.createAuthResponseHandler=void 0;const s=e("@metamask/auth-network-utils"),a=e("@toruslabs/http-helpers"),r=e("./constants.cjs"),i=e("./errors.cjs"),o=e("./utils.cjs");n.createAuthResponseHandler=(e,t)=>{let n=null;return async()=>{const a=(0,s.filterCompletedRequests)(e);if(a.length>=r.AUTHENTICATION_THRESHOLD){n??(n=Date.now());const e=Date.now()-n>1e3;if(t||e){const e=a.map(e=>{const{pubKey:t,keyIndex:n}=e.result;return{pubKey:t,keyIndex:n}}),t=(0,s.thresholdSame)(e,r.AUTHENTICATION_THRESHOLD);if(!t)throw i.TOPRFError.invalidAuthenticateResults(`Authentication threshold met, but pubKey/keyIndex data inconsistent: ${JSON.stringify(e)}`);return{authRequestResults:a.map(e=>e.result),isNewUser:!t.pubKey}}return undefined}if(t)throw i.TOPRFError.invalidAuthenticateResults(`Authentication threshold not met after all requests processed. Expected: ${r.AUTHENTICATION_THRESHOLD}, got: ${a.length}`);return undefined}};n.authenticateUser=async e=>{const{idToken:t,nodeEndpointsMap:c,authConnectionId:u,userId:l,commitmentSignatures:d,groupedAuthConnectionId:f,hashedIdToken:h,sessionPrivateKey:m}=e,p=(e=>{const t=e.groupedAuthConnectionId?{subVerifierAuthParams:[{subVerifierIdToken:e.idToken,subVerifier:e.authConnectionId}]}:undefined;if(e.groupedAuthConnectionId&&!e.hashedIdToken)throw i.TOPRFError.fromCode(i.TOPRFErrorCode.NoHashedIdToken);return{authData:{authenticationContext:{idToken:e.groupedAuthConnectionId&&e.hashedIdToken?e.hashedIdToken:e.idToken,verifier:e.groupedAuthConnectionId??e.authConnectionId,verifierId:e.userId},singleIdVerifierParams:t},commitmentSignatures:e.commitmentSignatures,clientTime:Math.floor(Date.now()/1e3).toString()}})({idToken:t,authConnectionId:u,userId:l,commitmentSignatures:d,groupedAuthConnectionId:f,hashedIdToken:h}),g=Object.values(c).map(async e=>(async(e,t)=>{const n=(0,a.generateJsonRPCObject)(r.JRPC_METHODS.AUTHENTICATE_REQUEST,t);return(0,o.postJRPCRequest)(e,n)})(e,p)),b=await(0,s.Some)(g,async(e,t)=>(0,n.createAuthResponseHandler)(e,t.allSettled)());return{authTokensData:await Promise.all(b.authRequestResults.map(async e=>{const{authToken:t,nodeIndex:n,nodePubKey:s,pubKey:a,keyIndex:r}=e;return{authToken:await(0,o.decryptAuthToken)(t,m),nodeIndex:n,nodePubKey:s,pubKey:a,keyIndex:r}})),isNewUser:b.isNewUser}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/authenticateRequest.cjs"}],[3427,{"./constants.cjs":3428,"./errors.cjs":3429,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@noble/hashes/utils":3611,"@toruslabs/http-helpers":3449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.commitIdToken=n.createHandleCommitmentResponses=void 0;const s=e("@metamask/auth-network-utils"),a=e("@noble/hashes/utils"),r=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.createHandleCommitmentResponses=(e,t)=>{let n=null;return async()=>{const a=(0,s.filterCompletedRequests)(e);if(a.length>=i.COMMIT_RESPONSE_THRESHOLD){n??(n=Date.now());const e=Date.now()-n>1e3;return t||e?a.map(e=>e.result):undefined}if(t)throw o.TOPRFError.invalidCommitResults(`Threshold not met after all requests processed. Expected: ${i.COMMIT_RESPONSE_THRESHOLD}, got: ${a.length}`);return undefined}};n.commitIdToken=async e=>{const{idToken:t,endpoints:o,authConnectionId:u,sessionPubKeyX:l,sessionPubKeyY:d}=e,f=((e,t,n,s)=>({tokenCommitment:e,verifier:t,tempPubKeyX:n,tempPubKeyY:s}))((0,s.keccak256AndHexify)((0,a.utf8ToBytes)(t)).slice(2),u,l,d),h=o.map(async e=>(async(e,t)=>{const n=(0,r.generateJsonRPCObject)(i.JRPC_METHODS.COMMITMENT_REQUEST,t);return(0,c.postJRPCRequest)(e,n)})(e,f));return(0,s.Some)(h,async(e,t)=>(0,n.createHandleCommitmentResponses)(e,t.allSettled)())}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/commitRequest.cjs"}],[3428,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.JsonRpcErrorCodes=n.PW_BACKUP_ITEM_ID=n.MAX_PASSWORD_CHAIN_LENGTH=n.FIRST_KEY_INDEX=n.GENERATE_SHARE_THRESHOLD=n.GET_PUB_KEY_THRESHOLD=n.TOPRF_EVAL_THRESHOLD=n.AUTHENTICATION_THRESHOLD=n.COMMIT_RESPONSE_THRESHOLD=n.JRPC_METHODS=void 0,n.JRPC_METHODS={COMMITMENT_REQUEST:"TOPRFCommitmentRequest",AUTHENTICATE_REQUEST:"TOPRFAuthenticateRequest",STORE_KEY_SHARES_REQUEST:"TOPRFStoreKeyShareRequest",RESET_RATE_LIMIT_REQUEST:"TOPRFResetRateLimitRequest",TOPRF_EVAL_REQUEST:"TOPRFEvalRequest",GET_PUB_KEY_REQUEST:"TOPRFGetPubKeyRequest"},n.COMMIT_RESPONSE_THRESHOLD=4,n.AUTHENTICATION_THRESHOLD=4,n.TOPRF_EVAL_THRESHOLD=3,n.GET_PUB_KEY_THRESHOLD=3,n.GENERATE_SHARE_THRESHOLD=3,n.FIRST_KEY_INDEX=1,n.MAX_PASSWORD_CHAIN_LENGTH=10,n.PW_BACKUP_ITEM_ID="PW_BACKUP",function(e){e[e.ErrorCodeInvalidParams=-32602]="ErrorCodeInvalidParams",e[e.ErrorCodeInternal=-32603]="ErrorCodeInternal"}(s||(n.JsonRpcErrorCodes=s={}))}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/constants.cjs"}],[3429,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.TOPRFError=n.TOPRFErrorCode=void 0,function(e){e[e.Default=1e3]="Default",e[e.InvalidAuthenticateResults=1001]="InvalidAuthenticateResults",e[e.InvalidCommitResults=1002]="InvalidCommitResults",e[e.PwdInputRateLimitExceeded=1003]="PwdInputRateLimitExceeded",e[e.InsufficientValidResponses=1004]="InsufficientValidResponses",e[e.CouldNotDeriveThresholdAuthPubKey=1005]="CouldNotDeriveThresholdAuthPubKey",e[e.CouldNotDeriveEncryptionKey=1006]="CouldNotDeriveEncryptionKey",e[e.EndpointNotFound=1007]="EndpointNotFound",e[e.InsufficientAuthTokens=1008]="InsufficientAuthTokens",e[e.RateLimitExceeded=1009]="RateLimitExceeded",e[e.InvalidAuthToken=1010]="InvalidAuthToken",e[e.AuthTokenExpired=1011]="AuthTokenExpired",e[e.JsonRpcError=1012]="JsonRpcError",e[e.CouldNotFetchPassword=1013]="CouldNotFetchPassword",e[e.NoHashedIdToken=1014]="NoHashedIdToken",e[e.MaxKeyChainLengthExceeded=1015]="MaxKeyChainLengthExceeded"}(s||(n.TOPRFErrorCode=s={}));class a extends Error{constructor(e,t,n){super(t),this.code=e,this.meta=n,Object.defineProperty(this,"name",{value:"TOPRFError"})}static fromCode(e,t="",n){const r=t?` ${t}`:"";return a.messages[e]?new a(e,`${a.messages[e]}${r}`,n):new a(1e3,`${a.messages[s.Default]}${r}`,n)}static default(e=""){return new a(s.Default,`${a.messages[s.Default]} ${e}`)}static invalidAuthenticateResults(e=""){return a.fromCode(s.InvalidAuthenticateResults,e)}static invalidCommitResults(e=""){return a.fromCode(s.InvalidCommitResults,e)}static pwdInputRateLimitExceeded(e=""){return a.fromCode(s.PwdInputRateLimitExceeded,e)}static insufficientValidResponses(e=""){return a.fromCode(s.InsufficientValidResponses,e)}static couldNotDeriveThresholdAuthPubKey(e=""){return a.fromCode(s.CouldNotDeriveThresholdAuthPubKey,e)}static couldNotDeriveEncryptionKey(e=""){return a.fromCode(s.CouldNotDeriveEncryptionKey,e)}static endpointNotFound(e=""){return a.fromCode(s.EndpointNotFound,e)}static insufficientAuthTokens(e=""){return a.fromCode(s.InsufficientAuthTokens,e)}static rateLimitExceeded(e,t=""){return a.fromCode(s.RateLimitExceeded,t||e.message,{rateLimitDetails:e})}static invalidAuthToken(e=""){return a.fromCode(s.InvalidAuthToken,e)}static authTokenExpired(e=""){return a.fromCode(s.AuthTokenExpired,e)}static jsonRpcError(e){return a.fromCode(s.JsonRpcError,e)}static couldNotFetchPassword(e=""){return a.fromCode(s.CouldNotFetchPassword,e)}static maxKeyChainLengthExceeded(e=""){return a.fromCode(s.MaxKeyChainLengthExceeded,e)}toJSON(){return{name:this.name,code:this.code,message:this.message,meta:this.meta}}toString(){return JSON.stringify(this.toJSON())}}n.TOPRFError=a,a.messages={[s.Default]:"Something went wrong.",[s.InvalidAuthenticateResults]:"Invalid authenticate results.",[s.InvalidCommitResults]:"Invalid commit results.",[s.PwdInputRateLimitExceeded]:"Rate limit exceeded for password input attempts.",[s.InsufficientValidResponses]:"Insufficient valid responses.",[s.CouldNotDeriveThresholdAuthPubKey]:"Could not derive threshold auth pub key.",[s.CouldNotDeriveEncryptionKey]:"Could not derive encryption key.",[s.EndpointNotFound]:"Endpoint not found.",[s.InsufficientAuthTokens]:"Insufficient number of auth tokens.",[s.RateLimitExceeded]:"Rate limit error from server.",[s.InvalidAuthToken]:"Invalid auth token.",[s.AuthTokenExpired]:"Auth token expired.",[s.JsonRpcError]:"Json rpc error.",[s.CouldNotFetchPassword]:"Could not fetch password.",[s.MaxKeyChainLengthExceeded]:"Exceeded maximum key chain length.",[s.NoHashedIdToken]:"hashedIdToken is required when using single-id(aggregate) verifier."}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/errors.cjs"}],[3430,{"./constants.cjs":3428,"./errors.cjs":3429,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@noble/hashes/utils":3611,"@toruslabs/http-helpers":3449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPubKey=n.validatePubKey=void 0;const s=e("@metamask/auth-network-utils"),a=e("@noble/hashes/utils"),r=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.validatePubKey=async e=>{const t=(0,c.checkAuthTokenErrors)(e);if(t)throw t;const n=(0,s.filterCompletedRequests)(e);if(n.length<i.GET_PUB_KEY_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient get pub key request results, expected ${i.GET_PUB_KEY_THRESHOLD} but got ${n.length}`);const r=(0,s.thresholdSame)(n.map(e=>({pubKey:e.result?.pubKey,keyIndex:e.result?.keyIndex})),i.GET_PUB_KEY_THRESHOLD);if(!r?.pubKey||!r?.keyIndex)throw o.TOPRFError.couldNotDeriveThresholdAuthPubKey();return{authPubKey:(0,a.hexToBytes)(r.pubKey),keyIndex:r.keyIndex}};n.getPubKey=async e=>{const{authTokens:t,nodeEndpointsMap:a,authConnectionId:u,userId:l,groupedAuthConnectionId:d}=e;if(t.length<i.GET_PUB_KEY_THRESHOLD)throw o.TOPRFError.insufficientAuthTokens(`At least ${i.GET_PUB_KEY_THRESHOLD} auth tokens are required.`);const f=(0,c.mergeEndpointsWithAuthTokens)(t,a).map(async({endpoint:e,authToken:t})=>{const n=((e,t,n,s)=>({authToken:e,verifier:s??t,verifierId:n}))(t.authToken,u,l,d);return(async(e,t)=>{const n=(0,r.generateJsonRPCObject)(i.JRPC_METHODS.GET_PUB_KEY_REQUEST,t);return(0,c.postJRPCRequest)(e,n)})(e,n)});return(0,s.Some)(f,async e=>(0,n.validatePubKey)(e))}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/getPubKeyRequest.cjs"}],[3431,{"./errors.cjs":3429,"./toprfSecureBackup.cjs":3438,"./utils.cjs":3439},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.TOPRFErrorCode=n.TOPRFError=void 0,a(e("./toprfSecureBackup.cjs"),n);var r=e("./errors.cjs");Object.defineProperty(n,"TOPRFError",{enumerable:!0,get:function(){return r.TOPRFError}}),Object.defineProperty(n,"TOPRFErrorCode",{enumerable:!0,get:function(){return r.TOPRFErrorCode}}),a(e("./utils.cjs"),n)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/index.cjs"}],[3432,{"@noble/curves/abstract/utils":3592,"@noble/curves/secp256k1":3595,"@noble/hashes/hkdf":3601,"@noble/hashes/sha2":3607},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.derivePwEncKey=n.deriveEncryptionKey=n.deriveAuthenticationKeyPair=void 0;const s=e("@noble/curves/abstract/utils"),a=e("@noble/curves/secp256k1"),r=e("@noble/hashes/hkdf"),i=e("@noble/hashes/sha2");n.deriveAuthenticationKeyPair=function(e){const t=(0,r.hkdf)(i.sha256,e,undefined,"authentication-key",32),n=(0,s.bytesToNumberBE)(t)%a.secp256k1.CURVE.n;return{sk:n,pk:a.secp256k1.getPublicKey(n,!1)}},n.deriveEncryptionKey=function(e){return(0,r.hkdf)(i.sha256,e,undefined,"encryption-key",32)},n.derivePwEncKey=function(e){return(0,r.hkdf)(i.sha256,e,undefined,"pwd-encryption-key",32)}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/keyDerivation.cjs"}],[3433,{"./constants.cjs":3428,"@metamask/auth-network-utils":3444,"@noble/ciphers/aes":3582,"@noble/ciphers/webcrypto":3585,"@noble/curves/secp256k1":3595,"@noble/hashes/sha3":3609,"@noble/hashes/utils":3611,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},w=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MetadataStore=n.MetadataStoreError=n.MetadataLockStatus=void 0;const T=e("@metamask/auth-network-utils"),S=e("@noble/ciphers/aes"),E=e("@noble/ciphers/webcrypto"),k=e("@noble/curves/secp256k1"),P=e("@noble/hashes/sha3"),v=e("@noble/hashes/utils"),I=e("./constants.cjs");var _;!function(e){e[e.FAILED=0]="FAILED",e[e.SUCCESS=1]="SUCCESS"}(_||(n.MetadataLockStatus=_={}));class A extends Error{constructor(e){super(e),this.name="MetadataStoreError",Object.setPrototypeOf(this,A.prototype)}}n.MetadataStoreError=A;n.MetadataStore=class{constructor(e){s.add(this),a.set(this,"srp-backup"),r.set(this,void 0),i.set(this,void 0),y(this,r,e.metadataEndpoint,"f"),y(this,i,e.fetchMetadataAccessCreds,"f")}async addSecretDataItem(e){try{const{secretData:t,encKey:n,authKeyPair:a}=e;await w(this,s,"m",o).call(this,{secretData:t,encKey:n,authKeyPair:a,metadataEndpoint:w(this,r,"f")})}catch(e){throw new A(`failed to add metadata: ${e.message}`)}}async batchAddSecretData(e){try{const{secretData:t,encKey:n,authKeyPair:a}=e;await w(this,s,"m",c).call(this,{secretData:t,encKey:n,authKeyPair:a,metadataEndpoint:w(this,r,"f")})}catch(e){throw new A(`failed to add batch metadata: ${e.message}`)}}async fetchAllSecretDataItems(e,t,n){try{return await w(this,s,"m",u).call(this,{encKey:e,authKeyPair:t,metadataEndpoint:w(this,r,"f"),itemId:n})}catch(e){throw new A(`failed to fetch metadata: ${e.message}`)}}async acquireMetadataLock(e){const{status:t,id:n}=await w(this,s,"m",l).call(this,w(this,r,"f"),e);if(t!==_.SUCCESS)throw new A("Failed to acquire metadata lock");if(!n)throw new A("Failed to acquire metadata lock. Missing lock id");return n}async releaseMetadataLock(e,t){const n=await w(this,s,"m",d).call(this,w(this,r,"f"),e,t);if(n!==_.SUCCESS)throw new A(`Failed to release metadata lock with id ${t}`);return n}},a=new WeakMap,r=new WeakMap,i=new WeakMap,s=new WeakSet,o=async function(e){try{const t=`${e.metadataEndpoint}/enc_account_data/set`,n=w(this,s,"m",g).call(this,e.secretData.data,e.encKey),a=await w(this,s,"m",f).call(this,{itemId:e.secretData.itemId,data:n},e.authKeyPair),r=JSON.stringify(a),i=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:r});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).success}catch(e){const t=e.message||"Unknown error";throw new A(`failed to upsert metadata: ${t}`)}},c=async function(e){const t=Array.isArray(e.encKey)?e.encKey:e.secretData.map(()=>e.encKey);if(t.length!==e.secretData.length)throw new A("encKey must be of same length as secretData");try{const n=`${e.metadataEndpoint}/enc_account_data/batch_set`,a=e.secretData.map((e,n)=>({data:w(this,s,"m",g).call(this,e.data,t[n]),itemId:e.itemId})),r=await w(this,s,"m",f).call(this,a,e.authKeyPair),i=await fetch(n,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).success}catch(e){const t=e.message||"Unknown error";throw new A(`failed to upsert metadata: ${t}`)}},u=async function(e){try{const n=`${e.metadataEndpoint}/enc_account_data/get`,a=await w(this,s,"m",h).call(this,e.authKeyPair,e.itemId),r=await fetch(n,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)});if(!r.ok){const e=await r.json();throw new Error(`HTTP error message: ${e.error}`)}const i=await r.json();if(!i.data)throw new A("Failed to fetch metadata");return i.data.filter((t,n)=>e.itemId?i.ids[n]===e.itemId:i.ids[n]!==I.PW_BACKUP_ITEM_ID).map((n,a)=>{const r=new Uint8Array(t.from(n,"base64"));return{itemId:i.ids[a],data:w(this,s,"m",b).call(this,r,e.encKey)}}).filter(e=>e.data.length>0)}catch(e){const t=e.message||"Unknown error";throw new A(`failed to fetch metadata: ${t}`)}},l=async function(e,t){try{const n=w(this,s,"m",m).call(this,t),a=`${e}/acquireLock`,r=await fetch(a,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)});if(!r.ok){const e=await r.json();throw new Error(`HTTP error message: ${e.error}`)}const i=await r.json();return{status:i.status,id:i.id}}catch(e){const t=e.message||"Unknown error";throw new A(`failed to acquire metadata lock: ${t}`)}},d=async function(e,t,n){try{const a=w(this,s,"m",m).call(this,t,n),r=`${e}/releaseLock`,i=await fetch(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).status}catch(e){const t=e.message||"Unknown error";throw new A(`failed to release metadata lock: ${t}`)}},f=async function(e,n){const r=Date.now().toString(),o=w(this,a,"f"),{metadataAccessToken:c}=await w(this,i,"f").call(this),u={timestamp:r,feature:o,authToken:c};Array.isArray(e)?u.data=e.map(e=>{const n=e.data;return{data:t.from(n).toString("base64"),itemId:e.itemId}}):(u.data=t.from(e.data).toString("base64"),u.itemId=e.itemId);const{pk:l,sk:d}=n,f=w(this,s,"m",p).call(this,u,d),h=(0,v.bytesToHex)(l);return{...u,signature:f,pubKey:h}},h=async function(e,t){const n=Date.now().toString(),r=w(this,a,"f"),{pk:o,sk:c}=e,{metadataAccessToken:u}=await w(this,i,"f").call(this),l={feature:r,timestamp:n,itemId:t,authToken:u},d=w(this,s,"m",p).call(this,l,c),f=(0,v.bytesToHex)(o);return{...l,pubKey:f,signature:d}},m=function(e,t){const{pk:n,sk:a}=e,r={timestamp:Date.now()};return{data:r,signature:w(this,s,"m",p).call(this,r,a,!0),key:(0,v.bytesToHex)(n),id:t}},p=function(e,t,n=!1){const s=(0,T.safeStringify)(e),a=(0,P.keccak_256)(s),r=k.secp256k1.sign(a,t);return n?r.toDERHex():r.toCompactHex()},g=function(e,t){return(0,E.managedNonce)(S.gcm)(t).encrypt(e)},b=function(e,t){return(0,E.managedNonce)(S.gcm)(t).decrypt(e)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/metadata.cjs"}],[3434,{"@noble/curves/abstract/modular":3590,"@noble/curves/abstract/utils":3592,"@noble/curves/secp256k1":3595},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OPRF=n.generateRandomScalar=void 0;const s=e("@noble/curves/abstract/modular"),a=e("@noble/curves/abstract/utils"),r=e("@noble/curves/secp256k1");function i(){return(0,a.bytesToNumberBE)(r.secp256k1.utils.randomPrivateKey())}n.generateRandomScalar=i;const o=(0,s.Field)(r.secp256k1.CURVE.n);n.OPRF=class{static blind(e){const t=i(),n=(0,r.hashToCurve)(e).multiply(t);return{a:r.secp256k1.ProjectivePoint.fromAffine(n.toAffine()),r:t}}static blindEval(e,t){return t.multiply(e)}static async unblindAndHash(e,t,n,s){const a=o.inv(n),i=t.multiply(a);let c=r.secp256k1.CURVE.hash(new Uint8Array([...e,...i.toRawBytes()]));if(s){const e=c.length;c=await s.deriveKey(c.slice(0,e/2),c.slice(e/2))}return c}static async localEval(e,t,n){const{a:s,r:a}=this.blind(t),r=s.multiply(e);return this.unblindAndHash(t,r,a,n)}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/oprf.cjs"}],[3435,{"./constants.cjs":3428,"./errors.cjs":3429,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@noble/hashes/sha3":3609,"@toruslabs/http-helpers":3449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resetRateLimits=n.validateThresholdResetRateLimitResponses=n.sendResetRateLimitRequest=void 0;const s=e("@metamask/auth-network-utils"),a=e("@noble/hashes/sha3"),r=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.sendResetRateLimitRequest=async(e,t)=>{const n=(0,r.generateJsonRPCObject)(i.JRPC_METHODS.RESET_RATE_LIMIT_REQUEST,t);return(0,c.postJRPCRequest)(e,n)};n.validateThresholdResetRateLimitResponses=(e,t)=>{const n=(0,c.checkAuthTokenErrors)(e);if(n)throw n;const a=(0,s.filterCompletedRequests)(e);if(a.length<t)throw o.TOPRFError.insufficientValidResponses(`invalid reset rate limit results, expected ${t} but got ${a.length}`);return!0};n.resetRateLimits=async e=>{const{authTokens:t,nodeEndpointsMap:r,authConnectionId:i,groupedAuthConnectionId:o,userId:u,authPrivKey:l}=e,d=(0,c.mergeEndpointsWithAuthTokens)(t,r).map(async({endpoint:e,authToken:t})=>{const r=(0,s.toSnakeCaseKeys)({timestamp:Date.now(),nodeIndex:t.nodeIndex,action:"reset_ratelimit"}),d=(0,s.safeStringify)(r,{cmp:c.preserveKeyOrder}),f=(0,a.keccak_256)(d),h=(0,c.createEthereumSignature)(f,l),m=((e,t,n,s,a,r)=>({authToken:e,signature:t,signedData:n,verifier:r??s,verifierId:a}))(t.authToken,h,d,i,u,o);return(0,n.sendResetRateLimitRequest)(e,m)});return(0,s.Some)(d,async e=>(0,n.validateThresholdResetRateLimitResponses)(e,t.length))}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/resetRateLimits.cjs"}],[3436,{"./constants.cjs":3428,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@toruslabs/http-helpers":3449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.changeKeyShares=n.createKeyChangeRequestParams=n.storeKeyShares=n.sendStoreKeySharesRequest=n.createStoreKeySharesRequestParams=void 0;const s=e("@metamask/auth-network-utils"),a=e("@toruslabs/http-helpers"),r=e("./constants.cjs"),i=e("./utils.cjs");n.createStoreKeySharesRequestParams=async e=>{const{nodeEndpointsMap:t,authTokens:n,authConnectionId:a,groupedAuthConnectionId:r,userId:o,keyShareIndex:c,oprfKey:u,authPubKey:l}=e,d=await(0,i.generateShareImportItems)(t,n,u,c);return{verifier:r??a,verifierId:o,pubKey:(0,s.uint8ArrayToHex)(l),shareImportItems:d}};n.sendStoreKeySharesRequest=async(e,t)=>{const n=(0,a.generateJsonRPCObject)(r.JRPC_METHODS.STORE_KEY_SHARES_REQUEST,(0,s.toSnakeCaseKeys)(t));return(0,i.postJRPCRequest)(e,n)};n.storeKeyShares=async e=>{const{authTokens:t,nodeEndpointsMap:a,authConnectionId:r,groupedAuthConnectionId:o,userId:c,keyShareIndex:u,oprfKey:l,authPubKey:d}=e,f=await(0,n.createStoreKeySharesRequestParams)({nodeEndpointsMap:a,authTokens:t,authConnectionId:r,groupedAuthConnectionId:o,userId:c,keyShareIndex:u,oprfKey:l,authPubKey:d}),h=a[(0,s.getProxyCoordinatorNodeIndex)(t.map(e=>e.nodeIndex),o??r,c)],m=await(0,n.sendStoreKeySharesRequest)(h,f);if((0,s.isJSONRPCError)(m.error)){throw(0,i.parseJsonRpcError)(m.error)}return m};n.createKeyChangeRequestParams=async e=>{const{nodeEndpointsMap:t,authTokens:n,keyShareIndex:a,newOprfKey:r,newAuthPubKey:o,oldAuthPrivKey:c,authConnectionId:u,groupedAuthConnectionId:l,userId:d}=e,f=await(0,i.generateShareImportItems)(t,n,r,a,c);return{pubKey:(0,s.uint8ArrayToHex)(o),shareImportItems:f,verifier:l??u,verifierId:d}};n.changeKeyShares=async e=>{const{nodeEndpointsMap:t,authTokens:a,keyShareIndex:r,newOprfKey:o,newAuthPubKey:c,oldAuthPrivKey:u,authConnectionId:l,groupedAuthConnectionId:d,userId:f}=e,h=await(0,n.createKeyChangeRequestParams)({nodeEndpointsMap:t,authTokens:a,keyShareIndex:r,newOprfKey:o,newAuthPubKey:c,oldAuthPrivKey:u,authConnectionId:l,groupedAuthConnectionId:d,userId:f}),m=t[(0,s.getProxyCoordinatorNodeIndex)(a.map(e=>e.nodeIndex),l,f)],p=await(0,n.sendStoreKeySharesRequest)(m,h);if((0,s.isJSONRPCError)(p.error)){throw(0,i.parseJsonRpcError)(p.error)}return p}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/storeSharesRequest.cjs"}],[3437,{"./constants.cjs":3428,"./errors.cjs":3429,"./keyDerivation.cjs":3432,"./oprf.cjs":3434,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@noble/curves/secp256k1":3595,"@toruslabs/http-helpers":3449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.recoverTOPRFSeed=n.validateSeed=void 0;const s=e("@metamask/auth-network-utils"),a=e("@noble/curves/secp256k1"),r=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./keyDerivation.cjs"),u=e("./oprf.cjs"),l=e("./utils.cjs");n.validateSeed=async(e,t,n,r)=>{const d=(0,l.checkAuthTokenErrors)(n);if(d)throw d;let f=(0,l.checkRateLimitErrors)(n);if(f)throw o.TOPRFError.rateLimitExceeded(f);const h=(0,s.filterCompletedRequests)(n);if(h.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient toprf eval request results, expected ${i.TOPRF_EVAL_THRESHOLD} but got ${h.length}`);const m=(0,s.thresholdSame)(h.map(e=>e.result?.pubKey),i.TOPRF_EVAL_THRESHOLD);if(!m)throw o.TOPRFError.couldNotDeriveThresholdAuthPubKey();const p=h.reduce((e,t)=>{const n=t.result;if(!("object"==typeof(s=n)&&null!==s&&"blindedOutputX"in s&&"string"==typeof s.blindedOutputX&&"blindedOutputY"in s&&"string"==typeof s.blindedOutputY&&"nodeIndex"in s&&"number"==typeof s.nodeIndex&&"keyShareIndex"in s&&"number"==typeof s.keyShareIndex&&"pubKey"in s&&"string"==typeof s.pubKey))return e;var s;const{blindedOutputX:r,blindedOutputY:i,nodeIndex:o,keyShareIndex:c}=n;return e.push({blindedOutput:a.secp256k1.ProjectivePoint.fromAffine({x:BigInt(`0x${r}`),y:BigInt(`0x${i}`)}),nodeIndex:o,keyShareIndex:c}),e},[]);if(p.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient valid blinded outputs, expected: ${i.TOPRF_EVAL_THRESHOLD}, received: ${p.length}`);const g=await(async(e,t,n,r,o)=>{const l=(0,s.kCombinations)(e.length,i.TOPRF_EVAL_THRESHOLD);for(const i of l){const l=e.filter((e,t)=>i.includes(t)),d=l.map(e=>e.blindedOutput),f=l.map(e=>BigInt(e.nodeIndex)),h=(0,s.lagrangeInterpolationForPoints)(a.secp256k1.CURVE.n,d,f),m=await u.OPRF.unblindAndHash(t,h,n,o),{pk:p}=(0,c.deriveAuthenticationKeyPair)(m),g=a.secp256k1.ProjectivePoint.fromHex(p),b=a.secp256k1.ProjectivePoint.fromHex(r);if(g.equals(b))return{seed:m,keyShareIndex:l[0].keyShareIndex}}return null})(p,e,t,m,r);if(!g){if(f=(0,l.extractRateLimitErrorFromResults)(n),f)throw o.TOPRFError.rateLimitExceeded(f);throw o.TOPRFError.couldNotDeriveEncryptionKey()}return g};n.recoverTOPRFSeed=async e=>{const{authTokens:t,nodeEndpointsMap:a,authConnectionId:c,groupedAuthConnectionId:d,userId:f,userInput:h,keyDeriver:m}=e;if(t.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientAuthTokens(`At least ${i.TOPRF_EVAL_THRESHOLD} auth tokens are required.`);const{a:p,r:g}=u.OPRF.blind(h),b=(0,l.mergeEndpointsWithAuthTokens)(t,a).map(async({endpoint:e,authToken:t})=>{const n=((e,t,n,s,a,r)=>({authToken:e,shareCoefficient:"1",blindedInputX:t,blindedInputY:n,verifier:r??s,verifierId:a}))(t.authToken,p.x.toString(16),p.y.toString(16),c,f,d);return(async(e,t)=>{const n=(0,r.generateJsonRPCObject)(i.JRPC_METHODS.TOPRF_EVAL_REQUEST,t);return(0,l.postJRPCRequest)(e,n)})(e,n)});try{return await(0,s.Some)(b,async e=>(0,n.validateSeed)(h,g,e,m))}catch(e){throw(0,l.getTOPRFError)(e)}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/toprfEvalRequest.cjs"}],[3438,{"./authenticateRequest.cjs":3426,"./commitRequest.cjs":3427,"./constants.cjs":3428,"./errors.cjs":3429,"./getPubKeyRequest.cjs":3430,"./keyDerivation.cjs":3432,"./metadata.cjs":3433,"./oprf.cjs":3434,"./resetRateLimits.cjs":3435,"./storeSharesRequest.cjs":3436,"./toprfEvalRequest.cjs":3437,"./utils.cjs":3439,"@metamask/auth-network-utils":3444,"@noble/ciphers/utils":3584,"@noble/curves/abstract/utils":3592,"@noble/curves/secp256k1":3595,"@noble/hashes/utils":3611,"@toruslabs/fetch-node-details":3658,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s,a,r,i,o,c,u,l,d,f,h,m,p=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ToprfSecureBackup=void 0;const b=e("@metamask/auth-network-utils"),y=e("@noble/ciphers/utils"),w=e("@noble/curves/abstract/utils"),T=e("@noble/curves/secp256k1"),S=e("@noble/hashes/utils"),E=e("@toruslabs/fetch-node-details"),k=e("./authenticateRequest.cjs"),P=e("./commitRequest.cjs"),v=e("./constants.cjs"),I=e("./errors.cjs"),_=e("./getPubKeyRequest.cjs"),A=e("./keyDerivation.cjs"),C=e("./metadata.cjs"),j=e("./oprf.cjs"),x=e("./resetRateLimits.cjs"),R=e("./storeSharesRequest.cjs"),O=e("./toprfEvalRequest.cjs"),F=e("./utils.cjs");class N{constructor(e){s.add(this),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),p(this,r,new E.NodeDetailManager({network:e.network}),"f"),p(this,i,e.nodeDetailsOverride,"f"),p(this,o,e.keyDeriver,"f"),p(this,c,e.fetchMetadataAccessCreds,"f")}async authenticate(e){const{nodeEndpoints:n,nodeEndpointsMap:a}=await g(this,s,"m",l).call(this);let r=T.secp256k1.utils.randomPrivateKey();try{const s=T.secp256k1.ProjectivePoint.fromPrivateKey(r),i=s.x.toString(16),o=s.y.toString(16);let c;e.groupedAuthConnectionId&&(c=(0,b.remove0x)((0,b.keccak256AndHexify)(t.from(e.idTokens[0],"utf8"))));const u=await(0,P.commitIdToken)({idToken:c??e.idTokens[0],authConnectionId:e.groupedAuthConnectionId??e.authConnectionId,sessionPubKeyX:i,sessionPubKeyY:o,endpoints:n}),l=u.reduce((e,t)=>(e[t.nodeIndex]=a[t.nodeIndex],e),{}),{authTokensData:d,isNewUser:f}=await(0,k.authenticateUser)({idToken:e.idTokens[0],authConnectionId:e.authConnectionId,userId:e.userId,sessionPrivateKey:r,nodeEndpointsMap:l,commitmentSignatures:u,groupedAuthConnectionId:e.groupedAuthConnectionId,hashedIdToken:c});return{nodeAuthTokens:d.map(e=>({authToken:e.authToken,nodeIndex:e.nodeIndex,nodePubKey:e.nodePubKey})),isNewUser:f}}finally{r.fill(0),r=null}}async createLocalKey(e){const{password:t,oprfKey:n=(0,j.generateRandomScalar)()}=e;let s=null;try{s=(0,w.utf8ToBytes)(t);const e=await j.OPRF.localEval(n,s,g(this,o,"f")),a=(0,A.deriveAuthenticationKeyPair)(e),r=(0,A.deriveEncryptionKey)(e);return{oprfKey:n,seed:e,authKeyPair:a,encKey:r,pwEncKey:(0,A.derivePwEncKey)(e)}}finally{s&&(s.fill(0),s=null)}}async persistLocalKey(e){const{nodeAuthTokens:t,oprfKey:n,authPubKey:a,authConnectionId:r,groupedAuthConnectionId:i,userId:o,keyShareIndex:c=v.FIRST_KEY_INDEX,oldAuthKeyPair:u}=e,{nodeEndpointsMap:d}=await g(this,s,"m",l).call(this),f=t.reduce((e,t)=>(e[t.nodeIndex]=d[t.nodeIndex],e),{});u?await(0,R.changeKeyShares)({nodeEndpointsMap:f,authConnectionId:r,groupedAuthConnectionId:i,userId:o,authTokens:t,keyShareIndex:c,newOprfKey:n,newAuthPubKey:a,oldAuthPrivKey:u.sk}):await(0,R.storeKeyShares)({nodeEndpointsMap:f,authConnectionId:r,groupedAuthConnectionId:i,userId:o,authTokens:t,keyShareIndex:c,oprfKey:n,authPubKey:a})}async createAndPersistEncKey(e){const{nodeAuthTokens:t,password:n,authConnectionId:s,userId:a}=e,{oprfKey:r,authKeyPair:i,encKey:o,pwEncKey:c}=await this.createLocalKey({password:n});return await this.persistLocalKey({nodeAuthTokens:t,oprfKey:r,authPubKey:i.pk,authConnectionId:s,userId:a}),{authKeyPair:{sk:i.sk,pk:i.pk},encKey:o,pwEncKey:c}}async recoverEncKey(e){const{nodeAuthTokens:t,password:n,authConnectionId:a,groupedAuthConnectionId:r,userId:i}=e;let c=null,u=null;try{const{nodeEndpointsMap:e}=await g(this,s,"m",l).call(this);c=(0,w.utf8ToBytes)(n);const{seed:d,keyShareIndex:f}=await(0,O.recoverTOPRFSeed)({authTokens:t,nodeEndpointsMap:e,authConnectionId:a,groupedAuthConnectionId:r,userId:i,userInput:c,keyDeriver:g(this,o,"f")});u=d;const h=(0,A.deriveAuthenticationKeyPair)(u),m=(0,A.deriveEncryptionKey)(u),p=(0,A.derivePwEncKey)(u),b=new Promise((n,s)=>{(0,x.resetRateLimits)({authTokens:t,nodeEndpointsMap:e,authConnectionId:a,groupedAuthConnectionId:r,userId:i,authPrivKey:h.sk}).then(()=>n()).catch(e=>{s(e)})});return{authKeyPair:h,encKey:m,pwEncKey:p,keyShareIndex:f,rateLimitResetResult:b}}finally{c&&(c.fill(0),c=null),u&&(u.fill(0),u=null)}}async changeEncKey(e){const{nodeAuthTokens:t,authConnectionId:n,groupedAuthConnectionId:a,userId:r,oldEncKey:i,oldPwEncKey:o,oldAuthKeyPair:c,newPassword:u,newKeyShareIndex:l,pregeneratedOprfKey:f}=e;if(!f&&!u)throw new Error("Either newPassword or pregeneratedOprfKey is required");if(f&&u)throw new Error("Only one of newPassword or pregeneratedOprfKey is allowed");const{oprfKey:h,authKeyPair:m,encKey:p,pwEncKey:b}=u?await this.createLocalKey({password:u}):f;let y,w,T;try{y=await g(this,s,"m",d).call(this),[w,T]=await Promise.all([y.acquireMetadataLock(c),y.acquireMetadataLock(m)]);const e=(await y.fetchAllSecretDataItems(i,c)).map(e=>({data:e.data}));if(!e||0===e.length)throw new Error("No existing data found to change key");const u=[{data:M("",o,c),itemId:v.PW_BACKUP_ITEM_ID},...e],f=[b,...e.map(()=>p)];return await y.batchAddSecretData({secretData:u,encKey:f,authKeyPair:m}),await this.persistLocalKey({nodeAuthTokens:t,oprfKey:h,authPubKey:m.pk,authConnectionId:n,groupedAuthConnectionId:a,userId:r,keyShareIndex:l,oldAuthKeyPair:c}),{authKeyPair:m,encKey:p,pwEncKey:b}}finally{if(y&&w&&T)try{await Promise.all([y.releaseMetadataLock(c,w),y.releaseMetadataLock(m,T)])}catch(e){console.error("Failed to release metadata lock:",e)}}}async addSecretDataItem(e){const t=await g(this,s,"m",d).call(this);await t.addSecretDataItem({...e,secretData:{data:e.secretData}})}async batchAddSecretDataItems(e){const t=await g(this,s,"m",d).call(this);let n;try{n=await t.acquireMetadataLock(e.authKeyPair),await t.batchAddSecretData({...e,secretData:e.secretData.map(e=>({data:e}))})}finally{if(n)try{await t.releaseMetadataLock(e.authKeyPair,n)}catch(e){console.error("Failed to release metadata lock:",e)}}}async fetchAllSecretDataItems(e){const t=await g(this,s,"m",d).call(this);return(await t.fetchAllSecretDataItems(e.decKey,e.authKeyPair)).map(e=>e.data)}async fetchAuthPubKey(e){const{nodeAuthTokens:t,authConnectionId:n,userId:a,groupedAuthConnectionId:r}=e,{nodeEndpointsMap:i}=await g(this,s,"m",l).call(this);return(0,_.getPubKey)({authTokens:t,nodeEndpointsMap:i,authConnectionId:n,userId:a,groupedAuthConnectionId:r})}async recoverPwEncKey(e){const{targetAuthPubKey:t,curPwEncKey:n,curAuthKeyPair:a,maxPwChainLength:r=v.MAX_PASSWORD_CHAIN_LENGTH}=e;let i={password:"",encKey:n,authKeyPair:a};for(let e=0;e<r;e++)try{if(i=await g(this,s,"m",h).call(this,{encKey:i.encKey,authKeyPair:i.authKeyPair}),(0,y.equalBytes)(i.authKeyPair.pk,t))return{pwEncKey:i.encKey}}catch(e){throw I.TOPRFError.couldNotFetchPassword(e.message)}throw I.TOPRFError.maxKeyChainLengthExceeded()}async getNodeDetails(){return g(this,s,"m",l).call(this)}}function M(e,t,n){return(0,w.utf8ToBytes)(JSON.stringify({pw:e,encKey:(0,S.bytesToHex)(t),authKeyPair:{sk:n.sk.toString(),pk:(0,S.bytesToHex)(n.pk)}}))}n.ToprfSecureBackup=N,a=N,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,s=new WeakSet,l=async function(){let e=g(this,i,"f")?.indexes,t=g(this,i,"f")?.pubKeys,n=g(this,i,"f")?.endpoints;if(e&&t&&Array.isArray(n))return g(a,a,"m",m).call(a,e,t,n),{nodeEndpoints:n,nodeEndpointsMap:(0,F.createNodeEndpointsMap)(n,e),nodeIndexes:e,nodePubkeys:t};const{torusNodeSSSEndpoints:s,torusIndexes:o,torusNodePub:c}=await g(this,r,"f").getNodeDetails({verifier:"auth-connection-id",verifierId:"user-id"});if(e??(e=o),t??(t=c),!Array.isArray(n)){if(!s){throw new Error("Failed to get node details")}n=n?s.map(e=>{const t=new URL(e);return t.pathname=n,t.href}):s}return g(a,a,"m",m).call(a,e,t,n),{nodeEndpoints:n,nodeEndpointsMap:(0,F.createNodeEndpointsMap)(n,e),nodeIndexes:e,nodePubkeys:t}},d=async function(){if(g(this,u,"f"))return g(this,u,"f");const{nodeEndpointsMap:e}=await g(this,s,"m",l).call(this),t=(await g(this,s,"m",f).call(this,e))[1],n=new C.MetadataStore({metadataEndpoint:t,fetchMetadataAccessCreds:g(this,c,"f")});return p(this,u,n,"f"),n},f=async function(e){const t={};return Object.entries(e).forEach(([e,n])=>{const s=new URL(n);t[e]=`${s.origin}/metadata`}),t},h=async function(e){const t=await g(this,s,"m",d).call(this),n=await t.fetchAllSecretDataItems(e.encKey,e.authKeyPair,v.PW_BACKUP_ITEM_ID);if(0===n.length)throw new Error("Failed to get previous password and keys");const a=function(e){const t=JSON.parse((0,y.bytesToUtf8)(e));return{pw:t.pw,encKey:(0,S.hexToBytes)(t.encKey),authKeyPair:{sk:BigInt(t.authKeyPair.sk),pk:(0,S.hexToBytes)(t.authKeyPair.pk)}}}(n[0].data);return{password:a.pw,encKey:a.encKey,authKeyPair:a.authKeyPair}},m=function(e,t,n){if(e.length!==t.length||e.length!==n.length){throw new Error("Node details arrays (indexes, pubKeys, endpoints) must have equal lengths")}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/toprfSecureBackup.cjs"}],[3439,{"./constants.cjs":3428,"./errors.cjs":3429,"@metamask/auth-network-utils":3444,"@noble/curves/secp256k1":3595,"@noble/hashes/sha3":3609,"@toruslabs/eccrypto":3657,"@toruslabs/http-helpers":3449,"bn.js":4413,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.preserveKeyOrder=n.getTOPRFError=n.parseJsonRpcError=n.mergeEndpointsWithAuthTokens=n.checkAuthTokenErrors=n.checkRateLimitErrors=n.extractRateLimitErrorFromResults=n.getMaxRateLimitError=n.createNodeEndpointsMap=n.generateShareImportItems=n.createKeyChangeShareImportItems=n.createNewUserShareImportItems=n.createKeyChangeProof=n.createEthereumSignature=n.prepareNodeShares=n.decryptAuthToken=n.postJRPCRequest=n.bigIntToBN=void 0;const a=e("@metamask/auth-network-utils"),r=e("@noble/curves/secp256k1"),i=e("@noble/hashes/sha3"),o=e("@toruslabs/eccrypto"),c=e("@toruslabs/http-helpers"),u=s(e("bn.js")),l=e("./constants.cjs"),d=e("./errors.cjs");n.bigIntToBN=e=>new u.default(e.toString());n.postJRPCRequest=async(e,t)=>{const n={...t};return n.params=(0,a.toSnakeCaseKeys)(t.params),(0,c.post)(e,n,{},{logTracingHeader:!1}).then(e=>(e.result&&(e.result=(0,a.toCamelCaseKeys)(e.result)),e)).catch(e=>({id:t.id,jsonrpc:"2.0",error:{code:-32e3,message:"Internal error",data:e}}))};n.decryptAuthToken=async(e,n)=>{const s=JSON.parse(e),r=(0,a.encParamsHexToBuf)(s.metadata),i=await(0,o.decrypt)(t.from(n),{...r,ciphertext:t.from(s.data,"hex")});return t.from(i).toString("base64")};const f=async(e,n)=>{const s=await(0,o.encrypt)(n,e,{padding:!0}),r=(0,a.encryptedParamsBufToHex)(s);return{data:t.from(s.ciphertext).toString("hex"),metadata:{...r}}};n.prepareNodeShares=(e,t)=>{const s=(0,n.bigIntToBN)(t),r=(0,a.getSecp256K1Curve)(),i=Object.keys(e).map(e=>parseInt(e,10)),o=((e,t,n,s)=>{const r=t.map(e=>new u.default(e)),i=s-1;return(0,a.generateRandomPolynomial)(e,i,n).generateShares(r)})(r,i,s,l.GENERATE_SHARE_THRESHOLD);return{shares:o,nodeIndexes:i}};n.createEthereumSignature=(e,t)=>{const n=t.toString(16).padStart(64,"0"),s=r.secp256k1.sign(e,n);return s.toCompactHex()+(s.recovery+27).toString(16).padStart(2,"0")};n.createKeyChangeProof=(e,s,r,o)=>{const c=Math.floor(Date.now()/1e3),u=(e=>e.toArrayLike(t,"be",32).toString("base64"))(e),l=(0,a.toSnakeCaseKeys)({shareData:u,keyShareIndex:s,nodeIndex:r,timestamp:c}),d=JSON.stringify(l),f=(0,i.keccak_256)(d);return{oldKeySignature:(0,n.createEthereumSignature)(f,o),signatureTimestamp:c}};n.createNewUserShareImportItems=async(e,n,s,a)=>Promise.all(s.map(async s=>{const{nodePubKey:r,nodeIndex:i,authToken:o}=s,c=new u.default(i).toString("hex",64),l=e[c].toJSON(),d=await f(t.from(l.share,"hex"),t.from(r,"hex")),h=await f(t.from(o,"base64"),t.from(r,"hex"));return{encryptedShare:JSON.stringify(d),encryptedAuthToken:JSON.stringify(h),keyShareIndex:a,nodeIndex:i,sssEndpoint:n[i]}}));n.createKeyChangeShareImportItems=async(e,s,a,r,i)=>Promise.all(a.map(async a=>{const{nodePubKey:o,nodeIndex:c,authToken:l}=a,d=new u.default(c).toString("hex",64),h=e[d].toJSON(),m=new u.default(h.share,16),p=(0,n.createKeyChangeProof)(m,r,c,i),g=await f(t.from(h.share,"hex"),t.from(o,"hex")),b=await f(t.from(l,"base64"),t.from(o,"hex"));return{encryptedShare:JSON.stringify(g),encryptedAuthToken:JSON.stringify(b),keyShareIndex:r,nodeIndex:c,sssEndpoint:s[c],...p}}));n.generateShareImportItems=async(e,t,s,a,...r)=>{const{shares:i}=(0,n.prepareNodeShares)(e,s),o=r[0];return o!==undefined?(0,n.createKeyChangeShareImportItems)(i,e,t,a,o):(0,n.createNewUserShareImportItems)(i,e,t,a)};function h(e,t){return e.remainingTime>t.remainingTime?e:t}function m(e){if(!(0,a.isJSONRPCError)(e)||-32602!==e.code||"Rate limit exceeded"!==e.message||!e.data)return undefined;const t=(0,a.toCamelCaseKeys)(e.data);return"string"!=typeof t?.message||"number"!=typeof t?.remainingTime||"number"!=typeof t?.lockTime||"number"!=typeof t?.guessCount?undefined:{message:t.message,remainingTime:t.remainingTime,lockTime:t.lockTime,guessCount:t.guessCount}}function p(e){if(e.code===l.JsonRpcErrorCodes.ErrorCodeInvalidParams){if(e.message.toLowerCase().includes("auth token expired"))return d.TOPRFError.authTokenExpired();if(e.message.toLowerCase().includes("invalid auth token"))return d.TOPRFError.invalidAuthToken();let t=e.message;if("string"==typeof e.data)t=e.data;else if(e.data){const n=(0,a.toCamelCaseKeys)(e.data);t=JSON.stringify(n)}return d.TOPRFError.jsonRpcError(t)}if(e.code===l.JsonRpcErrorCodes.ErrorCodeInternal){const t=e.data??e.message;return d.TOPRFError.jsonRpcError(t)}return d.TOPRFError.default(e.message)}n.createNodeEndpointsMap=(e,t)=>t.reduce((t,n)=>(t[n]=e[n-1],t),{}),n.getMaxRateLimitError=h,n.extractRateLimitErrorFromResults=function(e){let t;for(const n of e)if(n.result?.lockTimeSeconds&&n.result.lockTimeSeconds>0&&n.result.guessCount){const e={remainingTime:n.result.lockTimeSeconds,message:"Rate limit exceeded",lockTime:n.result.lockTimeSeconds,guessCount:n.result.guessCount};t=t?h(t,e):e}return t},n.checkRateLimitErrors=function(e){const t=(0,a.filterErrorResponses)(e);let n;for(const e of t){const t=m(e.error);t&&(n=n?h(n,t):t)}return n},n.checkAuthTokenErrors=function(e){const t=(0,a.filterErrorResponses)(e);for(const e of t)if((0,a.isJSONRPCError)(e.error)){const t=p(e.error);if(t.code===d.TOPRFErrorCode.AuthTokenExpired||t.code===d.TOPRFErrorCode.InvalidAuthToken)return t}return undefined},n.mergeEndpointsWithAuthTokens=function(e,t){return e.map(e=>{const n=t[e.nodeIndex];if(!n)throw d.TOPRFError.endpointNotFound(`Endpoint not found for node index ${e.nodeIndex}`);return{endpoint:n,authToken:e}})},n.parseJsonRpcError=p,n.getTOPRFError=function(e){return e instanceof a.SomeError&&e.predicate&&e.predicate instanceof d.TOPRFError?e.predicate:e},n.preserveKeyOrder=function(e,t){return 0}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/utils.cjs"}],[3440,{"./errors.cjs":3442,"@noble/hashes/sha3":3609,"bn.js":4413,buffer:4474,"json-stable-stringify-without-jsonify":5055},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.toSnakeCaseKeys=n.toCamelCaseKeys=n.convertKeys=n.toSnake=n.toCamel=n.isJSONRPCError=n.filterErrorResponses=n.filterCompletedRequests=n.Some=n.getProxyCoordinatorNodeIndex=n.kCombinations=n.thresholdSame=n.safeStringify=n.add0x=n.remove0x=n.keccak256AndHexify=void 0;const a=e("@noble/hashes/sha3"),r=s(e("bn.js")),i=s(e("json-stable-stringify-without-jsonify")),o=e("./errors.cjs");function c(e){return`0x${t.from((0,a.keccak_256)(e)).toString("hex")}`}n.keccak256AndHexify=c,n.remove0x=function(e){return e.startsWith("0x")?e.slice(2):e},n.add0x=function(e){return e.startsWith("0x")?e:`0x${e}`},n.safeStringify=function(e,t){const n=(0,i.default)(e,t);if(!n)throw new Error("Failed to stringify");return n},n.thresholdSame=function(e,t){const n={};for(const s of e){const e=(0,i.default)(s);if(e&&(n[e]=n[e]?n[e]+1:1,n[e]===t))return s}return undefined},n.kCombinations=function*e(t,n){let s=t;if("number"==typeof s&&(s=Array.from({length:s},(e,t)=>t)),n>s.length||n<=0)return;if(n===s.length)return void(yield s);if(1===n){for(const e of s)yield[e];return}const a=Array.from({length:s.length-n+2},(e,t)=>t);for(const t of a)for(const a of e(s.slice(t+1),n-1))yield[s[t],...a]};function u(e){return e.replace(/_([a-z])/gu,(e,t)=>t.toUpperCase())}function l(e){return e.replace(/([A-Z])/gu,"_$1").toLowerCase()}function d(e,t){if(Array.isArray(e))return e.map(e=>d(e,t));if(null!==e&&"object"==typeof e){const n={};for(const[s,a]of Object.entries(e))n[t(s)]=d(a,t);return n}return e}n.getProxyCoordinatorNodeIndex=(e,n,s)=>{const a=`${n}${s}`,i=c(t.from(a,"utf8")).slice(2);return e[new r.default(i,"hex").mod(new r.default(e.length)).toNumber()]},n.Some=async function(e,t){let n;const s=new Array(e.length).fill(undefined),a=new Array(e.length).fill(undefined);for(const[r,i]of e.entries()){let e;try{const t=new Promise((t,n)=>{e=setTimeout(()=>n(new Error("Promise timed out")),1e4)});s[r]=await Promise.race([i,t])}catch(e){a[r]=e}finally{e&&clearTimeout(e)}try{const e=s.every(e=>e!==undefined),n=await t(s,{allSettled:e});if(n)return n}catch(e){n=e}}!function(e,t,n){let s=e.some(e=>e!==undefined);if(s)throw new o.SomeError({errors:e,responses:t,predicate:n});if(s=t.some(e=>Boolean(e?.error)),s){const e=t.map(e=>{const{error:t}=e;return t?.data&&t.data.length>0?new Error(t.data):undefined});throw new o.SomeError({errors:e,responses:t,predicate:n})}throw new o.SomeError({errors:e,responses:t,predicate:n})}(a,s,n)},n.filterCompletedRequests=function(e){return e.filter(e=>{const t=e&&"object"==typeof e,n=e,s=!n?.error,a=Boolean(n?.result);return t&&s&&a})},n.filterErrorResponses=function(e){return e.filter(e=>{const t=e&&"object"==typeof e,n=e,s=Boolean(n?.error);return t&&s})},n.isJSONRPCError=function(e){const t=e;return Boolean(e&&"object"==typeof e)&&"number"==typeof t?.code&&"string"==typeof t?.message},n.toCamel=u,n.toSnake=l,n.convertKeys=d;n.toCamelCaseKeys=e=>d(e,u);n.toSnakeCaseKeys=e=>d(e,l)}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/common.cjs"}],[3441,{"./common.cjs":3440,buffer:4474,elliptic:4647},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.uint8ArrayToHex=n.derivePubKey=n.toChecksumAddress=n.encParamsHexToBuf=n.encryptedParamsBufToHex=n.generatePrivateKey=n.getSecp256K1Curve=void 0;const s=e("elliptic"),a=e("./common.cjs");let r=null;n.getSecp256K1Curve=function(){return r=r??new s.ec("secp256k1"),r},n.generatePrivateKey=function(e){return e.genKeyPair().getPrivate()},n.encryptedParamsBufToHex=function(e){return{iv:t.from(e.iv).toString("hex"),ephemPublicKey:t.from(e.ephemPublicKey).toString("hex"),mac:t.from(e.mac).toString("hex"),mode:"AES256"}},n.encParamsHexToBuf=function(e){return{iv:t.from(e.iv,"hex"),ephemPublicKey:t.from(e.ephemPublicKey,"hex"),mac:t.from(e.mac,"hex")}},n.toChecksumAddress=function(e){const n=(s=e,s.startsWith("0x")||s.startsWith("0X")?s.slice(2):s).toLowerCase();var s;const r=t.from(n,"utf8"),i=(0,a.keccak256AndHexify)(r).slice(2);let o="0x";for(let e=0;e<n.length;e++)parseInt(i[e],16)>=8?o+=n[e].toUpperCase():o+=n[e];return o},n.derivePubKey=function(e,t){const n=t.toString(16,64);return e.keyFromPrivate(n,"hex").getPublic()},n.uint8ArrayToHex=function(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/cryptoUtils.cjs"}],[3442,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SomeError=void 0;class s extends Error{constructor({errors:e,responses:t,predicate:n}){const a=n?.message??"unknown error";super(`Unable to resolve enough promises. \n      errors: ${e.map(e=>e?.message??e).join(", ")}, \n      predicate error: ${a},\n      ${t.length} responses,\n      responses: ${JSON.stringify(t)}`),this.errors=e,this.responses=t,this.predicate=n,Object.setPrototypeOf(this,s.prototype)}toString(){return this.message}}n.SomeError=s}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/errors.cjs"}],[3443,{"bn.js":4413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.waitFor=n.capitalizeFirstLetter=n.generateEmptyBNArray=void 0;const a=s(e("bn.js"));n.generateEmptyBNArray=function(e){return Array.from({length:e},()=>new a.default(0))},n.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},n.waitFor=async function(e=2e3){return new Promise(t=>{setTimeout(t,e)})}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/helpers.cjs"}],[3444,{"./common.cjs":3440,"./cryptoUtils.cjs":3441,"./errors.cjs":3442,"./helpers.cjs":3443,"./lagrangeInterpolation.cjs":3445,"./point.cjs":3446,"./polynomial.cjs":3447,"./share.cjs":3448},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Share=n.Polynomial=n.Point=void 0;var i=e("./point.cjs");Object.defineProperty(n,"Point",{enumerable:!0,get:function(){return r(i).default}});var o=e("./polynomial.cjs");Object.defineProperty(n,"Polynomial",{enumerable:!0,get:function(){return r(o).default}});var c=e("./share.cjs");Object.defineProperty(n,"Share",{enumerable:!0,get:function(){return r(c).default}}),a(e("./errors.cjs"),n),a(e("./common.cjs"),n),a(e("./lagrangeInterpolation.cjs"),n),a(e("./cryptoUtils.cjs"),n),a(e("./helpers.cjs"),n)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/index.cjs"}],[3445,{"./cryptoUtils.cjs":3441,"./helpers.cjs":3443,"./point.cjs":3446,"./polynomial.cjs":3447,"@noble/curves/abstract/modular":3590,"@noble/curves/abstract/utils":3592,"@noble/curves/secp256k1":3595,"@noble/hashes/utils":3611,"bn.js":4413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return a(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.lagrangeInterpolation=n.lagrangeInterpolationForScalars=n.lagrangeInterpolationForPoints=n.lagrangeInterpolationNoble=n.generateRandomScalar=n.generateRandomPolynomialNoble=n.generateRandomPolynomial=n.lagrangeInterpolatePolynomial=void 0;const o=e("@noble/curves/abstract/modular"),c=e("@noble/curves/abstract/utils"),u=e("@noble/curves/secp256k1"),l=e("@noble/hashes/utils"),d=i(e("bn.js")),f=e("./cryptoUtils.cjs"),h=e("./helpers.cjs"),m=i(e("./point.cjs")),p=r(e("./polynomial.cjs"));function g(e,t){const n=(0,f.generatePrivateKey)(t);return e.find(e=>e.eq(n))?g(e,t):n}function b(e,t,n){const s=(0,h.generateEmptyBNArray)(e.length+t.length-1);for(let a=0;a<e.length;a++)for(let r=0;r<t.length;r++)s[a+r]=s[a+r].add(e[a].mul(t[r])).umod(n);return s}function y(e,t){const n=t.length,s=(0,h.generateEmptyBNArray)(n);if(!e.n)throw new Error("Curve is not set");for(let a=0;a<n;a++){let r=[new d.default(1)];for(let s=0;s<n;s++){if(s===a)continue;const n=t[a].xCoordinate.sub(t[s].xCoordinate).umod(e.n).invm(e.n);r=b(r,[t[s].xCoordinate.neg().umod(e.n).mul(n).umod(e.n),n],e.n)}for(let n=0;n<r.length;n++)s[n]=s[n].add(r[n].mul(t[a].yCoordinate)).umod(e.n)}return new p.default(s,e)}function w(e=u.secp256k1.CURVE.n){const t=(0,o.getMinHashLength)(e),n=(0,l.randomBytes)(t);return(0,c.bytesToNumberBE)(n)%e}function T(e,t,n){if(t.length!==n.length)throw new Error("Values and nodeIndex arrays must have the same length");if(0===t.length)throw new Error("Cannot interpolate with empty arrays");const s=(0,o.Field)(e),a="bigint"==typeof t[0];let r=a?0n:u.secp256k1.ProjectivePoint.ZERO;for(let e=0;e<t.length;e++){let i=1n,o=1n;for(let t=0;t<n.length;t++){if(e===t)continue;const a=n[e],r=n[t],c=s.neg(r),u=s.sub(a,r);i=s.mul(i,c),o=s.mul(o,u)}const c=s.mul(i,s.inv(o));if(a){const n=t[e],a=s.mul(n,c);r=s.add(r,a)}else{const n=t[e].multiply(c);r=r.add(n)}}return r}n.lagrangeInterpolatePolynomial=y,n.generateRandomPolynomial=function(e,t,n,s){let a;if(a=n||g([new d.default(0)],e),!s){const n=[a];for(let s=0;s<t;s+=1){const t=g(n,e);n.push(t)}return new p.default(n,e)}if(!Array.isArray(s))throw new Error("deterministic shares in generateRandomPolynomial should be an array");if(s.length>t)throw new Error("deterministicShares in generateRandomPolynomial should be less or equal than degree to ensure an element of randomness");const r={};s.forEach(t=>{r[t.shareIndex.toString("hex",64)]=new m.default(t.shareIndex,t.share,e)});for(let n=0;n<t-s.length;n+=1){const t=[new d.default(0)];Object.keys(r).forEach(e=>{t.push(new d.default(e,"hex"))});const n=g(t,e);r[n.toString("hex",64)]=new m.default(n,(0,f.generatePrivateKey)(e),e)}return r[0]=new m.default(new d.default(0),a,e),y(e,Object.values(r))},n.generateRandomPolynomialNoble=function(e,t,n){const s=[n??w(e)];for(let n=1;n<=t;n++)s[n]=w(e);return new p.PolynomialNoble(s,e)},n.generateRandomScalar=w,n.lagrangeInterpolationNoble=T,n.lagrangeInterpolationForPoints=function(e,t,n){return T(e,t,n)},n.lagrangeInterpolationForScalars=function(e,t,n){return T(e,t,n)},n.lagrangeInterpolation=function(e,t,n){if(t.length!==n.length)throw new Error("shares not equal to nodeIndex length in lagrangeInterpolation");const s=t.map((t,s)=>new m.default(n[s],t,e));return y(e,s).polynomial[0]}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/lagrangeInterpolation.cjs"}],[3446,{"bn.js":4413,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=s(e("bn.js"));n.default=class{constructor(e,t,n){this.xCoordinate=new a.default(e,"hex"),this.yCoordinate=new a.default(t,"hex"),this.ecCurve=n}encode(e){switch(e){case"arr":return t.concat([t.from("04","hex"),t.from(this.xCoordinate.toString("hex",64),"hex"),t.from(this.yCoordinate.toString("hex",64),"hex")]);case"elliptic-compressed":{const e=this.ecCurve.keyFromPublic({x:this.xCoordinate.toString("hex",64),y:this.yCoordinate.toString("hex",64)},"hex");return t.from(e.getPublic(!0,"hex"),"hex")}default:throw new Error("encoding doesn't exist in Point")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/point.cjs"}],[3447,{"./share.cjs":3448,"@noble/curves/abstract/modular":3590,"bn.js":4413,elliptic:4647},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PolynomialNoble=void 0;const c=e("@noble/curves/abstract/modular"),u=o(e("bn.js")),l=e("elliptic"),d=o(e("./share.cjs"));class f{constructor(e,t,n){s.set(this,void 0),a.set(this,void 0),n?(r(this,s,e,"f"),r(this,a,(0,c.Field)(n.curveN),"f"),this.polynomial=i(this,s,"f").map(e=>new u.default(e.toString()))):this.polynomial=e,this.ecCurve=t}getThreshold(){return this.polynomial.length}polyEval(e){const t=new u.default(e,"hex");let n=new u.default(t),s=new u.default(0);s=s.add(this.polynomial[0]);const{n:a}=this.ecCurve;if(!a)throw new Error("Curve is not set");for(const e of this.polynomial.slice(1)){const r=n.mul(e);s=s.add(r),s=s.umod(a),n=n.mul(new u.default(t)),n=n.umod(a)}return s}polyEvalNoble(e){if(!i(this,s,"f")||!i(this,a,"f"))throw new Error("Noble implementation not initialized");if(0===i(this,s,"f").length)return 0n;let t=i(this,s,"f")[0],n=e;for(let r=1;r<i(this,s,"f").length;r++)t=i(this,a,"f").add(t,i(this,a,"f").mul(i(this,s,"f")[r],n)),n=i(this,a,"f").mul(n,e);return t}generateShares(e){const t=e.map(e=>{if("bigint"==typeof e)return new u.default(e.toString());if("number"==typeof e)return new u.default(e);if(e instanceof u.default)return e;if("string"==typeof e)return new u.default(e,"hex");throw new Error("Invalid share index")}),n={};for(const e of t)n[e.toString("hex",64)]=new d.default(e,this.polyEval(e));return n}}s=new WeakMap,a=new WeakMap,n.default=f;n.PolynomialNoble=class extends f{constructor(e,t){super(e,new l.ec("secp256k1"),{curveN:t})}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/polynomial.cjs"}],[3448,{"bn.js":4413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=s(e("bn.js"));class r{constructor(e,t){this.share=new a.default(t,"hex"),this.shareIndex=new a.default(e,"hex")}static fromJSON(e){const{share:t,shareIndex:n}=e;return new r(n,t)}toJSON(){return{share:this.share.toString("hex",64),shareIndex:this.shareIndex.toString("hex",64)}}}n.default=r}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/share.cjs"}],[3449,{"@babel/runtime/helpers/objectSpread2":643,deepmerge:4627,loglevel:5247},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("@babel/runtime/helpers/objectSpread2"),a=e("deepmerge"),r=e("loglevel");const i=r.getLogger("http-helpers");i.setLevel(r.levels.INFO);let o="torus-default",c="";const u="x-api-key",l="x-embed-host";let d=null;const f=[],h=[];async function m(e,t){let n=null;try{n=new URL(e)}catch{}if(d&&n&&(f.includes(n.origin)||h.includes(n.pathname))){return await d.startSpan({name:e,op:"http.client"},async()=>await fetch(e,t))}return fetch(e,t)}function p(){const e={};return o&&(e[u]=o),c&&(e[l]=c),e}function g(e){i.info(`Response: ${e.status} ${e.statusText}`),i.info(`Url: ${e.url}`)}const b=async(e,t)=>{let n=null;try{const s=new Promise((t,s)=>{n=setTimeout(()=>{s(new Error(`Timed out in ${e}ms`))},e)}),a=await Promise.race([t,s]);return null!=n&&clearTimeout(n),a}catch(e){throw null!=n&&clearTimeout(n),e}},y=async(e,t={},n={})=>{const r={mode:"cors",headers:{}};n.useAPIKey&&(r.headers=s(s({},r.headers),p())),t.method="GET";const i=a(r,t),o=await m(e,i);if(o.ok){const e=o.headers.get("content-type");return null!=e&&e.includes("application/json")?o.json():o.text()}throw g(o),o};n.clearAPIKey=function(){o="torus-default"},n.clearEmbedHost=function(){c=""},n.enableSentryTracing=function(e,t,n){d=e,f.push(...t),h.push(...n)},n.gatewayAuthHeader=u,n.gatewayEmbedHostHeader=l,n.generateJsonRPCObject=(e,t)=>({jsonrpc:"2.0",method:e,id:10,params:t}),n.get=y,n.getAPIKey=function(){return o},n.getEmbedHost=function(){return c},n.patch=async(e,t={},n={},r={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=s(s({},i.headers),p())),n.method="PATCH";const o=a(i,n);r.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await m(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.post=(e,t={},n={},r={})=>{const o={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(o.headers=s(s({},o.headers),p())),n.method="POST";const c=a(o,n);return r.isUrlEncodedData?(c.body=t,"application/json; charset=utf-8"===c.headers["Content-Type"]&&delete c.headers["Content-Type"]):c.body=JSON.stringify(t),b(r.timeout||6e4,m(e,c).then(e=>{if(r.logTracingHeader&&function(e){const t=e.headers.get("x-web3-correlation-id");t&&i.info(`Request tracing with traceID = ${t}`)}(e),e.ok){const t=e.headers.get("content-type");return null!=t&&t.includes("application/json")?e.json():e.text()}throw g(e),e}))},n.promiseRace=(e,t,n=6e4)=>Promise.race([y(e,t),new Promise((e,t)=>{setTimeout(()=>{t(new Error("timed out"))},n)})]),n.promiseTimeout=b,n.put=async(e,t={},n={},r={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=s(s({},i.headers),p())),n.method="PUT";const o=a(i,n);r.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await m(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.remove=async(e,t={},n={},r={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=s(s({},i.headers),p())),n.method="DELETE";const o=a(i,n);r.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await m(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.setAPIKey=function(e){o=e},n.setEmbedHost=function(e){c=e},n.setLogLevel=function(e){i.setLevel(e)}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@toruslabs/http-helpers",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@toruslabs/http-helpers/dist/lib.cjs/index.js"}],[3450,{"./gas-flows/DefaultGasFeeFlow.cjs":3455,"./gas-flows/LineaGasFeeFlow.cjs":3456,"./gas-flows/OptimismLayer1GasFeeFlow.cjs":3457,"./gas-flows/RandomisedEstimationsGasFeeFlow.cjs":3459,"./gas-flows/ScrollLayer1GasFeeFlow.cjs":3460,"./gas-flows/TestGasFeeFlow.cjs":3461,"./helpers/AccountsApiRemoteTransactionSource.cjs":3462,"./helpers/GasFeePoller.cjs":3463,"./helpers/IncomingTransactionHelper.cjs":3464,"./helpers/MethodDataHelper.cjs":3465,"./helpers/MultichainTrackingHelper.cjs":3466,"./helpers/PendingTransactionTracker.cjs":3467,"./helpers/ResimulateHelper.cjs":3468,"./hooks/ExtraTransactionsPublishHook.cjs":3471,"./logger.cjs":3474,"./types.cjs":3475,"./utils/balance-changes.cjs":3476,"./utils/batch.cjs":3478,"./utils/eip7702.cjs":3479,"./utils/external-transactions.cjs":3480,"./utils/feature-flags.cjs":3481,"./utils/first-time-interaction.cjs":3482,"./utils/gas-fee-tokens.cjs":3483,"./utils/gas-fees.cjs":3484,"./utils/gas-flow.cjs":3485,"./utils/gas.cjs":3486,"./utils/layer1-gas-fee-flow.cjs":3487,"./utils/nonce.cjs":3488,"./utils/prepare.cjs":3489,"./utils/retry.cjs":3490,"./utils/swaps.cjs":3492,"./utils/transaction-type.cjs":3493,"./utils/utils.cjs":3494,"./utils/validation.cjs":3495,"@metamask/base-controller":1520,"@metamask/controller-utils":1639,"@metamask/eth-query":2226,"@metamask/network-controller":2751,"@metamask/nonce-tracker":2771,"@metamask/rpc-errors":3026,"@metamask/utils":3554,events:4770,lodash:5239,uuid:6134},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y,w,T,S,E,k,P,v,I,_,A,C,j,x,R,O,F,N,M,L,G,D,B,U,H,$,q,K,W,z,V,J,Y,X,Q,Z,ee,te,ne,se,ae,re,ie,oe,ce,ue,le,de,fe,he,me,pe,ge,be,ye,we,Te,Se,Ee,ke,Pe,ve,Ie,_e,Ae,Ce,je,xe,Re,Oe,Fe,Ne,Me,Le,Ge,De,Be,Ue,He,$e,qe,Ke,We,ze,Ve,Je,Ye,Xe,Qe,Ze,et,tt=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},nt=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},st=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionController=n.ApprovalState=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;const at=e("@metamask/base-controller"),rt=e("@metamask/controller-utils"),it=st(e("@metamask/eth-query")),ot=e("@metamask/network-controller"),ct=e("@metamask/nonce-tracker"),ut=e("@metamask/rpc-errors"),lt=e("@metamask/utils"),dt=e("events"),ft=e("lodash"),ht=e("uuid"),mt=e("./gas-flows/DefaultGasFeeFlow.cjs"),pt=e("./gas-flows/LineaGasFeeFlow.cjs"),gt=e("./gas-flows/OptimismLayer1GasFeeFlow.cjs"),bt=e("./gas-flows/RandomisedEstimationsGasFeeFlow.cjs"),yt=e("./gas-flows/ScrollLayer1GasFeeFlow.cjs"),wt=e("./gas-flows/TestGasFeeFlow.cjs"),Tt=e("./helpers/AccountsApiRemoteTransactionSource.cjs"),St=e("./helpers/GasFeePoller.cjs"),Et=e("./helpers/IncomingTransactionHelper.cjs"),kt=e("./helpers/MethodDataHelper.cjs"),Pt=e("./helpers/MultichainTrackingHelper.cjs"),vt=e("./helpers/PendingTransactionTracker.cjs"),It=e("./helpers/ResimulateHelper.cjs"),_t=e("./hooks/ExtraTransactionsPublishHook.cjs"),At=e("./logger.cjs"),Ct=e("./types.cjs"),jt=e("./utils/balance-changes.cjs"),xt=e("./utils/batch.cjs"),Rt=e("./utils/eip7702.cjs"),Ot=e("./utils/external-transactions.cjs"),Ft=e("./utils/feature-flags.cjs"),Nt=e("./utils/first-time-interaction.cjs"),Mt=e("./utils/gas.cjs"),Lt=e("./utils/gas-fee-tokens.cjs"),Gt=e("./utils/gas-fees.cjs"),Dt=e("./utils/gas-flow.cjs"),Bt=e("./utils/layer1-gas-fee-flow.cjs"),Ut=e("./utils/nonce.cjs"),Ht=e("./utils/prepare.cjs"),$t=e("./utils/retry.cjs"),qt=e("./utils/swaps.cjs"),Kt=e("./utils/transaction-type.cjs"),Wt=e("./utils/utils.cjs"),zt=e("./utils/validation.cjs"),Vt={transactions:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},transactionBatches:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},methodData:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastFetchedBlockNumbers:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},submitHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};n.CANCEL_RATE=1.1,n.SPEED_UP_RATE=1.1;const Jt="TransactionController";var Yt;!function(e){e.Approved="approved",e.NotApproved="not-approved",e.SkippedViaBeforePublishHook="skipped-via-before-publish-hook"}(Yt||(n.ApprovalState=Yt={}));class Xt extends at.BaseController{constructor(e){const{disableSwaps:t,getCurrentAccountEIP1559Compatibility:n,getCurrentNetworkEIP1559Compatibility:$,getExternalPendingTransactions:q,getGasFeeEstimates:K,getNetworkClientRegistry:W,getNetworkState:V,getPermittedAccounts:J,getSavedGasFees:Y,getSimulationConfig:X,hooks:Q,incomingTransactions:ee={},isAutomaticGasFeeUpdateEnabled:te,isEIP7702GasFeeTokensEnabled:ne,isFirstTimeInteractionEnabled:se,isSimulationEnabled:ae,messenger:re,pendingTransactions:ie={},publicKeyEIP7702:oe,securityProviderRequest:ce,sign:ue,state:de,testGasFeeFlows:fe,trace:he}=e;super({name:Jt,metadata:Vt,messenger:re,state:{methodData:{},transactions:[],transactionBatches:[],lastFetchedBlockNumbers:{},submitHistory:[],...de}}),s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,new Set),c.set(this,void 0),u.set(this,void 0),l.set(this,void 0),d.set(this,void 0),f.set(this,void 0),h.set(this,void 0),m.set(this,void 0),p.set(this,void 0),g.set(this,void 0),b.set(this,void 0),y.set(this,void 0),w.set(this,void 0),T.set(this,void 0),S.set(this,void 0),E.set(this,void 0),k.set(this,new dt.EventEmitter),P.set(this,void 0),v.set(this,void 0),I.set(this,void 0),_.set(this,void 0),A.set(this,void 0),C.set(this,void 0),j.set(this,void 0),x.set(this,void 0),R.set(this,void 0),O.set(this,void 0),F.set(this,void 0),N.set(this,void 0),M.set(this,void 0),L.set(this,void 0),G.set(this,void 0),D.set(this,new Map),B.set(this,new Set),U.set(this,void 0),H.set(this,void 0),_e.set(this,()=>{nt(this,R,"f").checkForPendingTransactionAndStartPolling()}),this.messenger=re,tt(this,a,Q?.afterAdd??(()=>Promise.resolve({})),"f"),tt(this,r,Q?.afterSign??(()=>!0),"f"),tt(this,i,Q?.afterSimulate??(()=>Promise.resolve({})),"f"),tt(this,c,Q?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),tt(this,u,Q?.beforePublish??(()=>Promise.resolve(!0)),"f"),tt(this,l,Q?.beforeSign??(()=>Promise.resolve({})),"f"),tt(this,f,Q?.getAdditionalSignArguments??(()=>[]),"f"),tt(this,h,n??(()=>Promise.resolve(!0)),"f"),tt(this,m,$,"f"),tt(this,p,q??(()=>[]),"f"),tt(this,g,K??(()=>Promise.resolve({})),"f"),tt(this,b,V,"f"),tt(this,y,J,"f"),tt(this,w,Y??(e=>undefined),"f"),tt(this,T,X??(()=>Promise.resolve({})),"f"),tt(this,E,ee,"f"),tt(this,P,te??(e=>!1),"f"),tt(this,v,ne??(()=>Promise.resolve(!1)),"f"),tt(this,I,se??(()=>!0),"f"),tt(this,_,ae??(()=>!0),"f"),tt(this,A,t??!1,"f"),tt(this,C,Q?.isTimeoutEnabled??(()=>!0),"f"),tt(this,O,ie,"f"),tt(this,F,oe,"f"),tt(this,N,Q?.publish??(()=>Promise.resolve({transactionHash:undefined})),"f"),tt(this,M,Q?.publishBatch,"f"),tt(this,L,ce,"f"),tt(this,G,ue,"f"),tt(this,U,!0===fe,"f"),tt(this,H,he??((e,t)=>t?.()),"f");const me=e=>this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);tt(this,R,new Pt.MultichainTrackingHelper({findNetworkClientIdByChainId:me,getNetworkClientById:e=>this.messenger.call("NetworkController:getNetworkClientById",e),getNetworkClientRegistry:W,removePendingTransactionTrackerListeners:nt(this,s,"m",je).bind(this),createNonceTracker:nt(this,s,"m",ve).bind(this),createPendingTransactionTracker:nt(this,s,"m",Ie).bind(this),onNetworkStateChange:e=>{this.messenger.subscribe("NetworkController:stateChange",e)}}),"f"),nt(this,R,"f").initialize(),tt(this,d,nt(this,s,"m",Ne).call(this),"f"),tt(this,j,nt(this,s,"m",Me).call(this),"f");const pe=new St.GasFeePoller({findNetworkClientIdByChainId:me,gasFeeFlows:nt(this,d,"f"),getGasFeeControllerEstimates:nt(this,g,"f"),getProvider:e=>nt(this,s,"m",le).call(this,{networkClientId:e}),getTransactions:()=>this.state.transactions,getTransactionBatches:()=>this.state.transactionBatches,layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,onStateChange:e=>{this.messenger.subscribe("TransactionController:stateChange",e)}});pe.hub.on("transaction-updated",nt(this,s,"m",De).bind(this)),pe.hub.on("transaction-batch-updated",nt(this,s,"m",Be).bind(this)),tt(this,x,new kt.MethodDataHelper({getProvider:e=>nt(this,s,"m",le).call(this,{networkClientId:e}),getState:()=>this.state.methodData}),"f"),nt(this,x,"f").hub.on("update",({fourBytePrefix:e,methodData:t})=>{this.update(n=>{n.methodData[e]=t})}),tt(this,S,new Et.IncomingTransactionHelper({client:nt(this,E,"f").client,getCurrentAccount:()=>nt(this,s,"m",He).call(this),getLocalTransactions:()=>this.state.transactions,includeTokenTransfers:nt(this,E,"f").includeTokenTransfers,isEnabled:nt(this,E,"f").isEnabled,messenger:this.messenger,remoteTransactionSource:new Tt.AccountsApiRemoteTransactionSource,trimTransactions:nt(this,s,"m",Z).bind(this),updateTransactions:nt(this,E,"f").updateTransactions}),"f"),nt(this,s,"m",Ce).call(this,nt(this,S,"f")),this.messenger.subscribe("TransactionController:stateChange",nt(this,_e,"f")),new It.ResimulateHelper({simulateTransaction:nt(this,s,"m",Ge).bind(this),onTransactionsUpdate:e=>{this.messenger.subscribe("TransactionController:stateChange",e,e=>e.transactions)},getTransactions:()=>this.state.transactions}),nt(this,s,"m",z).call(this),nt(this,_e,"f").call(this),nt(this,s,"m",We).call(this)}destroy(){nt(this,s,"m",Ae).call(this)}async handleMethodData(e,t){return nt(this,x,"f").lookup(e,t)}async addTransactionBatch(e){const{blockTracker:t}=this.messenger.call("NetworkController:getNetworkClientById",e.networkClientId);return await(0,xt.addTransactionBatch)({addTransaction:this.addTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getChainId:nt(this,s,"m",oe).bind(this),getEthQuery:e=>nt(this,s,"m",ue).call(this,{networkClientId:e}),getGasFeeEstimates:nt(this,g,"f"),getInternalAccounts:nt(this,s,"m",$e).bind(this),getSimulationConfig:nt(this,T,"f").bind(this),getPendingTransactionTracker:e=>nt(this,s,"m",Ie).call(this,{provider:nt(this,s,"m",le).call(this,{networkClientId:e}),blockTracker:t,chainId:nt(this,s,"m",oe).call(this,e),networkClientId:e}),getTransaction:e=>nt(this,s,"m",ae).call(this,e),isSimulationEnabled:nt(this,_,"f"),messenger:this.messenger,publishBatchHook:nt(this,M,"f"),publicKeyEIP7702:nt(this,F,"f"),publishTransaction:(e,t)=>nt(this,s,"m",X).call(this,e,t),request:e,signTransaction:nt(this,s,"m",Te).bind(this),update:this.update.bind(this),updateTransaction:nt(this,s,"m",Le).bind(this)})}async isAtomicBatchSupported(e){return(0,xt.isAtomicBatchSupported)({...e,getEthQuery:e=>nt(this,s,"m",ue).call(this,{chainId:e}),messenger:this.messenger,publicKeyEIP7702:nt(this,F,"f")})}async addTransaction(e,t){(0,At.projectLogger)("Adding transaction",e,t);const{actionId:n,assetsFiatValues:r,batchId:i,deviceConfirmedOn:o,disableGasBuffer:c,gasFeeToken:u,isGasFeeIncluded:l,isGasFeeSponsored:d,isStateOnly:f,method:h,nestedTransactions:m,networkClientId:p,origin:g,publishHook:b,requestId:w,requiredAssets:T,requireApproval:S,securityAlertResponse:E,skipInitialGasEstimate:k,swaps:P={},traceContext:v,type:_}=t;if(e=(0,Wt.normalizeTransactionParams)(e),!nt(this,R,"f").has(p))throw new Error(`Network client not found - ${p}`);const C=nt(this,s,"m",oe).call(this,p),j=nt(this,s,"m",ue).call(this,{networkClientId:p}),x=g===undefined?undefined:await(nt(this,y,"f")?.call(this,g)),O=nt(this,s,"m",$e).call(this);await(0,zt.validateTransactionOrigin)({data:e.data,from:e.from,internalAccounts:O,origin:g,permittedAddresses:x,txParams:e,type:_});const F=(0,Rt.getDelegationAddress)(e.from,j).catch(()=>undefined),N=await nt(this,s,"m",we).call(this,p);(0,zt.validateTxParams)(e,N,C),e.type||(0,Wt.setEnvelopeType)(e,N);if(i?.length&&this.state.transactions.some(e=>e.batchId?.toLowerCase()===i?.toLowerCase())&&g&&g!==rt.ORIGIN_METAMASK)throw new ut.JsonRpcError(zt.ErrorCode.DuplicateBundleId,"Batch ID already exists");const M=nt(this,s,"m",fe).call(this,e,g),G=_??(await(0,Kt.determineTransactionType)(e,j)).type,D=nt(this,s,"m",ge).call(this,n);let B=D?(0,ft.cloneDeep)(D):{actionId:n,assetsFiatValues:r,batchId:i,chainId:C,dappSuggestedGasFees:M,deviceConfirmedOn:o,disableGasBuffer:c,id:(0,ht.v1)(),isGasFeeTokenIgnoredIfBalance:Boolean(u),isGasFeeIncluded:l,isGasFeeSponsored:d,isFirstTimeInteraction:undefined,isStateOnly:f,nestedTransactions:m,networkClientId:p,origin:g,requestId:w,requiredAssets:T,securityAlertResponse:E,selectedGasFeeToken:u,status:Ct.TransactionStatus.unapproved,time:Date.now(),txParams:e,type:G,userEditedGasLimit:!1,verifiedOnBlockchain:!1};const{updateTransaction:U}=await nt(this,a,"f").call(this,{transactionMeta:B});if(U&&((0,At.projectLogger)("Updating transaction using afterAdd hook"),B.txParamsOriginal=(0,ft.cloneDeep)(B.txParams),U(B)),k){const e=(0,ft.cloneDeep)(B);nt(this,s,"m",W).call(this,e).then(()=>(nt(this,s,"m",Le).call(this,{transactionId:e.id,skipResimulateCheck:!0,skipValidation:!0},t=>{t.txParams.gas=e.txParams.gas,t.txParams.gasPrice=e.txParams.gasPrice,t.txParams.maxFeePerGas=e.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas}),undefined)).catch(ft.noop)}else await nt(this,H,"f").call(this,{name:"Estimate Gas Properties",parentContext:v},e=>nt(this,s,"m",W).call(this,B,{traceContext:e}));if(!D){if(h&&nt(this,L,"f")){const e=await nt(this,L,"f").call(this,B,h);B.securityProviderResponse=e}B=(0,qt.updateSwapsTransaction)(B,G,P,{isSwapsDisabled:nt(this,A,"f"),cancelTransaction:nt(this,s,"m",Q).bind(this),messenger:this.messenger}),nt(this,s,"m",K).call(this,B),F.then(e=>(nt(this,s,"m",Le).call(this,{transactionId:B.id,skipResimulateCheck:!0,skipValidation:!0},t=>{t.delegationAddress=e}),undefined)).catch(ft.noop),!1===S||f?(0,At.projectLogger)("Skipping simulation & first interaction update as approval not required"):(nt(this,s,"m",Ge).call(this,B,{traceContext:v}).catch(e=>{throw(0,At.projectLogger)("Error while updating simulation data",e),e}),(0,Nt.updateFirstTimeInteraction)({existingTransactions:this.state.transactions,getTransaction:e=>nt(this,s,"m",se).call(this,e),isFirstTimeInteractionEnabled:nt(this,I,"f"),trace:nt(this,H,"f"),traceContext:v,transactionMeta:B,updateTransaction:nt(this,s,"m",Le).bind(this)}).catch(e=>{(0,At.projectLogger)("Error while updating first interaction properties",e)})),this.messenger.publish(`${Jt}:unapprovedTransactionAdded`,B)}return{result:nt(this,s,"m",J).call(this,B,{actionId:n,isExisting:Boolean(D),publishHook:b,requireApproval:S,traceContext:v}),transactionMeta:B}}startIncomingTransactionPolling(){nt(this,S,"f").start()}stopIncomingTransactionPolling(){nt(this,S,"f").stop()}async updateIncomingTransactions({tags:e}={}){await nt(this,S,"f").update({tags:e})}async stopTransaction(e,t,{estimatedBaseFee:a,actionId:r}={}){await nt(this,s,"m",$).call(this,{actionId:r,estimatedBaseFee:a,gasValues:t,label:"cancel",rate:n.CANCEL_RATE,transactionId:e,transactionType:Ct.TransactionType.cancel,prepareTransactionParams:e=>{delete e.data,e.to=e.from,e.value="0x0"},afterSubmit:e=>{this.messenger.publish(`${Jt}:transactionFinished`,e),nt(this,k,"f").emit(`${e.id}:finished`,e)}})}async speedUpTransaction(e,t,{actionId:a,estimatedBaseFee:r}={}){await nt(this,s,"m",$).call(this,{actionId:a,estimatedBaseFee:r,gasValues:t,label:"speed up",rate:n.SPEED_UP_RATE,transactionId:e,transactionType:Ct.TransactionType.retry,afterSubmit:e=>{this.messenger.publish(`${Jt}:speedupTransactionAdded`,e)}})}async estimateGas(e,t,{ignoreDelegationSignatures:n}={}){const a=nt(this,s,"m",ue).call(this,{networkClientId:t}),{estimatedGas:r,simulationFails:i}=await(0,Mt.estimateGas)({chainId:nt(this,s,"m",oe).call(this,t),ethQuery:a,ignoreDelegationSignatures:n,isSimulationEnabled:nt(this,_,"f").call(this),getSimulationConfig:nt(this,T,"f"),messenger:this.messenger,txParams:e});return{gas:r,simulationFails:i}}async estimateGasBatch({chainId:e,from:t,transactions:n}){const a=nt(this,s,"m",ue).call(this,{chainId:e});return(0,Mt.estimateGasBatch)({chainId:e,ethQuery:a,from:t,getSimulationConfig:nt(this,T,"f"),isAtomicBatchSupported:this.isAtomicBatchSupported.bind(this),messenger:this.messenger,transactions:n})}async estimateGasBuffered(e,t,n){const a=nt(this,s,"m",ue).call(this,{networkClientId:n}),{blockGasLimit:r,estimatedGas:i,simulationFails:o}=await(0,Mt.estimateGas)({chainId:nt(this,s,"m",oe).call(this,n),ethQuery:a,isSimulationEnabled:nt(this,_,"f").call(this),getSimulationConfig:nt(this,T,"f"),messenger:this.messenger,txParams:e});return{gas:(0,Mt.addGasBuffer)(i,r,t),simulationFails:o}}updateTransaction(e,t){const{id:n}=e;nt(this,s,"m",Le).call(this,{transactionId:n},()=>({...e})),(0,At.projectLogger)("Transaction updated",{transactionId:n,note:t})}updateSecurityAlertResponse(e,t){if(!t)throw new Error("updateSecurityAlertResponse: securityAlertResponse should not be null");const n=nt(this,s,"m",se).call(this,e);if(!n)throw new Error("Cannot update security alert response as no transaction metadata found");const a={...n,securityAlertResponse:t};this.updateTransaction(a,`${Jt}:updatesecurityAlertResponse - securityAlertResponse updated`)}wipeTransactions({address:e,chainId:t}={}){if(!t&&!e)return void this.update(e=>{e.transactions=[]});const n=this.state.transactions.filter(({chainId:n,txParams:s,type:a})=>{if(!(!t||t===n))return!0;return!(!e||s.from?.toLowerCase()===e.toLowerCase()||a===Ct.TransactionType.incoming&&s.to?.toLowerCase()===e.toLowerCase())});this.update(e=>{e.transactions=nt(this,s,"m",Z).call(this,n)})}updateTransactionSendFlowHistory(e,t,n){return nt(this,s,"m",ae).call(this,e)}async confirmExternalTransaction(e,t,n){const a=nt(this,s,"m",he).call(this,e);try{const e=a.id,r={...a,status:Ct.TransactionStatus.confirmed,txReceipt:t};n&&(r.baseFeePerGas=n),nt(this,s,"m",me).call(this,e),this.updateTransaction(r,`${Jt}:confirmExternalTransaction - Add external transaction`),nt(this,s,"m",Se).call(this,r),nt(this,s,"m",Pe).call(this,r).catch(e=>{throw(0,At.projectLogger)("Error while updating post balance",e),e}),this.messenger.publish(`${Jt}:transactionConfirmed`,r)}catch(e){console.error("Failed to confirm external transaction",e)}}updateTransactionGasFees(e,{defaultGasEstimates:t,estimateUsed:n,estimateSuggested:a,gas:r,gasLimit:i,gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:u,originalGasEstimate:l,userEditedGasLimit:d,userFeeLevel:f}){const h=nt(this,s,"m",se).call(this,e);if(!h)throw new Error("Cannot update transaction as no transaction metadata found");(0,Wt.validateIfTransactionUnapproved)(h,"updateTransactionGasFees");const m=(0,ft.cloneDeep)(h),p=h.gasFeeEstimates,g=nt(this,P,"f").call(this,h),b=f,y=Object.values(Ct.GasFeeEstimateLevel).includes(b),w=p&&g&&y;w&&(0,St.updateTransactionGasEstimates)({txMeta:m,userFeeLevel:b});const T={gas:r,gasLimit:i};w?Object.assign(T,{gasPrice:m.txParams.gasPrice,maxPriorityFeePerGas:m.txParams.maxPriorityFeePerGas,maxFeePerGas:m.txParams.maxFeePerGas}):Object.assign(T,{gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:u});const S={txParams:(0,ft.pickBy)(T),defaultGasEstimates:t,estimateUsed:n,estimateSuggested:a,originalGasEstimate:l,userEditedGasLimit:d,userFeeLevel:b},E=(0,ft.pickBy)(S);return nt(this,s,"m",Le).call(this,{transactionId:e,skipResimulateCheck:!0},e=>{const{txParams:t,...n}=E;Object.assign(e,n),t&&Object.assign(e.txParams,t)}),nt(this,s,"m",se).call(this,e)}updatePreviousGasParams(e,{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:a}){const r=nt(this,s,"m",se).call(this,e);if(!r)throw new Error("Cannot update transaction as no transaction metadata found");(0,Wt.validateIfTransactionUnapproved)(r,"updatePreviousGasParams");const i={previousGas:{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:a}};i.previousGas=(0,ft.pickBy)(i.previousGas);const o=(0,ft.merge)({},r,i);return this.updateTransaction(o,`${Jt}:updatePreviousGasParams - Previous gas values updated`),nt(this,s,"m",se).call(this,e)}async getNonceLock(e,t){return nt(this,R,"f").getNonceLock(e,t)}async updateEditableParams(e,{containerTypes:t,data:n,from:a,gas:r,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c,to:u,updateType:l,value:d}){const f=nt(this,s,"m",se).call(this,e);if(!f)throw new Error("Cannot update editable params as no transaction metadata found");(0,Wt.validateIfTransactionUnapproved)(f,"updateEditableParams");const h={txParams:{data:n,from:a,to:u,value:d,gas:r,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c}};h.txParams=(0,ft.pickBy)(h.txParams);const m=(0,ft.merge)({},f,h),{networkClientId:p}=f,g=nt(this,s,"m",le).call(this,{networkClientId:p}),b=new it.default(g);if(!1!==l){const{type:e}=await(0,Kt.determineTransactionType)(m.txParams,b);m.type=e}return t&&(m.containerTypes=t),await(0,Bt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,provider:g,transactionMeta:m}),this.updateTransaction(m,`Update Editable Params for ${e}`),nt(this,s,"m",se).call(this,e)}setTransactionActive(e,t){if(!nt(this,s,"m",se).call(this,e))throw new Error(`Transaction with id ${e} not found`);nt(this,s,"m",Le).call(this,{transactionId:e,skipValidation:!0,skipResimulateCheck:!0},e=>{e.isActive=t})}async approveTransactionsWithSameNonce(e=[],{hasNonce:t}={}){if((0,At.projectLogger)("Approving transactions with same nonce",{transactions:e}),0===e.length)return"";const n=e[0],{chainId:a}=n,r=nt(this,s,"m",ce).call(this,{chainId:a}),i=(0,Ht.prepareTransaction)(a,n),c=(0,Ht.serializeTransaction)(i);if(nt(this,o,"f").has(c))return"";let u,l;nt(this,o,"f").add(c);try{const a=n.from;l=!0!==t?await this.getNonceLock(a,r):undefined;const i=l?(0,lt.add0x)(l.nextNonce.toString(16)):n.nonce;l&&(0,At.projectLogger)("Using nonce from nonce tracker",i,l.nonceDetails),u=await Promise.all(e.map(e=>(e.nonce=i,nt(this,s,"m",q).call(this,e.chainId,e))))}catch(e){throw(0,At.projectLogger)("Error while signing transactions with same nonce",e),e}finally{l?.releaseLock(),nt(this,o,"f").delete(c)}return u}updateCustodialTransaction(e){const{transactionId:t,errorMessage:n,hash:a,status:r,gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:u,nonce:l,type:d}=e,f=nt(this,s,"m",se).call(this,t);if(!f)throw new Error("Cannot update custodial transaction as no transaction metadata found");if(r&&![Ct.TransactionStatus.submitted,Ct.TransactionStatus.signed,Ct.TransactionStatus.failed].includes(r))throw new Error(`Cannot update custodial transaction with status: ${r}`);const h=(0,ft.merge)({},f,(0,ft.pickBy)({hash:a,status:r}));return h.status===Ct.TransactionStatus.submitted&&(h.submittedTime=(new Date).getTime()),h.status===Ct.TransactionStatus.failed&&(h.error=(0,Wt.normalizeTxError)(new Error(n))),h.txParams=(0,ft.merge)({},h.txParams,(0,ft.pickBy)({gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:u,nonce:l,type:d})),d===Ct.TransactionEnvelopeType.legacy&&(delete h.txParams.maxFeePerGas,delete h.txParams.maxPriorityFeePerGas),this.updateTransaction(h,`${Jt}:updateCustodialTransaction - Custodial transaction updated`),r&&[Ct.TransactionStatus.submitted,Ct.TransactionStatus.failed].includes(r)&&(this.messenger.publish(`${Jt}:transactionFinished`,h),nt(this,k,"f").emit(`${h.id}:finished`,h)),h}getTransactions({initialList:e,limit:t,searchCriteria:n={}}={}){const s=(0,ft.mapValues)(n,e=>"function"==typeof e?e:t=>t===e),a=e??this.state.transactions,r=(0,ft.sortBy)((0,ft.pickBy)(a,e=>{for(const[t,n]of Object.entries(s))if(t in e.txParams){if(!1===n(e.txParams[t]))return!1}else if(!1===n(e[t]))return!1;return!0}),"time");if(t!==undefined){const e=new Set,n=[];for(let s=r.length-1;s>-1;s--){const a=r[s],{nonce:i}=a.txParams;if(!e.has(i)){if(!(e.size<t))continue;e.add(i)}n.unshift(a)}return n}return r}async estimateGasFee({transactionParams:e,chainId:t,networkClientId:n}){const{id:s,provider:a}=nt(this,R,"f").getNetworkClient({chainId:t,networkClientId:n}),r={txParams:e,chainId:t,networkClientId:s},i=(0,Dt.getGasFeeFlow)(r,nt(this,d,"f"),this.messenger),o=new it.default(a),c=await nt(this,g,"f").call(this,{networkClientId:s});return i.getGasFees({ethQuery:o,gasFeeControllerData:c,messenger:this.messenger,transactionMeta:r})}async getLayer1GasFee({transactionParams:e,chainId:t,networkClientId:n}){const a=nt(this,s,"m",le).call(this,{chainId:t,networkClientId:n});return await(0,Bt.getTransactionLayer1GasFee)({layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,provider:a,transactionMeta:{txParams:e,chainId:t}})}clearUnapprovedTransactions(){const e=this.state.transactions.filter(({status:e})=>e!==Ct.TransactionStatus.unapproved);this.update(t=>{t.transactions=nt(this,s,"m",Z).call(this,e)})}abortTransactionSigning(e){if(!nt(this,s,"m",se).call(this,e))throw new Error("Cannot abort signing as no transaction metadata found");const t=nt(this,D,"f").get(e);if(!t)throw new Error("Cannot abort signing as transaction is not waiting for signing");t(),nt(this,D,"f").delete(e)}async updateAtomicBatchData({transactionId:e,transactionIndex:t,transactionData:n}){(0,At.projectLogger)("Updating atomic batch data",{transactionId:e,transactionIndex:t,transactionData:n});const a=nt(this,s,"m",Le).call(this,{transactionId:e},e=>{const{nestedTransactions:s,txParams:a}=e,r=a.from,i=s?.[t];if(!i)throw new Error(`Nested transaction not found with index - ${t}`);i.data=n;const o=(0,Rt.generateEIP7702BatchTransaction)(r,s);e.txParams.data=o.data}),r=(0,ft.cloneDeep)({...a,txParams:{...a.txParams,gas:undefined}});return await nt(this,s,"m",Ke).call(this,r),nt(this,s,"m",Le).call(this,{transactionId:e},e=>{e.txParams.gas=r.txParams.gas,e.simulationFails=r.simulationFails,e.gasLimitNoBuffer=r.gasLimitNoBuffer}),a.txParams.data}updateBatchTransactions({transactionId:e,batchTransactions:t}){(0,At.projectLogger)("Updating batch transactions",{transactionId:e,batchTransactions:t}),nt(this,s,"m",Le).call(this,{transactionId:e},e=>{e.batchTransactions=t})}updateSelectedGasFeeToken(e,t){nt(this,s,"m",Le).call(this,{transactionId:e},e=>{const n=e.gasFeeTokens?.some(e=>e.tokenAddress.toLowerCase()===t?.toLowerCase());if(t&&!n)throw new Error(`No matching gas fee token found with address - ${t}`);e.selectedGasFeeToken=t})}updateRequiredTransactionIds({transactionId:e,requiredTransactionIds:t,append:n}){nt(this,s,"m",Le).call(this,{transactionId:e},e=>{const{requiredTransactionIds:s}=e;e.requiredTransactionIds=[...s&&!1!==n?s:[],...t]})}emulateNewTransaction(e){const t=this.state.transactions.find(t=>t.id===e);t&&(t.type===Ct.TransactionType.swap?this.messenger.publish("TransactionController:transactionNewSwap",{transactionMeta:t}):t.type===Ct.TransactionType.swapApproval&&this.messenger.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:t}))}emulateTransactionUpdate(e){const t={...e,txParams:{...e.txParams,from:this.messenger.call("AccountsController:getSelectedAccount").address}};this.state.transactions.some(e=>e.id===t.id)||this.update(e=>{e.transactions.push(t)}),this.updateTransaction(t,"Generated from user operation"),this.messenger.publish("TransactionController:transactionStatusUpdated",{transactionMeta:t})}}n.TransactionController=Xt,a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,h=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,T=new WeakMap,S=new WeakMap,E=new WeakMap,k=new WeakMap,P=new WeakMap,v=new WeakMap,I=new WeakMap,_=new WeakMap,A=new WeakMap,C=new WeakMap,j=new WeakMap,x=new WeakMap,R=new WeakMap,O=new WeakMap,F=new WeakMap,N=new WeakMap,M=new WeakMap,L=new WeakMap,G=new WeakMap,D=new WeakMap,B=new WeakMap,U=new WeakMap,H=new WeakMap,_e=new WeakMap,s=new WeakSet,$=async function({actionId:e,afterSubmit:t,estimatedBaseFee:n,gasValues:a,label:r,prepareTransactionParams:i,rate:o,transactionId:c,transactionType:u}){if(nt(this,s,"m",ge).call(this,e))return;a&&(a=(0,Wt.normalizeGasFeeValues)(a),(0,Wt.validateGasValues)(a)),(0,At.projectLogger)(`Creating ${r} transaction`,c,a);const l=nt(this,s,"m",se).call(this,c);if(!l)return;if(!nt(this,G,"f"))throw new Error("No sign method defined.");const d=(0,$t.getTransactionParamsWithIncreasedGasFee)(l.txParams,o,a);i?.(d);const f=(0,Ht.prepareTransaction)(l.chainId,d),h=await nt(this,G,"f").call(this,f,l.txParams.from),m=nt(this,s,"m",ye).call(this,l,h),p=(0,Ht.serializeTransaction)(h),g=d.maxFeePerGas??d.gasPrice,b=d.maxFeePerGas?m.txParams.maxFeePerGas:m.txParams.gasPrice;(0,At.projectLogger)(`Submitting ${r} transaction`,{oldFee:b,newFee:g,txParams:d});const{networkClientId:y}=l,w=nt(this,s,"m",ue).call(this,{networkClientId:y}),T={...m,actionId:e,estimatedBaseFee:n,id:(0,ht.v1)(),originalGasEstimate:l.txParams.gas,originalType:l.type,rawTx:p,time:Date.now(),txParams:d,type:u},S=await nt(this,s,"m",Oe).call(this,w,{...T,origin:r});T.hash=S,nt(this,s,"m",K).call(this,T),this.messenger.publish(`${Jt}:transactionApproved`,{transactionMeta:T,actionId:e}),this.messenger.publish(`${Jt}:transactionSubmitted`,{transactionMeta:T,actionId:e}),t?.(T)},q=async function(e,t){if(!nt(this,G,"f"))throw new Error("No sign method defined.");const n=(0,Wt.normalizeTransactionParams)(t),s=(0,Wt.isEIP1559Transaction)(n)?Ct.TransactionEnvelopeType.feeMarket:Ct.TransactionEnvelopeType.legacy,a={...n,type:s,gasLimit:n.gas,chainId:e},{from:r}=a,i=(0,Ht.prepareTransaction)(e,a),o=await nt(this,G,"f").call(this,i,r);return(0,Ht.serializeTransaction)(o)},K=function(e){(0,zt.validateTxParams)(e.txParams),this.update(t=>{t.transactions=nt(this,s,"m",Z).call(this,[...t.transactions,e])})},W=async function(e,{traceContext:t}={}){const n=e.txParams.type!==Ct.TransactionEnvelopeType.legacy&&await nt(this,s,"m",we).call(this,e.networkClientId),{networkClientId:a}=e,r=nt(this,s,"m",ue).call(this,{networkClientId:a}),i=nt(this,s,"m",le).call(this,{networkClientId:a});await nt(this,H,"f").call(this,{name:"Update Gas",parentContext:t},async()=>{await nt(this,s,"m",Ke).call(this,e)}),await nt(this,H,"f").call(this,{name:"Update Gas Fees",parentContext:t},async()=>await(0,Gt.updateGasFees)({eip1559:n,ethQuery:r,gasFeeFlows:nt(this,d,"f"),getGasFeeEstimates:nt(this,g,"f"),getSavedGasFees:nt(this,w,"f").bind(this),messenger:this.messenger,txMeta:e})),await nt(this,H,"f").call(this,{name:"Update Layer 1 Gas Fees",parentContext:t},async()=>await(0,Bt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,provider:i,transactionMeta:e}))},z=function(){this.clearUnapprovedTransactions(),nt(this,s,"m",V).call(this)},V=function(){const e=this.state.transactions.filter(e=>[Ct.TransactionStatus.approved,Ct.TransactionStatus.signed].includes(e.status));for(const t of e){nt(this,s,"m",Ye).call(this,t,new Error("Transaction incomplete at startup"));const e=t.requiredTransactionIds??[];for(const t of e){const e=nt(this,s,"m",se).call(this,t);e&&!nt(this,s,"m",ee).call(this,e.status)&&nt(this,s,"m",Ye).call(this,e,new Error("Parent transaction incomplete at startup"))}}},J=async function(e,{actionId:t,isExisting:n=!1,publishHook:a,requireApproval:r,shouldShowRequest:i=!0,traceContext:o}){const{id:c,isStateOnly:u}=e;if(u)return nt(this,s,"m",Le).call(this,{transactionId:c,skipValidation:!0},e=>{e.status=Ct.TransactionStatus.submitted,e.submittedTime=(new Date).getTime()}),"";let l;const{meta:d,isCompleted:f}=nt(this,s,"m",ie).call(this,c),h=f?Promise.resolve(d):nt(this,s,"m",be).call(this,c);if(d&&!n&&!f)try{if(!1!==r){const t=await nt(this,H,"f").call(this,{name:"Await Approval",parentContext:o},t=>nt(this,s,"m",ne).call(this,e,{shouldShowRequest:i,traceContext:t}));l=t.resultCallbacks;const n=t.value,a=n?.txMeta;a&&((0,At.projectLogger)("Updating transaction with approval data",{customNonce:a.customNonceValue,params:a.txParams}),this.updateTransaction(a,"TransactionController#processApproval - Updated with approval data"))}const{isCompleted:n}=nt(this,s,"m",ie).call(this,c);if(!n){const e=await nt(this,s,"m",Y).call(this,c,o,a);e===Yt.SkippedViaBeforePublishHook&&l&&l.success();const n=nt(this,s,"m",se).call(this,c);e===Yt.Approved&&this.messenger.publish(`${Jt}:transactionApproved`,{transactionMeta:n,actionId:t})}}catch(e){const n=e,{isCompleted:a}=nt(this,s,"m",ie).call(this,c);a||(nt(this,s,"m",Ve).call(this,n)?nt(this,s,"m",Je).call(this,c,t,n):nt(this,s,"m",Ye).call(this,d,n,t))}finally{nt(this,B,"f").delete(c)}const m=await h;switch(m?.status){case Ct.TransactionStatus.failed:{const e=m.error;throw l?.error(e),ut.rpcErrors.internal(e.message)}case Ct.TransactionStatus.submitted:return l?.success(),m.hash;default:{const e=ut.rpcErrors.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(m??c)}`);throw l?.error(e),e}}},Y=async function(e,t,n){let a,r,i=nt(this,s,"m",ae).call(this,e);(0,At.projectLogger)("Approving transaction",i);try{if(!nt(this,G,"f"))return nt(this,s,"m",Ye).call(this,i,new Error("No sign method defined.")),Yt.NotApproved;if(!i.chainId)return nt(this,s,"m",Ye).call(this,i,new Error("No chainId defined.")),Yt.NotApproved;if(nt(this,o,"f").has(e))return(0,At.projectLogger)("Skipping approval as signing in progress",e),Yt.NotApproved;nt(this,o,"f").add(e),a=()=>nt(this,o,"f").delete(e);const{networkClientId:c}=i,l=nt(this,s,"m",ue).call(this,{networkClientId:c}),[d,f]=await(0,Ut.getNextNonce)(i,e=>nt(this,R,"f").getNonceLock(e,i.networkClientId));r=f,i=nt(this,s,"m",Le).call(this,{transactionId:e},e=>{const{chainId:t,txParams:n}=e,{gas:s,type:a}=n;e.status=Ct.TransactionStatus.approved,e.txParams.chainId=t,e.txParams.gasLimit=s,e.txParams.nonce=d,!a&&(0,Wt.isEIP1559Transaction)(n)&&(e.txParams.type=Ct.TransactionEnvelopeType.feeMarket)}),nt(this,s,"m",Se).call(this,i);const h=await nt(this,H,"f").call(this,{name:"Sign",parentContext:t},()=>nt(this,s,"m",Te).call(this,i));if(i=nt(this,s,"m",ae).call(this,e),!await nt(this,u,"f").call(this,i))return(0,At.projectLogger)("Skipping publishing transaction based on hook"),this.messenger.publish(`${Jt}:transactionPublishingSkipped`,i),Yt.SkippedViaBeforePublishHook;if(!h&&!i.isExternalSign)return Yt.NotApproved;let m;const p=i.type===Ct.TransactionType.swap;p&&((0,At.projectLogger)("Determining pre-transaction balance"),m=await(0,rt.query)(l,"getBalance",[i.txParams.from])),(0,At.projectLogger)("Publishing transaction",i.txParams),r?.(),r=undefined;let g=nt(this,s,"m",Qe).bind(this,{ethQuery:l,publishHookOverride:n,traceContext:t});if(i.batchTransactions?.length){(0,At.projectLogger)("Found batch transactions",i.batchTransactions);g=new _t.ExtraTransactionsPublishHook({addTransactionBatch:this.addTransactionBatch.bind(this),getTransaction:nt(this,s,"m",ae).bind(this),originalPublishHook:g}).getHook()}const{transactionHash:b}=await g(i,h??"0x");return i=nt(this,s,"m",Le).call(this,{transactionId:e},e=>{e.hash=b,e.status=Ct.TransactionStatus.submitted,e.submittedTime=(new Date).getTime(),p&&(e.preTxBalance=m,(0,At.projectLogger)("Updated pre-transaction balance",m))}),this.messenger.publish(`${Jt}:transactionSubmitted`,{transactionMeta:i}),this.messenger.publish(`${Jt}:transactionFinished`,i),nt(this,k,"f").emit(`${e}:finished`,i),nt(this,s,"m",Se).call(this,i),Yt.Approved}catch(e){return nt(this,s,"m",Ye).call(this,i,e),Yt.NotApproved}finally{a?.(),r?.()}},X=async function(e,t,{skipSubmitHistory:n}={}){try{const a=await(0,rt.query)(e,"sendRawTransaction",[t.rawTx]);return!0!==n&&nt(this,s,"m",qe).call(this,t,a),a}catch(e){const t=e,n=t?.data?.message??t?.message??String(e);throw new Error(n)}},Q=function(e,t,n){const a=nt(this,s,"m",se).call(this,e);if(!a)return;nt(this,s,"m",ze).call(this,e);const r={...a,status:Ct.TransactionStatus.rejected,error:(0,Wt.normalizeTxError)(n??ut.providerErrors.userRejectedRequest())};this.messenger.publish(`${Jt}:transactionFinished`,r),nt(this,k,"f").emit(`${a.id}:finished`,r),this.messenger.publish(`${Jt}:transactionRejected`,{transactionMeta:r,actionId:t}),nt(this,s,"m",Se).call(this,r)},Z=function(e){const t=new Set,n=(0,Ft.getTransactionHistoryLimit)(this.messenger),a=[...e].sort((e,t)=>e.time>t.time?-1:1).filter(e=>{const{chainId:a,status:r,txParams:i,time:o}=e;if(i){const e=`${String(i.nonce)}-${(0,rt.convertHexToDecimal)(a)}-${new Date(o).toDateString()}`;if(t.has(e))return!0;if(t.size<n||!nt(this,s,"m",ee).call(this,r))return t.add(e),!0}return!1});return a.reverse(),a},ee=function(e){return e===Ct.TransactionStatus.rejected||e===Ct.TransactionStatus.confirmed||e===Ct.TransactionStatus.failed||e===Ct.TransactionStatus.dropped},te=function(e){return[Ct.TransactionStatus.confirmed,Ct.TransactionStatus.failed,Ct.TransactionStatus.rejected,Ct.TransactionStatus.submitted].includes(e)},ne=async function(e,{shouldShowRequest:t,traceContext:n}){const a=nt(this,s,"m",re).call(this,e),{origin:r}=e,i=rt.ApprovalType.Transaction,o={txId:e.id};return await nt(this,H,"f").call(this,{name:"Notification Display",id:a,parentContext:n}),await this.messenger.call("ApprovalController:addRequest",{id:a,origin:r??rt.ORIGIN_METAMASK,type:i,requestData:o,expectsResult:!0},t)},se=function(e){const{transactions:t}=this.state;return t.find(({id:t})=>t===e)},ae=function(e,t="TransactionController"){const n=nt(this,s,"m",se).call(this,e);if(!n)throw new Error(`${t}: No transaction found with id ${e}`);return n},re=function(e){return String(e.id)},ie=function(e){const t=nt(this,s,"m",se).call(this,e);if(!t)return{meta:undefined,isCompleted:!1};return{meta:t,isCompleted:nt(this,s,"m",te).call(this,t.status)}},oe=function(e){return nt(this,R,"f").getNetworkClient({networkClientId:e}).configuration.chainId},ce=function({chainId:e,networkClientId:t}){return t||nt(this,R,"f").getNetworkClient({chainId:e}).id},ue=function({chainId:e,networkClientId:t}){return new it.default(nt(this,s,"m",le).call(this,{chainId:e,networkClientId:t}))},le=function({chainId:e,networkClientId:t}){return nt(this,R,"f").getNetworkClient({chainId:e,networkClientId:t}).provider},de=function(e){if(!e.length)return;const t=[];for(const n of e){const{chainId:e}=n;try{const a=nt(this,s,"m",ce).call(this,{chainId:e});t.push({...n,networkClientId:a})}catch(t){(0,At.projectLogger)("Failed to get network client ID for incoming transaction",{chainId:e,error:t})}}this.update(e=>{const{transactions:n}=e;e.transactions=nt(this,s,"m",Z).call(this,[...t,...n]),(0,At.projectLogger)("Added incoming transactions to state",t.length,t)}),this.messenger.publish(`${Jt}:incomingTransactionsReceived`,t)},fe=function(e,t){if(!t||t===rt.ORIGIN_METAMASK)return undefined;const{gasPrice:n,maxFeePerGas:s,maxPriorityFeePerGas:a,gas:r}=e;if(n===undefined&&s===undefined&&a===undefined&&r===undefined)return undefined;const i={};return n!==undefined?i.gasPrice=n:s===undefined&&a===undefined||(i.maxFeePerGas=s,i.maxPriorityFeePerGas=a),r!==undefined&&(i.gas=r),i},he=function(e){const{chainId:t}=e,{transactions:n}=this.state,a=e?.txParams?.from,r=n.filter(e=>e.txParams.from===a&&e.chainId===t),i=r.filter(e=>e.status===Ct.TransactionStatus.confirmed),o=r.filter(e=>e.status===Ct.TransactionStatus.submitted);return(0,Ot.validateConfirmedExternalTransaction)(e,i,o),this.update(t=>{t.transactions=nt(this,s,"m",Z).call(this,[...t.transactions,e])}),e},me=function(e){const t=nt(this,s,"m",se).call(this,e);if(!t)return;const n=t.txParams?.nonce,a=t.txParams?.from,{chainId:r}=t,i=this.state.transactions.filter(t=>t.id!==e&&t.txParams.from===a&&n&&t.txParams.nonce===n&&t.chainId===r&&t.type!==Ct.TransactionType.incoming&&t.isTransfer===undefined),o=i.map(e=>e.id);if(0!==i.length){this.update(e=>{for(const n of e.transactions)o.includes(n.id)&&(n.replacedBy=t?.hash,n.replacedById=t?.id)});for(const e of this.state.transactions)o.includes(e.id)&&e.status!==Ct.TransactionStatus.failed&&nt(this,s,"m",pe).call(this,e)}},pe=function(e){const t={...e,status:Ct.TransactionStatus.dropped};this.messenger.publish(`${Jt}:transactionDropped`,{transactionMeta:t}),this.updateTransaction(t,"TransactionController#setTransactionStatusDropped - Transaction dropped"),nt(this,s,"m",Se).call(this,t)},ge=function(e){return this.state.transactions.find(t=>e&&t.actionId===e)},be=async function(e){return new Promise(t=>{nt(this,k,"f").once(`${e}:finished`,e=>{t(e)})})},ye=function(e,t){const n=(0,ft.cloneDeep)(e);for(const e of["r","s","v"]){const s=t[e];s!==undefined&&null!==s&&(n[e]=(0,lt.add0x)(s.toString(16)))}return n},we=async function(e){const t=await nt(this,m,"f").call(this,e),n=await nt(this,h,"f").call(this);return t&&n},Te=async function(e){let t=e;const{id:n}=t;(0,At.projectLogger)("Calling before sign hook",t);const{updateTransaction:a}=await nt(this,l,"f").call(this,{transactionMeta:t})??{};a&&(nt(this,s,"m",Le).call(this,{transactionId:n,skipResimulateCheck:!0},a),(0,At.projectLogger)("Updated transaction after before sign hook")),t=nt(this,s,"m",ae).call(this,n);const{networkClientId:i}=t,c=nt(this,s,"m",ue).call(this,{networkClientId:i});await(0,Lt.checkGasFeeTokenBeforePublish)({ethQuery:c,fetchGasFeeTokens:async e=>(await nt(this,s,"m",Ze).call(this,e)).gasFeeTokens,transaction:t,updateTransaction:(e,t)=>nt(this,s,"m",Le).call(this,{transactionId:e},t)}),t=nt(this,s,"m",ae).call(this,n);const{chainId:u,isExternalSign:d,txParams:h}=t;if(d)return(0,At.projectLogger)("Skipping sign as signed externally"),undefined;const{authorizationList:m,from:p}=h,g=await(0,Rt.signAuthorizationList)({authorizationList:m,messenger:this.messenger,transactionMeta:t});g&&nt(this,s,"m",Le).call(this,{transactionId:n},e=>{e.txParams.authorizationList=g}),t=nt(this,s,"m",ae).call(this,n);const b=nt(this,s,"m",ae).call(this,n),{txParams:y}=b,w=(0,Ht.prepareTransaction)(u,y);nt(this,o,"f").add(n),(0,At.projectLogger)("Signing transaction",y);const T=await new Promise((e,t)=>{nt(this,G,"f")?.call(this,w,p,...nt(this,f,"f").call(this,b)).then(e,t),nt(this,D,"f").set(n,()=>t(new Error("Signing aborted by user")))});if(nt(this,D,"f").delete(n),!T)return(0,At.projectLogger)("Skipping signed status as no signed transaction"),undefined;const S=(0,ft.cloneDeep)(b);if(!nt(this,r,"f").call(this,S,T))return this.updateTransaction(S,"TransactionController#signTransaction - Update after sign"),(0,At.projectLogger)("Skipping signed status based on hook"),undefined;const E={...nt(this,s,"m",ye).call(this,S,T),status:Ct.TransactionStatus.signed,txParams:y};this.updateTransaction(E,"TransactionController#approveTransaction - Transaction signed"),nt(this,s,"m",Se).call(this,E);const k=(0,Ht.serializeTransaction)(T),P=(0,ft.merge)({},E,{rawTx:k});return this.updateTransaction(P,"TransactionController#approveTransaction - RawTransaction added"),k},Se=function(e){this.messenger.publish(`${Jt}:transactionStatusUpdated`,{transactionMeta:e})},Ee=function(e,t,n){return(0,Ut.getAndFormatTransactionsForNonceTracker)(n,t,e,this.state.transactions)},ke=function(e){(0,At.projectLogger)("Processing confirmed transaction",e.id),nt(this,s,"m",me).call(this,e.id),this.messenger.publish(`${Jt}:transactionConfirmed`,e),nt(this,s,"m",Se).call(this,e),nt(this,s,"m",Pe).call(this,e).catch(e=>{throw(0,At.projectLogger)("Error while updating post balance",e),e})},Pe=async function(e){try{const{networkClientId:t,type:n}=e;if(n!==Ct.TransactionType.swap)return;const a=nt(this,s,"m",ue).call(this,{networkClientId:t}),{updatedTransactionMeta:r,approvalTransactionMeta:i}=await(0,qt.updatePostTransactionBalance)(e,{ethQuery:a,getTransaction:nt(this,s,"m",se).bind(this),updateTransaction:this.updateTransaction.bind(this)});this.messenger.publish(`${Jt}:postTransactionBalanceUpdated`,{transactionMeta:r,approvalTransactionMeta:i})}catch(e){(0,At.projectLogger)("Error while updating post transaction balance",e)}},ve=function({provider:e,blockTracker:t,chainId:n}){return new ct.NonceTracker({provider:e,blockTracker:t,getPendingTransactions:nt(this,s,"m",Re).bind(this,n),getConfirmedTransactions:nt(this,s,"m",Ee).bind(this,[Ct.TransactionStatus.confirmed],n)})},Ie=function({provider:e,blockTracker:t,chainId:n,networkClientId:a}){const r=new it.default(e),i=new vt.PendingTransactionTracker({blockTracker:t,getChainId:()=>n,getEthQuery:()=>r,getGlobalLock:()=>nt(this,R,"f").acquireNonceLockForChainIdKey({chainId:n}),getNetworkClientId:()=>a,getTransactions:()=>this.state.transactions,hooks:{beforeCheckPendingTransaction:nt(this,c,"f").bind(this)},isResubmitEnabled:nt(this,O,"f").isResubmitEnabled,isTimeoutEnabled:nt(this,C,"f"),messenger:this.messenger,publishTransaction:(e,t)=>nt(this,s,"m",X).call(this,e,t,{skipSubmitHistory:!0})});return nt(this,s,"m",xe).call(this,i),i},Ae=function(){nt(this,R,"f").stopAllTracking()},Ce=function(e){e.hub.on("transactions",nt(this,s,"m",de).bind(this))},je=function(e){e.hub.removeAllListeners("transaction-confirmed"),e.hub.removeAllListeners("transaction-dropped"),e.hub.removeAllListeners("transaction-failed"),e.hub.removeAllListeners("transaction-updated")},xe=function(e){e.hub.on("transaction-confirmed",nt(this,s,"m",ke).bind(this)),e.hub.on("transaction-dropped",nt(this,s,"m",pe).bind(this)),e.hub.on("transaction-failed",nt(this,s,"m",Ye).bind(this)),e.hub.on("transaction-updated",this.updateTransaction.bind(this))},Re=function(e,t){return[...nt(this,s,"m",Ee).call(this,[Ct.TransactionStatus.approved,Ct.TransactionStatus.signed,Ct.TransactionStatus.submitted],t,e),...nt(this,p,"f").call(this,t,e)]},Oe=async function(e,t){try{return await nt(this,s,"m",X).call(this,e,t)}catch(e){if(nt(this,s,"m",Fe).call(this,e))throw new Error("Previous transaction is already confirmed");throw e}},Fe=function(e){return Boolean(e?.message?.includes("nonce too low"))||Boolean(e?.data?.message?.includes("nonce too low"))},Ne=function(){return nt(this,U,"f")?[new wt.TestGasFeeFlow]:[new bt.RandomisedEstimationsGasFeeFlow,new pt.LineaGasFeeFlow,new mt.DefaultGasFeeFlow]},Me=function(){return[new gt.OptimismLayer1GasFeeFlow,new yt.ScrollLayer1GasFeeFlow]},Le=function({transactionId:e,skipValidation:t,skipResimulateCheck:n},a){let r;this.update(s=>{const i=s.transactions.findIndex(({id:t})=>t===e);if(-1===i)throw new Error(`Cannot update transaction as ID not found - ${e}`);let o=s.transactions[i];const c=(0,ft.cloneDeep)(o);o=a(o)??o,!0!==t&&(o.txParams=(0,Wt.normalizeTransactionParams)(o.txParams),(0,zt.validateTxParams)(o.txParams)),!n&&nt(this,_,"f").call(this)&&(r=(0,It.shouldResimulate)(c,o)),s.transactions[i]=o});const i=nt(this,s,"m",se).call(this,e);return r?.resimulate&&nt(this,s,"m",Ge).call(this,i,{blockTime:r.blockTime}).catch(e=>{throw(0,At.projectLogger)("Error during re-simulation",e),e}),i},Ge=async function(e,{blockTime:t,traceContext:n}={}){const{chainId:a,id:r,nestedTransactions:i,networkClientId:o,simulationData:c,txParams:u}=e;let l,d={error:{code:Ct.SimulationErrorCode.Disabled,message:"Simulation disabled"},tokenBalanceChanges:[]},f=[],h=!1;const m=nt(this,B,"f").has(r);if(nt(this,_,"f").call(this)&&!m){const r=await nt(this,H,"f").call(this,{name:"Simulate",parentContext:n},()=>(0,jt.getBalanceChanges)({blockTime:t,chainId:a,ethQuery:nt(this,s,"m",ue).call(this,{networkClientId:o}),getSimulationConfig:(t,n)=>nt(this,T,"f").call(this,t,{txMeta:e,...n}),nestedTransactions:i,txParams:u}));d=r.simulationData,l=r.gasUsed,t&&c&&(0,It.hasSimulationDataChanged)(c,d)&&(d={...d,isUpdatedAfterSecurityCheck:!0});const m=await nt(this,s,"m",Ze).call(this,e);f=m?.gasFeeTokens??[],h=m?.isGasFeeSponsored??!1}if(!nt(this,s,"m",se).call(this,r))return void(0,At.projectLogger)("Cannot update simulation data as transaction not found",r,d);const p=nt(this,s,"m",Le).call(this,{transactionId:r,skipResimulateCheck:Boolean(t)},e=>{e.gasFeeTokens=f,e.isGasFeeSponsored=h,e.gasUsed=l,m||(e.simulationData=d)});(0,At.projectLogger)("Updated simulation data",r,p),await nt(this,s,"m",Xe).call(this,p)},De=function({transactionId:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,layer1GasFee:a}){nt(this,s,"m",Le).call(this,{transactionId:e},e=>{(0,St.updateTransactionGasProperties)({txMeta:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,isTxParamsGasFeeUpdatesEnabled:nt(this,P,"f"),layer1GasFee:a})})},Be=function({transactionBatchId:e,gasFeeEstimates:t}){nt(this,s,"m",Ue).call(this,e,e=>({...e,gasFeeEstimates:t}))},Ue=function(e,t){this.update(n=>{const s=n.transactionBatches.findIndex(t=>t.id===e);if(-1===s)throw new Error(`Cannot update batch, ID not found - ${e}`);const a=n.transactionBatches[s],r=t(a);n.transactionBatches[s]=r??a})},He=function(){return this.messenger.call("AccountsController:getSelectedAccount")},$e=function(){const e=this.messenger.call("AccountsController:getState");return Object.values(e.internalAccounts?.accounts??{}).filter(e=>"eip155:eoa"===e.type).map(e=>e.address)},qe=function(e,t){const{chainId:n,networkClientId:s,origin:a,rawTx:r,txParams:i}=e,{networkConfigurationsByChainId:o}=nt(this,b,"f").call(this),c=o[n],u=c?.rpcEndpoints.find(e=>e.networkClientId===s),l=u?.url,d={chainId:n,hash:t,networkType:u?.name??s,networkUrl:l,origin:a,rawTransaction:r,time:Date.now(),transaction:i};(0,At.projectLogger)("Updating submit history",d);const f=(0,Ft.getSubmitHistoryLimit)(this.messenger);this.update(e=>{const{submitHistory:t}=e;t.length>=f&&t.pop(),t.unshift(d)})},Ke=async function(e){const{chainId:t,networkClientId:n}=e,a=nt(this,R,"f").getNetworkClient({networkClientId:n}).configuration.type===ot.NetworkClientType.Custom,r=nt(this,s,"m",ue).call(this,{networkClientId:n});await(0,Mt.updateGas)({chainId:t,ethQuery:r,isCustomNetwork:a,isSimulationEnabled:nt(this,_,"f").call(this),getSimulationConfig:nt(this,T,"f"),messenger:this.messenger,txMeta:e})},We=function(){this.messenger.registerActionHandler(`${Jt}:addTransaction`,this.addTransaction.bind(this)),this.messenger.registerActionHandler(`${Jt}:addTransactionBatch`,this.addTransactionBatch.bind(this)),this.messenger.registerActionHandler(`${Jt}:confirmExternalTransaction`,this.confirmExternalTransaction.bind(this)),this.messenger.registerActionHandler(`${Jt}:emulateNewTransaction`,this.emulateNewTransaction.bind(this)),this.messenger.registerActionHandler(`${Jt}:emulateTransactionUpdate`,this.emulateTransactionUpdate.bind(this)),this.messenger.registerActionHandler(`${Jt}:estimateGas`,this.estimateGas.bind(this)),this.messenger.registerActionHandler(`${Jt}:estimateGasBatch`,this.estimateGasBatch.bind(this)),this.messenger.registerActionHandler(`${Jt}:getGasFeeTokens`,nt(this,s,"m",et).bind(this)),this.messenger.registerActionHandler(`${Jt}:getNonceLock`,this.getNonceLock.bind(this)),this.messenger.registerActionHandler(`${Jt}:getTransactions`,this.getTransactions.bind(this)),this.messenger.registerActionHandler(`${Jt}:updateCustodialTransaction`,this.updateCustodialTransaction.bind(this)),this.messenger.registerActionHandler(`${Jt}:updateTransaction`,this.updateTransaction.bind(this))},ze=function(e){this.update(t=>{const n=t.transactions.filter(({id:t})=>t!==e);t.transactions=nt(this,s,"m",Z).call(this,n)})},Ve=function(e){return[ut.errorCodes.provider.userRejectedRequest,zt.ErrorCode.RejectedUpgrade].includes(e.code)},Je=function(e,t,n){if(nt(this,s,"m",Q).call(this,e,t,n),n.code===ut.errorCodes.provider.userRejectedRequest)throw ut.providerErrors.userRejectedRequest({message:"MetaMask Tx Signature: User denied transaction signature.",data:n?.data});throw n},Ye=function(e,t,n){let a;try{a=nt(this,s,"m",Le).call(this,{transactionId:e.id,skipValidation:!0},e=>{e.status=Ct.TransactionStatus.failed,e.error=(0,Wt.normalizeTxError)(t)})}catch(n){(0,At.projectLogger)("Failed to mark transaction as failed",n),a={...e,status:Ct.TransactionStatus.failed,error:(0,Wt.normalizeTxError)(t)}}this.messenger.publish(`${Jt}:transactionFailed`,{actionId:n,error:t.message,transactionMeta:a}),nt(this,s,"m",Se).call(this,a),this.messenger.publish(`${Jt}:transactionFinished`,a),nt(this,k,"f").emit(`${e.id}:finished`,a)},Xe=async function(e){(0,At.projectLogger)("Calling afterSimulate hook",e);const{id:t}=e,n=await nt(this,i,"f").call(this,{transactionMeta:e}),{skipSimulation:a,updateTransaction:r}=n??{};if(a?nt(this,B,"f").add(t):!1===a&&nt(this,B,"f").delete(t),!r)return;const o=nt(this,s,"m",Le).call(this,{transactionId:t,skipResimulateCheck:!0},e=>{e.txParamsOriginal=(0,ft.cloneDeep)(e.txParams),r(e)});(0,At.projectLogger)("Updated transaction with afterSimulate data",o)},Qe=async function({ethQuery:e,publishHookOverride:t,traceContext:n},a,r){let i;return await nt(this,H,"f").call(this,{name:"Publish",parentContext:n},async()=>{const n=t??nt(this,N,"f");({transactionHash:i}=await n(a,r)),i??(i=await nt(this,s,"m",X).call(this,e,{...a,rawTx:r}))}),(0,At.projectLogger)("Publish successful",i),{transactionHash:i}},Ze=async function(e){const{chainId:t}=e;return await(0,Lt.getGasFeeTokens)({chainId:t,getSimulationConfig:nt(this,T,"f"),isEIP7702GasFeeTokensEnabled:nt(this,v,"f"),messenger:this.messenger,publicKeyEIP7702:nt(this,F,"f"),transactionMeta:e})},et=async function(e){const{chainId:t,data:n,from:a,to:r,value:i}=e,o=nt(this,s,"m",ue).call(this,{chainId:t}),c={chainId:t,delegationAddress:await(0,Rt.getDelegationAddress)(a,o),isExternalSign:!0,txParams:{data:n,from:a,to:r,value:i}};return(await nt(this,s,"m",Ze).call(this,c)).gasFeeTokens}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/TransactionController.cjs"}],[3451,{"../errors.cjs":3454,"../logger.cjs":3474,"@metamask/controller-utils":1639,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountTransactions=n.getAccountAddressRelationship=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/utils"),r=e("../errors.cjs"),i=e("../logger.cjs"),o="https://accounts.api.cx.metamask.io",c=`${o}/v1/accounts/`,u="x-metamask-clientproduct",l="metamask-transaction-controller",d=[1,10,56,137,8453,42161,59144,534352,1329,143,999],f=(0,a.createModuleLogger)(i.projectLogger,"accounts-api");n.getAccountAddressRelationship=async function(e){const{chainId:t,from:n,to:a}=e;if(!d.includes(t))throw f("Unsupported chain ID for account relationship API",t),new r.FirstTimeInteractionError("Unsupported chain ID");const i=`${o}/v1/networks/${t}/accounts/${n}/relationships/${a}`;f("Getting account address relationship",{request:e,url:i});const c={[u]:l},h=await(0,s.successfulFetch)(i,{headers:c});if(204===h.status)return{count:0};const m=await h.json();if(f("Retrieved account address relationship",m),m.error){const{code:e,message:t}=m.error;throw new r.FirstTimeInteractionError(t,e)}return m},n.getAccountTransactions=async function(e){const{address:t,chainIds:n,cursor:a,endTimestamp:r,sortDirection:i,startTimestamp:o,tags:d}=e;let h=`${c}${t}/transactions`;const m=[];if(n){const e=n.join(",");m.push(`networks=${e}`)}o&&m.push(`startTimestamp=${o}`),r&&m.push(`endTimestamp=${r}`),a&&m.push(`cursor=${a}`),i&&m.push(`sortDirection=${i}`),m.length&&(h+=`?${m.join("&")}`),f("Getting account transactions",{request:e,url:h});const p=[l,...d??[]].join("__"),g={[u]:p},b=await(0,s.successfulFetch)(h,{headers:g}),y=await b.json();return f("Retrieved account transactions",y),y}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/api/accounts-api.cjs"}],[3452,{"../constants.cjs":3453,"../errors.cjs":3454,"../logger.cjs":3474,"@metamask/controller-utils":1639,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateTransactions=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/utils"),r=e("lodash"),i=e("../constants.cjs"),o=e("../errors.cjs"),c=e("../logger.cjs"),u=(0,a.createModuleLogger)(c.projectLogger,"simulation-api"),l="networks";let d=0;function f(e){return"https://tx-sentinel-{0}.api.cx.metamask.io/".replace("{0}",e)}n.simulateTransactions=async function(e,t){let n=await async function(e){const t=await async function(){const e=`${f("ethereum-mainnet")}${l}`,t=await fetch(e);return t.json()}(),n=(0,s.convertHexToDecimal)(e),a=t[n];if(!a?.confirmations)throw u("Chain is not supported",e),new o.SimulationChainNotSupportedError(e);return f(a.network)}(e);const{newUrl:a,authorization:c}=await t.getSimulationConfig(n)||{};a&&(n=a);const h=d;d+=1;const m=function(e){const t=(0,r.cloneDeep)(e);for(const e of t.transactions){const n=e.to?.toLowerCase();i.DELEGATION_MANAGER_ADDRESSES.includes(n)&&(t.overrides=t.overrides??{},t.overrides[n]={code:i.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS})}return t}(t);u("Sending request",n,t);const p={"Content-Type":"application/json"};c&&(p.Authorization=c);const g=await fetch(n,{method:"POST",headers:p,body:JSON.stringify({id:String(h),jsonrpc:"2.0",method:"infura_simulateTransactions",params:[m]})}),b=await g.json();if(u("Received response",b),b.error){const{code:e,message:t}=b.error;throw new o.SimulationError(t,e)}return b?.result}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/api/simulation-api.cjs"}],[3453,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS=n.DELEGATION_MANAGER_ADDRESSES=n.ABI_IERC7821=n.ABI_SIMULATION_ERC721_LEGACY=n.ABI_SIMULATION_ERC20_WRAPPED=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",BASE:"0x2105",BASE_TESTNET:"0x14a33",BSC:"0x38",BSC_TESTNET:"0x61",HYPEREVM:"0x3e7",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0x1a4",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",OPTIMISM_SEPOLIA:"0xaa37dc",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",SEPOLIA:"0xaa36a7",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",LINEA_MAINNET:"0xe708",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",MONAD:"0x8f",GNOSIS:"0x64",ARBITRUM:"0xa4b1",ZKSYNC_ERA:"0x144",ZORA:"0x76adf1",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",MEGAETH_TESTNET:"0x18c6",SEI:"0x531"},n.ABI_SIMULATION_ERC20_WRAPPED=[{anonymous:!1,inputs:[{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Withdrawal",type:"event"}],n.ABI_SIMULATION_ERC721_LEGACY=[{anonymous:!1,inputs:[{indexed:!1,name:"_from",type:"address"},{indexed:!1,name:"_to",type:"address"},{indexed:!1,name:"_tokenId",type:"uint256"}],name:"Transfer",type:"event"}],n.ABI_IERC7821=[{type:"function",name:"execute",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"},{name:"executionData",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"supportsExecutionMode",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"}],n.DELEGATION_MANAGER_ADDRESSES=["0xdb9b1e94b5b69df7e401ddbede43491141047db3"],n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS="0x608060405234801561001057600080fd5b506004361061012c5760003560e01c806383ebb771116100ad578063acb8cc4911610071578063acb8cc491461027f578063cef6d2091461029f578063e30c3978146102b2578063f2fde38b146102c3578063ffa1ad74146102d657600080fd5b806383ebb771146102065780638456cb591461020e57806384b0196e146102165780638da5cb5b14610231578063a3f4df7e1461024257600080fd5b806358909ebc116100f457806358909ebc146101b05780635c975abb146101d157806366134607146101e3578063715018a6146101f657806379ba5097146101fe57600080fd5b80631b13cac2146101315780632d40d0521461014d5780633ed01015146101805780633f4ba83a14610195578063499340471461019d575b600080fd5b61013a60001981565b6040519081526020015b60405180910390f35b61017061015b36600461207e565b60046020526000908152604090205460ff1681565b6040519015158152602001610144565b61019361018e366004612097565b6102fa565b005b6101936103f4565b6101936101ab366004612097565b610406565b6101b9610a1181565b6040516001600160a01b039091168152602001610144565b600154600160a01b900460ff16610170565b61013a6101f1366004612097565b6104f6565b61019361050f565b610193610521565b61013a61056a565b610193610579565b61021e610589565b6040516101449796959493929190612128565b6000546001600160a01b03166101b9565b610272604051806040016040528060118152602001702232b632b3b0ba34b7b726b0b730b3b2b960791b81525081565b60405161014491906121c1565b610272604051806040016040528060018152602001603160f81b81525081565b6101936102ad36600461221f565b6105cf565b6001546001600160a01b03166101b9565b6101936102d13660046122d4565b611829565b610272604051806040016040528060058152602001640312e332e360dc1b81525081565b61030a60408201602083016122d4565b6001600160a01b03811633146103335760405163b9f0f17160e01b815260040160405180910390fd5b600061033e836104f6565b60008181526004602052604090205490915060ff1661037057604051637952fbad60e11b815260040160405180910390fd5b6000818152600460209081526040909120805460ff19169055610395908401846122d4565b6001600160a01b03166103ae60408501602086016122d4565b6001600160a01b0316827f3feadce88fc1b49db633a56fd5307ed6ee18734df83bcc4011daa720c9cd95f1866040516103e7919061241c565b60405180910390a4505050565b6103fc61189a565b6104046118c7565b565b61041660408201602083016122d4565b6001600160a01b038116331461043f5760405163b9f0f17160e01b815260040160405180910390fd5b600061044a836104f6565b60008181526004602052604090205490915060ff161561047c57604051625ecddb60e01b815260040160405180910390fd5b6000818152600460209081526040909120805460ff191660011790556104a4908401846122d4565b6001600160a01b03166104bd60408501602086016122d4565b6001600160a01b0316827fea589ba9473ee1fe77d352c7ed919747715a5d22931b972de9b02a907c66d5dd866040516103e7919061241c565b6000610509610504836127bb565b61191c565b92915050565b61051761189a565b61040460006119b7565b60015433906001600160a01b0316811461055e5760405163118cdaa760e01b81526001600160a01b03821660048201526024015b60405180910390fd5b610567816119b7565b50565b60006105746119d0565b905090565b61058161189a565b610404611afb565b60006060806000806000606061059d611b3e565b6105a5611b6b565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b6105d7611b98565b8481811415806105e75750808414155b1561060557604051631bcaf69f60e01b815260040160405180910390fd5b6000816001600160401b0381111561061f5761061f6124ed565b60405190808252806020026020018201604052801561065257816020015b606081526020019060019003908161063d5790505b5090506000826001600160401b0381111561066f5761066f6124ed565b6040519080825280602002602001820160405280156106a257816020015b606081526020019060019003908161068d5790505b50905060005b83811015610c195760008a8a838181106106c4576106c46127c7565b90506020028101906106d691906127dd565b8101906106e39190612823565b905080516000036107d1576040805160008082526020820190925290610765565b6107526040518060c0016040528060006001600160a01b0316815260200160006001600160a01b03168152602001600080191681526020016060815260200160008152602001606081525090565b8152602001906001900390816107045790505b50848381518110610778576107786127c7565b602090810291909101015260006040519080825280602002602001820160405280156107ae578160200160208202803683370190505b508383815181106107c1576107c16127c7565b6020026020010181905250610c10565b808483815181106107e4576107e46127c7565b6020026020010181905250600081516001600160401b0381111561080a5761080a6124ed565b604051908082528060200260200182016040528015610833578160200160208202803683370190505b50905080848481518110610849576108496127c7565b6020026020010181905250336001600160a01b031682600081518110610871576108716127c7565b6020026020010151600001516001600160a01b0316141580156108c65750610a116001600160a01b0316826000815181106108ae576108ae6127c7565b6020026020010151600001516001600160a01b031614155b156108e457604051632d618d8160e21b815260040160405180910390fd5b60005b8251811015610a4d576000838281518110610904576109046127c7565b602002602001015190506109178161191c565b838381518110610929576109296127c7565b60200260200101818152505080602001516001600160a01b03163b6000036109a657600061099e61099461095b61056a565b86868151811061096d5761096d6127c7565b602002602001015160405161190160f01b8152600281019290925260228201526042902090565b8360a00151611bc3565b905050610a44565b60006109c56109b361056a565b85858151811061096d5761096d6127c7565b9050600082602001516001600160a01b0316631626ba7e838560a001516040518363ffffffff1660e01b81526004016109ff9291906128d3565b602060405180830381865afa158015610a1c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a4091906128f4565b5050505b506001016108e7565b5060005b8251811015610c0d5760046000838381518110610a7057610a706127c7565b60209081029190910181015182528101919091526040016000205460ff1615610aac576040516302dd502960e11b815260040160405180910390fd5b60018351610aba9190612934565b8114610bc35781610acc826001612947565b81518110610adc57610adc6127c7565b6020026020010151838281518110610af657610af66127c7565b60200260200101516040015114610b2057604051636f6a1b8760e11b815260040160405180910390fd5b600083610b2e836001612947565b81518110610b3e57610b3e6127c7565b6020026020010151600001519050610a116001600160a01b0316816001600160a01b031614158015610b9f5750806001600160a01b0316848381518110610b8757610b876127c7565b6020026020010151602001516001600160a01b031614155b15610bbd57604051632d618d8160e21b815260040160405180910390fd5b50610c05565b60001960001b838281518110610bdb57610bdb6127c7565b60200260200101516040015114610c0557604051636f6a1b8760e11b815260040160405180910390fd5b600101610a51565b50505b506001016106a8565b5060005b83811015610e3e576000838281518110610c3957610c396127c7565b6020026020010151511115610e365760005b838281518110610c5d57610c5d6127c7565b602002602001015151811015610e34576000848381518110610c8157610c816127c7565b60200260200101518281518110610c9a57610c9a6127c7565b602002602001015160600151905060005b8151811015610e2a576000828281518110610cc857610cc86127c7565b6020026020010151600001519050806001600160a01b031663414c3e33848481518110610cf757610cf76127c7565b602002602001015160200151858581518110610d1557610d156127c7565b6020026020010151604001518f8f8a818110610d3357610d336127c7565b905060200201358e8e8b818110610d4c57610d4c6127c7565b9050602002810190610d5e91906127dd565b8c8c81518110610d7057610d706127c7565b60200260200101518b81518110610d8957610d896127c7565b60200260200101518e8d81518110610da357610da36127c7565b60200260200101518c81518110610dbc57610dbc6127c7565b602002602001015160200151336040518963ffffffff1660e01b8152600401610dec98979695949392919061295a565b600060405180830381600087803b158015610e0657600080fd5b505af1158015610e1a573d6000803e3d6000fd5b5050505050806001019050610cab565b5050600101610c4b565b505b600101610c1d565b5060005b8381101561146257828181518110610e5c57610e5c6127c7565b602002602001015151600003610f1a573363d691c964898984818110610e8457610e846127c7565b90506020020135888885818110610e9d57610e9d6127c7565b9050602002810190610eaf91906127dd565b6040518463ffffffff1660e01b8152600401610ecd939291906129c5565b6000604051808303816000875af1158015610eec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610f1491908101906129e8565b5061145a565b60005b838281518110610f2f57610f2f6127c7565b602002602001015151811015611106576000848381518110610f5357610f536127c7565b60200260200101518281518110610f6c57610f6c6127c7565b602002602001015160600151905060005b81518110156110fc576000828281518110610f9a57610f9a6127c7565b6020026020010151600001519050806001600160a01b031663a145832a848481518110610fc957610fc96127c7565b602002602001015160200151858581518110610fe757610fe76127c7565b6020026020010151604001518f8f8a818110611005576110056127c7565b905060200201358e8e8b81811061101e5761101e6127c7565b905060200281019061103091906127dd565b8c8c81518110611042576110426127c7565b60200260200101518b8151811061105b5761105b6127c7565b60200260200101518e8d81518110611075576110756127c7565b60200260200101518c8151811061108e5761108e6127c7565b602002602001015160200151336040518963ffffffff1660e01b81526004016110be98979695949392919061295a565b600060405180830381600087803b1580156110d857600080fd5b505af11580156110ec573d6000803e3d6000fd5b5050505050806001019050610f7d565b5050600101610f1d565b50828181518110611119576111196127c7565b60200260200101516001848381518110611135576111356127c7565b6020026020010151516111489190612934565b81518110611158576111586127c7565b6020026020010151602001516001600160a01b031663d691c964898984818110611184576111846127c7565b9050602002013588888581811061119d5761119d6127c7565b90506020028101906111af91906127dd565b6040518463ffffffff1660e01b81526004016111cd939291906129c5565b6000604051808303816000875af11580156111ec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261121491908101906129e8565b506000838281518110611229576112296127c7565b60200260200101515190505b801561145857600084838151811061124f5761124f6127c7565b60200260200101516001836112649190612934565b81518110611274576112746127c7565b60200260200101516060015190506000815190505b80156114455760008261129d600184612934565b815181106112ad576112ad6127c7565b6020026020010151600001519050806001600160a01b031663d3eddcc5846001856112d89190612934565b815181106112e8576112e86127c7565b602002602001015160200151856001866113029190612934565b81518110611312576113126127c7565b6020026020010151604001518f8f8a818110611330576113306127c7565b905060200201358e8e8b818110611349576113496127c7565b905060200281019061135b91906127dd565b8c8c8151811061136d5761136d6127c7565b602002602001015160018c6113829190612934565b81518110611392576113926127c7565b60200260200101518e8d815181106113ac576113ac6127c7565b602002602001015160018d6113c19190612934565b815181106113d1576113d16127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161140198979695949392919061295a565b600060405180830381600087803b15801561141b57600080fd5b505af115801561142f573d6000803e3d6000fd5b50505050508061143e90612ac7565b9050611289565b50508061145190612ac7565b9050611235565b505b600101610e42565b5060005b838110156116de576000838281518110611482576114826127c7565b60200260200101515111156116d65760008382815181106114a5576114a56127c7565b60200260200101515190505b80156116d45760008483815181106114cb576114cb6127c7565b60200260200101516001836114e09190612934565b815181106114f0576114f06127c7565b60200260200101516060015190506000815190505b80156116c157600082611519600184612934565b81518110611529576115296127c7565b6020026020010151600001519050806001600160a01b031663ed463367846001856115549190612934565b81518110611564576115646127c7565b6020026020010151602001518560018661157e9190612934565b8151811061158e5761158e6127c7565b6020026020010151604001518f8f8a8181106115ac576115ac6127c7565b905060200201358e8e8b8181106115c5576115c56127c7565b90506020028101906115d791906127dd565b8c8c815181106115e9576115e96127c7565b602002602001015160018c6115fe9190612934565b8151811061160e5761160e6127c7565b60200260200101518e8d81518110611628576116286127c7565b602002602001015160018d61163d9190612934565b8151811061164d5761164d6127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161167d98979695949392919061295a565b600060405180830381600087803b15801561169757600080fd5b505af11580156116ab573d6000803e3d6000fd5b5050505050806116ba90612ac7565b9050611505565b5050806116cd90612ac7565b90506114b1565b505b600101611466565b5060005b8381101561181d5760008382815181106116fe576116fe6127c7565b60200260200101515111156118155760005b838281518110611722576117226127c7565b60200260200101515181101561181357336001600160a01b031684838151811061174e5761174e6127c7565b6020026020010151600186858151811061176a5761176a6127c7565b60200260200101515161177d9190612934565b8151811061178d5761178d6127c7565b6020026020010151602001516001600160a01b03167f40dadaa36c6c2e3d7317e24757451ffb2d603d875f0ad5e92c5dd156573b18738685815181106117d5576117d56127c7565b602002602001015184815181106117ee576117ee6127c7565b60200260200101516040516118039190612ade565b60405180910390a3600101611710565b505b6001016116e2565b50505050505050505050565b61183161189a565b600180546001600160a01b0383166001600160a01b031990911681179091556118626000546001600160a01b031690565b6001600160a01b03167f38d16b8cac22d99fc7c124b9cd0de2d3fa1faef420bfe791d8c362d765e2270060405160405180910390a350565b6000546001600160a01b031633146104045760405163118cdaa760e01b8152336004820152602401610555565b6118cf611bed565b6001805460ff60a01b191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b6000807f88c1d2ecf185adf710588203a5f263f0ff61be0d33da39792cde19ba9aa4331e83600001518460200151856040015161195c8760600151611c17565b6080808901516040805160208101989098526001600160a01b03968716908801529490931660608601529184015260a083015260c082015260e0015b60408051601f1981840301815291905280516020909101209392505050565b600180546001600160a01b031916905561056781611ce2565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016148015611a2957507f000000000000000000000000000000000000000000000000000000000000000046145b15611a5357507f000000000000000000000000000000000000000000000000000000000000000090565b610574604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f0000000000000000000000000000000000000000000000000000000000000000918101919091527f000000000000000000000000000000000000000000000000000000000000000060608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b611b03611b98565b6001805460ff60a01b1916600160a01b1790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586118ff3390565b60606105747f00000000000000000000000000000000000000000000000000000000000000006002611d32565b60606105747f00000000000000000000000000000000000000000000000000000000000000006003611d32565b600154600160a01b900460ff16156104045760405163d93c066560e01b815260040160405180910390fd5b600080600080611bd38686611ddd565b925092509250611be38282611e2a565b5090949350505050565b600154600160a01b900460ff1661040457604051638dfc202b60e01b815260040160405180910390fd5b60008082516001600160401b03811115611c3357611c336124ed565b604051908082528060200260200182016040528015611c5c578160200160208202803683370190505b50905060005b8351811015611cb257611c8d848281518110611c8057611c806127c7565b6020026020010151611ee7565b828281518110611c9f57611c9f6127c7565b6020908102919091010152600101611c62565b5080604051602001611cc49190612bcb565b60405160208183030381529060405280519060200120915050919050565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b606060ff8314611d4c57611d4583611f48565b9050610509565b818054611d5890612c01565b80601f0160208091040260200160405190810160405280929190818152602001828054611d8490612c01565b8015611dd15780601f10611da657610100808354040283529160200191611dd1565b820191906000526020600020905b815481529060010190602001808311611db457829003601f168201915b50505050509050610509565b60008060008351604103611e175760208401516040850151606086015160001a611e0988828585611f87565b955095509550505050611e23565b50508151600091506002905b9250925092565b6000826003811115611e3e57611e3e612c3b565b03611e47575050565b6001826003811115611e5b57611e5b612c3b565b03611e795760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115611e8d57611e8d612c3b565b03611eae5760405163fce698f760e01b815260048101829052602401610555565b6003826003811115611ec257611ec2612c3b565b03611ee3576040516335e2f38360e21b815260048101829052602401610555565b5050565b6000807f80ad7e1b04ee6d994a125f4714ca0720908bd80ed16063ec8aee4b88e9253e2d8360000151846020015180519060200120604051602001611998939291909283526001600160a01b03919091166020830152604082015260600190565b60606000611f5583612056565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b600080807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0841115611fc2575060009150600390508261204c565b604080516000808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015612016573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166120425750600092506001915082905061204c565b9250600091508190505b9450945094915050565b600060ff8216601f81111561050957604051632cd44ac360e21b815260040160405180910390fd5b60006020828403121561209057600080fd5b5035919050565b6000602082840312156120a957600080fd5b81356001600160401b038111156120bf57600080fd5b820160c081850312156120d157600080fd5b9392505050565b60005b838110156120f35781810151838201526020016120db565b50506000910152565b600081518084526121148160208601602086016120d8565b601f01601f19169290920160200192915050565b60ff60f81b881681526000602060e0602084015261214960e084018a6120fc565b838103604085015261215b818a6120fc565b606085018990526001600160a01b038816608086015260a0850187905284810360c08601528551808252602080880193509091019060005b818110156121af57835183529284019291840191600101612193565b50909c9b505050505050505050505050565b6020815260006120d160208301846120fc565b60008083601f8401126121e657600080fd5b5081356001600160401b038111156121fd57600080fd5b6020830191508360208260051b850101111561221857600080fd5b9250929050565b6000806000806000806060878903121561223857600080fd5b86356001600160401b038082111561224f57600080fd5b61225b8a838b016121d4565b9098509650602089013591508082111561227457600080fd5b6122808a838b016121d4565b9096509450604089013591508082111561229957600080fd5b506122a689828a016121d4565b979a9699509497509295939492505050565b80356001600160a01b03811681146122cf57600080fd5b919050565b6000602082840312156122e657600080fd5b6120d1826122b8565b6000808335601e1984360301811261230657600080fd5b83016020810192503590506001600160401b0381111561232557600080fd5b80360382131561221857600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60008383855260208086019550808560051b830101846000805b8881101561240e57858403601f19018a52823536899003605e1901811261239c578283fd5b880160606001600160a01b036123b1836122b8565b1686526123c0878301836122ef565b82898901526123d28389018284612334565b9250505060406123e4818401846122ef565b9350878303828901526123f8838583612334565b9d89019d97505050938601935050600101612377565b509198975050505050505050565b6020815260006001600160a01b0380612434856122b8565b16602084015280612447602086016122b8565b16604084015250604083013560608301526060830135601e1984360301811261246f57600080fd5b83016020810190356001600160401b0381111561248b57600080fd5b8060051b360382131561249d57600080fd5b60c060808501526124b260e08501828461235d565b915050608084013560a08401526124cc60a08501856122ef565b848303601f190160c08601526124e3838284612334565b9695505050505050565b634e487b7160e01b600052604160045260246000fd5b604051606081016001600160401b0381118282101715612525576125256124ed565b60405290565b60405160c081016001600160401b0381118282101715612525576125256124ed565b604051601f8201601f191681016001600160401b0381118282101715612575576125756124ed565b604052919050565b60006001600160401b03821115612596576125966124ed565b5060051b60200190565b60006001600160401b038211156125b9576125b96124ed565b50601f01601f191660200190565b600082601f8301126125d857600080fd5b81356125eb6125e6826125a0565b61254d565b81815284602083860101111561260057600080fd5b816020850160208301376000918101602001919091529392505050565b600082601f83011261262e57600080fd5b8135602061263e6125e68361257d565b82815260059290921b8401810191818101908684111561265d57600080fd5b8286015b8481101561270c5780356001600160401b03808211156126815760008081fd5b908801906060828b03601f190181131561269b5760008081fd5b6126a3612503565b6126ae8885016122b8565b8152604080850135848111156126c45760008081fd5b6126d28e8b838901016125c7565b838b0152509184013591838311156126ea5760008081fd5b6126f88d8a858801016125c7565b908201528652505050918301918301612661565b509695505050505050565b600060c0828403121561272957600080fd5b61273161252b565b905061273c826122b8565b815261274a602083016122b8565b60208201526040820135604082015260608201356001600160401b038082111561277357600080fd5b61277f8583860161261d565b60608401526080840135608084015260a08401359150808211156127a257600080fd5b506127af848285016125c7565b60a08301525092915050565b60006105093683612717565b634e487b7160e01b600052603260045260246000fd5b6000808335601e198436030181126127f457600080fd5b8301803591506001600160401b0382111561280e57600080fd5b60200191503681900382131561221857600080fd5b6000602080838503121561283657600080fd5b82356001600160401b038082111561284d57600080fd5b818501915085601f83011261286157600080fd5b813561286f6125e68261257d565b81815260059190911b8301840190848101908883111561288e57600080fd5b8585015b838110156128c6578035858111156128aa5760008081fd5b6128b88b89838a0101612717565b845250918601918601612892565b5098975050505050505050565b8281526040602082015260006128ec60408301846120fc565b949350505050565b60006020828403121561290657600080fd5b81516001600160e01b0319811681146120d157600080fd5b634e487b7160e01b600052601160045260246000fd5b818103818111156105095761050961291e565b808201808211156105095761050961291e565b60e08152600061296d60e083018b6120fc565b828103602084015261297f818b6120fc565b9050886040840152828103606084015261299a81888a612334565b608084019690965250506001600160a01b0392831660a0820152911660c09091015295945050505050565b8381526040602082015260006129df604083018486612334565b95945050505050565b600060208083850312156129fb57600080fd5b82516001600160401b0380821115612a1257600080fd5b818501915085601f830112612a2657600080fd5b8151612a346125e68261257d565b81815260059190911b83018401908481019088831115612a5357600080fd5b8585015b838110156128c657805185811115612a6f5760008081fd5b8601603f81018b13612a815760008081fd5b878101516040612a936125e6836125a0565b8281528d82848601011115612aa85760008081fd5b612ab7838c83018487016120d8565b8652505050918601918601612a57565b600081612ad657612ad661291e565b506000190190565b602080825282516001600160a01b0390811683830152838201518116604080850191909152808501516060808601919091528086015160c06080870152805160e0870181905260009594610100600583901b8901810195919493870193919290890190885b81811015612b9d5760ff198b8903018352855187815116895289810151858b8b0152612b71868b01826120fc565b918701518a83038b890152919050612b8981836120fc565b995050509488019491880191600101612b43565b50505050505050608085015160a085015260a08501519150601f198482030160c08501526129df81836120fc565b815160009082906020808601845b83811015612bf557815185529382019390820190600101612bd9565b50929695505050505050565b600181811c90821680612c1557607f821691505b602082108103612c3557634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052602160045260246000fdfea264697066735822122073f8fd2b36b643aff6f988638bc7c8ab2f41546c01a777524170b479e36618c564736f6c63430008170033"}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/constants.cjs"}],[3454,{"./types.cjs":3475},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationRevertedError=n.SimulationInvalidResponseError=n.SimulationChainNotSupportedError=n.FirstTimeInteractionError=n.SimulationError=void 0;const s=e("./types.cjs");class a extends Error{constructor(e,t){super(e??"Simulation failed"),this.code=t}}n.SimulationError=a;class r extends Error{constructor(e,t){super(e??"Error checking first time interaction"),this.code=t}}n.FirstTimeInteractionError=r;n.SimulationChainNotSupportedError=class extends a{constructor(e){super(`Chain is not supported: ${e}`,s.SimulationErrorCode.ChainNotSupported)}};n.SimulationInvalidResponseError=class extends a{constructor(){super("Invalid response from simulation API",s.SimulationErrorCode.InvalidResponse)}};n.SimulationRevertedError=class extends a{constructor(){super("Transaction was reverted",s.SimulationErrorCode.Reverted)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/errors.cjs"}],[3455,{"../logger.cjs":3474,"../types.cjs":3475,"../utils/gas-fees.cjs":3484,"@metamask/gas-fee-controller":3499,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultGasFeeFlow=void 0;const l=e("@metamask/gas-fee-controller"),d=e("@metamask/utils"),f=e("../logger.cjs"),h=e("../types.cjs"),m=e("../utils/gas-fees.cjs"),p=(0,d.createModuleLogger)(f.projectLogger,"default-gas-fee-flow");n.DefaultGasFeeFlow=class{constructor(){s.add(this)}matchesTransaction(){return!0}async getGasFees(e){const{gasFeeControllerData:t}=e,{gasEstimateType:n,gasFeeEstimates:o}=t;let c;switch(n){case l.GAS_ESTIMATE_TYPES.FEE_MARKET:p("Using fee market estimates",o),c=u(this,s,"m",a).call(this,o);break;case l.GAS_ESTIMATE_TYPES.LEGACY:p("Using legacy estimates",o),c=u(this,s,"m",r).call(this,o);break;case l.GAS_ESTIMATE_TYPES.ETH_GASPRICE:p("Using eth_gasPrice estimates",o),c=u(this,s,"m",i).call(this,o);break;default:throw new Error(`Unsupported gas estimate type: ${n}`)}return{estimates:c}}},s=new WeakSet,a=function(e){const t=Object.values(h.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:u(this,s,"m",o).call(this,e,n)}),{});return{type:h.GasFeeEstimateType.FeeMarket,...t}},r=function(e){const t=Object.values(h.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:u(this,s,"m",c).call(this,e,n)}),{});return{type:h.GasFeeEstimateType.Legacy,...t}},i=function(e){return{type:h.GasFeeEstimateType.GasPrice,gasPrice:(0,m.gweiDecimalToWeiHex)(e.gasPrice)}},o=function(e,t){return{maxFeePerGas:(0,m.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:(0,m.gweiDecimalToWeiHex)(e[t].suggestedMaxPriorityFeePerGas)}},c=function(e,t){return(0,m.gweiDecimalToWeiHex)(e[t])}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/DefaultGasFeeFlow.cjs"}],[3456,{"../logger.cjs":3474,"../types.cjs":3475,"./DefaultGasFeeFlow.cjs":3455,"@metamask/controller-utils":1639,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.LineaGasFeeFlow=void 0;const l=e("@metamask/controller-utils"),d=e("@metamask/utils"),f=e("./DefaultGasFeeFlow.cjs"),h=e("../logger.cjs"),m=e("../types.cjs"),p=(0,d.createModuleLogger)(h.projectLogger,"linea-gas-fee-flow"),g=[l.ChainId["linea-mainnet"],l.ChainId["linea-goerli"],l.ChainId["linea-sepolia"]],b={low:1,medium:1.35,high:1.7},y={low:1,medium:1.05,high:1.1};n.LineaGasFeeFlow=class{constructor(){s.add(this)}matchesTransaction({transactionMeta:e}){return g.includes(e.chainId)}async getGasFees(e){try{return await u(this,s,"m",a).call(this,e)}catch(t){return p("Using default flow as fallback due to error",t),(new f.DefaultGasFeeFlow).getGasFees(e)}}},s=new WeakSet,a=async function(e){const{ethQuery:t,transactionMeta:n}=e,a=await u(this,s,"m",r).call(this,n,t);p("Received Linea response",a);const d=u(this,s,"m",i).call(this,a.baseFeePerGas,b);p("Generated base fees",u(this,s,"m",c).call(this,d));const f=u(this,s,"m",i).call(this,a.priorityFeePerGas,y);p("Generated priority fees",u(this,s,"m",c).call(this,f));const h=u(this,s,"m",o).call(this,d,f);p("Generated max fees",u(this,s,"m",c).call(this,h));return{estimates:Object.values(m.GasFeeEstimateLevel).reduce((e,t)=>({...e,[t]:{maxFeePerGas:(0,l.toHex)(h[t]),maxPriorityFeePerGas:(0,l.toHex)(f[t])}}),{type:m.GasFeeEstimateType.FeeMarket})}},r=function(e,t){return(0,l.query)(t,"linea_estimateGas",[{from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,input:e.txParams.data}])},i=function(e,t){const n=(0,l.hexToBN)(e);return{low:n.muln(t.low),medium:n.muln(t.medium),high:n.muln(t.high)}},o=function(e,t){return{low:e.low.add(t.low),medium:e.medium.add(t.medium),high:e.high.add(t.high)}},c=function(e){return Object.values(m.GasFeeEstimateLevel).map(t=>e[t].toString(10))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/LineaGasFeeFlow.cjs"}],[3457,{"../constants.cjs":3453,"./OracleLayer1GasFeeFlow.cjs":3458,"@metamask/controller-utils":1639,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.OptimismLayer1GasFeeFlow=void 0;const i=e("@metamask/controller-utils"),o=e("@metamask/utils"),c=e("./OracleLayer1GasFeeFlow.cjs"),u=e("../constants.cjs"),l=[u.CHAIN_IDS.OPTIMISM,u.CHAIN_IDS.OPTIMISM_TESTNET,u.CHAIN_IDS.BASE,u.CHAIN_IDS.BASE_TESTNET,u.CHAIN_IDS.OPBNB,u.CHAIN_IDS.OPBNB_TESTNET,u.CHAIN_IDS.ZORA];class d extends c.OracleLayer1GasFeeFlow{constructor(){super(...arguments),s.add(this)}async matchesTransaction({transactionMeta:e}){const t=(0,o.hexToNumber)(e.chainId),n=await r(this,s,"m",a).call(this);return!!n?.has(t)||l.includes(e.chainId)}}n.OptimismLayer1GasFeeFlow=d,s=new WeakSet,a=async function(){try{const e=await(0,i.handleFetch)("https://gas.api.cx.metamask.io/v1/supportedNetworks");return new Set(e?.partialSupport?.optimism??[])}catch{return null}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/OptimismLayer1GasFeeFlow.cjs"}],[3458,{"../logger.cjs":3474,"../utils/prepare.cjs":3489,"../utils/utils.cjs":3494,"@ethersproject/contracts":786,"@ethersproject/providers":824,"@metamask/utils":3554,"bn.js":4413,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s,a,r,i,o,c,u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OracleLayer1GasFeeFlow=void 0;const d=e("@ethersproject/contracts"),f=e("@ethersproject/providers"),h=e("@metamask/utils"),m=l(e("bn.js")),p=e("../logger.cjs"),g=e("../utils/prepare.cjs"),b=e("../utils/utils.cjs"),y=(0,h.createModuleLogger)(p.projectLogger,"oracle-layer1-gas-fee-flow"),w=new m.default(0),T=[{inputs:[{internalType:"bytes",name:"_data",type:"bytes"}],name:"getL1Fee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_gasUsed",type:"uint256"}],name:"getOperatorFee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];n.OracleLayer1GasFeeFlow=class{constructor(){s.add(this)}getOracleAddressForChain(e){return"0x420000000000000000000000000000000000000F"}shouldSignTransaction(){return!1}async getLayer1Fee(e){try{const{provider:t,transactionMeta:n}=e,i=u(this,s,"m",c).call(this,t,n.chainId),o=await u(this,s,"m",a).call(this,i,n),l=await u(this,s,"m",r).call(this,i,n);return{layer1Fee:(0,h.add0x)((0,b.padHexToEvenLength)(o.add(l).toString(16)))}}catch(e){throw y("Failed to get oracle layer 1 gas fee",e),new Error("Failed to get oracle layer 1 gas fee")}}},s=new WeakSet,a=async function(e,t){const n=u(this,s,"m",i).call(this,t,this.shouldSignTransaction()).serialize(),a=await e.getL1Fee(n);if(a===undefined)throw new Error("No value returned from oracle contract");return(0,b.toBN)(a)},r=async function(e,t){const{gasUsed:n}=t;if(!n)return w;try{const t=await e.getOperatorFee(n);return t===undefined?w:(0,b.toBN)(t)}catch(e){return y("Failed to get operator layer 1 gas fee",e),w}},i=function(e,n){const a=u(this,s,"m",o).call(this,e),{chainId:r}=e;let i=(0,g.prepareTransaction)(r,a);if(n){const e=t.from("abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789","hex"),n=Uint8Array.from(e);i=i.sign(n)}return i},o=function(e){return{...e.txParams,gasLimit:e.txParams.gas}},c=function(e,t){return new d.Contract(this.getOracleAddressForChain(t),T,new f.Web3Provider(e))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/OracleLayer1GasFeeFlow.cjs"}],[3459,{"../logger.cjs":3474,"../types.cjs":3475,"../utils/feature-flags.cjs":3481,"../utils/gas-fees.cjs":3484,"./DefaultGasFeeFlow.cjs":3455,"@metamask/gas-fee-controller":3499,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.randomiseDecimalGWEIAndConvertToHex=n.RandomisedEstimationsGasFeeFlow=void 0;const u=e("@metamask/gas-fee-controller"),l=e("@metamask/utils"),d=e("./DefaultGasFeeFlow.cjs"),f=e("../logger.cjs"),h=e("../types.cjs"),m=e("../utils/feature-flags.cjs"),p=e("../utils/gas-fees.cjs"),g=(0,l.createModuleLogger)(f.projectLogger,"randomised-estimation-gas-fee-flow");function b(e,t,n){const s=(0,p.gweiDecimalToWeiDecimal)(e),a=s.length,r=Math.min(t,a-n);if(0===Number(s)||r<=0)return`0x${Number(s).toString(16)}`;const i=a-r,o=s.slice(0,i),c=s.slice(-r),u=function(e,t){const n=10**e;return t+Math.floor(Math.random()*(n-t))}(r,Number(c)),d=`0x${(BigInt(o+"0".repeat(r))+BigInt(u)).toString(16)}`;return(0,l.add0x)(d)}n.RandomisedEstimationsGasFeeFlow=class{constructor(){s.add(this)}matchesTransaction({transactionMeta:e,messenger:t}){const{chainId:n}=e;return(0,m.getGasFeeRandomisation)(t).randomisedGasFeeDigits[n]!==undefined}async getGasFees(e){try{return await c(this,s,"m",r).call(this,e)}catch(t){return g("Using default flow as fallback due to error",t),await c(this,s,"m",a).call(this,e)}}},s=new WeakSet,a=async function(e){return(new d.DefaultGasFeeFlow).getGasFees(e)},r=async function(e){const{messenger:t,gasFeeControllerData:n,transactionMeta:r}=e,{gasEstimateType:o,gasFeeEstimates:l}=n,d=(0,m.getGasFeeRandomisation)(t),f=d.randomisedGasFeeDigits[r.chainId],h=d.preservedNumberOfDigits??2;if(o===u.GAS_ESTIMATE_TYPES.FEE_MARKET){g("Randomising fee market estimates",l);const e=c(this,s,"m",i).call(this,l,f,h);return g("Added randomised fee market estimates",e),{estimates:e}}return await c(this,s,"m",a).call(this,e)},i=function(e,t,n){const a=Object.values(h.GasFeeEstimateLevel).reduce((a,r)=>({...a,[r]:c(this,s,"m",o).call(this,e,r,t,n)}),{});return{type:h.GasFeeEstimateType.FeeMarket,...a}},o=function(e,t,n,s){return{maxFeePerGas:(0,p.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:b(e[t].suggestedMaxPriorityFeePerGas,n,s)}},n.randomiseDecimalGWEIAndConvertToHex=b}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/RandomisedEstimationsGasFeeFlow.cjs"}],[3460,{"../constants.cjs":3453,"./OracleLayer1GasFeeFlow.cjs":3458},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollLayer1GasFeeFlow=void 0;const s=e("./OracleLayer1GasFeeFlow.cjs"),a=e("../constants.cjs"),r=[a.CHAIN_IDS.SCROLL,a.CHAIN_IDS.SCROLL_SEPOLIA];class i extends s.OracleLayer1GasFeeFlow{getOracleAddressForChain(e){return"0x5300000000000000000000000000000000000002"}shouldSignTransaction(){return!0}async matchesTransaction({transactionMeta:e}){return r.includes(e.chainId)}}n.ScrollLayer1GasFeeFlow=i}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/ScrollLayer1GasFeeFlow.cjs"}],[3461,{"../types.cjs":3475,"@metamask/controller-utils":1639},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.TestGasFeeFlow=void 0;const c=e("@metamask/controller-utils"),u=e("../types.cjs"),l=1e15;n.TestGasFeeFlow=class{constructor(){s.add(this),a.set(this,1)}matchesTransaction(){return!0}async getGasFees(e){const{transactionMeta:t}=e,{txParams:n}=t,{gas:c}=n;if(!c)throw new Error("Cannot estimate fee without gas value");const d=parseInt(c,16),f=.5*l,h=(i(this,a,"f")+1)*l,m=i(this,a,"f")*l,p=h-f,g=m-f,b=h+f,y=m+f;return o(this,a,i(this,a,"f")+1,"f"),{estimates:{type:u.GasFeeEstimateType.FeeMarket,low:{maxFeePerGas:i(this,s,"m",r).call(this,p,d),maxPriorityFeePerGas:i(this,s,"m",r).call(this,g,d)},medium:{maxFeePerGas:i(this,s,"m",r).call(this,h,d),maxPriorityFeePerGas:i(this,s,"m",r).call(this,m,d)},high:{maxFeePerGas:i(this,s,"m",r).call(this,b,d),maxPriorityFeePerGas:i(this,s,"m",r).call(this,y,d)}}}}},a=new WeakMap,s=new WeakSet,r=function(e,t){const n=Math.ceil(e/t);return(0,c.toHex)(n)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/TestGasFeeFlow.cjs"}],[3462,{"../api/accounts-api.cjs":3451,"../constants.cjs":3453,"../index.cjs":3473,"../logger.cjs":3474,"../types.cjs":3475,"@metamask/controller-utils":1639,"bn.js":4413,uuid:6134},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AccountsApiRemoteTransactionSource=n.SUPPORTED_CHAIN_IDS=void 0;const u=e("@metamask/controller-utils"),l=c(e("bn.js")),d=e("uuid"),f=e("../index.cjs"),h=e("../api/accounts-api.cjs"),m=e("../constants.cjs"),p=e("../logger.cjs"),g=e("../types.cjs");n.SUPPORTED_CHAIN_IDS=[m.CHAIN_IDS.MAINNET,m.CHAIN_IDS.POLYGON,m.CHAIN_IDS.BSC,m.CHAIN_IDS.LINEA_MAINNET,m.CHAIN_IDS.BASE,m.CHAIN_IDS.OPTIMISM,m.CHAIN_IDS.ARBITRUM,m.CHAIN_IDS.SCROLL,m.CHAIN_IDS.SEI,m.CHAIN_IDS.MONAD,m.CHAIN_IDS.HYPEREVM];const b=(0,p.createModuleLogger)(p.incomingTransactionsLogger,"accounts-api-source");n.AccountsApiRemoteTransactionSource=class{constructor(){s.add(this)}getSupportedChains(){return n.SUPPORTED_CHAIN_IDS}async fetchTransactions(e){const{address:t,chainIds:c}=e,u=await o(this,s,"m",a).call(this,e,c??n.SUPPORTED_CHAIN_IDS);b("Fetched transactions",u.length,u);const l=await Promise.all(u.map(e=>o(this,s,"m",i).call(this,t,e)));b("Normalized transactions",l);const d=o(this,s,"m",r).call(this,e,l);return b("Filtered transactions",d.length,d),d}},s=new WeakSet,a=async function(e,t){const{address:n,tags:s}=e,a=[];try{const e=await(0,h.getAccountTransactions)({address:n,chainIds:t,sortDirection:"DESC",tags:s});e?.data&&a.push(...e.data)}catch(e){b("Error while fetching transactions",e)}return a},r=function(e,t){const{address:n,includeTokenTransfers:s,updateTransactions:a}=e;let r=t;return a||(r=r.filter(e=>e.txParams.to===n)),s||(r=r.filter(e=>!e.isTransfer)),r},i=async function(e,t){const n=String(t.blockNumber),s=`0x${t.chainId.toString(16)}`,{hash:a}=t,r=new Date(t.timestamp).getTime(),i=(0,d.v1)({msecs:r}),{from:o}=t,c=(0,u.BNToHex)(new l.default(t.gas)),h=(0,u.BNToHex)(new l.default(t.gasPrice)),m=(0,u.BNToHex)(new l.default(t.gasUsed)),p=(0,u.BNToHex)(new l.default(t.nonce)),b=t.methodId,y=g.TransactionType.incoming,w=t.isError?g.TransactionStatus.failed:g.TransactionStatus.confirmed,T=t.valueTransfers.find(t=>(t.to.toLowerCase()===e.toLowerCase()||t.from.toLowerCase()===e.toLowerCase())&&t.contractAddress),S=T?.to.toLowerCase()===e.toLowerCase()&&o.toLowerCase()!==e.toLowerCase(),E=o.toLowerCase()===e.toLowerCase(),k=T?.amount,P=T?.contractAddress,v=T?.decimal,I=T?.symbol,_=(0,u.BNToHex)(new l.default(S?T?.amount??t.value:t.value)),A=S?e:t.to,C={blockNumber:n,chainId:s,error:w===g.TransactionStatus.failed?new Error("Transaction failed"):undefined,hash:a,id:i,isTransfer:S,networkClientId:"",status:w,time:r,toSmartContract:!1,transferInformation:T?{amount:k,contractAddress:P,decimals:v,symbol:I}:undefined,txParams:{chainId:s,data:b,from:o,gas:c,gasPrice:h,gasUsed:m,nonce:p,to:A,value:_},type:y,verifiedOnBlockchain:!1};return E&&(C.type=(await(0,f.determineTransactionType)(C.txParams)).type),C}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/AccountsApiRemoteTransactionSource.cjs"}],[3463,{"../gas-flows/DefaultGasFeeFlow.cjs":3455,"../logger.cjs":3474,"../types.cjs":3475,"../utils/gas-flow.cjs":3485,"../utils/layer1-gas-fee-flow.cjs":3487,"@metamask/eth-query":2226,"@metamask/utils":3554,events:4770},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y,w,T,S,E,k,P,v,I=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},_=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},A=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateTransactionGasEstimates=n.updateTransactionGasProperties=n.GasFeePoller=void 0;const C=A(e("@metamask/eth-query")),j=e("@metamask/utils"),x=A(e("events")),R=e("../gas-flows/DefaultGasFeeFlow.cjs"),O=e("../logger.cjs"),F=e("../types.cjs"),N=e("../utils/gas-flow.cjs"),M=e("../utils/layer1-gas-fee-flow.cjs"),L=(0,j.createModuleLogger)(O.projectLogger,"gas-fee-poller");function G(e,t,n,s){const{type:a}=t;if(s){if(a===F.GasFeeEstimateType.FeeMarket){const s=t;e.maxFeePerGas=s[n]?.maxFeePerGas,e.maxPriorityFeePerGas=s[n]?.maxPriorityFeePerGas}if(a===F.GasFeeEstimateType.GasPrice){const n=t;e.maxFeePerGas=n.gasPrice,e.maxPriorityFeePerGas=n.gasPrice}if(a===F.GasFeeEstimateType.Legacy){const s=t[n];e.maxFeePerGas=s,e.maxPriorityFeePerGas=s}delete e.gasPrice}else{if(a===F.GasFeeEstimateType.FeeMarket){const s=t;e.gasPrice=s[n]?.maxFeePerGas}if(a===F.GasFeeEstimateType.GasPrice){const n=t;e.gasPrice=n.gasPrice}if(a===F.GasFeeEstimateType.Legacy){const s=t;e.gasPrice=s[n]}delete e.maxFeePerGas,delete e.maxPriorityFeePerGas}}n.GasFeePoller=class{constructor({findNetworkClientIdByChainId:e,gasFeeFlows:t,getGasFeeControllerEstimates:n,getProvider:g,getTransactions:b,getTransactionBatches:y,layer1GasFeeFlows:w,messenger:T,onStateChange:S}){s.add(this),this.hub=new x.default,a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),l.set(this,void 0),d.set(this,void 0),f.set(this,void 0),h.set(this,!1),I(this,a,e,"f"),I(this,r,t,"f"),I(this,l,w,"f"),I(this,i,n,"f"),I(this,o,g,"f"),I(this,c,b,"f"),I(this,u,y,"f"),I(this,d,T,"f"),S(()=>{const e=_(this,s,"m",k).call(this),t=_(this,s,"m",P).call(this);e.length||t.length?_(this,s,"m",m).call(this):_(this,s,"m",p).call(this)})}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,h=new WeakMap,s=new WeakSet,m=function(){_(this,h,"f")||(_(this,s,"m",g).call(this),I(this,h,!0,"f"),L("Started polling"))},p=function(){_(this,h,"f")&&(clearTimeout(_(this,f,"f")),I(this,f,undefined,"f"),I(this,h,!1,"f"),L("Stopped polling"))},g=async function e(){await _(this,s,"m",b).call(this),await _(this,s,"m",y).call(this),I(this,f,setTimeout(()=>_(this,s,"m",e).call(this),1e4),"f")},b=async function(){const e=_(this,s,"m",k).call(this);if(!e.length)return;L("Found unapproved transactions",e.length);const t=await _(this,s,"m",v).call(this,e);L("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,a=t.get(n);return _(this,s,"m",w).call(this,e,a)}))},y=async function(){const e=_(this,s,"m",P).call(this);if(!e.length)return;L("Found unapproved transaction batches",e.length);const t=await _(this,s,"m",v).call(this,e);L("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,a=t.get(n);return _(this,s,"m",T).call(this,e,a)}))},w=async function(e,t){const{id:n}=e,[a,r]=await Promise.all([_(this,s,"m",S).call(this,e,t),_(this,s,"m",E).call(this,e)]);(a||r)&&this.hub.emit("transaction-updated",{transactionId:n,gasFeeEstimates:a?.gasFeeEstimates,gasFeeEstimatesLoaded:a?.gasFeeEstimatesLoaded,layer1GasFee:r})},T=async function(e,t){const{id:n}=e,s=new C.default(_(this,o,"f").call(this,e.networkClientId)),a=new R.DefaultGasFeeFlow,r={ethQuery:s,gasFeeControllerData:t,messenger:_(this,d,"f"),transactionMeta:{...e,txParams:{...e.transactions?.[0],from:e.from,gas:e.gas},time:Date.now()}};let i;try{i=(await a.getGasFees(r)).estimates}catch(t){L("Failed to get gas fees for batch",e.id,t)}i&&this.hub.emit("transaction-batch-updated",{transactionBatchId:n,gasFeeEstimates:i,gasFeeEstimatesLoaded:!0})},S=async function(e,t){const{networkClientId:n}=e,s=new C.default(_(this,o,"f").call(this,n)),a=(0,N.getGasFeeFlow)(e,_(this,r,"f"),_(this,d,"f"));a&&L("Found gas fee flow",a.constructor.name,e.id);const i={ethQuery:s,gasFeeControllerData:t,messenger:_(this,d,"f"),transactionMeta:e};let c;if(a)try{c=(await a.getGasFees(i)).estimates}catch(t){L("Failed to get suggested gas fees",e.id,t)}return!c&&e.gasFeeEstimatesLoaded?undefined:(L("Updated gas fee estimates",{gasFeeEstimates:c,transaction:e.id}),{gasFeeEstimates:c,gasFeeEstimatesLoaded:!0})},E=async function(e){const{networkClientId:t}=e,n=_(this,o,"f").call(this,t),s=await(0,M.getTransactionLayer1GasFee)({layer1GasFeeFlows:_(this,l,"f"),messenger:_(this,d,"f"),provider:n,transactionMeta:e});return s&&L("Updated layer 1 gas fee",s,e.id),s},k=function(){return _(this,c,"f").call(this).filter(e=>e.status===F.TransactionStatus.unapproved)},P=function(){return _(this,u,"f").call(this).filter(e=>e.status===F.TransactionStatus.unapproved)},v=async function(e){const t=new Map;for(const n of e){const{chainId:e,networkClientId:s}=n;if(t.has(e))continue;const r=s??_(this,a,"f").call(this,e);t.set(e,r)}L("Extracted network client IDs by chain ID",t);const n=Array.from(t.entries()).map(async([e,t])=>[e,await _(this,i,"f").call(this,{networkClientId:t})]);return new Map(await Promise.all(n))},n.updateTransactionGasProperties=function({gasFeeEstimates:e,gasFeeEstimatesLoaded:t,isTxParamsGasFeeUpdatesEnabled:n,layer1GasFee:s,txMeta:a}){const r=a.userFeeLevel,i=Object.values(F.GasFeeEstimateLevel).includes(r);if(n(a)&&i&&e){const t=a.txParams.type!==F.TransactionEnvelopeType.legacy;G(a.txParams,e,r,t)}e&&(a.gasFeeEstimates=e),t!==undefined&&(a.gasFeeEstimatesLoaded=t),s&&(a.layer1GasFee=s)},n.updateTransactionGasEstimates=function({txMeta:e,userFeeLevel:t}){const{txParams:n,gasFeeEstimates:s}=e;if(!s)return;G(n,s,t,e.txParams.type!==F.TransactionEnvelopeType.legacy)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/GasFeePoller.cjs"}],[3464,{"../logger.cjs":3474,"../utils/feature-flags.cjs":3481,"../utils/utils.cjs":3494,"./AccountsApiRemoteTransactionSource.cjs":3462,events:4770},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y,w,T,S,E,k,P,v,I,_,A,C,j,x,R,O,F=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},N=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},M=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.IncomingTransactionHelper=n.WebSocketState=void 0;const L=M(e("events")),G=e("./AccountsApiRemoteTransactionSource.cjs"),D=e("../logger.cjs"),B=e("../utils/feature-flags.cjs"),U=e("../utils/utils.cjs");var H;!function(e){e.CONNECTED="connected",e.DISCONNECTED="disconnected"}(H||(n.WebSocketState=H={}));n.IncomingTransactionHelper=class{constructor({client:e,getCurrentAccount:t,getLocalTransactions:n,includeTokenTransfers:E,isEnabled:P,messenger:v,remoteTransactionSource:A,trimTransactions:C,updateTransactions:j}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),l.set(this,void 0),d.set(this,void 0),f.set(this,void 0),h.set(this,void 0),m.set(this,void 0),p.set(this,void 0),g.set(this,void 0),b.set(this,[...G.SUPPORTED_CHAIN_IDS]),y.set(this,e=>{N(this,s,"m",k).call(this,e)}),w.set(this,e=>{N(this,s,"m",I).call(this,e)}),T.set(this,()=>{N(this,s,"m",_).call(this)}),S.set(this,({chainIds:e,status:t})=>{N(this,s,"m",O).call(this,e,t)}),this.hub=new L.default,F(this,a,e,"f"),F(this,r,t,"f"),F(this,i,n,"f"),F(this,o,E,"f"),F(this,c,P??(()=>!0),"f"),F(this,u,!1,"f"),F(this,l,!1,"f"),F(this,d,v,"f"),F(this,f,A,"f"),F(this,m,C,"f"),F(this,p,j,"f"),F(this,g,(0,B.isIncomingTransactionsUseWebsocketsEnabled)(v),"f"),N(this,g,"f")&&(N(this,d,"f").subscribe("BackendWebSocketService:connectionStateChanged",N(this,y,"f")),N(this,d,"f").subscribe("AccountActivityService:statusChanged",N(this,S,"f")))}start(){N(this,g,"f")||N(this,s,"m",E).call(this,!0)}stop(){N(this,h,"f")&&clearTimeout(N(this,h,"f")),N(this,u,"f")&&(F(this,u,!1,"f"),(0,D.incomingTransactionsLogger)("Stopped polling"))}async update({chainIds:e,isInterval:t,tags:n}={}){const a=N(this,s,"m",R).call(this,n,t);if((0,D.incomingTransactionsLogger)("Checking for incoming transactions",{isInterval:Boolean(t),tags:a}),!N(this,s,"m",j).call(this))return;const c=N(this,r,"f").call(this),u=N(this,o,"f")??!0,l=N(this,p,"f")??!1;let d=[];try{d=await N(this,f,"f").fetchTransactions({address:c.address,chainIds:e,includeTokenTransfers:u,tags:a,updateTransactions:l})}catch(e){return void(0,D.incomingTransactionsLogger)("Error while fetching remote transactions",e)}if(!d.length)return;N(this,s,"m",C).call(this,d),(0,D.incomingTransactionsLogger)("Found potential transactions",d.length,d);const h=N(this,i,"f").call(this),g=d.filter(e=>!h.some(t=>t.hash?.toLowerCase()===e.hash?.toLowerCase()&&t.txParams.from?.toLowerCase()===e.txParams.from?.toLowerCase()&&t.type===e.type));if(!g.length)return void(0,D.incomingTransactionsLogger)("All transactions are already known");(0,D.incomingTransactionsLogger)("Found unique transactions",g.length,g);const b=N(this,m,"f").call(this,[...g,...h]),y=g.map(e=>e.id),w=b.filter(e=>y.includes(e.id));w.length?((0,D.incomingTransactionsLogger)("Adding new transactions",w.length,w),this.hub.emit("transactions",w)):(0,D.incomingTransactionsLogger)("All unique transactions truncated due to limit")}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,h=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,T=new WeakMap,S=new WeakMap,s=new WeakSet,E=function(e=!1){if(N(this,u,"f"))return;if(!N(this,s,"m",j).call(this))return;const t=N(this,s,"m",x).call(this);(0,D.incomingTransactionsLogger)("Started polling",{interval:t}),F(this,u,!0,"f"),N(this,l,"f")||N(this,s,"m",A).call(this).catch(t=>{(0,D.incomingTransactionsLogger)(e?"Initial polling failed":"Polling failed",t)})},k=function(e){e.state===H.CONNECTED?((0,D.incomingTransactionsLogger)("WebSocket connected, starting enhanced mode"),N(this,s,"m",P).call(this)):e.state===H.DISCONNECTED&&((0,D.incomingTransactionsLogger)("WebSocket disconnected, stopping enhanced mode"),N(this,s,"m",v).call(this))},P=function(){N(this,s,"m",j).call(this)&&((0,D.incomingTransactionsLogger)("Started transaction history retrieval (event-driven)"),this.update().catch(e=>{(0,D.incomingTransactionsLogger)("Initial update in transaction history retrieval failed",e)}),N(this,d,"f").subscribe("AccountActivityService:transactionUpdated",N(this,w,"f")),N(this,d,"f").subscribe("AccountsController:selectedAccountChange",N(this,T,"f")))},v=function(){(0,D.incomingTransactionsLogger)("Stopped transaction history retrieval"),N(this,d,"f").unsubscribe("AccountActivityService:transactionUpdated",N(this,w,"f")),N(this,d,"f").unsubscribe("AccountsController:selectedAccountChange",N(this,T,"f"))},I=function(e){(0,D.incomingTransactionsLogger)("Received relevant transaction update, triggering update",{txId:e.id,chain:e.chain}),this.update().catch(e=>{(0,D.incomingTransactionsLogger)("Update after transaction event failed",e)})},_=function(){(0,D.incomingTransactionsLogger)("Selected account changed, triggering update"),this.update().catch(e=>{(0,D.incomingTransactionsLogger)("Update after account change failed",e)})},A=async function e(){F(this,l,!0,"f");try{const e=N(this,g,"f")?N(this,b,"f"):undefined;await this.update({chainIds:e,isInterval:!0})}catch(e){console.error("Error while checking incoming transactions",e)}F(this,l,!1,"f"),N(this,u,"f")&&(N(this,h,"f")&&clearTimeout(N(this,h,"f")),F(this,h,setTimeout(()=>N(this,s,"m",e).call(this),N(this,s,"m",x).call(this)),"f"))},C=function(e){e.sort((e,t)=>e.time<t.time?-1:1)},j=function(){return N(this,c,"f").call(this)},x=function(){return(0,B.getIncomingTransactionsPollingInterval)(N(this,d,"f"))},R=function(e,t){const n=[];return N(this,a,"f")&&n.push(N(this,a,"f")),e?.length?n.push(...e):t&&n.push("automatic-polling"),n?.length?n:undefined},O=function(e,t){if(!N(this,g,"f"))return;let n=!1;for(const s of e){const e=(0,U.caip2ToHex)(s);if(e&&G.SUPPORTED_CHAIN_IDS.includes(e))if("up"===t){const t=N(this,b,"f").indexOf(e);-1!==t&&(N(this,b,"f").splice(t,1),n=!0,(0,D.incomingTransactionsLogger)("Supported network came up, removed from polling list",{chainId:e}))}else"down"!==t||N(this,b,"f").includes(e)||(N(this,b,"f").push(e),n=!0,(0,D.incomingTransactionsLogger)("Supported network went down, added to polling list",{chainId:e}));else(0,D.incomingTransactionsLogger)("Chain ID not recognized or not supported",{caip2ChainId:s,hexChainId:e})}n?0===N(this,b,"f").length?((0,D.incomingTransactionsLogger)("Stopping fallback polling - all networks up"),this.stop()):((0,D.incomingTransactionsLogger)("Starting fallback polling - some networks need polling",{chainsToPoll:N(this,b,"f")}),N(this,s,"m",E).call(this)):(0,D.incomingTransactionsLogger)("No changes to polling list",{chainsToPoll:N(this,b,"f")})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/IncomingTransactionHelper.cjs"}],[3465,{"../logger.cjs":3474,"@metamask/utils":3554,"async-mutex":4345,"eth-method-registry":4716,events:4770},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.MethodDataHelper=void 0;const f=e("@metamask/utils"),h=e("async-mutex"),m=e("eth-method-registry"),p=d(e("events")),g=e("../logger.cjs"),b=(0,f.createModuleLogger)(g.projectLogger,"method-data");n.MethodDataHelper=class{constructor({getProvider:e,getState:t}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,new h.Mutex),this.hub=new p.default,u(this,a,e,"f"),u(this,r,t,"f"),u(this,i,new Map,"f")}async lookup(e,t){b("lookup",e,t);const n=await l(this,o,"f").acquire();try{const n=l(this,r,"f").call(this)[e];if(n)return b("Cached",n),n;let o=l(this,i,"f").get(t);if(!o){const e=l(this,a,"f").call(this,t);o=new m.MethodRegistry({provider:e}),l(this,i,"f").set(t,o),b("Created registry",t)}const u=await l(this,s,"m",c).call(this,e,o);return b("Result",u),this.hub.emit("update",{fourBytePrefix:e,methodData:u}),u}finally{n()}}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,s=new WeakSet,c=async function(e,t){const n=await t.lookup(e);if(!n)return b("No method found",e),{registryMethod:"",parsedRegistryMethod:{name:undefined,args:undefined}};b("Parsing",n);return{registryMethod:n,parsedRegistryMethod:t.parse(n)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/MethodDataHelper.cjs"}],[3466,{"../logger.cjs":3474,"async-mutex":4345},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainTrackingHelper=void 0;const b=e("async-mutex"),y=e("../logger.cjs"),w=(0,y.createModuleLogger)(y.projectLogger,"multichain-tracking");n.MultichainTrackingHelper=class{constructor({findNetworkClientIdByChainId:e,getNetworkClientById:t,getNetworkClientRegistry:n,removePendingTransactionTrackerListeners:b,createNonceTracker:y,createPendingTransactionTracker:T,onNetworkStateChange:S}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),l.set(this,new Map),d.set(this,new Map),this.checkForPendingTransactionAndStartPolling=()=>{for(const[,e]of g(this,d,"f"))e.pendingTransactionTracker.startIfPendingTransactions()},f.set(this,e=>{const t=Object.keys(e),n=Array.from(g(this,d,"f").keys()),a=n.filter(e=>!t.includes(e));a.forEach(e=>{g(this,s,"m",h).call(this,e)});const r=t.filter(e=>!n.includes(e));r.forEach(e=>{g(this,s,"m",m).call(this,e)}),r.length&&w("Added trackers",r),a.length&&w("Removed trackers",a)}),p(this,a,e,"f"),p(this,r,t,"f"),p(this,i,n,"f"),p(this,o,b,"f"),p(this,c,y,"f"),p(this,u,T,"f"),S((e,t)=>{const n=g(this,i,"f").call(this);t.forEach(({op:e,path:t})=>{if("remove"===e&&"networkConfigurations"===t[0]){const e=t[1];delete n[e]}}),g(this,f,"f").call(this,n)})}initialize(){const e=g(this,i,"f").call(this);g(this,f,"f").call(this,e),w("Initialized")}has(e){return g(this,d,"f").has(e)}async acquireNonceLockForChainIdKey({chainId:e,key:t="global"}){let n=g(this,l,"f").get(e);n||(n=new Map,g(this,l,"f").set(e,n));let s=n.get(t);return s||(s=new b.Mutex,n.set(t,s)),await s.acquire()}async getNonceLock(e,t){const n=g(this,r,"f").call(this,t),s=await this.acquireNonceLockForChainIdKey({chainId:n.configuration.chainId,key:e}),a=g(this,d,"f").get(t)?.nonceTracker;if(!a)throw new Error(`Missing nonce tracker for network client ID - ${t}`);try{const t=await a.getNonceLock(e),n=()=>{t.releaseLock(),s?.()};return{...t,releaseLock:n}}catch(e){throw s?.(),e}}stopAllTracking(){for(const[e]of g(this,d,"f"))g(this,s,"m",h).call(this,e)}getNetworkClient({chainId:e,networkClientId:t}){if(!t&&!e)throw new Error("Cannot locate network client without networkClientId or chainId");let n,s=t;try{t&&(n=g(this,r,"f").call(this,t))}catch(n){if(w("No network client found with ID",t),!e)throw n}return!n&&e&&(s=g(this,a,"f").call(this,e),n=g(this,r,"f").call(this,s)),{...n,id:s}}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,s=new WeakSet,h=function(e){const t=g(this,d,"f").get(e);t&&(t.pendingTransactionTracker.stop(),g(this,o,"f").call(this,t.pendingTransactionTracker),g(this,d,"f").delete(e))},m=function(e){if(g(this,d,"f").get(e))return;const{provider:t,blockTracker:n,configuration:{chainId:s}}=g(this,r,"f").call(this,e),a=g(this,c,"f").call(this,{provider:t,blockTracker:n,chainId:s}),i=g(this,u,"f").call(this,{provider:t,blockTracker:n,chainId:s,networkClientId:e});g(this,d,"f").set(e,{nonceTracker:a,pendingTransactionTracker:i})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/MultichainTrackingHelper.cjs"}],[3467,{"../logger.cjs":3474,"../types.cjs":3475,"../utils/feature-flags.cjs":3481,"./TransactionPoller.cjs":3469,"@metamask/controller-utils":1639,events:4770,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y,w,T,S,E,k,P,v,I,_,A,C,j,x,R,O,F,N,M,L,G,D,B,U,H,$,q,K=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},W=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},z=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingTransactionTracker=void 0;const V=e("@metamask/controller-utils"),J=z(e("events")),Y=e("lodash"),X=e("./TransactionPoller.cjs"),Q=e("../logger.cjs"),Z=e("../types.cjs"),ee=e("../utils/feature-flags.cjs"),te=["replacement transaction underpriced","known transaction","gas price too low to replace","transaction with the same hash was already imported","gateway timeout","nonce too low"],ne=(0,Q.createModuleLogger)(Q.projectLogger,"pending-transactions");n.PendingTransactionTracker=class{constructor({blockTracker:e,getChainId:t,getEthQuery:n,getGlobalLock:k,getNetworkClientId:P,getTransactions:v,isTimeoutEnabled:I,hooks:_,isResubmitEnabled:A,messenger:C,publishTransaction:j}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),l.set(this,void 0),d.set(this,void 0),f.set(this,void 0),h.set(this,void 0),m.set(this,void 0),p.set(this,void 0),g.set(this,void 0),b.set(this,void 0),y.set(this,void 0),w.set(this,void 0),T.set(this,void 0),this.startIfPendingTransactions=()=>{const e=W(this,s,"m",F).call(this);e.length?W(this,s,"m",S).call(this,e):this.stop()},this.hub=new J.default,K(this,r,new Map,"f"),K(this,o,t,"f"),K(this,c,n,"f"),K(this,u,k,"f"),K(this,l,P,"f"),K(this,d,v,"f"),K(this,f,A??(()=>!0),"f"),K(this,h,new Map,"f"),K(this,m,W(this,s,"m",E).bind(this),"f"),K(this,g,C,"f"),K(this,b,j,"f"),K(this,y,!1,"f"),K(this,T,undefined,"f"),K(this,w,new X.TransactionPoller({blockTracker:e,chainId:t(),messenger:C}),"f"),K(this,a,_?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),K(this,i,I,"f"),K(this,p,(0,Q.createModuleLogger)(ne,`${t()}:${P()}`),"f")}addTransactionToPoll(e){W(this,s,"m",S).call(this,[e]),K(this,T,e,"f")}async forceCheckTransaction(e){const t=await W(this,u,"f").call(this);try{await W(this,s,"m",C).call(this,e)}catch(e){W(this,p,"f").call(this,"Failed to check transaction",e)}finally{t()}}stop(){W(this,y,"f")&&(W(this,w,"f").stop(),K(this,y,!1,"f"),W(this,p,"f").call(this,"Stopped polling"))}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,h=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,T=new WeakMap,s=new WeakSet,S=function(e){W(this,w,"f").setPendingTransactions(e),W(this,y,"f")||(W(this,w,"f").start(W(this,m,"f")),K(this,y,!0,"f"),W(this,p,"f").call(this,"Started polling"))},E=async function(e){const t=await W(this,u,"f").call(this);try{await W(this,s,"m",k).call(this)}catch(e){W(this,p,"f").call(this,"Failed to check transactions",e)}finally{t()}try{await W(this,s,"m",P).call(this,e)}catch(e){W(this,p,"f").call(this,"Failed to resubmit transactions",e)}},k=async function(){W(this,p,"f").call(this,"Checking transactions");const e=[...W(this,s,"m",F).call(this),...W(this,T,"f")?[W(this,T,"f")]:[]];e.length?(W(this,p,"f").call(this,"Found pending transactions to check",{count:e.length,ids:e.map(e=>e.id)}),await Promise.all(e.map(e=>W(this,s,"m",C).call(this,e)))):W(this,p,"f").call(this,"No pending transactions to check")},P=async function(e){if(!W(this,f,"f").call(this)||!W(this,y,"f"))return;W(this,p,"f").call(this,"Resubmitting transactions");const t=W(this,s,"m",F).call(this);if(t.length){W(this,p,"f").call(this,"Found pending transactions to resubmit",{count:t.length,ids:t.map(e=>e.id)});for(const n of t)try{await W(this,s,"m",I).call(this,n,e)}catch(e){const t=e.value?.message?.toLowerCase()??e.message?.toLowerCase()??String(e);if(W(this,s,"m",v).call(this,t)){W(this,p,"f").call(this,"Ignoring known transaction error",t);continue}W(this,s,"m",N).call(this,n,e.message,"There was an error when resubmitting this transaction.")}}else W(this,p,"f").call(this,"No pending transactions to resubmit")},v=function(e){return te.some(t=>e.includes(t))},I=async function(e,t){if(!W(this,s,"m",_).call(this,e,t))return;if(!await W(this,a,"f").call(this,e))return;const n=W(this,c,"f").call(this,e.networkClientId);await W(this,b,"f").call(this,n,e);const r=(e.retryCount??0)+1;W(this,s,"m",G).call(this,(0,Y.merge)({},e,{retryCount:r}),"PendingTransactionTracker:transaction-retry - Retry count increased")},_=function(e,t){const n=(0,Y.cloneDeep)(e);n.firstRetryBlockNumber||(n.firstRetryBlockNumber=t,W(this,s,"m",G).call(this,n,"PendingTransactionTracker:#isResubmitDue - First retry block number set"));const{firstRetryBlockNumber:a}=n,r=Number.parseInt(t,16)-Number.parseInt(a,16),i=e.retryCount??0;return r>=Math.min(50,Math.pow(2,i))},A=function(e){const{hash:t,id:n}=e;W(this,T,"f")?.id===n&&K(this,T,undefined,"f"),t&&W(this,h,"f").delete(t)},C=async function(e){const{hash:t,id:n,isIntentComplete:r,txParams:{from:i}}=e;if(r)await W(this,s,"m",j).call(this,e);else{if(!t&&await W(this,a,"f").call(this,e)){const t=new Error("We had an error while submitting this transaction, please try again.");return t.name="NoTxHashError",void W(this,s,"m",M).call(this,e,t)}if(W(this,s,"m",O).call(this,e))return W(this,p,"f").call(this,"Nonce already taken",n),void W(this,s,"m",L).call(this,e);try{const n=await W(this,s,"m",D).call(this,t),a="0x1"===n?.status;if("0x0"===n?.status)return W(this,p,"f").call(this,"Transaction receipt has failed status"),void W(this,s,"m",M).call(this,e,new Error("Transaction failed on-chain"));const{blockNumber:r,blockHash:o}=n??{};if(a&&r&&o)return void await W(this,s,"m",j).call(this,e,{...n,blockNumber:r,blockHash:o});W(this,p,"f").call(this,"No receipt status",{hash:t,receipt:n});const c=await W(this,s,"m",H).call(this,i),u=parseInt(c,16);if(!n&&await W(this,s,"m",x).call(this,e,u))return;await W(this,s,"m",R).call(this,e,u)&&W(this,s,"m",L).call(this,e)}catch(t){W(this,p,"f").call(this,"Failed to check transaction",n,t),W(this,s,"m",N).call(this,e,t.message,"There was a problem loading this transaction.")}}},j=async function(e,t){const{id:n}=e,{blockHash:a}=t??{};W(this,p,"f").call(this,"Transaction confirmed",n);const r=W(this,T,"f")?.id===n;if(W(this,s,"m",A).call(this,e),r)return void this.hub.emit("transaction-confirmed",e);const i=(0,Y.cloneDeep)(e);if(t&&a){const{baseFeePerGas:e,timestamp:n}=await W(this,s,"m",U).call(this,a,!1);i.baseFeePerGas=e,i.blockTimestamp=n,i.txParams={...i.txParams,gasUsed:t.gasUsed},i.txReceipt=t,i.verifiedOnBlockchain=!0}i.status=Z.TransactionStatus.confirmed,W(this,s,"m",G).call(this,i,"PendingTransactionTracker:#onTransactionConfirmed - Transaction confirmed"),this.hub.emit("transaction-confirmed",i)},x=async function(e,t){const{chainId:n,hash:a,id:r,submittedTime:o,txParams:{nonce:c}}=e;if(!a||!c)return!1;if(!W(this,i,"f").call(this,e))return W(this,p,"f").call(this,"Timeout disabled for transaction",e),!1;const u=(0,ee.getTimeoutAttempts)(n,W(this,g,"f"));if(u===undefined||0===u)return W(this,p,"f").call(this,"Timeout disabled due to threshold",{chainId:n,threshold:u}),!1;const l=parseInt(c,16);if(l>t)return W(this,p,"f").call(this,"Skipping timeout as queued transaction",{transactionNonce:l,nextNonce:t}),!1;try{if(null!==await W(this,s,"m",B).call(this,a)){const e=Date.now();return W(this,p,"f").call(this,"Transaction found on network, recording timestamp",r),W(this,h,"f").set(a,e),!1}const t=W(this,h,"f").get(a)??o;if(t===undefined)return W(this,p,"f").call(this,"Transaction not yet seen on network and has no submitted time, skipping timeout check",r),!1;const{blockTime:i}=(0,ee.getAcceleratedPollingParams)(n,W(this,g,"f")),c=Date.now()-t,l=i*u;return W(this,p,"f").call(this,"Checking timeout duration",{transactionId:r,durationSinceLastSeen:c,timeoutDuration:l,threshold:u,blockTime:i}),c<l?!1:(W(this,p,"f").call(this,"Hit timeout duration threshold",r),W(this,h,"f").delete(a),W(this,s,"m",M).call(this,e,new Error("Transaction not found on network after timeout")),!0)}catch(e){return W(this,p,"f").call(this,"Failed to check transaction by hash",r,e),!1}},R=async function(e,t){const{hash:n,id:s,txParams:{nonce:a}}=e;if(!a||!n)return!1;if(parseInt(a,16)>=t)return!1;let i=W(this,r,"f").get(n);return i===undefined&&(i=0,W(this,r,"f").set(n,i)),i<3?(W(this,p,"f").call(this,"Incrementing dropped block count",{id:s,droppedBlockCount:i}),W(this,r,"f").set(n,i+1),!1):(W(this,p,"f").call(this,"Hit dropped block count",s),W(this,r,"f").delete(n),!0)},O=function(e){const{id:t,txParams:n}=e;return W(this,s,"m",$).call(this).some(e=>e.id!==t&&e.txParams.from===n.from&&e.status===Z.TransactionStatus.confirmed&&e.txParams.nonce&&e.txParams.nonce===n.nonce&&e.type!==Z.TransactionType.incoming&&e.isTransfer===undefined)},F=function(){return W(this,s,"m",q).call(this).filter(e=>e.status===Z.TransactionStatus.submitted&&!e.verifiedOnBlockchain&&!e.isUserOperation&&!e.isStateOnly)},N=function(e,t,n){W(this,s,"m",G).call(this,{...e,warning:{error:t,message:n}},"PendingTransactionTracker:#warnTransaction - Warning added")},M=function(e,t){W(this,p,"f").call(this,"Transaction failed",e.id,t),W(this,s,"m",A).call(this,e),this.hub.emit("transaction-failed",e,t)},L=function(e){W(this,p,"f").call(this,"Transaction dropped",e.id),W(this,s,"m",A).call(this,e),this.hub.emit("transaction-dropped",e)},G=function(e,t){this.hub.emit("transaction-updated",e,t)},D=async function(e){return await(0,V.query)(W(this,c,"f").call(this),"getTransactionReceipt",[e])},B=async function(e){return await(0,V.query)(W(this,c,"f").call(this),"getTransactionByHash",[e])},U=async function(e,t){return await(0,V.query)(W(this,c,"f").call(this),"getBlockByHash",[e,t])},H=async function(e){return await(0,V.query)(W(this,c,"f").call(this),"getTransactionCount",[e])},$=function(){const e=W(this,o,"f").call(this);return W(this,d,"f").call(this).filter(t=>t.chainId===e)},q=function(){const e=W(this,l,"f").call(this);return W(this,d,"f").call(this).filter(t=>t.networkClientId===e)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/PendingTransactionTracker.cjs"}],[3468,{"../logger.cjs":3474,"../types.cjs":3475,"../utils/utils.cjs":3494,"@metamask/utils":3554,"bn.js":4413,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.hasSimulationDataChanged=n.shouldResimulate=n.ResimulateHelper=n.RESIMULATE_INTERVAL_MS=n.BLOCK_TIME_ADDITIONAL_SECONDS=n.VALUE_COMPARISON_PERCENT_THRESHOLD=n.BLOCKAID_RESULT_TYPE_MALICIOUS=n.RESIMULATE_PARAMS=void 0;const m=e("@metamask/utils"),p=e("bn.js"),g=e("lodash"),b=e("../logger.cjs"),y=e("../types.cjs"),w=e("../utils/utils.cjs"),T=(0,b.createModuleLogger)(b.projectLogger,"resimulate-helper");n.RESIMULATE_PARAMS=["to","value","data"],n.BLOCKAID_RESULT_TYPE_MALICIOUS="Malicious",n.VALUE_COMPARISON_PERCENT_THRESHOLD=5,n.BLOCK_TIME_ADDITIONAL_SECONDS=60,n.RESIMULATE_INTERVAL_MS=3e3;function S(e,t){return!E(e?.difference??"0x0",t?.difference??"0x0",!1===e?.isDecrease,!1===t?.isDecrease)}function E(e,t,s,a){let r=new p.BN((0,m.remove0x)(e),"hex"),i=new p.BN((0,m.remove0x)(t),"hex");return s&&(r=r.neg()),a&&(i=i.neg()),(0,w.getPercentageChange)(r,i)<=n.VALUE_COMPARISON_PERCENT_THRESHOLD}n.ResimulateHelper=class{constructor({getTransactions:e,simulateTransaction:t,onTransactionsUpdate:n}){s.add(this),a.set(this,new Map),r.set(this,void 0),i.set(this,void 0),f(this,r,e,"f"),f(this,i,t,"f"),n(h(this,s,"m",o).bind(this))}},a=new WeakMap,r=new WeakMap,i=new WeakMap,s=new WeakSet,o=function(){const e=h(this,r,"f").call(this).filter(e=>e.status===y.TransactionStatus.unapproved),t=new Set(e.map(e=>e.id));new Set([...t,...h(this,a,"f").keys()]).forEach(t=>{const n=e.find(e=>e.id===t);n?.isActive?h(this,s,"m",c).call(this,n):h(this,s,"m",l).call(this,t)})},c=function(e){const{id:t}=e;if(h(this,a,"f").has(t))return;const r=()=>{h(this,i,"f").call(this,e).catch(e=>{T("Error during transaction resimulation",e)}).finally(()=>{h(this,a,"f").has(t)&&h(this,s,"m",u).call(this,t,r)})};h(this,s,"m",u).call(this,t,r),T(`Started resimulating transaction ${t} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`)},u=function(e,t){const s=setTimeout(t,n.RESIMULATE_INTERVAL_MS);h(this,a,"f").set(e,s)},l=function(e){h(this,a,"f").has(e)&&(h(this,s,"m",d).call(this,e),T(`Stopped resimulating transaction ${e} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`))},d=function(e){const t=h(this,a,"f").get(e);t&&(clearTimeout(t),h(this,a,"f").delete(e))},n.shouldResimulate=function(e,t){const{id:s}=t,a=function(e,t){const{id:s,txParams:a}=t,{txParams:r}=e;if(!r||(0,g.isEqual)(r,a))return!1;const i=Object.keys(a).filter(e=>a[e]!==r[e]);return T("Transaction parameters updated",{transactionId:s,updatedProperties:i,originalParams:r,newParams:a}),n.RESIMULATE_PARAMS.some(e=>i.includes(e))}(e,t),r=function(e,t){const{securityAlertResponse:s}=e,{id:a,securityAlertResponse:r}=t;if((0,g.isEqual)(s,r))return!1;return T("Security alert updated",{transactionId:a,originalSecurityAlertResponse:s,newSecurityAlertResponse:r}),r?.result_type===n.BLOCKAID_RESULT_TYPE_MALICIOUS}(e,t),i=function(e,t){const{simulationData:n}=e,{simulationData:s,txParams:a}=t;if(!s||(0,g.isEqual)(n,s))return!1;return!E(a?.value??"0x0",s?.nativeBalanceChange?.difference??"0x0",!1,!1===s?.nativeBalanceChange?.isDecrease)}(e,t),o=a||r||i;let c;if(r||i){c=Math.floor(Date.now()/1e3)+n.BLOCK_TIME_ADDITIONAL_SECONDS}return o&&T("Transaction should be resimulated",{transactionId:s,blockTime:c,parametersUpdated:a,securityAlert:r,valueAndNativeBalanceMismatch:i}),{blockTime:c,resimulate:o}},n.hasSimulationDataChanged=function(e,t){if((0,g.isEqual)(e,t))return!1;if(S(e?.nativeBalanceChange,t?.nativeBalanceChange))return T("Simulation data native balance changed"),!0;if(e.tokenBalanceChanges.length!==t.tokenBalanceChanges.length)return!0;for(const n of e.tokenBalanceChanges){const e=t.tokenBalanceChanges.find(({address:e,id:t})=>e===n.address&&t===n.id);if(!e)return T("Missing new token balance",{address:n.address,id:n.id}),!0;if(S(n,e))return T("Simulation data token balance changed",{originalTokenBalanceChange:n,newTokenBalanceChange:e}),!0}return!1}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/ResimulateHelper.cjs"}],[3469,{"../logger.cjs":3474,"../utils/feature-flags.cjs":3481,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m,p,g,b,y,w,T=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},S=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPoller=void 0;const E=e("@metamask/utils"),k=e("lodash"),P=e("../logger.cjs"),v=e("../utils/feature-flags.cjs"),I=(0,E.createModuleLogger)(P.projectLogger,"transaction-poller");var _;!function(e){e.Accelerated="Accelerated",e.BlockTracker="BlockTracker",e.Websocket="Websocket"}(_||(_={}));n.TransactionPoller=class{constructor({blockTracker:e,chainId:t,messenger:n}){s.add(this),a.set(this,0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),l.set(this,void 0),d.set(this,!1),f.set(this,void 0),b.set(this,e=>{if(!S(this,d,"f"))return;if("confirmed"!==e.status&&"dropped"!==e.status&&"failed"!==e.status)return;const t=S(this,l,"f")?.some(t=>t.hash?.toLowerCase()===e.id.toLowerCase());t&&S(this,s,"m",m).call(this,_.Websocket).catch(()=>{})}),T(this,r,e,"f"),T(this,i,t,"f"),T(this,o,n,"f")}start(e){S(this,d,"f")||(T(this,u,e,"f"),T(this,d,!0,"f"),S(this,s,"m",y).call(this),S(this,s,"m",h).call(this),I("Started"))}stop(){S(this,d,"f")&&(T(this,d,!1,"f"),T(this,u,undefined,"f"),T(this,a,0,"f"),T(this,l,undefined,"f"),S(this,s,"m",p).call(this),S(this,s,"m",g).call(this),S(this,s,"m",w).call(this),I("Stopped"))}setPendingTransactions(e){const t=(S(this,l,"f")??[]).map(e=>e.id);T(this,l,e,"f");const n=e.map(e=>e.id),r=!(0,k.isEqual)(t,n);S(this,d,"f")&&r&&(I("Detected new pending transactions",n),T(this,a,0,"f"),S(this,c,"f")&&(S(this,s,"m",g).call(this),S(this,s,"m",h).call(this)))}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,b=new WeakMap,s=new WeakSet,h=function e(){if(!S(this,d,"f"))return;const{countMax:t,intervalMs:n}=(0,v.getAcceleratedPollingParams)(S(this,i,"f"),S(this,o,"f"));if(S(this,a,"f")>=t)return T(this,c,e=>S(this,s,"m",m).call(this,_.BlockTracker,e),"f"),S(this,r,"f").on("latest",S(this,c,"f")),void I("Added block tracker listener");S(this,s,"m",p).call(this),T(this,f,setTimeout(async()=>{await S(this,s,"m",m).call(this,_.Accelerated),S(this,s,"m",e).call(this)},n),"f")},m=async function(e,t){switch(e){case _.Websocket:I("AccountActivityService:transactionUpdated received");break;case _.Accelerated:I("Accelerated interval",S(this,a,"f")+1);break;case _.BlockTracker:I("Block tracker interval",t)}const n=t??await S(this,r,"f").getLatestBlock();await(S(this,u,"f")?.call(this,n)),e===_.Accelerated&&S(this,d,"f")&&T(this,a,S(this,a,"f")+1,"f")},p=function(){S(this,f,"f")&&(clearTimeout(S(this,f,"f")),T(this,f,undefined,"f"))},g=function(){S(this,c,"f")&&(S(this,r,"f").removeListener("latest",S(this,c,"f")),T(this,c,undefined,"f"))},y=function(){S(this,o,"f").subscribe("AccountActivityService:transactionUpdated",S(this,b,"f"))},w=function(){S(this,o,"f").unsubscribe("AccountActivityService:transactionUpdated",S(this,b,"f"))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/TransactionPoller.cjs"}],[3470,{"../logger.cjs":3474,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.CollectPublishHook=void 0;const l=e("@metamask/utils"),d=e("lodash"),f=e("../logger.cjs"),h=(0,l.createModuleLogger)(f.projectLogger,"collect-publish-hook");n.CollectPublishHook=class{constructor(e){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),c(this,i,(0,l.createDeferredPromise)(),"f"),c(this,a,[],"f"),c(this,r,e,"f")}getHook(){return u(this,s,"m",o).bind(this)}ready(){return u(this,i,"f").promise}success(e){if(h("Success",{transactionHashes:e}),e.length!==u(this,r,"f"))throw new Error("Transaction hash count mismatch");for(let t=0;t<u(this,a,"f").length;t++){const n=u(this,a,"f")[t],s=e[t];n.promise.resolve({transactionHash:s})}}error(e){h("Error",{error:e});for(const t of u(this,a,"f"))t.promise.reject(e)}},a=new WeakMap,r=new WeakMap,i=new WeakMap,s=new WeakSet,o=function(e,t){const n=e.txParams.nonce??"0x0",s=parseInt(n,16);h("Processing transaction",{nonce:s,signedTx:t,transactionMeta:e});const o=(0,l.createDeferredPromise)();if(u(this,a,"f").push({nonce:s,promise:o,signedTransaction:t}),c(this,a,(0,d.sortBy)(u(this,a,"f"),e=>e.nonce),"f"),u(this,a,"f").length===u(this,r,"f")){h("All transactions signed");const e=u(this,a,"f").map(e=>e.signedTransaction);u(this,i,"f").resolve({signedTransactions:e})}return o.promise}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/CollectPublishHook.cjs"}],[3471,{"../logger.cjs":3474,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ExtraTransactionsPublishHook=void 0;const l=e("@metamask/utils"),d=e("../logger.cjs"),f=(0,l.createModuleLogger)(d.projectLogger,"extra-transactions-publish-hook");n.ExtraTransactionsPublishHook=class{constructor({addTransactionBatch:e,getTransaction:t,originalPublishHook:n}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),c(this,a,e,"f"),c(this,r,t,"f"),c(this,i,n,"f")}getHook(){return u(this,s,"m",o).bind(this)}},a=new WeakMap,r=new WeakMap,i=new WeakMap,s=new WeakSet,o=async function(e,t){f("Publishing transaction as batch",{transactionMeta:e,signedTx:t});const{batchTransactions:n,batchTransactionsOptions:s,id:o,networkClientId:c,txParams:d}=e,h=d.from,m=d.to,p=d.data,g=d.value,b=d.gas,y=d.maxFeePerGas,w=d.maxPriorityFeePerGas,T=t,S=(0,l.createDeferredPromise)(),E={existingTransaction:{id:o,onPublish:({newSignature:e,transactionHash:t})=>{if(e){const t=u(this,r,"f").call(this,o);return f("Calling original publish hook with new signature",{latestTransactionMeta:t,newSignature:e}),void u(this,i,"f").call(this,t,e).then(S.resolve).catch(S.reject)}S.resolve({transactionHash:t})},signedTransaction:T},params:{data:p,gas:b,maxFeePerGas:y,maxPriorityFeePerGas:w,to:m,value:g}},k=(n??[]).map(e=>{const{isAfter:t,type:n,...s}=e;return{isAfter:t,params:s,type:n}}),P=[...k.filter(e=>!1===e.isAfter).map(({isAfter:e,...t})=>({...t})),E,...k.filter(e=>e.isAfter===undefined||e.isAfter).map(({isAfter:e,...t})=>({...t}))];f("Adding transaction batch",{from:h,networkClientId:c,transactions:P});const v=s??{disable7702:!0,disableHook:!1,disableSequential:!0};return await u(this,a,"f").call(this,{from:h,networkClientId:c,requireApproval:!1,transactions:P,...v}),S.promise}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/ExtraTransactionsPublishHook.cjs"}],[3472,{"../logger.cjs":3474,"@metamask/rpc-errors":3026,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialPublishBatchHook=void 0;const g=e("@metamask/rpc-errors"),b=e("@metamask/utils"),y=e("../logger.cjs"),w=(0,b.createModuleLogger)(y.projectLogger,"sequential-publish-batch-hook");n.SequentialPublishBatchHook=class{constructor({publishTransaction:e,getTransaction:t,getPendingTransactionTracker:n,getEthQuery:u}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,{}),m(this,a,e,"f"),m(this,r,t,"f"),m(this,i,u,"f"),m(this,o,n,"f")}getHook(){return p(this,s,"m",u).bind(this)}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,u=async function({from:e,networkClientId:t,transactions:n}){w("Starting sequential publish batch hook",{from:e,networkClientId:t});const c=p(this,o,"f").call(this,t),u=[];for(const e of n)try{const n=p(this,r,"f").call(this,String(e.id)),o=await p(this,a,"f").call(this,p(this,i,"f").call(this,t),n);w("Transaction published",{transactionHash:o});const d={...n,hash:o},f=p(this,s,"m",l).call(this,c,d.id,d.hash);c.addTransactionToPoll(d),await f,u.push({transactionHash:o})}catch(t){throw w("Batch transaction failed",{transaction:e,error:t}),c.stop(),g.rpcErrors.internal("Failed to publish batch transaction")}return w("Sequential publish batch hook completed",{results:u}),c.stop(),{results:u}},l=async function(e,t,n){return new Promise((a,r)=>{const i=p(this,s,"m",d).bind(this,t,n,a,e),o=p(this,s,"m",f).bind(this,t,n,r,e);p(this,c,"f")[t]={onConfirmed:i,onFailedOrDropped:o},e.hub.on("transaction-confirmed",i),e.hub.on("transaction-failed",o),e.hub.on("transaction-dropped",o)})},d=function(e,t,n,a,r){r.id===e&&(w("Transaction confirmed",{transactionHash:t}),p(this,s,"m",h).call(this,a,e),n(r))},f=function(e,t,n,a,r,i){r.id===e&&(w("Transaction failed or dropped",{transactionHash:t,error:i}),p(this,s,"m",h).call(this,a,e),n(new Error(`Transaction ${t} failed or dropped.`)))},h=function(e,t){const n=p(this,c,"f")[t];e.hub.off("transaction-confirmed",n.onConfirmed),e.hub.off("transaction-failed",n.onFailedOrDropped),e.hub.off("transaction-dropped",n.onFailedOrDropped),delete p(this,c,"f")[t]}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/SequentialPublishBatchHook.cjs"}],[3473,{"./TransactionController.cjs":3450,"./constants.cjs":3453,"./helpers/AccountsApiRemoteTransactionSource.cjs":3462,"./types.cjs":3475,"./utils/gas-flow.cjs":3485,"./utils/prepare.cjs":3489,"./utils/transaction-type.cjs":3493,"./utils/utils.cjs":3494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.HARDFORK=n.INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS=n.CHAIN_IDS=n.normalizeTransactionParams=n.isEIP1559Transaction=n.mergeGasFeeEstimates=n.determineTransactionType=n.WalletDevice=n.UserFeeLevel=n.TransactionType=n.TransactionStatus=n.TransactionEnvelopeType=n.TransactionContainerType=n.SimulationTokenStandard=n.SimulationErrorCode=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.TransactionController=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;var s=e("./TransactionController.cjs");Object.defineProperty(n,"CANCEL_RATE",{enumerable:!0,get:function(){return s.CANCEL_RATE}}),Object.defineProperty(n,"SPEED_UP_RATE",{enumerable:!0,get:function(){return s.SPEED_UP_RATE}}),Object.defineProperty(n,"TransactionController",{enumerable:!0,get:function(){return s.TransactionController}});var a=e("./types.cjs");Object.defineProperty(n,"GasFeeEstimateLevel",{enumerable:!0,get:function(){return a.GasFeeEstimateLevel}}),Object.defineProperty(n,"GasFeeEstimateType",{enumerable:!0,get:function(){return a.GasFeeEstimateType}}),Object.defineProperty(n,"SimulationErrorCode",{enumerable:!0,get:function(){return a.SimulationErrorCode}}),Object.defineProperty(n,"SimulationTokenStandard",{enumerable:!0,get:function(){return a.SimulationTokenStandard}}),Object.defineProperty(n,"TransactionContainerType",{enumerable:!0,get:function(){return a.TransactionContainerType}}),Object.defineProperty(n,"TransactionEnvelopeType",{enumerable:!0,get:function(){return a.TransactionEnvelopeType}}),Object.defineProperty(n,"TransactionStatus",{enumerable:!0,get:function(){return a.TransactionStatus}}),Object.defineProperty(n,"TransactionType",{enumerable:!0,get:function(){return a.TransactionType}}),Object.defineProperty(n,"UserFeeLevel",{enumerable:!0,get:function(){return a.UserFeeLevel}}),Object.defineProperty(n,"WalletDevice",{enumerable:!0,get:function(){return a.WalletDevice}});var r=e("./utils/transaction-type.cjs");Object.defineProperty(n,"determineTransactionType",{enumerable:!0,get:function(){return r.determineTransactionType}});var i=e("./utils/gas-flow.cjs");Object.defineProperty(n,"mergeGasFeeEstimates",{enumerable:!0,get:function(){return i.mergeGasFeeEstimates}});var o=e("./utils/utils.cjs");Object.defineProperty(n,"isEIP1559Transaction",{enumerable:!0,get:function(){return o.isEIP1559Transaction}}),Object.defineProperty(n,"normalizeTransactionParams",{enumerable:!0,get:function(){return o.normalizeTransactionParams}});var c=e("./constants.cjs");Object.defineProperty(n,"CHAIN_IDS",{enumerable:!0,get:function(){return c.CHAIN_IDS}});var u=e("./helpers/AccountsApiRemoteTransactionSource.cjs");Object.defineProperty(n,"INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS",{enumerable:!0,get:function(){return u.SUPPORTED_CHAIN_IDS}});var l=e("./utils/prepare.cjs");Object.defineProperty(n,"HARDFORK",{enumerable:!0,get:function(){return l.HARDFORK}})}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/index.cjs"}],[3474,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.incomingTransactionsLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}}),n.projectLogger=(0,s.createProjectLogger)("transaction-controller"),n.incomingTransactionsLogger=(0,s.createModuleLogger)(n.projectLogger,"incoming-transactions")}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/logger.cjs"}],[3475,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f;Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationErrorCode=n.SimulationTokenStandard=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.UserFeeLevel=n.TransactionEnvelopeType=n.TransactionContainerType=n.TransactionType=n.WalletDevice=n.TransactionStatus=void 0,function(e){e.unapproved="unapproved",e.approved="approved",e.signed="signed",e.submitted="submitted",e.confirmed="confirmed",e.failed="failed",e.dropped="dropped",e.rejected="rejected",e.cancelled="cancelled"}(s||(n.TransactionStatus=s={})),function(e){e.MM_MOBILE="metamask_mobile",e.MM_EXTENSION="metamask_extension",e.OTHER="other_device"}(a||(n.WalletDevice=a={})),function(e){e.batch="batch",e.bridge="bridge",e.bridgeApproval="bridgeApproval",e.cancel="cancel",e.contractInteraction="contractInteraction",e.deployContract="contractDeployment",e.ethDecrypt="eth_decrypt",e.ethGetEncryptionPublicKey="eth_getEncryptionPublicKey",e.gasPayment="gas_payment",e.incoming="incoming",e.lendingDeposit="lendingDeposit",e.lendingWithdraw="lendingWithdraw",e.musdClaim="musdClaim",e.musdConversion="musdConversion",e.perpsDeposit="perpsDeposit",e.perpsDepositAndOrder="perpsDepositAndOrder",e.personalSign="personal_sign",e.predictBuy="predictBuy",e.predictClaim="predictClaim",e.predictDeposit="predictDeposit",e.predictSell="predictSell",e.predictWithdraw="predictWithdraw",e.relayDeposit="relayDeposit",e.retry="retry",e.revokeDelegation="revokeDelegation",e.simpleSend="simpleSend",e.signTypedData="eth_signTypedData",e.smart="smart",e.stakingClaim="stakingClaim",e.stakingDeposit="stakingDeposit",e.stakingUnstake="stakingUnstake",e.swap="swap",e.swapAndSend="swapAndSend",e.swapApproval="swapApproval",e.tokenMethodApprove="approve",e.tokenMethodSafeTransferFrom="safetransferfrom",e.tokenMethodTransfer="transfer",e.tokenMethodTransferFrom="transferfrom",e.tokenMethodSetApprovalForAll="setapprovalforall",e.tokenMethodIncreaseAllowance="increaseAllowance",e.shieldSubscriptionApprove="shieldSubscriptionApprove"}(r||(n.TransactionType=r={})),function(e){e.EnforcedSimulations="enforcedSimulations"}(i||(n.TransactionContainerType=i={})),function(e){e.legacy="0x0",e.accessList="0x1",e.feeMarket="0x2",e.setCode="0x4"}(o||(n.TransactionEnvelopeType=o={})),function(e){e.CUSTOM="custom",e.DAPP_SUGGESTED="dappSuggested",e.MEDIUM="medium"}(c||(n.UserFeeLevel=c={})),function(e){e.Low="low",e.Medium="medium",e.High="high"}(u||(n.GasFeeEstimateLevel=u={})),function(e){e.FeeMarket="fee-market",e.Legacy="legacy",e.GasPrice="eth_gasPrice"}(l||(n.GasFeeEstimateType=l={})),function(e){e.erc20="erc20",e.erc721="erc721",e.erc1155="erc1155"}(d||(n.SimulationTokenStandard=d={})),function(e){e.ChainNotSupported="chain-not-supported",e.Disabled="disabled",e.InvalidResponse="invalid-response",e.Reverted="reverted"}(f||(n.SimulationErrorCode=f={}))}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/types.cjs"}],[3476,{"../api/simulation-api.cjs":3452,"../constants.cjs":3453,"../errors.cjs":3454,"../logger.cjs":3474,"../types.cjs":3475,"./balance.cjs":3477,"@ethersproject/abi":763,"@metamask/controller-utils":1639,"@metamask/metamask-eth-abis":2597,"@metamask/utils":3554,"bn.js":4413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getBalanceChanges=n.SupportedToken=void 0;const a=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=s(e("bn.js")),u=e("./balance.cjs"),l=e("../api/simulation-api.cjs"),d=e("../constants.cjs"),f=e("../errors.cjs"),h=e("../logger.cjs"),m=e("../types.cjs");var p;!function(e){e.ERC20="erc20",e.ERC721="erc721",e.ERC1155="erc1155",e.ERC20_WRAPPED="erc20Wrapped",e.ERC721_LEGACY="erc721Legacy"}(p||(n.SupportedToken=p={}));const g=(0,o.createModuleLogger)(h.projectLogger,"balance-changes"),b=["Transfer","TransferSingle","TransferBatch","Deposit","Withdrawal"],y={[p.ERC20]:{abi:i.abiERC20,standard:m.SimulationTokenStandard.erc20},[p.ERC721]:{abi:i.abiERC721,standard:m.SimulationTokenStandard.erc721},[p.ERC1155]:{abi:i.abiERC1155,standard:m.SimulationTokenStandard.erc1155},[p.ERC20_WRAPPED]:{abi:d.ABI_SIMULATION_ERC20_WRAPPED,standard:m.SimulationTokenStandard.erc20},[p.ERC721_LEGACY]:{abi:d.ABI_SIMULATION_ERC721_LEGACY,standard:m.SimulationTokenStandard.erc721}},w=["execution reverted","insufficient funds for gas"];function T(e){if(Array.isArray(e))return e.map(T);let t=e;return t=t.toHexString?.()??t,t=t.toLowerCase?.()??t,t}function S(e){return"Transfer"===e.name&&e.tokenStandard===m.SimulationTokenStandard.erc721&&0===parseInt(e.args.from,16)}function E(e){return e.tokenStandard===m.SimulationTokenStandard.erc721?[e.args.tokenId]:e.tokenStandard===m.SimulationTokenStandard.erc1155&&"TransferSingle"===e.name?[e.args.id]:e.tokenStandard===m.SimulationTokenStandard.erc1155&&"TransferBatch"===e.name?e.args.ids:[undefined]}function k(e){switch(e){case m.SimulationTokenStandard.erc721:return new a.Interface(i.abiERC721);case m.SimulationTokenStandard.erc1155:return new a.Interface(i.abiERC1155);default:return new a.Interface(i.abiERC20)}}function P(e,t,n){const s=k(t.standard);try{if(t.standard===m.SimulationTokenStandard.erc721){const t=s.decodeFunctionResult("ownerOf",n.return);return t[0].toLowerCase()===e.toLowerCase()?"0x1":"0x0"}const a=s.decodeFunctionResult("balanceOf",n.return);return(0,r.toHex)(a[0])}catch(e){throw g("Failed to decode balance transaction",e,{token:t,response:n}),new f.SimulationError(`Failed to decode balance transaction for token ${t.address}: ${String(e)}`)}}function v(e,t,n){const s=k(e);switch(e){case m.SimulationTokenStandard.erc721:return s.encodeFunctionData("ownerOf",[n]);case m.SimulationTokenStandard.erc1155:return s.encodeFunctionData("balanceOf",[t,n]);default:return s.encodeFunctionData("balanceOf",[t])}}function I(e){return[...e.logs??[],...(e.calls??[]).map(e=>I(e)).flat()]}function _(e){if(!e)return[];return[...e.error?[e.error]:[],...(e.calls??[]).flatMap(e=>_(e))]}function A(e,t,n=0){const s=(0,r.hexToBN)(t).add(new c.default(n)),a=(0,r.hexToBN)(e),i=s.sub(a),o=i.isNeg(),u=(0,r.toHex)(i.abs());return i.isZero()?(g("Balance change is zero"),undefined):{previousBalance:e,newBalance:(0,r.toHex)(s),difference:u,isDecrease:o}}async function C({request:e,params:t,before:n=[],after:s=[]}){const{blockTime:a,chainId:i,ethQuery:o,getSimulationConfig:d,txParams:f}=e,{authorizationList:h}=f,m=f.from,p=h?.map(e=>({address:e.address,from:m})),b=[...n,{authorizationList:p,data:f.data,from:f.from,gas:f.gas,maxFeePerGas:f.maxFeePerGas??f.gasPrice,maxPriorityFeePerGas:f.maxPriorityFeePerGas??f.gasPrice,to:f.to,value:f.value},...s],y=function(e){const{txParams:t}=e,n=(0,r.hexToBN)(t.gas??"0x0"),s=(0,r.hexToBN)(t.maxFeePerGas??t.gasPrice??"0x0"),a=(0,r.hexToBN)(t.value??"0x0"),i=(e.nestedTransactions??[]).map(e=>(0,r.hexToBN)(e.value??"0x0")).reduce((e,t)=>e.add(t),new c.default(0));return n.mul(s).add(a).add(i)}(e),w=(0,r.toHex)(y);g("Required balance",w);const{balanceRaw:T}=await(0,u.getNativeBalance)(m,o),S=(0,r.toHex)(T),E=(0,r.hexToBN)(S);g("Current balance",S);const k=E.lt(y);return await(0,l.simulateTransactions)(i,{...t,getSimulationConfig:d,transactions:b,withGas:!0,withDefaultBlockOverrides:!0,...a&&{blockOverrides:{...t?.blockOverrides,time:(0,r.toHex)(a)}},...k&&{overrides:{...t?.overrides,[m]:{...t?.overrides?.[m],balance:w}}}})}n.getBalanceChanges=async function(e){let t;g("Request",e);try{const n=await C({request:e,params:{withCallTrace:!0,withLogs:!0}}),s=n.transactions?.[0];t=_(s?.callTrace);const r=s?.error;if(r)throw new f.SimulationError(r);const i=function(e,t){const n=t.transactions[0];if(!n)return undefined;const{txParams:s}=e,a=s.from,{stateDiff:r}=n,i=r?.pre?.[a]?.balance,o=r?.post?.[a]?.balance;if(!i||!o)return undefined;return A(i,o,n.gasCost)}(e,n),o=function(e){const t=I(e.transactions[0]?.callTrace??{});g("Extracted logs",t);const n=function(){const e=Object.values(p);return new Map(e.map(e=>{const{abi:t}=y[e];return[e,new a.Interface(t)]}))}();return t.map(e=>{const t=function(e,t){const n=Object.values(p);for(const s of n)try{const n=t.get(s),{abi:a,standard:r}=y[s];return{...n.parseLog(e),abi:a,standard:r}}catch{continue}return undefined}(e,n);if(!t)return g("Failed to parse log",e),undefined;const s=t.abi.find(e=>e.name===t.name)?.inputs;if(!s)return g("Failed to find inputs for event",t),undefined;if(!b.includes(t.name))return g("Ignoring unsupported event",t.name,t),undefined;g("Normalizing event args",t.name,t);const a=function(e,t){return e.reduce((e,n,s)=>{const a=t[s].name.replace("_",""),r=T(n);return e[a]=r,e},{})}(t.args,s);return{contractAddress:e.address,tokenStandard:t.standard,name:t.name,args:a,abi:t.abi}}).filter(e=>e!==undefined)}(n);g("Parsed events",o);const c=await async function(e,t){const{txParams:n}=e,s=n.from,a=function(e,t){const n=new Set,s=new Map,a=new Map,r=e.txParams.from,i=t.filter(e=>[e.args.from,e.args.to].includes(r));g("Filtered user events",i);for(const e of i){const t=E(e);g("Extracted token IDs",t);for(const i of t){const t={address:e.contractAddress,standard:e.tokenStandard,id:i},o=JSON.stringify(t);if(n.has(o)){g("Ignoring additional event with same contract and token ID",t);continue}n.add(o);const c=v(e.tokenStandard,r,i),u={from:r,to:e.contractAddress,data:c};S(e)||s.set(t,u),a.set(t,u)}}return{before:s,after:a}}(e,t);g("Generated balance transactions",[...a.after.values()]);const r=a.before.size+a.after.size+1;if(1===r)return[];const i=await C({request:e,before:[...a.before.values()],after:[...a.after.values()]});if(g("Balance simulation response",i),i.transactions.length!==r)throw new f.SimulationInvalidResponseError;let o=0;return[...a.after.keys()].map((e,t)=>{const n=A(!a.before.get(e)?"0x0":P(s,e,i.transactions[o++]),P(s,e,i.transactions[t+a.before.size+1]));return n?{...e,...n}:undefined}).filter(e=>e!==undefined)}(e,o),u=s?.gasUsed;return{simulationData:{callTraceErrors:t,nativeBalanceChange:i,tokenBalanceChanges:c},gasUsed:u}}catch(n){g("Failed to get balance changes",n,e);let s=n;w.some(e=>s.message?.includes(e))&&(s=new f.SimulationRevertedError);const{code:a,message:r}=s;return{simulationData:{callTraceErrors:t,tokenBalanceChanges:[],error:{code:a,message:r}},gasUsed:undefined}}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/balance-changes.cjs"}],[3477,{"@metamask/controller-utils":1639,"bignumber.js":3500},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isNativeBalanceSufficientForGas=n.getNativeBalance=void 0;const s=e("@metamask/controller-utils"),a=e("bignumber.js");async function r(e,t){const n=await(0,s.query)(t,"getBalance",[e,"latest"]),r=new a.BigNumber(n).toString(10);return{balanceHuman:new a.BigNumber(r).shiftedBy(-18).toString(10),balanceRaw:r}}n.getNativeBalance=r,n.isNativeBalanceSufficientForGas=async function(e,t){const n=e.txParams.from,s=new a.BigNumber(e.txParams.gas??"0x0").multipliedBy(e.txParams.maxFeePerGas??e.txParams.gasPrice??"0x0"),{balanceRaw:i}=await r(n,t);return s.isLessThanOrEqualTo(i)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/balance.cjs"}],[3478,{"../gas-flows/DefaultGasFeeFlow.cjs":3455,"../helpers/GasFeePoller.cjs":3463,"../hooks/CollectPublishHook.cjs":3470,"../hooks/SequentialPublishBatchHook.cjs":3472,"../index.cjs":3473,"../logger.cjs":3474,"../types.cjs":3475,"./eip7702.cjs":3479,"./feature-flags.cjs":3481,"./gas.cjs":3486,"./validation.cjs":3495,"@metamask/controller-utils":1639,"@metamask/rpc-errors":3026,"@metamask/utils":3554,uuid:6134},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAtomicBatchSupported=n.addTransactionBatch=n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/rpc-errors"),r=e("@metamask/utils"),i=e("uuid"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),u=e("./gas.cjs"),l=e("./validation.cjs"),d=e("../index.cjs"),f=e("../gas-flows/DefaultGasFeeFlow.cjs"),h=e("../helpers/GasFeePoller.cjs"),m=e("../hooks/CollectPublishHook.cjs"),p=e("../hooks/SequentialPublishBatchHook.cjs"),g=e("../logger.cjs"),b=e("../types.cjs"),y=(0,r.createModuleLogger)(g.projectLogger,"batch");function w(){const e=(0,i.v4)(),t=new Uint8Array((0,i.parse)(e));return(0,r.bytesToHex)(t)}async function T(e,t,n,a,r,i){const{assetsFiatValues:o,existingTransaction:c,params:u,type:l}=t,{addTransaction:f,getTransaction:m,request:p,updateTransaction:g}=a,{from:b,networkClientId:w,origin:T}=p;if(c){const{id:t,onPublish:r}=c;let o=m(t);const l=o.txParams.nonce;let{signedTransaction:d}=c;const f=l?parseInt(l,16):undefined,h=i>0&&f!==undefined?f+i:undefined;if(g({transactionId:t},t=>{t.batchId=e,h&&(t.txParams.nonce=(0,s.toHex)(h))}),h){const e=await S({transactionId:t,request:a});d=e.newSignature,o=e.transactionMeta}return n(o,d).then(r).catch(()=>{}),y("Processed existing transaction with hook",{id:t,params:u}),{id:t,params:u}}const E={...r,txParams:{...u,from:b,gas:r?.gas??u.gas}};r&&(0,h.updateTransactionGasEstimates)({txMeta:E,userFeeLevel:d.GasFeeEstimateLevel.Medium});const{transactionMeta:k}=await f(E.txParams,{assetsFiatValues:o,batchId:e,disableGasBuffer:!0,networkClientId:w,origin:T,publishHook:n,requireApproval:!1,type:l}),{id:P,txParams:v}=k,I={data:v.data,gas:v.gas,maxFeePerGas:v.maxFeePerGas,maxPriorityFeePerGas:v.maxPriorityFeePerGas,to:v.to,value:v.value};return y("Processed new transaction with hook",{id:P,params:I,type:l}),{id:P,params:I,type:l}}async function S({request:e,transactionId:t}){const{getTransaction:n,signTransaction:s}=e,a=n(t);y("Re-signing existing transaction",{transactionId:t,txParams:a.txParams});const r=await s(a);if(!r)throw new Error("Failed to re-sign transaction");const i=n(t);return y("New signature",r),{newSignature:r,transactionMeta:i}}n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT="Upgrade contract address not found",n.addTransactionBatch=async function(e){const{getInternalAccounts:t,messenger:r,request:i}=e,h=(0,c.getBatchSizeLimit)(r);if((0,l.validateBatchRequest)({internalAccounts:t(),request:i,sizeLimit:h}),y("Adding",i),!i.disable7702)try{return await async function(e){const{addTransaction:t,getChainId:s,messenger:r,publicKeyEIP7702:i,request:u}=e,{batchId:l,disableUpgrade:f,from:h,gasFeeToken:m,gasLimit7702:p,networkClientId:g,origin:T,overwriteUpgrade:E,requestId:k,requiredAssets:P,requireApproval:v,securityAlertId:I,skipInitialGasEstimate:_,transactions:A,validateSecurity:C}=u,j=s(g),x=e.getEthQuery(g),R=(0,o.doesChainSupportEIP7702)(j,r);if(!R)throw y("Chain does not support EIP-7702",j),a.rpcErrors.internal("Chain does not support EIP-7702");if(!i)throw a.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);let O=!1;if(!f){const{delegationAddress:e,isSupported:t}=await(0,o.isAccountUpgradedToEIP7702)(h,j,i,r,x);if(y("Account",{delegationAddress:e,isSupported:t}),!t&&e&&!E)throw y("Account upgraded to unsupported contract",h,e),a.rpcErrors.internal("Account upgraded to unsupported contract");O=!t,O&&e&&y("Overwriting authorization as already upgraded",{current:e})}const F=await Promise.all(A.map(e=>async function(e,t,n){const{from:s}=e,{params:a,type:r}=t;if(r)return{...a,type:r};const{type:i}=await(0,d.determineTransactionType)({from:s,...a},n);return{...a,type:i}}(u,e,x))),N={...(0,o.generateEIP7702BatchTransaction)(h,F),from:h,gas:p,maxFeePerGas:F[0]?.maxFeePerGas,maxPriorityFeePerGas:F[0]?.maxPriorityFeePerGas};if(O){const e=(0,c.getEIP7702UpgradeContractAddress)(j,r,i);if(!e)throw a.rpcErrors.internal(n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);N.type=b.TransactionEnvelopeType.setCode,N.authorizationList=[{address:e}]}if(C){const e={method:"eth_sendTransaction",params:[{...N,authorizationList:undefined,type:b.TransactionEnvelopeType.feeMarket}],delegationMock:N.authorizationList?.[0]?.address,origin:T};y("Security request",e),C(e,j).catch(e=>{y("Security validation failed",e)})}y("Adding batch transaction",N,g);const M=l??w(),L=I?{securityAlertId:I}:undefined,G=A.find(e=>e.existingTransaction)?.existingTransaction;if(G)return await async function({batchId:e,existingTransaction:t,nestedTransactions:n,request:s,txParams:a}){const{getTransaction:r,estimateGas:i,updateTransaction:o}=s,c=r(t.id);if(!c)throw new Error("Existing transaction not found");y("Converting existing transaction to 7702",{batchId:e,txParams:a});const{networkClientId:u}=c,l=await i(a,u);y("Estimated gas for converted EIP-7702 transaction",l),o({transactionId:c.id},t=>{var s;t.batchId=e,t.nestedTransactions=n,t.txParams=a,t.txParams.gas=l.gas,t.txParams.gasLimit=l.gas,t.txParams.maxFeePerGas=c.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=c.txParams.maxPriorityFeePerGas,t.txParams.nonce=c.txParams.nonce,(s=t.txParams).type??(s.type=b.TransactionEnvelopeType.feeMarket)});const{newSignature:d}=await S({request:s,transactionId:c.id});t.onPublish?.({transactionHash:undefined,newSignature:d}),y("Transaction updated to EIP-7702",{batchId:e,txParams:a,newSignature:d})}({batchId:M,existingTransaction:G,nestedTransactions:F,request:e,txParams:N}),{batchId:M};const{result:D}=await t(N,{batchId:M,gasFeeToken:m,isGasFeeIncluded:u.isGasFeeIncluded,isGasFeeSponsored:u.isGasFeeSponsored,nestedTransactions:F,networkClientId:g,origin:T,requestId:k,requireApproval:v,requiredAssets:P,securityAlertResponse:L,skipInitialGasEstimate:_,type:b.TransactionType.batch}),B=await D;return y("Batch transaction added",{batchId:M,transactionHash:B}),{batchId:M}}(e)}catch(e){if(!(e instanceof a.JsonRpcError&&"Chain does not support EIP-7702"===e.message))throw e}return await async function(e){const{messenger:t,publishBatchHook:n,request:r,update:i}=e,{batchId:o,from:c,networkClientId:l,origin:h,requireApproval:g,transactions:b}=r;let S,E=!1;y("Adding transaction batch using hook",r);const k=new p.SequentialPublishBatchHook({publishTransaction:e.publishTransaction,getTransaction:e.getTransaction,getEthQuery:e.getEthQuery,getPendingTransactionTracker:e.getPendingTransactionTracker});let{disable7702:P,disableSequential:v}=r;const{disableHook:I,useHook:_}=r;_&&(P=!0,v=!0);let A,C=null;!I&&n?C=n:v||(C=k.getHook(),E=!0);if(!C)throw y("No supported batch methods found",{disable7702:P,disableHook:I,disableSequential:v}),a.rpcErrors.internal("Can't process batch");const j=o??w(),x=b.map(e=>({...e,origin:h})),R=x.length,O=new m.CollectPublishHook(R);try{g&&(A=await async function({batchId:e,request:t}){const{messenger:n,request:s,isSimulationEnabled:a,getChainId:r,getEthQuery:i,getGasFeeEstimates:o,getSimulationConfig:c,update:l}=t,{from:h,origin:m,networkClientId:p,transactions:g}=s,b=i(p);if(!a())throw new Error("Cannot create transaction batch as simulation not supported");y("Preparing approval data for batch");const w=r(p),{totalGasLimit:T}=await(0,u.simulateGasBatch)({chainId:w,from:h,getSimulationConfig:c,transactions:g}),S=(v={chainId:w,from:h,gas:T,id:e,networkClientId:p,origin:m,transactions:g},{...v,status:d.TransactionStatus.unapproved}),E=new f.DefaultGasFeeFlow,k=await o({networkClientId:p}),P=await E.getGasFees({ethQuery:b,gasFeeControllerData:k,messenger:n,transactionMeta:{...S,txParams:{from:h,gas:T},time:Date.now()}});var v;return S.gasFeeEstimates=P.estimates,y("Saving transaction batch metadata",S),function(e,t){t(t=>{t.transactionBatches=[...t.transactionBatches,e]})}(S,l),S}({batchId:j,request:e}),S=(await async function(e,t){const n=String(e.id),{origin:a}=e,r=s.ApprovalType.TransactionBatch,i={txBatchId:n};return y("Requesting approval for transaction batch",n),await t.call("ApprovalController:addRequest",{id:n,origin:a??s.ORIGIN_METAMASK,requestData:i,expectsResult:!0,type:r},!0)}(A,t)).resultCallbacks);const n=O.getHook(),a=[];let r=0;for(const t of x){const s=await T(j,t,n,e,A,r);a.push(s),r+=1}const{signedTransactions:i}=await O.ready(),o={from:c,networkClientId:l,transactions:a.map((e,t)=>({...e,signedTx:i[t]}))};y("Calling publish batch hook",o);let h=await C(o);if(y("Publish batch hook result",h),!h&&!E&&!v){y("Fallback to sequential publish batch hook due to empty results");const e=k.getHook();h=await e(o)}if(!h?.results?.length)throw new Error("Publish batch hook did not return a result");const m=h.results.map(({transactionHash:e})=>e);return O.success(m),S?.success(),y("Completed batch transaction with hook",m),{batchId:j}}catch(e){throw y("Publish batch hook failed",e),O.error(e),S?.error(e),e}finally{y("Cleaning up publish batch hook",j),function(e,t){e(e=>{e.transactionBatches=e.transactionBatches.filter(e=>e.id!==t)})}(i,j)}}(e)},n.isAtomicBatchSupported=async function(e){const{address:t,chainIds:n,getEthQuery:s,messenger:r,publicKeyEIP7702:i}=e;if(!i)throw a.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const u=(0,c.getEIP7702SupportedChains)(r).filter(e=>!n||n.includes(e)),l=(await Promise.all(u.map(async e=>{try{const n=s(e),{isSupported:a,delegationAddress:u}=await(0,o.isAccountUpgradedToEIP7702)(t,e,i,r,n);return{chainId:e,delegationAddress:u,isSupported:a,upgradeContractAddress:(0,c.getEIP7702UpgradeContractAddress)(e,r,i)}}catch(t){return y("Error checking atomic batch support",e,t),undefined}}))).filter(e=>Boolean(e));return y("Atomic batch supported results",l),l}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/batch.cjs"}],[3479,{"../constants.cjs":3453,"../logger.cjs":3474,"./feature-flags.cjs":3481,"@ethersproject/abi":763,"@ethersproject/contracts":786,"@metamask/controller-utils":1639,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.signAuthorizationList=n.generateEIP7702BatchTransaction=n.isAccountUpgradedToEIP7702=n.getDelegationAddress=n.doesChainSupportEIP7702=n.ERROR_MESSGE_PUBLIC_KEY=n.CALLS_SIGNATURE=n.BATCH_FUNCTION_NAME=n.DELEGATION_PREFIX=void 0;const s=e("@ethersproject/abi"),a=e("@ethersproject/contracts"),r=e("@metamask/controller-utils"),i=e("@metamask/utils"),o=e("./feature-flags.cjs"),c=e("../constants.cjs"),u=e("../logger.cjs");n.DELEGATION_PREFIX="0xef0100",n.BATCH_FUNCTION_NAME="execute",n.CALLS_SIGNATURE="(address,uint256,bytes)[]",n.ERROR_MESSGE_PUBLIC_KEY="EIP-7702 public key not specified";const l=(0,i.createModuleLogger)(u.projectLogger,"eip-7702");async function d(e,t){const s=await(0,r.query)(t,"eth_getCode",[e]),a=(0,i.add0x)(s?.toLowerCase?.()??"");return 48===s?.length&&a.startsWith(n.DELEGATION_PREFIX)?(0,i.add0x)(a.slice(n.DELEGATION_PREFIX.length)):undefined}async function f(e,t,n,s){const a=function(e,t,n){const{chainId:s,nonce:a}=e,{txParams:i,chainId:o}=t,{nonce:c}=i,u=s??o;let d=a;d??(d=(0,r.toHex)(parseInt(c,16)+1+n));const f={...e,chainId:u,nonce:d};return l("Prepared authorization",f),f}(e,t,s),{txParams:o}=t,{from:c}=o,{address:u,chainId:d,nonce:f}=a,h=parseInt(d,16),m=parseInt(f,16),p=await n.call("KeyringController:signEip7702Authorization",{chainId:h,contractAddress:u,from:c,nonce:m}),g=p.slice(0,66),b=(0,i.add0x)(p.slice(66,130)),y=parseInt(p.slice(130,132),16),w={address:u,chainId:d,nonce:f,r:g,s:b,yParity:(0,r.toHex)(y-27==0?0:1)};return l("Signed authorization",w),w}n.doesChainSupportEIP7702=function(e,t){return(0,o.getEIP7702SupportedChains)(t).some(t=>t.toLowerCase()===e.toLowerCase())},n.getDelegationAddress=d,n.isAccountUpgradedToEIP7702=async function(e,t,n,s,a){const r=(0,o.getEIP7702ContractAddresses)(t,s,n),i=await d(e,a),c=Boolean(i&&r.some(e=>e.toLowerCase()===i.toLowerCase()));return{delegationAddress:i,isSupported:c}},n.generateEIP7702BatchTransaction=function(e,t){const r=a.Contract.getInterface(c.ABI_IERC7821),i=t.map(e=>{const{data:t,to:n,value:s}=e;return[n??"0x0000000000000000000000000000000000000000",s??"0x0",t??"0x"]}),o="0x01".padEnd(66,"0"),u=s.defaultAbiCoder.encode([n.CALLS_SIGNATURE],[i]),d=r.encodeFunctionData(n.BATCH_FUNCTION_NAME,[o,u]);return l("Transaction data",d),{data:d,to:e}},n.signAuthorizationList=async function({authorizationList:e,messenger:t,transactionMeta:n}){if(!e)return undefined;const s=[];let a=0;for(const r of e){const e=await f(r,n,t,a);s.push(e),a+=1}return s}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/eip7702.cjs"}],[3480,{"../types.cjs":3475,"@metamask/rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateConfirmedExternalTransaction=void 0;const s=e("@metamask/rpc-errors"),a=e("../types.cjs");n.validateConfirmedExternalTransaction=function(e,t,n){if(!e?.txParams)throw s.rpcErrors.invalidParams('"transactionMeta" or "transactionMeta.txParams" is missing');if(e.status!==a.TransactionStatus.confirmed)throw s.rpcErrors.invalidParams('External transaction status should be "confirmed"');const r=e.txParams.nonce;if(n&&n.length>0){if(n.find(e=>e.txParams?.nonce===r))throw s.rpcErrors.invalidParams("External transaction nonce should not be in pending txs")}if(t&&t.length>0){if(t.find(e=>e.txParams?.nonce===r))throw s.rpcErrors.invalidParams("External transaction nonce should not be in confirmed txs")}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/external-transactions.cjs"}],[3481,{"../logger.cjs":3474,"./signature.cjs":3491,"./utils.cjs":3494,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isIncomingTransactionsUseWebsocketsEnabled=n.getTimeoutAttempts=n.getIncomingTransactionsPollingInterval=n.getGasEstimateBuffer=n.getGasEstimateFallback=n.getGasFeeRandomisation=n.getAcceleratedPollingParams=n.getTransactionHistoryLimit=n.getSubmitHistoryLimit=n.getBatchSizeLimit=n.getEIP7702UpgradeContractAddress=n.getEIP7702ContractAddresses=n.getEIP7702SupportedChains=n.FeatureFlag=void 0;const s=e("@metamask/utils"),a=e("./signature.cjs"),r=e("./utils.cjs"),i=e("../logger.cjs");var o;!function(e){e.EIP7702="confirmations_eip_7702",e.GasBuffer="confirmations_gas_buffer",e.IncomingTransactions="confirmations_incoming_transactions",e.Transactions="confirmations_transactions"}(o||(n.FeatureFlag=o={}));const c=(0,s.createModuleLogger)(i.projectLogger,"feature-flags");function u(e,t,n){const s=l(t);return(s?.[o.EIP7702]?.contracts?.[e.toLowerCase()]??[]).filter(t=>(0,a.isValidSignature)([t.address,(0,r.padHexToEvenLength)(e)],t.signature,n)).map(e=>e.address)}function l(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags;return c("Retrieved feature flags",t),t}n.getEIP7702SupportedChains=function(e){const t=l(e);return t?.[o.EIP7702]?.supportedChains??[]},n.getEIP7702ContractAddresses=u,n.getEIP7702UpgradeContractAddress=function(e,t,n){return u(e,t,n)?.[0]},n.getBatchSizeLimit=function(e){const t=l(e);return t?.[o.Transactions]?.batchSizeLimit??10},n.getSubmitHistoryLimit=function(e){const t=l(e);return t?.[o.Transactions]?.submitHistoryLimit??100},n.getTransactionHistoryLimit=function(e){const t=l(e);return t?.[o.Transactions]?.transactionHistoryLimit??40},n.getAcceleratedPollingParams=function(e,t){const n=l(t),s=n?.[o.Transactions]?.acceleratedPolling,a=s?.perChainConfig?.[e]?.countMax??s?.defaultCountMax??10,r=s?.perChainConfig?.[e]?.intervalMs??s?.defaultIntervalMs??3e3;return{blockTime:s?.perChainConfig?.[e]?.blockTime??12e3,countMax:a,intervalMs:r}},n.getGasFeeRandomisation=function(e){const t=l(e),n=t?.[o.Transactions]?.gasFeeRandomisation??{};return{randomisedGasFeeDigits:n.randomisedGasFeeDigits??{},preservedNumberOfDigits:n.preservedNumberOfDigits}},n.getGasEstimateFallback=function(e,t){const n=l(t),s=n?.[o.Transactions]?.gasEstimateFallback,a=s?.perChainConfig?.[e],r=a?.percentage??s?.default?.percentage??35;return{fixed:a?.fixed??s?.default?.fixed,percentage:r}},n.getGasEstimateBuffer=function({chainId:e,isCustomRPC:t,isUpgradeWithDataToSelf:n,messenger:s}){const a=l(s),r=a?.[o.GasBuffer],i=r?.perChainConfig?.[e],c=t?undefined:i?.included,u=t?undefined:r?.included;return(n?i?.eip7702:undefined)??c??i?.base??u??r?.default??1},n.getIncomingTransactionsPollingInterval=function(e){const t=l(e);return t?.[o.IncomingTransactions]?.pollingIntervalMs??24e4},n.getTimeoutAttempts=function(e,t){const n=l(t),s=n?.[o.Transactions]?.timeoutAttempts;return s?.perChainConfig?.[e]??s?.default},n.isIncomingTransactionsUseWebsocketsEnabled=function(e){const t=l(e);return t?.[o.IncomingTransactions]?.useWebsockets??!1}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/feature-flags.cjs"}],[3482,{"../api/accounts-api.cjs":3451,"../logger.cjs":3474,"../types.cjs":3475,"./transaction-type.cjs":3493,"./validation.cjs":3495,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateFirstTimeInteraction=void 0;const s=e("@metamask/utils"),a=e("./transaction-type.cjs"),r=e("./validation.cjs"),i=e("../api/accounts-api.cjs"),o=e("../logger.cjs"),c=e("../types.cjs");n.updateFirstTimeInteraction=async function({existingTransactions:e,getTransaction:t,isFirstTimeInteractionEnabled:n,trace:u,traceContext:l,transactionMeta:d,updateTransaction:f}){if(!n())return;const{chainId:h,id:m,txParams:{data:p,from:g,to:b},type:y}=d;let w;if(p&&[c.TransactionType.tokenMethodTransfer,c.TransactionType.tokenMethodTransferFrom].includes(y)){const e=(0,a.decodeTransactionData)(p);w=e?.args?._to??e?.args?.to}w??(w=b);const T={chainId:(0,s.hexToNumber)(h),to:w,from:g};if((0,r.validateParamTo)(w),!e.find(e=>e.chainId===h&&e.txParams.from.toLowerCase()===g.toLowerCase()&&e.txParams.to?.toLowerCase()===b?.toLowerCase()&&e.id!==m))try{const{count:e}=await u({name:"Account Address Relationship",parentContext:l},()=>(0,i.getAccountAddressRelationship)(T)),n=e===undefined?undefined:0===e;if(!t(m))return void(0,o.projectLogger)("Cannot update first time interaction as transaction not found",m);f({transactionId:m,note:"TransactionController#updateFirstInteraction - Update first time interaction"},e=>{e.isFirstTimeInteraction=n}),(0,o.projectLogger)("Updated first time interaction",m,{isFirstTimeInteraction:n})}catch(e){(0,o.projectLogger)("Error fetching account address relationship, skipping first time interaction update",e)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/first-time-interaction.cjs"}],[3483,{"../api/simulation-api.cjs":3452,"../logger.cjs":3474,"./balance.cjs":3477,"./batch.cjs":3478,"./eip7702.cjs":3479,"./feature-flags.cjs":3481,"@metamask/rpc-errors":3026,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.checkGasFeeTokenBeforePublish=n.getGasFeeTokens=void 0;const s=e("@metamask/rpc-errors"),a=e("@metamask/utils"),r=e("./balance.cjs"),i=e("./batch.cjs"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),u=e("../api/simulation-api.cjs"),l=e("../logger.cjs"),d=(0,a.createModuleLogger)(l.projectLogger,"gas-fee-tokens");n.getGasFeeTokens=async function({chainId:e,isEIP7702GasFeeTokensEnabled:t,messenger:n,publicKeyEIP7702:a,transactionMeta:r,getSimulationConfig:l}){const{delegationAddress:f,txParams:h}=r,{authorizationList:m}=h,p=h.data,g=h.from,b=h.to,y=h.value;d("Request",{chainId:e,txParams:h});const w=await t(r)&&(0,o.doesChainSupportEIP7702)(e,n);let T=m?.map(e=>({address:e.address,from:g}));!w||f||T||(T=function({chainId:e,from:t,messenger:n,publicKeyEIP7702:a}){if(!a)throw s.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const r=(0,c.getEIP7702UpgradeContractAddress)(e,n,a);if(!r)throw s.rpcErrors.internal(i.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);return[{address:r,from:t}]}({chainId:e,from:g,messenger:n,publicKeyEIP7702:a}));try{const t=await(0,u.simulateTransactions)(e,{getSimulationConfig:l,transactions:[{authorizationList:T,data:p,from:g,to:b,value:y}],suggestFees:{withTransfer:!0,withFeeTransfer:!0,with7702:w}});d("Response",t);const n=function(e){const t=e.transactions?.[0]?.fees?.[0],n=e.sponsorship?.isSponsored??!1;return{gasFeeTokens:(t?.tokenFees??[]).map(e=>({amount:e.balanceNeededToken,balance:e.currentBalanceToken,decimals:e.token.decimals,fee:e.serviceFee,gas:t.gas,gasTransfer:e.transferEstimate,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,rateWei:e.rateWei,recipient:e.feeRecipient,symbol:e.token.symbol,tokenAddress:e.token.address})),isGasFeeSponsored:n}}(t);return d("Gas fee tokens",n),n}catch(e){return d("Failed to gas fee tokens",e),{gasFeeTokens:[],isGasFeeSponsored:!1}}},n.checkGasFeeTokenBeforePublish=async function({ethQuery:e,fetchGasFeeTokens:t,transaction:n,updateTransaction:s}){const{isGasFeeTokenIgnoredIfBalance:a,selectedGasFeeToken:i}=n;if(!i||!a)return;if(d("Checking gas fee token before publish",{selectedGasFeeToken:i}),await(0,r.isNativeBalanceSufficientForGas)(n,e))return d("Ignoring gas fee token before publish due to sufficient native balance"),void s(n.id,e=>{e.isExternalSign=!1,e.selectedGasFeeToken=undefined});const o=await t({...n,isExternalSign:!0});if(s(n.id,e=>{e.gasFeeTokens=o,e.isExternalSign=!0,e.txParams.nonce=undefined}),d("Updated gas fee tokens before publish",o),!o?.some(e=>e.tokenAddress.toLowerCase()===i.toLowerCase()))throw new Error("Gas fee token not found and insufficient native balance");d("Publishing with selected gas fee token",{selectedGasFeeToken:i})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-fee-tokens.cjs"}],[3484,{"../logger.cjs":3474,"../types.cjs":3475,"./gas-flow.cjs":3485,"./swaps.cjs":3492,"@metamask/controller-utils":1639,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.gweiDecimalToWeiDecimal=n.gweiDecimalToWeiHex=n.updateGasFees=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/utils"),r=e("./gas-flow.cjs"),i=e("./swaps.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),u=(0,a.createModuleLogger)(o.projectLogger,"gas-fees");function l(e){return(0,s.toHex)((0,s.gweiDecToWEIBN)(e))}n.updateGasFees=async function(e){const{txMeta:t}=e,n={...t.txParams},o=i.SWAP_TRANSACTION_TYPES.includes(t.type)?undefined:e.getSavedGasFees(t.chainId),d=await async function(e){const{eip1559:t,ethQuery:n,gasFeeFlows:i,getGasFeeEstimates:o,messenger:l,txMeta:d}=e,{networkClientId:f}=d;if(!t&&d.txParams.gasPrice||t&&d.txParams.maxFeePerGas&&d.txParams.maxPriorityFeePerGas)return{};const h=(0,r.getGasFeeFlow)(d,i,l);try{const e=await o({networkClientId:f}),t=await h.getGasFees({ethQuery:n,gasFeeControllerData:e,messenger:l,transactionMeta:d}),s=t.estimates?.type;switch(s){case c.GasFeeEstimateType.FeeMarket:return t.estimates.medium;case c.GasFeeEstimateType.Legacy:return{gasPrice:t.estimates.medium};case c.GasFeeEstimateType.GasPrice:return{gasPrice:t.estimates.gasPrice};default:throw new Error(`Unsupported gas fee estimate type returned from flow: ${s}`)}}catch(e){u("Failed to get suggested gas fees",e)}const m=await(0,s.query)(n,"gasPrice");return{gasPrice:m?(0,a.add0x)(m.toString(16)):undefined}}(e);u("Suggested gas fees",d);const f={...e,initialParams:n,savedGasFees:o,suggestedGasFees:d};t.txParams.maxFeePerGas=function(e){const{savedGasFees:t,eip1559:n,initialParams:s,suggestedGasFees:a}=e;if(!n)return undefined;if(t){const e=l(t.maxBaseFee);return u("Using maxFeePerGas from savedGasFees",e),e}if(s.maxFeePerGas)return u("Using maxFeePerGas from request",s.maxFeePerGas),s.maxFeePerGas;if(s.gasPrice&&!s.maxPriorityFeePerGas)return u("Setting maxFeePerGas to gasPrice from request",s.gasPrice),s.gasPrice;if(a.maxFeePerGas)return u("Using suggested maxFeePerGas",a.maxFeePerGas),a.maxFeePerGas;if(a.gasPrice)return u("Setting maxFeePerGas to suggested gasPrice",a.gasPrice),a.gasPrice;return u("maxFeePerGas not set"),undefined}(f),t.txParams.maxPriorityFeePerGas=function(e){const{eip1559:t,initialParams:n,savedGasFees:s,suggestedGasFees:a,txMeta:r}=e;if(!t)return undefined;if(s){const e=l(s.priorityFee);return u("Using maxPriorityFeePerGas from savedGasFees.priorityFee",e),e}if(n.maxPriorityFeePerGas)return u("Using maxPriorityFeePerGas from request",n.maxPriorityFeePerGas),n.maxPriorityFeePerGas;if(n.gasPrice&&!n.maxFeePerGas)return u("Setting maxPriorityFeePerGas to gasPrice from request",n.gasPrice),n.gasPrice;if(a.maxPriorityFeePerGas)return u("Using suggested maxPriorityFeePerGas",a.maxPriorityFeePerGas),a.maxPriorityFeePerGas;if(r.txParams.maxFeePerGas)return u("Setting maxPriorityFeePerGas to maxFeePerGas",r.txParams.maxFeePerGas),r.txParams.maxFeePerGas;return u("maxPriorityFeePerGas not set"),undefined}(f),t.txParams.gasPrice=function(e){const{eip1559:t,initialParams:n,suggestedGasFees:s}=e;if(t)return undefined;if(n.gasPrice)return u("Using gasPrice from request",n.gasPrice),n.gasPrice;if(s.maxFeePerGas)return u("Using suggested maxFeePerGas",s.maxFeePerGas),s.maxFeePerGas;if(s.gasPrice)return u("Using suggested gasPrice",s.gasPrice),s.gasPrice;return u("gasPrice not set"),undefined}(f),t.userFeeLevel=function(e){const{initialParams:t,savedGasFees:n,suggestedGasFees:a,txMeta:r}=e;if(n)return c.UserFeeLevel.CUSTOM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&t.gasPrice)return r.origin===s.ORIGIN_METAMASK?c.UserFeeLevel.CUSTOM:c.UserFeeLevel.DAPP_SUGGESTED;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&a.maxFeePerGas&&a.maxPriorityFeePerGas)return c.UserFeeLevel.MEDIUM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&a.gasPrice)return c.UserFeeLevel.MEDIUM;if(r.origin===s.ORIGIN_METAMASK)return c.UserFeeLevel.MEDIUM;return c.UserFeeLevel.DAPP_SUGGESTED}(f),u("Updated gas fee properties",{maxFeePerGas:t.txParams.maxFeePerGas,maxPriorityFeePerGas:t.txParams.maxPriorityFeePerGas,gasPrice:t.txParams.gasPrice}),(t.txParams.maxFeePerGas||t.txParams.maxPriorityFeePerGas)&&delete t.txParams.gasPrice,t.txParams.gasPrice&&(delete t.txParams.maxFeePerGas,delete t.txParams.maxPriorityFeePerGas),function(e){e.defaultGasEstimates??(e.defaultGasEstimates={}),e.defaultGasEstimates.maxFeePerGas=e.txParams.maxFeePerGas,e.defaultGasEstimates.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas,e.defaultGasEstimates.gasPrice=e.txParams.gasPrice,e.defaultGasEstimates.estimateType=e.userFeeLevel}(t)},n.gweiDecimalToWeiHex=l,n.gweiDecimalToWeiDecimal=function(e){return(1e9*Number(e)).toString().split(".")[0]}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-fees.cjs"}],[3485,{"../types.cjs":3475,"@metamask/controller-utils":1639},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeGasFeeEstimates=n.getGasFeeFlow=void 0;const s=e("@metamask/controller-utils"),a=e("../types.cjs");function r(e,t){return(0,s.weiHexToGweiDec)(e[t])}n.getGasFeeFlow=function(e,t,n){return t.find(t=>t.matchesTransaction({transactionMeta:e,messenger:n}))},n.mergeGasFeeEstimates=function({gasFeeControllerEstimates:e,transactionGasFeeEstimates:t}){const n=t.type;return n===a.GasFeeEstimateType.FeeMarket?Object.values(a.GasFeeEstimateLevel).reduce((n,a)=>{return{...n,[a]:(r=e?.[a],i=t[a],{...r,suggestedMaxFeePerGas:(0,s.weiHexToGweiDec)(i.maxFeePerGas),suggestedMaxPriorityFeePerGas:(0,s.weiHexToGweiDec)(i.maxPriorityFeePerGas)})};var r,i},{...e}):n===a.GasFeeEstimateType.Legacy?Object.values(a.GasFeeEstimateLevel).reduce((e,n)=>({...e,[n]:r(t,n)}),{}):n===a.GasFeeEstimateType.GasPrice?{gasPrice:(i=t,(0,s.weiHexToGweiDec)(i.gasPrice))}:e;var i}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-flow.cjs"}],[3486,{"../api/simulation-api.cjs":3452,"../logger.cjs":3474,"../types.cjs":3475,"./eip7702.cjs":3479,"./feature-flags.cjs":3481,"@metamask/controller-utils":1639,"@metamask/utils":3554,"bignumber.js":3500},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateGasBatch=n.addGasBuffer=n.estimateGasBatch=n.estimateGas=n.updateGas=n.DUMMY_AUTHORIZATION_SIGNATURE=n.INTRINSIC_GAS=n.MAX_GAS_BLOCK_PERCENT=n.DEFAULT_GAS_MULTIPLIER=n.FIXED_GAS=n.log=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/utils"),r=e("bignumber.js"),i=e("./eip7702.cjs"),o=e("./feature-flags.cjs"),c=e("../api/simulation-api.cjs"),u=e("../logger.cjs"),l=e("../types.cjs");async function d({chainId:e,ethQuery:t,ignoreDelegationSignatures:r,isSimulationEnabled:i,getSimulationConfig:c,messenger:u,txParams:d}){const f={...d},{authorizationList:h,data:g,from:b,value:y,to:w}=f;if(r&&!i)throw new Error("Gas estimation with ignored delegation signatures is not supported as simulation disabled");const{gasLimit:T,number:S}=await async function(e){return await(0,s.query)(e,"getBlockByNumber",["latest",!1])}(t),E=(0,s.hexToBN)(T),{percentage:k,fixed:P}=(0,o.getGasEstimateFallback)(e,u),v=P?(0,s.toHex)(P):(0,s.BNToHex)((0,s.fractionBN)(E,k,100));(0,n.log)("Estimation fallback values",v),f.data=g?(0,a.add0x)(g):g,f.value=y??"0x0",f.authorizationList=function(e,t){return e?.map(e=>({...e,chainId:e.chainId??t,nonce:e.nonce??"0x1",r:e.r??n.DUMMY_AUTHORIZATION_SIGNATURE,s:e.s??n.DUMMY_AUTHORIZATION_SIGNATURE,yParity:e.yParity??"0x1"}))}(f.authorizationList,e),delete f.gasPrice,delete f.maxFeePerGas,delete f.maxPriorityFeePerGas;let I,_=v;const A=d.type===l.TransactionEnvelopeType.setCode&&Boolean(h?.length)&&Boolean(g)&&"0x"!==g&&b?.toLowerCase()===w?.toLowerCase();try{_=i&&A?await async function(e,t,a,r){const i=await(0,s.query)(t,"estimateGas",[{...e,data:"0x"}]);(0,n.log)("Upgrade only gas",i);const o=e.authorizationList?.[0].address;let c;try{c=await m({chainId:a,delegationAddress:o,getSimulationConfig:r,transaction:e})}catch(e){(0,n.log)("Error while simulating data portion of upgrade",e)}if(c===undefined){try{c=await p(t,{...e,authorizationList:undefined,type:undefined},o)}catch(e){throw(0,n.log)("Error while estimating data portion of upgrade",e),e}(0,n.log)("Success estimating data portion of upgrade",c)}(0,n.log)("Execute gas",c);const u=(0,s.BNToHex)((0,s.hexToBN)(i).add((0,s.hexToBN)(c)).subn(n.INTRINSIC_GAS));return(0,n.log)("Total type 4 gas",u),u}(f,t,e,c):r&&i?await m({chainId:e,getSimulationConfig:c,transaction:f}):await p(t,f)}catch(e){I={reason:e.message,errorKey:e.errorKey,debug:{blockNumber:S,blockGasLimit:T}},(0,n.log)("Estimation failed",{...I,fallback:v})}return{blockGasLimit:T,estimatedGas:_,isUpgradeWithDataToSelf:A,simulationFails:I}}function f(e,t,r){const i=(0,s.hexToBN)(e),o=(0,s.fractionBN)((0,s.hexToBN)(t),n.MAX_GAS_BLOCK_PERCENT,100),c=(0,s.fractionBN)(i,100*r,100);if(i.gt(o)){const t=(0,a.add0x)(e);return(0,n.log)("Using estimated value",t),t}if(c.lt(o)){const e=(0,a.add0x)((0,s.BNToHex)(c));return(0,n.log)("Using padded estimate",e,r),e}const u=(0,a.add0x)((0,s.BNToHex)(o));return(0,n.log)("Using 90% of block gas limit",u),u}async function h({chainId:e,from:t,getSimulationConfig:a,transactions:r}){try{const n=await(0,c.simulateTransactions)(e,{getSimulationConfig:a,transactions:r.map(e=>({...e.params,from:t}))});if(n?.transactions?.length!==r.length)throw new Error("Simulation response does not match transaction count");return n.transactions.reduce((e,t)=>{const n=t?.gasLimit;if(!n)throw new Error("No simulated gas returned for one of the transactions");return e.gasLimits.push(n),e.totalGasLimit=(0,s.BNToHex)((0,s.hexToBN)(e.totalGasLimit).add((0,s.hexToBN)(n))),e},{totalGasLimit:"0x0",gasLimits:[]})}catch(e){throw(0,n.log)("Error while simulating gas batch",e),new Error("Cannot estimate transaction batch total gas as simulation failed")}}async function m({chainId:e,delegationAddress:t,getSimulationConfig:n,transaction:s}){const r=await(0,c.simulateTransactions)(e,{getSimulationConfig:n,transactions:[{to:s.to,from:s.from,data:s.data,value:s.value}],overrides:{[s.from]:{code:t&&i.DELEGATION_PREFIX+(0,a.remove0x)(t)}}}),o=r?.transactions?.[0].gasLimit;if(!o)throw new Error("No simulated gas returned");return o}function p(e,t,n){const{from:r}=t,o=[t];return n&&(o.push("latest"),o.push({[r]:{code:i.DELEGATION_PREFIX+(0,a.remove0x)(n)}})),(0,s.query)(e,"estimateGas",o)}n.log=(0,a.createModuleLogger)(u.projectLogger,"gas"),n.FIXED_GAS="0x5208",n.DEFAULT_GAS_MULTIPLIER=1.5,n.MAX_GAS_BLOCK_PERCENT=90,n.INTRINSIC_GAS=21e3,n.DUMMY_AUTHORIZATION_SIGNATURE="0x1111111111111111111111111111111111111111111111111111111111111111",n.updateGas=async function(e){const{txMeta:t}=e,a={...t.txParams},[r,i,c]=await async function(e){const{chainId:t,isCustomNetwork:a,isSimulationEnabled:r,getSimulationConfig:i,messenger:c,txMeta:u}=e,{disableGasBuffer:h}=u;if(u.txParams.gas)return(0,n.log)("Using value from request",u.txParams.gas),[u.txParams.gas,undefined,u.txParams.gas];if(await async function({ethQuery:e,txMeta:t,isCustomNetwork:n}){const{txParams:{to:a,data:r,type:i}}=t;if(n||!a||r||i===l.TransactionEnvelopeType.setCode)return!1;const o=await async function(e,t){return await(0,s.query)(e,"getCode",[t])}(e,a);return!o||"0x"===o}(e))return(0,n.log)("Using fixed value",n.FIXED_GAS),[n.FIXED_GAS,undefined,n.FIXED_GAS];const{blockGasLimit:m,estimatedGas:p,isUpgradeWithDataToSelf:g,simulationFails:b}=await d({chainId:t,ethQuery:e.ethQuery,isSimulationEnabled:r,getSimulationConfig:i,messenger:c,txParams:u.txParams});(0,n.log)("Original estimated gas",p),b&&(0,n.log)("Using original fallback estimate as simulation failed");h&&(0,n.log)("Gas buffer disabled");if(b||h)return[p,b,p];const y=(0,o.getGasEstimateBuffer)({chainId:t,isCustomRPC:a,isUpgradeWithDataToSelf:g,messenger:c});(0,n.log)("Buffer",y);const w=f(p,m,y);return(0,n.log)("Buffered gas",w),[w,b,p]}(e);t.txParams.gas=r,t.simulationFails=i,t.gasLimitNoBuffer=c,a.gas||(t.originalGasEstimate=t.txParams.gas),t.defaultGasEstimates??(t.defaultGasEstimates={}),t.defaultGasEstimates.gas=t.txParams.gas},n.estimateGas=d,n.estimateGasBatch=async function({chainId:e,ethQuery:t,from:s,getSimulationConfig:a,isAtomicBatchSupported:o,messenger:c,transactions:u}){const f=(await o({address:s,chainIds:[e]})).find(t=>t.chainId===e),m=Boolean(f&&!f.isSupported);if(m&&!f?.upgradeContractAddress)throw new Error("Upgrade contract address not found");if(f){const o=m?[{address:f.upgradeContractAddress}]:undefined,h=m?l.TransactionEnvelopeType.setCode:undefined,p={...(0,i.generateEIP7702BatchTransaction)(s,u),authorizationList:o,from:s,type:h},{estimatedGas:g}=await d({chainId:e,ethQuery:t,isSimulationEnabled:!0,getSimulationConfig:a,messenger:c,txParams:p}),b=new r.BigNumber(g).toNumber();return(0,n.log)("Estimated EIP-7702 gas limit",b),{totalGasLimit:b,gasLimits:[b]}}if(u.every(e=>e.gas!==undefined)){const e=u.map(e=>new r.BigNumber(e.gas).toNumber()),t=e.reduce((e,t)=>e+t,0);return(0,n.log)("Using batch parameter gas limits",{gasLimits:e,total:t}),{totalGasLimit:t,gasLimits:e}}const{gasLimits:p}=await h({chainId:e,from:s,getSimulationConfig:a,transactions:u.map(e=>({params:e}))}),g=u.map((e,t)=>e.gas?new r.BigNumber(e.gas).toNumber():new r.BigNumber(p[t]).toNumber()),b=g.reduce((e,t)=>e+t,0);return(0,n.log)("Simulated batch gas limits",{totalGasLimit:b,gasLimits:g}),{totalGasLimit:b,gasLimits:g}},n.addGasBuffer=f,n.simulateGasBatch=h}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas.cjs"}],[3487,{"../logger.cjs":3474,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionLayer1GasFee=n.updateTransactionLayer1GasFee=void 0;const s=e("@metamask/utils"),a=e("../logger.cjs"),r=(0,s.createModuleLogger)(a.projectLogger,"layer-1-gas-fee-flow");async function i({layer1GasFeeFlows:e,messenger:t,provider:n,transactionMeta:s}){const a=await async function(e,t,n){for(const s of t)if(await s.matchesTransaction({transactionMeta:e,messenger:n}))return s;return undefined}(s,e,t);if(!a)return undefined;r("Found layer 1 gas fee flow",a.constructor.name,s.id);try{const{layer1Fee:e}=await a.getLayer1Fee({provider:n,transactionMeta:s});return e}catch(e){return r("Failed to get layer 1 gas fee",s.id,e),undefined}}n.updateTransactionLayer1GasFee=async function(e){const t=await i(e);if(!t)return;const{transactionMeta:n}=e;n.layer1GasFee=t,r("Updated layer 1 gas fee",t,n.id)},n.getTransactionLayer1GasFee=i}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/layer1-gas-fee-flow.cjs"}],[3488,{"../logger.cjs":3474,"@metamask/controller-utils":1639},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAndFormatTransactionsForNonceTracker=n.getNextNonce=void 0;const s=e("@metamask/controller-utils"),a=e("../logger.cjs"),r=(0,a.createModuleLogger)(a.projectLogger,"nonce");n.getNextNonce=async function(e,t){const{customNonceValue:n,isExternalSign:a,txParams:{from:i,nonce:o}}=e;if(a)return r("Skipping nonce as signed externally"),[undefined,undefined];const c=n?(0,s.toHex)(n):undefined;if(c)return r("Using custom nonce",c),[c,undefined];if(o)return r("Using existing nonce",o),[o,undefined];const u=await t(i),l=(0,s.toHex)(u.nextNonce),d=u.releaseLock.bind(u);return r("Using nonce from nonce tracker",l,u.nonceDetails),[l,d]},n.getAndFormatTransactionsForNonceTracker=function(e,t,n,s){return s.filter(({chainId:s,isTransfer:a,isUserOperation:r,status:i,txParams:{from:o,nonce:c}})=>!a&&!r&&s===e&&n.includes(i)&&o.toLowerCase()===t.toLowerCase()&&c).flatMap(({status:e,txParams:{authorizationList:t,from:n,gas:s,value:a,nonce:r}})=>[r,...(t??[]).map(e=>e.nonce).filter(e=>e!==undefined)].map(t=>({status:e,history:[{}],txParams:{from:n??"",gas:s??"",value:a??"",nonce:t??""}})))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/nonce.cjs"}],[3489,{"@ethereumjs/common":679,"@ethereumjs/tx":696,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeTransaction=n.prepareTransaction=n.HARDFORK=void 0;const s=e("@ethereumjs/common"),a=e("@ethereumjs/tx"),r=e("@metamask/utils"),i=e("lodash");function o(e){const t={chainId:parseInt(e,16),defaultHardfork:n.HARDFORK};return s.Common.custom(t,{eips:[7702]})}function c(e){return e?"0x0"===e?"0x":e.replace?.(/^0x(00)+/u,"0x")??e:e}n.HARDFORK=s.Hardfork.Prague,n.prepareTransaction=function(e,t){const n=function(e){const t=(0,i.cloneDeep)(e);return function(e){if(!e)return;for(const t of e)t.nonce=c(t.nonce),t.r=c(t.r),t.s=c(t.s),t.yParity=c(t.yParity)}(t.authorizationList),t}(t);return a.TransactionFactory.fromTxData(n,{freeze:!1,common:o(e)})},n.serializeTransaction=function(e){return(0,r.bytesToHex)(e.serialize())}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/prepare.cjs"}],[3490,{"@metamask/controller-utils":1639,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionParamsWithIncreasedGasFee=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/utils");function r(e,t){const n=(0,s.convertHexToDecimal)(e),r=parseInt(""+n*t,10);return(0,a.add0x)(r.toString(16))}n.getTransactionParamsWithIncreasedGasFee=function(e,t,n){const s=function(e,t,n){if(n&&"gasPrice"in n)return n.gasPrice;const s=e.gasPrice;if(!s||"0x0"===s)return undefined;return r(s,t)}(e,t,n),a=function(e,t,n){if(n&&"maxFeePerGas"in n&&"maxPriorityFeePerGas"in n)return n;const s=e.maxFeePerGas,a=e.maxPriorityFeePerGas;if(!s||!a||"0x0"===s||"0x0"===a)return undefined;const i=r(s,t),o=r(a,t);return{maxFeePerGas:i,maxPriorityFeePerGas:o}}(e,t,n);if(a){const t={...e,...a};return delete t.gasPrice,t}if(s){const t={...e,gasPrice:s};return delete t.maxFeePerGas,delete t.maxPriorityFeePerGas,t}throw new Error("Cannot increase gas fee as no current values and no new values were provided")}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/retry.cjs"}],[3491,{"@ethersproject/wallet":860,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidSignature=void 0;const s=e("@ethersproject/wallet"),a=e("@metamask/utils");n.isValidSignature=function(e,t,n){try{const r=(0,a.add0x)(e.map(a.remove0x).join("")),i=(0,a.hexToBytes)(r);return(0,s.verifyMessage)(i,t).toLowerCase()===n.toLowerCase()}catch{return!1}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/signature.cjs"}],[3492,{"../constants.cjs":3453,"../logger.cjs":3474,"../types.cjs":3475,"./utils.cjs":3494,"@metamask/controller-utils":1639,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePostTransactionBalance=n.updateSwapsTransaction=n.SWAP_TRANSACTION_TYPES=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=n.UPDATE_POST_TX_BALANCE_ATTEMPTS=n.UPDATE_POST_TX_BALANCE_TIMEOUT=void 0;const s=e("@metamask/controller-utils"),a=e("lodash"),r=e("./utils.cjs"),i=e("../constants.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),u=(0,o.createModuleLogger)(o.projectLogger,"swaps");n.UPDATE_POST_TX_BALANCE_TIMEOUT=5e3,n.UPDATE_POST_TX_BALANCE_ATTEMPTS=6;const l="0x539";n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const d={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},f={name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},h={name:"Matic",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},m={name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},p={name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},g={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},b={...d},y={...d},w={...d},T={name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},S={name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},E={name:"Hyperliquid",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18};function k(e,t){return!(!e||!t)&&e===n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[t]?.address}function P(e){return new Promise(t=>setTimeout(t,e))}n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[i.CHAIN_IDS.MAINNET]:d,[l]:p,[i.CHAIN_IDS.BSC]:f,[i.CHAIN_IDS.POLYGON]:h,[i.CHAIN_IDS.GOERLI]:g,[i.CHAIN_IDS.AVALANCHE]:m,[i.CHAIN_IDS.OPTIMISM]:y,[i.CHAIN_IDS.ARBITRUM]:b,[i.CHAIN_IDS.ZKSYNC_ERA]:w,[i.CHAIN_IDS.SEI]:T,[i.CHAIN_IDS.MONAD]:S,[i.CHAIN_IDS.HYPEREVM]:E},n.SWAP_TRANSACTION_TYPES=[c.TransactionType.swap,c.TransactionType.swapAndSend,c.TransactionType.swapApproval],n.updateSwapsTransaction=function(e,t,s,{isSwapsDisabled:i,cancelTransaction:o,messenger:u}){if(i||!n.SWAP_TRANSACTION_TYPES.includes(t))return e;if(t===c.TransactionType.swap&&!1===s?.hasApproveTx&&e.simulationFails)throw o(e.id),new Error("Simulation failed");const l=s?.meta;if(!l)return e;let d=e;return t===c.TransactionType.swapApproval&&(d=function(e,{type:t,sourceTokenSymbol:n}){(0,r.validateIfTransactionUnapproved)(e,"updateSwapApprovalTransaction");let s={type:t,sourceTokenSymbol:n};return s=(0,a.pickBy)({type:t,sourceTokenSymbol:n}),(0,a.merge)({},e,s)}(e,l),u.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:d})),t===c.TransactionType.swapAndSend&&(d=function(e,{approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:s,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:u,sourceTokenAmount:l,sourceTokenDecimals:d,sourceTokenSymbol:f,swapAndSendRecipient:h,swapMetaData:m,swapTokenValue:p,type:g}){(0,r.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let b={approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:s,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:u,sourceTokenAmount:l,sourceTokenDecimals:d,sourceTokenSymbol:f,swapAndSendRecipient:h,swapMetaData:m,swapTokenValue:p,type:g};return b=(0,a.pickBy)(b),(0,a.merge)({},e,b)}(e,l),u.publish("TransactionController:transactionNewSwapAndSend",{transactionMeta:d})),t===c.TransactionType.swap&&(d=function(e,{sourceTokenSymbol:t,destinationTokenSymbol:n,type:s,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:u,estimatedBaseFee:l,approvalTxId:d}){(0,r.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let f={sourceTokenSymbol:t,destinationTokenSymbol:n,type:s,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:u,estimatedBaseFee:l,approvalTxId:d};return f=(0,a.pickBy)(f),(0,a.merge)({},e,f)}(e,l),u.publish("TransactionController:transactionNewSwap",{transactionMeta:d})),d},n.updatePostTransactionBalance=async function(e,{ethQuery:t,getTransaction:a,updateTransaction:r}){u("Updating post transaction balance",e.id);const i=e.id;let o,c;for(let r=0;r<n.UPDATE_POST_TX_BALANCE_ATTEMPTS;r++){u("Querying balance",{attempt:r});const l=await(0,s.query)(t,"getBalance",[e.txParams.from]);o={...a(i)??{}},c=o.approvalTxId?a(o.approvalTxId):undefined,o.postTxBalance=l.toString(16);const d=k(e.destinationTokenAddress,e.chainId);if(!d||e.preTxBalance!==o.postTxBalance){u("Finishing post balance update",{isDefaultTokenAddress:d,preTxBalance:e.preTxBalance,postTxBalance:o.postTxBalance});break}u("Waiting for balance to update",{delay:n.UPDATE_POST_TX_BALANCE_TIMEOUT}),await P(n.UPDATE_POST_TX_BALANCE_TIMEOUT)}return r(o,"TransactionController#updatePostTransactionBalance - Add post transaction balance"),u("Completed post balance update",o?.postTxBalance),{updatedTransactionMeta:o,approvalTransactionMeta:c}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/swaps.cjs"}],[3493,{"../types.cjs":3475,"./eip7702.cjs":3479,"@ethersproject/abi":763,"@metamask/controller-utils":1639,"@metamask/metamask-eth-abis":2597},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=n.determineTransactionType=n.ESTIMATE_GAS_ERROR=void 0;const s=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),r=e("@metamask/metamask-eth-abis"),i=e("./eip7702.cjs"),o=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const c=new s.Interface(r.abiERC20),u=new s.Interface(r.abiERC721),l=new s.Interface(r.abiERC1155),d=new s.Interface(r.abiFiatTokenV2);function f(e,t){if(!e||e.length<10)return undefined;const n=e.substring(0,10).toLowerCase();for(const s of[c,u,l,d])try{return t?.getMethodName?s.getFunction(n)?.name:s.parseTransaction({data:e})}catch{}return undefined}n.determineTransactionType=async function(e,t){const{data:n,to:s}=e;if(n&&!s)return{type:o.TransactionType.deployContract,getCodeResponse:undefined};let r,c=Boolean(n?.length);if(t){const e=await async function(e,t){let n;try{n=await(0,a.query)(e,"getCode",[t])}catch(e){n=null}const s=!!n&&("0x"!==n&&"0x0"!==n&&!n.startsWith(i.DELEGATION_PREFIX));return{contractCode:n,isContractAddress:s}}(t,s);r=e.contractCode,c=e.isContractAddress}if(!c)return{type:o.TransactionType.simpleSend,getCodeResponse:r};const u=0!==Number(e.value??"0"),l={type:o.TransactionType.contractInteraction,getCodeResponse:r};if(!n||u)return l;const d=function(e){return f(e,{getMethodName:!0})}(n);if(!d)return l;const h=[o.TransactionType.tokenMethodApprove,o.TransactionType.tokenMethodSetApprovalForAll,o.TransactionType.tokenMethodTransfer,o.TransactionType.tokenMethodTransferFrom,o.TransactionType.tokenMethodSafeTransferFrom,o.TransactionType.tokenMethodIncreaseAllowance].find(e=>e.toLowerCase()===d.toLowerCase());return h?{type:h,getCodeResponse:r}:l},n.decodeTransactionData=f}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/transaction-type.cjs"}],[3494,{"../types.cjs":3475,"@metamask/controller-utils":1639,"@metamask/utils":3554,"bn.js":4413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.caip2ToHex=n.setEnvelopeType=n.getPercentageChange=n.toBN=n.bnFromHex=n.padHexToEvenLength=n.normalizeGasFeeValues=n.normalizeTxError=n.validateIfTransactionUnapproved=n.validateGasValues=n.isEIP1559Transaction=n.normalizeTransactionParams=n.ESTIMATE_GAS_ERROR=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/utils"),i=s(e("bn.js")),o=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const c={accessList:e=>e,authorizationList:e=>e,data:e=>(0,r.add0x)(l(e)),from:e=>(0,r.add0x)(e).toLowerCase(),gas:e=>(0,r.add0x)(e),gasLimit:e=>(0,r.add0x)(e),gasPrice:e=>(0,r.add0x)(e),nonce:e=>(0,r.add0x)(e),to:e=>(0,r.add0x)(e).toLowerCase(),value:e=>(0,r.add0x)(e),maxFeePerGas:e=>(0,r.add0x)(e),maxPriorityFeePerGas:e=>(0,r.add0x)(e),estimatedBaseFee:e=>(0,r.add0x)(e),type:e=>(0,r.add0x)(e)};n.normalizeTransactionParams=function(e){const t={from:""};for(const n of(0,r.getKnownPropertyNames)(c))e[n]&&(t[n]=c[n](e[n]));return t.value??(t.value="0x0"),t.gasLimit&&!t.gas&&(t.gas=t.gasLimit),t},n.isEIP1559Transaction=function(e){const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);return t(e,"maxFeePerGas")&&t(e,"maxPriorityFeePerGas")};function u(e){try{return JSON.parse(JSON.stringify(e)),!0}catch{return!1}}function l(e){const t=e.toLowerCase().startsWith("0x")?e.slice(0,2):"",n=t?e.slice(2):e;return t+(n.length%2==0?n:`0${n}`)}function d(e){const t=e,n=t.startsWith("0x")||t.startsWith("0X")?t.slice(2):t;return 0===n.length?new i.default(0):new i.default(n,16)}n.validateGasValues=e=>{Object.keys(e).forEach(t=>{const n=e[t];if("string"!=typeof n||!(0,r.isStrictHexString)(n))throw new TypeError(`expected hex string for ${t} but received: ${n}`)})},n.validateIfTransactionUnapproved=function(e,t){if(e?.status!==o.TransactionStatus.unapproved)throw new Error(`TransactionsController: Can only call ${t} on an unapproved transaction.\n      Current tx status: ${e?.status}`)},n.normalizeTxError=function(e){return{name:e.name,message:e.message,stack:e.stack,code:e.code,rpc:u(e.value)?e.value:undefined}},n.normalizeGasFeeValues=function(e){const t=e=>"string"==typeof e?(0,r.add0x)(e):e;return"gasPrice"in e?{gasPrice:t(e.gasPrice)}:{maxFeePerGas:t(e.maxFeePerGas),maxPriorityFeePerGas:t(e.maxPriorityFeePerGas)}},n.padHexToEvenLength=l,n.bnFromHex=d,n.toBN=function(e){if(e instanceof i.default)return e;if("function"==typeof i.default.isBN&&i.default.isBN(e))return e;if(null!==e&&"object"==typeof e&&"function"==typeof e.toHexString)return d(e.toHexString());if(null!==e&&"object"==typeof e&&"string"==typeof e._hex)return d(e._hex);if("string"==typeof e)return d(e);if("bigint"==typeof e)return new i.default(e.toString());if("number"==typeof e)return new i.default(e);throw new Error("Unexpected value returned from oracle contract")},n.getPercentageChange=function(e,t){const n=new i.default(10).pow(new i.default(18)),s=e.mul(n),a=t.mul(n),r=a.sub(s);return r.isZero()?0:s.isZero()&&!a.isZero()?100:r.muln(100).div(s).abs().toNumber()},n.setEnvelopeType=function(e,t){e.accessList?e.type=o.TransactionEnvelopeType.accessList:e.authorizationList?e.type=o.TransactionEnvelopeType.setCode:e.type=t?o.TransactionEnvelopeType.feeMarket:o.TransactionEnvelopeType.legacy},n.caip2ToHex=function(e){if(!(0,r.isCaipChainId)(e))return undefined;try{const{reference:t}=(0,r.parseCaipChainId)(e);return(0,a.toHex)(t)}catch{return undefined}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/utils.cjs"}],[3495,{"../types.cjs":3475,"./utils.cjs":3494,"@ethersproject/abi":763,"@metamask/controller-utils":1639,"@metamask/metamask-eth-abis":2597,"@metamask/rpc-errors":3026,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateBatchRequest=n.validateParamTo=n.validateTxParams=n.validateTransactionOrigin=n.ErrorCode=void 0;const s=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),r=e("@metamask/metamask-eth-abis"),i=e("@metamask/rpc-errors"),o=e("@metamask/utils"),c=e("./utils.cjs"),u=e("../types.cjs");var l;!function(e){e[e.DuplicateBundleId=5720]="DuplicateBundleId",e[e.BundleTooLarge=5740]="BundleTooLarge",e[e.RejectedUpgrade=5750]="RejectedUpgrade"}(l||(n.ErrorCode=l={}));const d=[u.TransactionEnvelopeType.feeMarket,u.TransactionEnvelopeType.setCode];function f(e,t){const n=e.type;switch(t){case"authorizationList":if(n&&n!==u.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including authorizationList requires type: "${u.TransactionEnvelopeType.setCode}"`);break;case"maxFeePerGas":case"maxPriorityFeePerGas":if(n&&!d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${d.join(", ")}"`);break;default:if(n&&d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`)}}function h(e,t,n){if(void 0!==e[n])throw i.rpcErrors.invalidParams(`Invalid transaction params: specified ${t} but also included ${n}, these cannot be mixed`)}function m(e,t){const n=e[t];if("string"!=typeof n||!(0,o.isStrictHexString)(n))throw i.rpcErrors.invalidParams(`Invalid transaction params: ${String(t)} is not a valid hexadecimal string. got: (${String(n)})`)}function p(e){m(e,"address"),function(e,t,n){const s=(0,o.remove0x)(e).length/2;if(s!==t)throw i.rpcErrors.invalidParams(`Invalid transaction params: ${n} must be ${t} bytes. got: ${s} bytes`)}(e.address,20,"address");for(const t of["chainId","nonce","r","s"])e[t]&&m(e,t);const{yParity:t}=e;if(t&&!["0x0","0x1"].includes(t))throw i.rpcErrors.invalidParams(`Invalid transaction params: yParity must be '0x0' or '0x1'. got: ${t}`)}n.validateTransactionOrigin=async function({data:e,from:t,internalAccounts:n,origin:s,permittedAddresses:r,txParams:o,type:c}){if(!s||s===a.ORIGIN_METAMASK)return;const{authorizationList:l,to:d,type:f}=o;if(r&&!r.includes(t))throw i.providerErrors.unauthorized({data:{origin:s}});if(c===u.TransactionType.batch)return;if(l||f===u.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams("External EIP-7702 transactions are not supported");if(Boolean(e&&"0x"!==e)&&n?.some(e=>e.toLowerCase()===d?.toLowerCase()))throw i.rpcErrors.invalidParams("External transactions to internal accounts cannot include data")},n.validateTxParams=function(e,t=!0,n){!function(e){if(e&&!Object.values(u.TransactionEnvelopeType).includes(e))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: "${e}". Must be one of: ${Object.values(u.TransactionEnvelopeType).join(", ")}`)}(e.type),function(e,t){if((0,c.isEIP1559Transaction)(e)&&!t)throw i.rpcErrors.invalidParams("Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559")}(e,t),function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams(`Invalid "from" address ${e}: not a string.`);if(!(0,a.isValidHexAddress)(e))throw i.rpcErrors.invalidParams('Invalid "from" address.')}(e.from),function(e){if("0x"===e.to||e.to===undefined){if(!e.data)throw i.rpcErrors.invalidParams('Invalid "to" address.');delete e.to}else if(e.to!==undefined&&!(0,a.isValidHexAddress)(e.to))throw i.rpcErrors.invalidParams('Invalid "to" address.')}(e),function(e){if(e!==undefined){if(e.includes("-"))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": not a positive number.`);if(e.includes("."))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": number must be in wei.`);const t=parseInt(e,10);if(!(Number.isFinite(t)&&!Number.isNaN(t)&&!isNaN(Number(e))&&Number.isSafeInteger(t)))throw i.rpcErrors.invalidParams(`Invalid transaction value ${e}: number must be a valid number.`)}}(e.value),function(e){if(e){const t=new s.Interface(r.abiERC20);try{t.parseTransaction({data:e})}catch(e){if(e.message.match(/BUFFER_OVERRUN/u))throw i.rpcErrors.invalidParams("Invalid transaction params: data out-of-bounds, BUFFER_OVERRUN.")}}}(e.data),function(e,t){if(e&&t&&e.toLowerCase?.()!==t.toLowerCase())throw i.rpcErrors.invalidParams(`Invalid transaction params: chainId must match the network client, got: ${e}, expected: ${t}`)}(e.chainId,n),function(e){e.gasPrice&&(f(e,"gasPrice"),h(e,"gasPrice","maxFeePerGas"),h(e,"gasPrice","maxPriorityFeePerGas"),m(e,"gasPrice"));e.maxFeePerGas&&(f(e,"maxFeePerGas"),h(e,"maxFeePerGas","gasPrice"),m(e,"maxFeePerGas"));e.maxPriorityFeePerGas&&(f(e,"maxPriorityFeePerGas"),h(e,"maxPriorityFeePerGas","gasPrice"),m(e,"maxPriorityFeePerGas"));e.gasLimit&&m(e,"gasLimit");e.gas&&m(e,"gas")}(e),function(e){const{authorizationList:t}=e;if(!t)return;if(f(e,"authorizationList"),!Array.isArray(t))throw i.rpcErrors.invalidParams("Invalid transaction params: authorizationList must be an array");for(const e of t)p(e)}(e)},n.validateParamTo=function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams('Invalid "to" address')},n.validateBatchRequest=function({internalAccounts:e,request:t,sizeLimit:n}){const{origin:s}=t,r=s&&s!==a.ORIGIN_METAMASK,o=e.map(e=>e.toLowerCase());if(r&&t.transactions.some(e=>{const t=e.params.to?.toLowerCase(),n=e.params.data,s=o.includes(t),a=Boolean(n&&"0x"!==n);return s&&a}))throw i.rpcErrors.invalidParams("External calls to internal accounts cannot include data");if(r&&t.transactions.length>n)throw new i.JsonRpcError(l.BundleTooLarge,`Batch size cannot exceed ${n}. got: ${t.transactions.length}`)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/validation.cjs"}],[3496,{"./determineGasFeeCalculations.cjs":3497,"./gas-util.cjs":3498,"@metamask/controller-utils":1639,"@metamask/eth-query":2226,"@metamask/polling-controller":2889,uuid:6134},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.GasFeeController=n.GAS_ESTIMATE_TYPES=n.LEGACY_GAS_PRICES_API_URL=void 0;const u=e("@metamask/controller-utils"),l=c(e("@metamask/eth-query")),d=e("@metamask/polling-controller"),f=e("uuid"),h=c(e("./determineGasFeeCalculations.cjs")),m=e("./gas-util.cjs");n.LEGACY_GAS_PRICES_API_URL="https://api.metaswap.codefi.network/gasPrices",n.GAS_ESTIMATE_TYPES={FEE_MARKET:"fee-market",LEGACY:"legacy",ETH_GASPRICE:"eth_gasPrice",NONE:"none"};const p={gasFeeEstimatesByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasFeeEstimates:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},estimatedGasFeeTimeBounds:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasEstimateType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},nonRPCGasFeeApisDisabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}},g={gasFeeEstimatesByChainId:{},gasFeeEstimates:{},estimatedGasFeeTimeBounds:{},gasEstimateType:n.GAS_ESTIMATE_TYPES.NONE,nonRPCGasFeeApisDisabled:!1};class b extends((0,d.StaticIntervalPollingController)()){constructor({interval:e=15e3,messenger:t,state:c,getCurrentNetworkEIP1559Compatibility:u,getCurrentAccountEIP1559Compatibility:d,getChainId:f,getCurrentNetworkLegacyGasAPICompatibility:h,getProvider:m,onNetworkDidChange:b,legacyAPIEndpoint:y=n.LEGACY_GAS_PRICES_API_URL,EIP1559APIEndpoint:w,clientId:T}){if(super({name:"GasFeeController",metadata:p,messenger:t,state:{...g,...c}}),s.add(this),a.set(this,void 0),this.intervalDelay=e,this.setIntervalLength(e),this.pollTokens=new Set,this.getCurrentNetworkEIP1559Compatibility=u,this.getCurrentNetworkLegacyGasAPICompatibility=h,this.getCurrentAccountEIP1559Compatibility=d,i(this,a,m,"f"),this.EIP1559APIEndpoint=w,this.legacyAPIEndpoint=y,this.clientId=T,this.ethQuery=new l.default(o(this,a,"f").call(this)),b&&f)this.currentChainId=f(),b(async e=>{await o(this,s,"m",r).call(this,e)});else{const{selectedNetworkClientId:e}=this.messenger.call("NetworkController:getState");this.currentChainId=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId,this.messenger.subscribe("NetworkController:networkDidChange",async e=>{await o(this,s,"m",r).call(this,e)})}}async resetPolling(){if(0!==this.pollTokens.size){const e=Array.from(this.pollTokens);this.stopPolling(),await this.getGasFeeEstimatesAndStartPolling(e[0]),e.slice(1).forEach(e=>{this.pollTokens.add(e)})}}async fetchGasFeeEstimates(e){return await this._fetchGasFeeEstimateData(e)}async getGasFeeEstimatesAndStartPolling(e){const t=e||(0,f.v1)();return this.pollTokens.add(t),1===this.pollTokens.size&&(await this._fetchGasFeeEstimateData(),this._poll()),t}async _fetchGasFeeEstimateData(e={}){const{shouldUpdateState:t=!0,networkClientId:n}=e;let s,a,r,i;if(n!==undefined){const e=this.messenger.call("NetworkController:getNetworkClientById",n);r="0x38"===e.configuration.chainId,i=(0,u.convertHexToDecimal)(e.configuration.chainId);try{a=await this.messenger.call("NetworkController:getEIP1559Compatibility",n)||!1}catch{a=!1}s=new l.default(e.provider)}s??(s=this.ethQuery),r??(r=this.getCurrentNetworkLegacyGasAPICompatibility()),i??(i=(0,u.convertHexToDecimal)(this.currentChainId));try{a??(a=await this.getEIP1559Compatibility())}catch(e){console.error(e),a??(a=!1)}const o=await(0,h.default)({isEIP1559Compatible:a,isLegacyGasAPICompatible:r,fetchGasEstimates:m.fetchGasEstimates,fetchGasEstimatesUrl:this.EIP1559APIEndpoint.replace("<chain_id>",`${i}`),fetchLegacyGasPriceEstimates:m.fetchLegacyGasPriceEstimates,fetchLegacyGasPriceEstimatesUrl:this.legacyAPIEndpoint.replace("<chain_id>",`${i}`),fetchEthGasPriceEstimate:m.fetchEthGasPriceEstimate,calculateTimeEstimate:m.calculateTimeEstimate,clientId:this.clientId,ethQuery:s,nonRPCGasFeeApisDisabled:this.state.nonRPCGasFeeApisDisabled});if(t){const e=(0,u.toHex)(i);this.update(t=>{this.currentChainId===e&&(t.gasFeeEstimates=o.gasFeeEstimates,t.estimatedGasFeeTimeBounds=o.estimatedGasFeeTimeBounds,t.gasEstimateType=o.gasEstimateType),t.gasFeeEstimatesByChainId??(t.gasFeeEstimatesByChainId={}),t.gasFeeEstimatesByChainId[e]={gasFeeEstimates:o.gasFeeEstimates,estimatedGasFeeTimeBounds:o.estimatedGasFeeTimeBounds,gasEstimateType:o.gasEstimateType}})}return o}disconnectPoller(e){this.pollTokens.delete(e),0===this.pollTokens.size&&this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId),this.pollTokens.clear(),this.resetState()}destroy(){super.destroy(),this.stopPolling()}_poll(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{await(0,u.safelyExecute)(()=>this._fetchGasFeeEstimateData())},this.intervalDelay)}async _executePoll({networkClientId:e}){await this._fetchGasFeeEstimateData({networkClientId:e})}resetState(){this.update(()=>g)}async getEIP1559Compatibility(){const e=await this.getCurrentNetworkEIP1559Compatibility(),t=this.getCurrentAccountEIP1559Compatibility?.()??!0;return e&&t}getTimeEstimate(e,t){return this.state.gasFeeEstimates&&this.state.gasEstimateType===n.GAS_ESTIMATE_TYPES.FEE_MARKET?(0,m.calculateTimeEstimate)(e,t,this.state.gasFeeEstimates):{}}enableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!1})}disableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!0})}}n.GasFeeController=b,a=new WeakMap,s=new WeakSet,r=async function({selectedNetworkClientId:e}){const t=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId;t!==this.currentChainId&&(this.ethQuery=new l.default(o(this,a,"f").call(this)),await this.resetPolling(),this.currentChainId=t)},n.default=b}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/GasFeeController.cjs"}],[3497,{"./GasFeeController.cjs":3496},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const s=e("./GasFeeController.cjs");n.default=async function(e){try{return await async function(e){const{isEIP1559Compatible:t,isLegacyGasAPICompatible:n,nonRPCGasFeeApisDisabled:a}=e;try{if(t&&!a)return await async function(e){const{fetchGasEstimates:t,fetchGasEstimatesUrl:n,clientId:a,calculateTimeEstimate:r}=e,i=await t(n,a),{suggestedMaxPriorityFeePerGas:o,suggestedMaxFeePerGas:c}=i.medium,u=r(o,c,i);return{gasFeeEstimates:i,estimatedGasFeeTimeBounds:u,gasEstimateType:s.GAS_ESTIMATE_TYPES.FEE_MARKET}}(e);if(n&&!a)return await async function(e){const{fetchLegacyGasPriceEstimates:t,fetchLegacyGasPriceEstimatesUrl:n,clientId:a}=e;return{gasFeeEstimates:await t(n,a),estimatedGasFeeTimeBounds:{},gasEstimateType:s.GAS_ESTIMATE_TYPES.LEGACY}}(e);throw new Error("Main gas fee/price estimation failed. Use fallback")}catch{return await async function(e){const{ethQuery:t,fetchEthGasPriceEstimate:n}=e;return{gasFeeEstimates:await n(t),estimatedGasFeeTimeBounds:{},gasEstimateType:s.GAS_ESTIMATE_TYPES.ETH_GASPRICE}}(e)}}(e)}catch(e){if(e instanceof Error)throw new Error(`Gas fee/price estimation failed. Message: ${e.message}`);throw e}}}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/determineGasFeeCalculations.cjs"}],[3498,{"@metamask/controller-utils":1639,"bn.js":4413},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTimeEstimate=n.fetchEthGasPriceEstimate=n.fetchLegacyGasPriceEstimates=n.fetchGasEstimates=n.normalizeGWEIDecimalNumbers=void 0;const a=e("@metamask/controller-utils"),r=s(e("bn.js")),i=e=>({"X-Client-Id":e});function o(e){const t=(0,a.gweiDecToWEIBN)(e).toString(16);return(0,a.weiHexToGweiDec)(t)}n.normalizeGWEIDecimalNumbers=o,n.fetchGasEstimates=async function(e,t){const n=await(0,a.handleFetch)(e,t?{headers:i(t)}:undefined);return{low:{...n.low,suggestedMaxPriorityFeePerGas:o(n.low.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.low.suggestedMaxFeePerGas)},medium:{...n.medium,suggestedMaxPriorityFeePerGas:o(n.medium.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.medium.suggestedMaxFeePerGas)},high:{...n.high,suggestedMaxPriorityFeePerGas:o(n.high.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.high.suggestedMaxFeePerGas)},estimatedBaseFee:o(n.estimatedBaseFee),historicalBaseFeeRange:n.historicalBaseFeeRange,baseFeeTrend:n.baseFeeTrend,latestPriorityFeeRange:n.latestPriorityFeeRange,historicalPriorityFeeRange:n.historicalPriorityFeeRange,priorityFeeTrend:n.priorityFeeTrend,networkCongestion:n.networkCongestion}},n.fetchLegacyGasPriceEstimates=async function(e,t){const n=await(0,a.handleFetch)(e,{referrer:e,referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors",headers:{"Content-Type":"application/json",...t&&i(t)}});return{low:n.SafeGasPrice,medium:n.ProposeGasPrice,high:n.FastGasPrice}},n.fetchEthGasPriceEstimate=async function(e){const t=await(0,a.query)(e,"gasPrice");return{gasPrice:(0,a.weiHexToGweiDec)(t).toString()}},n.calculateTimeEstimate=function(e,t,n){const{low:s,medium:i,high:o,estimatedBaseFee:c}=n,u=(0,a.gweiDecToWEIBN)(e),l=(0,a.gweiDecToWEIBN)(t),d=(0,a.gweiDecToWEIBN)(c),f=r.default.min(u,l.sub(d)),h=(0,a.gweiDecToWEIBN)(s.suggestedMaxPriorityFeePerGas),m=(0,a.gweiDecToWEIBN)(i.suggestedMaxPriorityFeePerGas),p=(0,a.gweiDecToWEIBN)(o.suggestedMaxPriorityFeePerGas);let g,b;return f.lt(h)?(g=null,b="unknown"):f.gte(h)&&f.lt(m)?(g=s.minWaitTimeEstimate,b=s.maxWaitTimeEstimate):f.gte(m)&&f.lt(p)?(g=i.minWaitTimeEstimate,b=i.maxWaitTimeEstimate):f.eq(p)?(g=o.minWaitTimeEstimate,b=o.maxWaitTimeEstimate):(g=0,b=o.maxWaitTimeEstimate),{lowerTimeBound:g,upperTimeBound:b}}}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/gas-util.cjs"}],[3499,{"./GasFeeController.cjs":3496},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./GasFeeController.cjs"),n)}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/index.cjs"}],[3500,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,r=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,h=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,s=1,a=e.length,r=e[0]+"";s<a;){for(t=e[s++]+"",n=u-t.length;n--;t="0"+t);r+=t}for(a=r.length;48===r.charCodeAt(--a););return r.slice(0,a+1||1)}function g(e,t){var n,s,a=e.c,r=t.c,i=e.s,o=t.s,c=e.e,u=t.e;if(!i||!o)return null;if(n=a&&!a[0],s=r&&!r[0],n||s)return n?s?0:-o:i;if(i!=o)return i;if(n=i<0,s=c==u,!a||!r)return s?0:!a^n?1:-1;if(!s)return c>u^n?1:-1;for(o=(c=a.length)<(u=r.length)?c:u,i=0;i<o;i++)if(a[i]!=r[i])return a[i]>r[i]^n?1:-1;return c==u?0:c>u^n?1:-1}function b(e,t,n,s){if(e<t||e>n||e!==r(e))throw Error(i+(s||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function y(e){var t=e.c.length-1;return m(e.e/u)==t&&e.c[t]%2!=0}function w(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function T(e,t,n){var s,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(s=e.length)){for(a=n,t-=s;--t;a+=n);e+=a}else t<s&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,S,E,k,P,v,I,_,A,C,j=q.prototype={constructor:q,toString:null,valueOf:null},x=new q(1),R=20,O=4,F=-7,N=21,M=-1e7,L=1e7,G=!1,D=1,B=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",$=!0;function q(e,t){var n,a,i,c,d,f,h,m,p=this;if(!(p instanceof q))return new q(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>L?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>L?p.c=p.e=null:(p.e=c,p.c=[e]))}m=String(e)}else{if(!s.test(m=String(e)))return E(p,m,f);p.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(b(t,2,H.length,"Base"),10==t&&$)return V(p=new q(e),R+p.e+1,O);if(m=String(e),f="number"==typeof e){if(0*e!=0)return E(p,m,f,t);if(p.s=1/e<0?(m=m.slice(1),-1):1,q.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,h=m.length;d<h;d++)if(n.indexOf(a=m.charAt(d))<0){if("."==a){if(d>c){c=h;continue}}else if(!i&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){i=!0,d=-1,c=0;continue}return E(p,String(e),f,t)}f=!1,(c=(m=S(m,t,10,p.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(h=m.length;48===m.charCodeAt(--h););if(m=m.slice(d,++h)){if(h-=d,f&&q.DEBUG&&h>15&&(e>l||e!==r(e)))throw Error(o+p.s*e);if((c=c-d-1)>L)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%u,c<0&&(d+=u),d<h){for(d&&p.c.push(+m.slice(0,d)),h-=u;d<h;)p.c.push(+m.slice(d,d+=u));d=u-(m=m.slice(d)).length}else d-=h;for(;d--;m+="0");p.c.push(+m)}}else p.c=[p.e=0]}function K(e,t,n,s){var a,r,i,o,c;if(null==n?n=O:b(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=p(e.c),c=1==s||2==s&&(i<=F||i>=N)?w(c,i):T(c,i,"0");else if(r=(e=V(new q(e),t,n)).e,o=(c=p(e.c)).length,1==s||2==s&&(t<=r||r<=F)){for(;o<t;c+="0",o++);c=w(c,r)}else if(t-=i,c=T(c,r,"0"),r+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=r-o)>0)for(r+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function W(e,t){for(var n,s,a=1,r=new q(e[0]);a<e.length;a++)(!(s=new q(e[a])).s||(n=g(r,s))===t||0===n&&r.s===t)&&(r=s);return r}function z(e,t,n){for(var s=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,s++);return(n=s+n*u-1)>L?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function V(e,t,n,s){var i,o,l,f,h,m,p,g=e.c,b=d;if(g){e:{for(i=1,f=g[0];f>=10;f/=10,i++);if((o=t-i)<0)o+=u,l=t,h=g[m=0],p=r(h/b[i-l-1]%10);else if((m=a((o+1)/u))>=g.length){if(!s)break e;for(;g.length<=m;g.push(0));h=p=0,i=1,l=(o%=u)-u+1}else{for(h=f=g[m],i=1;f>=10;f/=10,i++);p=(l=(o%=u)-u+i)<0?0:r(h/b[i-l-1]%10)}if(s=s||t<0||null!=g[m+1]||(l<0?h:h%b[i-l-1]),s=n<4?(p||s)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||s||6==n&&(o>0?l>0?h/b[i-l]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,s?(t-=e.e+1,g[0]=b[(u-t%u)%u],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,f=1,m--):(g.length=m+1,f=b[u-o],g[m]=l>0?r(h/b[i-l]%b[l])*f:0),s)for(;;){if(0==m){for(o=1,l=g[0];l>=10;l/=10,o++);for(l=g[0]+=f,f=1;l>=10;l/=10,f++);o!=f&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=f,g[m]!=c)break;g[m--]=0,f=1}for(o=g.length;0===g[--o];g.pop());}e.e>L?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function J(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=F||n>=N?w(t,n):T(t,n,"0"),e.s<0?"-"+t:t)}return q.clone=e,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(b(n=e[t],0,h,t),R=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(b(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(b(n[0],-h,0,t),b(n[1],0,h,t),F=n[0],N=n[1]):(b(n,-h,h,t),F=-(N=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)b(n[0],-h,-1,t),b(n[1],1,h,t),M=n[0],L=n[1];else{if(b(n,-h,h,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(L=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw G=!n,Error(i+"crypto unavailable");G=n}else G=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(b(n=e[t],0,9,t),D=n),e.hasOwnProperty(t="POW_PRECISION")&&(b(n=e[t],0,h,t),B=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);$="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:R,ROUNDING_MODE:O,EXPONENTIAL_AT:[F,N],RANGE:[M,L],CRYPTO:G,MODULO_MODE:D,POW_PRECISION:B,FORMAT:U,ALPHABET:H}},q.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!q.DEBUG)return!0;var t,n,s=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(s)){if((1===o||-1===o)&&a>=-h&&a<=h&&a===r(a)){if(0===s[0]){if(0===a&&1===s.length)return!0;break e}if((t=(a+1)%u)<1&&(t+=u),String(s[0]).length==t){for(t=0;t<s.length;t++)if((n=s[t])<0||n>=c||n!==r(n))break e;if(0!==n)return!0}}}else if(null===s&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},q.maximum=q.max=function(){return W(arguments,-1)},q.minimum=q.min=function(){return W(arguments,1)},q.random=(k=9007199254740992,P=Math.random()*k&2097151?function(){return r(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,s,o,c,l=0,f=[],m=new q(x);if(null==e?e=R:b(e,0,h),o=a(e/u),G)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));l<o;)(c=131072*t[l]+(t[l+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[l]=n[0],t[l+1]=n[1]):(f.push(c%1e14),l+=2);l=o/2}else{if(!crypto.randomBytes)throw G=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);l<o;)(c=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(f.push(c%1e14),l+=7);l=o/7}if(!G)for(;l<o;)(c=P())<9e15&&(f[l++]=c%1e14);for(o=f[--l],e%=u,o&&e&&(c=d[u-e],f[l]=r(o/c)*c);0===f[l];f.pop(),l--);if(l<0)f=[s=0];else{for(s=-1;0===f[0];f.splice(0,1),s-=u);for(l=1,c=f[0];c>=10;c/=10,l++);l<u&&(s-=u-l)}return m.e=s,m.c=f,m}),q.sum=function(){for(var e=1,t=arguments,n=new q(t[0]);e<t.length;)n=n.plus(t[e++]);return n},S=function(){var e="0123456789";function t(e,t,n,s){for(var a,r,i=[0],o=0,c=e.length;o<c;){for(r=i.length;r--;i[r]*=t);for(i[0]+=s.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(s,a,r,i,o){var c,u,l,d,f,h,m,g,b=s.indexOf("."),y=R,w=O;for(b>=0&&(d=B,B=0,s=s.replace(".",""),h=(g=new q(a)).pow(s.length-b),B=d,g.c=t(T(p(h.c),h.e,"0"),10,r,e),g.e=g.c.length),l=d=(m=t(s,a,r,o?(c=H,e):(c=e,H))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(b<0?--l:(h.c=m,h.e=l,h.s=i,m=(h=n(h,g,y,w,r)).c,f=h.r,l=h.e),b=m[u=l+y+1],d=r/2,f=f||u<0||null!=m[u+1],f=w<4?(null!=b||f)&&(0==w||w==(h.s<0?3:2)):b>d||b==d&&(4==w||f||6==w&&1&m[u-1]||w==(h.s<0?8:7)),u<1||!m[0])s=f?T(c.charAt(1),-y,c.charAt(0)):c.charAt(0);else{if(m.length=u,f)for(--r;++m[--u]>r;)m[u]=0,u||(++l,m=[1].concat(m));for(d=m.length;!m[--d];);for(b=0,s="";b<=d;s+=c.charAt(m[b++]));s=T(s,l,c.charAt(0))}return s}}(),n=function(){function e(e,t,n){var s,a,r,i,o=0,c=e.length,u=t%f,l=t/f|0;for(e=e.slice();c--;)o=((a=u*(r=e[c]%f)+(s=l*r+(i=e[c]/f|0)*u)%f*f+o)/n|0)+(s/f|0)+l*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,s){var a,r;if(n!=s)r=n>s?1:-1;else for(a=r=0;a<n;a++)if(e[a]!=t[a]){r=e[a]>t[a]?1:-1;break}return r}function n(e,t,n,s){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*s+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(s,a,i,o,l){var d,f,h,p,g,b,y,w,T,S,E,k,P,v,I,_,A,C=s.s==a.s?1:-1,j=s.c,x=a.c;if(!(j&&j[0]&&x&&x[0]))return new q(s.s&&a.s&&(j?!x||j[0]!=x[0]:x)?j&&0==j[0]||!x?0*C:C/0:NaN);for(T=(w=new q(C)).c=[],C=i+(f=s.e-a.e)+1,l||(l=c,f=m(s.e/u)-m(a.e/u),C=C/u|0),h=0;x[h]==(j[h]||0);h++);if(x[h]>(j[h]||0)&&f--,C<0)T.push(1),p=!0;else{for(v=j.length,_=x.length,h=0,C+=2,(g=r(l/(x[0]+1)))>1&&(x=e(x,g,l),j=e(j,g,l),_=x.length,v=j.length),P=_,E=(S=j.slice(0,_)).length;E<_;S[E++]=0);A=x.slice(),A=[0].concat(A),I=x[0],x[1]>=l/2&&I++;do{if(g=0,(d=t(x,S,_,E))<0){if(k=S[0],_!=E&&(k=k*l+(S[1]||0)),(g=r(k/I))>1)for(g>=l&&(g=l-1),y=(b=e(x,g,l)).length,E=S.length;1==t(b,S,y,E);)g--,n(b,_<y?A:x,y,l),y=b.length,d=1;else 0==g&&(d=g=1),y=(b=x.slice()).length;if(y<E&&(b=[0].concat(b)),n(S,b,E,l),E=S.length,-1==d)for(;t(x,S,_,E)<1;)g++,n(S,_<E?A:x,E,l),E=S.length}else 0===d&&(g++,S=[0]);T[h++]=g,S[0]?S[E++]=j[P]||0:(S=[j[P]],E=1)}while((P++<v||null!=S[0])&&C--);p=null!=S[0],T[0]||T.splice(0,1)}if(l==c){for(h=1,C=T[0];C>=10;C/=10,h++);V(w,i+(w.e=h+f*u-1)+1,o,p)}else w.e=f,w.r=+p;return w}}(),v=/^(-?)0([xbo])(?=\w[\w.]*$)/i,I=/^([^.]+)\.$/,_=/^\.([^.]+)$/,A=/^-?(Infinity|NaN)$/,C=/^\s*\+(?=[\w.])|^\s+|\s+$/g,E=function(e,t,n,s){var a,r=n?t:t.replace(C,"");if(A.test(r))e.s=isNaN(r)?null:r<0?-1:1;else{if(!n&&(r=r.replace(v,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,s&&s!=a?e:t}),s&&(a=s,r=r.replace(I,"$1").replace(_,"0.$1")),t!=r))return new q(r,a);if(q.DEBUG)throw Error(i+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},j.absoluteValue=j.abs=function(){var e=new q(this);return e.s<0&&(e.s=1),e},j.comparedTo=function(e,t){return g(this,new q(e,t))},j.decimalPlaces=j.dp=function(e,t){var n,s,a,r=this;if(null!=e)return b(e,0,h),null==t?t=O:b(t,0,8),V(new q(r),e+r.e+1,t);if(!(n=r.c))return null;if(s=((a=n.length-1)-m(this.e/u))*u,a=n[a])for(;a%10==0;a/=10,s--);return s<0&&(s=0),s},j.dividedBy=j.div=function(e,t){return n(this,new q(e,t),R,O)},j.dividedToIntegerBy=j.idiv=function(e,t){return n(this,new q(e,t),0,1)},j.exponentiatedBy=j.pow=function(e,t){var n,s,o,c,l,d,f,h,m=this;if((e=new q(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+J(e));if(null!=t&&(t=new q(t)),l=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return h=new q(Math.pow(+J(m),l?e.s*(2-y(e)):+J(e))),t?h.mod(t):h;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new q(NaN);(s=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||l&&m.c[1]>=24e7:m.c[0]<8e13||l&&m.c[0]<=9999975e7)))return c=m.s<0&&y(e)?-0:0,m.e>-1&&(c=1/c),new q(d?1/c:c);B&&(c=a(B/u+2))}for(l?(n=new q(.5),d&&(e.s=1),f=y(e)):f=(o=Math.abs(+J(e)))%2,h=new q(x);;){if(f){if(!(h=h.times(m)).c)break;c?h.c.length>c&&(h.c.length=c):s&&(h=h.mod(t))}if(o){if(0===(o=r(o/2)))break;f=o%2}else if(V(e=e.times(n),e.e+1,1),e.e>14)f=y(e);else{if(0===(o=+J(e)))break;f=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):s&&(m=m.mod(t))}return s?h:(d&&(h=x.div(h)),t?h.mod(t):c?V(h,B,O,undefined):h)},j.integerValue=function(e){var t=new q(this);return null==e?e=O:b(e,0,8),V(t,t.e+1,e)},j.isEqualTo=j.eq=function(e,t){return 0===g(this,new q(e,t))},j.isFinite=function(){return!!this.c},j.isGreaterThan=j.gt=function(e,t){return g(this,new q(e,t))>0},j.isGreaterThanOrEqualTo=j.gte=function(e,t){return 1===(t=g(this,new q(e,t)))||0===t},j.isInteger=function(){return!!this.c&&m(this.e/u)>this.c.length-2},j.isLessThan=j.lt=function(e,t){return g(this,new q(e,t))<0},j.isLessThanOrEqualTo=j.lte=function(e,t){return-1===(t=g(this,new q(e,t)))||0===t},j.isNaN=function(){return!this.s},j.isNegative=function(){return this.s<0},j.isPositive=function(){return this.s>0},j.isZero=function(){return!!this.c&&0==this.c[0]},j.minus=function(e,t){var n,s,a,r,i=this,o=i.s;if(t=(e=new q(e,t)).s,!o||!t)return new q(NaN);if(o!=t)return e.s=-t,i.plus(e);var l=i.e/u,d=e.e/u,f=i.c,h=e.c;if(!l||!d){if(!f||!h)return f?(e.s=-t,e):new q(h?i:NaN);if(!f[0]||!h[0])return h[0]?(e.s=-t,e):new q(f[0]?i:3==O?-0:0)}if(l=m(l),d=m(d),f=f.slice(),o=l-d){for((r=o<0)?(o=-o,a=f):(d=l,a=h),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(s=(r=(o=f.length)<(t=h.length))?o:t,o=t=0;t<s;t++)if(f[t]!=h[t]){r=f[t]<h[t];break}if(r&&(a=f,f=h,h=a,e.s=-e.s),(t=(s=h.length)-(n=f.length))>0)for(;t--;f[n++]=0);for(t=c-1;s>o;){if(f[--s]<h[s]){for(n=s;n&&!f[--n];f[n]=t);--f[n],f[s]+=c}f[s]-=h[s]}for(;0==f[0];f.splice(0,1),--d);return f[0]?z(e,f,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},j.modulo=j.mod=function(e,t){var s,a,r=this;return e=new q(e,t),!r.c||!e.s||e.c&&!e.c[0]?new q(NaN):!e.c||r.c&&!r.c[0]?new q(r):(9==D?(a=e.s,e.s=1,s=n(r,e,0,3),e.s=a,s.s*=a):s=n(r,e,0,D),(e=r.minus(s.times(e))).c[0]||1!=D||(e.s=r.s),e)},j.multipliedBy=j.times=function(e,t){var n,s,a,r,i,o,l,d,h,p,g,b,y,w,T,S=this,E=S.c,k=(e=new q(e,t)).c;if(!(E&&k&&E[0]&&k[0]))return!S.s||!e.s||E&&!E[0]&&!k||k&&!k[0]&&!E?e.c=e.e=e.s=null:(e.s*=S.s,E&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(s=m(S.e/u)+m(e.e/u),e.s*=S.s,(l=E.length)<(p=k.length)&&(y=E,E=k,k=y,a=l,l=p,p=a),a=l+p,y=[];a--;y.push(0));for(w=c,T=f,a=p;--a>=0;){for(n=0,g=k[a]%T,b=k[a]/T|0,r=a+(i=l);r>a;)n=((d=g*(d=E[--i]%T)+(o=b*d+(h=E[i]/T|0)*g)%T*T+y[r]+n)/w|0)+(o/T|0)+b*h,y[r--]=d%w;y[r]=n}return n?++s:y.splice(0,1),z(e,y,s)},j.negated=function(){var e=new q(this);return e.s=-e.s||null,e},j.plus=function(e,t){var n,s=this,a=s.s;if(t=(e=new q(e,t)).s,!a||!t)return new q(NaN);if(a!=t)return e.s=-t,s.minus(e);var r=s.e/u,i=e.e/u,o=s.c,l=e.c;if(!r||!i){if(!o||!l)return new q(a/0);if(!o[0]||!l[0])return l[0]?e:new q(o[0]?s:0*a)}if(r=m(r),i=m(i),o=o.slice(),a=r-i){for(a>0?(i=r,n=l):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=l.length)<0&&(n=l,l=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+l[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),z(e,o,i)},j.precision=j.sd=function(e,t){var n,s,a,r=this;if(null!=e&&e!==!!e)return b(e,1,h),null==t?t=O:b(t,0,8),V(new q(r),e,t);if(!(n=r.c))return null;if(s=(a=n.length-1)*u+1,a=n[a]){for(;a%10==0;a/=10,s--);for(a=n[0];a>=10;a/=10,s++);}return e&&r.e+1>s&&(s=r.e+1),s},j.shiftedBy=function(e){return b(e,-9007199254740991,l),this.times("1e"+e)},j.squareRoot=j.sqrt=function(){var e,t,s,a,r,i=this,o=i.c,c=i.s,u=i.e,l=R+4,d=new q("0.5");if(1!==c||!o||!o[0])return new q(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+J(i)))||c==1/0?(((t=p(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=m((u+1)/2)-(u<0||u%2),s=new q(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):s=new q(c+""),s.c[0])for((c=(u=s.e)+l)<3&&(c=0);;)if(r=s,s=d.times(r.plus(n(i,r,l,1))),p(r.c).slice(0,c)===(t=p(s.c)).slice(0,c)){if(s.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(V(s,s.e+R+2,1),e=!s.times(s).eq(i));break}if(!a&&(V(r,r.e+R+2,0),r.times(r).eq(i))){s=r;break}l+=4,c+=4,a=1}return V(s,s.e+R+1,O,e)},j.toExponential=function(e,t){return null!=e&&(b(e,0,h),e++),K(this,e,t,1)},j.toFixed=function(e,t){return null!=e&&(b(e,0,h),e=e+this.e+1),K(this,e,t)},j.toFormat=function(e,t,n){var s,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(s=a.toFixed(e,t),a.c){var r,o=s.split("."),c=+n.groupSize,u=+n.secondaryGroupSize,l=n.groupSeparator||"",d=o[0],f=o[1],h=a.s<0,m=h?d.slice(1):d,p=m.length;if(u&&(r=c,c=u,u=r,p-=r),c>0&&p>0){for(r=p%c||c,d=m.substr(0,r);r<p;r+=c)d+=l+m.substr(r,c);u>0&&(d+=l+m.slice(r)),h&&(d="-"+d)}s=f?d+(n.decimalSeparator||"")+((u=+n.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):f):d}return(n.prefix||"")+s+(n.suffix||"")},j.toFraction=function(e){var t,s,a,r,o,c,l,f,h,m,g,b,y=this,w=y.c;if(null!=e&&(!(l=new q(e)).isInteger()&&(l.c||1!==l.s)||l.lt(x)))throw Error(i+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+J(l));if(!w)return new q(y);for(t=new q(x),h=s=new q(x),a=f=new q(x),b=p(w),o=t.e=b.length-y.e-1,t.c[0]=d[(c=o%u)<0?u+c:c],e=!e||l.comparedTo(t)>0?o>0?t:h:l,c=L,L=1/0,l=new q(b),f.c[0]=0;m=n(l,t,0,1),1!=(r=s.plus(m.times(a))).comparedTo(e);)s=a,a=r,h=f.plus(m.times(r=h)),f=r,t=l.minus(m.times(r=t)),l=r;return r=n(e.minus(s),a,0,1),f=f.plus(r.times(h)),s=s.plus(r.times(a)),f.s=h.s=y.s,g=n(h,a,o*=2,O).minus(y).abs().comparedTo(n(f,s,o,O).minus(y).abs())<1?[h,a]:[f,s],L=c,g},j.toNumber=function(){return+J(this)},j.toPrecision=function(e,t){return null!=e&&b(e,1,h),K(this,e,t,2)},j.toString=function(e){var t,n=this,s=n.s,a=n.e;return null===a?s?(t="Infinity",s<0&&(t="-"+t)):t="NaN":(null==e?t=a<=F||a>=N?w(p(n.c),a):T(p(n.c),a,"0"):10===e&&$?t=T(p((n=V(new q(n),R+a+1,O)).c),n.e,"0"):(b(e,2,H.length,"Base"),t=S(T(p(n.c),a,"0"),10,e,s,!0)),s<0&&n.c[0]&&(t="-"+t)),t},j.valueOf=j.toJSON=function(){return J(this)},j._isBigNumber=!0,null!=t&&q.set(t),q}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/transaction-controller>bignumber.js",file:"node_modules/@metamask/transaction-controller/node_modules/bignumber.js/bignumber.js"}],[3501,{"./actions/update-payment-token.cjs":3502,"./constants.cjs":3503,"./helpers/QuoteRefresher.cjs":3504,"./utils/quotes.cjs":3518,"./utils/source-amounts.cjs":3520,"./utils/transaction.cjs":3524,"@metamask/base-controller":1520,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayController=void 0;const d=e("@metamask/base-controller"),f=e("lodash"),h=e("./actions/update-payment-token.cjs"),m=e("./constants.cjs"),p=e("./helpers/QuoteRefresher.cjs"),g=e("./utils/quotes.cjs"),b=e("./utils/source-amounts.cjs"),y=e("./utils/transaction.cjs"),w={transactionData:{includeInDebugSnapshot:!1,includeInStateLogs:!0,persist:!1,usedInUi:!0}};class T extends d.BaseController{constructor({getDelegationTransaction:e,getStrategy:t,messenger:n,state:d}){super({name:m.CONTROLLER_NAME,metadata:w,messenger:n,state:{transactionData:{},...d}}),s.add(this),a.set(this,void 0),r.set(this,void 0),u(this,a,e,"f"),u(this,r,t,"f"),l(this,s,"m",c).call(this),(0,y.pollTransactionChanges)(n,l(this,s,"m",o).bind(this),l(this,s,"m",i).bind(this)),new p.QuoteRefresher({messenger:n,updateTransactionData:l(this,s,"m",o).bind(this)})}setIsMaxAmount(e,t){l(this,s,"m",o).call(this,e,e=>{e.isMaxAmount=t})}updatePaymentToken(e){(0,h.updatePaymentToken)(e,{messenger:this.messenger,updateTransactionData:l(this,s,"m",o).bind(this)})}}n.TransactionPayController=T,a=new WeakMap,r=new WeakMap,s=new WeakSet,i=function(e){this.update(t=>{delete t.transactionData[e]})},o=function e(t,n){let a=!1;this.update(e=>{const{transactionData:s}=e;let r=s[t];const i=r?.paymentToken,o=r?.tokens,c=r?.isMaxAmount;r||(s[t]={isLoading:!1,tokens:[]},r=s[t]),n(r);const u=r.paymentToken!==i,l=r.tokens!==o,d=r.isMaxAmount!==c;(u||d||l)&&((0,b.updateSourceAmounts)(t,r,this.messenger),a=!0)}),a&&(0,g.updateQuotes)({messenger:this.messenger,transactionData:this.state.transactionData[t],transactionId:t,updateTransactionData:l(this,s,"m",e).bind(this)}).catch(f.noop)},c=function(){this.messenger.registerActionHandler("TransactionPayController:getDelegationTransaction",l(this,a,"f").bind(this)),this.messenger.registerActionHandler("TransactionPayController:getStrategy",l(this,r,"f")??(()=>m.TransactionPayStrategy.Relay)),this.messenger.registerActionHandler("TransactionPayController:setIsMaxAmount",this.setIsMaxAmount.bind(this)),this.messenger.registerActionHandler("TransactionPayController:updatePaymentToken",this.updatePaymentToken.bind(this))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/TransactionPayController.cjs"}],[3502,{"../logger.cjs":3507,"../utils/token.cjs":3522,"../utils/transaction.cjs":3524,"@metamask/utils":3554,"bignumber.js":3525},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePaymentToken=void 0;const s=e("@metamask/utils"),a=e("bignumber.js"),r=e("../logger.cjs"),i=e("../utils/token.cjs"),o=e("../utils/transaction.cjs"),c=(0,s.createModuleLogger)(r.projectLogger,"update-payment-token");n.updatePaymentToken=function(e,t){const{transactionId:n,tokenAddress:s,chainId:r}=e,{messenger:u,updateTransactionData:l}=t,d=(0,o.getTransaction)(n,u);if(!d)throw new Error("Transaction not found");const f=function({chainId:e,from:t,messenger:n,tokenAddress:s}){const{decimals:r,symbol:o}=(0,i.getTokenInfo)(n,s,e)??{};if(r===undefined||!o)return undefined;const c=(0,i.getTokenFiatRate)(n,s,e);if(c===undefined)return undefined;const u=(0,i.getTokenBalance)(n,t,e,s),l=new a.BigNumber(u),d=new a.BigNumber(u).shiftedBy(-r),f=l.toFixed(0),h=d.toString(10),m=d.multipliedBy(c.fiatRate).toString(10),p=d.multipliedBy(c.usdRate).toString(10);return{address:s,balanceFiat:m,balanceHuman:h,balanceRaw:f,balanceUsd:p,chainId:e,decimals:r,symbol:o}}({chainId:r,from:d?.txParams.from,messenger:u,tokenAddress:s});if(!f)throw new Error("Payment token not found");c("Updated payment token",{transactionId:n,paymentToken:f}),l(n,e=>{e.paymentToken=f})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/actions/update-payment-token.cjs"}],[3503,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayStrategy=n.POLYGON_USDCE_ADDRESS=n.ARBITRUM_USDC_ADDRESS=n.NATIVE_TOKEN_ADDRESS=n.CHAIN_ID_POLYGON=n.CHAIN_ID_ARBITRUM=n.CONTROLLER_NAME=void 0,n.CONTROLLER_NAME="TransactionPayController",n.CHAIN_ID_ARBITRUM="0xa4b1",n.CHAIN_ID_POLYGON="0x89",n.NATIVE_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000",n.ARBITRUM_USDC_ADDRESS="0xaf88d065e77c8cC2239327C5EDb3A432268e5831",n.POLYGON_USDCE_ADDRESS="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",function(e){e.Bridge="bridge",e.Relay="relay",e.Test="test"}(s||(n.TransactionPayStrategy=s={}))}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/constants.cjs"}],[3504,{"../logger.cjs":3507,"../utils/quotes.cjs":3518,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c,u,l,d,f,h,m=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteRefresher=void 0;const g=e("@metamask/utils"),b=e("lodash"),y=e("../logger.cjs"),w=e("../utils/quotes.cjs"),T=(0,g.createModuleLogger)(y.projectLogger,"quote-refresh");n.QuoteRefresher=class{constructor({messenger:e,updateTransactionData:t}){s.add(this),a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),m(this,i,e,"f"),m(this,a,!1,"f"),m(this,r,!1,"f"),m(this,c,t,"f"),e.subscribe("TransactionPayController:stateChange",p(this,s,"m",h).bind(this))}},a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,u=function(){m(this,a,!0,"f"),T("Started"),p(this,r,"f")||p(this,s,"m",f).call(this)},l=function(){p(this,o,"f")&&clearTimeout(p(this,o,"f")),m(this,a,!1,"f"),T("Stopped")},d=async function(){m(this,r,!0,"f");try{await(0,w.refreshQuotes)(p(this,i,"f"),p(this,c,"f"))}catch(e){T("Error refreshing quotes",e)}finally{m(this,r,!1,"f"),p(this,s,"m",f).call(this)}},f=function(){p(this,a,"f")&&(p(this,o,"f")&&clearTimeout(p(this,o,"f")),m(this,o,setTimeout(()=>{p(this,s,"m",d).call(this).catch(b.noop)},1e3),"f"))},h=function(e){const t=Object.values(e.transactionData).some(e=>Boolean(e.quotes?.length));t&&!p(this,a,"f")?p(this,s,"m",u).call(this):!t&&p(this,a,"f")&&p(this,s,"m",l).call(this)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/QuoteRefresher.cjs"}],[3505,{"../logger.cjs":3507,"../utils/strategy.cjs":3521,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=void 0;const l=e("@metamask/utils"),d=e("../logger.cjs"),f=e("../utils/strategy.cjs"),h=(0,l.createModuleLogger)(d.projectLogger,"pay-publish-hook"),m={transactionHash:undefined};n.TransactionPayPublishHook=class{constructor({isSmartTransaction:e,messenger:t}){s.add(this),a.set(this,void 0),r.set(this,void 0),c(this,a,e,"f"),c(this,r,t,"f")}getHook(){return u(this,s,"m",i).bind(this)}},a=new WeakMap,r=new WeakMap,s=new WeakSet,i=async function(e,t){try{return await u(this,s,"m",o).call(this,e,t)}catch(e){throw h("Error",e),e}},o=async function(e,t){const{id:n}=e,s=u(this,r,"f").call("TransactionPayController:getState"),i=s.transactionData?.[n]?.quotes??[];if(!i?.length)return h("Skipping as no quotes found"),m;const o=(0,f.getStrategy)(u(this,r,"f"),e);return await o.execute({isSmartTransaction:u(this,a,"f"),quotes:i,messenger:u(this,r,"f"),transaction:e})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/TransactionPayPublishHook.cjs"}],[3506,{"./TransactionPayController.cjs":3501,"./constants.cjs":3503,"./helpers/TransactionPayPublishHook.cjs":3505},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=n.TransactionPayController=n.TransactionPayStrategy=void 0;var s=e("./constants.cjs");Object.defineProperty(n,"TransactionPayStrategy",{enumerable:!0,get:function(){return s.TransactionPayStrategy}});var a=e("./TransactionPayController.cjs");Object.defineProperty(n,"TransactionPayController",{enumerable:!0,get:function(){return a.TransactionPayController}});var r=e("./helpers/TransactionPayPublishHook.cjs");Object.defineProperty(n,"TransactionPayPublishHook",{enumerable:!0,get:function(){return r.TransactionPayPublishHook}})}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/index.cjs"}],[3507,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}}),n.projectLogger=(0,s.createProjectLogger)("transaction-pay-controller")}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/logger.cjs"}],[3508,{"./bridge-quotes.cjs":3509,"./bridge-submit.cjs":3510},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStrategy=void 0;const s=e("./bridge-quotes.cjs"),a=e("./bridge-submit.cjs");n.BridgeStrategy=class{async getQuotes(e){return(0,s.getBridgeQuotes)(e)}async getBatchTransactions(e){return(0,s.getBridgeBatchTransactions)(e)}async getRefreshInterval(e){return(0,s.getBridgeRefreshInterval)(e)}async execute(e){const{isSmartTransaction:t,quotes:n,messenger:s,transaction:r}=e,i=r.txParams.from;return await(0,a.submitBridgeQuotes)({from:i,isSmartTransaction:t,messenger:s,quotes:n,transaction:r}),{transactionHash:undefined}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/BridgeStrategy.cjs"}],[3509,{"../../index.cjs":3506,"../../logger.cjs":3507,"../../utils/gas.cjs":3517,"../../utils/token.cjs":3522,"@metamask/bridge-controller":1527,"@metamask/controller-utils":1639,"@metamask/transaction-controller":3473,"@metamask/utils":3554,"bignumber.js":3525,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuote=n.getBridgeRefreshInterval=n.getBridgeBatchTransactions=n.getBridgeQuotes=void 0;const s=e("@metamask/bridge-controller"),a=e("@metamask/controller-utils"),r=e("@metamask/transaction-controller"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("lodash"),u=e("../../index.cjs"),l=e("../../logger.cjs"),d=e("../../utils/gas.cjs"),f=e("../../utils/token.cjs"),h="All quotes under minimum",m=new Map([[r.TransactionType.perpsDeposit,s.FeatureId.PERPS]]),p=(0,i.createModuleLogger)(l.projectLogger,"bridge-strategy");function g(e){return{data:e.data,gas:e.gasLimit?(0,a.toHex)(e.gasLimit):undefined,isAfter:!1,to:e.to,value:e.value}}async function b(e,t,n){const{from:s,slippage:r,sourceChainId:i,sourceTokenAddress:u,sourceTokenAmount:l,targetChainId:d,targetTokenAddress:f}=e,{type:g}=n,b=m.get(g),y={destChainId:d,destTokenAddress:(0,a.toChecksumHexAddress)(f),destWalletAddress:s,gasIncluded:!1,gasIncluded7702:!1,insufficientBal:!1,slippage:100*r,srcChainId:i,srcTokenAddress:(0,a.toChecksumHexAddress)(u),srcTokenAmount:l,walletAddress:s},w=await t.call("BridgeController:fetchQuotes",y,undefined,b);if(!w.length)throw new Error("No quotes found");const T=function(e,t){const n=(0,c.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc").slice(0,3),s=n.filter(e=>new o.BigNumber(e.quote.minDestTokenAmount).isGreaterThanOrEqualTo(t.targetAmountMinimum));if(p("Finding best quote",{allQuotes:e,fastestQuotes:n,quotesOverMinimumTarget:s}),!s.length)throw new Error(h);return(0,c.orderBy)(s,e=>(0,o.BigNumber)(e.quote.minDestTokenAmount).toNumber(),"desc")[0]}(w,e);return{...T,request:e}}function y(e,t,n,s){const a=new o.BigNumber(e).shiftedBy(-t),r=a.toString(10),i=a.multipliedBy(s).toString(10);return{fiat:a.multipliedBy(n).toString(10),human:r,raw:e,usd:i}}function w(e,t,{isMax:n=!1}={}){const{approval:s,trade:a}=e,r=s?T(s,t,{isMax:n}):{fiat:"0",human:"0",raw:"0",usd:"0"},i=T(a,t,{isMax:n});return{fiat:new o.BigNumber(r.fiat).plus(i.fiat).toString(10),human:new o.BigNumber(r.human).plus(i.human).toString(10),raw:new o.BigNumber(r.raw).plus(i.raw).toString(10),usd:new o.BigNumber(r.usd).plus(i.usd).toString(10)}}function T(e,t,{isMax:n}){const{effectiveGas:s,gasLimit:a}=e,r=n?undefined:s;return(0,d.calculateGasCost)({...e,gas:r??a??"0x0",messenger:t,isMax:n})}n.getBridgeQuotes=async function(e){p("Fetching quotes",e);const{requests:t,messenger:n,transaction:s}=e;try{const a=function(e,t){const n=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay;return{attemptsMax:t?.attemptsMax??5,bufferInitial:t?.bufferInitial??.04,bufferStep:t?.bufferStep??.04,bufferSubsequent:t?.bufferSubsequent??.05,slippage:t?.slippage??.005}}(t);return e.map(e=>({...e,...n})).map((t,n)=>{const s=0===n,a=s?t.attemptsMax:1,r=e.reduce((e,a,r)=>{const i=a.sourceTokenAddress.toLowerCase()===t.sourceTokenAddress.toLowerCase()&&a.sourceChainId===t.sourceChainId;return s&&r>n&&i?e.minus(a.sourceTokenAmount):e},new o.BigNumber(t.sourceBalanceRaw)).toFixed(0);return{...t,attemptsMax:a,sourceBalanceRaw:r}})}(t,n),r=await Promise.all(a.map((t,n)=>async function(e,t,n){const{attemptsMax:s,bufferInitial:a,bufferStep:r,bufferSubsequent:i,sourceBalanceRaw:c,sourceTokenAmount:u,targetAmountMinimum:l,targetTokenAddress:d}=e,f=new o.BigNumber(u),m=0===t?a:i,g=f.div(1+m),y=Date.now();let w=u;for(let t=0;t<s;t++){const i={...e,sourceTokenAmount:w};try{p("Attempt",{attempt:t+1,attemptsMax:s,bufferInitial:a,bufferStep:r,currentSourceAmount:w,target:d});const e=await b(i,n.messenger,n.transaction),c=new o.BigNumber(e.quote.minDestTokenAmount).minus(l).toString(10);return p("Found valid quote",{attempt:t+1,target:d,targetAmount:e.quote.minDestTokenAmount,goalAmount:l,dust:c,quote:e}),{...e,metrics:{attempts:t+1,buffer:m+r*t,latency:Date.now()-y}}}catch(e){if(e.message!==h)throw e}if(new o.BigNumber(w).isGreaterThanOrEqualTo(c)){p("Reached balance limit",{targetTokenAddress:d,sourceBalanceRaw:c,currentSourceAmount:w,attempt:t+1});break}const u=g.multipliedBy(1+m+r*(t+1));w=u.isLessThan(c)?u.toFixed(0):c}throw p("All attempts failed",d),new Error(h)}(t,n,e)));return r.map((e,t)=>function(e,t,n,s){const a=(0,f.getTokenFiatRate)(n,t.sourceTokenAddress,t.sourceChainId);if(a===undefined)throw new Error(`Fiat rate not found for source token - Chain ID: ${t.sourceChainId}, Address: ${t.sourceTokenAddress}`);const r=(0,f.getTokenFiatRate)(n,t.targetTokenAddress,t.targetChainId);if(r===undefined)throw new Error(`Fiat rate not found for target token - Chain ID: ${t.targetChainId}, Address: ${t.targetTokenAddress}`);const i=y(e.quote.minDestTokenAmount,e.quote.destAsset.decimals,r.fiatRate,r.usdRate),c=y(e.quote.srcTokenAmount,e.quote.srcAsset.decimals,a.fiatRate,a.usdRate),l=y(t.targetAmountMinimum,e.quote.destAsset.decimals,r.fiatRate,r.usdRate),h=(0,d.calculateTransactionGasCost)(s,n),m={estimate:w(e,n),max:w(e,n,{isMax:!0})};return{estimatedDuration:e.estimatedProcessingTimeInSeconds,dust:{fiat:new o.BigNumber(i.fiat).minus(l.fiat).toString(10),usd:new o.BigNumber(i.usd).minus(l.usd).toString(10)},fees:{provider:{fiat:new o.BigNumber(c.fiat).minus(i.fiat).toString(10),usd:new o.BigNumber(c.usd).minus(i.usd).toString(10)},sourceNetwork:m,targetNetwork:h},original:e,request:t,sourceAmount:c,targetAmount:l,strategy:u.TransactionPayStrategy.Bridge}}(e,a[t],n,s))}catch(e){throw p("Error fetching quotes",{error:e}),new Error(`Failed to fetch bridge quotes: ${String(e)}`)}},n.getBridgeBatchTransactions=async function(e){const{quotes:t}=e,n=t[0]?.original?.quote;return n?.srcChainId!==n?.destChainId?(p("No batch transactions needed for bridge quotes"),[]):t.map(e=>e.original).flatMap(e=>{const t=[];return e.approval&&t.push({...g(e.approval),type:r.TransactionType.swapApproval}),t.push({...g(e.trade),type:r.TransactionType.swap}),t})},n.getBridgeRefreshInterval=function(e){const{chainId:t,messenger:n}=e,s=n.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.bridgeConfigV2,a=s?.chains?.[parseInt(t,16)]?.refreshRate,r=s?.refreshRate;return a??r},n.refreshQuote=async function(e,t,n){const s=await b({...e.original.request,attemptsMax:1},t,n);return p("Refreshed quote",{old:e,new:s}),s}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-quotes.cjs"}],[351,{"../../../../shared/constants/metametrics":6190,"../segment/early-segment-tracking":336},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.trackVaultCorruptionEvent=function(e,t,n){(0,a.trackEarlySegmentEvent)({state:e,event:t,category:s.MetaMetricsEventCategory.Error,properties:{error_type:n}})};var s=e("../../../../shared/constants/metametrics"),a=e("../segment/early-segment-tracking")}}},{package:"$root$",file:"app/scripts/lib/state-corruption/track-vault-corruption.ts"}],[3510,{"../../logger.cjs":3507,"../../utils/transaction.cjs":3524,"./bridge-quotes.cjs":3509,"@metamask/bridge-controller":1527,"@metamask/controller-utils":1639,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitBridgeQuotes=void 0;const s=e("@metamask/bridge-controller"),a=e("@metamask/controller-utils"),r=e("@metamask/utils"),i=e("lodash"),o=e("./bridge-quotes.cjs"),c=e("../../logger.cjs"),u=e("../../utils/transaction.cjs"),l=(0,r.createModuleLogger)(c.projectLogger,"bridge-strategy");async function d(e,t){const{isSmartTransaction:n,messenger:r,from:o,transaction:c}=e,d=(0,i.cloneDeep)(t),f=(0,a.toHex)(d.quote.srcChainId),h=n(f),m=[],p=(0,u.collectTransactionIds)(f,o,r,e=>(0,u.updateTransaction)({transactionId:c.id,messenger:r,note:"Add required transaction ID"},t=>{t.requiredTransactionIds??(t.requiredTransactionIds=[]),t?.requiredTransactionIds.push(e),m.push(e)})),g={amount:"0",valueInCurrency:null,usd:null},b={gasFee:{effective:g,max:g,total:g},totalNetworkFee:g,totalMaxNetworkFee:g,toTokenAmount:g,minToTokenAmount:g,adjustedReturn:g,sentAmount:g,swapRate:"0",cost:g},y=await r.call("BridgeStatusController:submitTx",o,{...d,...b},h);p.end(),l("Bridge transaction submitted",{requiredTransactionIds:m,result:y}),await Promise.all(m.map(e=>(0,u.waitForTransactionConfirmed)(e,r))),l("All required transactions confirmed",m);const{id:w}=y;l("Waiting for bridge completion",w),await async function(e,t){return new Promise((n,a)=>{const r=(e,t)=>{const r=e?.status?.status;return l("Checking bridge status",r??"missing"),r===s.StatusTypes.COMPLETE?(t?.(),n(),!0):r===s.StatusTypes.FAILED&&(t?.(),a(new Error("Bridge failed")),!0)},i=t.call("BridgeStatusController:getState").txHistory[e];if(r(i))return;const o=e=>{r(e,()=>t.unsubscribe("BridgeStatusController:stateChange",o))};t.subscribe("BridgeStatusController:stateChange",o,t=>t.txHistory[e])})}(w,r)}n.submitBridgeQuotes=async function(e){const{quotes:t,messenger:n,transaction:s}=e;if(!t?.length)return void l("No quotes found");if(t[0].original.quote.srcChainId===t[0].original.quote.destChainId)return void l("Ignoring quotes as source is same chain",t[0].original.quote.srcChainId);let a=0;for(const r of t){l("Submitting bridge",a,r);let t=r.original;if(a>0)try{t=await(0,o.refreshQuote)(r,n,s)}catch(e){l("Failed to refresh subsequent quote before submit",e)}await d(e,t),a+=1}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-submit.cjs"}],[3511,{"./relay-quotes.cjs":3513,"./relay-submit.cjs":3514},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStrategy=void 0;const s=e("./relay-quotes.cjs"),a=e("./relay-submit.cjs");n.RelayStrategy=class{async getQuotes(e){return(0,s.getRelayQuotes)(e)}async execute(e){return await(0,a.submitRelayQuotes)(e)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/RelayStrategy.cjs"}],[3512,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_TRANSFER_FOUR_BYTE=n.RELAY_POLLING_INTERVAL=n.RELAY_STATUS_URL=n.RELAY_URL_BASE=n.CHAIN_ID_HYPERCORE=void 0,n.CHAIN_ID_HYPERCORE="0x539",n.RELAY_URL_BASE="https://api.relay.link",n.RELAY_STATUS_URL=`${n.RELAY_URL_BASE}/intents/status/v3`,n.RELAY_POLLING_INTERVAL=1e3,n.TOKEN_TRANSFER_FOUR_BYTE="0xa9059cbb"}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/constants.cjs"}],[3513,{"../../constants.cjs":3503,"../../index.cjs":3506,"../../logger.cjs":3507,"../../utils/feature-flags.cjs":3516,"../../utils/gas.cjs":3517,"../../utils/token.cjs":3522,"./constants.cjs":3512,"@ethersproject/abi":763,"@metamask/controller-utils":1639,"@metamask/utils":3554,"bignumber.js":3525},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRelayQuotes=void 0;const s=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),r=e("@metamask/utils"),i=e("bignumber.js"),o=e("./constants.cjs"),c=e("../../index.cjs"),u=e("../../constants.cjs"),l=e("../../logger.cjs"),d=e("../../utils/feature-flags.cjs"),f=e("../../utils/gas.cjs"),h=e("../../utils/token.cjs"),m=(0,r.createModuleLogger)(l.projectLogger,"relay-strategy");function p(e,t){const n=e.multipliedBy(t);return{usd:e.toString(10),fiat:n.toString(10)}}function g(e,t){return new s.Interface(["function transfer(address to, uint256 amount)"]).encodeFunctionData("transfer",[e,t])}function b(e){return new s.Interface(["function transfer(address to, uint256 amount)"]).decodeFunctionData("transfer",e).to.toLowerCase()}n.getRelayQuotes=async function(e){const{requests:t}=e;m("Fetching quotes",t);try{const n=t.filter(e=>"0"!==e.targetAmountMinimum).map(e=>function(e){const t={...e},n=e.targetChainId===u.CHAIN_ID_ARBITRUM&&e.targetTokenAddress.toLowerCase()===u.ARBITRUM_USDC_ADDRESS.toLowerCase(),s=e.sourceChainId===u.CHAIN_ID_POLYGON&&e.sourceTokenAddress===(0,h.getNativeToken)(e.sourceChainId);s&&(t.sourceTokenAddress=u.NATIVE_TOKEN_ADDRESS);n&&(t.targetChainId=o.CHAIN_ID_HYPERCORE,t.targetTokenAddress="0x00000000000000000000000000000000",t.targetAmountMinimum=new i.BigNumber(e.targetAmountMinimum).shiftedBy(2).toString(10),m("Converting Arbitrum Hyperliquid deposit to direct deposit",{originalRequest:e,normalizedRequest:t}));return t}(e));return m("Normalized requests",n),await Promise.all(n.map(t=>async function(e,t){const{messenger:n,transaction:s}=t,{slippage:r}=(0,d.getFeatureFlags)(n),l=new i.BigNumber(100*r*100).toFixed(0),{from:y,isMaxAmount:w,sourceChainId:T,sourceTokenAddress:S,sourceTokenAmount:E,targetAmountMinimum:k,targetChainId:P,targetTokenAddress:v}=e;try{const r={amount:w?E:k,destinationChainId:Number(P),destinationCurrency:v,originChainId:Number(T),originCurrency:S,recipient:y,slippageTolerance:l,tradeType:w?"EXACT_INPUT":"EXPECTED_OUTPUT",user:y};await async function(e,t,n,s){const{nestedTransactions:a,txParams:r}=e,{isMaxAmount:i,targetChainId:c}=t,u=r?.data,l=1===a?.length?a[0].data:u,d=c===o.CHAIN_ID_HYPERCORE,f=!d&&Boolean(l?.startsWith(o.TOKEN_TRANSFER_FOUR_BYTE));f&&(n.recipient=b(l),m("Updating recipient as token transfer",n.recipient));const h=l===undefined||"0x"===l;if(h||f||d)return void m("Skipping delegation as token transfer or Hypercore deposit");if(i)throw new Error("Max amount quotes do not support included transactions");const p=await s.call("TransactionPayController:getDelegationTransaction",{transaction:e}),y=p.authorizationList?.map(e=>({...e,chainId:Number(e.chainId),nonce:Number(e.nonce),r:e.r,s:e.s,yParity:Number(e.yParity)}));n.authorizationList=y,n.tradeType="EXACT_OUTPUT";const w=a?.find(e=>e.data?.startsWith(o.TOKEN_TRANSFER_FOUR_BYTE))?.data;w&&(n.recipient=b(w),n.refundTo=t.from);n.txs=[{to:t.targetTokenAddress,data:g(t.from,t.targetAmountMinimum),value:"0x0"},{to:p.to,data:p.data,value:p.value}]}(s,e,r,n);const I=(0,d.getFeatureFlags)(n).relayQuoteUrl;m("Request body",{body:r,url:I});const _=await(0,a.successfulFetch)(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),A=await _.json();return A.request=r,m("Fetched relay quote",A),async function(e,t,n){const{messenger:s}=n,{details:r}=e,{currencyIn:o,currencyOut:l}=r,{usdToFiatRate:g}=function(e,t){const{sourceChainId:n,sourceTokenAddress:s}=t,a=n===u.CHAIN_ID_POLYGON&&s===u.NATIVE_TOKEN_ADDRESS?(0,h.getNativeToken)(n):s,r=(0,h.getTokenFiatRate)(e,a,n);if(!r)throw new Error("Source token fiat rate not found");const o=new i.BigNumber(r.fiatRate).dividedBy(r.usdRate);return{sourceFiatRate:r,usdToFiatRate:o}}(s,t),b=p(function(e,t){const{currencyOut:n}=e.details,{amountUsd:s,amountFormatted:a,minimumAmount:r}=n,{decimals:o}=n.currency,c=new i.BigNumber(s).dividedBy(a),u=new i.BigNumber(r).minus(t.targetAmountMinimum);return u.shiftedBy(-o).multipliedBy(c)}(e,t),g),y=p(function(e){return new i.BigNumber(e.details.totalImpact.usd).abs()}(e),g),{gasLimits:w,isGasFeeToken:T,...S}=await async function(e,t,n){const{from:s,sourceChainId:r,sourceTokenAddress:o}=n,c=e.steps.flatMap(e=>e.items).map(e=>e.data),{relayDisabledGasStationChains:u}=(0,d.getFeatureFlags)(t),{chainId:l,data:p,maxFeePerGas:g,maxPriorityFeePerGas:b,to:y,value:w}=c[0],{totalGasEstimate:T,totalGasLimit:S,gasLimits:E}=await async function(e,t){if(1===e.length)return async function(e,t){const n=e.gas?new i.BigNumber(e.gas).toNumber():undefined;if(n)return m("Using single gas limit from params",{paramGasLimit:n}),{totalGasEstimate:n,totalGasLimit:n,gasLimits:[n]};try{const{chainId:n,data:s,from:r,to:o,value:c}=e,u=(0,a.toHex)(n),l=(0,a.toHex)(c??"0"),f=(0,d.getGasBuffer)(t,u),h=t.call("NetworkController:findNetworkClientIdByChainId",u),{gas:p,simulationFails:g}=await t.call("TransactionController:estimateGas",{from:r,data:s,to:o,value:l},h),b=new i.BigNumber(p).toNumber(),y=Math.ceil(b*f);if(!g)return m("Estimated gas limit for single transaction",{chainId:u,estimatedGas:b,bufferedGas:y,gasBuffer:f}),{totalGasEstimate:y,totalGasLimit:y,gasLimits:[y]}}catch(e){m("Failed to estimate gas limit for single transaction",e)}const s=(0,d.getFeatureFlags)(t).relayFallbackGas;return m("Using fallback gas for single transaction",{fallbackGas:s}),{totalGasEstimate:s.estimate,totalGasLimit:s.max,gasLimits:[s.max]}}(e[0],t);return async function(e,t){try{const{chainId:n,from:s}=e[0],r=(0,a.toHex)(n),o=(0,d.getGasBuffer)(t,r),c=e.map(e=>({...e,gas:e.gas?(0,a.toHex)(e.gas):undefined,maxFeePerGas:undefined,maxPriorityFeePerGas:undefined,value:(0,a.toHex)(e.value??"0")})),u=e.map(e=>e.gas?new i.BigNumber(e.gas).toNumber():undefined),{totalGasLimit:l,gasLimits:f}=await t.call("TransactionController:estimateGasBatch",{chainId:r,from:s,transactions:c}),h=f.map((e,t)=>{const n=1===f.length||u[t]!==f[t]?o:1;return Math.ceil(e*n)}),p=h.reduce((e,t)=>e+t,0);return m("Estimated gas limit for batch",{chainId:r,totalGasLimit:l,gasLimits:f,bufferedTotalGasLimit:p,bufferedGasLimits:h,gasBuffer:o}),{totalGasEstimate:p,totalGasLimit:p,gasLimits:h}}catch(e){m("Failed to estimate gas limit for batch",e)}const n=(0,d.getFeatureFlags)(t).relayFallbackGas,s=e.reduce((e,t)=>{const s=t.gas??n.estimate;return e+new i.BigNumber(s).toNumber()},0),r=e.map(e=>{const t=e.gas??n.max;return new i.BigNumber(t).toNumber()}),o=r.reduce((e,t)=>e+t,0);return m("Using fallback gas for batch",{totalGasEstimate:s,totalGasLimit:o,gasLimits:r}),{totalGasEstimate:s,totalGasLimit:o,gasLimits:r}}(e,t)}(c,t);m("Gas limit",{totalGasEstimate:T,totalGasLimit:S,gasLimits:E});const k=(0,f.calculateGasCost)({chainId:l,gas:T,maxFeePerGas:g,maxPriorityFeePerGas:b,messenger:t}),P=(0,f.calculateGasCost)({chainId:l,gas:S,maxFeePerGas:g,maxPriorityFeePerGas:b,messenger:t,isMax:!0}),v=(0,h.getTokenBalance)(t,s,r,(0,h.getNativeToken)(r)),I={estimate:k,max:P,gasLimits:E};if(new i.BigNumber(v).isGreaterThanOrEqualTo(P.raw))return I;if(u.includes(r))return m("Skipping gas station as disabled chain",{sourceChainId:r,disabledChainIds:u}),I;m("Checking gas fee tokens as insufficient native balance",{nativeBalance:v,max:P.raw});const _=await t.call("TransactionController:getGasFeeTokens",{chainId:r,data:p,from:s,to:y,value:(0,a.toHex)(w??"0")});m("Source gas fee tokens",{gasFeeTokens:_});const A=_.find(e=>e.tokenAddress.toLowerCase()===o.toLowerCase());if(!A)return m("No matching gas fee token found",{sourceTokenAddress:o,gasFeeTokens:_}),I;let C=A.amount;if(c.length>1){const e=new i.BigNumber(A.amount,16).dividedBy(A.gas,16),t=e.multipliedBy(T);C=(0,a.toHex)(t.toFixed(0)),m("Estimated gas fee token amount for batch",{finalAmount:t.toString(10),gasRate:e.toString(10),totalGasEstimate:T})}const j={...A,amount:C},x=(0,f.calculateGasFeeTokenCost)({chainId:r,gasFeeToken:j,messenger:t});if(!x)return I;return m("Using gas fee token for source network",{gasFeeTokenCost:x}),{isGasFeeToken:!0,estimate:x,max:x,gasLimits:E}}(e,s,t),E={usd:"0",fiat:"0"},k={human:o.amountFormatted,raw:o.amount,...p(new i.BigNumber(o.amountUsd),g)},P={human:l.amountFormatted,raw:l.amount,...p(new i.BigNumber(l.amountUsd),g)},v={gasLimits:w};return{dust:b,estimatedDuration:r.timeEstimate,fees:{isSourceGasFeeToken:T,provider:y,sourceNetwork:S,targetNetwork:E},original:{...e,metamask:v},request:t,sourceAmount:k,targetAmount:P,strategy:c.TransactionPayStrategy.Relay}}(A,e,t)}catch(e){throw m("Error fetching relay quote",e),e}}(t,e)))}catch(e){throw m("Error fetching quotes",{error:e}),new Error(`Failed to fetch Relay quotes: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-quotes.cjs"}],[3514,{"../../logger.cjs":3507,"../../utils/feature-flags.cjs":3516,"../../utils/transaction.cjs":3524,"./constants.cjs":3512,"@metamask/controller-utils":1639,"@metamask/transaction-controller":3473,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitRelayQuotes=void 0;const s=e("@metamask/controller-utils"),a=e("@metamask/transaction-controller"),r=e("@metamask/utils"),i=e("./constants.cjs"),o=e("../../logger.cjs"),c=e("../../utils/feature-flags.cjs"),u=e("../../utils/transaction.cjs"),l="0x0",d=(0,r.createModuleLogger)(o.projectLogger,"relay-strategy");async function f(e,t,n){d("Executing single quote",e),(0,u.updateTransaction)({transactionId:n.id,messenger:t,note:"Remove nonce from skipped transaction"},e=>{e.txParams.nonce=undefined}),await async function(e,t,n){const{steps:r}=e.original,i=r.flatMap(e=>e.items).map(e=>e.data),o=r.find(e=>"transaction"!==e.kind)?.kind;if(o)throw new Error(`Unsupported step kind: ${o}`);const l=i.map(e=>function(e,t){const n=(0,c.getFeatureFlags)(t);return{data:e.data,from:e.from,gas:(0,s.toHex)(e.gas??n.relayFallbackGas.max),maxFeePerGas:(0,s.toHex)(e.maxFeePerGas),maxPriorityFeePerGas:(0,s.toHex)(e.maxPriorityFeePerGas),to:e.to,value:(0,s.toHex)(e.value??"0")}}(e,n)),f=[],{from:h,sourceChainId:m,sourceTokenAddress:p}=e.request,g=n.call("NetworkController:findNetworkClientIdByChainId",m);d("Adding transactions",{normalizedParams:l,sourceChainId:m,from:h,networkClientId:g});const{end:b}=(0,u.collectTransactionIds)(m,h,n,e=>{f.push(e),(0,u.updateTransaction)({transactionId:t,messenger:n,note:"Add required transaction ID from Relay submission"},t=>{t.requiredTransactionIds??(t.requiredTransactionIds=[]),t.requiredTransactionIds.push(e)})});let y;const w=e.fees.isSourceGasFeeToken?p:undefined,T=e.original.details.currencyIn.currency.chainId===e.original.details.currencyOut.currency.chainId,S=T&&e.original.request.authorizationList?.length?e.original.request.authorizationList.map(e=>({address:e.address,chainId:(0,s.toHex)(e.chainId)})):undefined,{gasLimits:E}=e.original.metamask;if(1===i.length){const e={...l[0],authorizationList:S,gas:(0,s.toHex)(E[0])};y=await n.call("TransactionController:addTransaction",e,{gasFeeToken:w,networkClientId:g,origin:s.ORIGIN_METAMASK,requireApproval:!1,type:a.TransactionType.relayDeposit})}else{const e=1===E.length?(0,s.toHex)(E[0]):undefined,t=l.map((t,n)=>({params:{data:t.data,gas:e?undefined:(0,s.toHex)(E[n]),maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,to:t.to,value:t.value},type:0===n?a.TransactionType.tokenMethodApprove:a.TransactionType.relayDeposit}));await n.call("TransactionController:addTransactionBatch",{from:h,disable7702:!e,disableHook:Boolean(e),disableSequential:Boolean(e),gasFeeToken:w,gasLimit7702:e,networkClientId:g,origin:s.ORIGIN_METAMASK,overwriteUpgrade:!0,requireApproval:!1,transactions:t})}if(b(),d("Added transactions",f),y){const e=await y.result;d("Submitted transaction",e)}await Promise.all(f.map(e=>(0,u.waitForTransactionConfirmed)(e,n))),d("All transactions confirmed",f);const k=(0,u.getTransaction)(f.slice(-1)[0],n)?.hash;return k}(e,n.id,t);const r=await async function(e){if(e.details.currencyIn.currency.chainId===e.details.currencyOut.currency.chainId)return d("Skipping polling as same chain"),l;const{requestId:t}=e.steps[0],n=`${i.RELAY_STATUS_URL}?requestId=${t}`;for(;;){const e=await(0,s.successfulFetch)(n,{method:"GET"}),t=await e.json();if(d("Polled status",t.status,t),"success"===t.status){const e=t.txHashes?.slice(-1)[0];return e??l}if(["failure","refund","refunded"].includes(t.status))throw new Error(`Relay request failed with status: ${t.status}`);await new Promise(e=>setTimeout(e,i.RELAY_POLLING_INTERVAL))}}(e.original);return d("Relay request completed",r),(0,u.updateTransaction)({transactionId:n.id,messenger:t,note:"Intent complete after Relay completion"},e=>{e.isIntentComplete=!0}),{transactionHash:r}}n.submitRelayQuotes=async function(e){d("Executing quotes",e);const{quotes:t,messenger:n,transaction:s}=e;let a;for(const e of t)({transactionHash:a}=await f(e,n,s));return{transactionHash:a}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-submit.cjs"}],[3515,{"../../index.cjs":3506,"../../logger.cjs":3507,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TestStrategy=void 0;const i=e("@metamask/utils"),o=e("../../index.cjs"),c=e("../../logger.cjs"),u=(0,i.createModuleLogger)(c.projectLogger,"test-strategy");n.TestStrategy=class{constructor(){s.add(this)}async getQuotes(e){const{requests:t}=e;return u("Getting quotes",t),await r(this,s,"m",a).call(this,5e3),[{dust:{fiat:"0.12",usd:"0.34"},estimatedDuration:5,fees:{provider:{fiat:"1.23",usd:"1.23"},sourceNetwork:{estimate:{human:"2.34",fiat:"2.34",usd:"2.34",raw:"234000"},max:{human:"2.35",fiat:"2.35",usd:"2.35",raw:"235000"}},targetNetwork:{fiat:"3.45",usd:"3.45"}},original:undefined,request:t[0],sourceAmount:{human:"4.56",fiat:"4.56",raw:"456000",usd:"4.56"},targetAmount:{human:"5.67",fiat:"5.67",raw:"567000",usd:"5.67"},strategy:o.TransactionPayStrategy.Test}]}async execute(e){const{quotes:t}=e;return u("Executing",t),await r(this,s,"m",a).call(this,5e3),{transactionHash:undefined}}},s=new WeakSet,a=function(e){return new Promise(t=>setTimeout(t,e))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/test/TestStrategy.cjs"}],[3516,{"../logger.cjs":3507,"../strategy/relay/constants.cjs":3512,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getGasBuffer=n.getFeatureFlags=n.DEFAULT_SLIPPAGE=n.DEFAULT_RELAY_QUOTE_URL=n.DEFAULT_RELAY_FALLBACK_GAS_MAX=n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=n.DEFAULT_GAS_BUFFER=void 0;const s=e("@metamask/utils"),a=e("../logger.cjs"),r=e("../strategy/relay/constants.cjs"),i=(0,s.createModuleLogger)(a.projectLogger,"feature-flags");function o(e){return e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay??{}}n.DEFAULT_GAS_BUFFER=1,n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=9e5,n.DEFAULT_RELAY_FALLBACK_GAS_MAX=15e5,n.DEFAULT_RELAY_QUOTE_URL=`${r.RELAY_URL_BASE}/quote`,n.DEFAULT_SLIPPAGE=.005,n.getFeatureFlags=function(e){const t=o(e),s=t.relayFallbackGas?.estimate??n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE,a=t.relayFallbackGas?.max??n.DEFAULT_RELAY_FALLBACK_GAS_MAX,r=t.relayQuoteUrl??n.DEFAULT_RELAY_QUOTE_URL,c={relayDisabledGasStationChains:t.relayDisabledGasStationChains??[],relayFallbackGas:{estimate:s,max:a},relayQuoteUrl:r,slippage:t.slippage??n.DEFAULT_SLIPPAGE};return i("Feature flags:",{raw:t,result:c}),c},n.getGasBuffer=function(e,t){const s=o(e);return s.gasBuffer?.perChainConfig?.[t]?.buffer??s.gasBuffer?.default??n.DEFAULT_GAS_BUFFER}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/feature-flags.cjs"}],[3517,{"../logger.cjs":3507,"./token.cjs":3522,"@metamask/controller-utils":1639,"bignumber.js":3525},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGasFeeTokenCost=n.calculateGasCost=n.calculateTransactionGasCost=void 0;const s=e("@metamask/controller-utils"),a=e("bignumber.js"),r=e("./token.cjs"),i=e("../logger.cjs"),o=(0,i.createModuleLogger)(i.projectLogger,"gas");function c(e){const{chainId:t,gas:n,isMax:i,maxFeePerGas:o,maxPriorityFeePerGas:c,messenger:u}=e,l=(0,s.toHex)(t),{estimatedBaseFee:d,maxFeePerGas:f,maxPriorityFeePerGas:h}=function(e,t){const n=t.call("GasFeeController:getState"),s=n?.gasFeeEstimatesByChainId?.[e],{estimatedBaseFee:r,medium:i}=s?.gasFeeEstimates??{},o=i?.suggestedMaxFeePerGas,c=i?.suggestedMaxPriorityFeePerGas,u=r?new a.BigNumber(r).shiftedBy(9).toString(10):undefined,l=o?new a.BigNumber(o).shiftedBy(9).toString(10):undefined,d=c?new a.BigNumber(c).shiftedBy(9).toString(10):undefined;return{estimatedBaseFee:u,maxFeePerGas:l,maxPriorityFeePerGas:d}}(l,u),m=o??f,p=c??h,g=d&&p&&!i?new a.BigNumber(d).plus(p):new a.BigNumber(m??"0x0"),b=new a.BigNumber(n).multipliedBy(g),y=b.toString(10),w=b.shiftedBy(-18),T=w.toString(10),S=(0,r.getTokenFiatRate)(u,(0,r.getNativeToken)(l),l);if(!S)throw new Error("Could not fetch fiat rate for native token");const E=w.multipliedBy(S.usdRate).toString(10);return{fiat:w.multipliedBy(S.fiatRate).toString(10),human:T,raw:y,usd:E}}function u({chainId:e,gasFeeToken:t,messenger:n}){const{amount:s,decimals:i,tokenAddress:c}=t,u=(0,r.getTokenFiatRate)(n,c,e);if(!u)return o("Cannot get gas fee token info"),undefined;const l=new a.BigNumber(s),d=l.toString(10),f=l.shiftedBy(-i),h=f.toString(10);return{isGasFeeToken:!0,fiat:f.multipliedBy(u.fiatRate).toString(10),human:h,raw:d,usd:f.multipliedBy(u.usdRate).toString(10)}}n.calculateTransactionGasCost=function(e,t,{isMax:n}={}){const{chainId:s,gasUsed:i,gasLimitNoBuffer:l,txParams:d}=e,{from:f,gas:h,maxFeePerGas:m,maxPriorityFeePerGas:p}=d,g=(n?undefined:i)??l??h??"0x0",b=c({chainId:s,gas:g,isMax:n,maxFeePerGas:m,maxPriorityFeePerGas:p,messenger:t}),y=c({chainId:s,gas:g,isMax:!0,messenger:t}),w=(0,r.getTokenBalance)(t,f,s,(0,r.getNativeToken)(s)),T=function({hasBalance:e,messenger:t,transaction:n}){const{chainId:s,gasFeeTokens:a,isGasFeeTokenIgnoredIfBalance:r,selectedGasFeeToken:i}=n;if(!a||!i||r&&e)return undefined;o("Calculating gas fee token cost",{selectedGasFeeToken:i,chainId:s});const c=a?.find(e=>e.tokenAddress.toLowerCase()===i.toLowerCase());if(!c)return o("Gas fee token not found",{gasFeeTokens:a,selectedGasFeeToken:i}),undefined;return u({chainId:s,gasFeeToken:c,messenger:t})}({hasBalance:new a.BigNumber(w).gte(y.raw),messenger:t,transaction:e});return T||b},n.calculateGasCost=c,n.calculateGasFeeTokenCost=u}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/gas.cjs"}],[3518,{"../logger.cjs":3507,"./strategy.cjs":3521,"./totals.cjs":3523,"./transaction.cjs":3524,"@metamask/transaction-controller":3473,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuotes=n.updateQuotes=void 0;const s=e("@metamask/transaction-controller"),a=e("@metamask/utils"),r=e("./strategy.cjs"),i=e("./totals.cjs"),o=e("./transaction.cjs"),c=e("../logger.cjs"),u=(0,a.createModuleLogger)(c.projectLogger,"quotes");async function l(e){const{messenger:t,transactionData:n,transactionId:a,updateTransactionData:c}=e,l=(0,o.getTransaction)(a,t);if(!l||!n)throw new Error("Transaction not found");if(l?.status!==s.TransactionStatus.unapproved)return!1;u("Updating quotes",{transactionId:a});const{isMaxAmount:d,paymentToken:f,sourceAmounts:h,tokens:m}=n,p=function({from:e,isMaxAmount:t,paymentToken:n,sourceAmounts:s,tokens:a,transactionId:r}){if(!n)return[];const i=(s??[]).map(s=>{const r=a.find(e=>e.address===s.targetTokenAddress);return{from:e,isMaxAmount:t,sourceBalanceRaw:n.balanceRaw,sourceTokenAmount:s.sourceAmountRaw,sourceChainId:n.chainId,sourceTokenAddress:n.address,targetAmountMinimum:r.allowUnderMinimum?"0":r.amountRaw,targetChainId:r.chainId,targetTokenAddress:r.address}});i.length||u("No quote requests",{transactionId:r});return i}({from:l.txParams.from,isMaxAmount:d??!1,paymentToken:f,sourceAmounts:h,tokens:m,transactionId:a});c(a,e=>{e.isLoading=!0});try{const{batchTransactions:e,quotes:n}=await async function(e,t,n){const{id:s}=e,a=(0,r.getStrategy)(n,e);let i=[];try{i=t?.length?await a.getQuotes({messenger:n,requests:t,transaction:e}):[]}catch(e){u("Error fetching quotes",{error:e,transactionId:s})}u("Updated",{transactionId:s,quotes:i});const o=i?.length&&a.getBatchTransactions?await a.getBatchTransactions({messenger:n,quotes:i}):[];return u("Batch transactions",{transactionId:s,batchTransactions:o}),{batchTransactions:o,quotes:i}}(l,p,t),s=(0,i.calculateTotals)({isMaxAmount:d,messenger:t,quotes:n,tokens:m,transaction:l});u("Calculated totals",{transactionId:a,totals:s}),function({batchTransactions:e,messenger:t,paymentToken:n,totals:s,transactionId:a}){if(!n)return;(0,o.updateTransaction)({transactionId:a,messenger:t,note:"Update transaction pay data"},t=>{t.batchTransactions=e,t.batchTransactionsOptions={},t.metamaskPay={bridgeFeeFiat:s.fees.provider.usd,chainId:n.chainId,networkFeeFiat:s.fees.sourceNetwork.estimate.usd,targetFiat:s.targetAmount.usd,tokenAddress:n.address,totalFiat:s.total.usd}})}({batchTransactions:e,messenger:t,paymentToken:f,totals:s,transactionId:a}),c(a,e=>{e.quotes=n,e.quotesLastUpdated=Date.now(),e.totals=s})}finally{c(a,e=>{e.isLoading=!1})}return!0}n.updateQuotes=l,n.refreshQuotes=async function(e,t){const n=e.call("TransactionPayController:getState"),s=Object.keys(n.transactionData);for(const a of s){const s=n.transactionData[a],{isLoading:i,quotes:o,quotesLastUpdated:c}=s;if(i||!o?.length)continue;const d=o[0].strategy,f=(0,r.getStrategyByName)(d),h=await(f.getRefreshInterval?.({chainId:o[0].request.sourceChainId,messenger:e}))??3e4;if(!(Date.now()-(c??0)>h))continue;await l({messenger:e,transactionData:s,transactionId:a,updateTransactionData:t})&&u("Refreshed quotes",{transactionId:a,strategy:d})}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/quotes.cjs"}],[3519,{"./token.cjs":3522,"@ethersproject/abi":763,"@metamask/controller-utils":1639,"@metamask/metamask-eth-abis":2597,"@metamask/utils":3554,"bignumber.js":3525},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseRequiredTokens=void 0;const s=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),r=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("./token.cjs"),u="0xa9059cbb";function l(e,t){const{data:n,to:i}=function(e){const{nestedTransactions:t,txParams:n}=e,{data:s}=n,a=n?.to;if(s?.startsWith(u)&&a)return{data:s,to:a,index:undefined};const r=t?.findIndex(e=>e.data?.startsWith(u)),i=r===undefined?undefined:t?.[r];if(i?.data&&i.to)return{data:i.data,to:i.to,index:r};return undefined}(e)??{};if(!i||!n)return undefined;let o;try{const e=new s.Interface(r.abiERC20).decodeFunctionData("transfer",n);o=(0,a.toHex)(e._value)}catch{}return o===undefined?undefined:f(e,i,o,t)}function d(e,t){const{chainId:n,txParams:s}=e,{gas:a,maxFeePerGas:r}=s,u=(0,c.getNativeToken)(n),l=f(e,u,(0,i.add0x)(new o.BigNumber(a??"0x0").multipliedBy(new o.BigNumber(r??"0x0")).toString(16)),t);if(!l)return undefined;const d=new o.BigNumber(l.amountUsd);if(new o.BigNumber(l.balanceRaw).isGreaterThanOrEqualTo(l.amountRaw)||d.isGreaterThanOrEqualTo(1))return{...l,allowUnderMinimum:!0,skipIfBalance:!0};const h=(0,c.getTokenFiatRate)(t,u,n),m=f(e,u,(0,i.add0x)(new o.BigNumber(1).dividedBy(h.usdRate).shiftedBy(18).toString(16)),t);return m?{...m,allowUnderMinimum:!0,skipIfBalance:!0}:undefined}function f(e,t,n,s){const{chainId:a,txParams:r}=e,i=r.from,{decimals:o,symbol:u}=(0,c.getTokenInfo)(s,t,a)??{},l=(0,c.getTokenFiatRate)(s,t,a),d=(0,c.getTokenBalance)(s,i,a,t);if(o===undefined||!u||l===undefined)return undefined;const{amountHuman:f,amountRaw:m,amountFiat:p,amountUsd:g}=h(d,o,l),{amountHuman:b,amountRaw:y,amountFiat:w,amountUsd:T}=h(n,o,l);return{address:t,allowUnderMinimum:!1,amountFiat:w,amountHuman:b,amountRaw:y,amountUsd:T,balanceFiat:p,balanceHuman:f,balanceRaw:m,balanceUsd:g,chainId:a,decimals:o,skipIfBalance:!1,symbol:u}}function h(e,t,n){const s=new o.BigNumber(e),a=s.shiftedBy(-t),r=a.multipliedBy(n.fiatRate).toString(10),i=a.multipliedBy(n.usdRate).toString(10),c=s.toFixed(0);return{amountFiat:r,amountHuman:a.toString(10),amountRaw:c,amountUsd:i}}n.parseRequiredTokens=function(e,t){return[l(e,t),d(e,t)].filter(Boolean)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/required-tokens.cjs"}],[3520,{"../constants.cjs":3503,"../index.cjs":3506,"../logger.cjs":3507,"./token.cjs":3522,"./transaction.cjs":3524,"@metamask/utils":3554,"bignumber.js":3525},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateSourceAmounts=void 0;const s=e("@metamask/utils"),a=e("bignumber.js"),r=e("./token.cjs"),i=e("./transaction.cjs"),o=e("../index.cjs"),c=e("../constants.cjs"),u=e("../logger.cjs"),l=(0,s.createModuleLogger)(u.projectLogger,"source-amounts");n.updateSourceAmounts=function(e,t,n){if(!t)return;const{isMaxAmount:s,paymentToken:u,tokens:d}=t;if(!d.length||!u)return;const f=d.map(t=>function(e,t,n,s,u){const d=(0,r.getTokenFiatRate)(n,e.address,e.chainId);if(!d)return undefined;const f=new a.BigNumber(t.balanceRaw).gte(t.amountRaw);if(t.skipIfBalance&&f)return l("Skipping token as sufficient balance",{tokenAddress:t.address}),undefined;const h=function(e,t){const n=(0,i.getTransaction)(e,t);return t.call("TransactionPayController:getStrategy",n)}(s,n),m=t.address.toLowerCase()===e.address.toLowerCase()&&t.chainId===e.chainId,p=function(e,t){const n=e.chainId===c.CHAIN_ID_ARBITRUM&&e.address.toLowerCase()===c.ARBITRUM_USDC_ADDRESS.toLowerCase();return t===o.TransactionPayStrategy.Relay&&n}(t,h);if(m&&!p)return l("Skipping token as same as payment token"),undefined;const g=new a.BigNumber(t.amountUsd).div(d.usdRate),b=g.toString(10),y=g.shiftedBy(e.decimals).toFixed(0);if("0"===t.amountRaw)return l("Skipping token as zero amount",{tokenAddress:t.address}),undefined;if(u)return{sourceAmountHuman:e.balanceHuman,sourceAmountRaw:e.balanceRaw,targetTokenAddress:t.address};return{sourceAmountHuman:b,sourceAmountRaw:y,targetTokenAddress:t.address}}(u,t,n,e,s??!1)).filter(Boolean);l("Updated source amounts",{transactionId:e,sourceAmounts:f}),t.sourceAmounts=f}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/source-amounts.cjs"}],[3521,{"../constants.cjs":3503,"../strategy/bridge/BridgeStrategy.cjs":3508,"../strategy/relay/RelayStrategy.cjs":3511,"../strategy/test/TestStrategy.cjs":3515},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getStrategyByName=n.getStrategy=void 0;const s=e("../constants.cjs"),a=e("../strategy/bridge/BridgeStrategy.cjs"),r=e("../strategy/relay/RelayStrategy.cjs"),i=e("../strategy/test/TestStrategy.cjs");function o(e){switch(e){case s.TransactionPayStrategy.Bridge:return new a.BridgeStrategy;case s.TransactionPayStrategy.Relay:return new r.RelayStrategy;case s.TransactionPayStrategy.Test:return new i.TestStrategy;default:throw new Error(`Unknown strategy: ${e}`)}}n.getStrategy=function(e,t){return o(e.call("TransactionPayController:getStrategy",t))},n.getStrategyByName=o}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/strategy.cjs"}],[3522,{"../constants.cjs":3503,"@metamask/controller-utils":1639,"bignumber.js":3525,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNativeToken=n.getTokenFiatRate=n.getTokenInfo=n.getAllTokenBalances=n.getTokenBalance=void 0;const s=e("@metamask/controller-utils"),a=e("bignumber.js"),r=e("lodash"),i=e("../constants.cjs"),o={[i.CHAIN_ID_ARBITRUM]:[i.ARBITRUM_USDC_ADDRESS.toLowerCase()],[i.CHAIN_ID_POLYGON]:[i.POLYGON_USDCE_ADDRESS.toLowerCase()]};function c(e,t,n,r){const i=e.call("TokenBalancesController:getState"),o=t.toLowerCase(),c=(0,s.toChecksumHexAddress)(r),l=c===u(n),d=i.tokenBalances?.[o]?.[n]?.[c];if(!l&&d===undefined)return"0";if(!l&&d)return new a.BigNumber(d,16).toString(10);const f=e.call("AccountTrackerController:getState"),h=f.accountsByChainId?.[n],m=(0,s.toChecksumHexAddress)(o),p=h?.[m]?.balance;return new a.BigNumber(p??"0x0",16).toString(10)}function u(e){return"0x89"===e?"0x0000000000000000000000000000000000001010":i.NATIVE_TOKEN_ADDRESS}function l(e,t){try{const n=t.call("NetworkController:findNetworkClientIdByChainId",e);return t.call("NetworkController:getNetworkClientById",n).configuration.ticker}catch{return undefined}}n.getTokenBalance=c,n.getAllTokenBalances=function(e,t){const n=e.call("TokenBalancesController:getState"),s=e.call("AccountTrackerController:getState"),a=Object.keys(s.accountsByChainId),i=t.toLowerCase(),o=n.tokenBalances?.[i],l=Object.keys(o);return(0,r.uniq)([...l,...a]).flatMap(n=>[...Object.keys(o[n]??{}),u(n)].map(s=>({chainId:n,tokenAddress:s,balance:c(e,t,n,s)})))},n.getTokenInfo=function(e,t,n){const s=e.call("TokensController:getState"),a=t.toLowerCase(),r=a===u(n).toLowerCase(),i=Object.values(s.allTokens?.[n]??{}).flat().find(e=>e.address.toLowerCase()===a);if(!i&&!r)return undefined;if(i&&!r)return{decimals:Number(i.decimals),symbol:i.symbol};const o=l(n,e);return o?{decimals:18,symbol:o}:undefined},n.getTokenFiatRate=function(e,t,n){const r=l(n,e);if(!r)return undefined;const i=e.call("TokenRatesController:getState"),c=e.call("CurrencyRateController:getState"),d=(0,s.toChecksumHexAddress)(t),f=d===u(n),h=i.marketData?.[n]?.[d]?.price;if(h===undefined&&!f)return undefined;const{conversionRate:m,usdConversionRate:p}=c.currencyRates?.[r]??{conversionRate:null,usdConversionRate:null};if(null===m||null===p)return undefined;const g=o[n]?.includes(t.toLowerCase());return{usdRate:g?"1":new a.BigNumber(h??1).multipliedBy(p).toString(10),fiatRate:new a.BigNumber(h??1).multipliedBy(m).toString(10)}},n.getNativeToken=u}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/token.cjs"}],[3523,{"./gas.cjs":3517,"bignumber.js":3525},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTotals=void 0;const s=e("bignumber.js"),a=e("./gas.cjs");function r(e){return{...i(e),human:o(e,e=>e.human),raw:o(e,e=>e.raw)}}function i(e){return{fiat:o(e,e=>e.fiat),usd:o(e,e=>e.usd)}}function o(e,t){return e.map(t).reduce((e,t)=>e.plus(t),new s.BigNumber(0)).toString(10)}n.calculateTotals=function({isMaxAmount:e,quotes:t,messenger:n,tokens:c,transaction:u}){const l=i(t.map(e=>e.fees.provider)),d=r(t.map(e=>e.fees.sourceNetwork.max)),f=r(t.map(e=>e.fees.sourceNetwork.estimate)),h=(0,a.calculateTransactionGasCost)(u,n),m=t?.length?{...i(t.map(e=>e.fees.targetNetwork)),isGasFeeToken:!1}:h,p=r(t.map(e=>e.sourceAmount)),g=r(t.map(e=>e.targetAmount)),b=c.filter(e=>!e.skipIfBalance),y=o(b,e=>e.amountFiat),w=o(b,e=>e.amountUsd),T=t.length>0,S=new s.BigNumber(l.fiat).plus(f.fiat).plus(m.fiat).plus(e&&T?g.fiat:y).toString(10),E=new s.BigNumber(l.usd).plus(f.usd).plus(m.usd).plus(e&&T?g.usd:w).toString(10);return{estimatedDuration:Number(o(t,e=>e.estimatedDuration)),fees:{isSourceGasFeeToken:t.some(e=>e.fees.isSourceGasFeeToken),isTargetGasFeeToken:Boolean(m.isGasFeeToken)||t.some(e=>e.fees.isTargetGasFeeToken),provider:l,sourceNetwork:{estimate:f,max:d},targetNetwork:m},sourceAmount:p,targetAmount:g,total:{fiat:S,usd:E}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/totals.cjs"}],[3524,{"../logger.cjs":3507,"./required-tokens.cjs":3519,"@metamask/transaction-controller":3473,"@metamask/utils":3554,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.collectTransactionIds=n.updateTransaction=n.waitForTransactionConfirmed=n.pollTransactionChanges=n.getTransaction=n.FINALIZED_STATUSES=void 0;const s=e("@metamask/transaction-controller"),a=e("@metamask/utils"),r=e("lodash"),i=e("./required-tokens.cjs"),o=e("../logger.cjs"),c=(0,a.createModuleLogger)(o.projectLogger,"transaction");function u(e,t){return t.call("TransactionController:getState").transactions.find(t=>t.id===e)}n.FINALIZED_STATUSES=[s.TransactionStatus.confirmed,s.TransactionStatus.dropped,s.TransactionStatus.failed],n.getTransaction=u,n.pollTransactionChanges=function(e,t,s){e.subscribe("TransactionController:stateChange",(a,r)=>{const o=a.filter(e=>!r?.find(t=>t.id===e.id)),u=a.filter(e=>{const t=r?.find(t=>t.id===e.id);return t&&t?.txParams.data!==e.txParams.data});[...a.filter(e=>{const t=r?.find(t=>t.id===e.id);return t&&!n.FINALIZED_STATUSES.includes(t.status)&&n.FINALIZED_STATUSES.includes(e.status)}),...(r??[]).filter(e=>!a.find(t=>t.id===e.id))].forEach(e=>function(e,t){c("Transaction finalized",{transaction:e}),t(e.id)}(e,s)),[...o,...u].forEach(n=>function(e,t,n){const s=(0,i.parseRequiredTokens)(e,t);c("Transaction changed",{transaction:e,tokens:s}),n(e.id,e=>{e.tokens=s})}(n,e,t))},e=>e.transactions)},n.waitForTransactionConfirmed=function(e,t){return new Promise((n,a)=>{const r=(e,t)=>(c("Checking transaction status",e?.status,e?.type),e?.status===s.TransactionStatus.confirmed?(t?.(),n(),!0):!![s.TransactionStatus.dropped,s.TransactionStatus.failed].includes(e?.status)&&(t?.(),a(new Error(`Transaction failed - ${e?.type} - ${e?.error?.message}`)),!0)),i=t.call("TransactionController:getState").transactions.find(t=>t.id===e);if(r(i))return;const o=e=>{r(e,()=>t.unsubscribe("TransactionController:stateChange",o))};t.subscribe("TransactionController:stateChange",o,t=>t.transactions.find(t=>t.id===e))})},n.updateTransaction=function({transactionId:e,messenger:t,note:n},s){const a=u(e,t);if(!a)throw new Error(`Transaction not found: ${e}`);const i=(0,r.cloneDeep)(a);s(i),t.call("TransactionController:updateTransaction",i,n)},n.collectTransactionIds=function(e,t,n,s){const a=n=>{n.chainId===e&&n.txParams.from.toLowerCase()===t.toLowerCase()&&s(n.id)};return n.subscribe("TransactionController:unapprovedTransactionAdded",a),{end:()=>{n.unsubscribe("TransactionController:unapprovedTransactionAdded",a)}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/transaction.cjs"}],[3525,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,r=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,h=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,s=1,a=e.length,r=e[0]+"";s<a;){for(t=e[s++]+"",n=u-t.length;n--;t="0"+t);r+=t}for(a=r.length;48===r.charCodeAt(--a););return r.slice(0,a+1||1)}function g(e,t){var n,s,a=e.c,r=t.c,i=e.s,o=t.s,c=e.e,u=t.e;if(!i||!o)return null;if(n=a&&!a[0],s=r&&!r[0],n||s)return n?s?0:-o:i;if(i!=o)return i;if(n=i<0,s=c==u,!a||!r)return s?0:!a^n?1:-1;if(!s)return c>u^n?1:-1;for(o=(c=a.length)<(u=r.length)?c:u,i=0;i<o;i++)if(a[i]!=r[i])return a[i]>r[i]^n?1:-1;return c==u?0:c>u^n?1:-1}function b(e,t,n,s){if(e<t||e>n||e!==r(e))throw Error(i+(s||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function y(e){var t=e.c.length-1;return m(e.e/u)==t&&e.c[t]%2!=0}function w(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function T(e,t,n){var s,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(s=e.length)){for(a=n,t-=s;--t;a+=n);e+=a}else t<s&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,S,E,k,P,v,I,_,A,C,j=q.prototype={constructor:q,toString:null,valueOf:null},x=new q(1),R=20,O=4,F=-7,N=21,M=-1e7,L=1e7,G=!1,D=1,B=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",$=!0;function q(e,t){var n,a,i,c,d,f,h,m,p=this;if(!(p instanceof q))return new q(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>L?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>L?p.c=p.e=null:(p.e=c,p.c=[e]))}m=String(e)}else{if(!s.test(m=String(e)))return E(p,m,f);p.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(b(t,2,H.length,"Base"),10==t&&$)return V(p=new q(e),R+p.e+1,O);if(m=String(e),f="number"==typeof e){if(0*e!=0)return E(p,m,f,t);if(p.s=1/e<0?(m=m.slice(1),-1):1,q.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,h=m.length;d<h;d++)if(n.indexOf(a=m.charAt(d))<0){if("."==a){if(d>c){c=h;continue}}else if(!i&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){i=!0,d=-1,c=0;continue}return E(p,String(e),f,t)}f=!1,(c=(m=S(m,t,10,p.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(h=m.length;48===m.charCodeAt(--h););if(m=m.slice(d,++h)){if(h-=d,f&&q.DEBUG&&h>15&&(e>l||e!==r(e)))throw Error(o+p.s*e);if((c=c-d-1)>L)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%u,c<0&&(d+=u),d<h){for(d&&p.c.push(+m.slice(0,d)),h-=u;d<h;)p.c.push(+m.slice(d,d+=u));d=u-(m=m.slice(d)).length}else d-=h;for(;d--;m+="0");p.c.push(+m)}}else p.c=[p.e=0]}function K(e,t,n,s){var a,r,i,o,c;if(null==n?n=O:b(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=p(e.c),c=1==s||2==s&&(i<=F||i>=N)?w(c,i):T(c,i,"0");else if(r=(e=V(new q(e),t,n)).e,o=(c=p(e.c)).length,1==s||2==s&&(t<=r||r<=F)){for(;o<t;c+="0",o++);c=w(c,r)}else if(t-=i,c=T(c,r,"0"),r+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=r-o)>0)for(r+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function W(e,t){for(var n,s,a=1,r=new q(e[0]);a<e.length;a++)(!(s=new q(e[a])).s||(n=g(r,s))===t||0===n&&r.s===t)&&(r=s);return r}function z(e,t,n){for(var s=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,s++);return(n=s+n*u-1)>L?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function V(e,t,n,s){var i,o,l,f,h,m,p,g=e.c,b=d;if(g){e:{for(i=1,f=g[0];f>=10;f/=10,i++);if((o=t-i)<0)o+=u,l=t,h=g[m=0],p=r(h/b[i-l-1]%10);else if((m=a((o+1)/u))>=g.length){if(!s)break e;for(;g.length<=m;g.push(0));h=p=0,i=1,l=(o%=u)-u+1}else{for(h=f=g[m],i=1;f>=10;f/=10,i++);p=(l=(o%=u)-u+i)<0?0:r(h/b[i-l-1]%10)}if(s=s||t<0||null!=g[m+1]||(l<0?h:h%b[i-l-1]),s=n<4?(p||s)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||s||6==n&&(o>0?l>0?h/b[i-l]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,s?(t-=e.e+1,g[0]=b[(u-t%u)%u],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,f=1,m--):(g.length=m+1,f=b[u-o],g[m]=l>0?r(h/b[i-l]%b[l])*f:0),s)for(;;){if(0==m){for(o=1,l=g[0];l>=10;l/=10,o++);for(l=g[0]+=f,f=1;l>=10;l/=10,f++);o!=f&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=f,g[m]!=c)break;g[m--]=0,f=1}for(o=g.length;0===g[--o];g.pop());}e.e>L?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function J(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=F||n>=N?w(t,n):T(t,n,"0"),e.s<0?"-"+t:t)}return q.clone=e,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(b(n=e[t],0,h,t),R=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(b(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(b(n[0],-h,0,t),b(n[1],0,h,t),F=n[0],N=n[1]):(b(n,-h,h,t),F=-(N=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)b(n[0],-h,-1,t),b(n[1],1,h,t),M=n[0],L=n[1];else{if(b(n,-h,h,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(L=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw G=!n,Error(i+"crypto unavailable");G=n}else G=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(b(n=e[t],0,9,t),D=n),e.hasOwnProperty(t="POW_PRECISION")&&(b(n=e[t],0,h,t),B=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);$="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:R,ROUNDING_MODE:O,EXPONENTIAL_AT:[F,N],RANGE:[M,L],CRYPTO:G,MODULO_MODE:D,POW_PRECISION:B,FORMAT:U,ALPHABET:H}},q.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!q.DEBUG)return!0;var t,n,s=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(s)){if((1===o||-1===o)&&a>=-h&&a<=h&&a===r(a)){if(0===s[0]){if(0===a&&1===s.length)return!0;break e}if((t=(a+1)%u)<1&&(t+=u),String(s[0]).length==t){for(t=0;t<s.length;t++)if((n=s[t])<0||n>=c||n!==r(n))break e;if(0!==n)return!0}}}else if(null===s&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},q.maximum=q.max=function(){return W(arguments,-1)},q.minimum=q.min=function(){return W(arguments,1)},q.random=(k=9007199254740992,P=Math.random()*k&2097151?function(){return r(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,s,o,c,l=0,f=[],m=new q(x);if(null==e?e=R:b(e,0,h),o=a(e/u),G)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));l<o;)(c=131072*t[l]+(t[l+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[l]=n[0],t[l+1]=n[1]):(f.push(c%1e14),l+=2);l=o/2}else{if(!crypto.randomBytes)throw G=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);l<o;)(c=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(f.push(c%1e14),l+=7);l=o/7}if(!G)for(;l<o;)(c=P())<9e15&&(f[l++]=c%1e14);for(o=f[--l],e%=u,o&&e&&(c=d[u-e],f[l]=r(o/c)*c);0===f[l];f.pop(),l--);if(l<0)f=[s=0];else{for(s=-1;0===f[0];f.splice(0,1),s-=u);for(l=1,c=f[0];c>=10;c/=10,l++);l<u&&(s-=u-l)}return m.e=s,m.c=f,m}),q.sum=function(){for(var e=1,t=arguments,n=new q(t[0]);e<t.length;)n=n.plus(t[e++]);return n},S=function(){var e="0123456789";function t(e,t,n,s){for(var a,r,i=[0],o=0,c=e.length;o<c;){for(r=i.length;r--;i[r]*=t);for(i[0]+=s.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(s,a,r,i,o){var c,u,l,d,f,h,m,g,b=s.indexOf("."),y=R,w=O;for(b>=0&&(d=B,B=0,s=s.replace(".",""),h=(g=new q(a)).pow(s.length-b),B=d,g.c=t(T(p(h.c),h.e,"0"),10,r,e),g.e=g.c.length),l=d=(m=t(s,a,r,o?(c=H,e):(c=e,H))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(b<0?--l:(h.c=m,h.e=l,h.s=i,m=(h=n(h,g,y,w,r)).c,f=h.r,l=h.e),b=m[u=l+y+1],d=r/2,f=f||u<0||null!=m[u+1],f=w<4?(null!=b||f)&&(0==w||w==(h.s<0?3:2)):b>d||b==d&&(4==w||f||6==w&&1&m[u-1]||w==(h.s<0?8:7)),u<1||!m[0])s=f?T(c.charAt(1),-y,c.charAt(0)):c.charAt(0);else{if(m.length=u,f)for(--r;++m[--u]>r;)m[u]=0,u||(++l,m=[1].concat(m));for(d=m.length;!m[--d];);for(b=0,s="";b<=d;s+=c.charAt(m[b++]));s=T(s,l,c.charAt(0))}return s}}(),n=function(){function e(e,t,n){var s,a,r,i,o=0,c=e.length,u=t%f,l=t/f|0;for(e=e.slice();c--;)o=((a=u*(r=e[c]%f)+(s=l*r+(i=e[c]/f|0)*u)%f*f+o)/n|0)+(s/f|0)+l*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,s){var a,r;if(n!=s)r=n>s?1:-1;else for(a=r=0;a<n;a++)if(e[a]!=t[a]){r=e[a]>t[a]?1:-1;break}return r}function n(e,t,n,s){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*s+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(s,a,i,o,l){var d,f,h,p,g,b,y,w,T,S,E,k,P,v,I,_,A,C=s.s==a.s?1:-1,j=s.c,x=a.c;if(!(j&&j[0]&&x&&x[0]))return new q(s.s&&a.s&&(j?!x||j[0]!=x[0]:x)?j&&0==j[0]||!x?0*C:C/0:NaN);for(T=(w=new q(C)).c=[],C=i+(f=s.e-a.e)+1,l||(l=c,f=m(s.e/u)-m(a.e/u),C=C/u|0),h=0;x[h]==(j[h]||0);h++);if(x[h]>(j[h]||0)&&f--,C<0)T.push(1),p=!0;else{for(v=j.length,_=x.length,h=0,C+=2,(g=r(l/(x[0]+1)))>1&&(x=e(x,g,l),j=e(j,g,l),_=x.length,v=j.length),P=_,E=(S=j.slice(0,_)).length;E<_;S[E++]=0);A=x.slice(),A=[0].concat(A),I=x[0],x[1]>=l/2&&I++;do{if(g=0,(d=t(x,S,_,E))<0){if(k=S[0],_!=E&&(k=k*l+(S[1]||0)),(g=r(k/I))>1)for(g>=l&&(g=l-1),y=(b=e(x,g,l)).length,E=S.length;1==t(b,S,y,E);)g--,n(b,_<y?A:x,y,l),y=b.length,d=1;else 0==g&&(d=g=1),y=(b=x.slice()).length;if(y<E&&(b=[0].concat(b)),n(S,b,E,l),E=S.length,-1==d)for(;t(x,S,_,E)<1;)g++,n(S,_<E?A:x,E,l),E=S.length}else 0===d&&(g++,S=[0]);T[h++]=g,S[0]?S[E++]=j[P]||0:(S=[j[P]],E=1)}while((P++<v||null!=S[0])&&C--);p=null!=S[0],T[0]||T.splice(0,1)}if(l==c){for(h=1,C=T[0];C>=10;C/=10,h++);V(w,i+(w.e=h+f*u-1)+1,o,p)}else w.e=f,w.r=+p;return w}}(),v=/^(-?)0([xbo])(?=\w[\w.]*$)/i,I=/^([^.]+)\.$/,_=/^\.([^.]+)$/,A=/^-?(Infinity|NaN)$/,C=/^\s*\+(?=[\w.])|^\s+|\s+$/g,E=function(e,t,n,s){var a,r=n?t:t.replace(C,"");if(A.test(r))e.s=isNaN(r)?null:r<0?-1:1;else{if(!n&&(r=r.replace(v,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,s&&s!=a?e:t}),s&&(a=s,r=r.replace(I,"$1").replace(_,"0.$1")),t!=r))return new q(r,a);if(q.DEBUG)throw Error(i+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},j.absoluteValue=j.abs=function(){var e=new q(this);return e.s<0&&(e.s=1),e},j.comparedTo=function(e,t){return g(this,new q(e,t))},j.decimalPlaces=j.dp=function(e,t){var n,s,a,r=this;if(null!=e)return b(e,0,h),null==t?t=O:b(t,0,8),V(new q(r),e+r.e+1,t);if(!(n=r.c))return null;if(s=((a=n.length-1)-m(this.e/u))*u,a=n[a])for(;a%10==0;a/=10,s--);return s<0&&(s=0),s},j.dividedBy=j.div=function(e,t){return n(this,new q(e,t),R,O)},j.dividedToIntegerBy=j.idiv=function(e,t){return n(this,new q(e,t),0,1)},j.exponentiatedBy=j.pow=function(e,t){var n,s,o,c,l,d,f,h,m=this;if((e=new q(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+J(e));if(null!=t&&(t=new q(t)),l=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return h=new q(Math.pow(+J(m),l?e.s*(2-y(e)):+J(e))),t?h.mod(t):h;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new q(NaN);(s=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||l&&m.c[1]>=24e7:m.c[0]<8e13||l&&m.c[0]<=9999975e7)))return c=m.s<0&&y(e)?-0:0,m.e>-1&&(c=1/c),new q(d?1/c:c);B&&(c=a(B/u+2))}for(l?(n=new q(.5),d&&(e.s=1),f=y(e)):f=(o=Math.abs(+J(e)))%2,h=new q(x);;){if(f){if(!(h=h.times(m)).c)break;c?h.c.length>c&&(h.c.length=c):s&&(h=h.mod(t))}if(o){if(0===(o=r(o/2)))break;f=o%2}else if(V(e=e.times(n),e.e+1,1),e.e>14)f=y(e);else{if(0===(o=+J(e)))break;f=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):s&&(m=m.mod(t))}return s?h:(d&&(h=x.div(h)),t?h.mod(t):c?V(h,B,O,undefined):h)},j.integerValue=function(e){var t=new q(this);return null==e?e=O:b(e,0,8),V(t,t.e+1,e)},j.isEqualTo=j.eq=function(e,t){return 0===g(this,new q(e,t))},j.isFinite=function(){return!!this.c},j.isGreaterThan=j.gt=function(e,t){return g(this,new q(e,t))>0},j.isGreaterThanOrEqualTo=j.gte=function(e,t){return 1===(t=g(this,new q(e,t)))||0===t},j.isInteger=function(){return!!this.c&&m(this.e/u)>this.c.length-2},j.isLessThan=j.lt=function(e,t){return g(this,new q(e,t))<0},j.isLessThanOrEqualTo=j.lte=function(e,t){return-1===(t=g(this,new q(e,t)))||0===t},j.isNaN=function(){return!this.s},j.isNegative=function(){return this.s<0},j.isPositive=function(){return this.s>0},j.isZero=function(){return!!this.c&&0==this.c[0]},j.minus=function(e,t){var n,s,a,r,i=this,o=i.s;if(t=(e=new q(e,t)).s,!o||!t)return new q(NaN);if(o!=t)return e.s=-t,i.plus(e);var l=i.e/u,d=e.e/u,f=i.c,h=e.c;if(!l||!d){if(!f||!h)return f?(e.s=-t,e):new q(h?i:NaN);if(!f[0]||!h[0])return h[0]?(e.s=-t,e):new q(f[0]?i:3==O?-0:0)}if(l=m(l),d=m(d),f=f.slice(),o=l-d){for((r=o<0)?(o=-o,a=f):(d=l,a=h),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(s=(r=(o=f.length)<(t=h.length))?o:t,o=t=0;t<s;t++)if(f[t]!=h[t]){r=f[t]<h[t];break}if(r&&(a=f,f=h,h=a,e.s=-e.s),(t=(s=h.length)-(n=f.length))>0)for(;t--;f[n++]=0);for(t=c-1;s>o;){if(f[--s]<h[s]){for(n=s;n&&!f[--n];f[n]=t);--f[n],f[s]+=c}f[s]-=h[s]}for(;0==f[0];f.splice(0,1),--d);return f[0]?z(e,f,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},j.modulo=j.mod=function(e,t){var s,a,r=this;return e=new q(e,t),!r.c||!e.s||e.c&&!e.c[0]?new q(NaN):!e.c||r.c&&!r.c[0]?new q(r):(9==D?(a=e.s,e.s=1,s=n(r,e,0,3),e.s=a,s.s*=a):s=n(r,e,0,D),(e=r.minus(s.times(e))).c[0]||1!=D||(e.s=r.s),e)},j.multipliedBy=j.times=function(e,t){var n,s,a,r,i,o,l,d,h,p,g,b,y,w,T,S=this,E=S.c,k=(e=new q(e,t)).c;if(!(E&&k&&E[0]&&k[0]))return!S.s||!e.s||E&&!E[0]&&!k||k&&!k[0]&&!E?e.c=e.e=e.s=null:(e.s*=S.s,E&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(s=m(S.e/u)+m(e.e/u),e.s*=S.s,(l=E.length)<(p=k.length)&&(y=E,E=k,k=y,a=l,l=p,p=a),a=l+p,y=[];a--;y.push(0));for(w=c,T=f,a=p;--a>=0;){for(n=0,g=k[a]%T,b=k[a]/T|0,r=a+(i=l);r>a;)n=((d=g*(d=E[--i]%T)+(o=b*d+(h=E[i]/T|0)*g)%T*T+y[r]+n)/w|0)+(o/T|0)+b*h,y[r--]=d%w;y[r]=n}return n?++s:y.splice(0,1),z(e,y,s)},j.negated=function(){var e=new q(this);return e.s=-e.s||null,e},j.plus=function(e,t){var n,s=this,a=s.s;if(t=(e=new q(e,t)).s,!a||!t)return new q(NaN);if(a!=t)return e.s=-t,s.minus(e);var r=s.e/u,i=e.e/u,o=s.c,l=e.c;if(!r||!i){if(!o||!l)return new q(a/0);if(!o[0]||!l[0])return l[0]?e:new q(o[0]?s:0*a)}if(r=m(r),i=m(i),o=o.slice(),a=r-i){for(a>0?(i=r,n=l):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=l.length)<0&&(n=l,l=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+l[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),z(e,o,i)},j.precision=j.sd=function(e,t){var n,s,a,r=this;if(null!=e&&e!==!!e)return b(e,1,h),null==t?t=O:b(t,0,8),V(new q(r),e,t);if(!(n=r.c))return null;if(s=(a=n.length-1)*u+1,a=n[a]){for(;a%10==0;a/=10,s--);for(a=n[0];a>=10;a/=10,s++);}return e&&r.e+1>s&&(s=r.e+1),s},j.shiftedBy=function(e){return b(e,-9007199254740991,l),this.times("1e"+e)},j.squareRoot=j.sqrt=function(){var e,t,s,a,r,i=this,o=i.c,c=i.s,u=i.e,l=R+4,d=new q("0.5");if(1!==c||!o||!o[0])return new q(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+J(i)))||c==1/0?(((t=p(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=m((u+1)/2)-(u<0||u%2),s=new q(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):s=new q(c+""),s.c[0])for((c=(u=s.e)+l)<3&&(c=0);;)if(r=s,s=d.times(r.plus(n(i,r,l,1))),p(r.c).slice(0,c)===(t=p(s.c)).slice(0,c)){if(s.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(V(s,s.e+R+2,1),e=!s.times(s).eq(i));break}if(!a&&(V(r,r.e+R+2,0),r.times(r).eq(i))){s=r;break}l+=4,c+=4,a=1}return V(s,s.e+R+1,O,e)},j.toExponential=function(e,t){return null!=e&&(b(e,0,h),e++),K(this,e,t,1)},j.toFixed=function(e,t){return null!=e&&(b(e,0,h),e=e+this.e+1),K(this,e,t)},j.toFormat=function(e,t,n){var s,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(s=a.toFixed(e,t),a.c){var r,o=s.split("."),c=+n.groupSize,u=+n.secondaryGroupSize,l=n.groupSeparator||"",d=o[0],f=o[1],h=a.s<0,m=h?d.slice(1):d,p=m.length;if(u&&(r=c,c=u,u=r,p-=r),c>0&&p>0){for(r=p%c||c,d=m.substr(0,r);r<p;r+=c)d+=l+m.substr(r,c);u>0&&(d+=l+m.slice(r)),h&&(d="-"+d)}s=f?d+(n.decimalSeparator||"")+((u=+n.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):f):d}return(n.prefix||"")+s+(n.suffix||"")},j.toFraction=function(e){var t,s,a,r,o,c,l,f,h,m,g,b,y=this,w=y.c;if(null!=e&&(!(l=new q(e)).isInteger()&&(l.c||1!==l.s)||l.lt(x)))throw Error(i+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+J(l));if(!w)return new q(y);for(t=new q(x),h=s=new q(x),a=f=new q(x),b=p(w),o=t.e=b.length-y.e-1,t.c[0]=d[(c=o%u)<0?u+c:c],e=!e||l.comparedTo(t)>0?o>0?t:h:l,c=L,L=1/0,l=new q(b),f.c[0]=0;m=n(l,t,0,1),1!=(r=s.plus(m.times(a))).comparedTo(e);)s=a,a=r,h=f.plus(m.times(r=h)),f=r,t=l.minus(m.times(r=t)),l=r;return r=n(e.minus(s),a,0,1),f=f.plus(r.times(h)),s=s.plus(r.times(a)),f.s=h.s=y.s,g=n(h,a,o*=2,O).minus(y).abs().comparedTo(n(f,s,o,O).minus(y).abs())<1?[h,a]:[f,s],L=c,g},j.toNumber=function(){return+J(this)},j.toPrecision=function(e,t){return null!=e&&b(e,1,h),K(this,e,t,2)},j.toString=function(e){var t,n=this,s=n.s,a=n.e;return null===a?s?(t="Infinity",s<0&&(t="-"+t)):t="NaN":(null==e?t=a<=F||a>=N?w(p(n.c),a):T(p(n.c),a,"0"):10===e&&$?t=T(p((n=V(new q(n),R+a+1,O)).c),n.e,"0"):(b(e,2,H.length,"Base"),t=S(T(p(n.c),a,"0"),10,e,s,!0)),s<0&&n.c[0]&&(t="-"+t)),t},j.valueOf=j.toJSON=function(){return J(this)},j._isBigNumber=!0,null!=t&&q.set(t),q}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/transaction-pay-controller>bignumber.js",file:"node_modules/@metamask/transaction-pay-controller/node_modules/bignumber.js/bignumber.js"}],[354,{"@metamask/utils":3554,loglevel:5247,"webextension-polyfill":6163},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=i(e("webextension-polyfill")),a=i(e("loglevel")),r=e("@metamask/utils");function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return e.get(d(e,t))}function l(e,t,n){return e.set(d(e,t),n),n}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const{sentry:f}=globalThis;var h=new WeakMap;n.default=class{constructor(){c(this,"isSupported",void 0),o(this,h,new Set),this.isSupported=Boolean(s.default.storage.local),this.isSupported||a.default.error("Storage local API not available.")}async get(){if(!this.isSupported)return a.default.error("Storage local API not available."),null;const{local:e}=s.default.storage;console.time("[ExtensionStore]: Reading from local store");const t=await e.get(["manifest"]);if((0,r.isObject)(t)&&(0,r.hasProperty)(t,"manifest")&&Array.isArray(t.manifest)){const n=t.manifest,s=await e.get(n);l(h,this,new Set(n));const{meta:a}=s;return delete s.meta,console.timeEnd("[ExtensionStore]: Reading from local store"),{data:s,meta:a}}const n=await e.get(["data","meta"]);if((0,r.isObject)(n))for(const e of Object.keys(n))u(h,this).add(e);return console.timeEnd("[ExtensionStore]: Reading from local store"),n}async setKeyValues(e){if(!this.isSupported)throw new Error("MetaMask - cannot persist state to local store as this browser does not support this action");const{local:t}=s.default.storage,n=Object.create(null),r=[],i=[];for(const[t,s]of e){const e=u(h,this).has(t);if(void 0===s){if(!e){a.default.warn("[ExtensionStore]: Trying to remove a key that does not exist in manifest:",t);continue}i.push({op:"delete",key:t}),r.push(t)}else e||i.push({op:"add",key:t}),n[t]=s}let o;if(i.length>0){o=new Set(u(h,this));for(const{op:e,key:t}of i)o[e](t);n.manifest=Array.from(o)}console.time("[ExtensionStore]: Writing to local store"),a.default.info(`[ExtensionStore]: Writing ${Object.keys(n).length} keys to local store`),await t.set(n),o&&l(h,this,o),a.default.info(`[ExtensionStore]: Removing ${r.length} keys from local store`);try{await t.remove(r)}catch(e){if(f){const t=new AggregateError([e],"Error removing keys from local store");f.captureException(t)}a.default.error("[ExtensionStore]: Error removing keys from local store:",e)}console.timeEnd("[ExtensionStore]: Writing to local store")}async set({data:e,meta:t}){if(!this.isSupported)throw new Error("MetaMask - cannot persist state to local store as this browser does not support this action");const{local:n}=s.default.storage;console.time("[ExtensionStore]: Overwriting local store"),await n.set({data:e,meta:t}),u(h,this).add("data"),u(h,this).add("meta"),console.timeEnd("[ExtensionStore]: Overwriting local store")}async reset(){if(!this.isSupported)throw new Error("MetaMask - cannot persist state to local store as this browser does not support this action");const{local:e}=s.default.storage;return await e.remove(["manifest",...u(h,this)])}}}}},{package:"$root$",file:"app/scripts/lib/stores/extension-store.ts"}],[3543,{"./errors.cjs":3551,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.assertExhaustive=n.assertStruct=n.assert=n.AssertionError=void 0;const s=e("@metamask/superstruct"),a=e("./errors.cjs");function r(e,t){return n=e,Boolean("string"==typeof n?.prototype?.constructor?.name)?new e({message:t}):e({message:t});var n}class i extends Error{constructor(e){super(e.message),this.code="ERR_ASSERTION"}}n.AssertionError=i,n.assert=function(e,t="Assertion failed.",n=i){if(!e){if(t instanceof Error)throw t;throw r(n,t)}},n.assertStruct=function(e,t,n="Assertion failed",o=i){try{(0,s.assert)(e,t)}catch(e){throw r(o,`${n}: ${function(e){return(0,a.getErrorMessage)(e).replace(/\.$/u,"")}(e)}.`)}},n.assertExhaustive=function(e){throw new Error("Invalid branch reached. Should be detected during compilation.")}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/assert.cjs"}],[3544,{"./assert.cjs":3543,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.base64=void 0;const s=e("@metamask/superstruct"),a=e("./assert.cjs");n.base64=(e,t={})=>{const n=t.paddingRequired??!1,r=t.characterSet??"base64";let i,o;return"base64"===r?i=String.raw`[A-Za-z0-9+\/]`:((0,a.assert)("base64url"===r),i=String.raw`[-_A-Za-z0-9]`),o=n?new RegExp(`^(?:${i}{4})*(?:${i}{3}=|${i}{2}==)?$`,"u"):new RegExp(`^(?:${i}{4})*(?:${i}{2,3}|${i}{3}=|${i}{2}==)?$`,"u"),(0,s.pattern)(e,o)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/base64.cjs"}],[3545,{"./assert.cjs":3543,"./hex.cjs":3553,"@scure/base":3634,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.areUint8ArraysEqual=n.createDataView=n.concatBytes=n.valueToBytes=n.base64ToBytes=n.stringToBytes=n.numberToBytes=n.signedBigIntToBytes=n.bigIntToBytes=n.hexToBytes=n.bytesToBase64=n.bytesToString=n.bytesToNumber=n.bytesToSignedBigInt=n.bytesToBigInt=n.bytesToHex=n.assertIsBytes=n.isBytes=void 0;const s=e("@scure/base"),a=e("./assert.cjs"),r=e("./hex.cjs");const i=function(){const e=[];return()=>{if(0===e.length)for(let t=0;t<256;t++)e.push(t.toString(16).padStart(2,"0"));return e}}();function o(e){return e instanceof Uint8Array}function c(e){(0,a.assert)(o(e),"Value must be a Uint8Array.")}function u(e){if(c(e),0===e.length)return"0x";const t=i(),n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=t[e[s]];return(0,r.add0x)(n.join(""))}function l(e){c(e);const t=u(e);return BigInt(t)}function d(e){if("0x"===e?.toLowerCase?.())return new Uint8Array;(0,r.assertIsHexString)(e);const t=(0,r.remove0x)(e).toLowerCase(),n=t.length%2==0?t:`0${t}`,s=new Uint8Array(n.length/2);for(let e=0;e<s.length;e++){const t=n.charCodeAt(2*e),a=n.charCodeAt(2*e+1),r=t-(t<58?48:87),i=a-(a<58?48:87);s[e]=16*r+i}return s}function f(e){(0,a.assert)("bigint"==typeof e,"Value must be a bigint."),(0,a.assert)(e>=BigInt(0),"Value must be a non-negative bigint.");return d(e.toString(16))}function h(e){(0,a.assert)("number"==typeof e,"Value must be a number."),(0,a.assert)(e>=0,"Value must be a non-negative number."),(0,a.assert)(Number.isSafeInteger(e),"Value is not a safe integer. Use `bigIntToBytes` instead.");return d(e.toString(16))}function m(e){return(0,a.assert)("string"==typeof e,"Value must be a string."),(new TextEncoder).encode(e)}function p(e){if("bigint"==typeof e)return f(e);if("number"==typeof e)return h(e);if("string"==typeof e)return e.startsWith("0x")?d(e):m(e);if(o(e))return e;throw new TypeError(`Unsupported value type: "${typeof e}".`)}n.isBytes=o,n.assertIsBytes=c,n.bytesToHex=u,n.bytesToBigInt=l,n.bytesToSignedBigInt=function(e){c(e);let t=BigInt(0);for(const n of e)t=(t<<BigInt(8))+BigInt(n);return BigInt.asIntN(8*e.length,t)},n.bytesToNumber=function(e){c(e);const t=l(e);return(0,a.assert)(t<=BigInt(Number.MAX_SAFE_INTEGER),"Number is not a safe integer. Use `bytesToBigInt` instead."),Number(t)},n.bytesToString=function(e){return c(e),(new TextDecoder).decode(e)},n.bytesToBase64=function(e){return c(e),s.base64.encode(e)},n.hexToBytes=d,n.bigIntToBytes=f,n.signedBigIntToBytes=function(e,t){(0,a.assert)("bigint"==typeof e,"Value must be a bigint."),(0,a.assert)("number"==typeof t,"Byte length must be a number."),(0,a.assert)(t>0,"Byte length must be greater than 0."),(0,a.assert)(function(e,t){(0,a.assert)(t>0);const n=e>>BigInt(31);return!((~e&n)+(e&~n)>>BigInt(8*t-1))}(e,t),"Byte length is too small to represent the given value.");let n=e;const s=new Uint8Array(t);for(let e=0;e<s.length;e++)s[e]=Number(BigInt.asUintN(8,n)),n>>=BigInt(8);return s.reverse()},n.numberToBytes=h,n.stringToBytes=m,n.base64ToBytes=function(e){return(0,a.assert)("string"==typeof e,"Value must be a string."),s.base64.decode(e)},n.valueToBytes=p,n.concatBytes=function(e){const t=new Array(e.length);let n=0;for(let s=0;s<e.length;s++){const a=p(e[s]);t[s]=a,n+=a.length}const s=new Uint8Array(n);for(let e=0,n=0;e<t.length;e++)s.set(t[e],n),n+=t[e].length;return s},n.createDataView=function(e){if(void 0!==t&&e instanceof t){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return new DataView(t)}return new DataView(e.buffer,e.byteOffset,e.byteLength)},n.areUint8ArraysEqual=function(e,t){let n=e.byteLength^t.byteLength;const s=Math.max(e.byteLength,t.byteLength);for(let a=0;a<s;a++){n|=(e[a]??0)^(t[a]??0)}return 0===n}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/bytes.cjs"}],[3546,{"./superstruct.cjs":3562},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toCaipAssetId=n.toCaipAssetType=n.toCaipAccountId=n.toCaipChainId=n.parseCaipAssetId=n.parseCaipAssetType=n.parseCaipAccountId=n.parseCaipChainId=n.isCaipAssetId=n.isCaipAssetType=n.isCaipTokenId=n.isCaipAssetReference=n.isCaipAssetNamespace=n.isCaipAccountAddress=n.isCaipAccountId=n.isCaipReference=n.isCaipNamespace=n.isCaipChainId=n.KnownCaipNamespace=n.CaipAssetTypeOrIdStruct=n.CaipAssetIdStruct=n.CaipAssetTypeStruct=n.CaipTokenIdStruct=n.CaipAssetReferenceStruct=n.CaipAssetNamespaceStruct=n.CaipAccountAddressStruct=n.CaipAccountIdStruct=n.CaipReferenceStruct=n.CaipNamespaceStruct=n.CaipChainIdStruct=n.CAIP_ASSET_ID_REGEX=n.CAIP_ASSET_TYPE_REGEX=n.CAIP_TOKEN_ID_REGEX=n.CAIP_ASSET_REFERENCE_REGEX=n.CAIP_ASSET_NAMESPACE_REGEX=n.CAIP_ACCOUNT_ADDRESS_REGEX=n.CAIP_ACCOUNT_ID_REGEX=n.CAIP_REFERENCE_REGEX=n.CAIP_NAMESPACE_REGEX=n.CAIP_CHAIN_ID_REGEX=void 0;const s=e("./superstruct.cjs");n.CAIP_CHAIN_ID_REGEX=/^(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32})$/u,n.CAIP_NAMESPACE_REGEX=/^[-a-z0-9]{3,8}$/u,n.CAIP_REFERENCE_REGEX=/^[-_a-zA-Z0-9]{1,32}$/u,n.CAIP_ACCOUNT_ID_REGEX=/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32})):(?<accountAddress>[-.%a-zA-Z0-9]{1,128})$/u,n.CAIP_ACCOUNT_ADDRESS_REGEX=/^[-.%a-zA-Z0-9]{1,128}$/u,n.CAIP_ASSET_NAMESPACE_REGEX=/^[-a-z0-9]{3,8}$/u,n.CAIP_ASSET_REFERENCE_REGEX=/^[-.%a-zA-Z0-9]{1,128}$/u,n.CAIP_TOKEN_ID_REGEX=/^[-.%a-zA-Z0-9]{1,78}$/u,n.CAIP_ASSET_TYPE_REGEX=/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32}))\/(?<assetNamespace>[-a-z0-9]{3,8}):(?<assetReference>[-.%a-zA-Z0-9]{1,128})$/u,n.CAIP_ASSET_ID_REGEX=/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32}))\/(?<assetNamespace>[-a-z0-9]{3,8}):(?<assetReference>[-.%a-zA-Z0-9]{1,128})\/(?<tokenId>[-.%a-zA-Z0-9]{1,78})$/u;function a(e){return"string"==typeof e&&n.CAIP_NAMESPACE_REGEX.test(e)}function r(e){return"string"==typeof e&&n.CAIP_REFERENCE_REGEX.test(e)}function i(e){return"string"==typeof e&&n.CAIP_ACCOUNT_ADDRESS_REGEX.test(e)}function o(e){return"string"==typeof e&&n.CAIP_ASSET_NAMESPACE_REGEX.test(e)}function c(e){return"string"==typeof e&&n.CAIP_ASSET_REFERENCE_REGEX.test(e)}function u(e){return"string"==typeof e&&n.CAIP_TOKEN_ID_REGEX.test(e)}n.CaipChainIdStruct=(0,s.definePattern)("CaipChainId",n.CAIP_CHAIN_ID_REGEX),n.CaipNamespaceStruct=(0,s.definePattern)("CaipNamespace",n.CAIP_NAMESPACE_REGEX),n.CaipReferenceStruct=(0,s.definePattern)("CaipReference",n.CAIP_REFERENCE_REGEX),n.CaipAccountIdStruct=(0,s.definePattern)("CaipAccountId",n.CAIP_ACCOUNT_ID_REGEX),n.CaipAccountAddressStruct=(0,s.definePattern)("CaipAccountAddress",n.CAIP_ACCOUNT_ADDRESS_REGEX),n.CaipAssetNamespaceStruct=(0,s.definePattern)("CaipAssetNamespace",n.CAIP_ASSET_NAMESPACE_REGEX),n.CaipAssetReferenceStruct=(0,s.definePattern)("CaipAssetReference",n.CAIP_ASSET_REFERENCE_REGEX),n.CaipTokenIdStruct=(0,s.definePattern)("CaipTokenId",n.CAIP_TOKEN_ID_REGEX),n.CaipAssetTypeStruct=(0,s.definePattern)("CaipAssetType",n.CAIP_ASSET_TYPE_REGEX),n.CaipAssetIdStruct=(0,s.definePattern)("CaipAssetId",n.CAIP_ASSET_ID_REGEX),n.CaipAssetTypeOrIdStruct=(0,s.definePattern)("CaipAssetTypeOrId",/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32}))\/(?<assetNamespace>[-a-z0-9]{3,8}):(?<assetReference>[-.%a-zA-Z0-9]{1,128})(\/(?<tokenId>[-.%a-zA-Z0-9]{1,78}))?$/u),function(e){e.Bip122="bip122",e.Solana="solana",e.Tron="tron",e.Eip155="eip155",e.Wallet="wallet"}(n.KnownCaipNamespace||(n.KnownCaipNamespace={})),n.isCaipChainId=function(e){return"string"==typeof e&&n.CAIP_CHAIN_ID_REGEX.test(e)},n.isCaipNamespace=a,n.isCaipReference=r,n.isCaipAccountId=function(e){return"string"==typeof e&&n.CAIP_ACCOUNT_ID_REGEX.test(e)},n.isCaipAccountAddress=i,n.isCaipAssetNamespace=o,n.isCaipAssetReference=c,n.isCaipTokenId=u,n.isCaipAssetType=function(e){return"string"==typeof e&&n.CAIP_ASSET_TYPE_REGEX.test(e)},n.isCaipAssetId=function(e){return"string"==typeof e&&n.CAIP_ASSET_ID_REGEX.test(e)},n.parseCaipChainId=function(e){const t=n.CAIP_CHAIN_ID_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP chain ID.");return{namespace:t.groups.namespace,reference:t.groups.reference}},n.parseCaipAccountId=function(e){const t=n.CAIP_ACCOUNT_ID_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP account ID.");return{address:t.groups.accountAddress,chainId:t.groups.chainId,chain:{namespace:t.groups.namespace,reference:t.groups.reference}}},n.parseCaipAssetType=function(e){const t=n.CAIP_ASSET_TYPE_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP asset type.");return{assetNamespace:t.groups.assetNamespace,assetReference:t.groups.assetReference,chainId:t.groups.chainId,chain:{namespace:t.groups.namespace,reference:t.groups.reference}}},n.parseCaipAssetId=function(e){const t=n.CAIP_ASSET_ID_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP asset ID.");return{assetNamespace:t.groups.assetNamespace,assetReference:t.groups.assetReference,tokenId:t.groups.tokenId,chainId:t.groups.chainId,chain:{namespace:t.groups.namespace,reference:t.groups.reference}}},n.toCaipChainId=function(e,t){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!r(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);return`${e}:${t}`},n.toCaipAccountId=function(e,t,s){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!r(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);if(!i(s))throw new Error(`Invalid "accountAddress", must match: ${n.CAIP_ACCOUNT_ADDRESS_REGEX.toString()}`);return`${e}:${t}:${s}`},n.toCaipAssetType=function(e,t,s,i){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!r(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);if(!o(s))throw new Error(`Invalid "assetNamespace", must match: ${n.CAIP_ASSET_NAMESPACE_REGEX.toString()}`);if(!c(i))throw new Error(`Invalid "assetReference", must match: ${n.CAIP_ASSET_REFERENCE_REGEX.toString()}`);return`${e}:${t}/${s}:${i}`},n.toCaipAssetId=function(e,t,s,i,l){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!r(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);if(!o(s))throw new Error(`Invalid "assetNamespace", must match: ${n.CAIP_ASSET_NAMESPACE_REGEX.toString()}`);if(!c(i))throw new Error(`Invalid "assetReference", must match: ${n.CAIP_ASSET_REFERENCE_REGEX.toString()}`);if(!u(l))throw new Error(`Invalid "tokenId", must match: ${n.CAIP_TOKEN_ID_REGEX.toString()}`);return`${e}:${t}/${s}:${i}/${l}`}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/caip-types.cjs"}],[3547,{"./base64.cjs":3544,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ChecksumStruct=void 0;const s=e("@metamask/superstruct"),a=e("./base64.cjs");n.ChecksumStruct=(0,s.size)((0,a.base64)((0,s.string)(),{paddingRequired:!0}),44,44)}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/checksum.cjs"}],[3548,{"./assert.cjs":3543,"./bytes.cjs":3545,"./hex.cjs":3553,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createHex=n.createBytes=n.createBigInt=n.createNumber=void 0;const s=e("@metamask/superstruct"),a=e("./assert.cjs"),r=e("./bytes.cjs"),i=e("./hex.cjs"),o=(0,s.union)([(0,s.number)(),(0,s.bigint)(),(0,s.string)(),i.StrictHexStruct]),c=(0,s.coerce)((0,s.number)(),o,Number),u=(0,s.coerce)((0,s.bigint)(),o,BigInt),l=((0,s.union)([i.StrictHexStruct,(0,s.instance)(Uint8Array)]),(0,s.coerce)((0,s.instance)(Uint8Array),(0,s.union)([i.StrictHexStruct]),r.hexToBytes)),d=(0,s.coerce)(i.StrictHexStruct,(0,s.instance)(Uint8Array),r.bytesToHex);n.createNumber=function(e){try{const t=(0,s.create)(e,c);return(0,a.assert)(Number.isFinite(t),`Expected a number-like value, got "${e}".`),t}catch(t){if(t instanceof s.StructError)throw new Error(`Expected a number-like value, got "${e}".`);throw t}},n.createBigInt=function(e){try{return(0,s.create)(e,u)}catch(e){if(e instanceof s.StructError)throw new Error(`Expected a number-like value, got "${String(e.value)}".`);throw e}},n.createBytes=function(e){if("string"==typeof e&&"0x"===e.toLowerCase())return new Uint8Array;try{return(0,s.create)(e,l)}catch(e){if(e instanceof s.StructError)throw new Error(`Expected a bytes-like value, got "${String(e.value)}".`);throw e}},n.createHex=function(e){if(e instanceof Uint8Array&&0===e.length||"string"==typeof e&&"0x"===e.toLowerCase())return"0x";try{return(0,s.create)(e,d)}catch(e){if(e instanceof s.StructError)throw new Error(`Expected a bytes-like value, got "${String(e.value)}".`);throw e}}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/coercers.cjs"}],[3549,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,r=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},i=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.FrozenSet=n.FrozenMap=void 0;class o{get size(){return r(this,s,"f").size}[(s=new WeakMap,Symbol.iterator)](){return r(this,s,"f")[Symbol.iterator]()}constructor(e){s.set(this,void 0),i(this,s,new Map(e),"f"),Object.freeze(this)}entries(){return r(this,s,"f").entries()}forEach(e,t){return r(this,s,"f").forEach((n,s,a)=>e.call(t,n,s,this))}get(e){return r(this,s,"f").get(e)}has(e){return r(this,s,"f").has(e)}keys(){return r(this,s,"f").keys()}values(){return r(this,s,"f").values()}toString(){return`FrozenMap(${this.size}) {${this.size>0?` ${[...this.entries()].map(([e,t])=>`${String(e)} => ${String(t)}`).join(", ")} `:""}}`}}n.FrozenMap=o;class c{get size(){return r(this,a,"f").size}[(a=new WeakMap,Symbol.iterator)](){return r(this,a,"f")[Symbol.iterator]()}constructor(e){a.set(this,void 0),i(this,a,new Set(e),"f"),Object.freeze(this)}entries(){return r(this,a,"f").entries()}forEach(e,t){return r(this,a,"f").forEach((n,s,a)=>e.call(t,n,s,this))}has(e){return r(this,a,"f").has(e)}keys(){return r(this,a,"f").keys()}values(){return r(this,a,"f").values()}toString(){return`FrozenSet(${this.size}) {${this.size>0?` ${[...this.values()].map(e=>String(e)).join(", ")} `:""}}`}}n.FrozenSet=c,Object.freeze(o),Object.freeze(o.prototype),Object.freeze(c),Object.freeze(c.prototype)}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/collections.cjs"}],[355,{"../../../../shared/modules/fetch-with-timeout":6322,"./extension-store":354,loglevel:5247},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.FixtureExtensionStore=void 0;var s,a=o(e("loglevel")),r=o(e("../../../../shared/modules/fetch-with-timeout")),i=o(e("./extension-store"));function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,s){var a=u(l(1&s?e.prototype:e),t,n);return 2&s&&"function"==typeof a?function(e){return a.apply(n,e)}:a}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var s=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(s){var a=Object.getOwnPropertyDescriptor(s,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},u.apply(null,arguments)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t,n){h(e,t),t.set(e,n)}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t){return e.get(g(e,t))}function p(e,t,n){return e.set(g(e,t),n),n}function g(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const b=(0,r.default)();var y=new WeakMap,w=new WeakMap,T=new WeakSet;class S extends i.default{constructor({initialize:e=!1}={}){var t,n;super(),h(t=this,n=T),n.add(t),f(this,y,!1),f(this,w,void 0),d(this,"isSupported",!0),e?p(w,this,g(T,this,E).call(this)):(p(w,this,Promise.resolve()),p(y,this,!0))}async setKeyValues(e){return m(y,this)||await m(w,this),super.setKeyValues(e)}async get(){return m(y,this)||await m(w,this),super.get()}async set(e){return m(y,this)||await m(w,this),super.set(e)}async reset(){p(y,this,!1),await super.reset(),p(w,this,g(T,this,E).call(this)),await m(w,this)}}async function E(){try{const t=await b("http://localhost:12345/state.json");if(t.ok){var e;const n=await t.json();if("split"===(null===(e=n.meta)||void 0===e?void 0:e.storageKind)){const e=new Map(Object.entries(n.data));e.set("meta",n.meta),await c(s.prototype,"setKeyValues",this,2)([e])}else await c(s.prototype,"set",this,2)([n])}else a.default.debug(`Received response with a status of ${t.status} ${t.statusText}`)}catch(e){console.log("error",e),e instanceof Error?a.default.debug(`Error loading network state: '${e.message}'`):a.default.debug("Error loading network state: An unknown error occurred")}finally{p(y,this,!0)}}n.FixtureExtensionStore=S,s=S}}},{package:"$root$",file:"app/scripts/lib/stores/fixture-extension-store.ts"}],[3550,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/encryption-types.cjs"}],[3551,{"./misc.cjs":3558,"pony-cause":5484},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.wrapError=n.getErrorMessage=n.isErrorWithStack=n.isErrorWithMessage=n.isErrorWithCode=void 0;const s=e("pony-cause"),a=e("./misc.cjs");function r(e){return"object"==typeof e&&null!==e&&"code"in e}function i(e){return"object"==typeof e&&null!==e&&"message"in e}n.isErrorWithCode=r,n.isErrorWithMessage=i,n.isErrorWithStack=function(e){return"object"==typeof e&&null!==e&&"stack"in e},n.getErrorMessage=function(e){return i(e)&&"string"==typeof e.message?e.message:(0,a.isNullOrUndefined)(e)?"":String(e)},n.wrapError=function(e,t){if((n=e)instanceof Error||(0,a.isObject)(n)&&"Error"===n.constructor.name){let n;return n=2===Error.length?new Error(t,{cause:e}):new s.ErrorWithCause(t,{cause:e}),r(e)&&(n.code=e.code),n}var n;return t.length>0?new Error(`${String(e)}: ${t}`):new Error(String(e))}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/errors.cjs"}],[3552,{"@noble/hashes/sha256":3608},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sha256=void 0;const s=e("@noble/hashes/sha256");n.sha256=async function(e){return"crypto"in globalThis&&"object"==typeof globalThis.crypto&&globalThis.crypto.subtle?.digest?new Uint8Array(await globalThis.crypto.subtle.digest("SHA-256",e)):(0,s.sha256)(e)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/hashing.cjs"}],[3553,{"./assert.cjs":3543,"@metamask/superstruct":3415,"@noble/hashes/sha3":3609,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.remove0x=n.add0x=n.isValidHexAddress=n.isValidHexAddressUnmemoized=n.isValidChecksumAddress=n.isValidChecksumAddressUnmemoized=n.getChecksumAddress=n.getChecksumAddressUnmemoized=n.assertIsStrictHexString=n.assertIsHexString=n.isHexChecksumAddress=n.isHexAddress=n.isStrictHexString=n.isHexString=n.HexChecksumAddressStruct=n.HexAddressStruct=n.StrictHexStruct=n.HexStruct=void 0;const s=e("@metamask/superstruct"),a=e("@noble/hashes/sha3"),r=e("lodash"),i=e("./assert.cjs"),o=/^(?:0x)?[0-9a-f]+$/iu,c=/^0x[0-9a-f]+$/iu,u=/^0x[0-9a-f]{40}$/u,l=/^0x[0-9a-fA-F]{40}$/u;n.HexStruct=(0,s.pattern)((0,s.string)(),o),n.StrictHexStruct=(0,s.pattern)((0,s.string)(),c),n.HexAddressStruct=(0,s.pattern)((0,s.string)(),u),n.HexChecksumAddressStruct=(0,s.pattern)((0,s.string)(),l);const d=e=>"string"==typeof e;function f(e){return d(e)&&o.test(e)}function h(e){return d(e)&&c.test(e)}function m(e){return d(e)&&u.test(e)}function p(e){return d(e)&&l.test(e)}function g(e){(0,i.assert)(p(e),"Invalid hex address.");const t=w(e).toLowerCase(),n=(0,a.keccak_256)(t),{length:s}=t,r=new Array(s);for(let e=0;e<s;e++){const s=1&e,a=n[e>>1],i=0===s?a>>4:15&a;r[e]=i>=8?t[e].toUpperCase():t[e]}return`0x${r.join("")}`}function b(e){return!!p(e)&&(0,n.getChecksumAddress)(e)===e}function y(e){return m(e)||(0,n.isValidChecksumAddress)(e)}function w(e){return e.startsWith("0x")||e.startsWith("0X")?e.substring(2):e}n.isHexString=f,n.isStrictHexString=h,n.isHexAddress=m,n.isHexChecksumAddress=p,n.assertIsHexString=function(e){(0,i.assert)(f(e),"Value must be a hexadecimal string.")},n.assertIsStrictHexString=function(e){(0,i.assert)(h(e),'Value must be a hexadecimal string, starting with "0x".')},n.getChecksumAddressUnmemoized=g,n.getChecksumAddress=(0,r.memoize)(g),n.isValidChecksumAddressUnmemoized=b,n.isValidChecksumAddress=(0,r.memoize)(b),n.isValidHexAddressUnmemoized=y,n.isValidHexAddress=(0,r.memoize)(y),n.add0x=function(e){return e.startsWith("0x")?e:e.startsWith("0X")?`0x${e.substring(2)}`:`0x${e}`},n.remove0x=w}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/hex.cjs"}],[3554,{"./assert.cjs":3543,"./base64.cjs":3544,"./bytes.cjs":3545,"./caip-types.cjs":3546,"./checksum.cjs":3547,"./coercers.cjs":3548,"./collections.cjs":3549,"./encryption-types.cjs":3550,"./errors.cjs":3551,"./hashing.cjs":3552,"./hex.cjs":3553,"./json.cjs":3555,"./keyring.cjs":3556,"./logging.cjs":3557,"./misc.cjs":3558,"./number.cjs":3559,"./opaque.cjs":3560,"./promise.cjs":3561,"./superstruct.cjs":3562,"./time.cjs":3563,"./transaction-types.cjs":3564,"./unitsConversion.cjs":3565,"./versions.cjs":3566},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.unitMap=n.getValueOfUnit=n.numberToString=n.fromWei=n.toWei=n.remove0x=n.add0x=n.isValidChecksumAddress=n.getChecksumAddress=n.isValidHexAddress=n.assertIsStrictHexString=n.assertIsHexString=n.isHexChecksumAddress=n.isHexAddress=n.isStrictHexString=n.isHexString=n.HexChecksumAddressStruct=n.HexAddressStruct=n.StrictHexStruct=n.HexStruct=void 0,a(e("./assert.cjs"),n),a(e("./base64.cjs"),n),a(e("./bytes.cjs"),n),a(e("./caip-types.cjs"),n),a(e("./checksum.cjs"),n),a(e("./coercers.cjs"),n),a(e("./collections.cjs"),n),a(e("./encryption-types.cjs"),n),a(e("./errors.cjs"),n),a(e("./hashing.cjs"),n);var r=e("./hex.cjs");Object.defineProperty(n,"HexStruct",{enumerable:!0,get:function(){return r.HexStruct}}),Object.defineProperty(n,"StrictHexStruct",{enumerable:!0,get:function(){return r.StrictHexStruct}}),Object.defineProperty(n,"HexAddressStruct",{enumerable:!0,get:function(){return r.HexAddressStruct}}),Object.defineProperty(n,"HexChecksumAddressStruct",{enumerable:!0,get:function(){return r.HexChecksumAddressStruct}}),Object.defineProperty(n,"isHexString",{enumerable:!0,get:function(){return r.isHexString}}),Object.defineProperty(n,"isStrictHexString",{enumerable:!0,get:function(){return r.isStrictHexString}}),Object.defineProperty(n,"isHexAddress",{enumerable:!0,get:function(){return r.isHexAddress}}),Object.defineProperty(n,"isHexChecksumAddress",{enumerable:!0,get:function(){return r.isHexChecksumAddress}}),Object.defineProperty(n,"assertIsHexString",{enumerable:!0,get:function(){return r.assertIsHexString}}),Object.defineProperty(n,"assertIsStrictHexString",{enumerable:!0,get:function(){return r.assertIsStrictHexString}}),Object.defineProperty(n,"isValidHexAddress",{enumerable:!0,get:function(){return r.isValidHexAddress}}),Object.defineProperty(n,"getChecksumAddress",{enumerable:!0,get:function(){return r.getChecksumAddress}}),Object.defineProperty(n,"isValidChecksumAddress",{enumerable:!0,get:function(){return r.isValidChecksumAddress}}),Object.defineProperty(n,"add0x",{enumerable:!0,get:function(){return r.add0x}}),Object.defineProperty(n,"remove0x",{enumerable:!0,get:function(){return r.remove0x}}),a(e("./json.cjs"),n),a(e("./keyring.cjs"),n),a(e("./logging.cjs"),n),a(e("./misc.cjs"),n),a(e("./number.cjs"),n),a(e("./opaque.cjs"),n),a(e("./promise.cjs"),n),a(e("./superstruct.cjs"),n),a(e("./time.cjs"),n),a(e("./transaction-types.cjs"),n),a(e("./versions.cjs"),n);var i=e("./unitsConversion.cjs");Object.defineProperty(n,"toWei",{enumerable:!0,get:function(){return i.toWei}}),Object.defineProperty(n,"fromWei",{enumerable:!0,get:function(){return i.fromWei}}),Object.defineProperty(n,"numberToString",{enumerable:!0,get:function(){return i.numberToString}}),Object.defineProperty(n,"getValueOfUnit",{enumerable:!0,get:function(){return i.getValueOfUnit}}),Object.defineProperty(n,"unitMap",{enumerable:!0,get:function(){return i.unitMap}})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/index.cjs"}],[3555,{"./assert.cjs":3543,"./misc.cjs":3558,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getJsonRpcIdValidator=n.assertIsJsonRpcError=n.isJsonRpcError=n.assertIsJsonRpcFailure=n.isJsonRpcFailure=n.assertIsJsonRpcSuccess=n.isJsonRpcSuccess=n.assertIsJsonRpcResponse=n.isJsonRpcResponse=n.assertIsPendingJsonRpcResponse=n.isPendingJsonRpcResponse=n.JsonRpcResponseStruct=n.JsonRpcFailureStruct=n.JsonRpcSuccessStruct=n.PendingJsonRpcResponseStruct=n.assertIsJsonRpcRequest=n.isJsonRpcRequest=n.assertIsJsonRpcNotification=n.isJsonRpcNotification=n.JsonRpcNotificationStruct=n.JsonRpcRequestStruct=n.JsonRpcParamsStruct=n.JsonRpcErrorStruct=n.JsonRpcIdStruct=n.JsonRpcVersionStruct=n.jsonrpc2=n.getJsonSize=n.getSafeJson=n.isValidJson=n.JsonStruct=n.UnsafeJsonStruct=n.exactOptional=n.object=void 0;const s=e("@metamask/superstruct"),a=e("./assert.cjs"),r=e("./misc.cjs");function i({path:e,branch:t}){const n=e[e.length-1];return(0,r.hasProperty)(t[t.length-2],n)}function o(e){return new s.Struct({...e,type:`optional ${e.type}`,validator:(t,n)=>!i(n)||e.validator(t,n),refiner:(t,n)=>!i(n)||e.refiner(t,n)})}function c(e){if(null===e||"boolean"==typeof e||"string"==typeof e)return!0;if("number"==typeof e&&Number.isFinite(e))return!0;if("object"==typeof e){let t=!0;if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(!c(e[n])){t=!1;break}return t}const n=Object.entries(e);for(let e=0;e<n.length;e++)if("string"!=typeof n[e][0]||!c(n[e][1])){t=!1;break}return t}return!1}function u(e){return(0,s.create)(e,n.JsonStruct)}n.object=e=>(0,s.object)(e),n.exactOptional=o,n.UnsafeJsonStruct=(0,s.define)("JSON",e=>c(e)),n.JsonStruct=(0,s.coerce)(n.UnsafeJsonStruct,(0,s.refine)((0,s.any)(),"JSON",e=>(0,s.is)(e,n.UnsafeJsonStruct)),e=>JSON.parse(JSON.stringify(e,(e,t)=>"__proto__"===e||"constructor"===e?undefined:t))),n.isValidJson=function(e){try{return u(e),!0}catch{return!1}},n.getSafeJson=u,n.getJsonSize=function(e){(0,a.assertStruct)(e,n.JsonStruct,"Invalid JSON value");const t=JSON.stringify(e);return(new TextEncoder).encode(t).byteLength},n.jsonrpc2="2.0",n.JsonRpcVersionStruct=(0,s.literal)(n.jsonrpc2),n.JsonRpcIdStruct=(0,s.nullable)((0,s.union)([(0,s.number)(),(0,s.string)()])),n.JsonRpcErrorStruct=(0,n.object)({code:(0,s.integer)(),message:(0,s.string)(),data:o(n.JsonStruct),stack:o((0,s.string)())}),n.JsonRpcParamsStruct=(0,s.union)([(0,s.record)((0,s.string)(),n.JsonStruct),(0,s.array)(n.JsonStruct)]),n.JsonRpcRequestStruct=(0,n.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,method:(0,s.string)(),params:o(n.JsonRpcParamsStruct)}),n.JsonRpcNotificationStruct=(0,n.object)({jsonrpc:n.JsonRpcVersionStruct,method:(0,s.string)(),params:o(n.JsonRpcParamsStruct)}),n.isJsonRpcNotification=function(e){return(0,s.is)(e,n.JsonRpcNotificationStruct)},n.assertIsJsonRpcNotification=function(e,t){(0,a.assertStruct)(e,n.JsonRpcNotificationStruct,"Invalid JSON-RPC notification",t)},n.isJsonRpcRequest=function(e){return(0,s.is)(e,n.JsonRpcRequestStruct)},n.assertIsJsonRpcRequest=function(e,t){(0,a.assertStruct)(e,n.JsonRpcRequestStruct,"Invalid JSON-RPC request",t)},n.PendingJsonRpcResponseStruct=(0,s.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,result:(0,s.optional)((0,s.unknown)()),error:(0,s.optional)(n.JsonRpcErrorStruct)}),n.JsonRpcSuccessStruct=(0,n.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,result:n.JsonStruct}),n.JsonRpcFailureStruct=(0,n.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,error:n.JsonRpcErrorStruct}),n.JsonRpcResponseStruct=(0,s.union)([n.JsonRpcSuccessStruct,n.JsonRpcFailureStruct]),n.isPendingJsonRpcResponse=function(e){return(0,s.is)(e,n.PendingJsonRpcResponseStruct)},n.assertIsPendingJsonRpcResponse=function(e,t){(0,a.assertStruct)(e,n.PendingJsonRpcResponseStruct,"Invalid pending JSON-RPC response",t)},n.isJsonRpcResponse=function(e){return(0,s.is)(e,n.JsonRpcResponseStruct)},n.assertIsJsonRpcResponse=function(e,t){(0,a.assertStruct)(e,n.JsonRpcResponseStruct,"Invalid JSON-RPC response",t)},n.isJsonRpcSuccess=function(e){return(0,s.is)(e,n.JsonRpcSuccessStruct)},n.assertIsJsonRpcSuccess=function(e,t){(0,a.assertStruct)(e,n.JsonRpcSuccessStruct,"Invalid JSON-RPC success response",t)},n.isJsonRpcFailure=function(e){return(0,s.is)(e,n.JsonRpcFailureStruct)},n.assertIsJsonRpcFailure=function(e,t){(0,a.assertStruct)(e,n.JsonRpcFailureStruct,"Invalid JSON-RPC failure response",t)},n.isJsonRpcError=function(e){return(0,s.is)(e,n.JsonRpcErrorStruct)},n.assertIsJsonRpcError=function(e,t){(0,a.assertStruct)(e,n.JsonRpcErrorStruct,"Invalid JSON-RPC error",t)},n.getJsonRpcIdValidator=function(e){const{permitEmptyString:t,permitFractions:n,permitNull:s}={permitEmptyString:!0,permitFractions:!1,permitNull:!0,...e};return e=>Boolean("number"==typeof e&&(n||Number.isInteger(e))||"string"==typeof e&&(t||e.length>0)||s&&null===e)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/json.cjs"}],[3556,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/keyring.cjs"}],[3557,{debug:4623},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.createProjectLogger=void 0;const a=(0,s(e("debug")).default)("metamask");n.createProjectLogger=function(e){return a.extend(e)},n.createModuleLogger=function(e,t){return e.extend(t)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/logging.cjs"}],[3558,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateNumberSize=n.calculateStringSize=n.isASCII=n.isPlainObject=n.ESCAPE_CHARACTERS_REGEXP=n.JsonSize=n.getKnownPropertyNames=n.hasProperty=n.isObject=n.isNullOrUndefined=n.isNonEmptyArray=void 0,n.isNonEmptyArray=function(e){return Array.isArray(e)&&e.length>0},n.isNullOrUndefined=function(e){return null===e||e===undefined},n.isObject=function(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)};function s(e){return e.charCodeAt(0)<=127}n.hasProperty=(e,t)=>Object.hasOwnProperty.call(e,t),n.getKnownPropertyNames=function(e){return Object.getOwnPropertyNames(e)},function(e){e[e.Null=4]="Null",e[e.Comma=1]="Comma",e[e.Wrapper=1]="Wrapper",e[e.True=4]="True",e[e.False=5]="False",e[e.Quote=1]="Quote",e[e.Colon=1]="Colon",e[e.Date=24]="Date"}(n.JsonSize||(n.JsonSize={})),n.ESCAPE_CHARACTERS_REGEXP=/"|\\|\n|\r|\t/gu,n.isPlainObject=function(e){if("object"!=typeof e||null===e)return!1;try{let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}catch(e){return!1}},n.isASCII=s,n.calculateStringSize=function(e){return e.split("").reduce((e,t)=>s(t)?e+1:e+2,0)+(e.match(n.ESCAPE_CHARACTERS_REGEXP)??[]).length},n.calculateNumberSize=function(e){return e.toString().length}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/misc.cjs"}],[3559,{"./assert.cjs":3543,"./hex.cjs":3553},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hexToBigInt=n.hexToNumber=n.bigIntToHex=n.numberToHex=void 0;const s=e("./assert.cjs"),a=e("./hex.cjs");n.numberToHex=e=>((0,s.assert)("number"==typeof e,"Value must be a number."),(0,s.assert)(e>=0,"Value must be a non-negative number."),(0,s.assert)(Number.isSafeInteger(e),"Value is not a safe integer. Use `bigIntToHex` instead."),(0,a.add0x)(e.toString(16)));n.bigIntToHex=e=>((0,s.assert)("bigint"==typeof e,"Value must be a bigint."),(0,s.assert)(e>=0,"Value must be a non-negative bigint."),(0,a.add0x)(e.toString(16)));n.hexToNumber=e=>{(0,a.assertIsHexString)(e);const t=parseInt(e,16);return(0,s.assert)(Number.isSafeInteger(t),"Value is not a safe integer. Use `hexToBigInt` instead."),t};n.hexToBigInt=e=>((0,a.assertIsHexString)(e),BigInt((0,a.add0x)(e)))}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/number.cjs"}],[356,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function a(e,t,n){return e.set(i(e,t),n),n}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function o(e){return new Promise((t,n)=>{e.oncomplete=()=>t(),e.onerror=()=>n(e.error)})}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBStore=void 0;var c=new WeakMap;n.IndexedDBStore=class{constructor(){s(this,c,null)}async open(e,t){r(c,this)||await new Promise((n,s)=>{const r=indexedDB.open(e,t);r.onupgradeneeded=async()=>{const e=r.result;e.objectStoreNames.contains("store")||e.createObjectStore("store")},r.onsuccess=()=>{a(c,this,r.result),n()},r.onerror=()=>{s(r.error)}})}async set(e){if(!r(c,this))throw new Error("Database is not open");const t=Object.keys(e),n=r(c,this).transaction("store","readwrite"),s=n.objectStore("store");for(const n of t)s.put(e[n],n);await o(n)}async get(e){if(!r(c,this))throw new Error("Database is not open");const t=[...new Set(e)],n=r(c,this).transaction("store","readonly"),s=n.objectStore("store"),a=t.map(e=>s.get(e)),i=await Promise.all(a.map(e=>new Promise((t,n)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>n(e.error)})));await o(n);const u=new Map(t.map((e,t)=>[e,i[t]]));return e.map(e=>u.get(e))}async remove(e){if(!r(c,this))throw new Error("Database is not open");const t=r(c,this).transaction("store","readwrite"),n=t.objectStore("store");for(const t of e)n.delete(t);await o(t)}async reset(){if(!r(c,this))throw new Error("Database is not open");const e=r(c,this).transaction("store","readwrite");e.objectStore("store").clear(),await o(e)}close(){r(c,this)&&(r(c,this).close(),a(c,this,null))}}}}},{package:"$root$",file:"app/scripts/lib/stores/indexeddb-store.ts"}],[3560,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/opaque.cjs"}],[3561,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createDeferredPromise=void 0,n.createDeferredPromise=function({suppressUnhandledRejection:e=!1}={}){let t,n;const s=new Promise((e,s)=>{t=e,n=s});return e&&s.catch(e=>{}),{promise:s,resolve:t,reject:n}}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/promise.cjs"}],[3562,{"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.definePattern=void 0;const s=e("@metamask/superstruct");n.definePattern=function(e,t){return(0,s.define)(e,e=>"string"==typeof e&&t.test(e))}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/superstruct.cjs"}]],[],{});