LavaPack.loadBundle([[1014,{"@ledgerhq/devices":990,"@ledgerhq/devices/lib/hid-framing":989,"@ledgerhq/errors":995,"@ledgerhq/hw-transport":1015,"@ledgerhq/logs":1018,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=i(e("@ledgerhq/hw-transport")),a=i(e("@ledgerhq/devices/lib/hid-framing")),o=e("@ledgerhq/devices"),c=e("@ledgerhq/logs"),d=e("@ledgerhq/errors"),u=[{vendorId:o.ledgerUSBVendorId}],l=()=>{const{hid:e}=navigator;if(!e)throw new d.TransportError("navigator.hid is not supported","HIDNotSupported");return e};async function p(){const e=await l().requestDevice({filters:u});return Array.isArray(e)?e:[e]}async function h(){return(await l().getDevices()).filter(e=>e.vendorId===o.ledgerUSBVendorId)}class f extends s.default{constructor(e){super(),r(this,"device",void 0),r(this,"deviceModel",void 0),r(this,"channel",Math.floor(65535*Math.random())),r(this,"packetSize",64),r(this,"inputs",[]),r(this,"inputCallback",void 0),r(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e})),r(this,"onInputReport",e=>{const n=t.from(e.data.buffer);this.inputCallback?(this.inputCallback(n),this.inputCallback=null):this.inputs.push(n)}),r(this,"_disconnectEmitted",!1),r(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))}),r(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:t,packetSize:n}=this;(0,c.log)("apdu","=> "+e.toString("hex"));const r=(0,a.default)(t,n),i=r.makeBlocks(e);for(let e=0;e<i.length;e++)await this.device.sendReport(0,i[e]);let s,o;for(;!(s=r.getReducedResult(o));)try{const e=await this.read();o=r.reduceResponse(o,e)}catch(e){if(e instanceof d.TransportError&&"InvalidChannel"===e.id)continue;throw e}return(0,c.log)("apdu","<= "+s.toString("hex")),s}).catch(e=>{if(e&&e.message&&e.message.includes("write"))throw this._emitDisconnect(e),new d.DisconnectedDeviceDuringOperation(e.message);throw e})),this.device=e,this.deviceModel="number"==typeof e.productId?(0,o.identifyUSBProductId)(e.productId):undefined,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await p();return f.open(e)}static async openConnected(){const e=await h();return 0===e.length?null:f.open(e[0])}static async open(e){await e.open();const t=new f(e),n=r=>{e===r.device&&(l().removeEventListener("disconnect",n),t._emitDisconnect(new d.DisconnectedDevice))};return l().addEventListener("disconnect",n),t}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}}r(f,"isSupported",()=>Promise.resolve(!(!window.navigator||!window.navigator.hid))),r(f,"list",h),r(f,"listen",e=>{let t=!1;return async function(){const e=await h();return e.length>0?e[0]:(await p())[0]}().then(n=>{if(n){if(!t){const t="number"==typeof n.productId?(0,o.identifyUSBProductId)(n.productId):undefined;e.next({type:"add",descriptor:n,deviceModel:t}),e.complete()}}else e.error(new d.TransportOpenUserCancelled("Access denied to use Ledger device"))},t=>{e.error(new d.TransportOpenUserCancelled(t.message))}),{unsubscribe:function(){t=!0}}}),n.default=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@ledgerhq/hw-transport-webhid",file:"node_modules/@ledgerhq/hw-transport-webhid/lib/TransportWebHID.js"}],[3183,{"./proxy/index.cjs":3185},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=Object.create?function(e,t,n,r){r===undefined&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./proxy/index.cjs"),n)}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/index.cjs"}],[3184,{"@metamask/post-message-stream":2891,"@metamask/snaps-execution-environments/package.json":3186,"@metamask/snaps-utils":3382,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){s(e,t),t.set(e,n)}function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var d=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.ProxySnapExecutor=void 0;const u=e("@metamask/post-message-stream"),l=e("@metamask/snaps-utils"),p=e("@metamask/utils"),h=`https://execution.metamask.io/iframe/${d(e("@metamask/snaps-execution-environments/package.json")).default.version}/index.html`;var f=new WeakMap,m=new WeakMap,g=new WeakSet;class v{static initialize(e,t=h){return new v(e,t)}constructor(e,t){var n,d;s(n=this,d=g),d.add(n),i(this,f,void 0),i(this,m,void 0),r(this,"jobs",{}),o(f,this,e),a(f,this).on("data",c(g,this,w).bind(this)),o(m,this,t)}}function w(e){const{jobId:t,data:n}=e;this.jobs[t]?"terminateJob"!==n.method?this.jobs[t].stream.write(n):c(g,this,y).call(this,t):c(g,this,b).call(this,t).then(()=>{c(g,this,w).call(this,e)}).catch(e=>{(0,l.logError)("[Worker] Error initializing job:",e)})}async function b(e){const t=await(0,l.createWindow)({uri:a(m,this),id:e}),n=new u.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"});return n.on("data",t=>{a(f,this).write({data:t,jobId:e})}),this.jobs[e]={id:e,window:t,stream:n},this.jobs[e]}function y(e){(0,p.assert)(this.jobs[e],`Job "${e}" not found.`);const t=document.getElementById(e);(0,p.assert)(t,`Iframe with ID "${e}" not found.`),t.remove(),this.jobs[e].stream.destroy(),delete this.jobs[e]}n.ProxySnapExecutor=v}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/proxy/ProxySnapExecutor.cjs"}],[3185,{"./ProxySnapExecutor.cjs":3184},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=Object.create?function(e,t,n,r){r===undefined&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./ProxySnapExecutor.cjs"),n)}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/proxy/index.cjs"}],[3186,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports={name:"@metamask/snaps-execution-environments",version:"10.4.1",description:"Snap sandbox environments for executing SES javascript",keywords:["MetaMask","Snaps","Ethereum"],homepage:"https://github.com/MetaMask/snaps/tree/main/packages/snaps-execution-environments#readme",bugs:{url:"https://github.com/MetaMask/snaps/issues"},repository:{type:"git",url:"https://github.com/MetaMask/snaps.git"},license:"SEE LICENSE IN LICENSE",sideEffects:!1,exports:{".":{import:{types:"./dist/index.d.mts",default:"./dist/index.mjs"},require:{types:"./dist/index.d.cts",default:"./dist/index.cjs"}},"./node-process":"./dist/webpack/node-process/bundle.js","./node-thread":"./dist/webpack/node-thread/bundle.js","./package.json":"./package.json"},main:"./dist/index.cjs",module:"./dist/index.mjs",types:"./dist/index.d.cts",files:["dist"],scripts:{"auto-changelog-init":"auto-changelog init",build:"ts-bridge --project tsconfig.build.json --verbose --clean --no-references","build:lavamoat":"lavamoat --policy lavamoat/build-system/policy.json  --override lavamoat/build-system/policy-override.json ./scripts/build.js","build:lavamoat:policy":"yarn build:lavamoat --writeAutoPolicy && LAVAMOAT_GENERATE_POLICY=true node scripts/build.js","build:lavamoat:test":"NODE_ENV=test yarn build:lavamoat","build:post":"yarn build:lavamoat","changelog:update":"../../scripts/update-changelog.sh @metamask/snaps-execution-environments","changelog:validate":"../../scripts/validate-changelog.sh @metamask/snaps-execution-environments",clean:"rimraf '*.tsbuildinfo' 'dist' 'src/__GENERATED__/' 'coverage/*' '__test__/*'",lint:"yarn lint:eslint && yarn lint:misc --check && yarn changelog:validate && yarn lint:dependencies","lint:ci":"yarn lint","lint:dependencies":"depcheck","lint:eslint":"eslint . --cache","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write","lint:misc":'prettier --no-error-on-unmatched-pattern --log-level warn "**/*.json" "**/*.md" "**/*.html" "!CHANGELOG.md" --ignore-path ./.prettierignore',"publish:preview":"yarn npm publish --tag preview","since-latest-release":"../../scripts/since-latest-release.sh",start:"node scripts/start.js",test:"jest --reporters=jest-silent-reporter && yarn test:browser","test:browser":"vitest","test:browser:firefox":"vitest --config ./vitest.config.firefox.mts","test:clean":"jest --clearCache","test:post":"tsx ../../scripts/update-coverage.mts && rimraf coverage/jest coverage/vite","test:verbose":"jest --verbose","test:watch":"jest --watch"},dependencies:{"@metamask/json-rpc-engine":"^10.2.1","@metamask/object-multiplex":"^2.1.0","@metamask/post-message-stream":"^10.0.0","@metamask/providers":"^22.1.1","@metamask/rpc-errors":"^7.0.3","@metamask/snaps-sdk":"^10.4.0","@metamask/snaps-utils":"^12.0.1","@metamask/superstruct":"^3.2.1","@metamask/utils":"^11.9.0","readable-stream":"^3.6.2"},devDependencies:{"@esbuild-plugins/node-globals-polyfill":"^0.2.3","@esbuild-plugins/node-modules-polyfill":"^0.2.2","@lavamoat/allow-scripts":"^3.4.2","@lavamoat/lavatube":"^1.0.0","@lavamoat/webpack":"^1.5.7","@metamask/auto-changelog":"^5.0.2","@swc/core":"1.11.31","@swc/jest":"^0.2.38","@testing-library/dom":"^10.4.0","@ts-bridge/cli":"^0.6.1","@types/jest":"^27.5.1","@types/node":"18.14.2","@types/webpack-env":"^1.18.1","@vitest/browser":"^3.1.1","@vitest/coverage-v8":"^3.1.1",deepmerge:"^4.2.2",depcheck:"^1.4.7",eslint:"^9.11.0","html-webpack-plugin":"^5.5.0",jest:"^29.0.2","jest-environment-node":"^29.5.0","jest-fetch-mock":"^3.0.3","jest-silent-reporter":"^0.6.0",lavamoat:"^10.1.0",prettier:"^3.3.3",rimraf:"^4.1.2","serve-handler":"^6.1.5",ses:"^1.14.0","stream-browserify":"^3.0.0",terser:"^5.17.7","ts-loader":"^9.5.2","tsconfig-paths-webpack-plugin":"^4.0.1",tsx:"^4.20.3",typescript:"~5.3.3",vite:"^6.4.1","vite-tsconfig-paths":"^4.0.5",vitest:"^3.1.1",webpack:"^5.97.1","webpack-merge":"^5.9.0"},engines:{node:"^20 || >=22"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"}}}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/package.json"}],[4,{"../../shared/constants/offscreen-communication":6196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){i(navigator.onLine),window.addEventListener("online",()=>i(!0)),window.addEventListener("offline",()=>i(!1))};var r=e("../../shared/constants/offscreen-communication");function i(e){chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.extensionMain,event:r.OffscreenCommunicationEvents.connectivityChange,isOnline:e})}}}},{package:"$root$",file:"app/offscreen/connectivity.ts"}],[5,{"../../shared/constants/offscreen-communication":6196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(e.target===r.OffscreenCommunicationTarget.latticeOffscreen)return async function(e){const t=window.open(e);if(!t)throw new Error("Failed to open Lattice connector.");return t}(e.params.url).then(e=>{const t=setInterval(()=>{e.closed&&(clearInterval(t),n({error:new Error("Lattice connector closed.")}))},500);window.addEventListener("message",i=>{if(i.origin===r.KnownOrigins.lattice&&i.source===e&&"string"==typeof i.data)try{clearInterval(t);const e=JSON.parse(i.data);e.deviceID&&e.password||n({error:new Error("Invalid credentials returned from Lattice.")}),n({result:e})}catch(e){console.error("Error parsing Lattice credentials",e),n({error:e})}},!1)}),!0})};var r=e("../../shared/constants/offscreen-communication")}}},{package:"$root$",file:"app/offscreen/lattice.ts"}],[6,{"../../shared/constants/hardware-wallets":6184,"../../shared/constants/offscreen-communication":6196,"@ledgerhq/hw-app-eth":999,"@ledgerhq/hw-transport-webhid":1014},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenHandler=void 0,n.default=async function(){const e=new l;await e.init()};var r=o(e("@ledgerhq/hw-transport-webhid")),i=o(e("@ledgerhq/hw-app-eth")),s=e("../../shared/constants/offscreen-communication"),a=e("../../shared/constants/hardware-wallets");function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(){return"undefined"!=typeof navigator&&void 0!==navigator.hid}function u(e){if(e instanceof Error){const t={message:e.message,name:e.name};return"statusCode"in e&&"number"==typeof e.statusCode&&(t.statusCode=e.statusCode),t}return{message:String(e)}}class l{constructor(){c(this,"transport",null),c(this,"ethApp",null),c(this,"pendingMakeApp",null)}async openTransport(){if(!d())throw new Error("WebHID is not supported in this browser");const e=await r.default.openConnected();if(e)return e;if(0===(await navigator.hid.getDevices()).filter(e=>e.vendorId===Number(a.LEDGER_USB_VENDOR_ID)).length)throw new Error("No permitted Ledger device found. User must grant permission from the UI first.");return r.default.create()}async makeApp(){return this.pendingMakeApp||(this.pendingMakeApp=(async()=>{try{if(this.transport&&this.ethApp)try{return await this.ethApp.getAppConfiguration(),!0}catch{await this.closeTransport()}return this.transport=await this.openTransport(),this.ethApp=new i.default(this.transport),!0}catch(e){throw console.error("Ledger makeApp error:",e),e}finally{this.pendingMakeApp=null}})()),this.pendingMakeApp}async closeTransport(){const e=this.transport;if(this.transport=null,this.ethApp=null,e)try{await e.close()}catch{}}async ensureApp(){if(this.ethApp||await this.makeApp(),!this.ethApp)throw new Error("Ledger app not initialized");return this.ethApp}async getPublicKey(e){const t=await this.ensureApp(),n=await t.getAddress(e,!1,!0);return{publicKey:n.publicKey,address:n.address,chainCode:n.chainCode}}async signTransaction(e,t){const n=await this.ensureApp(),r=await n.clearSignTransaction(e,t,{nft:!0,externalPlugins:!0,erc20:!0});return{v:r.v,r:r.r,s:r.s}}async signPersonalMessage(e,t){const n=await this.ensureApp(),r=t.startsWith("0x")?t.slice(2):t,i=await n.signPersonalMessage(e,r);return{v:i.v,r:i.r,s:i.s}}async signTypedData(e){const t=await this.ensureApp(),n=await t.signEIP712Message(e.hdPath,e.message);return{v:n.v,r:n.r,s:n.s}}setupDeviceEventListeners(){d()?(navigator.hid.addEventListener("connect",({device:e})=>{e.vendorId===Number(a.LEDGER_USB_VENDOR_ID)&&chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.extension,event:s.OffscreenCommunicationEvents.ledgerDeviceConnect,payload:!0})}),navigator.hid.addEventListener("disconnect",({device:e})=>{e.vendorId===Number(a.LEDGER_USB_VENDOR_ID)&&(this.closeTransport(),chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.extension,event:s.OffscreenCommunicationEvents.ledgerDeviceConnect,payload:!1}))})):console.warn("WebHID not supported, skipping device event listeners")}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,n)=>e.target===s.OffscreenCommunicationTarget.ledgerOffscreen&&(this.handleLedgerAction(e.action,e.params).then(e=>{n({success:!0,payload:e})}).catch(t=>{console.error(`Ledger action ${e.action} failed:`,t),n({success:!1,payload:{error:u(t)}})}).finally(()=>{this.closeTransport()}),!0))}async handleLedgerAction(e,t){switch(e){case s.LedgerAction.makeApp:return this.makeApp();case s.LedgerAction.updateTransport:return!0;case s.LedgerAction.getAppNameAndVersion:{if(this.transport||await this.makeApp(),!this.transport)throw new Error("No transport available");const e=await this.transport.send(176,1,0,0);let t=1;const n=e[t];t+=1;const r=e.subarray(t,t+n).toString("ascii");t+=n;const i=e[t];t+=1;return{appName:r,version:e.subarray(t,t+i).toString("ascii")}}case s.LedgerAction.getPublicKey:if(null==t||!t.hdPath||"string"!=typeof t.hdPath)throw new Error("Missing hdPath parameter");return this.getPublicKey(t.hdPath);case s.LedgerAction.signTransaction:if(null==t||!t.hdPath||"string"!=typeof t.hdPath||null==t||!t.tx||"string"!=typeof t.tx)throw new Error("Missing hdPath or tx parameter");return this.signTransaction(t.hdPath,t.tx);case s.LedgerAction.signPersonalMessage:if(null==t||!t.hdPath||"string"!=typeof t.hdPath||null==t||!t.message||"string"!=typeof t.message)throw new Error("Missing hdPath or message parameter");return this.signPersonalMessage(t.hdPath,t.message);case s.LedgerAction.signTypedData:if(null==t||!t.hdPath||"string"!=typeof t.hdPath||null==t||!t.message||"object"!=typeof t.message)throw new Error("Missing hdPath or message parameter");return this.signTypedData({hdPath:t.hdPath,message:t.message});default:throw new Error(`Unknown Ledger action: ${e}`)}}async init(){if(this.setupDeviceEventListeners(),this.setupMessageListener(),d())try{const e=await navigator.hid.getDevices();e.some(e=>e.vendorId===Number(a.LEDGER_USB_VENDOR_ID))&&chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.extension,event:s.OffscreenCommunicationEvents.ledgerDeviceConnect,payload:!0})}catch(e){console.error("Error checking for permitted Ledger devices:",e)}else console.warn("WebHID not supported, Ledger functionality will be limited")}}n.LedgerOffscreenHandler=l}}},{package:"$root$",file:"app/offscreen/ledger.ts"}],[8,{"../../shared/constants/offscreen-communication":6196,"@trezor/connect-web":3679},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(e.target===i.OffscreenCommunicationTarget.trezorOffscreen){switch(e.action){case i.TrezorAction.init:r.default.on(r.DEVICE_EVENT,e=>{var t;e.type===r.DEVICE.CONNECT&&null!==(t=e.payload.features)&&void 0!==t&&t.model&&chrome.runtime.sendMessage({target:i.OffscreenCommunicationTarget.extension,event:i.OffscreenCommunicationEvents.trezorDeviceConnect,payload:{model:e.payload.features.model,minorVersion:e.payload.features.minor_version}})}),r.default.init({...e.params,env:"webextension"}).then(()=>{n()});break;case i.TrezorAction.dispose:r.default.dispose(),n();break;case i.TrezorAction.getPublicKey:r.default.getPublicKey(e.params).then(e=>{n(e)});break;case i.TrezorAction.signTransaction:r.default.ethereumSignTransaction(e.params).then(e=>{n(e)});break;case i.TrezorAction.signMessage:r.default.ethereumSignMessage(e.params).then(e=>{n(e)});break;case i.TrezorAction.signTypedData:r.default.ethereumSignTypedData(e.params).then(e=>{n(e)});break;default:n({success:!1,payload:{error:"Trezor action not supported"}})}return!0}})};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}(e("@trezor/connect-web")),i=e("../../shared/constants/offscreen-communication");function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}}}},{package:"$root$",file:"app/offscreen/trezor.ts"}],[989,{"@ledgerhq/errors":995,buffer:4474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0});const r=e("@ledgerhq/errors");function i(e){const n=t.alloc(2);return n.writeUInt16BE(e,0),n}const s={data:t.alloc(0),dataLength:0,sequence:0};n.default=(e,n)=>({makeBlocks(r){let s=t.concat([i(r.length),r]);const a=n-5,o=Math.ceil(s.length/a);s=t.concat([s,t.alloc(o*a-s.length+1).fill(0)]);const c=[];for(let n=0;n<o;n++){const r=t.alloc(5);r.writeUInt16BE(e,0),r.writeUInt8(5,2),r.writeUInt16BE(n,3);const i=s.slice(n*a,(n+1)*a);c.push(t.concat([r,i]))}return c},reduceResponse(n,i){let{data:a,dataLength:o,sequence:c}=n||s;if(i.readUInt16BE(0)!==e)throw new r.TransportError("Invalid channel","InvalidChannel");if(5!==i.readUInt8(2))throw new r.TransportError("Invalid tag","InvalidTag");if(i.readUInt16BE(3)!==c)throw new r.TransportError("Invalid sequence","InvalidSequence");n||(o=i.readUInt16BE(5)),c++;const d=i.slice(n?5:7);return a=t.concat([a,d]),a.length>o&&(a=a.slice(0,o)),{data:a,dataLength:o,sequence:c}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}})}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@ledgerhq/hw-transport>@ledgerhq/devices",file:"node_modules/@ledgerhq/devices/lib/hid-framing.js"}],[990,{semver:5987},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getInfosForServiceUuid=n.getBluetoothServiceUuids=n.identifyProductName=n.identifyUSBProductId=n.identifyTargetId=n.getDeviceModel=n.ledgerUSBVendorId=n.DeviceModelId=n.IIWebUSB=n.IICCID=n.IIU2F=n.IIKeyboardHID=n.IIGenericHID=void 0;const i=r(e("semver"));var s;n.IIGenericHID=1,n.IIKeyboardHID=2,n.IIU2F=4,n.IICCID=8,n.IIWebUSB=16,function(e){e.blue="blue",e.nanoS="nanoS",e.nanoSP="nanoSP",e.nanoX="nanoX",e.stax="stax",e.europa="europa",e.apex="apex"}(s||(n.DeviceModelId=s={}));const a={[s.blue]:{id:s.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:491520,masks:[822083584,822149120],getBlockSize:e=>4096},[s.nanoS]:{id:s.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:327680,masks:[823132160],getBlockSize:e=>i.default.lt(i.default.coerce(e)??"","2.0.0")?4096:2048},[s.nanoX]:{id:s.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2097152,masks:[855638016],getBlockSize:e=>4096,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[s.nanoSP]:{id:s.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1569792,masks:[856686592],getBlockSize:e=>32},[s.apex]:{id:s.apex,productName:"Ledger Nano Gen5",productIdMM:128,legacyUsbProductId:8,usbOnly:!1,memorySize:1569792,masks:[859832320],getBlockSize:e=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-8004-0000-4c6564676572",notifyUuid:"13d63400-2c97-8004-0001-4c6564676572",writeUuid:"13d63400-2c97-8004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-8004-0003-4c6564676572"}]},[s.stax]:{id:s.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1569792,masks:[857735168],getBlockSize:e=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[s.europa]:{id:s.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1569792,masks:[858783744],getBlockSize:e=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}},o={Blue:s.blue,"Nano S":s.nanoS,"Nano S Plus":s.nanoSP,"Nano X":s.nanoX,Stax:s.stax,Europa:s.europa},c=Object.values(a);n.ledgerUSBVendorId=11415;n.getDeviceModel=e=>{const t=a[e];if(!t)throw new Error("device '"+e+"' does not exist");return t};n.identifyTargetId=e=>c.find(({masks:t})=>t.find(t=>(4294901760&e)===t));n.identifyUSBProductId=e=>{const t=c.find(t=>t.legacyUsbProductId===e);if(t)return t;const n=e>>8;return c.find(e=>e.productIdMM===n)};n.identifyProductName=e=>c.find(t=>t.id===o[e]);const d=[],u={};for(const e in a){const t=a[e],{bluetoothSpec:n}=t;if(n)for(let e=0;e<n.length;e++){const r=n[e];d.push(r.serviceUuid),u[r.serviceUuid]=u[r.serviceUuid.replace(/-/g,"")]={deviceModel:t,...r}}}n.getBluetoothServiceUuids=()=>d;n.getInfosForServiceUuid=e=>u[e.toLowerCase()]}}},{package:"@ledgerhq/hw-transport>@ledgerhq/devices",file:"node_modules/@ledgerhq/devices/lib/index.js"}],[7,{"../../shared/constants/offscreen-communication":6196,"./connectivity":4,"./lattice":5,"./ledger":6,"./trezor":8,"@metamask/post-message-stream":2891,"@metamask/snaps-execution-environments":3183,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("@metamask/post-message-stream"),i=e("@metamask/snaps-execution-environments"),s=(e("@metamask/utils"),e("../../shared/constants/offscreen-communication")),a=u(e("./ledger")),o=u(e("./trezor")),c=u(e("./lattice")),d=u(e("./connectivity"));function u(e){return e&&e.__esModule?e:{default:e}}(async function(){!function(){const e=new r.BrowserRuntimePostMessageStream({name:"child",target:"parent"});i.ProxySnapExecutor.initialize(e,"./snaps/index.html")}(),(0,o.default)(),(0,c.default)();try{const e=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Ledger initialization timed out"))},s.OFFSCREEN_LEDGER_INIT_TIMEOUT)});await Promise.race([(0,a.default)(),e])}catch(e){console.error("Ledger initialization failed:",e)}})().then(()=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.extensionMain,isBooted:!0,webdriverPresent:!0===navigator.webdriver}),(0,d.default)()})}}},{package:"$root$",file:"app/offscreen/offscreen.ts"}]],[7],{});