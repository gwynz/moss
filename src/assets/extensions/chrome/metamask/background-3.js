LavaPack.loadBundle([[3092,{"../snaps/index.cjs":3105,"@metamask/rpc-errors":3026,"@metamask/snaps-rpc-methods":3209,"@metamask/snaps-utils":3146,"@metamask/utils":3554,nanoid:5438},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainRouter=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-rpc-methods"),d=e("@metamask/snaps-utils"),p=e("@metamask/utils"),h=e("nanoid"),m=e("../snaps/index.cjs"),f="MultichainRouter";var g=new WeakMap,S=new WeakMap,b=new WeakSet;async function y(e,t,n){try{const s=await i(S,this).call(this,async({keyring:s})=>s.resolveAccountAddress(e,t,n)),r=null==s?void 0:s.address;return r?(0,p.parseCaipAccountId)(r).address:null}catch{throw l.rpcErrors.internal()}}async function v(e,t,n){const s=i(g,this).call("AccountsController:listMultichainAccounts",t).filter(e=>{var t;return Boolean(null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled)&&e.methods.includes(n.method)});if(0===s.length)return null;const r=s[0].metadata.snap.id,a=await c(b,this,y).call(this,r,t,n),o=e.map(e=>(0,p.parseCaipAccountId)(e).address),u=s.find(e=>o.includes(e.address)&&(!a||e.address===a));if(!u)throw l.rpcErrors.invalidParams({message:"No available account found for request."});return u.id}function w(e){const t=i(g,this).call("SnapController:getAll");return(0,m.getRunnableSnaps)(t).reduce((t,n)=>{const s=i(g,this).call("PermissionController:getPermissions",n.id);if(s&&(0,p.hasProperty)(s,u.SnapEndowments.Protocol)){const r=s[u.SnapEndowments.Protocol],a=(0,u.getProtocolCaveatScopes)(r);a&&(0,p.hasProperty)(a,e)&&t.push({snapId:n.id,methods:a[e].methods})}return t},[])}function _(e){return i(g,this).call("AccountsController:listMultichainAccounts",e).filter(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})}n.MultichainRouter=class{constructor({messenger:e,withSnapKeyring:t}){var n,c;r(n=this,c=b),c.add(n),a(this,"name",f),a(this,"state",null),s(this,g,void 0),s(this,S,void 0),o(g,this,e),o(S,this,t),i(g,this).registerActionHandler(`${f}:handleRequest`,async(...e)=>this.handleRequest(...e)),i(g,this).registerActionHandler(`${f}:getSupportedMethods`,(...e)=>this.getSupportedMethods(...e)),i(g,this).registerActionHandler(`${f}:getSupportedAccounts`,(...e)=>this.getSupportedAccounts(...e)),i(g,this).registerActionHandler(`${f}:isSupportedScope`,(...e)=>this.isSupportedScope(...e))}async handleRequest({connectedAddresses:e,origin:t,scope:n,request:s}){(0,p.assert)(!n.startsWith(p.KnownCaipNamespace.Eip155)&&!n.startsWith("wallet:eip155"));const r={jsonrpc:"2.0",id:s.id??(0,h.nanoid)(),method:s.method,...s.params?{params:s.params}:{}},{method:a,params:o}=r,u=await c(b,this,v).call(this,e,n,r);if(u)return i(S,this).call(this,async({keyring:e})=>e.submitRequest({origin:t,account:u,scope:n,method:a,params:o}));const m=c(b,this,w).call(this,n).find(e=>e.methods.includes(a));if(m)return i(g,this).call("SnapController:handleRequest",{snapId:m.snapId,origin:t,request:{method:"",params:{request:r,scope:n}},handler:d.HandlerType.OnProtocolRequest});throw l.rpcErrors.methodNotFound()}getSupportedMethods(e){const t=c(b,this,_).call(this,e).flatMap(e=>e.methods),n=c(b,this,w).call(this,e).flatMap(e=>e.methods);return Array.from(new Set([...t,...n]))}getSupportedAccounts(e){return c(b,this,_).call(this,e).map(t=>`${e}:${t.address}`)}isSupportedScope(e){return i(g,this).call("AccountsController:listMultichainAccounts",e).some(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})||c(b,this,w).call(this,e).length>0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/MultichainRouter.cjs"}],[3093,{"./MultichainRouter.cjs":3092},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./MultichainRouter.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/index.cjs"}],[3094,{"../logging.cjs":3091,"../snaps/Timer.cjs":3103,"../utils.cjs":3115,"@metamask/json-rpc-engine":2418,"@metamask/json-rpc-middleware-stream":2431,"@metamask/object-multiplex":2820,"@metamask/rpc-errors":3026,"@metamask/snaps-utils":3146,"@metamask/utils":3554,nanoid:5438,"readable-stream":3182},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setupMultiplex=n.AbstractExecutionService=void 0;const u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-middleware-stream"),p=l(e("@metamask/object-multiplex")),h=e("@metamask/rpc-errors"),m=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("nanoid"),S=e("readable-stream"),b=e("../logging.cjs"),y=e("../snaps/Timer.cjs"),v=e("../utils.cjs"),w="ExecutionService";var _=new WeakMap,k=new WeakMap,E=new WeakMap,T=new WeakMap,P=new WeakMap,j=new WeakMap,O=new WeakMap,R=new WeakMap,A=new WeakSet;function I(){i(T,this).registerActionHandler(`${w}:handleRpcRequest`,async(e,t)=>this.handleRpcRequest(e,t)),i(T,this).registerActionHandler(`${w}:executeSnap`,async e=>this.executeSnap(e)),i(T,this).registerActionHandler(`${w}:terminateSnap`,async e=>this.terminateSnap(e)),i(T,this).registerActionHandler(`${w}:terminateAllSnaps`,async()=>this.terminateAllSnaps())}async function M(e,t){const{streams:n,worker:s}=await c(A,this,C).call(this,e,t),r=new u.JsonRpcEngine,a=(0,d.createStreamMiddleware)();(0,S.pipeline)(a.stream,n.command,a.stream,e=>{var t;!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||(0,m.logError)("Command stream failure.",e)}),r.push(a.middleware);const o={id:e,streams:n,rpcEngine:r,worker:s};return i(_,this).set(e,o),o}async function C(e,t){const n=await(0,v.withTimeout)(this.initEnvStream(e),t);if(n===v.hasTimedOut){await this.terminateJob({id:e});if("created"===i(k,this).get(e))throw new Error(`The executor for "${e}" couldn't start initialization. The offscreen document may not exist.`);throw new Error(`The executor for "${e}" failed to initialize. The iframe/webview/worker failed to load.`)}const{worker:s,stream:r}=n,a=x(r,`Snap: "${e}"`),o=a.createStream(m.SNAP_STREAM_NAMES.COMMAND),c=t=>{(0,f.hasProperty)(t,"id")||("OutboundRequest"===t.method?i(T,this).publish("ExecutionService:outboundRequest",e):"OutboundResponse"===t.method?i(T,this).publish("ExecutionService:outboundResponse",e):"UnhandledError"===t.method?(i(T,this).publish("ExecutionService:unhandledError",e,t.params.error),o.removeListener("data",c)):(0,m.logError)(new Error(`Received unexpected command stream notification "${t.method}".`)))};o.on("data",c);const l=a.createStream(m.SNAP_STREAM_NAMES.JSON_RPC);l.on("data",t=>{null!=t&&t.data&&(0,f.hasProperty)(null==t?void 0:t.data,"id")&&i(T,this).publish("ExecutionService:outboundRequest",e)});const u=l.write.bind(l);return l.write=(t,n,s)=>{var r;return"metamask_chainChanged"===(null==t||null===(r=t.data)||void 0===r?void 0:r.method)||(null!=t&&t.data&&(0,f.hasProperty)(null==t?void 0:t.data,"id")&&i(T,this).publish("ExecutionService:outboundResponse",e),u(t,n,s))},{streams:{command:o,rpc:l,connection:r,mux:a},worker:s}}async function N(e,t){const n=i(_,this).get(e);if(!n)throw new Error(`"${e}" is not currently running.`);(0,b.log)("Parent: Sending Command",t);const s=await n.rpcEngine.handle(t);if((0,f.hasProperty)(s,"error")){const e=s.error;throw new h.JsonRpcError(e.code,e.message,e.data)}return s.result}function x(e,t){const n=new p.default;return(0,S.pipeline)(e,n,e,e=>{var n;!e||null!==(n=e.message)&&void 0!==n&&n.match("Premature close")||(0,m.logError)(`"${t}" stream failure.`,e)}),n}n.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,initTimeout:n=(0,f.inMilliseconds)(60,f.Duration.Second),pingTimeout:i=(0,f.inMilliseconds)(10,f.Duration.Second),terminationTimeout:l=(0,f.inMilliseconds)(1,f.Duration.Second),usePing:u=!0}){var d,p;r(d=this,p=A),p.add(d),a(this,"name",w),a(this,"state",null),s(this,_,void 0),s(this,k,void 0),s(this,E,void 0),s(this,T,void 0),s(this,P,void 0),s(this,j,void 0),s(this,O,void 0),s(this,R,void 0),o(_,this,new Map),o(k,this,new Map),o(E,this,e),o(T,this,t),o(P,this,n),o(j,this,i),o(O,this,l),o(R,this,u),c(A,this,I).call(this)}async terminateSnap(e){const t=i(_,this).get(e);if(t){try{const t=await(0,v.withTimeout)(c(A,this,N).call(this,e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,g.nanoid)()}),i(O,this));t!==v.hasTimedOut&&"OK"===t||(0,m.logWarning)(`Snap "${e}" failed to terminate gracefully.`)}catch{}Object.values(t.streams).forEach(e=>{try{e.destroyed||e.destroy()}catch(e){(0,m.logError)("Error while destroying stream",e)}}),await this.terminateJob(t),i(_,this).delete(e),i(k,this).delete(e),(0,b.log)(`Snap "${e}" terminated.`)}}setSnapStatus(e,t){i(k,this).set(e,t)}async terminateAllSnaps(){await Promise.all([...i(_,this).keys()].map(async e=>this.terminateSnap(e)))}async executeSnap({snapId:e,sourceCode:t,endowments:n}){if(i(_,this).has(e))throw new Error(`"${e}" is already running.`);this.setSnapStatus(e,"created");const s=new y.Timer(i(P,this)),r=await c(A,this,M).call(this,e,s);if(i(R,this)){if(await(0,v.withTimeout)(c(A,this,N).call(this,r.id,{jsonrpc:"2.0",method:"ping",id:(0,g.nanoid)()}),i(j,this))===v.hasTimedOut)throw new Error(`The executor for "${e}" was unreachable. The executor did not respond in time.`)}const a=r.streams.rpc;i(E,this).call(this,e,a);const o=Math.max(s.remaining,i(P,this)/2);this.setSnapStatus(e,"initialized");const l={jsonrpc:"2.0",method:"executeSnap",params:{snapId:e,sourceCode:t,endowments:n},id:(0,g.nanoid)()};(0,f.assertIsJsonRpcRequest)(l),this.setSnapStatus(e,"executing");const u=await(0,v.withTimeout)(c(A,this,N).call(this,r.id,l),o);if(u===v.hasTimedOut)throw new Error(`${e} failed to start.`);return"OK"===u&&this.setSnapStatus(e,"running"),u}async handleRpcRequest(e,t){const{handler:n,request:s,origin:r}=t;return await c(A,this,N).call(this,e,{id:(0,g.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:r,handler:n,request:s,target:e}})}},n.setupMultiplex=x}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/AbstractExecutionService.cjs"}],[3095,{"@metamask/post-message-stream":2891},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(o(e,t))}function i(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyPostMessageStream=void 0;const c=e("@metamask/post-message-stream");var l=new WeakMap,u=new WeakMap,d=new WeakSet;class p extends c.BasePostMessageStream{constructor({stream:e,jobId:t}){var n,c;super(),r(n=this,c=d),c.add(n),s(this,l,void 0),s(this,u,void 0),i(l,this,e),i(u,this,t),a(l,this).on("data",o(d,this,h).bind(this))}_postMessage(e){a(l,this).write({jobId:a(u,this),data:e})}}function h(e){e.jobId===a(u,this)&&this.push(e.data)}n.ProxyPostMessageStream=p}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/ProxyPostMessageStream.cjs"}],[3096,{"../../utils.cjs":3115,"../AbstractExecutionService.cjs":3094,"@metamask/post-message-stream":2891,"@metamask/snaps-utils":3146},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IframeExecutionService=void 0;const r=e("@metamask/post-message-stream"),a=e("@metamask/snaps-utils"),i=e("../../utils.cjs"),o=e("../AbstractExecutionService.cjs");class c extends o.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:n,...r}){super({...r,messenger:t,setupSnapProvider:n}),s(this,"iframeUrl",void 0),this.iframeUrl=e}async terminateJob(e){const t=document.getElementById(e.id);t&&(t.id="",await(0,i.withTimeout)(new Promise(e=>{t.addEventListener("load",()=>e(),{once:!0}),t.src="about:blank"}),10),t.remove())}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=await(0,a.createWindow)({uri:this.iframeUrl.toString(),id:e});return{worker:t,stream:new r.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}}n.IframeExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/IframeExecutionService.cjs"}],[3097,{"./IframeExecutionService.cjs":3096},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./IframeExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/index.cjs"}],[3098,{"./AbstractExecutionService.cjs":3094,"./ProxyPostMessageStream.cjs":3095,"./iframe/index.cjs":3097,"./offscreen/index.cjs":3100},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./AbstractExecutionService.cjs"),n),r(e("./ProxyPostMessageStream.cjs"),n),r(e("./iframe/index.cjs"),n),r(e("./offscreen/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/index.cjs"}],[3099,{"../proxy/ProxyExecutionService.cjs":3101,"@metamask/post-message-stream":2891},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.OffscreenExecutionService=void 0;const a=e("@metamask/post-message-stream"),i=e("../proxy/ProxyExecutionService.cjs");var o=new WeakMap;class c extends i.ProxyExecutionService{constructor({messenger:e,setupSnapProvider:t,offscreenPromise:n,...i}){var c,l,u;super({...i,messenger:e,setupSnapProvider:t,stream:new a.BrowserRuntimePostMessageStream({name:"parent",target:"child"})}),s(this,o,void 0),l=this,u=n,(c=o).set(r(c,l),u)}async initEnvStream(e){var t,n;return await(t=o,n=this,t.get(r(t,n))),await super.initEnvStream(e)}}n.OffscreenExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/OffscreenExecutionService.cjs"}],[31,{"../../../shared/constants/bridge":6176,"../../../shared/lib/trace":6299,"@metamask/bridge-status-controller":1556,"@metamask/controller-utils":1639},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStatusControllerInit=void 0;var s=e("@metamask/bridge-status-controller"),r=e("@metamask/controller-utils"),a=e("../../../shared/lib/trace"),i=e("../../../shared/constants/bridge");n.BridgeStatusControllerInit=({controllerMessenger:e,persistedState:t,getController:n})=>{const o=n("TransactionController");return{controller:new s.BridgeStatusController({messenger:e,state:t.BridgeStatusController,fetchFn:async(e,t)=>await(0,r.handleFetch)(e,{method:"GET",...t}),addTransactionFn:(...e)=>o.addTransaction(...e),addTransactionBatchFn:(...e)=>o.addTransactionBatch(...e),estimateGasFeeFn:(...e)=>o.estimateGasFee(...e),updateTransactionFn:(...e)=>o.updateTransaction(...e),config:{customBridgeApiBaseUrl:i.BRIDGE_API_BASE_URL},traceFn:(...e)=>(0,a.trace)(...e)})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-status-controller-init.ts"}],[310,{"../../../shared/lib/promise-with-resolvers":6291,lodash:5239,loglevel:5247},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OperationSafener=void 0;var s,r=e("lodash"),a=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("../../../shared/lib/promise-with-resolvers");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function l(e,t){return e.get(d(e,t))}function u(e,t,n){return e.set(d(e,t),n),n}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,h=new WeakMap;n.OperationSafener=class{constructor({op:e,wait:t,options:n}){c(this,p,void 0),c(this,h,null),o(this,"evacuate",()=>{if(l(h,this))return a.default.warn("already evacuating"),l(h,this);const e=l(p,this).flush();if(e){const{promise:t,resolve:n}=(0,i.withResolvers)();e.finally(n),u(h,this,t)}else u(h,this,Promise.resolve());return l(h,this)}),o(this,"execute",(...e)=>l(h,this)?(a.default.warn("evacuating, ignoring call to `execute`"),!1):(l(p,this).call(this,...e),!0));const s={mode:"exclusive"};u(p,this,(0,r.debounce)((...t)=>navigator.locks.request("operation-safener-lock",s,()=>e(...t)),t,n))}}}}},{package:"$root$",file:"app/scripts/lib/operation-safener.ts"}],[3100,{"./OffscreenExecutionService.cjs":3099},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./OffscreenExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/index.cjs"}],[3101,{"../AbstractExecutionService.cjs":3094,"../ProxyPostMessageStream.cjs":3095,nanoid:5438},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyExecutionService=void 0;const i=e("nanoid"),o=e("../AbstractExecutionService.cjs"),c=e("../ProxyPostMessageStream.cjs");var l=new WeakMap;class u extends o.AbstractExecutionService{constructor({stream:e,messenger:t,setupSnapProvider:n,...r}){var i,o,c;super({...r,messenger:t,setupSnapProvider:n,usePing:!1}),s(this,l,void 0),o=this,c=e,(i=l).set(a(i,o),c)}async terminateJob(e){r(l,this).write({jobId:e.id,data:{jsonrpc:"2.0",method:"terminateJob",id:(0,i.nanoid)()}})}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=new c.ProxyPostMessageStream({stream:r(l,this),jobId:e});return await new Promise(e=>{t.once("data",e),t.write({name:"command",data:{jsonrpc:"2.0",method:"ping",id:(0,i.nanoid)()}})}),{worker:e,stream:t}}}n.ProxyExecutionService=u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/proxy/ProxyExecutionService.cjs"}],[3102,{"../fsm.cjs":3084,"../logging.cjs":3091,"../utils.cjs":3115,"./Timer.cjs":3103,"./constants.cjs":3104,"./location/index.cjs":3107,"./registry/index.cjs":3111,"./selectors.cjs":3114,"@metamask/approval-controller":1359,"@metamask/base-controller":1520,"@metamask/permission-controller":2862,"@metamask/rpc-errors":3026,"@metamask/snaps-rpc-methods":3209,"@metamask/snaps-sdk":3265,"@metamask/snaps-utils":3146,"@metamask/utils":3554,"@xstate/fsm":4028,"async-mutex":4345,nanoid:5438,semver:5987},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const l=e("@metamask/approval-controller"),u=e("@metamask/base-controller"),d=e("@metamask/permission-controller"),p=e("@metamask/rpc-errors"),h=e("@metamask/snaps-rpc-methods"),m=e("@metamask/snaps-sdk"),f=e("@metamask/snaps-utils"),g=e("@metamask/utils"),S=e("@xstate/fsm"),b=e("async-mutex"),y=e("nanoid"),v=e("semver"),w=e("./constants.cjs"),_=e("./location/index.cjs"),k=e("./registry/index.cjs"),E=e("./selectors.cjs"),T=e("./Timer.cjs"),P=e("../fsm.cjs"),j=e("../logging.cjs"),O=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const R=new Set(["initialPermissions","id","version","enabled","blocked"]),A={snaps:{},snapStates:{},unencryptedSnapStates:{},isReady:!1};function I(e){return Object.keys(e).reduce((t,n)=>(R.has(n)&&(t[n]=e[n]),t),{})}var M=new WeakMap,C=new WeakMap,N=new WeakMap,x=new WeakMap,L=new WeakMap,$=new WeakMap,D=new WeakMap,U=new WeakMap,H=new WeakMap,F=new WeakMap,q=new WeakMap,W=new WeakMap,B=new WeakMap,V=new WeakMap,z=new WeakMap,G=new WeakMap,Y=new WeakMap,K=new WeakMap,J=new WeakMap,X=new WeakMap,Z=new WeakMap,Q=new WeakSet,ee=new WeakMap;class te extends u.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["endowment:caip25","wallet_snap"],environmentEndowmentPermissions:d=[],excludedPermissions:p={},idleTimeCheckInterval:h=(0,g.inMilliseconds)(5,g.Duration.Second),maxIdleTime:S=(0,g.inMilliseconds)(30,g.Duration.Second),maxRequestTime:b=(0,g.inMilliseconds)(60,g.Duration.Second),fetchFunction:y=globalThis.fetch.bind(undefined),featureFlags:v={},detectSnapLocation:k=_.detectSnapLocation,preinstalledSnaps:E=null,encryptor:T,getMnemonicSeed:P,getFeatureFlags:j=()=>({}),clientCryptography:R,trackEvent:I,ensureOnboardingComplete:te}){var ie,oe,ce;super({messenger:t,metadata:{isReady:{includeInStateLogs:!0,includeInDebugSnapshot:!0,persist:!1,usedInUi:!1},snapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},unencryptedSnapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},snaps:{includeInStateLogs:e=>Object.values(e).reduce((e,t)=>{const n={...t};return delete n.sourceCode,delete n.auxiliaryFiles,e[t.id]=n,e},{}),persist:e=>Object.values(e).filter(e=>e.status!==f.SnapStatus.Installing).map(e=>({...e,status:f.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:n.controllerName,state:{...A,...l}}),a(oe=this,ce=Q),ce.add(oe),r(this,M,void 0),r(this,C,void 0),r(this,N,void 0),r(this,x,void 0),r(this,L,void 0),r(this,$,void 0),r(this,D,void 0),r(this,U,void 0),s(this,"maxRequestTime",void 0),r(this,H,void 0),r(this,F,void 0),r(this,q,void 0),r(this,W,void 0),r(this,B,void 0),r(this,V,void 0),r(this,z,void 0),r(this,G,void 0),r(this,Y,void 0),r(this,K,void 0),r(this,J,void 0),r(this,X,void 0),r(this,Z,void 0),r(this,ee,(0,O.debouncePersistState)((e,t,n)=>{c(Q,this,Xe).call(this,e).stateMutex.runExclusive(async()=>{const s=await c(Q,this,be).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=s}):this.update(t=>{t.unencryptedSnapStates[e]=s})}).catch(f.logError)},w.STATE_DEBOUNCE_TIMEOUT)),o(M,this,e),o(C,this,u),o(N,this,d),o(x,this,p),o(L,this,v),o($,this,y),o(D,this,h),o(U,this,S),this.maxRequestTime=b,o(B,this,k),o(H,this,T),o(F,this,P),o(q,this,j),o(W,this,R),o(K,this,E),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(z,this,new Map),o(V,this,new Map),o(J,this,I),o(Z,this,te),c(Q,this,ae).call(this),this.messenger.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(Q,this,it).call(this,t,e,f.HandlerType.OnInstall).catch(t=>{(0,f.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messenger.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{c(Q,this,it).call(this,n,e,f.HandlerType.OnUpdate).catch(t=>{(0,f.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messenger.subscribe("KeyringController:lock",c(Q,this,ot).bind(this)),c(Q,this,ne).call(this),c(Q,this,se).call(this),Object.values((null===(ie=this.state)||void 0===ie?void 0:ie.snaps)??{}).forEach(e=>c(Q,this,Ze).call(this,e.id)),i(K,this)&&c(Q,this,re).call(this,i(K,this)),o(X,this,(0,O.throttleTracking)((e,t,n,s)=>{const r=this.messenger.call("SnapsRegistry:getMetadata",e);i(J,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==r?void 0:r.category,success:n,origin:s}})}))}init(){c(Q,this,ue).call(this).catch(f.logWarning),c(Q,this,at).call(this,w.METAMASK_ORIGIN,f.HandlerType.OnStart)}async updateRegistry(){await c(Q,this,ue).call(this),await this.messenger.call("SnapsRegistry:update");const e=await this.messenger.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));if(await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===k.SnapsRegistryStatus.Blocked?c(Q,this,ie).call(this,e,n):c(Q,this,oe).call(this,e))),!i(L,this).autoUpdatePreinstalledSnaps)return;await Promise.allSettled(Object.values(this.state.snaps).filter(e=>e.preinstalled).map(async e=>{const t=await c(Q,this,je).call(this,e.id,"*");if("*"!==t&&(0,g.gtVersion)(t,e.version)){const n=i(B,this).call(this,e.id,{versionRange:t,fetch:i($,this),allowLocal:!1,useNpmProxy:!0});await c(Q,this,Pe).call(this,{origin:l.ORIGIN_METAMASK,snapId:e.id,location:n,versionRange:t,automaticUpdate:!0})}}))}_onUnhandledSnapError(e,t){(0,f.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,f.SnapStatusEvents.Crash).catch(e=>{(0,f.logError)(e)})}_onOutboundRequest(e){const t=c(Q,this,Xe).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(Q,this,Xe).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){await c(Q,this,ue).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(Q,this,Re).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messenger.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,f.SnapStatusEvents.Stop),this.messenger.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=f.SnapStatusEvents.Stop){const n=c(Q,this,Je).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:s,resolve:r}=(0,g.createDeferredPromise)();n.stopPromise=s;try{var a;if(this.isRunning(e))null===(a=i(M,this))||void 0===a||a.call(this,e),await c(Q,this,he).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&c(Q,this,pe).call(this,e,t),r()}}async stopAllSnaps(e=f.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,g.assert)(t!==undefined,`Snap "${e}" not found.`),t}getTruncated(e){const t=this.get(e);return t?I(t):null}getTruncatedExpect(e){return I(this.getExpect(e))}async updateSnapState(e,t,n){const s=c(Q,this,Xe).call(this,e);n?s.state=t:s.unencryptedState=t,i(ee,this).call(this,e,t,n)}clearSnapState(e,t){const n=c(Q,this,Xe).call(this,e);t?n.state=null:n.unencryptedState=null,i(ee,this).call(this,e,null,t)}async getSnapState(e,t){const n=c(Q,this,Xe).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const s=t?n.state:n.unencryptedState;if(s!==undefined)return s;const r=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===r||r===undefined)return null;if(!t){const e=JSON.parse(r);return n.unencryptedState=e,e}const a=await c(Q,this,ge).call(this,e,r);return n.state=a,a})}async getSnapFile(e,t,n=m.AuxiliaryFileEncoding.Base64){var s;const r=this.getExpect(e),a=(0,f.normalizeRelative)(t),i=null===(s=r.auxiliaryFiles)||void 0===s||null===(s=s.find(e=>e.path===a))||void 0===s?void 0:s.value;if(!i)return null;const o=await(0,f.encodeAuxiliaryFile)(i,n);return(0,g.assert)(o.length<f.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:s}=n.manifest;return!!s&&(0,v.gte)(s,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>c(Q,this,_e).call(this,e)),this.update(e=>{e.isReady=!1,e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),i(V,this).clear(),i(z,this).clear(),i(K,this)&&c(Q,this,re).call(this,i(K,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,g.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),c(Q,this,_e).call(this,e),c(Q,this,we).call(this,e),i(V,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==f.SnapStatus.Installing&&this.messenger.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),a=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);if(!a)return;if(Boolean(null===(s=a.value)||void 0===s?void 0:s[t])){const n={...a.value};delete n[t],Object.keys(n).length>0?this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,f.SnapCaveatType.SnapIds,n):this.messenger.call("PermissionController:revokePermissions",{[e]:[h.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,g.assert)(t.every(e=>i(C,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messenger.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(Q,this,Xe).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(Q,this,Xe).call(this,e);(0,g.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(I)}getRunnableSnaps(){return(0,E.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messenger.call("PermissionController:getPermissions",e)??{})[h.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===f.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),s=this.getTruncated(t);return s&&(null==n?void 0:n.status)!==f.SnapStatus.Installing&&(e[t]=s),e},{})}async installSnaps(e,t){await c(Q,this,ue).call(this);const n={},s=Object.keys(t),r=[],a=[];try{for(const[s,{version:o}]of Object.entries(t)){(0,f.assertIsValidSnapId)(s);const[t,l]=(0,f.resolveVersionRange)(o);if(t)throw p.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=i(B,this).call(this,s,{versionRange:l,fetch:i($,this),allowLocal:i(L,this).allowLocalSnaps,resolveVersion:async e=>i(L,this).requireAllowlist?await c(Q,this,je).call(this,s,e):e}),d=this.has(s)&&!u.shouldAlwaysReload;if(d&&c(Q,this,rt).call(this,s,l)){const e=this.getExpect(s);r.push({snapId:s,oldVersion:e.version});let t=c(Q,this,ze).call(this,s);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(Q,this,Ge).call(this,s),t.newVersion=l}else d||a.push(s);n[s]=await c(Q,this,ke).call(this,e,s,u,l)}a.forEach(t=>this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),r.forEach(({snapId:t,oldVersion:n})=>this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),s.forEach(e=>i(z,this).delete(e))}catch(e){const t=a.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...i(z,this).keys()],s=r.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await c(Q,this,Ke).call(this,s),e}return n}destroy(){super.destroy(),i(G,this)&&clearTimeout(i(G,this)),this.messenger.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.clearEventSubscriptions("SnapController:snapInstalled"),this.messenger.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:s}){await c(Q,this,ue).call(this);const r=this.get(e);(0,g.assert)(r,`The Snap "${e}" is not installed. Please install it before invoking it.`),(0,g.assert)(t===w.METAMASK_ORIGIN||(0,f.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const a={jsonrpc:"2.0",id:(0,y.nanoid)(),...s};(0,g.assertIsJsonRpcRequest)(a);const i=h.handlerEndowments[n];(0,g.assert)("string"==typeof i||null===i,"'permissionName' must be either a string or null.");const o=this.messenger.call("PermissionController:getPermissions",e);if(!(null===i||o&&(0,g.hasProperty)(o,i)))throw new Error(`Snap "${e}" is not permitted to use "${i}".`);const l=i?o[i]:undefined;if(i===h.SnapEndowments.Rpc||i===h.SnapEndowments.Keyring){(0,g.assert)(l);const n=this.messenger.call("SubjectMetadataController:getSubjectMetadata",t),s=i===h.SnapEndowments.Rpc?(0,h.getRpcCaveatOrigins)(l):(0,h.getKeyringCaveatOrigins)(l);if((0,g.assert)(s),!(0,f.isOriginAllowed)(s,(null==n?void 0:n.subjectType)??d.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==w.METAMASK_ORIGIN&&w.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!r.enabled)throw new Error(`Snap "${e}" is disabled.`);if(r.status===f.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const u=c(Q,this,xe).call(this,l),p=c(Q,this,Xe).call(this,e);if(p.stopPromise&&await p.stopPromise,!this.isRunning(e)){p.startPromise||(p.startPromise=this.startSnap(e));try{await p.startPromise}finally{p.startPromise=null}}const m=c(Q,this,qe).call(this,e,n,a),S=new T.Timer(u);c(Q,this,Be).call(this,e,m.id,S);const b=this.messenger.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:m});try{const s=await(0,O.withTimeout)(b,S);if(s===O.hasTimedOut){const t=null!==p.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(Q,this,We).call(this,e,n,s);const r=await c(Q,this,De).call(this,e,n,m,s);return c(Q,this,Ve).call(this,e,m.id,n,t,!0),r}catch(s){c(Q,this,Ve).call(this,e,m.id,n,t,!1);const[r,a]=(0,f.unwrapError)(s),i=null!==p.stopPromise||!this.isRunning(e);throw a||(i||(0,f.logError)(`"${e}" crashed due to an unhandled error:`,r),await this.stopSnap(e,f.SnapStatusEvents.Crash)),r}}setClientActive(e){e?c(Q,this,at).call(this,w.METAMASK_ORIGIN,f.HandlerType.OnActive):c(Q,this,at).call(this,w.METAMASK_ORIGIN,f.HandlerType.OnInactive)}}function ne(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:f.SnapStatus.Installing,states:{[f.SnapStatus.Installing]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e}}},[f.SnapStatus.Updating]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Stop]:f.SnapStatus.Stopped}},[f.SnapStatus.Running]:{on:{[f.SnapStatusEvents.Stop]:f.SnapStatus.Stopped,[f.SnapStatusEvents.Crash]:f.SnapStatus.Crashed}},[f.SnapStatus.Stopped]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Update]:f.SnapStatus.Updating}},[f.SnapStatus.Crashed]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Update]:f.SnapStatus.Updating}}}};o(Y,this,(0,S.createMachine)(t)),(0,P.validateMachine)(i(Y,this))}function se(){this.messenger.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messenger.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messenger.registerActionHandler(`${n.controllerName}:updateRegistry`,async()=>this.updateRegistry()),this.messenger.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messenger.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messenger.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messenger.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function re(e){for(const{snapId:n,manifest:s,files:r,removable:a,hidden:i,hideSnapBranding:o}of e){var t;const e=this.get(n),l=e!==undefined,u=l&&(0,g.gtVersion)(s.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const d=new f.VirtualFile({path:f.NpmSnapFileNames.Manifest,value:JSON.stringify(s),result:s}),p=r.map(({path:e,value:t})=>new f.VirtualFile({value:t,path:e})),{filePath:m,iconPath:S}=s.source.location.npm,b=p.find(e=>e.path===m),y=S?p.find(e=>e.path===S):undefined;(0,g.assert)(b,"Source code not provided for preinstalled snap."),(0,g.assert)(!S||S&&y,"Icon not provided for preinstalled snap."),(0,g.assert)(s.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const v=(null===(t=s.source.locales)||void 0===t?void 0:t.map(e=>p.find(t=>t.path===e)))??[],_=(0,f.getValidatedLocalizationFiles)(v.filter(Boolean));(0,g.assert)(v.length===_.length,"Missing localization files for preinstalled snap.");const k={manifest:d,sourceCode:b,svgIcon:y,auxiliaryFiles:[],localizationFiles:_};c(Q,this,Ie).call(this,{id:n,origin:w.METAMASK_ORIGIN,files:k,removable:a,hidden:i,hideSnapBranding:o,preinstalled:!0});const E=(0,h.processSnapPermissions)(s.initialPermissions);c(Q,this,Me).call(this,E);const{newPermissions:T,unusedPermissions:P}=c(Q,this,et).call(this,n,E);c(Q,this,st).call(this,{snapId:n,newPermissions:T,unusedPermissions:P}),s.initialConnections&&c(Q,this,ye).call(this,n,(null==e?void 0:e.initialConnections)??null,s.initialConnections),this.update(e=>{e.snaps[n].status=f.SnapStatus.Stopped}),c(Q,this,Ze).call(this,n),u?this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,w.METAMASK_ORIGIN,!0):this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),w.METAMASK_ORIGIN,!0)}for(const t of Object.values(this.state.snaps).filter(({preinstalled:e})=>e)){const r=(0,h.processSnapPermissions)(t.manifest.initialPermissions);c(Q,this,Me).call(this,r);const{newPermissions:a,unusedPermissions:i}=c(Q,this,et).call(this,t.id,r);if((0,g.isNonEmptyArray)(Object.keys(a))||(0,g.isNonEmptyArray)(Object.keys(i))){var n,s;const{proposedName:r}=(0,f.getLocalizedSnapManifest)(t.manifest,"en",t.localizationFiles??[]),o=e.find(e=>e.snapId===t.id),{iconPath:l}=t.manifest.source.location.npm,u=l&&o?o.files.find(e=>e.path===l):undefined;this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:r,origin:t.id,version:t.version,svgIcon:u?new f.VirtualFile(u).toString():null}),c(Q,this,st).call(this,{snapId:t.id,newPermissions:a,unusedPermissions:i}),(0,f.logWarning)(`The permissions for "${t.id}" were out of sync and have been automatically restored. If you see this message, please file a bug report.`),null===(n=(s=this.messenger).captureException)||void 0===n||n.call(s,new Error(`The permissions for "${t.id}" were out of sync and have been automatically restored. This could indicate persistence issues.`))}}}function ae(){o(G,this,setTimeout(()=>{c(Q,this,de).call(this).catch(e=>{(0,f.logError)(e)}),c(Q,this,ae).call(this)},i(D,this)))}async function ie(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,f.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messenger.publish(`${n.controllerName}:snapBlocked`,e,t)}}function oe(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messenger.publish(`${n.controllerName}:snapUnblocked`,e))}async function ce(e,{platformVersion:t,...n}){const s=(await this.messenger.call("SnapsRegistry:get",{[e]:n}))[e];var r;if(s.status===k.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(r=s.reason)||void 0===r?void 0:r.explanation)??""}`);const a=Object.keys(n.permissions).some(e=>!w.ALLOWED_PERMISSIONS.includes(e));if(i(L,this).requireAllowlist&&a&&s.status!==k.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${s.status===k.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(Q,this,Ce).call(this,e,t)}function le(){(0,g.assert)(!0!==i(L,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}async function ue(){await i(Z,this).call(this);const e=!0!==i(q,this).call(this).disableSnaps;this.state.isReady!==e&&this.update(t=>{t.isReady=e}),(0,g.assert)(e,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function de(){const e=[...i(V,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&i(U,this)&&(0,g.timeSince)(t.lastRequest)>i(U,this)).map(async([e])=>this.stopSnap(e,f.SnapStatusEvents.Stop)))}function pe(e,t){const{interpreter:n}=c(Q,this,Xe).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function he(e){await this.messenger.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(Q,this,Xe).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messenger.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function me(e,t=c(Q,this,Xe).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function fe({snapId:e,salt:t,useCache:n,keyMetadata:s}){const r=c(Q,this,Xe).call(this,e);if(c(Q,this,me).call(this,e,r)&&n)return{key:await i(H,this).importKey(r.encryptionKey),salt:r.encryptionSalt};const a=t??i(H,this).generateSalt(),o=await i(F,this).call(this),l=await(0,h.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:i(W,this)}),u=await i(H,this).keyFromPassword(l,a,!0,s),d=await i(H,this).exportKey(u);return n&&(r.encryptionKey=d,r.encryptionSalt=a),{key:u,salt:a}}async function ge(e,t){try{const n=JSON.parse(t),{salt:s,keyMetadata:r}=n,a=c(Q,this,me).call(this,e)||i(H,this).isVaultUpdated(t),{key:o}=await c(Q,this,fe).call(this,{snapId:e,salt:s,useCache:a,keyMetadata:r??w.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await i(H,this).decryptWithKey(o,n)}catch{throw p.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function Se(e,t){const{key:n,salt:s}=await c(Q,this,fe).call(this,{snapId:e,useCache:!0}),r=await i(H,this).encryptWithKey(n,t);return r.salt=s,JSON.stringify(r)}async function be(e,t,n){return null===t?null:n?await c(Q,this,Se).call(this,e,t):JSON.stringify(t)}function ye(e,t,n){if(t){const s=(0,O.setDiff)(t,n);for(const t of Object.keys(s))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))c(Q,this,ve).call(this,t,e)}function ve(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),a=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);if(Boolean(null==a||null===(s=a.value)||void 0===s?void 0:s[t]))return;if(a)return void this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,f.SnapCaveatType.SnapIds,{...a.value,[t]:{}});const i={[h.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:f.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:i,subject:{origin:e}})}function we(e){const t=this.messenger.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function _e(e){this.messenger.call("PermissionController:hasPermissions",e)&&this.messenger.call("PermissionController:revokeAllPermissions",e)}async function ke(e,t,s,r){const a=this.getTruncated(t);if(a&&!s.shouldAlwaysReload)return(0,g.satisfiesVersionRange)(a.version,r)?a:await c(Q,this,Pe).call(this,{origin:e,snapId:t,location:s,versionRange:r});c(Q,this,le).call(this);let i=c(Q,this,Ee).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messenger.publish("SnapController:snapInstallStarted",t,e,!1),a&&this.isRunning(t)&&await this.stopSnap(t,f.SnapStatusEvents.Stop),a&&s.shouldAlwaysReload&&c(Q,this,_e).call(this,t);try{const{sourceCode:a}=await c(Q,this,Oe).call(this,{origin:e,id:t,location:s,versionRange:r});await c(Q,this,Ne).call(this,t,i),i=c(Q,this,Ee).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await c(Q,this,Re).call(this,{snapId:t,sourceCode:a});const o=this.getTruncatedExpect(t);return c(Q,this,Te).call(this,i.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(s){(0,f.logError)(`Error when adding ${t}.`,s);const r=s instanceof Error?s.message:s.toString();throw c(Q,this,Te).call(this,i.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:r}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!1,r),s}}function Ee({origin:e,snapId:t,type:n}){const s=(0,y.nanoid)();return{id:s,promise:this.messenger.call("ApprovalController:addRequest",{origin:e,id:s,type:n,requestData:{metadata:{id:s,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function Te(e,t){try{this.messenger.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function Pe({origin:e,snapId:t,location:s,versionRange:r,automaticUpdate:a=!1}){a||c(Q,this,le).call(this),await c(Q,this,ue).call(this);const i=this.getExpect(t),{preinstalled:o,removable:l,hidden:u,hideSnapBranding:d}=i;if(o&&!a)throw new Error("Preinstalled Snaps cannot be manually updated.");let m=a?null:c(Q,this,Ee).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messenger.publish("SnapController:snapInstallStarted",t,e,!0);const S=i.manifest,b=await(0,O.fetchSnap)(t,s),{sourceCode:y,manifest:v}=b,w=v.result,_=w.version;if(!(0,g.gtVersion)(_,i.version))throw p.rpcErrors.invalidParams(`Snap "${t}@${i.version}" is already installed. Couldn't update to a version inside requested "${r}" range.`);if(!(0,g.satisfiesVersionRange)(_,r))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${_}" which doesn't satisfy requested version range "${r}".`);await c(Q,this,ce).call(this,t,{version:_,checksum:w.source.shasum,permissions:w.initialPermissions,platformVersion:w.platformVersion});const k=(0,h.processSnapPermissions)(w.initialPermissions);c(Q,this,Me).call(this,k);const{newPermissions:E,unusedPermissions:T,approvedPermissions:P}=c(Q,this,et).call(this,t,k),{newConnections:j,unusedConnections:R,approvedConnections:A}=c(Q,this,nt).call(this,t,S.initialConnections??{},w.initialConnections??{});let I,M;if(m){c(Q,this,Te).call(this,m.id,{permissions:E,newVersion:w.version,newPermissions:E,approvedPermissions:P,unusedPermissions:T,newConnections:j,unusedConnections:R,approvedConnections:A,loading:!1});const{permissions:s,...r}=await m.promise;I=s,M=r,m=c(Q,this,Ee).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT})}else(0,g.assert)(a),I=E;this.isRunning(t)&&await this.stopSnap(t,f.SnapStatusEvents.Stop),c(Q,this,pe).call(this,t,f.SnapStatusEvents.Update),c(Q,this,Ie).call(this,{origin:e,id:t,files:b,removable:l,preinstalled:o,hidden:u,hideSnapBranding:d,isUpdate:!0}),c(Q,this,st).call(this,{snapId:t,unusedPermissions:T,newPermissions:I,requestData:M});const C=S.initialConnections??null,N=w.initialConnections??{};c(Q,this,ye).call(this,t,C,N);const x=c(Q,this,ze).call(this,t);x!==undefined&&(x.permissions.revoked=T,x.permissions.granted=I,x.permissions.requestData=M,x.previousInitialConnections=C,x.newInitialConnections=N);const L=y.toString();(0,g.assert)("string"==typeof L&&L.length>0,`Invalid source code for snap "${t}".`);try{await c(Q,this,Re).call(this,{snapId:t,sourceCode:L})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const $=this.getTruncatedExpect(t);return m&&c(Q,this,Te).call(this,m.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),$}catch(s){(0,f.logError)(`Error when updating ${t},`,s);const r=s instanceof Error?s.message:s.toString();throw m&&c(Q,this,Te).call(this,m.id,{loading:!1,error:r,type:n.SNAP_APPROVAL_UPDATE}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!0,r),s}}async function je(e,t){return await this.messenger.call("SnapsRegistry:resolveVersion",e,t)}async function Oe(e){const{id:t,location:n,versionRange:s}=e;c(Q,this,Ze).call(this,t);const r=c(Q,this,Xe).call(this,t);r.installPromise||((0,j.log)(`Adding snap: ${t}`),r.installPromise=(async()=>{const r=await(0,O.fetchSnap)(t,n),a=r.manifest.result;if(!(0,g.satisfiesVersionRange)(a.version,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${a.version}" which doesn't satisfy requested version range "${s}".`);await c(Q,this,ce).call(this,t,{version:a.version,checksum:a.source.shasum,permissions:a.initialPermissions,platformVersion:a.platformVersion});const o=i(L,this).forcePreinstalledSnaps&&(0,O.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(Q,this,Ie).call(this,{...e,files:r,id:t,...o})})());try{return await r.installPromise}catch(e){throw r.installPromise=null,e}}async function Re(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=c(Q,this,Xe).call(this,t),s=await this.messenger.call("ExecutionService:executeSnap",{...e,endowments:await c(Q,this,Ae).call(this,t)});return c(Q,this,pe).call(this,t,f.SnapStatusEvents.Start),n.lastRequest=Date.now(),s}catch(e){throw await c(Q,this,he).call(this,t),e}}async function Ae(e){let t=[];for(const n of i(N,this))if(this.messenger.call("PermissionController:hasPermission",e,n)){const s=await this.messenger.call("PermissionController:getEndowments",e,n);if(s){if(!Array.isArray(s)||s.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(s)}}const n=[...new Set([...f.DEFAULT_ENDOWMENTS,...t])];return n.length<f.DEFAULT_ENDOWMENTS.length+t.length&&(0,f.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function Ie(e){const{id:t,origin:n,files:s,isUpdate:r=!1,removable:a,preinstalled:o,hidden:l,hideSnapBranding:u}=e,{manifest:p,sourceCode:h,svgIcon:m,auxiliaryFiles:S,localizationFiles:b}=s;(0,f.assertIsSnapManifest)(p.result);const{version:y}=p.result,v=h.toString();(0,g.assert)("string"==typeof v&&v.length>0,`Invalid source code for snap "${t}".`);const w=S.map(e=>((0,g.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),_=this.state.snaps[t],k=[...(null==_?void 0:_.versionHistory)??[],{version:y,date:Date.now(),origin:n}],E=b.map(e=>e.result),T={..._,blocked:!1,enabled:!0,removable:a,preinstalled:o,hidden:l,hideSnapBranding:u,id:t,initialConnections:p.result.initialConnections,initialPermissions:p.result.initialPermissions,manifest:p.result,status:i(Y,this).config.initial,sourceCode:v,version:y,versionHistory:k,auxiliaryFiles:w,localizationFiles:E};delete T.blockInformation;const{inversePatches:P}=this.update(e=>{e.snaps[t]=T});if(r){const e=c(Q,this,ze).call(this,t);e!==undefined&&(e.statePatches=P)}const{proposedName:j}=(0,f.getLocalizedSnapManifest)(p.result,"en",E);return this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:j,origin:T.id,version:y,svgIcon:(null==m?void 0:m.toString())??null}),{...T,sourceCode:v}}function Me(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(h.handlerEndowments)));(0,g.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const s=t.reduce((e,t)=>((0,g.hasProperty)(i(x,this),t)&&e.push(i(x,this)[t]),e),[]);(0,g.assert)(0===s.length,`One or more permissions are not allowed:\n${s.join("\n")}`)}function Ce(e,t){if(t!==undefined&&(0,v.gt)(t,(0,f.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,f.getPlatformVersion)()}".`;if(i(L,this).rejectInvalidPlatformVersion)throw new Error(n);(0,f.logWarning)(n)}}async function Ne(e,t){(0,j.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:s,initialConnections:r}=n;try{const a=(0,h.processSnapPermissions)(s);c(Q,this,Me).call(this,a),c(Q,this,Te).call(this,t.id,{loading:!1,connections:r??{},permissions:a});const{permissions:i,...o}=await t.promise;c(Q,this,st).call(this,{snapId:e,newPermissions:i,requestData:o}),n.manifest.initialConnections&&c(Q,this,ye).call(this,e,null,n.manifest.initialConnections)}finally{c(Q,this,Xe).call(this,e).installPromise=null}}function xe(e){return(0,h.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function Le(e,t,n){return this.messenger.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function $e(e,t){(0,g.assert)(this.messenger.call("SnapInterfaceController:getInterface",e,t))}async function De(e,t,n,s){switch(t){case f.HandlerType.OnTransaction:case f.HandlerType.OnSignature:case f.HandlerType.OnHomePage:case f.HandlerType.OnSettingsPage:{const t=s;if(t&&(0,g.hasProperty)(t,"content")){const{content:n,...s}=t;return{...s,id:await c(Q,this,Le).call(this,e,n)}}return s}case f.HandlerType.OnAssetsLookup:return c(Q,this,Ue).call(this,e,n,s);case f.HandlerType.OnAssetsConversion:return c(Q,this,He).call(this,n,s);case f.HandlerType.OnAssetsMarketData:return c(Q,this,Fe).call(this,n,s);default:return s}}function Ue(e,{params:t},{assets:n}){const s=this.messenger.call("PermissionController:getPermissions",e);(0,g.assert)(s);const r=s[h.SnapEndowments.Assets],a=(0,h.getChainIdsCaveat)(r);(0,g.assert)(a);const{assets:i}=t;return{assets:Object.keys(n).reduce((e,t)=>{const s=t;return a.some(e=>s.startsWith(e))&&i.includes(s)&&(e[s]=n[s]),e},{})}}function He({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var s;const r=null===(s=t[n.from])||void 0===s?void 0:s[n.to];var a;r&&(e[a=n.from]??(e[a]={}),e[n.from][n.to]=r);return e},{})}}function Fe({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var s;const r=null===(s=t[n.asset])||void 0===s?void 0:s[n.unit];var a;r&&(e[a=n.asset]??(e[a]={}),e[n.asset][n.unit]=r);return e},{})}}function qe(e,t,n){if(t===f.HandlerType.OnUserInput){(0,g.assert)(n.params&&(0,g.hasProperty)(n.params,"id"));const t=n.params.id,{context:s}=this.messenger.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:s}}}return n}async function We(e,t,n){switch(t){case f.HandlerType.OnTransaction:(0,g.assertStruct)(n,f.OnTransactionResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case f.HandlerType.OnSignature:(0,g.assertStruct)(n,f.OnSignatureResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case f.HandlerType.OnHomePage:(0,g.assertStruct)(n,f.OnHomePageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case f.HandlerType.OnSettingsPage:(0,g.assertStruct)(n,f.OnSettingsPageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case f.HandlerType.OnNameLookup:(0,g.assertStruct)(n,f.OnNameLookupResponseStruct);break;case f.HandlerType.OnAssetsLookup:(0,g.assertStruct)(n,m.OnAssetsLookupResponseStruct);break;case f.HandlerType.OnAssetsConversion:(0,g.assertStruct)(n,f.OnAssetsConversionResponseStruct);break;case f.HandlerType.OnAssetHistoricalPrice:(0,g.assertStruct)(n,f.OnAssetHistoricalPriceResponseStruct);break;case f.HandlerType.OnAssetsMarketData:(0,g.assertStruct)(n,f.OnAssetsMarketDataResponseStruct)}}function Be(e,t,n){const s=c(Q,this,Xe).call(this,e);s.pendingInboundRequests.push({requestId:t,timer:n}),s.lastRequest=null}function Ve(e,t,n,s,r){const a=c(Q,this,Xe).call(this,e);a.pendingInboundRequests=a.pendingInboundRequests.filter(e=>e.requestId!==t),0===a.pendingInboundRequests.length&&(a.lastRequest=Date.now());const o=this.get(e);if((0,O.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{i(X,this).call(this,e,n,r,s)}catch(e){(0,f.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,m.getErrorMessage)(e)}`)}}function ze(e){return i(z,this).get(e)}function Ge(e){(0,g.assert)(i(z,this).get(e)===undefined,`Snap "${e}" rollback snapshot already exists.`),i(z,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=i(z,this).get(e);return(0,g.assert)(t!==undefined,`Snapshot creation failed for ${e}.`),t}async function Ye(e){var t,n;const s=c(Q,this,ze).call(this,e);if(!s)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,f.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==f.SnapStatus.Stopped&&c(Q,this,pe).call(this,e,f.SnapStatusEvents.Stop);const{statePatches:r,permissions:a,previousInitialConnections:o,newInitialConnections:l}=s;null!=r&&r.length&&this.applyPatches(r),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==f.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=f.SnapStatus.Stopped}),c(Q,this,st).call(this,{snapId:e,unusedPermissions:a.granted,newPermissions:a.revoked,requestData:a.requestData}),c(Q,this,ye).call(this,e,l??null,o??{});const u=this.getTruncatedExpect(e);this.messenger.publish("SnapController:snapRolledback",u,s.newVersion),i(z,this).delete(e)}async function Ke(e){for(const t of e)await c(Q,this,Ye).call(this,t)}function Je(e){return i(V,this).get(e)}function Xe(e){const t=c(Q,this,Je).call(this,e);return(0,g.assert)(t!==undefined,`Snap "${e}" runtime data not found`),t}function Ze(e){if(i(V,this).has(e))return;const t=this.get(e),n=(0,S.interpret)(i(Y,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??i(Y,this).config.initial}),(0,P.forceStrict)(n),i(V,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new b.Mutex,getStateMutex:new b.Mutex})}function Qe(e,t){return Object.keys(e).reduce((n,s)=>{if(i(C,this).includes(s)){var r;const a=(0,g.hasProperty)(w.DYNAMIC_PERMISSION_DEPENDENCIES,s),i=null===(r=w.DYNAMIC_PERMISSION_DEPENDENCIES[s])||void 0===r?void 0:r.some(e=>(0,g.hasProperty)(t,e));a&&!i||(n[s]=e[s])}return n},t)}function et(e,t){const n=this.messenger.call("PermissionController:getPermissions",e)??{},s=c(Q,this,Qe).call(this,n,t),r=(0,O.permissionsDiff)(s,n),a=(0,O.permissionsDiff)(n,s);return{newPermissions:r,unusedPermissions:a,approvedPermissions:(0,O.permissionsDiff)(n,a)}}function tt(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",t),a=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);return Boolean(null==a||null===(s=a.value)||void 0===s?void 0:s[e])}function nt(e,t,n){const s=Object.keys(t).filter(t=>c(Q,this,tt).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),r=(0,O.setDiff)(n,s),a=(0,O.setDiff)(s,n);return{newConnections:r,unusedConnections:a,approvedConnections:(0,O.setDiff)(s,a)}}function st({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:s}){const r=Object.keys(t);(0,g.isNonEmptyArray)(r)&&this.messenger.call("PermissionController:revokePermissions",{[e]:r}),(0,g.isNonEmptyArray)(Object.keys(n))&&this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:n,subject:{origin:e},requestData:s})}function rt(e,t){const n=this.getExpect(e);return!(0,g.satisfiesVersionRange)(n.version,t)&&!(0,g.gtRange)(n.version,t)}function at(e,t){const n=this.getRunnableSnaps();for(const{id:s}of n){this.messenger.call("PermissionController:hasPermission",s,h.SnapEndowments.LifecycleHooks)&&c(Q,this,it).call(this,e,s,t).catch(e=>{(0,f.logError)(`Error calling lifecycle hook "${t}" for Snap "${s}": ${(0,m.getErrorMessage)(e)}`)})}}async function it(e,t,n){const s=h.handlerEndowments[n];(0,g.assert)(s,"Lifecycle hook must have an endowment.");this.messenger.call("PermissionController:hasPermission",t,s)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function ot(){for(const e of i(V,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=te}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[3103,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const r=e("@metamask/utils");n.Timer=class{constructor(e){s(this,"state",void 0),(0,r.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,r.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,r.assert)("paused"===this.status||"running"===this.status,"Tried to cancel a not running Timer"),this.onFinish(!1)}finish(){(0,r.assert)("finished"!==this.status,"Tried to finish a finished Timer."),this.onFinish(!0)}pause(){(0,r.assert)("running"===this.state.value,"Tried to pause a not running Timer");const{callback:e,start:t,timeout:n,remaining:s}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:s-(Date.now()-t)}}start(e){(0,r.assert)("stopped"===this.state.value,"Tried to start an already running Timer");const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,r.assert)("paused"===this.state.value,"Tried to resume not paused Timer");const{remaining:e,callback:t}=this.state,n=Date.now();let s;e!==Number.POSITIVE_INFINITY&&(s=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:s}}onFinish(e){(0,r.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[3104,{"@metamask/snaps-rpc-methods":3209,"@metamask/snaps-utils":3146},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DYNAMIC_PERMISSION_DEPENDENCIES=n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const s=e("@metamask/snaps-rpc-methods"),r=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",s.SnapEndowments.Cronjob,s.SnapEndowments.HomePage,s.SnapEndowments.LifecycleHooks,s.SnapEndowments.EthereumProvider,s.SnapEndowments.TransactionInsight,s.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([r.HandlerType.OnClientRequest,r.HandlerType.OnSignature,r.HandlerType.OnTransaction,r.HandlerType.OnCronjob,r.HandlerType.OnNameLookup,r.HandlerType.OnHomePage,r.HandlerType.OnSettingsPage,r.HandlerType.OnUserInput,r.HandlerType.OnAssetsLookup,r.HandlerType.OnAssetsConversion,r.HandlerType.OnAssetHistoricalPrice,r.HandlerType.OnAssetsMarketData,r.HandlerType.OnWebSocketEvent]),n.DYNAMIC_PERMISSION_DEPENDENCIES=Object.freeze({"endowment:caip25":["endowment:ethereum-provider"]})}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[3105,{"./SnapController.cjs":3102,"./constants.cjs":3104,"./location/index.cjs":3107,"./registry/index.cjs":3111,"./selectors.cjs":3114},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./constants.cjs"),n),r(e("./location/index.cjs"),n),r(e("./SnapController.cjs"),n),r(e("./selectors.cjs"),n),r(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[3106,{"@metamask/snaps-utils":3146,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const r=e("@metamask/snaps-utils"),a=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){s(this,"cache",new Map),s(this,"validatedManifest",void 0),s(this,"url",void 0),s(this,"fetchFn",void 0),s(this,"fetchOptions",void 0),(0,a.assertStruct)(e.toString(),r.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(r.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),s=(0,r.parseJson)(n),a=new r.VirtualFile({value:n,result:(0,r.createSnapManifest)(s),path:r.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=a,this.manifest()}async fetch(e){const t=(0,r.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const s=this.toCanonical(t).toString(),i=await this.fetchFn(s,this.fetchOptions);if(!i.ok)throw new Error(`Failed to fetch "${s}". Status code: ${i.status}.`);const o=await i.arrayBuffer(),c=new r.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:s}});return(0,a.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,a.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[3107,{"./http.cjs":3106,"./local.cjs":3108,"./location.cjs":3109,"./npm.cjs":3110},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./location.cjs"),n),r(e("./npm.cjs"),n),r(e("./local.cjs"),n),r(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[3108,{"./http.cjs":3106,"@metamask/snaps-utils":3146,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const i=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,r,u;s(this,l,void 0),(0,o.assertStruct)(e.toString(),i.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=l,r=this,u=new c.HttpLocation(new URL(e.toString().slice(i.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(a(n,r),u)}async manifest(){return u(await r(l,this).manifest())}async fetch(e){return u(await r(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[3109,{"./http.cjs":3106,"./local.cjs":3108,"./npm.cjs":3110,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const s=e("@metamask/utils"),r=e("./http.cjs"),a=e("./local.cjs"),i=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new i.NpmLocation(c,t);case"local:":return(0,s.assert)(o,new TypeError("Fetching local snaps is disabled.")),new a.LocalLocation(c,t);case"http:":case"https:":return(0,s.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new r.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[311,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const a=async(e,t,n)=>{const s=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var i=new WeakSet;function o(e){return new Promise((t,n)=>{const s=indexedDB.open(this.storeName,this.dbVersion);s.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},s.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},s.onsuccess=n=>{const s=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(s)}})}n.IndexedDBPPOMStorage=class{constructor(e,t){s(this,i),r(this,"storeName",void 0),r(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise((s,r)=>{(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")})(i,this,o).call(this,n).then(n=>{const a=n[e](t);a.onsuccess=async e=>{s(e)},a.onerror=t=>{var n;r(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}}).catch(e=>{r(e)})})}async read(e,t){var n;const s=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await a(e,s,t),s}async write(e,t,n){await a(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map(([e,t])=>({name:e,chainId:t}))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[3110,{"@metamask/snaps-utils":3146,"@metamask/utils":3554,"concat-stream":3167,"get-npm-tarball-url":4826,"readable-stream":3182,"readable-web-to-node-stream":5684,"tar-stream":6073},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){return e.set(c(e,t),n),n}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.NPM_REGISTRY_PROXY=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=l(e("concat-stream")),h=l(e("get-npm-tarball-url")),m=e("readable-stream"),f=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org"),n.NPM_REGISTRY_PROXY=new URL("https://npm-ota.api.cx.metamask.io");var S=new WeakMap,b=new WeakMap,y=new WeakSet;class v{constructor(e,t={}){var i,o;r(i=this,o=y),o.add(i),a(this,"meta",void 0),s(this,S,void 0),s(this,b,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),p=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,h=t.resolveVersion??(async e=>e);let m;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?m=t.useNpmProxy?n.NPM_REGISTRY_PROXY:n.DEFAULT_NPM_REGISTRY:(m="https://",e.username&&(m+=e.username,e.password&&(m+=`:${e.password}`),m+="@"),m+=e.host,m=new URL(m),(0,d.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${m.toString()}".`))),(0,d.assert)("/"===m.pathname&&""===m.search&&""===m.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let f=e.pathname;f.startsWith("/")&&(f=f.slice(1)),this.meta={requestedRange:p,registry:m,packageName:f,fetch:l,resolveVersion:h}}async manifest(){if(o(S,this))return o(S,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),i(S,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(b,this)||(await c(y,this,w).call(this),(0,d.assert)(o(b,this)!==undefined));const n=o(b,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function w(){(0,d.assert)(o(b,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,s){var r;if(E(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,h.default)(e,t),targetVersion:t};const a=await _(e,n,s),i=Object.keys((null==a?void 0:a.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(i,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==a||null===(r=a.versions)||void 0===r||null===(r=r[o])||void 0===r||null===(r=r.dist)||void 0===r?void 0:r.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const s=new URL(t);s.hostname=this.meta.registry.hostname,s.protocol=this.meta.registry.protocol;const r=await this.fetchNpmTarball(s);i(b,this,r),this.meta.version=n}n.BaseNpmLocation=v,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function _(e,t,n){const s=await n(new URL(e,t).toString(),{headers:{accept:E(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${s.status}.`);const r=await s.json();if(!(0,d.isObject)(r))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return r}function k(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function E(e){const t=e.toString();return t===n.DEFAULT_NPM_REGISTRY.toString()||t===n.NPM_REGISTRY_PROXY.toString()}n.NpmLocation=class extends v{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());(0,d.assert)(404!==t.status,`"${this.meta.packageName}" was not found in the NPM registry`),(0,d.assert)(t.ok&&t.body,`Failed to fetch tarball for package "${this.meta.packageName}"`);const s=t.headers.get("content-length");(0,d.assert)(s,"Snap tarball has invalid content-length");const r=parseInt(s,10);return(0,d.assert)(r<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,s)=>{const r=new Map,a=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const s=(0,g.extract)();let r=0;return s.on("entry",(a,i,o)=>{const{name:c,type:l}=a;if("file"===l){const a=c.replace(T,"");return i.pipe((0,p.default)({encoding:"uint8array"},i=>{try{r+=i.byteLength,(0,d.assert)(r<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const s=new u.VirtualFile({value:i,path:a,data:{canonicalPath:new URL(a,e).toString()}});return(0,d.assert)(!t.has(a),"Malformed tarball, multiple files with the same path."),t.set(a,s),o()}catch(e){return s.destroy(e)}}))}return i.on("end",()=>o()),i.resume()}),s}(k(this.meta.registry,this.meta.packageName),r),i=t.body,o=new DecompressionStream("gzip"),c=i.pipeThrough(o);(0,m.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new f.ReadableWebToNodeStream(e)}(c),a,t=>{t?s(t):e(r)})})}},n.fetchNpmMetadata=_,n.getNpmCanonicalBasePath=k;const T=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[3111,{"./json.cjs":3112,"./registry.cjs":3113},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./registry.cjs"),n),r(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[3112,{"./registry.cjs":3113,"@metamask/base-controller":1520,"@metamask/snaps-registry":3187,"@metamask/snaps-utils":3146,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(o(e,t))}function i(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("./registry.cjs"),h={database:null,signature:null,lastUpdated:null,databaseUnavailable:!1};var m=new WeakMap,f=new WeakMap,g=new WeakMap,S=new WeakMap,b=new WeakMap,y=new WeakMap,v=new WeakMap,w=new WeakSet;class _ extends c.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:a="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",clientConfig:c,fetchFunction:l=globalThis.fetch.bind(undefined),recentFetchThreshold:u=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:p=!0}){var _,k;super({messenger:e,metadata:{database:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},signature:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},lastUpdated:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},databaseUnavailable:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}},name:"SnapsRegistry",state:{...h,...t}}),r(_=this,k=w),k.add(_),s(this,m,void 0),s(this,f,void 0),s(this,g,void 0),s(this,S,void 0),s(this,b,void 0),s(this,y,void 0),s(this,v,void 0),i(m,this,n),i(f,this,a),i(g,this,c),i(S,this,l),i(b,this,u),i(y,this,p),i(v,this,null),this.messenger.registerActionHandler("SnapsRegistry:get",async(...e)=>o(w,this,O).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(w,this,A).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(w,this,R).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:update",async()=>o(w,this,E).call(this))}}function k(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<a(b,this)}async function E(){a(v,this)?await a(v,this):(null===a(v,this)&&i(v,this,o(w,this,T).call(this)),await a(v,this),i(v,this,null))}async function T(){if(!o(w,this,k).call(this))try{const[e,t]=await Promise.all([o(w,this,M).call(this,a(m,this).registry),o(w,this,M).call(this,a(m,this).signature)]),n=JSON.parse(t);if(n.signature===this.state.signature)return void this.update(e=>{e.lastUpdated=Date.now(),e.databaseUnavailable=!1});await o(w,this,I).call(this,e,n),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1,t.signature=n.signature})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function P(){return null===this.state.database&&await o(w,this,E).call(this),this.state.database}async function j(e,t,n=!1){var s,r;const i=await o(w,this,P).call(this),c=null==i?void 0:i.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(c)return{status:p.SnapsRegistryStatus.Blocked,reason:c.reason};const l=null==i?void 0:i.verifiedSnaps[e],u=null==l||null===(s=l.versions)||void 0===s?void 0:s[t.version],h=null==u||null===(r=u.clientVersions)||void 0===r?void 0:r[a(g,this).type],m=!h||(0,d.satisfiesVersionRange)(a(g,this).version,h);return u&&u.checksum===t.checksum&&m?{status:p.SnapsRegistryStatus.Verified}:a(y,this)&&!n?(await o(w,this,E).call(this),o(w,this,j).call(this,e,t,!0)):{status:this.state.databaseUnavailable?p.SnapsRegistryStatus.Unavailable:p.SnapsRegistryStatus.Unverified}}async function O(e){return Object.entries(e).reduce(async(e,[t,n])=>{const s=await o(w,this,j).call(this,t,n),r=await e;return r[t]=s,r},Promise.resolve({}))}async function R(e,t,n=!1){var s;const r=await o(w,this,P).call(this),i=(null==r||null===(s=r.verifiedSnaps[e])||void 0===s?void 0:s.versions)??null;if(!i&&a(y,this)&&!n)return await o(w,this,E).call(this),o(w,this,R).call(this,e,t,!0);if(!i)return t;const c=Object.entries(i).reduce((e,[t,n])=>{var s;const r=null===(s=n.clientVersions)||void 0===s?void 0:s[a(g,this).type];return r&&!(0,d.satisfiesVersionRange)(a(g,this).version,r)||e.push(t),e},[]),l=(0,u.getTargetVersion)(c,t);return l||!a(y,this)||n?l?((0,d.assertIsSemVerRange)(l),l):t:(await o(w,this,E).call(this),o(w,this,R).call(this,e,t,!0))}function A(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}async function I(e,t){(0,d.assert)(a(f,this),"No public key provided.");const n=await(0,l.verify)({registry:e,signature:t,publicKey:a(f,this)});(0,d.assert)(n,"Invalid registry signature.")}async function M(e){const t=await a(S,this).call(this,e,{cache:"no-cache"});if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=_}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[3113,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(s||(n.SnapsRegistryStatus=s={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[3114,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[3115,{"./snaps/Timer.cjs":3103,"@metamask/snaps-sdk":3265,"@metamask/snaps-utils":3146,"fast-deep-equal":4782},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const r=e("@metamask/snaps-sdk"),a=e("@metamask/snaps-utils"),i=s(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let n;const s=new Promise((s,r)=>{e.start(()=>{t===undefined?s():s(t)}),n=r});return s.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},s}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>(n in t||(e[n]=s),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>{const r=n in t;return(!r||r&&!(0,i.default)(s.caveats??[],t[n].caveats??[]))&&(e[n]=s),e},{})},n.delay=function(e,t){return c(new o.Timer(e),t)},n.delayWithTimer=c,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const s=c("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}},n.getSnapFiles=l,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,r.assert)(n.size<a.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:s}=e.result.source.location.npm,i=s?await t.fetch(s):undefined,o=await l(t,e.result.source.files);(0,a.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,a.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:i,auxiliaryFiles:o,localizationFiles:(0,a.getValidatedLocalizationFiles)(c)};return await(0,a.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,r.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(s,r,a)=>{const i=`${s}-${a}`;n.has(i)&&clearTimeout(n.get(i)),n.set(i,setTimeout(()=>{e(s,r,a),n.delete(i)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([a.HandlerType.OnHomePage,a.HandlerType.OnInstall,a.HandlerType.OnNameLookup,a.HandlerType.OnRpcRequest,a.HandlerType.OnSignature,a.HandlerType.OnTransaction,a.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,s=new Map;return(r,a,i,o)=>{const c=`${r}${a}${i}${o}`,l=Date.now(),u=n.get(c)??0,d=[r,a,i,o];if(l-u>=t)return n.set(c,l),void e(...d);const p=s.get(c);null!=p&&p.timer&&clearTimeout(p.timer),n.set(c,l),s.set(c,{args:d,timer:setTimeout(()=>{e(...d),s.delete(c)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[3116,{"../snaps/index.cjs":3105,"@metamask/rpc-errors":3026,"@metamask/snaps-utils":3146,"@metamask/utils":3554,nanoid:5438},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("nanoid"),h=e("../snaps/index.cjs"),m="WebSocketService";var f=new WeakMap,g=new WeakMap,S=new WeakSet;function b(e,t){const n=i(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function y(e,t,n){return c(S,this,T).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function v(e,t){i(f,this).call("SnapController:handleRequest",{origin:h.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function w(e,t,n=[]){(0,d.assert)(!c(S,this,y).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const s=new URL(t),{origin:r}=s,a=(0,p.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:h,reject:m}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{h(),c(S,this,v).call(this,e,{type:"open",id:a,origin:r})}),o.addEventListener("close",t=>{i(g,this).delete(a),c(S,this,v).call(this,e,{type:"close",id:a,origin:r,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const f=()=>{m(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",f),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(S,this,v).call(this,e,{type:"message",id:a,origin:r,data:n})}),i(g,this).set(a,{id:a,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",f),a}function _(e,t){const{socket:n}=c(S,this,b).call(this,e,t);n.close()}function k(e){for(const t of c(S,this,T).call(this,e))c(S,this,_).call(this,e,t.id)}async function E(e,t,n){const{socket:s,openPromise:r}=c(S,this,b).call(this,e,t);await r;const a=Array.isArray(n)?new Uint8Array(n):n;s.send(a)}function T(e){return[...i(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;r(t=this,n=S),n.add(t),a(this,"name",m),a(this,"state",null),s(this,f,void 0),s(this,g,void 0),o(f,this,e),o(g,this,new Map),i(f,this).registerActionHandler(`${m}:open`,async(...e)=>c(S,this,w).call(this,...e)),i(f,this).registerActionHandler(`${m}:close`,(...e)=>c(S,this,_).call(this,...e)),i(f,this).registerActionHandler(`${m}:sendMessage`,async(...e)=>c(S,this,E).call(this,...e)),i(f,this).registerActionHandler(`${m}:getAll`,(...e)=>c(S,this,T).call(this,...e)),i(f,this).subscribe("SnapController:snapUpdated",e=>{c(S,this,k).call(this,e.id)}),i(f,this).subscribe("SnapController:snapUninstalled",e=>{c(S,this,k).call(this,e.id)}),i(f,this).subscribe("SnapController:snapInstalled",e=>{c(S,this,k).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[3117,{"./WebSocketService.cjs":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[3118,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.snapOwnsAccount=n.createChainIdList=n.createAccountList=void 0;const s=e("@metamask/utils");n.createAccountList=function(e,t){return t.map(t=>`${t}:${e}`)},n.createChainIdList=function(e,t){return t&&0!==t.length?e.reduce((e,n)=>{if("eip155:0"===n){const n=t.filter(e=>{const{namespace:t}=(0,s.parseCaipChainId)(e);return t===s.KnownCaipNamespace.Eip155});e.push(...n)}else t.includes(n)&&e.push(n);return e},[]):e},n.snapOwnsAccount=function(e,t){var n;return(null===(n=t.metadata.snap)||void 0===n?void 0:n.id)===e}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/account.cjs"}],[3119,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isEqual=void 0,n.isEqual=function(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/array.cjs"}],[312,{"../../../../shared/constants/app":6175,"../../../../shared/constants/security-provider":6202,"../../../../shared/constants/transaction":6213,"../../../../shared/lib/trace":6299,"./ppom-util":313,"@metamask/controller-utils":1639},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,u,d,p,h){return async(m,f,g)=>{try{const{securityAlertsEnabled:f}=t.state,{chainId:g}=n.getNetworkConfigurationByNetworkClientId(m.networkClientId)??{};if(!g)throw Error("ChainID not found for networkClientId");if(!f||!l.includes(m.method))return;const S=m.params[0];if("string"==typeof S){const{isSIWEMessage:e}=(0,s.detectSIWE)({data:S});if(e)return}else if(m.method===r.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=S??{},t=d.listAccounts();if(t.some(({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase())))return}const b=(0,c.generateSecurityAlertId)();(0,i.trace)({name:i.TraceName.PPOMValidation,parentContext:m.traceContext},()=>(0,c.validateRequestWithPPOM)({ppomController:e,request:m,securityAlertId:b,chainId:g,updateSecurityAlertResponse:p,getSecurityAlertsConfig:h}));const y={...o.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:b};a.SIGNING_METHODS.includes(m.method)&&u.addSignatureSecurityAlertResponse(y),m.securityAlertResponse=y}catch(e){m.securityAlertResponse=(0,c.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{g()}}};var s=e("@metamask/controller-utils"),r=e("../../../../shared/constants/app"),a=e("../../../../shared/constants/transaction"),i=e("../../../../shared/lib/trace"),o=e("../../../../shared/constants/security-provider"),c=e("./ppom-util");const l=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...a.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[3120,{"./base64.cjs":3121,"./constants.cjs":3125,"@metamask/snaps-sdk":3265,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateAuxiliaryFiles=n.encodeAuxiliaryFile=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/utils"),a=e("./base64.cjs"),i=e("./constants.cjs");n.encodeAuxiliaryFile=async function(e,t){if(t===s.AuxiliaryFileEncoding.Base64)return e;const n=await(0,a.decodeBase64)(e);return t===s.AuxiliaryFileEncoding.Utf8?(0,r.bytesToString)(n):(0,r.bytesToHex)(n)},n.validateAuxiliaryFiles=function(e){for(const t of e)(0,r.assert)(t.size<i.MAX_FILE_SIZE,"Static files required by the Snap must be smaller than 64 MB.")}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/auxiliary-files.cjs"}],[3121,{"./bytes.cjs":3122,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeBase64=n.encodeBase64=void 0;const s=e("@metamask/utils"),r=e("./bytes.cjs");n.encodeBase64=async function(e){const t=(0,r.getBytes)(e),n="undefined"!=typeof navigator&&"ReactNative"===navigator.product;return"FileReader"in globalThis&&!n?await new Promise((e,n)=>{const s=Object.assign(new FileReader,{onload:()=>e(s.result.replace("data:application/octet-stream;base64,","")),onerror:()=>n(s.error)});s.readAsDataURL(new File([t],"",{type:"application/octet-stream"}))}):(0,s.bytesToBase64)(t)},n.decodeBase64=async function(e){const t=await fetch(`data:application/octet-stream;base64,${e}`);return new Uint8Array(await t.arrayBuffer())}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/base64.cjs"}],[3122,{"./virtual-file/VirtualFile.cjs":3165,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getBytes=void 0;const s=e("@metamask/utils"),r=e("./virtual-file/VirtualFile.cjs");n.getBytes=function(e){const t=e instanceof r.VirtualFile?e.value:e;return"string"==typeof t?(0,s.stringToBytes)(t):t}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/bytes.cjs"}],[3123,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapCaveatType=void 0,function(e){e.PermittedDerivationPaths="permittedDerivationPaths",e.PermittedCoinTypes="permittedCoinTypes",e.SnapCronjob="snapCronjob",e.TransactionOrigin="transactionOrigin",e.SignatureOrigin="signatureOrigin",e.RpcOrigin="rpcOrigin",e.KeyringOrigin="keyringOrigin",e.SnapIds="snapIds",e.ChainIds="chainIds",e.LookupMatchers="lookupMatchers",e.MaxRequestTime="maxRequestTime",e.ProtocolSnapScopes="protocolSnapScopes"}(s||(n.SnapCaveatType=s={}))}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/caveats.cjs"}],[3124,{"./bytes.cjs":3122,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.checksumFiles=n.checksum=void 0;const s=e("@metamask/utils"),r=e("./bytes.cjs");async function a(e){return await(0,s.sha256)((0,r.getBytes)(e))}n.checksum=a,n.checksumFiles=async function(e){const t=await Promise.all([...e].sort((e,t)=>((0,s.assert)(e.path!==t.path,"Tried to sort files with non-unique paths."),e.path<t.path?-1:1)).map(async e=>a(e)));return a((0,s.concatBytes)(t))}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/checksum.cjs"}],[3125,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MAX_FILE_SIZE=void 0,n.MAX_FILE_SIZE=64e6}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/constants.cjs"}],[3126,{"./time.cjs":3159,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554,"cron-parser":4579},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isCronjobSpecificationArray=n.CronjobSpecificationArrayStruct=n.isCronjobSpecification=n.CronjobSpecificationStruct=n.CronExpressionStruct=n.CronjobRpcRequestStruct=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),a=e("@metamask/utils"),i=e("cron-parser"),o=e("./time.cjs");n.CronjobRpcRequestStruct=(0,r.object)({jsonrpc:(0,r.optional)(a.JsonRpcVersionStruct),id:(0,r.optional)(a.JsonRpcIdStruct),method:(0,r.string)(),params:(0,r.optional)(a.JsonRpcParamsStruct)}),n.CronExpressionStruct=(0,r.refine)((0,r.string)(),"cronjob expression",e=>{try{return(0,i.parseExpression)(e),!0}catch{return`Expected a cronjob expression, but received: "${e}"`}});const c=(0,r.object)({expression:n.CronExpressionStruct,request:n.CronjobRpcRequestStruct}),l=(0,r.object)({duration:o.ISO8601DurationStruct,request:n.CronjobRpcRequestStruct});n.CronjobSpecificationStruct=(0,s.selectiveUnion)(e=>(0,a.isObject)(e)&&(0,a.hasProperty)(e,"duration")?l:c),n.isCronjobSpecification=function(e){try{return(0,r.create)(e,n.CronjobSpecificationStruct),!0}catch{return!1}},n.CronjobSpecificationArrayStruct=(0,r.array)(n.CronjobSpecificationStruct),n.isCronjobSpecificationArray=function(e){try{return(0,r.create)(e,n.CronjobSpecificationArrayStruct),!0}catch{return!1}}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/cronjob.cjs"}],[3127,{"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.currency=void 0;const s=e("@metamask/superstruct");n.currency=function(e){const t=e.toLowerCase();return(0,s.coerce)((0,s.literal)(t),(0,s.literal)(e.toUpperCase()),e=>(0,s.create)(e.toLowerCase(),(0,s.literal)(t)))}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/currency.cjs"}],[3128,{rfdc:5710},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.deepClone=void 0;const r=s(e("rfdc"));n.deepClone=(0,r.default)({proto:!1,circles:!1})}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/deep-clone.cjs"}],[3129,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_ENDOWMENTS=void 0,n.DEFAULT_ENDOWMENTS=Object.freeze(["atob","btoa","BigInt","console","crypto","Date","Math","setTimeout","clearTimeout","SubtleCrypto","TextDecoder","TextEncoder","URL","URLSearchParams","setInterval","clearInterval","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","isSecureContext","Intl","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array","DataView","ArrayBuffer","AbortController","AbortSignal"])}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/default-endowments.cjs"}],[313,{"../../../../shared/constants/app":6175,"../../../../shared/constants/security-provider":6202,"../../../../shared/constants/transaction":6213,"../../../../shared/lib/snaps/snaps":6294,"../../../../shared/modules/transaction.utils":6348,"../../../../shared/modules/typed-signature":6349,"./security-alerts-api":315,"@metamask/snaps-utils":3382,"@metamask/transaction-controller":3473,"@metamask/utils":3554,lodash:5239,uuid:6134},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,a.v4)()},n.handlePPOMError=b,n.normalizeSignatureRequest=y,n.updateSecurityAlertResponse=async function({appStateController:e,messenger:t,method:n,securityAlertId:s,securityAlertResponse:r,signatureController:a,transactionController:i}){if(u.SIGNING_METHODS.includes(n)){const n=await async function(e,t,n){const s=e=>Object.values(e.signatureRequests).find(e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t});return new Promise(r=>{const a=s(e.state);if(a)return void r(a);const i=e=>{const t=s(e);t&&(f("Found signature request",t),n.unsubscribe("SignatureController:stateChange",i),r(t))};f("Waiting for signature request",t),n.subscribe("SignatureController:stateChange",i)})}(a,s,t);return e.addSignatureSecurityAlertResponse({...r,securityAlertId:s}),n}const o=await async function(e,t,n){const s=e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t};return new Promise(r=>{const a=e.state.transactions.find(s);if(a)return void r(a);const i=e=>{s(e)&&(f("Found transaction metadata",e),n.unsubscribe("TransactionController:unapprovedTransactionAdded",i),r(e))};f("Waiting for transaction metadata",t),n.subscribe("TransactionController:unapprovedTransactionAdded",i)})}(i,s,t);return i.updateSecurityAlertResponse(o.id,{...r,securityAlertId:s}),o},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:r,updateSecurityAlertResponse:a,getSecurityAlertsConfig:o}){try{const l=function(e,t){let n=(0,i.cloneDeep)(e);n=y(n,t),n=function(e,t){if(e.method!==h.MESSAGE_TYPE.ETH_SEND_TRANSACTION)return e;if(!Array.isArray(e.params)||!e.params[0])return e;const n=e.params[0];n.gas=t.txParams.gas,n.gasPrice=t.txParams.maxFeePerGas??t.txParams.gasPrice,delete n.gasLimit,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.type;const r=(0,s.normalizeTransactionParams)(n);return f("Normalized transaction params",r),{...e,params:[r]}}(n,t);const{delegationMock:r,id:a,jsonrpc:o,method:c,origin:l,params:u}=n;return{delegationMock:r,id:a,jsonrpc:o,method:c,origin:l,params:u}}(t,await a(t.method,n,c.LOADING_SECURITY_ALERT_RESPONSE));f("Normalized request",l);const u=(0,m.isSecurityAlertsAPIEnabled)()?await async function(e,t,n,s){try{return{...await(0,m.validateWithSecurityAlertsAPI)(t,n,s),source:c.SecurityAlertSource.API}}catch(s){return b(s,"Error validating request with security alerts API"),await v(e,n,t)}}(e,r,l,o):await v(e,l,r);await a(t.method,n,u)}catch(e){f("Error",e),await a(t.method,n,b(e,"Error validating JSON RPC using PPOM: "))}};var s=e("@metamask/transaction-controller"),r=e("@metamask/utils"),a=e("uuid"),i=e("lodash"),o=e("@metamask/snaps-utils"),c=e("../../../../shared/constants/security-provider"),l=e("../../../../shared/lib/snaps/snaps"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/modules/typed-signature"),p=e("../../../../shared/modules/transaction.utils"),h=e("../../../../shared/constants/app"),m=e("./security-alerts-api");const f=(0,r.createProjectLogger)("ppom-util"),{sentry:g}=global,S={result_type:c.BlockaidResultType.Errored,reason:c.BlockaidReason.errored};function b(e,t,n=c.SecurityAlertSource.API){const s=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),r=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return n===c.SecurityAlertSource.Local&&(null==g||g.captureException(e)),console.error(t,s),{...S,description:r,source:n}}function y(e,t){var n;if(e.method!==h.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3&&e.method!==h.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4)return e;if(!Array.isArray(e.params)||!e.params[1])return e;const s=(0,p.parseTypedDataMessage)(e.params[1]),r=(0,d.sanitizeMessageRecursively)(s.message,s.types,s.primaryType);let a=e.origin;if(t&&"decodedPermission"in t&&null!==(n=t.decodedPermission)&&void 0!==n&&n.origin){const n=(0,o.isSnapId)(e.origin),s=n&&(0,l.isSnapPreinstalled)(e.origin);n&&s&&(a=t.decodedPermission.origin)}return{...e,origin:a,params:[e.params[0],JSON.stringify({...s,message:r})]}}async function v(e,t,n){try{return{...await e.usePPOM(e=>e.validateJsonRpc(t),n),source:c.SecurityAlertSource.Local}}catch(e){return b(e,"Error validating request with PPOM controller",c.SecurityAlertSource.Local)}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[3130,{"./array.cjs":3119,"@metamask/slip44":3066},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getSlip44ProtocolName=n.getSnapDerivationPathName=n.SNAPS_DERIVATION_PATHS=void 0;const r=s(e("@metamask/slip44")),a=e("./array.cjs");function i(e){var t;return"1"===String(e)?"Test Networks":(null===(t=r.default[e])||void 0===t?void 0:t.name)??null}n.SNAPS_DERIVATION_PATHS=[{path:["m","44'","0'"],curve:"ed25519",name:"Test BIP-32 Path (ed25519)"},{path:["m","44'","1'"],curve:"secp256k1",name:"Testnet"},{path:["m","44'","0'"],curve:"secp256k1",name:"Bitcoin Legacy"},{path:["m","49'","0'"],curve:"secp256k1",name:"Bitcoin Nested SegWit"},{path:["m","49'","1'"],curve:"secp256k1",name:"Bitcoin Testnet Nested SegWit"},{path:["m","84'","0'"],curve:"secp256k1",name:"Bitcoin Native SegWit"},{path:["m","84'","1'"],curve:"secp256k1",name:"Bitcoin Testnet Native SegWit"},{path:["m","86'","0'"],curve:"secp256k1",name:"Bitcoin Taproot"},{path:["m","86'","1'"],curve:"secp256k1",name:"Bitcoin Testnet Taproot"},{path:["m","44'","501'"],curve:"ed25519",name:"Solana"},{path:["m","44'","501'","0'","0'"],curve:"ed25519",name:"Solana"},{path:["m","44'","2'"],curve:"secp256k1",name:"Litecoin"},{path:["m","44'","3'"],curve:"secp256k1",name:"Dogecoin"},{path:["m","44'","60'"],curve:"secp256k1",name:"Ethereum"},{path:["m","44'","118'"],curve:"secp256k1",name:"Atom"},{path:["m","44'","145'"],curve:"secp256k1",name:"Bitcoin Cash"},{path:["m","44'","637'"],curve:"ed25519",name:"Aptos"},{path:["m","44'","714'"],curve:"secp256k1",name:"Binance (BNB)"},{path:["m","44'","784'"],curve:"ed25519",name:"Sui"},{path:["m","44'","931'"],curve:"secp256k1",name:"THORChain (RUNE)"},{path:["m","44'","330'"],curve:"secp256k1",name:"Terra (LUNA)"},{path:["m","44'","459'"],curve:"secp256k1",name:"Kava"},{path:["m","44'","529'"],curve:"secp256k1",name:"Secret Network"},{path:["m","44'","397'","0'"],curve:"ed25519",name:"NEAR Protocol"},{path:["m","44'","1'","0'"],curve:"ed25519",name:"Testnet"},{path:["m","44'","472'"],curve:"ed25519",name:"Arweave"},{path:["m","44'","12586'"],curve:"secp256k1",name:"Mina"},{path:["m","44'","242'"],curve:"ed25519",name:"Nimiq"},{path:["m","44'","1729'","0'","0'"],curve:"ed25519",name:"Tezos"},{path:["m","1789'","0'"],curve:"ed25519",name:"Vega"},{path:["m","1852'","1815'"],curve:"ed25519Bip32",name:"Cardano"},{path:["m","44'","508'","0'","0'","0'"],curve:"ed25519",name:"MultiversX"},{path:["m","44'","709'"],curve:"secp256k1",name:"Avail"},{path:["m","44'","626'"],curve:"ed25519",name:"Kadena"},{path:["m","44'","632'"],curve:"ed25519",name:"Massa"},{path:["m","44'","4218'"],curve:"ed25519",name:"IOTA"}],n.getSnapDerivationPathName=function(e,t){const s=n.SNAPS_DERIVATION_PATHS.find(n=>n.curve===t&&(0,a.isEqual)(n.path,e));if(s)return s.name;if("secp256k1"===t&&"m"===e[0]&&"44'"===e[1]&&e[2].endsWith("'")){return i(e[2].slice(0,-1))??null}return null},n.getSlip44ProtocolName=i}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/derivation-paths.cjs"}],[3131,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.STATE_ENCRYPTION_MAGIC_VALUE=n.SIP_6_MAGIC_VALUE=void 0,n.SIP_6_MAGIC_VALUE="1399742832'",n.STATE_ENCRYPTION_MAGIC_VALUE="572232532'"}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/entropy.cjs"}],[3132,{"@metamask/rpc-errors":3026,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(i(e,t))}function a(e,t,n){return e.set(i(e,t),n),n}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.TrackableErrorStruct=n.unwrapError=n.isWrappedSnapError=n.isSerializedSnapError=n.isSnapError=n.WrappedSnapError=n.SNAP_ERROR_WRAPPER_MESSAGE=n.SNAP_ERROR_WRAPPER_CODE=void 0;const o=e("@metamask/rpc-errors"),c=e("@metamask/snaps-sdk"),l=e("@metamask/superstruct"),u=e("@metamask/utils");n.SNAP_ERROR_WRAPPER_CODE=-31001,n.SNAP_ERROR_WRAPPER_MESSAGE="Wrapped Snap Error";var d=new WeakMap,p=new WeakMap,h=new WeakMap;class m extends Error{constructor(e){const t=(0,c.getErrorMessage)(e);super(t),s(this,d,void 0),s(this,p,void 0),s(this,h,void 0),a(d,this,e),a(p,this,t),a(h,this,(0,c.getErrorStack)(e)??undefined)}get name(){return"WrappedSnapError"}get message(){return r(p,this)}get stack(){return r(h,this)}toJSON(){const e=f(r(d,this))?r(d,this).serialize():(0,o.serializeCause)(r(d,this));return{code:n.SNAP_ERROR_WRAPPER_CODE,message:n.SNAP_ERROR_WRAPPER_MESSAGE,data:{cause:e}}}serialize(){return this.toJSON()}}function f(e){if((0,u.isObject)(e)&&"serialize"in e&&"function"==typeof e.serialize){const t=e.serialize();return(0,u.isJsonRpcError)(t)&&g(t)}return!1}function g(e){return e.code===c.SNAP_ERROR_CODE&&e.message===c.SNAP_ERROR_MESSAGE}function S(e){return(0,u.isJsonRpcError)(e)&&e.code===n.SNAP_ERROR_WRAPPER_CODE&&e.message===n.SNAP_ERROR_WRAPPER_MESSAGE}function b(e,t,n,s){const r=new o.JsonRpcError(e,t,s);return r.stack=n??undefined,r}n.WrappedSnapError=m,n.isSnapError=f,n.isSerializedSnapError=g,n.isWrappedSnapError=S,n.unwrapError=function(e){if(S(e)){if((0,u.isJsonRpcError)(e.data.cause)){if(g(e.data.cause)){const{code:t,message:n,stack:s,data:r}=e.data.cause.data.cause;return[b(t,n,s,r),!0]}if((0,u.isObject)(e.data.cause.data)&&(0,u.isObject)(e.data.cause.data.cause)&&e.data.cause.message===e.data.cause.data.cause.message){const t=e.data.cause.data.cause,{code:n,message:s}=e.data.cause;return[b(n,s,(0,c.getErrorStack)(t)),!1]}const{code:t,message:n,stack:s,data:r}=e.data.cause;return[b(t,n,s,r),!1]}return[b(o.errorCodes.rpc.internal,(0,c.getErrorMessage)(e.data.cause),(0,c.getErrorStack)(e.data.cause)),!1]}if((0,u.isJsonRpcError)(e)){const{code:t,message:n,stack:s,data:r}=e;return[b(t,n,s,r),!1]}return[b(o.errorCodes.rpc.internal,(0,c.getErrorMessage)(e),(0,c.getErrorStack)(e)),!1]},n.TrackableErrorStruct=(0,l.object)({name:(0,l.string)(),message:(0,l.string)(),stack:(0,l.nullable)((0,l.string)()),cause:(0,l.nullable)((0,l.lazy)(()=>n.TrackableErrorStruct))})}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/errors.cjs"}],[3133,{"../time.cjs":3159,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnAssetHistoricalPriceResponseStruct=n.AssetHistoricalPriceStruct=n.HistoricalPriceStruct=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),a=e("../time.cjs");n.HistoricalPriceStruct=(0,s.nonEmptyRecord)((0,r.union)([(0,r.literal)("all"),a.ISO8601DurationStruct]),(0,r.array)((0,r.tuple)([(0,r.number)(),(0,r.string)()]))),n.AssetHistoricalPriceStruct=(0,r.nullable)((0,r.object)({intervals:n.HistoricalPriceStruct,updateTime:(0,r.number)(),expirationTime:(0,r.optional)((0,r.number)())})),n.OnAssetHistoricalPriceResponseStruct=(0,r.object)({historicalPrice:n.AssetHistoricalPriceStruct})}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/asset-historical-price.cjs"}],[3134,{"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnAssetsConversionResponseStruct=n.AssetConversionStruct=void 0;const s=e("@metamask/superstruct"),r=e("@metamask/utils");n.AssetConversionStruct=(0,s.object)({rate:(0,s.string)(),conversionTime:(0,s.number)(),expirationTime:(0,s.optional)((0,s.number)())}),n.OnAssetsConversionResponseStruct=(0,s.object)({conversionRates:(0,s.record)(r.CaipAssetTypeStruct,(0,s.record)(r.CaipAssetTypeStruct,(0,s.nullable)(n.AssetConversionStruct)))})}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/assets-conversion.cjs"}],[3135,{"../time.cjs":3159,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnAssetsMarketDataResponseStruct=n.AssetMarketDataStruct=n.NonFungibleAssetMarketDataStruct=n.AssetValueStruct=n.FungibleAssetMarketDataStruct=n.PricePercentChangeStruct=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),a=e("@metamask/utils"),i=e("../time.cjs");n.PricePercentChangeStruct=(0,s.nonEmptyRecord)((0,r.union)([(0,r.literal)("all"),i.ISO8601DurationStruct]),(0,r.number)()),n.FungibleAssetMarketDataStruct=(0,r.object)({fungible:(0,r.literal)(!0),marketCap:(0,r.optional)((0,r.string)()),totalVolume:(0,r.optional)((0,r.string)()),circulatingSupply:(0,r.optional)((0,r.string)()),allTimeHigh:(0,r.optional)((0,r.string)()),allTimeLow:(0,r.optional)((0,r.string)()),pricePercentChange:(0,r.optional)(n.PricePercentChangeStruct)}),n.AssetValueStruct=(0,r.object)({asset:a.CaipAssetTypeOrIdStruct,amount:(0,r.string)()}),n.NonFungibleAssetMarketDataStruct=(0,r.object)({fungible:(0,r.literal)(!1),lastSale:(0,r.optional)(n.AssetValueStruct),topBid:(0,r.optional)(n.AssetValueStruct),floorPrice:(0,r.optional)(n.AssetValueStruct),rarity:(0,r.optional)((0,r.object)({ranking:(0,r.optional)((0,r.object)({source:(0,r.string)(),rank:(0,r.number)()})),metadata:(0,r.optional)((0,r.record)((0,r.string)(),(0,r.number)()))}))}),n.AssetMarketDataStruct=(0,s.selectiveUnion)(e=>(0,a.isObject)(e)&&e.fungible?n.FungibleAssetMarketDataStruct:n.NonFungibleAssetMarketDataStruct),n.OnAssetsMarketDataResponseStruct=(0,r.object)({marketData:(0,r.record)(a.CaipAssetTypeOrIdStruct,(0,r.record)(a.CaipAssetTypeStruct,(0,r.nullable)(n.AssetMarketDataStruct)))})}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/assets-market-data.cjs"}],[3136,{"./types.cjs":3143},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SNAP_EXPORT_NAMES=n.SNAP_EXPORTS=void 0;const s=e("./types.cjs");n.SNAP_EXPORTS={[s.HandlerType.OnRpcRequest]:{type:s.HandlerType.OnRpcRequest,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnTransaction]:{type:s.HandlerType.OnTransaction,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnCronjob]:{type:s.HandlerType.OnCronjob,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnNameLookup]:{type:s.HandlerType.OnNameLookup,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnInstall]:{type:s.HandlerType.OnInstall,required:!1,validator:e=>"function"==typeof e},[s.HandlerType.OnUpdate]:{type:s.HandlerType.OnUpdate,required:!1,validator:e=>"function"==typeof e},[s.HandlerType.OnStart]:{type:s.HandlerType.OnStart,required:!1,validator:e=>"function"==typeof e},[s.HandlerType.OnActive]:{type:s.HandlerType.OnActive,required:!1,validator:e=>"function"==typeof e},[s.HandlerType.OnInactive]:{type:s.HandlerType.OnInactive,required:!1,validator:e=>"function"==typeof e},[s.HandlerType.OnKeyringRequest]:{type:s.HandlerType.OnKeyringRequest,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnHomePage]:{type:s.HandlerType.OnHomePage,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnSettingsPage]:{type:s.HandlerType.OnSettingsPage,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnSignature]:{type:s.HandlerType.OnSignature,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnUserInput]:{type:s.HandlerType.OnUserInput,required:!1,validator:e=>"function"==typeof e},[s.HandlerType.OnAssetHistoricalPrice]:{type:s.HandlerType.OnAssetHistoricalPrice,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnAssetsLookup]:{type:s.HandlerType.OnAssetsLookup,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnAssetsConversion]:{type:s.HandlerType.OnAssetsConversion,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnAssetsMarketData]:{type:s.HandlerType.OnAssetsMarketData,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnProtocolRequest]:{type:s.HandlerType.OnProtocolRequest,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnClientRequest]:{type:s.HandlerType.OnClientRequest,required:!0,validator:e=>"function"==typeof e},[s.HandlerType.OnWebSocketEvent]:{type:s.HandlerType.OnWebSocketEvent,required:!0,validator:e=>"function"==typeof e}},n.SNAP_EXPORT_NAMES=Object.values(s.HandlerType)}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/exports.cjs"}],[3137,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnHomePageResponseStruct=n.OnHomePageResponseWithIdStruct=n.OnHomePageResponseWithContentStruct=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct");n.OnHomePageResponseWithContentStruct=(0,r.object)({content:s.ComponentOrElementStruct}),n.OnHomePageResponseWithIdStruct=(0,r.object)({id:(0,r.string)()}),n.OnHomePageResponseStruct=(0,r.union)([n.OnHomePageResponseWithContentStruct,n.OnHomePageResponseWithIdStruct])}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/home-page.cjs"}],[3138,{"./asset-historical-price.cjs":3133,"./assets-conversion.cjs":3134,"./assets-market-data.cjs":3135,"./exports.cjs":3136,"./home-page.cjs":3137,"./name-lookup.cjs":3139,"./settings-page.cjs":3140,"./signature.cjs":3141,"./transaction.cjs":3142,"./types.cjs":3143},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./asset-historical-price.cjs"),n),r(e("./assets-conversion.cjs"),n),r(e("./assets-market-data.cjs"),n),r(e("./exports.cjs"),n),r(e("./home-page.cjs"),n),r(e("./name-lookup.cjs"),n),r(e("./settings-page.cjs"),n),r(e("./signature.cjs"),n),r(e("./transaction.cjs"),n),r(e("./types.cjs"),n)}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/index.cjs"}],[3139,{"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnNameLookupResponseStruct=n.DomainResolutionResponseStruct=n.AddressResolutionResponseStruct=n.DomainResolutionStruct=n.AddressResolutionStruct=void 0;const s=e("@metamask/superstruct");n.AddressResolutionStruct=(0,s.object)({protocol:(0,s.string)(),resolvedDomain:(0,s.string)()}),n.DomainResolutionStruct=(0,s.object)({protocol:(0,s.string)(),resolvedAddress:(0,s.string)(),domainName:(0,s.string)()}),n.AddressResolutionResponseStruct=(0,s.object)({resolvedDomains:(0,s.size)((0,s.array)(n.AddressResolutionStruct),1,Infinity)}),n.DomainResolutionResponseStruct=(0,s.object)({resolvedAddresses:(0,s.size)((0,s.array)(n.DomainResolutionStruct),1,Infinity)}),n.OnNameLookupResponseStruct=(0,s.nullable)((0,s.union)([n.AddressResolutionResponseStruct,n.DomainResolutionResponseStruct]))}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/name-lookup.cjs"}],[314,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let s;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(s!==undefined)return s;const t=P();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return j(n,e)},n.main=function(){s.main()};const r="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&r.decode();let a=null;function i(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(s.memory.buffer)),a}function o(e,t){return e>>>=0,r.decode(i().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let l=c.length;function u(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}function d(e){return c[e]}function p(e){const t=d(e);return function(e){e<132||(c[e]=l,l=e)}(e),t}let h=0;const m="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},f="function"==typeof m.encodeInto?function(e,t){return m.encodeInto(e,t)}:function(e,t){const n=m.encode(e);return t.set(n),{read:e.length,written:n.length}};function g(e,t,n){if(n===undefined){const n=m.encode(e),s=t(n.length,1)>>>0;return i().subarray(s,s+n.length).set(n),h=n.length,s}let s=e.length,r=t(s,1)>>>0;const a=i();let o=0;for(;o<s;o++){const t=e.charCodeAt(o);if(t>127)break;a[r+o]=t}if(o!==s){0!==o&&(e=e.slice(o)),r=n(r,s,s=o+3*e.length,1)>>>0;const t=i().subarray(r+o,r+s);o+=f(e,t).written}return h=o,r}let S=null;function b(){return null!==S&&0!==S.byteLength||(S=new Int32Array(s.memory.buffer)),S}function y(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=y(e[0]));for(let s=1;s<t;s++)n+=", "+y(e[s]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let s;if(!(n.length>1))return toString.call(e);if(s=n[1],"Object"==s)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:s}function v(e,t,n){s.wasm_bindgen__convert__closures__invoke1_mut(e,t,u(n))}function w(e,t){s._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let _=null;function k(e,t){const n=t(4*e.length,4)>>>0,r=(null!==_&&0!==_.byteLength||(_=new Uint32Array(s.memory.buffer)),_);for(let t=0;t<e.length;t++)r[n/4+t]=u(e[t]);return h=e.length,n}function E(e,t){try{return e.apply(this,t)}catch(e){s.__wbindgen_exn_store(u(e))}}class T{static __wrap(e){e>>>=0;const t=Object.create(T.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();s.__wbg_ppom_free(e)}static new(e,t){const n=k(t,s.__wbindgen_malloc),r=h;return p(s.ppom_new(u(e),n,r))}validateJsonRpc(e){return p(s.ppom_validateJsonRpc(this.__wbg_ptr,u(e)))}static version(){return p(s.ppom_version())}}function P(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return u(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return E(function(e,t,n){return u(d(e).call(d(t),d(n)))},arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return E(function(e,t,n,s){return u(d(e).call(d(t),d(n),d(s)))},arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return u(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return u(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const r=new Promise((e,t)=>{const r=n.a;n.a=0;try{return function(e,t,n,r){s.wasm_bindgen__convert__closures__invoke2_mut(e,t,u(n),u(r))}(r,n.b,e,t)}finally{n.a=r}});return u(r)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return u(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return E(function(e,t){return u(JSON.parse(o(e,t)))},arguments)},e.wbg.__wbg_ppom_new=function(e){return u(T.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return u(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return E(function(e){return u(JSON.stringify(d(e)))},arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return u(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return u(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=p(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const s=function(e,t,n,s){const r={a:e,b:t,cnt:1},a=(...e)=>{r.cnt++;const t=r.a;r.a=0;try{return s(t,r.b,...e)}finally{0===--r.cnt?n(t,r.b):r.a=t}};return a.original=r,a}(e,t,w,v);return u(s)},e.wbg.__wbindgen_debug_string=function(e,t){const n=g(y(d(t)),s.__wbindgen_malloc,s.__wbindgen_realloc),r=h;b()[e/4+1]=r,b()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return u(new Error(o(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return u(s.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){p(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),r="string"==typeof n?n:undefined;var a,i=(a=r)===undefined||null===a?0:g(r,s.__wbindgen_malloc,s.__wbindgen_realloc),o=h;b()[e/4+1]=o,b()[e/4+0]=i},e.wbg.__wbindgen_string_new=function(e,t){return u(o(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e}function j(e,t){return s=e.exports,O.__wbindgen_wasm_module=t,S=null,_=null,a=null,s.__wbindgen_start(),s}async function O(e){if(s!==undefined)return s;const t=P();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return j(n,r)}n.PPOM=T;n.default=O}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[3140,{"./home-page.cjs":3137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnSettingsPageResponseStruct=void 0;const s=e("./home-page.cjs");n.OnSettingsPageResponseStruct=s.OnHomePageResponseStruct}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/settings-page.cjs"}],[3141,{"./transaction.cjs":3142},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnSignatureResponseStruct=void 0;const s=e("./transaction.cjs");n.OnSignatureResponseStruct=s.OnTransactionResponseStruct}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/signature.cjs"}],[3142,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnTransactionResponseStruct=n.OnTransactionResponseWithContentStruct=n.OnTransactionResponseWithIdStruct=n.OnTransactionSeverityResponseStruct=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct");n.OnTransactionSeverityResponseStruct=(0,r.object)({severity:(0,r.optional)((0,r.literal)(s.SeverityLevel.Critical))}),n.OnTransactionResponseWithIdStruct=(0,r.assign)(n.OnTransactionSeverityResponseStruct,(0,r.object)({id:(0,r.string)()})),n.OnTransactionResponseWithContentStruct=(0,r.assign)(n.OnTransactionSeverityResponseStruct,(0,r.object)({content:s.ComponentOrElementStruct})),n.OnTransactionResponseStruct=(0,r.nullable)((0,r.union)([n.OnTransactionResponseWithContentStruct,n.OnTransactionResponseWithIdStruct]))}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/transaction.cjs"}],[3143,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.HandlerType=void 0,function(e){e.OnRpcRequest="onRpcRequest",e.OnSignature="onSignature",e.OnTransaction="onTransaction",e.OnCronjob="onCronjob",e.OnInstall="onInstall",e.OnUpdate="onUpdate",e.OnStart="onStart",e.OnActive="onActive",e.OnInactive="onInactive",e.OnNameLookup="onNameLookup",e.OnKeyringRequest="onKeyringRequest",e.OnHomePage="onHomePage",e.OnSettingsPage="onSettingsPage",e.OnUserInput="onUserInput",e.OnAssetsLookup="onAssetsLookup",e.OnAssetsConversion="onAssetsConversion",e.OnAssetHistoricalPrice="onAssetHistoricalPrice",e.OnAssetsMarketData="onAssetsMarketData",e.OnProtocolRequest="onProtocolRequest",e.OnClientRequest="onClientRequest",e.OnWebSocketEvent="onWebSocketEvent"}(s||(n.HandlerType=s={}))}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/handlers/types.cjs"}],[3144,{"./svg.cjs":3158,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSvgDimensions=n.assertIsSnapIcon=n.SVG_MAX_BYTE_SIZE_TEXT=n.SVG_MAX_BYTE_SIZE=void 0;const s=e("@metamask/utils"),r=e("./svg.cjs");n.SVG_MAX_BYTE_SIZE=1e5,n.SVG_MAX_BYTE_SIZE_TEXT=`${Math.floor(n.SVG_MAX_BYTE_SIZE/1e3)}kb`,n.assertIsSnapIcon=function(e){(0,s.assert)(e.path.endsWith(".svg"),'Expected snap icon to end in ".svg".');const t="string"==typeof e.value?(0,s.stringToBytes)(e.value).byteLength:e.value.byteLength;(0,s.assert)(t<=n.SVG_MAX_BYTE_SIZE,`The specified SVG icon exceeds the maximum size of ${n.SVG_MAX_BYTE_SIZE_TEXT}.`),(0,s.assert)((0,r.isSvg)(e.toString()),"Snap icon must be a valid SVG.")},n.getSvgDimensions=function(e){try{const t=(0,r.parseSvg)(e),n=t["@_height"],a=t["@_width"];if(n&&a)return{height:n,width:a};const i=t["@_viewBox"];if(i){const[e,t,n,r]=i.split(" ");if(n&&r){const e=parseInt(n,10),t=parseInt(r,10);return(0,s.assert)(Number.isInteger(e)&&e>0),(0,s.assert)(Number.isInteger(t)&&t>0),{width:e,height:t}}}}catch{throw new Error("Snap icon must be a valid SVG.")}return null}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/icon.cjs"}],[3145,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createWindow=void 0,n.createWindow=async function({uri:e,id:t,sandbox:n=!0,testId:s="snaps-iframe"}){return await new Promise((r,a)=>{const i=document.createElement("iframe");i.setAttribute("id",t),i.setAttribute("data-testid",s),n&&i.setAttribute("sandbox","allow-scripts"),i.setAttribute("src",e),document.body.appendChild(i),i.addEventListener("load",()=>{i.contentWindow?r(i.contentWindow):a(new Error(`iframe.contentWindow not present on load for job "${t}".`))},{once:!0})})}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/iframe.cjs"}],[3146,{"./account.cjs":3118,"./array.cjs":3119,"./auxiliary-files.cjs":3120,"./base64.cjs":3121,"./bytes.cjs":3122,"./caveats.cjs":3123,"./checksum.cjs":3124,"./constants.cjs":3125,"./cronjob.cjs":3126,"./currency.cjs":3127,"./deep-clone.cjs":3128,"./default-endowments.cjs":3129,"./derivation-paths.cjs":3130,"./entropy.cjs":3131,"./errors.cjs":3132,"./handlers/index.cjs":3138,"./iframe.cjs":3145,"./json-rpc.cjs":3147,"./json.cjs":3148,"./localization.cjs":3149,"./logging.cjs":3150,"./manifest/index.cjs":3151,"./path.cjs":3153,"./platform-version.cjs":3154,"./snaps.cjs":3155,"./strings.cjs":3156,"./structs.cjs":3157,"./time.cjs":3159,"./types.cjs":3160,"./ui.cjs":3161,"./url.cjs":3162,"./validation.cjs":3163,"./versions.cjs":3164,"./virtual-file/index.cjs":3166},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./account.cjs"),n),r(e("./array.cjs"),n),r(e("./auxiliary-files.cjs"),n),r(e("./base64.cjs"),n),r(e("./bytes.cjs"),n),r(e("./caveats.cjs"),n),r(e("./checksum.cjs"),n),r(e("./constants.cjs"),n),r(e("./cronjob.cjs"),n),r(e("./currency.cjs"),n),r(e("./deep-clone.cjs"),n),r(e("./default-endowments.cjs"),n),r(e("./derivation-paths.cjs"),n),r(e("./entropy.cjs"),n),r(e("./errors.cjs"),n),r(e("./handlers/index.cjs"),n),r(e("./iframe.cjs"),n),r(e("./json.cjs"),n),r(e("./json-rpc.cjs"),n),r(e("./localization.cjs"),n),r(e("./logging.cjs"),n),r(e("./manifest/index.cjs"),n),r(e("./path.cjs"),n),r(e("./platform-version.cjs"),n),r(e("./snaps.cjs"),n),r(e("./strings.cjs"),n),r(e("./structs.cjs"),n),r(e("./time.cjs"),n),r(e("./types.cjs"),n),r(e("./ui.cjs"),n),r(e("./url.cjs"),n),r(e("./validation.cjs"),n),r(e("./versions.cjs"),n),r(e("./virtual-file/index.cjs"),n)}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/index.cjs"}],[3147,{"@metamask/permission-controller":2862,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.assertIsJsonRpcSuccess=n.isOriginAllowed=n.assertIsKeyringOrigins=n.KeyringOriginsStruct=n.assertIsRpcOrigins=n.RpcOriginsStruct=void 0;const s=e("@metamask/permission-controller"),r=e("@metamask/superstruct"),a=e("@metamask/utils"),i=(0,r.array)((0,r.refine)((0,r.string)(),"Allowed origin",e=>!(e.split("*").length-1>2)||'No more than two wildcards ("*") are allowed in an origin specifier.'));function o(e,t){if("*"===e||e===t)return!0;const n=function(e){const t=e.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*");return RegExp(`^${t}$`,"u")}(e);return n.test(t)}n.RpcOriginsStruct=(0,r.refine)((0,r.object)({dapps:(0,r.optional)((0,r.boolean)()),snaps:(0,r.optional)((0,r.boolean)()),allowedOrigins:(0,r.optional)(i)}),"RPC origins",e=>!!Boolean(!0===e.snaps||!0===e.dapps||e.allowedOrigins&&e.allowedOrigins.length>0)||"Must specify at least one JSON-RPC origin."),n.assertIsRpcOrigins=function(e,t){(0,a.assertStruct)(e,n.RpcOriginsStruct,"Invalid JSON-RPC origins",t)},n.KeyringOriginsStruct=(0,r.object)({allowedOrigins:(0,r.optional)(i)}),n.assertIsKeyringOrigins=function(e,t){(0,a.assertStruct)(e,n.KeyringOriginsStruct,"Invalid keyring origins",t)},n.isOriginAllowed=function(e,t,n){var r;return"metamask"===n||(!(null===(r=e.allowedOrigins)||void 0===r||!r.some(e=>o(e,n)))||(!(t!==s.SubjectType.Website||!e.dapps)||Boolean(t===s.SubjectType.Snap&&e.snaps)))},n.assertIsJsonRpcSuccess=function(e){if(!(0,a.isJsonRpcSuccess)(e)){if((0,a.isJsonRpcFailure)(e))throw new Error(`JSON-RPC request failed: ${e.error.message}`);throw new Error("Invalid JSON-RPC response.")}}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/json-rpc.cjs"}],[3148,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getJsonSizeUnsafe=n.parseJson=void 0;const s=e("@metamask/utils");n.parseJson=function(e){return(0,s.getSafeJson)(JSON.parse(e))},n.getJsonSizeUnsafe=function(e,t=!1){const n=JSON.stringify(e);return t?(new TextEncoder).encode(n).byteLength:n.length}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/json.cjs"}],[3149,{"./json.cjs":3148,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSnapManifestLocalizations=n.getLocalizedSnapManifest=n.translate=n.TRANSLATION_REGEX=n.getLocalizationFile=n.getValidatedLocalizationFiles=n.LocalizationFileStruct=n.LOCALIZABLE_FIELDS=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),a=e("./json.cjs");function i(e,t){const n=t.find(t=>t.locale===e);return n||t.find(e=>"en"===e.locale)}function o(e,t){const s=e.matchAll(n.TRANSLATION_REGEX);return Array.from(s).reduce((n,[s,r])=>{if(!t)throw new Error(`Failed to translate "${e}": No localization file found.`);const a=t.messages[r.trim()];if(!a)throw new Error(`Failed to translate "${e}": No translation found for "${r.trim()}" in "${t.locale}" file.`);return n.replace(s,a.message)},e)}function c(e,t,s){const r=i(t,s);return n.LOCALIZABLE_FIELDS.reduce((e,t)=>{const n=o(e[t],r);return{...e,[t]:n}},e)}n.LOCALIZABLE_FIELDS=["description","proposedName"],n.LocalizationFileStruct=(0,r.object)({locale:(0,r.string)(),messages:(0,r.record)((0,r.string)(),(0,r.object)({message:(0,r.string)(),description:(0,r.optional)((0,r.string)())}))}),n.getValidatedLocalizationFiles=function(e){for(const t of e)try{t.result=(0,r.create)((0,a.parseJson)(t.toString()),n.LocalizationFileStruct)}catch(e){if(e instanceof r.StructError)throw new Error(`Failed to validate localization file "${t.path}": ${e.message}.`);if(e instanceof SyntaxError)throw new Error(`Failed to parse localization file "${t.path}" as JSON.`);throw e}return e},n.getLocalizationFile=i,n.TRANSLATION_REGEX=/\{\{\s?([a-zA-Z0-9-_\s]+)\s?\}\}/gu,n.translate=o,n.getLocalizedSnapManifest=c,n.validateSnapManifestLocalizations=function(e,t){try{t.filter(e=>"en"!==e.locale).forEach(n=>{c(e,n.locale,t)}),c(e,"en",t)}catch(e){throw new Error(`Failed to localize Snap manifest: ${(0,s.getErrorMessage)(e)}`)}}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/localization.cjs"}],[3150,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.logWarning=n.logError=n.logInfo=n.snapsLogger=void 0;const s=e("@metamask/utils");n.snapsLogger=(0,s.createProjectLogger)("snaps"),n.logInfo=function(e,...t){console.log(e,...t)},n.logError=function(e,...t){console.error(e,...t)},n.logWarning=function(e,...t){console.warn(e,...t)}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/logging.cjs"}],[3151,{"./validation.cjs":3152},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./validation.cjs"),n)}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/manifest/index.cjs"}],[3152,{"../array.cjs":3119,"../cronjob.cjs":3126,"../entropy.cjs":3131,"../json-rpc.cjs":3147,"../snaps.cjs":3155,"../structs.cjs":3157,"../types.cjs":3160,"@metamask/key-tree":2466,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSnapManifest=n.assertIsSnapManifest=n.isSnapManifest=n.SnapManifestStruct=n.InitialConnectionsStruct=n.SnapAuxilaryFilesStruct=n.SnapAuxiliaryFilesStruct=n.PermissionsStruct=n.EmptyObjectStruct=n.HandlerCaveatsStruct=n.ProtocolScopesStruct=n.MaxRequestTimeStruct=n.MAXIMUM_REQUEST_TIMEOUT=n.MINIMUM_REQUEST_TIMEOUT=n.LookupMatchersStruct=n.ChainIdsStruct=n.SnapIdsStruct=n.SemVerRangeStruct=n.SnapGetBip32EntropyPermissionsStruct=n.Bip32EntropyStruct=n.CurveStruct=n.bip32entropy=n.Bip32PathStruct=n.FORBIDDEN_COIN_TYPES=void 0;const s=e("@metamask/key-tree"),r=e("@metamask/superstruct"),a=e("@metamask/utils"),i=e("../array.cjs"),o=e("../cronjob.cjs"),c=e("../entropy.cjs"),l=e("../json-rpc.cjs"),u=e("../snaps.cjs"),d=e("../structs.cjs"),p=e("../types.cjs"),h=[c.SIP_6_MAGIC_VALUE,c.STATE_ENCRYPTION_MAGIC_VALUE];n.FORBIDDEN_COIN_TYPES=[60];const m=n.FORBIDDEN_COIN_TYPES.map(e=>["m","44'",`${e}'`]);n.Bip32PathStruct=(0,r.refine)((0,r.array)((0,r.string)()),"BIP-32 path",e=>0===e.length?"Path must be a non-empty BIP-32 derivation path array":"m"!==e[0]?'Path must start with "m".':e.length<3?"Paths must have a length of at least three.":e.slice(1).some(e=>!(0,s.isValidBIP32PathSegment)(e))?"Path must be a valid BIP-32 derivation path array.":h.includes(e[1])?`The purpose "${e[1]}" is not allowed for entropy derivation.`:!m.some(t=>(0,i.isEqual)(e.slice(0,t.length),t))||`The path "${e.join("/")}" is not allowed for entropy derivation.`);n.bip32entropy=e=>(0,r.refine)(e,"BIP-32 entropy",e=>"ed25519"!==e.curve||!e.path.slice(1).some(e=>!e.endsWith("'"))||"Ed25519 does not support unhardened paths."),n.CurveStruct=(0,r.enums)(["ed25519","secp256k1","ed25519Bip32"]),n.Bip32EntropyStruct=(0,n.bip32entropy)((0,r.type)({path:n.Bip32PathStruct,curve:n.CurveStruct})),n.SnapGetBip32EntropyPermissionsStruct=(0,r.size)((0,r.array)(n.Bip32EntropyStruct),1,Infinity),n.SemVerRangeStruct=(0,r.refine)((0,r.string)(),"SemVer range",e=>!!(0,a.isValidSemVerRange)(e)||"Expected a valid SemVer range."),n.SnapIdsStruct=(0,r.refine)((0,r.record)(u.SnapIdStruct,(0,r.object)({version:(0,r.optional)(n.SemVerRangeStruct)})),"SnapIds",e=>0!==Object.keys(e).length),n.ChainIdsStruct=(0,r.size)((0,r.array)(a.CaipChainIdStruct),1,Infinity),n.LookupMatchersStruct=(0,r.union)([(0,r.object)({tlds:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity)}),(0,r.object)({schemes:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity)}),(0,r.object)({tlds:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity),schemes:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity)})]),n.MINIMUM_REQUEST_TIMEOUT=(0,a.inMilliseconds)(5,a.Duration.Second),n.MAXIMUM_REQUEST_TIMEOUT=(0,a.inMilliseconds)(3,a.Duration.Minute),n.MaxRequestTimeStruct=(0,r.size)((0,r.integer)(),n.MINIMUM_REQUEST_TIMEOUT,n.MAXIMUM_REQUEST_TIMEOUT),n.ProtocolScopesStruct=(0,r.record)(a.CaipChainIdStruct,(0,r.object)({methods:(0,r.array)((0,r.string)())})),n.HandlerCaveatsStruct=(0,r.object)({maxRequestTime:(0,r.optional)(n.MaxRequestTimeStruct)}),n.EmptyObjectStruct=(0,r.object)({}),n.PermissionsStruct=(0,r.type)({"endowment:assets":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({scopes:n.ChainIdsStruct}))),"endowment:cronjob":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({jobs:(0,r.optional)(o.CronjobSpecificationArrayStruct)}))),"endowment:ethereum-provider":(0,r.optional)(n.EmptyObjectStruct),"endowment:keyring":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,l.KeyringOriginsStruct)),"endowment:protocol":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({scopes:n.ProtocolScopesStruct}))),"endowment:lifecycle-hooks":(0,r.optional)(n.HandlerCaveatsStruct),"endowment:name-lookup":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({chains:(0,r.optional)(n.ChainIdsStruct),matchers:(0,r.optional)(n.LookupMatchersStruct)}))),"endowment:network-access":(0,r.optional)(n.EmptyObjectStruct),"endowment:page-home":(0,r.optional)(n.HandlerCaveatsStruct),"endowment:rpc":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,l.RpcOriginsStruct)),"endowment:signature-insight":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({allowSignatureOrigin:(0,r.optional)((0,r.boolean)())}))),"endowment:transaction-insight":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({allowTransactionOrigin:(0,r.optional)((0,r.boolean)())}))),"endowment:webassembly":(0,r.optional)(n.EmptyObjectStruct),snap_dialog:(0,r.optional)(n.EmptyObjectStruct),snap_manageState:(0,r.optional)(n.EmptyObjectStruct),snap_manageAccounts:(0,r.optional)(n.EmptyObjectStruct),snap_notify:(0,r.optional)(n.EmptyObjectStruct),snap_getBip32Entropy:(0,r.optional)(n.SnapGetBip32EntropyPermissionsStruct),snap_getBip32PublicKey:(0,r.optional)(n.SnapGetBip32EntropyPermissionsStruct),snap_getBip44Entropy:(0,r.optional)((0,r.size)((0,r.array)((0,r.object)({coinType:(0,r.size)((0,r.integer)(),0,2**32-1)})),1,Infinity)),snap_getEntropy:(0,r.optional)(n.EmptyObjectStruct),snap_getLocale:(0,r.optional)(n.EmptyObjectStruct),wallet_snap:(0,r.optional)(n.SnapIdsStruct)}),n.SnapAuxiliaryFilesStruct=(0,r.array)((0,r.string)()),n.SnapAuxilaryFilesStruct=n.SnapAuxiliaryFilesStruct,n.InitialConnectionsStruct=(0,r.record)((0,r.intersection)([(0,r.string)(),(0,p.uri)()]),(0,r.object)({})),n.SnapManifestStruct=(0,r.object)({version:a.VersionStruct,description:(0,r.size)((0,r.string)(),1,280),proposedName:(0,r.size)((0,r.string)(),1,214),repository:(0,r.optional)((0,r.type)({type:(0,r.size)((0,r.string)(),1,Infinity),url:(0,r.size)((0,r.string)(),1,Infinity)})),source:(0,r.object)({shasum:a.ChecksumStruct,location:(0,r.object)({npm:(0,r.object)({filePath:(0,r.size)((0,r.string)(),1,Infinity),iconPath:(0,r.optional)((0,r.size)((0,r.string)(),1,Infinity)),packageName:p.NameStruct,registry:(0,r.union)([(0,r.literal)("https://registry.npmjs.org"),(0,r.literal)("https://registry.npmjs.org/")])})}),files:(0,r.optional)(n.SnapAuxiliaryFilesStruct),locales:(0,r.optional)(n.SnapAuxiliaryFilesStruct)}),initialConnections:(0,r.optional)(n.InitialConnectionsStruct),initialPermissions:n.PermissionsStruct,manifestVersion:(0,r.literal)("0.1"),platformVersion:(0,r.optional)(a.VersionStruct),$schema:(0,r.optional)((0,r.string)())}),n.isSnapManifest=function(e){return(0,r.is)(e,n.SnapManifestStruct)},n.assertIsSnapManifest=function(e){(0,a.assertStruct)(e,n.SnapManifestStruct,`"${p.NpmSnapFileNames.Manifest}" is invalid`)},n.createSnapManifest=function(e){return(0,r.create)(e,n.SnapManifestStruct)}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/manifest/validation.cjs"}],[3153,{"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeRelative=void 0;const s=e("@metamask/utils");n.normalizeRelative=function(e){return(0,s.assert)(!e.startsWith("/")),(0,s.assert)(-1===e.search(/:|\/\//u),`Path "${e}" potentially an URI instead of local relative`),e.startsWith("./")?e.slice(2):e}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/path.cjs"}],[3154,{"@metamask/snaps-sdk/package.json":3353},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getPlatformVersion=void 0;const r=s(e("@metamask/snaps-sdk/package.json"));n.getPlatformVersion=function(){return r.default.version}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/platform-version.cjs"}],[3155,{"./caveats.cjs":3123,"./checksum.cjs":3124,"./types.cjs":3160,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554,"@scure/base":3634,"fast-json-stable-stringify":4789,"validate-npm-package-name":6150},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.verifyRequestedSnapPermissions=n.isSnapPermitted=n.assertIsValidSnapId=n.isSnapId=n.stripSnapPrefix=n.getSnapPrefix=n.SnapIdStruct=n.SnapIdPrefixStruct=n.HttpSnapIdStruct=n.NpmSnapIdStruct=n.LocalSnapIdStruct=n.BaseSnapIdStruct=n.LOCALHOST_HOSTNAMES=n.validateSnapShasum=n.getSnapChecksum=n.SnapStatusEvents=n.SnapStatus=n.PROPOSED_NAME_REGEX=void 0;const r=e("@metamask/snaps-sdk"),a=e("@metamask/superstruct"),i=e("@metamask/utils"),o=e("@scure/base"),c=s(e("fast-json-stable-stringify")),l=s(e("validate-npm-package-name")),u=e("./caveats.cjs"),d=e("./checksum.cjs"),p=e("./types.cjs");var h,m;function f(e){const t=e.clone();return delete t.result.source.shasum,t.value=(0,c.default)(t.result),t}async function g(e){const{manifest:t,sourceCode:n,svgIcon:s,auxiliaryFiles:r,localizationFiles:a}=e,i=[f(t),n,s,...r,...a].filter(e=>e!==undefined);return o.base64.encode(await(0,d.checksumFiles)(i))}n.PROPOSED_NAME_REGEX=/^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*\/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$/u,function(e){e.Installing="installing",e.Updating="updating",e.Running="running",e.Stopped="stopped",e.Crashed="crashed"}(h||(n.SnapStatus=h={})),function(e){e.Start="START",e.Stop="STOP",e.Crash="CRASH",e.Update="UPDATE"}(m||(n.SnapStatusEvents=m={})),n.getSnapChecksum=g,n.validateSnapShasum=async function(e,t="Invalid Snap manifest: manifest shasum does not match computed shasum."){if(e.manifest.result.source.shasum!==await g(e))throw new Error(t)},n.LOCALHOST_HOSTNAMES=["localhost","127.0.0.1","[::1]"],n.BaseSnapIdStruct=(0,i.definePattern)("Base Snap Id",/^[\x21-\x7E]*$/u);const S=(0,p.uri)({protocol:(0,a.enums)(["http:","https:"]),hostname:(0,a.enums)(n.LOCALHOST_HOSTNAMES),hash:(0,a.empty)((0,a.string)()),search:(0,a.empty)((0,a.string)())});function b(e){const t=Object.values(p.SnapIdPrefixes).find(t=>e.startsWith(t));if(t!==undefined)return t;throw new Error(`Invalid or no prefix found for "${e}"`)}n.LocalSnapIdStruct=(0,a.refine)(n.BaseSnapIdStruct,"local Snap Id",e=>{if(!e.startsWith(p.SnapIdPrefixes.local))return`Expected local snap ID, got "${e}".`;const[t]=(0,a.validate)(e.slice(p.SnapIdPrefixes.local.length),S);return t??!0}),n.NpmSnapIdStruct=(0,a.intersection)([n.BaseSnapIdStruct,(0,p.uri)({protocol:(0,a.literal)(p.SnapIdPrefixes.npm),pathname:(0,a.refine)((0,a.string)(),"package name",function*(e){const t=e.startsWith("/")?e.slice(1):e,{errors:n,validForNewPackages:s,warnings:r}=(0,l.default)(t);return s||(n===undefined?((0,i.assert)(r!==undefined),yield*r):yield*n),!0}),search:(0,a.empty)((0,a.string)()),hash:(0,a.empty)((0,a.string)())})]),n.HttpSnapIdStruct=(0,a.intersection)([n.BaseSnapIdStruct,(0,p.uri)({protocol:(0,a.enums)(["http:","https:"]),search:(0,a.empty)((0,a.string)()),hash:(0,a.empty)((0,a.string)())})]),n.SnapIdPrefixStruct=(0,a.refine)((0,a.string)(),"Snap ID prefix",e=>{if(Object.values(p.SnapIdPrefixes).some(t=>e.startsWith(t)))return!0;return`Invalid or no prefix found. Expected Snap ID to start with one of: ${Object.values(p.SnapIdPrefixes).map(e=>`"${e}"`).join(", ")}, but received: "${e}"`}),n.SnapIdStruct=(0,r.selectiveUnion)(e=>"string"==typeof e&&e.startsWith(p.SnapIdPrefixes.npm)?n.NpmSnapIdStruct:"string"==typeof e&&e.startsWith(p.SnapIdPrefixes.local)?n.LocalSnapIdStruct:n.SnapIdPrefixStruct),n.getSnapPrefix=b,n.stripSnapPrefix=function(e){return e.replace(b(e),"")},n.isSnapId=function(e){return(0,a.is)(e,n.SnapIdStruct)},n.assertIsValidSnapId=function(e){(0,i.assertStruct)(e,n.SnapIdStruct,"Invalid snap ID")},n.isSnapPermitted=function(e,t){var n,s;return Boolean(null===(n=((null==e||null===(s=e.wallet_snap)||void 0===s||null===(s=s.caveats)||void 0===s?void 0:s.find(e=>e.type===u.SnapCaveatType.SnapIds))??{}).value)||void 0===n?void 0:n[t])},n.verifyRequestedSnapPermissions=function(e){(0,i.assert)((0,i.isObject)(e),"Requested permissions must be an object.");const{wallet_snap:t}=e;(0,i.assert)((0,i.isObject)(t),"wallet_snap is missing from the requested permissions.");const{caveats:n}=t;(0,i.assert)(Array.isArray(n)&&1===n.length,"wallet_snap must have a caveat property with a single-item array value.");const[s]=n;(0,i.assert)((0,i.isObject)(s)&&s.type===u.SnapCaveatType.SnapIds&&(0,i.isObject)(s.value),`The requested permissions do not have a valid ${u.SnapCaveatType.SnapIds} caveat.`)}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/snaps.cjs"}],[3156,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.indent=void 0,n.indent=function(e,t=2){return e.replace(/^/gmu," ".repeat(t))}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/strings.cjs"}],[3157,{"./strings.cjs":3156,"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554,chalk:4496},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeStructs=n.createUnion=n.validateUnion=n.getStructErrorMessage=n.getStructFailureMessage=n.getStructErrorPrefix=n.getUnionStructNames=n.getStructFromPath=n.createFromStruct=n.getError=n.arrayToGenerator=n.SnapsStructError=n.named=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),a=e("@metamask/utils"),i=e("chalk"),o=e("./strings.cjs");function c(e,t,n){return n?t(e):e}n.named=function(e,t){return new r.Struct({...t,type:e})};class l extends r.StructError{constructor(e,t,n,s,r,a=!0){super(s,r),this.name="SnapsStructError",this.message=`${t}.\n\n${g(e,[...r()],a)}${n?`\n\n${n}`:""}`}}function*u(e){for(const t of e)yield t}function d({struct:e,prefix:t,suffix:n="",error:s,colorize:r}){return new l(e,t,n,s,()=>u(s.failures()),r)}function p(e,t){return t.reduce((t,n)=>(0,a.isObject)(e.schema)&&e.schema[n]?e.schema[n]:t,e)}function h(e,t=!0){return Array.isArray(e.schema)?e.schema.map(({type:e})=>c(e,i.green,t)):null}function m(e,t=!0){return"never"===e.type||0===e.path.length?"":`At path: ${c(e.path.join("."),i.bold,t)}  `}function f(e,t,n=!0){const s=c(JSON.stringify(t.value),i.red,n),r=m(t,n);if("union"===t.type){const a=h(p(e,t.path),n);return a?`${r}Expected the value to be one of: ${a.join(", ")}, but received: ${s}.`:`${r}${t.message}.`}if("literal"===t.type){return`${r}${t.message.replace(/the literal `(.+)`,/u,`the value to be \`${c("$1",i.green,n)}\`,`).replace(/, but received: (.+)/u,`, but received: ${c("$1",i.red,n)}`)}.`}if("never"===t.type)return`Unknown key: ${c(t.path.join("."),i.bold,n)}, received: ${s}.`;if("size"===t.refinement){return`${r}${t.message.replace(/length between `(\d+)` and `(\d+)`/u,`length between ${c("$1",i.green,n)} and ${c("$2",i.green,n)},`).replace(/length of `(\d+)`/u,`length of ${c("$1",i.red,n)}`).replace(/a array/u,"an array")}.`}return t.refinement!==undefined?`${r}${t.message}.`:`${r}Expected a value of type ${c(t.type,i.green,n)}, but received: ${s}.`}function g(e,t,n=!0){return t.map(t=>(0,o.indent)(` ${f(e,t,n)}`)).join("\n")}function S(e,t,n,i=!1){(0,a.assert)(t.schema,"Expected a struct with a schema. Make sure to use `union` from `@metamask/snaps-sdk`."),(0,a.assert)(t.schema.length>0,"Expected a non-empty array of structs.");const o=t.schema.map(e=>e.schema[n]),c=(0,r.type)({[n]:(0,s.union)(o)}),[l]=(0,r.validate)(e,c,{coerce:i});if(l)throw new Error(f(c,l.failures()[0],!1));const u=e,d=t.schema.filter(e=>(0,r.is)(u[n],e.schema[n]));(0,a.assert)(d.length>0,"Expected a struct to match the value.");const p=d.map(e=>(0,r.validate)(u,e,{coerce:i})),h=p.find(([e])=>!e);if(h)return h[1];(0,a.assert)(p[0][0],"Expected at least one error.");const m=p.reduce((e,[t])=>((0,a.assert)(t,"Expected an error."),t.failures().length<e.failures().length?t:e),p[0][0]);throw new Error(f(t,m.failures()[0],!1))}n.SnapsStructError=l,n.arrayToGenerator=u,n.getError=d,n.createFromStruct=function(e,t,n,s=""){try{return(0,r.create)(e,t)}catch(e){if(e instanceof r.StructError)throw d({struct:t,prefix:n,suffix:s,error:e});throw e}},n.getStructFromPath=p,n.getUnionStructNames=h,n.getStructErrorPrefix=m,n.getStructFailureMessage=f,n.getStructErrorMessage=g,n.validateUnion=S,n.createUnion=function(e,t,n){return S(e,t,n,!0)},n.mergeStructs=function(...e){const t=r.assign(...e);return new r.Struct({...t,*refiner(t,n){for(const s of e)yield*s.refiner(t,n)}})}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/structs.cjs"}],[3158,{"@metamask/utils":3554,"fast-xml-parser":4791},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSvg=n.parseSvg=void 0;const s=e("@metamask/utils"),r=e("fast-xml-parser");function a(e){try{const t=e.trim();(0,s.assert)(t.length>0);const n=new r.XMLParser({ignoreAttributes:!1,parseAttributeValue:!0}).parse(t,!0);return(0,s.assert)((0,s.hasProperty)(n,"svg")),(0,s.isObject)(n.svg)?n.svg:{}}catch{throw new Error("Snap icon must be a valid SVG.")}}n.parseSvg=a,n.isSvg=function(e){try{return a(e),!0}catch{return!1}}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/svg.cjs"}],[3159,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,luxon:5250},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ISO8601DateStruct=n.toCensoredISO8601String=n.ISO8601DurationStruct=void 0;const s=e("@metamask/superstruct"),r=e("luxon");n.ISO8601DurationStruct=(0,s.refine)((0,s.string)(),"ISO 8601 duration",e=>!!r.Duration.fromISO(e).isValid||"Not a valid ISO 8601 duration"),n.toCensoredISO8601String=function(e){return r.DateTime.fromISO(e,{setZone:!0}).startOf("second").toISO({suppressMilliseconds:!0})};var a=e("@metamask/snaps-sdk");Object.defineProperty(n,"ISO8601DateStruct",{enumerable:!0,get:function(){return a.ISO8601DateStruct}})}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/time.cjs"}],[316,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.qrKeyringBuilderFactory=function(e,t,n){const s=()=>new e({bridge:new t(n)});return s.type=e.type,s}}}},{package:"$root$",file:"app/scripts/lib/qr-keyring-builder-factory.ts"}],[3160,{"@metamask/snaps-sdk":3265,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WALLET_SNAP_PERMISSION_KEY=n.isValidUrl=n.uri=n.SNAP_STREAM_NAMES=n.SnapIdPrefixes=n.NpmSnapPackageJsonStruct=n.NameStruct=n.NpmSnapFileNames=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),a=e("@metamask/utils");var i,o,c;!function(e){e.PackageJson="package.json",e.Manifest="snap.manifest.json"}(i||(n.NpmSnapFileNames=i={})),n.NameStruct=(0,r.size)((0,a.definePattern)("Snap Name",/^(?:@[a-z0-9-*~][a-z0-9-*._~]*\/)?[a-z0-9-~][a-z0-9-._~]*$/u),1,214),n.NpmSnapPackageJsonStruct=(0,r.type)({version:a.VersionStruct,name:n.NameStruct,main:(0,r.optional)((0,r.size)((0,r.string)(),1,Infinity)),repository:(0,r.optional)((0,r.type)({type:(0,r.size)((0,r.string)(),1,Infinity),url:(0,r.size)((0,r.string)(),1,Infinity)}))}),function(e){e.npm="npm:",e.local="local:"}(o||(n.SnapIdPrefixes=o={})),function(e){e.JSON_RPC="jsonRpc",e.COMMAND="command"}(c||(n.SNAP_STREAM_NAMES=c={}));var l=e("@metamask/snaps-sdk");Object.defineProperty(n,"uri",{enumerable:!0,get:function(){return l.uri}}),n.isValidUrl=function(e,t={}){return(0,r.is)(e,(0,s.uri)(t))},n.WALLET_SNAP_PERMISSION_KEY="wallet_snap"}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/types.cjs"}],[3161,{"./types.cjs":3160,"./url.cjs":3162,"@metamask/snaps-sdk":3265,"@metamask/snaps-sdk/jsx":3352,"@metamask/snaps-sdk/jsx-runtime":3351,"@metamask/utils":3554,marked:5251},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serialiseJsx=n.walkJsx=n.getJsxChildren=n.hasChildren=n.getTotalTextLength=n.validateJsxElements=n.validateAssetSelector=n.validateTextLinks=n.validateLink=n.getJsxElementFromComponent=n.getTextChildren=void 0;const s=e("@metamask/snaps-sdk/jsx-runtime"),r=e("@metamask/snaps-sdk"),a=e("@metamask/snaps-sdk/jsx"),i=e("@metamask/utils"),o=e("marked"),c=e("./types.cjs"),l=e("./url.cjs"),u=["https:","mailto:","metamask:"];function d(e){switch(e){case"primary":return"primary";case"secondary":return"destructive";default:return undefined}}function p(e){return 1===e.length?e[0]:e}function h(e){return e.tokens&&e.tokens.length>0?p(e.tokens.flatMap(f)):e.href}function m(e){return p(e.flatMap(f))}function f(e){switch(e.type){case"link":return(0,s.jsx)(a.Link,{href:e.href,children:h(e)});case"text":return e.text;case"strong":return(0,s.jsx)(a.Bold,{children:m(e.tokens)});case"em":return(0,s.jsx)(a.Italic,{children:m(e.tokens)});default:return null}}function g(e){const t=(0,o.lexer)(e,{gfm:!1}),n=[];return(0,o.walkTokens)(t,e=>{if("paragraph"===e.type){n.length>0&&n.push("\n\n");const{tokens:t}=e;n.push(...t.flatMap(f))}}),n.filter(e=>null!==e)}function S(e,t,n){try{const s=new URL(e);if((0,i.assert)(u.includes(s.protocol),`Protocol must be one of: ${u.join(", ")}.`),"metamask:"===s.protocol){const t=(0,l.parseMetaMaskUrl)(e);t.snapId&&(0,i.assert)(n(t.snapId),"The Snap being navigated to is not installed.")}else if("mailto:"===s.protocol){const e=s.pathname.split(",");for(const n of e){const e=n.split("@")[1];(0,i.assert)(!e.includes(":"));const s=`https://${e}`;(0,i.assert)(!t(s),"The specified URL is not allowed.")}return}(0,i.assert)(!t(s.href),"The specified URL is not allowed.")}catch(e){throw new Error(`Invalid URL: ${"ERR_ASSERTION"===(null==e?void 0:e.code)?e.message:"Unable to parse URL."}`)}}function b(e,t){const n=t(e);(0,i.assert)(n,`Could not find account for address: ${e}`)}function y(e){const{type:t}=e;switch(t){case r.NodeType.Panel:return e.children.reduce((e,t)=>e+y(t),0);case r.NodeType.Row:return y(e.value);case r.NodeType.Text:return e.value.length;default:return 0}}function v(e){return(0,i.hasProperty)(e.props,"children")}function w(e){return Boolean(e)&&!0!==e}function _(e){if(v(e)){if(Array.isArray(e.props.children))return e.props.children.filter(w).flat(Infinity);if(e.props.children)return[e.props.children]}return[]}function k(e,t,n=0){if(Array.isArray(e)){for(const s of e){const e=k(s,t,n);if(e!==undefined)return e}return undefined}const s=t(e,n);if(s!==undefined)return s;if((0,i.hasProperty)(e,"props")&&(0,i.isPlainObject)(e.props)&&(0,i.hasProperty)(e.props,"children")){const s=_(e);for(const e of s)if((0,i.isPlainObject)(e)){const s=k(e,t,n+1);if(s!==undefined)return s}}return undefined}function E(e){return Object.entries(e).filter(([e])=>"children"!==e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>{return` ${e}=${n=t,"string"==typeof n?`"${n}"`:`{${JSON.stringify(n)}}`}`;var n}).join("")}n.getTextChildren=g,n.getJsxElementFromComponent=function(e){return function(e){const t=y(e);(0,i.assert)(t<=5e4,"The text in a Snap UI may not be larger than 50 kB.")}(e),function e(t){switch(t.type){case r.NodeType.Address:return(0,s.jsx)(a.Address,{address:t.value});case r.NodeType.Button:return(0,s.jsx)(a.Button,{name:t.name,variant:d(t.variant),type:t.buttonType,children:t.value});case r.NodeType.Copyable:return(0,s.jsx)(a.Copyable,{value:t.value,sensitive:t.sensitive});case r.NodeType.Divider:return(0,s.jsx)(a.Divider,{});case r.NodeType.Form:return(0,s.jsx)(a.Form,{name:t.name,children:p(t.children.map(e))});case r.NodeType.Heading:return(0,s.jsx)(a.Heading,{children:t.value});case r.NodeType.Image:return(0,s.jsx)(a.Image,{src:t.value});case r.NodeType.Input:return(0,s.jsx)(a.Field,{label:t.label,error:t.error,children:(0,s.jsx)(a.Input,{name:t.name,type:t.inputType,value:t.value,placeholder:t.placeholder})});case r.NodeType.Panel:return(0,s.jsx)(a.Box,{children:p(t.children.map(e))});case r.NodeType.Row:return(0,s.jsx)(a.Row,{label:t.label,variant:t.variant,children:e(t.value)});case r.NodeType.Spinner:return(0,s.jsx)(a.Spinner,{});case r.NodeType.Text:return(0,s.jsx)(a.Text,{children:p(g(t.value))});default:return(0,i.assertExhaustive)(t)}}(e)},n.validateLink=S,n.validateTextLinks=function(e,t,n){const s=function(e){const t=(0,o.lexer)(e,{gfm:!1}),n=[];return(0,o.walkTokens)(t,e=>{"link"===e.type&&n.push(e)}),n}(e);for(const e of s)S(e.href,t,n)},n.validateAssetSelector=b,n.validateJsxElements=function(e,{isOnPhishingList:t,getSnap:n,getAccountByAddress:s,hasPermission:r}){k(e,e=>{switch(e.type){case"Link":S(e.props.href,t,n);break;case"AssetSelector":b(e.props.addresses[0],s);break;case"Image":{const{src:t}=e.props,n=(0,c.isValidUrl)(t);(0,i.assert)(!n||n&&r("endowment:network-access"),"Using external images is only permitted with the `endowment:network-access` permission.");break}}})},n.getTotalTextLength=y,n.hasChildren=v,n.getJsxChildren=_,n.walkJsx=k,n.serialiseJsx=function e(t,n=0){if(Array.isArray(t))return t.map(t=>e(t,n)).join("");const s="  ".repeat(n);if("string"==typeof t)return`${s}${t}\n`;if(!t)return"";const{type:r,props:a}=t,o=n>0?"\n":"";if((0,i.hasProperty)(a,"children")){const t=e(a.children,n+1);return`${s}<${r}${E(a)}>\n${t}${s}</${r}>${o}`}return`${s}<${r}${E(a)} />${o}`}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/ui.cjs"}],[3162,{"./snaps.cjs":3155,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseMetaMaskUrl=n.SNAP_PATHS=n.CLIENT_PATHS=void 0;const s=e("@metamask/utils"),r=e("./snaps.cjs");n.CLIENT_PATHS=["/"],n.SNAP_PATHS=["/home"],n.parseMetaMaskUrl=function(e){const t=new URL(e),{protocol:a}=t;if("metamask:"!==a)throw new Error(`Unable to parse URL. Expected the protocol to be "metamask:", but received "${a}".`);const[i,...o]=t.href.replace("metamask://","").split("/"),c=`/${o.join("/")}`;switch(i){case"client":return(0,s.assert)(n.CLIENT_PATHS.includes(c),`Unable to navigate to "${c}". The provided path is not allowed.`),{authority:i,path:c};case"snap":return function(e){const t="Invalid MetaMask url:",a=(0,r.stripSnapPrefix)(e.slice(1)),i=e.slice(1).startsWith("npm:")?"npm:":"local:",o=a.startsWith("@"),c=a.split("/"),l=`/${c[c.length-1]}`;let u;if("local:"===i){const[e,,...r]=c.slice(0,-1);u=`${e}//${r.join("/")}`,(0,s.assert)(n.SNAP_PATHS.includes(l),`${t} invalid snap path.`)}else u=o?`${c[0]}/${c[1]}`:c[0],(0,s.assert)(o?3===c.length&&n.SNAP_PATHS.includes(l):2===c.length&&n.SNAP_PATHS.includes(l),`${t} invalid snap path.`);const d=`${i}${u}`;return(0,r.assertIsValidSnapId)(d),{authority:"snap",snapId:d,path:l}}(c);default:throw new Error(`Expected "metamask:" URL to start with "client" or "snap", but received "${i}".`)}}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/url.cjs"}],[3163,{"./icon.cjs":3144,"./localization.cjs":3149,"./manifest/validation.cjs":3152,"./snaps.cjs":3155},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateFetchedSnap=void 0;const s=e("./icon.cjs"),r=e("./localization.cjs"),a=e("./manifest/validation.cjs"),i=e("./snaps.cjs");n.validateFetchedSnap=async function(e){(0,a.assertIsSnapManifest)(e.manifest.result),await(0,i.validateSnapShasum)(e),(0,r.validateSnapManifestLocalizations)(e.manifest.result,e.localizationFiles.map(e=>e.result)),e.svgIcon&&(0,s.assertIsSnapIcon)(e.svgIcon)}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/validation.cjs"}],[3164,{"@metamask/superstruct":3415,"@metamask/utils":3554,semver:5987},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resolveVersionRange=n.getTargetVersion=n.DEFAULT_REQUESTED_SNAP_VERSION=void 0;const s=e("@metamask/superstruct"),r=e("@metamask/utils"),a=e("semver");n.DEFAULT_REQUESTED_SNAP_VERSION="*",n.getTargetVersion=function(e,t){const n=(0,a.maxSatisfying)(e,t);return n||(0,a.maxSatisfying)(e,t,{includePrerelease:!0})},n.resolveVersionRange=function(e){return e===undefined||"latest"===e?[undefined,n.DEFAULT_REQUESTED_SNAP_VERSION]:(0,s.validate)(e,r.VersionRangeStruct)}}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/versions.cjs"}],[3165,{"../deep-clone.cjs":3128,"@metamask/utils":3554,"@scure/base":3634},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.VirtualFile=void 0;const r=e("@metamask/utils"),a=e("@scure/base"),i=e("../deep-clone.cjs");class o{constructor(e){var t,n,r,a;let i;s(this,"value",void 0),s(this,"result",void 0),s(this,"data",void 0),s(this,"path",void 0),i="string"==typeof e||e instanceof Uint8Array?{value:e}:e,this.value=(null===(t=i)||void 0===t?void 0:t.value)??"",this.result=(null===(n=i)||void 0===n?void 0:n.result)??undefined,this.data=(null===(r=i)||void 0===r?void 0:r.data)??{},this.path=(null===(a=i)||void 0===a?void 0:a.path)??"/"}get size(){return"string"==typeof this.value?this.value.length:this.value.byteLength}toString(e){if("string"==typeof this.value)return(0,r.assert)(e===undefined,"Tried to encode string."),this.value;if(this.value instanceof Uint8Array&&"hex"===e)return(0,r.bytesToHex)(this.value);if(this.value instanceof Uint8Array&&"base64"===e)return a.base64.encode(this.value);return new TextDecoder(e).decode(this.value)}clone(){const e=new o;return"string"==typeof this.value?e.value=this.value:e.value=this.value.slice(0),e.result=(0,i.deepClone)(this.result),e.data=(0,i.deepClone)(this.data),e.path=this.path,e}}n.VirtualFile=o}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/virtual-file/VirtualFile.cjs"}],[3166,{"./VirtualFile.cjs":3165},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./VirtualFile.cjs"),n)}}},{package:"@metamask/snaps-controllers>@metamask/snaps-utils",file:"node_modules/@metamask/snaps-controllers/node_modules/@metamask/snaps-utils/dist/virtual-file/index.cjs"}],[3167,{buffer:4474,"buffer-from":4480,inherits:5016,"readable-stream":3182,typedarray:6092},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("readable-stream").Writable,r=e("inherits"),a=e("buffer-from");if("undefined"==typeof Uint8Array)var i=e("typedarray").Uint8Array;else i=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,r=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):r=!0,s.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=r,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,r(o,s),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];"string"==typeof r||n.isBuffer(r)?t.push(r):c(r)?t.push(a(r)):t.push(a(String(r)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];n.isBuffer(r)?t.push(r):c(r)?t.push(a(r)):t.push(a(String(r)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=a(e[n])),t+=e[n].length;for(var s=new i(t),r=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)s[r++]=o[c];return s}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[3168,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s={};function r(e,t,n){n||(n=Error);var r=function(e){var n,s;function r(n,s,r){return e.call(this,function(e,n,s){return"string"==typeof t?t:t(e,n,s)}(n,s,r))||this}return s=e,(n=r).prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s,r}(n);r.prototype.name=n.name,r.prototype.code=e,s[e]=r}function a(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,n){var s,r,i,o;if("string"==typeof t&&(r="not ",t.substr(!i||i<0?0:+i,r.length)===r)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(s," ").concat(a(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(s," ").concat(a(t,"type"))}return o+=". Received type ".concat(typeof n)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=s}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/errors-browser.js"}],[3169,{"./_stream_readable":3171,"./_stream_writable":3173,_process:5490,inherits:5016},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=l;var r=e("./_stream_readable"),a=e("./_stream_writable");e("inherits")(l,r);for(var i=s(a.prototype),o=0;o<i.length;o++){var c=i[o];l.prototype[c]||(l.prototype[c]=a.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);r.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_duplex.js"}],[317,{"./handlers":323,"./handlers/wallet-getPermissions":328,"./handlers/wallet-requestPermissions":329,"./handlers/wallet-revokePermissions":330,"@metamask/rpc-errors":3026,"@metamask/snaps-rpc-methods":3209,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMultichainMethodMiddleware=n.createEthAccountsMethodMiddleware=n.createEip1193MethodMiddleware=void 0,n.makeMethodMiddlewareMaker=u;var s=e("@metamask/rpc-errors"),r=e("@metamask/snaps-rpc-methods"),a=e("@metamask/utils"),i=e("./handlers"),o=e("./handlers/wallet-getPermissions"),c=e("./handlers/wallet-requestPermissions"),l=e("./handlers/wallet-revokePermissions");n.createEip1193MethodMiddleware=u([...i.handlers,...i.eip1193OnlyHandlers,o.getPermissionsHandler,c.requestPermissionsHandler,l.revokePermissionsHandler]),n.createEthAccountsMethodMiddleware=u([i.ethAccountsHandler]),n.createMultichainMethodMiddleware=u(i.handlers);function u(e){const t=e.reduce((e,t)=>{for(const n of t.methodNames)e[n]=t;return e},{}),n=new Set(e.flatMap(({hookNames:e})=>Object.getOwnPropertyNames(e)));return e=>{!function(e,t){const n=[];if(t.forEach(t=>{(0,a.hasProperty)(e,t)||n.push(t)}),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const s=Object.getOwnPropertyNames(e).filter(e=>!t.has(e));if(s.length>0)throw new Error(`Received unexpected hooks:\n\n${s.join("\n")}\n`)}(e,n);return async(n,a,i,o)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:l}=c;try{return await t(n,a,i,o,(0,r.selectHooks)(e,l))}catch(e){return o(e instanceof Error?e:s.rpcErrors.internal({data:e}))}}return i()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[3170,{"./_stream_transform":3172,inherits:5016},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=r;var s=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}e("inherits")(r,s),r.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_passthrough.js"}],[3171,{"../errors":3168,"./_stream_duplex":3169,"./internal/streams/async_iterator":3174,"./internal/streams/buffer_list":3175,"./internal/streams/destroy":3176,"./internal/streams/from":3178,"./internal/streams/state":3180,"./internal/streams/stream":3181,_process:5490,buffer:4474,events:4770,inherits:5016,"string_decoder/":6066,util:4426},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;t.exports=E,E.ReadableState=k;e("events").EventEmitter;var r=function(e,t){return e.listeners(t).length},a=e("./internal/streams/stream"),i=e("buffer").Buffer,o=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,l=e("util");c=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,p,h=e("./internal/streams/buffer_list"),m=e("./internal/streams/destroy"),f=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,S=g.ERR_INVALID_ARG_TYPE,b=g.ERR_STREAM_PUSH_AFTER_EOF,y=g.ERR_METHOD_NOT_IMPLEMENTED,v=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(E,a);var w=m.errorOrDestroy,_=["error","close","destroy","pause","resume"];function k(t,n,r){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof r&&(r=n instanceof s),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=f(this,t,"readableHighWaterMark",r),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function E(t){if(s=s||e("./_stream_duplex"),!(this instanceof E))return new E(t);var n=this instanceof s;this._readableState=new k(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),a.call(this)}function T(e,t,n,s,r){c("readableAddChunk",t);var a,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?R(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}(e,l);else if(r||(a=function(e,t){var n;s=t,i.isBuffer(s)||s instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new S("chunk",["string","Buffer","Uint8Array"],t));var s;return n}(l,t)),a)w(e,a);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===i.prototype||(t=function(e){return i.from(e)}(t)),s)l.endEmitted?w(e,new v):P(e,l,t,!0);else if(l.ended)w(e,new b);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?P(e,l,t,!1):I(e,l)):P(e,l,t,!1)}else s||(l.reading=!1,I(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function P(e,t,n,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&R(e)),I(e,t)}Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),E.prototype.destroy=m.destroy,E.prototype._undestroy=m.undestroy,E.prototype._destroy=function(e,t){t(e)},E.prototype.push=function(e,t){var n,s=this._readableState;return s.objectMode?n=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=i.from(e,t),t=""),n=!0),T(this,e,t,!1,n)},E.prototype.unshift=function(e){return T(this,e,null,!0,!1)},E.prototype.isPaused=function(){return!1===this._readableState.flowing},E.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var n=new u(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=n.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var j=1073741824;function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=j?e=j:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function R(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(A,e))}function A(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,L(e)}function I(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(M,e,t))}function M(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function C(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function N(e){c("readable nexttick read 0"),e.read(0)}function x(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function $(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function D(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(U,t,e))}function U(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function H(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1}E.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?D(this):R(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&D(this),null;var s,r=t.needReadable;return c("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",r=!0),t.ended||t.reading?c("reading or ended",r=!1):r&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(n,t))),null===(s=e>0?$(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&D(this)),null!==s&&this.emit("data",s),s},E.prototype._read=function(e){w(this,new y("_read()"))},E.prototype.pipe=function(e,t){var s=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,c("pipe count=%d opts=%j",a.pipesCount,t);var i=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:g;function o(t,n){c("onunpipe"),t===s&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",m),e.removeListener("finish",f),e.removeListener("drain",u),e.removeListener("error",h),e.removeListener("unpipe",o),s.removeListener("end",l),s.removeListener("end",g),s.removeListener("data",p),d=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function l(){c("onend"),e.end()}a.endEmitted?n.nextTick(i):s.once("end",i),e.on("unpipe",o);var u=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&r(e,"data")&&(t.flowing=!0,L(e))}}(s);e.on("drain",u);var d=!1;function p(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==H(a.pipes,e))&&!d&&(c("false write response, pause",a.awaitDrain),a.awaitDrain++),s.pause())}function h(t){c("onerror",t),g(),e.removeListener("error",h),0===r(e,"error")&&w(e,t)}function m(){e.removeListener("finish",f),g()}function f(){c("onfinish"),e.removeListener("close",m),g()}function g(){c("unpipe"),s.unpipe(e)}return s.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",m),e.once("finish",f),e.emit("pipe",s),a.flowing||(c("pipe resume"),s.resume()),e},E.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)s[a].emit("unpipe",this,{hasUnpiped:!1});return this}var i=H(t.pipes,e);return-1===i||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},E.prototype.on=function(e,t){var s=a.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?R(this):r.reading||n.nextTick(N,this))),s},E.prototype.addListener=E.prototype.on,E.prototype.removeListener=function(e,t){var s=a.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(C,this),s},E.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(C,this),t},E.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(x,e,t))}(this,e)),e.paused=!1,this},E.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},E.prototype.wrap=function(e){var t=this,n=this._readableState,s=!1;for(var r in e.on("end",function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(r){(c("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&r!==undefined)&&((n.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause())))}),e)this[r]===undefined&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var a=0;a<_.length;a++)e.on(_[a],this.emit.bind(this,_[a]));return this._read=function(t){c("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(E.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(E.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(E.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(E.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),E._fromList=$,Object.defineProperty(E.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(E.from=function(t,n){return p===undefined&&(p=e("./internal/streams/from")),p(E,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_readable.js"}],[3172,{"../errors":3168,"./_stream_duplex":3169,inherits:5016},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=u;var s=e("../errors").codes,r=s.ERR_METHOD_NOT_IMPLEMENTED,a=s.ERR_MULTIPLE_CALLBACK,i=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function l(e,t){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(null===s)return this.emit("error",new a);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush(function(t,n){p(e,t,n)})}function p(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new i;return e.push(null)}e("inherits")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var s=this._transformState;if(s.writecb=n,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,function(e){t(e)})}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_transform.js"}],[3173,{"../errors":3168,"./_stream_duplex":3169,"./internal/streams/destroy":3176,"./internal/streams/state":3180,"./internal/streams/stream":3181,_process:5490,buffer:4474,inherits:5016,"util-deprecate":6130},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(n),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}var r;t.exports=E,E.WritableState=k;var a={deprecate:e("util-deprecate")},i=e("./internal/streams/stream"),o=e("buffer").Buffer,c=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,p=e("../errors").codes,h=p.ERR_INVALID_ARG_TYPE,m=p.ERR_METHOD_NOT_IMPLEMENTED,f=p.ERR_MULTIPLE_CALLBACK,g=p.ERR_STREAM_CANNOT_PIPE,S=p.ERR_STREAM_DESTROYED,b=p.ERR_STREAM_NULL_VALUES,y=p.ERR_STREAM_WRITE_AFTER_END,v=p.ERR_UNKNOWN_ENCODING,w=u.errorOrDestroy;function _(){}function k(t,a,i){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=a instanceof r),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var s=e._writableState,r=s.sync,a=s.writecb;if("function"!=typeof a)throw new f;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(s),t)!function(e,t,s,r,a){--t.pendingcb,s?(n.nextTick(a,r),n.nextTick(A,e,t),e._writableState.errorEmitted=!0,w(e,r)):(a(r),e._writableState.errorEmitted=!0,w(e,r),A(e,t))}(e,s,r,t,a);else{var i=O(s)||e.destroyed;i||s.corked||s.bufferProcessing||!s.bufferedRequest||j(e,s),r?n.nextTick(P,e,s,i,a):P(e,s,i,a)}}(a,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function E(t){var n=this instanceof(r=r||e("./_stream_duplex"));if(!n&&!l.call(E,this))return new E(t);this._writableState=new k(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),i.call(this)}function T(e,t,n,s,r,a,i){t.writelen=s,t.writecb=i,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new S("write")):n?e._writev(r,t.onwrite):e._write(r,a,t.onwrite),t.sync=!1}function P(e,t,n,s){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),A(e,t)}function j(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,a=new Array(r),i=t.corkedRequestsFree;i.entry=n;for(var o=0,c=!0;n;)a[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;a.allBuffers=c,T(e,t,!0,t.length,a,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,d=n.callback;if(T(e,t,!1,t.objectMode?1:l.length,l,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function R(e,t){e._final(function(n){t.pendingcb--,n&&w(e,n),t.prefinished=!0,e.emit("prefinish"),A(e,t)})}function A(e,t){var s=O(t);if(s&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(R,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return s}e("inherits")(E,i),k.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(k.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(E,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===E&&(e&&e._writableState instanceof k)}})):l=function(e){return e instanceof this},E.prototype.pipe=function(){w(this,new g)},E.prototype.write=function(e,t,s){var r,a=this._writableState,i=!1,l=!a.objectMode&&(r=e,o.isBuffer(r)||r instanceof c);return l&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(s=t,t=null),l?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof s&&(s=_),a.ending?function(e,t){var s=new y;w(e,s),n.nextTick(t,s)}(this,s):(l||function(e,t,s,r){var a;return null===s?a=new b:"string"==typeof s||t.objectMode||(a=new h("chunk",["string","Buffer"],s)),!a||(w(e,a),n.nextTick(r,a),!1)}(this,a,e,s))&&(a.pendingcb++,i=function(e,t,n,s,r,a){if(!n){var i=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,s,r);s!==i&&(n=!0,r="buffer",s=i)}var c=t.objectMode?1:s.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:n,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,c,s,r,a);return l}(this,a,l,e,t,s)),i},E.prototype.cork=function(){this._writableState.corked++},E.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||j(this,e))},E.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(E.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),E.prototype._write=function(e,t,n){n(new m("_write()"))},E.prototype._writev=null,E.prototype.end=function(e,t,s){var r=this._writableState;return"function"==typeof e?(s=e,e=null,t=null):"function"==typeof t&&(s=t,t=null),null!==e&&e!==undefined&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,s){t.ending=!0,A(e,t),s&&(t.finished?n.nextTick(s):e.once("finish",s));t.ended=!0,e.writable=!1}(this,r,s),this},Object.defineProperty(E.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),E.prototype.destroy=u.destroy,E.prototype._undestroy=u.undestroy,E.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_writable.js"}],[3174,{"./end-of-stream":3177,_process:5490},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=e("./end-of-stream"),i=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function m(e){var t=e[i];if(null!==t){var n=e[p].read();null!==n&&(e[u]=null,e[i]=null,e[o]=null,t(h(n,!1)))}}function f(e){n.nextTick(m,e)}var g=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((r(s={get stream(){return this[p]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(h(undefined,!0));if(this[p].destroyed)return new Promise(function(t,s){n.nextTick(function(){e[c]?s(e[c]):t(h(undefined,!0))})});var s,r=this[u];if(r)s=new Promise(function(e,t){return function(n,s){e.then(function(){t[l]?n(h(undefined,!0)):t[d](n,s)},s)}}(r,this));else{var a=this[p].read();if(null!==a)return Promise.resolve(h(a,!1));s=new Promise(this[d])}return this[u]=s,s}},Symbol.asyncIterator,function(){return this}),r(s,"return",function(){var e=this;return new Promise(function(t,n){e[p].destroy(null,function(e){e?n(e):t(h(undefined,!0))})})}),s),g);t.exports=function(e){var t,n=Object.create(S,(r(t={},p,{value:e,writable:!0}),r(t,i,{value:null,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,c,{value:null,writable:!0}),r(t,l,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var s=n[p].read();s?(n[u]=null,n[i]=null,n[o]=null,e(h(s,!1))):(n[i]=e,n[o]=t)},writable:!0}),t));return n[u]=null,a(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[u]=null,n[i]=null,n[o]=null,t(e)),void(n[c]=e)}var s=n[i];null!==s&&(n[u]=null,n[i]=null,n[o]=null,s(h(undefined,!0))),n[l]=!0}),e.on("readable",f.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[3175,{buffer:4474,util:4426},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,o(s.key),s)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var c=e("buffer").Buffer,l=e("util").inspect,u=l&&l.custom||"inspect";function d(e,t,n){c.prototype.copy.call(e,t,n)}t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,s;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),n=this.head,s=0;n;)d(n.data,t,s),s+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,a=e>r.length?r.length:e;if(a===r.length?s+=r:s+=r.slice(0,e),0===(e-=a)){a===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(a));break}++n}return this.length-=n,s}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,s=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,a=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,a),0===(e-=a)){a===r.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(a));break}++s}return this.length-=s,t}},{key:u,value:function(e,t){return l(this,r(r({},t),{},{depth:0,customInspect:!1}))}}])&&i(t.prototype,n),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[3176,{_process:5490},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){r(e,t),s(e)}function s(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,a){var i=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(a?a(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!a&&t?i._writableState?i._writableState.errorEmitted?e.nextTick(s,i):(i._writableState.errorEmitted=!0,e.nextTick(n,i,t)):e.nextTick(n,i,t):a?(e.nextTick(s,i),a(t)):e.nextTick(s,i)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,s=e._writableState;n&&n.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[3177,{"../../../errors":3168},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,n,a){if("function"==typeof n)return e(t,null,n);n||(n={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];e.apply(this,s)}}}(a||r);var i=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){o=!1,l=!0,i||a.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){i=!1,d=!0,o||a.call(t)},h=function(e){a.call(t,e)},m=function(){var e;return i&&!d?(t._readableState&&t._readableState.ended||(e=new s),a.call(t,e)):o&&!l?(t._writableState&&t._writableState.ended||(e=new s),a.call(t,e)):void 0},f=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",m),t.req?f():t.on("request",f)),t.on("end",p),t.on("finish",u),!1!==n.error&&t.on("error",h),t.on("close",m),function(){t.removeListener("complete",u),t.removeListener("abort",m),t.removeListener("request",f),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",m)}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[3178,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[3179,{"../../../errors":3168,"./end-of-stream":3177},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;var r=e("../../../errors").codes,a=r.ERR_MISSING_ARGS,i=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new a("streams");var p=n.map(function(t,r){var a=r<n.length-1;return function(t,n,r,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;t.on("close",function(){o=!0}),s===undefined&&(s=e("./end-of-stream")),s(t,{readable:n,writable:r},function(e){if(e)return a(e);o=!0,a()});var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void a(e||new i("pipe"))}}(t,a,r>0,function(e){u||(u=e),e&&p.forEach(c),a||(p.forEach(c),d(u))})});return n.reduce(l)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[318,{"../../../../shared/constants/network":6194,"@metamask/rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createUnsupportedMethodMiddleware=function(e=r.UNSUPPORTED_RPC_METHODS){return async function(t,n,r,a){return e.has(t.method)?a(s.rpcErrors.methodNotSupported()):r()}};var s=e("@metamask/rpc-errors"),r=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[3180,{"../../../errors":3168},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,r){var a=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new s(r?n:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/state.js"}],[3181,{events:4770},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[3182,{"./lib/_stream_duplex.js":3169,"./lib/_stream_passthrough.js":3170,"./lib/_stream_readable.js":3171,"./lib/_stream_transform.js":3172,"./lib/_stream_writable.js":3173,"./lib/internal/streams/end-of-stream.js":3177,"./lib/internal/streams/pipeline.js":3179},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/readable-browser.js"}],[3187,{"./verify":3188,"@metamask/superstruct":3415,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const a=e("@metamask/superstruct"),i=e("@metamask/utils"),o=(0,a.refine)((0,a.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,a.object)({checksum:i.ChecksumStruct,clientVersions:(0,a.optional)((0,a.object)({extension:(0,a.optional)(i.VersionRangeStruct),mobile:(0,a.optional)(i.VersionRangeStruct)}))});n.AuthorStruct=(0,a.object)({name:(0,a.string)(),website:(0,a.string)()}),n.AuditStruct=(0,a.object)({auditor:(0,a.string)(),report:(0,a.string)()}),n.SupportStruct=(0,a.object)({knowledgeBase:(0,a.optional)((0,a.string)()),faq:(0,a.optional)((0,a.string)()),contact:(0,a.optional)((0,a.string)()),keyRecovery:(0,a.optional)((0,a.string)())}),n.AdditionalSourceCodeStruct=(0,a.object)({name:(0,a.string)(),url:(0,a.string)()}),n.ImagePathStruct=(0,a.pattern)((0,a.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,a.object)({id:o,metadata:(0,a.object)({name:(0,a.string)(),type:(0,a.optional)((0,a.enums)(["account"])),author:(0,a.optional)(n.AuthorStruct),website:(0,a.optional)((0,a.string)()),onboard:(0,a.optional)((0,a.boolean)()),summary:(0,a.optional)((0,a.string)()),description:(0,a.optional)((0,a.string)()),audits:(0,a.optional)((0,a.array)(n.AuditStruct)),category:(0,a.optional)((0,a.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,a.optional)((0,a.array)((0,a.string)())),support:(0,a.optional)(n.SupportStruct),sourceCode:(0,a.optional)((0,a.string)()),hidden:(0,a.optional)((0,a.boolean)()),privateCode:(0,a.optional)((0,a.boolean)()),privacyPolicy:(0,a.optional)((0,a.string)()),termsOfUse:(0,a.optional)((0,a.string)()),additionalSourceCode:(0,a.optional)((0,a.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,a.optional)((0,a.size)((0,a.array)(n.ImagePathStruct),3,3))}),versions:(0,a.record)(i.VersionStruct,c)}),n.BlockReasonStruct=(0,a.object)({explanation:(0,a.optional)((0,a.string)()),url:(0,a.optional)((0,a.string)())}),n.BlockedSnapStruct=(0,a.union)([(0,a.object)({id:o,versionRange:i.VersionRangeStruct,reason:(0,a.optional)(n.BlockReasonStruct)}),(0,a.object)({checksum:i.ChecksumStruct,reason:(0,a.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,a.object)({verifiedSnaps:(0,a.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,a.array)(n.BlockedSnapStruct)}),r(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[3188,{"@metamask/superstruct":3415,"@metamask/utils":3554,"@noble/curves/secp256k1":3595,"@noble/hashes/sha256":3608},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const s=e("@metamask/superstruct"),r=e("@metamask/utils"),a=e("@noble/curves/secp256k1"),i=e("@noble/hashes/sha256");n.SignatureStruct=(0,s.object)({signature:r.StrictHexStruct,curve:(0,s.literal)("secp256k1"),format:(0,s.literal)("DER")}),n.verify=async function({registry:e,signature:t,publicKey:s}){(0,r.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,r.hexToBytes)(s),c=await async function(e){var t;return"crypto"in globalThis&&"object"==typeof globalThis.crypto&&(null===(t=crypto.subtle)||void 0===t?void 0:t.digest)?new Uint8Array(await crypto.subtle.digest("SHA-256",e)):(0,i.sha256)(e)}((0,r.stringToBytes)(e));return a.secp256k1.verify((0,r.remove0x)(t.signature),c,o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[319,{"../../../../../shared/constants/app":6175,"../../../../../shared/constants/network":6194,"./ethereum-chain-utils":321,"@metamask/controller-utils":1639,"@metamask/network-controller":2751,"@metamask/rpc-errors":3026,lodash:5239,"uri-js":6108},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var s={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(s,a,i):s[a]=e[a]}return s.default=e,n&&n.set(e,s),s}(e("uri-js")),r=e("@metamask/controller-utils"),a=e("@metamask/network-controller"),i=e("@metamask/rpc-errors"),o=e("lodash"),c=e("../../../../../shared/constants/app"),l=e("../../../../../shared/constants/network"),u=e("./ethereum-chain-utils");function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const p={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,n,c,{addNetwork:d,updateNetwork:p,getNetworkConfigurationByChainId:h,setActiveNetwork:m,requestUserApproval:f,getCurrentChainIdForDomain:g,getCaveat:S,requestPermittedChainsPermissionIncrementalForOrigin:b,rejectApprovalRequestsForOrigin:y,setTokenNetworkFilter:v,setEnabledNetworks:w,getEnabledNetworks:_}){var k,E;let T;try{T=(0,u.validateAddEthereumChainParams)(e.params[0])}catch(e){return c(e)}const{chainId:P,chainName:j,firstValidBlockExplorerUrl:O,firstValidRPCUrl:R,ticker:A}=T,{origin:I}=e,M=g(I),C=h(P);if(C&&C.chainId===P&&C.nativeCurrency!==A)return c(i.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${A}`}));let N=C,x=null==C?void 0:C.rpcEndpoints.findIndex(({url:e})=>s.equal(e,R)),L=O?null==C?void 0:C.blockExplorerUrls.findIndex(e=>s.equal(e,O)):undefined;const $=!C||x!==C.defaultRpcEndpointIndex||O&&L!==C.defaultBlockExplorerUrlIndex;if($)try{if(await f({origin:I,type:r.ApprovalType.AddEthereumChain,requestData:{chainId:P,rpcPrefs:{blockExplorerUrl:O},chainName:j,rpcUrl:R,ticker:A}}),C){const e=(0,o.cloneDeep)(C);-1===x&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:R,type:a.RpcEndpointType.Custom,name:j}],x=e.rpcEndpoints.length-1),O&&(-1===L&&(e.blockExplorerUrls=[...e.blockExplorerUrls,O],L=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=L),N=await p(e.chainId,e,M===P?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else{const e=l.FEATURED_RPCS.find(e=>e.chainId===P),t=e?e.rpcEndpoints[e.defaultRpcEndpointIndex]:undefined;N=await d({blockExplorerUrls:O?[O]:[],defaultBlockExplorerUrlIndex:O?0:undefined,chainId:P,defaultRpcEndpointIndex:0,name:j,nativeCurrency:A,rpcEndpoints:[...t&&!s.equal(R,t.url)?[t]:[],{url:R,name:j,type:a.RpcEndpointType.Custom}]})}}catch(e){return c(e)}const D=null==C||null===(k=C.rpcEndpoints)||void 0===k||null===(k=k[C.defaultRpcEndpointIndex])||void 0===k?void 0:k.networkClientId,U=null===(E=N)||void 0===E||null===(E=E.rpcEndpoints)||void 0===E||null===(E=E[N.defaultRpcEndpointIndex])||void 0===E?void 0:E.networkClientId,H=D??U;return(0,u.switchChain)(t,c,P,H,{isAddFlow:!0,autoApprove:$,setActiveNetwork:m,getCaveat:S,requestPermittedChainsPermissionIncrementalForOrigin:b,rejectApprovalRequestsForOrigin:y,setTokenNetworkFilter:v,setEnabledNetworks:w,getEnabledNetworks:_})},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0}};n.default=p}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[32,{"@metamask/claims-controller":1629},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsControllerInit=void 0;var s=e("@metamask/claims-controller");n.ClaimsControllerInit=e=>{const{controllerMessenger:t,persistedState:n}=e;return{controller:new s.ClaimsController({messenger:t,state:n.ClaimsController})}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-controller-init.ts"}],[320,{"../../../../../shared/constants/app":6175},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,n,s,{getAccounts:r}){return t.result=r(),s()},hookNames:{getAccounts:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.ts"}],[321,{"../../../../../shared/constants/app":6175,"../../../../../shared/modules/network.utils":6328,"../../util":380,"@metamask/chain-agnostic-permission":1610,"@metamask/controller-utils":1639,"@metamask/rpc-errors":3026,"@metamask/snaps-utils":3382,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.switchChain=async function(e,t,n,r,{origin:l,isAddFlow:u,isSwitchFlow:d,autoApprove:p,setActiveNetwork:h,getCaveat:m,requestPermittedChainsPermissionIncrementalForOrigin:f,setTokenNetworkFilter:g,setEnabledNetworks:S,getEnabledNetworks:b,rejectApprovalRequestsForOrigin:y,requestUserApproval:v,hasApprovalRequestsForOrigin:w,toNetworkConfiguration:_,fromNetworkConfiguration:k}){try{const E=m({target:a.Caip25EndowmentPermissionName,caveatType:a.Caip25CaveatType});if(E){if((0,a.getPermittedEthChainIds)(E.value).includes(n))null==w||!w()||u||p||await v({origin:l,type:s.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:_,fromNetworkConfiguration:k}});else{let e;d&&(e={isSwitchEthereumChain:!0}),await f({chainId:n,autoApprove:p,metadata:e})}}else await f({chainId:n,autoApprove:p});if((0,o.isSnapId)(l)||null==y||y(),await h(r),!(0,o.isSnapId)(l))if(g(n),(0,c.isPrefixedFormattedHexString)(n)){const e=b(i.KnownCaipNamespace.Eip155);Object.keys(e).includes(n)||S(n)}else{const{namespace:e}=(0,i.parseCaipChainId)(n),t=b(e);Object.keys(t).includes(n)||S(n)}return e.result=null,t()}catch(e){return t(e)}},n.validateAddEthereumChainParams=function(e){if(!e||"object"!=typeof e)throw r.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:t,chainName:n,blockExplorerUrls:s,nativeCurrency:a,rpcUrls:i,...o}=e,c=Object.keys(o).filter(e=>!["iconUrls"].includes(e));if(c.length>0)throw r.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${c}`});const p=d(t);if(!i||!Array.isArray(i)||0===i.length)throw r.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${i}`});const h=e=>{const t=(0,u.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},m=i.find(e=>h(e)),f=Array.isArray(s)?s.find(e=>h(e)):null;if(!m)throw r.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${i}`});if("string"!=typeof n||!n)throw r.rpcErrors.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${n}`});const g=n.length>100?n.substring(0,100):n;if(null!==a){if("object"!=typeof a||Array.isArray(a))throw r.rpcErrors.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${a}`});if(18!==a.decimals)throw r.rpcErrors.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${a.decimals}`});if(!a.symbol||"string"!=typeof a.symbol)throw r.rpcErrors.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${a.symbol}`})}const S=(null==a?void 0:a.symbol)||l.UNKNOWN_TICKER_SYMBOL;if(S!==l.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof S||S.length<1||S.length>6))throw r.rpcErrors.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${S}`});return{chainId:p,chainName:g,firstValidBlockExplorerUrl:f,firstValidRPCUrl:m,ticker:S}},n.validateChainId=d,n.validateSwitchEthereumChainParams=function(e){var t;if(null===(t=e.params)||void 0===t||!t[0]||"object"!=typeof e.params[0])throw r.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:n,...s}=e.params[0];if(Object.keys(s).length>0)throw r.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(s)}`});return d(n)};var s=e("@metamask/controller-utils"),r=e("@metamask/rpc-errors"),a=e("@metamask/chain-agnostic-permission"),i=e("@metamask/utils"),o=e("@metamask/snaps-utils"),c=e("../../../../../shared/modules/network.utils"),l=e("../../../../../shared/constants/app"),u=e("../../util");function d(e){const t="string"==typeof e?e.toLowerCase():null;if(!(0,c.isPrefixedFormattedHexString)(t))throw r.rpcErrors.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,c.isSafeChainId)(parseInt(e,16)))throw r.rpcErrors.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[322,{"../../../../../shared/constants/app":6175},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,n,s,{getProviderState:r}){var a;const i=null===(a=e.params)||void 0===a?void 0:a.isInitializingStreamProvider;return t.result={...await r(e.origin,{isInitializingStreamProvider:i})},s()},hookNames:{getProviderState:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.ts"}],[323,{"./add-ethereum-chain":319,"./eth-accounts":320,"./get-provider-state":322,"./log-web3-shim-usage":324,"./request-accounts":325,"./send-metadata":326,"./switch-ethereum-chain":327,"./watch-asset":331},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handlers=n.ethAccountsHandler=n.eip1193OnlyHandlers=void 0;var s=d(e("./add-ethereum-chain")),r=d(e("./eth-accounts")),a=d(e("./get-provider-state")),i=d(e("./log-web3-shim-usage")),o=d(e("./request-accounts")),c=d(e("./send-metadata")),l=d(e("./switch-ethereum-chain")),u=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}n.handlers=[s.default,a.default,i.default,c.default,u.default],n.eip1193OnlyHandlers=[l.default,r.default,o.default],n.ethAccountsHandler=r.default}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[324,{"../../../../../shared/constants/app":6175},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,n,s,{getWeb3ShimUsageState:r,setWeb3ShimUsageRecorded:a}){const{origin:i}=e;r(i)===undefined&&a(i);return t.result=!0,s()},hookNames:{getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/log-web3-shim-usage.ts"}],[325,{"../../../../../shared/constants/app":6175,"../../../../../shared/constants/metametrics":6190,"../../util":380,"@metamask/rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("../../../../../shared/constants/app"),a=e("../../../../../shared/constants/metametrics"),i=e("../../util");const o={methodNames:[r.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,n,o,{getAccounts:l,sendMetrics:u,metamaskState:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p,requestPermissionsForOrigin:h}){const{origin:m}=e??{};if(c.has(m))return t.error=s.rpcErrors.resourceUnavailable(`Already processing ${r.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();let f=l(m);if(f.length>0){try{c.add(m),t.result=f,o()}catch(e){o(e)}finally{c.delete(m)}return undefined}try{const e=p();await h(e)}catch(e){return o(e)}if(f=l(m),(0,i.shouldEmitDappViewedEvent)(d.metaMetricsId)){const e=!Object.keys(d.permissionHistory).includes(m);u({event:a.MetaMetricsEventName.DappViewed,category:a.MetaMetricsEventCategory.InpageProvider,referrer:{url:m},properties:{is_first_visit:e,number_of_accounts:Object.keys(d.identities).length,number_of_accounts_connected:f.length}},{excludeMetaMetricsId:!0})}return t.result=f,o()},hookNames:{getAccounts:!0,sendMetrics:!0,metamaskState:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0,requestPermissionsForOrigin:!0}};n.default=o;const c=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.ts"}],[326,{"../../../../../shared/constants/app":6175},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,n,s){return t.result=!0,s()},hookNames:{}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.ts"}],[327,{"../../../../../shared/constants/app":6175,"./ethereum-chain-utils":321,"@metamask/rpc-errors":3026,"@metamask/snaps-utils":3382},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("@metamask/snaps-utils"),a=e("../../../../../shared/constants/app"),i=e("./ethereum-chain-utils");const o={methodNames:[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,n,o,{getNetworkConfigurationByChainId:c,setActiveNetwork:l,requestUserApproval:u,getCaveat:d,getCurrentChainIdForDomain:p,requestPermittedChainsPermissionIncrementalForOrigin:h,rejectApprovalRequestsForOrigin:m,setTokenNetworkFilter:f,setEnabledNetworks:g,getEnabledNetworks:S,hasApprovalRequestsForOrigin:b}){let y;try{y=(0,i.validateSwitchEthereumChainParams)(e)}catch(e){return o(e)}const{origin:v}=e,w=p(v);if(w===y)return t.result=null,o();const _=c(y),k=null==_?void 0:_.rpcEndpoints[_.defaultRpcEndpointIndex].networkClientId;if(!k)return o(s.providerErrors.custom({code:4902,message:`Unrecognized chain ID "${y}". Try adding the chain using ${a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}));const E=c(w),T=c(y);return(0,i.switchChain)(t,o,y,k,{origin:v,isSwitchFlow:!0,autoApprove:(0,r.isSnapId)(v),setActiveNetwork:l,getCaveat:d,requestPermittedChainsPermissionIncrementalForOrigin:h,rejectApprovalRequestsForOrigin:m,setTokenNetworkFilter:f,setEnabledNetworks:g,getEnabledNetworks:S,requestUserApproval:u,hasApprovalRequestsForOrigin:b,toNetworkConfiguration:T,fromNetworkConfiguration:E})},hookNames:{getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCaveat:!0,getCurrentChainIdForDomain:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0,hasApprovalRequestsForOrigin:!0}};n.default=o}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/switch-ethereum-chain.js"}],[328,{"../../../../../shared/constants/permissions":6198,"../../../controllers/permissions":240,"@metamask/chain-agnostic-permission":1610,"@metamask/permission-controller":2862},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionsHandler=void 0;var s=e("@metamask/permission-controller"),r=e("@metamask/chain-agnostic-permission"),a=e("../../../controllers/permissions"),i=e("../../../../../shared/constants/permissions");n.getPermissionsHandler={methodNames:[s.MethodNames.GetPermissions],implementation:async function(e,t,n,s,{getPermissionsForOrigin:o,getAccounts:c}){var l;const u={...o()},d=u[r.Caip25EndowmentPermissionName],p=null==d||null===(l=d.caveats)||void 0===l||null===(l=l.find(({type:e})=>e===r.Caip25CaveatType))||void 0===l?void 0:l.value;if(delete u[r.Caip25EndowmentPermissionName],p){const e=c();e.length>0&&(u[i.RestrictedMethods.eth_accounts]={...d,parentCapability:i.RestrictedMethods.eth_accounts,caveats:[{type:i.CaveatTypes.restrictReturnedAccounts,value:e}]});const t=(0,r.getPermittedEthChainIds)(p);t.length>0&&(u[a.PermissionNames.permittedChains]={...d,parentCapability:a.PermissionNames.permittedChains,caveats:[{type:i.CaveatTypes.restrictNetworkSwitching,value:t}]})}return t.result=Object.values(u),s()},hookNames:{getPermissionsForOrigin:!0,getAccounts:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-getPermissions.ts"}],[329,{"../../../../../shared/constants/permissions":6198,"../../../controllers/permissions":240,"@metamask/chain-agnostic-permission":1610,"@metamask/controller-utils":1639,"@metamask/permission-controller":2862,lodash:5239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.requestPermissionsHandler=void 0;var s=e("lodash"),r=e("@metamask/controller-utils"),a=e("@metamask/permission-controller"),i=e("@metamask/chain-agnostic-permission"),o=e("../../../../../shared/constants/permissions"),c=e("../../../controllers/permissions");n.requestPermissionsHandler={methodNames:[a.MethodNames.RequestPermissions],implementation:async function(e,t,n,l,{getAccounts:u,requestPermissionsForOrigin:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p}){const{params:h}=e;if(!Array.isArray(h)||!(0,r.isPlainObject)(h[0]))return l((0,a.invalidParams)({data:{request:e}}));let[m]=h;delete m[i.Caip25EndowmentPermissionName];const f=(0,s.pick)(m,[o.RestrictedMethods.eth_accounts,c.PermissionNames.permittedChains]);delete m[o.RestrictedMethods.eth_accounts],delete m[c.PermissionNames.permittedChains];const g=Object.keys(f).length>0;if(g){const e=p(f);m={...m,...e}}let S={};const[b]=await d(m);if(S={...b},g){var y;const e=S[i.Caip25EndowmentPermissionName];if(!e)throw new Error(`could not find ${i.Caip25EndowmentPermissionName} permission.`);const t=null===(y=e.caveats)||void 0===y||null===(y=y.find(({type:e})=>e===i.Caip25CaveatType))||void 0===y?void 0:y.value;if(!t)throw new Error(`could not find ${i.Caip25CaveatType} in granted ${i.Caip25EndowmentPermissionName} permission.`);delete S[i.Caip25EndowmentPermissionName];const n=u(origin);S[o.RestrictedMethods.eth_accounts]={...e,parentCapability:o.RestrictedMethods.eth_accounts,caveats:[{type:o.CaveatTypes.restrictReturnedAccounts,value:n}]};const s=(0,i.getPermittedEthChainIds)(t);s.length>0&&(S[c.PermissionNames.permittedChains]={...e,parentCapability:c.PermissionNames.permittedChains,caveats:[{type:o.CaveatTypes.restrictNetworkSwitching,value:s}]})}return t.result=Object.values(S).filter(e=>e!==undefined),l()},hookNames:{getAccounts:!0,requestPermissionsForOrigin:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-requestPermissions.ts"}],[33,{"../../../../shared/modules/shield/config":6340,"@metamask/claims-controller":1629},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsServiceInit=void 0;var s=e("@metamask/claims-controller"),r=e("../../../../shared/modules/shield/config");n.ClaimsServiceInit=e=>{const{controllerMessenger:t}=e,{claimsEnv:n}=(0,r.loadShieldConfig)();return{controller:new s.ClaimsService({messenger:t,env:n,fetchFunction:fetch.bind(globalThis)}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-service-init.ts"}],[330,{"../../../../../shared/constants/permissions":6198,"../../../controllers/permissions":240,"@metamask/chain-agnostic-permission":1610,"@metamask/permission-controller":2862,"@metamask/utils":3554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.revokePermissionsHandler=void 0;var s=e("@metamask/permission-controller"),r=e("@metamask/utils"),a=e("@metamask/chain-agnostic-permission"),i=e("../../../../../shared/constants/permissions"),o=e("../../../controllers/permissions");n.revokePermissionsHandler={methodNames:[s.MethodNames.RevokePermissions],implementation:function(e,t,n,c,{revokePermissionsForOrigin:l,rejectApprovalRequestsForOrigin:u}){const{params:d}=e,p=null==d?void 0:d[0];if(!p)return c((0,s.invalidParams)({data:{request:e}}));const h=Object.keys(p).filter(e=>e!==a.Caip25EndowmentPermissionName);if(!(0,r.isNonEmptyArray)(h))return c((0,s.invalidParams)({data:{request:e}}));const m=[i.RestrictedMethods.eth_accounts,o.PermissionNames.permittedChains],f=h.filter(e=>!m.includes(e));f.length!==h.length&&f.push(a.Caip25EndowmentPermissionName);return l(f),u(),t.result=null,c()},hookNames:{revokePermissionsForOrigin:!0,rejectApprovalRequestsForOrigin:!0,updateCaveat:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-revokePermissions.ts"}],[331,{"../../../../../shared/constants/app":6175,"@metamask/controller-utils":1639,"@metamask/rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("@metamask/controller-utils"),a=e("../../../../../shared/constants/app");const i={methodNames:[a.MESSAGE_TYPE.WATCH_ASSET,a.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,n,a,{handleWatchAssetRequest:i}){try{const{params:{options:n,type:o},origin:c,networkClientId:l}=e,{tokenId:u}=n;return[r.ERC721,r.ERC1155].includes(o)&&u!==undefined&&"string"!=typeof u?a(s.rpcErrors.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof u}'`})):(await i({asset:n,type:o,origin:c??"",networkClientId:l??""}),t.result=!0,a())}catch(e){return a(e)}},hookNames:{handleWatchAssetRequest:!0}};n.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.ts"}],[332,{"./createMethodMiddleware":317,"./createUnsupportedMethodMiddleware":318},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var s=e("./createMethodMiddleware");Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===s[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}}))});var r=e("./createUnsupportedMethodMiddleware");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===r[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}}))})}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}]],[],{});