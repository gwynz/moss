import{D as E,K as Jr,u as we,w as be,z as te}from"./chunk-SHY2LMMT.js";import{k as jt,w as de}from"./chunk-SEWPLVP7.js";import{a as Kr,h as d,l as Dt,n as z,x as Ht,z as Nt}from"./chunk-CNVMLXTH.js";import{c as x,f as ee,h as s,i as p,j as Wr,l as Ft,m as Buffer,n as a}from"./chunk-JORLGFWZ.js";var ue=x(Pe=>{"use strict";s();a();Object.defineProperty(Pe,"__esModule",{value:!0});Pe.AppAuthError=void 0;var xn=function(){function t(e,r){this.message=e,this.extras=r}return t}();Pe.AppAuthError=xn});var Se=x(L=>{"use strict";s();a();Object.defineProperty(L,"__esModule",{value:!0});L.DefaultCrypto=L.textEncodeLite=L.urlSafe=L.bufferToString=void 0;var wn=Wr(),pr=ue(),fr=typeof self<"u"&&!!self.crypto,bn=fr&&!!self.crypto.subtle,ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function dr(t){for(var e=[],r=0;r<t.byteLength;r+=1){var n=t[r]%ht.length;e.push(ht[n])}return e.join("")}L.bufferToString=dr;function lr(t){var e=wn.fromByteArray(new Uint8Array(t));return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}L.urlSafe=lr;function yr(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}L.textEncodeLite=yr;var Tn=function(){function t(){}return t.prototype.generateRandom=function(e){var r=new Uint8Array(e);if(fr)self.crypto.getRandomValues(r);else for(var n=0;n<e;n+=1)r[n]=Math.random()*ht.length|0;return dr(r)},t.prototype.deriveChallenge=function(e){return e.length<43||e.length>128?Promise.reject(new pr.AppAuthError("Invalid code length.")):bn?new Promise(function(r,n){self.crypto.subtle.digest("SHA-256",yr(e)).then(function(o){return r(lr(new Uint8Array(o)))},function(o){return n(o)})}):Promise.reject(new pr.AppAuthError("window.crypto.subtle is unavailable."))},t}();L.DefaultCrypto=Tn});var pt=x(_=>{"use strict";s();a();Object.defineProperty(_,"__esModule",{value:!0});_.IS_PROFILE=_.IS_LOG=_.setFlag=_.Flags=void 0;_.Flags={IS_LOG:!0,IS_PROFILE:!1};function En(t,e){_.Flags[t]=e}_.setFlag=En;_.IS_LOG=_.Flags.IS_LOG,_.IS_PROFILE=_.Flags.IS_PROFILE});var ge=x(N=>{"use strict";s();a();var ft=N&&N.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(N,"__esModule",{value:!0});N.profile=N.log=void 0;var gr=pt();function dt(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(gr.Flags.IS_LOG){var n=e?e.length:0;n>0?console.log.apply(console,ft([t],e,!1)):console.log(t)}}N.log=dt;var vn=typeof self<"u"&&!!self.performance&&!!console.profile;function _n(t,e,r){return gr.Flags.IS_PROFILE?Rn(t,e,r):r}N.profile=_n;function Rn(t,e,r){var n=r.value,o=n.name;return o||(o="anonymous function"),vn?r.value=function(i){console.profile(o);var u=self.performance.now(),c=n.call.apply(n,ft([this||self],i,!1)),h=self.performance.now()-u;return console.log("".concat(o," took ").concat(h," ms")),console.profileEnd(),c}:r.value=function(i){dt("Profile start ".concat(o));var u=Date.now(),c=n.call.apply(n,ft([this||self],i,!1)),h=Date.now()-u;return dt("Profile end ".concat(o," took ").concat(h," ms.")),c},r}});var lt=x(Le=>{"use strict";s();a();Object.defineProperty(Le,"__esModule",{value:!0});Le.AuthorizationRequest=void 0;var kn=Se(),Un=ge(),In=10,Pn=function(t){return t.generateRandom(In)},Sn=function(){function t(e,r,n){r===void 0&&(r=new kn.DefaultCrypto),n===void 0&&(n=!0),this.crypto=r,this.usePkce=n,this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.scope=e.scope,this.responseType=e.response_type||t.RESPONSE_TYPE_CODE,this.state=e.state||Pn(r),this.extras=e.extras,this.internal=e.internal}return t.prototype.setupCodeVerifier=function(){var e=this;if(this.usePkce){var r=this.crypto.generateRandom(128),n=this.crypto.deriveChallenge(r).catch(function(o){(0,Un.log)("Unable to generate PKCE challenge. Not using PKCE",o)});return n.then(function(o){o&&(e.internal=e.internal||{},e.internal.code_verifier=r,e.extras=e.extras||{},e.extras.code_challenge=o,e.extras.code_challenge_method="S256")})}else return Promise.resolve()},t.prototype.toJson=function(){var e=this;return this.setupCodeVerifier().then(function(){return{response_type:e.responseType,client_id:e.clientId,redirect_uri:e.redirectUri,scope:e.scope,state:e.state,extras:e.extras,internal:e.internal}})},t.RESPONSE_TYPE_TOKEN="token",t.RESPONSE_TYPE_CODE="code",t}();Le.AuthorizationRequest=Sn});var mr=x(Oe=>{"use strict";s();a();Object.defineProperty(Oe,"__esModule",{value:!0});Oe.requireValidUrl=void 0;var Ln=ue();function On(t){try{return new URL(t),t}catch{throw new Ln.AppAuthError("Invalid input url ".concat(t))}}Oe.requireValidUrl=On});var gt=x(C=>{"use strict";s();a();Object.defineProperty(C,"__esModule",{value:!0});C.AuthorizationRequestHandler=C.BUILT_IN_PARAMETERS=C.AuthorizationNotifier=void 0;var yt=ge(),Cn=mr(),qn=function(){function t(){this.listener=null}return t.prototype.setAuthorizationListener=function(e){this.listener=e},t.prototype.onAuthorizationComplete=function(e,r,n){this.listener&&this.listener(e,r,n)},t}();C.AuthorizationNotifier=qn;C.BUILT_IN_PARAMETERS=["redirect_uri","client_id","response_type","state","scope"];var Bn=function(){function t(e,r){this.utils=e,this.crypto=r,this.notifier=null}return t.prototype.buildRequestUrl=function(e,r){var n={redirect_uri:r.redirectUri,client_id:r.clientId,response_type:r.responseType,state:r.state,scope:r.scope};if(r.extras)for(var o in r.extras)r.extras.hasOwnProperty(o)&&C.BUILT_IN_PARAMETERS.indexOf(o)<0&&(n[o]=r.extras[o]);var i=this.utils.stringify(n),u=(0,Cn.requireValidUrl)(e.authorizationEndpoint),c="".concat(u,"?").concat(i);return c},t.prototype.completeAuthorizationRequestIfPossible=function(){var e=this;return(0,yt.log)("Checking to see if there is an authorization response to be delivered."),this.notifier||(0,yt.log)(`Notifier is not present on AuthorizationRequest handler.
          No delivery of result will be possible`),this.completeAuthorizationRequest().then(function(r){r||(0,yt.log)("No result is available yet."),r&&e.notifier&&e.notifier.onAuthorizationComplete(r.request,r.response,r.error)})},t.prototype.setAuthorizationNotifier=function(e){return this.notifier=e,this},t}();C.AuthorizationRequestHandler=Bn});var mt=x(ce=>{"use strict";s();a();Object.defineProperty(ce,"__esModule",{value:!0});ce.AuthorizationError=ce.AuthorizationResponse=void 0;var Fn=function(){function t(e){this.code=e.code,this.state=e.state}return t.prototype.toJson=function(){return{code:this.code,state:this.state}},t}();ce.AuthorizationResponse=Fn;var Dn=function(){function t(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri,this.state=e.state}return t.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri,state:this.state}},t}();ce.AuthorizationError=Dn});var qe=x(k=>{"use strict";s();a();var xt=k&&k.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(k,"__esModule",{value:!0});k.TestRequestor=k.FetchRequestor=k.JQueryRequestor=k.Requestor=void 0;var At=ue(),Ce=function(){function t(){}return t}();k.Requestor=Ce;var Hn=function(t){xt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.xhr=function(r){var n=$.ajax(r);return new Promise(function(o,i){n.then(function(u,c,h){o(u)},function(u,c,h){i(new At.AppAuthError(h))})})},e}(Ce);k.JQueryRequestor=Hn;var Nn=function(t){xt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.xhr=function(r){if(!r.url)return Promise.reject(new At.AppAuthError("A URL must be provided."));var n=new URL(r.url),o={};if(o.method=r.method,o.mode="cors",r.data)if(r.method&&r.method.toUpperCase()==="POST")o.body=r.data;else{var i=new URLSearchParams(r.data);i.forEach(function(h,l){n.searchParams.append(l,h)})}if(o.headers={},r.headers)for(var u in r.headers)r.headers.hasOwnProperty(u)&&(o.headers[u]=r.headers[u]);var c=r.dataType&&r.dataType.toLowerCase()==="json";return c&&(o.headers.Accept="application/json, text/javascript, */*; q=0.01"),fetch(n.toString(),o).then(function(h){if(h.status>=200&&h.status<300){var l=h.headers.get("content-type");return c||l&&l.indexOf("application/json")!==-1?h.json():h.text()}else return Promise.reject(new At.AppAuthError(h.status.toString(),h.statusText))})},e}(Ce);k.FetchRequestor=Nn;var jn=function(t){xt(e,t);function e(r){var n=t.call(this)||this;return n.promise=r,n}return e.prototype.xhr=function(r){return this.promise},e}(Ce);k.TestRequestor=jn});var Ar=x(Be=>{"use strict";s();a();Object.defineProperty(Be,"__esModule",{value:!0});Be.AuthorizationServiceConfiguration=void 0;var Mn=qe(),Wn=".well-known",Kn="openid-configuration",Jn=function(){function t(e){this.authorizationEndpoint=e.authorization_endpoint,this.tokenEndpoint=e.token_endpoint,this.revocationEndpoint=e.revocation_endpoint,this.userInfoEndpoint=e.userinfo_endpoint,this.endSessionEndpoint=e.end_session_endpoint}return t.prototype.toJson=function(){return{authorization_endpoint:this.authorizationEndpoint,token_endpoint:this.tokenEndpoint,revocation_endpoint:this.revocationEndpoint,end_session_endpoint:this.endSessionEndpoint,userinfo_endpoint:this.userInfoEndpoint}},t.fetchFromIssuer=function(e,r){var n="".concat(e,"/").concat(Wn,"/").concat(Kn),o=r||new Mn.JQueryRequestor;return o.xhr({url:n,dataType:"json",method:"GET"}).then(function(i){return new t(i)})},t}();Be.AuthorizationServiceConfiguration=Jn});var De=x(Fe=>{"use strict";s();a();Object.defineProperty(Fe,"__esModule",{value:!0});Fe.BasicQueryStringUtils=void 0;var zn=function(){function t(){}return t.prototype.parse=function(e,r){return r?this.parseQueryString(e.hash):this.parseQueryString(e.search)},t.prototype.parseQueryString=function(e){var r={};e=e.trim().replace(/^(\?|#|&)/,"");for(var n=e.split("&"),o=0;o<n.length;o+=1){var i=n[o],u=i.split("=");if(u.length>=2){var c=decodeURIComponent(u.shift()),h=u.length>0?u.join("="):null;h&&(r[c]=decodeURIComponent(h))}}return r},t.prototype.stringify=function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&e[n]&&r.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e[n])));return r.join("&")},t}();Fe.BasicQueryStringUtils=zn});var wt=x(j=>{"use strict";s();a();var Qn=j&&j.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(j,"__esModule",{value:!0});j.LocalStorageBackend=j.StorageBackend=void 0;var xr=function(){function t(){}return t}();j.StorageBackend=xr;var $n=function(t){Qn(e,t);function e(r){var n=t.call(this)||this;return n.storage=r||self.localStorage,n}return e.prototype.getItem=function(r){var n=this;return new Promise(function(o,i){var u=n.storage.getItem(r);o(u||null)})},e.prototype.removeItem=function(r){var n=this;return new Promise(function(o,i){n.storage.removeItem(r),o()})},e.prototype.clear=function(){var r=this;return new Promise(function(n,o){r.storage.clear(),n()})},e.prototype.setItem=function(r,n){var o=this;return new Promise(function(i,u){o.storage.setItem(r,n),i()})},e}(xr);j.LocalStorageBackend=$n});var Tr=x(he=>{"use strict";s();a();var Vn=he&&he.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(he,"__esModule",{value:!0});he.RedirectRequestHandler=void 0;var Gn=lt(),Yn=gt(),wr=mt(),Xn=Se(),He=ge(),Zn=De(),eo=wt(),bt=function(t){return"".concat(t,"_appauth_authorization_request")},br=function(t){return"".concat(t,"_appauth_authorization_service_configuration")},Tt="appauth_current_authorization_request",to=function(t){Vn(e,t);function e(r,n,o,i){r===void 0&&(r=new eo.LocalStorageBackend),n===void 0&&(n=new Zn.BasicQueryStringUtils),o===void 0&&(o=self.location),i===void 0&&(i=new Xn.DefaultCrypto);var u=t.call(this,n,i)||this;return u.storageBackend=r,u.locationLike=o,u}return e.prototype.performAuthorizationRequest=function(r,n){var o=this,i=this.crypto.generateRandom(10),u=Promise.all([this.storageBackend.setItem(Tt,i),n.toJson().then(function(c){return o.storageBackend.setItem(bt(i),JSON.stringify(c))}),this.storageBackend.setItem(br(i),JSON.stringify(r.toJson()))]);u.then(function(){var c=o.buildRequestUrl(r,n);(0,He.log)("Making a request to ",n,c),o.locationLike.assign(c)})},e.prototype.completeAuthorizationRequest=function(){var r=this;return this.storageBackend.getItem(Tt).then(function(n){return n?r.storageBackend.getItem(bt(n)).then(function(o){return JSON.parse(o)}).then(function(o){return new Gn.AuthorizationRequest(o)}).then(function(o){var i="".concat(r.locationLike.origin).concat(r.locationLike.pathname),u=r.utils.parse(r.locationLike,!0),c=u.state,h=u.code,l=u.error;(0,He.log)("Potential authorization request ",i,u,c,h,l);var y=c===o.state,f=null,m=null;if(y){if(l){var A=u.error_uri,T=u.error_description;m=new wr.AuthorizationError({error:l,error_description:T,error_uri:A,state:c})}else f=new wr.AuthorizationResponse({code:h,state:c});return Promise.all([r.storageBackend.removeItem(Tt),r.storageBackend.removeItem(bt(n)),r.storageBackend.removeItem(br(n))]).then(function(){return(0,He.log)("Delivering authorization response"),{request:o,response:f,error:m}})}else return(0,He.log)("Mismatched request (state and request_uri) dont match."),Promise.resolve(null)}):null})},e}(Yn.AuthorizationRequestHandler);he.RedirectRequestHandler=to});var Er=x(Ne=>{"use strict";s();a();Object.defineProperty(Ne,"__esModule",{value:!0});Ne.RevokeTokenRequest=void 0;var ro=function(){function t(e){this.token=e.token,this.tokenTypeHint=e.token_type_hint,this.clientId=e.client_id,this.clientSecret=e.client_secret}return t.prototype.toJson=function(){var e={token:this.token};return this.tokenTypeHint&&(e.token_type_hint=this.tokenTypeHint),this.clientId&&(e.client_id=this.clientId),this.clientSecret&&(e.client_secret=this.clientSecret),e},t.prototype.toStringMap=function(){var e=this.toJson();return e},t}();Ne.RevokeTokenRequest=ro});var vr=x(M=>{"use strict";s();a();Object.defineProperty(M,"__esModule",{value:!0});M.TokenRequest=M.GRANT_TYPE_REFRESH_TOKEN=M.GRANT_TYPE_AUTHORIZATION_CODE=void 0;M.GRANT_TYPE_AUTHORIZATION_CODE="authorization_code";M.GRANT_TYPE_REFRESH_TOKEN="refresh_token";var no=function(){function t(e){this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.grantType=e.grant_type,this.code=e.code,this.refreshToken=e.refresh_token,this.extras=e.extras}return t.prototype.toJson=function(){return{grant_type:this.grantType,code:this.code,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,client_id:this.clientId,extras:this.extras}},t.prototype.toStringMap=function(){var e={grant_type:this.grantType,client_id:this.clientId,redirect_uri:this.redirectUri};if(this.code&&(e.code=this.code),this.refreshToken&&(e.refresh_token=this.refreshToken),this.extras)for(var r in this.extras)this.extras.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=this.extras[r]);return e},t}();M.TokenRequest=no});var Et=x(O=>{"use strict";s();a();Object.defineProperty(O,"__esModule",{value:!0});O.TokenError=O.TokenResponse=O.nowInSeconds=void 0;var oo=10*60*-1,io=function(){return Math.round(new Date().getTime()/1e3)};O.nowInSeconds=io;var so=function(){function t(e){this.accessToken=e.access_token,this.tokenType=e.token_type||"bearer",e.expires_in&&(this.expiresIn=parseInt(e.expires_in,10)),this.refreshToken=e.refresh_token,this.scope=e.scope,this.idToken=e.id_token,this.issuedAt=e.issued_at||(0,O.nowInSeconds)()}return t.prototype.toJson=function(){var e;return{access_token:this.accessToken,id_token:this.idToken,refresh_token:this.refreshToken,scope:this.scope,token_type:this.tokenType,issued_at:this.issuedAt,expires_in:(e=this.expiresIn)===null||e===void 0?void 0:e.toString()}},t.prototype.isValid=function(e){if(e===void 0&&(e=oo),this.expiresIn){var r=(0,O.nowInSeconds)();return r<this.issuedAt+this.expiresIn+e}else return!0},t}();O.TokenResponse=so;var ao=function(){function t(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri}return t.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri}},t}();O.TokenError=ao});var Rr=x(je=>{"use strict";s();a();Object.defineProperty(je,"__esModule",{value:!0});je.BaseTokenRequestHandler=void 0;var uo=ue(),co=De(),_r=Et(),ho=qe(),po=function(){function t(e,r){e===void 0&&(e=new ho.JQueryRequestor),r===void 0&&(r=new co.BasicQueryStringUtils),this.requestor=e,this.utils=r}return t.prototype.isTokenResponse=function(e){return e.error===void 0},t.prototype.performRevokeTokenRequest=function(e,r){var n=this.requestor.xhr({url:e.revocationEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(r.toStringMap())});return n.then(function(o){return!0})},t.prototype.performTokenRequest=function(e,r){var n=this,o=this.requestor.xhr({url:e.tokenEndpoint,method:"POST",dataType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(r.toStringMap())});return o.then(function(i){return n.isTokenResponse(i)?new _r.TokenResponse(i):Promise.reject(new uo.AppAuthError(i.error,new _r.TokenError(i)))})},t}();je.BaseTokenRequestHandler=po});var Ur=x(kr=>{"use strict";s();a();Object.defineProperty(kr,"__esModule",{value:!0})});var vt=x(g=>{"use strict";s();a();var fo=g&&g.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),b=g&&g.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&fo(e,t,r)};Object.defineProperty(g,"__esModule",{value:!0});b(lt(),g);b(gt(),g);b(mt(),g);b(Ar(),g);b(Se(),g);b(ue(),g);b(pt(),g);b(ge(),g);b(De(),g);b(Tr(),g);b(Er(),g);b(wt(),g);b(vr(),g);b(Rr(),g);b(Et(),g);b(Ur(),g);b(qe(),g)});s();a();var re=ee(Kr()),Mt=(0,re.createContext)(null);function zr({children:t,authRepository:e}){return re.default.createElement(Mt.Provider,{value:e},t)}function F(){let t=(0,re.useContext)(Mt);if(!t)throw new Error("useAuthRepository must be used within an AuthProvider");return t}function S(){return F().useUser()}s();a();s();a();var ut=ee(Ft());s();a();var Ze="https://phantom.app",et="https://api.phantom.app/oauth2/auth",Te={prod:"a61bc25e-0c4f-4ab3-aa54-b50ec746eea2",staging:"fe26708b-7db7-4146-9fbb-9a9736acfb2b"},Ee={prod:"https://auth.phantom.app",staging:"https://staging-auth.phantom.app"},Wt="/login/start",Kt="/oauth2/token";var Qr="https://help.phantom.com/hc/en-us/articles/32367778944403";var Jt=de({minutes:60})-de({minutes:15}),Q="/v1/authentication-keys";s();a();var ne=t=>Buffer.from(t).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");s();a();s();a();s();a();s();a();var zt=null;function $r(t){zt=t}function Qt(){return zt}function $t(t){let e=Qt();if(e){let r=new Headers(t);return r.set("X-Phantom-AnonymousId",e),r}return t}s();a();var tt=null;function rt(t){tt=t}async function Vt(){if(!tt)throw new Error("No fetch bearer token function registered. Register one with registerFetchBearerToken().");return await tt()}s();a();s();a();function Gt(...t){let e=new AbortController;for(let r of t){let n=r instanceof AbortController?r.signal:r;if(n?.aborted)return e.abort(n.reason),e.signal;n?.addEventListener("abort",()=>{e.abort(n.reason)},{once:!0})}return e.signal}var Vr=2*60*1e3,Gr=[];function Yt(t,e){let{fetchTimeout:r,retryDelays:n,...o}=e||{},i=e?.fetchTimeout??Vr,u=e?.retryDelays??Gr,c=0,h=0;return new Promise((l,y)=>{function f(){c++,h=Date.now();let T=!0,w=new AbortController,Xe=fetch(t,{...o,signal:Gt(...o.signal?[o.signal,w.signal]:[w.signal])}),Bt=setTimeout(()=>{w.abort(),T=!1,A(c)?m():y(new Error(`fetchWithTimeoutAndRetry(): Failed to get response from server due to timeout of ${i} ms, tried ${c} times.`))},i);Xe.then(J=>{clearTimeout(Bt),T&&(J.status>=200&&J.status<300?l(J):A(c,J.status)?m():l(J))}).catch(J=>{clearTimeout(Bt),A(c)?m():y(J)})}function m(){let T=u[c-1],w=h+T;setTimeout(f,Math.max(w-Date.now(),0))}function A(T,w){let Xe=w?w>=400&&w<=499:!1;return T<=u.length&&!Xe}f()})}s();a();var ve=(t={},e={})=>{let r=new Headers(t),n=new Headers(e);for(let[o,i]of n.entries())i===void 0||i==="undefined"?r.delete(o):r.set(o,i);return r};s();a();var se=ee(Ft());s();a();s();a();function Xt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function nt(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Zt(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Xt(t.outputLen),Xt(t.blockLen)}function oe(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function er(t,e){nt(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}s();a();s();a();var _e=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var tr=t=>t instanceof Uint8Array;var Re=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),I=(t,e)=>t<<32-e|t>>>e,Yr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Yr)throw new Error("Non little-endian hardware is not supported");function Xr(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function le(t){if(typeof t=="string"&&(t=Xr(t)),!tr(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Pi(...t){let e=new Uint8Array(t.reduce((n,o)=>n+o.length,0)),r=0;return t.forEach(n=>{if(!tr(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}var ie=class{clone(){return this._cloneInto()}},Si={}.toString;function rr(t){let e=n=>t().update(le(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Li(t=32){if(_e&&typeof _e.getRandomValues=="function")return _e.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}var ke=class extends ie{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Zt(e);let n=le(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let u=0;u<i.length;u++)i[u]^=54;this.iHash.update(i),this.oHash=e.create();for(let u=0;u<i.length;u++)i[u]^=106;this.oHash.update(i),i.fill(0)}update(e){return oe(this),this.iHash.update(e),this}digestInto(e){oe(this),nt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:i,blockLen:u,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=u,e.outputLen=c,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ot=(t,e,r)=>new ke(t,e).update(r).digest();ot.create=(t,e)=>new ke(t,e);s();a();s();a();function Zr(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),i=BigInt(4294967295),u=Number(r>>o&i),c=Number(r&i),h=n?4:0,l=n?0:4;t.setUint32(e+h,u,n),t.setUint32(e+l,c,n)}var Ue=class extends ie{constructor(e,r,n,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Re(this.buffer)}update(e){oe(this);let{view:r,buffer:n,blockLen:o}=this;e=le(e);let i=e.length;for(let u=0;u<i;){let c=Math.min(o-this.pos,i-u);if(c===o){let h=Re(e);for(;o<=i-u;u+=o)this.process(h,u);continue}n.set(e.subarray(u,u+c),this.pos),this.pos+=c,u+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oe(this),er(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:u}=this;r[u++]=128,this.buffer.subarray(u).fill(0),this.padOffset>o-u&&(this.process(n,0),u=0);for(let f=u;f<o;f++)r[f]=0;Zr(n,o-8,BigInt(this.length*8),i),this.process(n,0);let c=Re(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=h/4,y=this.get();if(l>y.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)c.setUint32(4*f,y[f],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:u,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=u,o%r&&e.buffer.set(n),e}};var en=(t,e,r)=>t&e^~t&r,tn=(t,e,r)=>t&e^t&r^e&r,rn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),D=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),H=new Uint32Array(64),it=class extends Ue{constructor(){super(64,32,8,!1),this.A=D[0]|0,this.B=D[1]|0,this.C=D[2]|0,this.D=D[3]|0,this.E=D[4]|0,this.F=D[5]|0,this.G=D[6]|0,this.H=D[7]|0}get(){let{A:e,B:r,C:n,D:o,E:i,F:u,G:c,H:h}=this;return[e,r,n,o,i,u,c,h]}set(e,r,n,o,i,u,c,h){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=u|0,this.G=c|0,this.H=h|0}process(e,r){for(let f=0;f<16;f++,r+=4)H[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){let m=H[f-15],A=H[f-2],T=I(m,7)^I(m,18)^m>>>3,w=I(A,17)^I(A,19)^A>>>10;H[f]=w+H[f-7]+T+H[f-16]|0}let{A:n,B:o,C:i,D:u,E:c,F:h,G:l,H:y}=this;for(let f=0;f<64;f++){let m=I(c,6)^I(c,11)^I(c,25),A=y+m+en(c,h,l)+rn[f]+H[f]|0,w=(I(n,2)^I(n,13)^I(n,22))+tn(n,o,i)|0;y=l,l=h,h=c,c=u+A|0,u=i,i=o,o=n,n=A+w|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,u=u+this.D|0,c=c+this.E|0,h=h+this.F|0,l=l+this.G|0,y=y+this.H|0,this.set(n,o,i,u,c,h,l,y)}roundClean(){H.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var nr=rr(()=>new it);var nn=[86,120,48,81,89,86,110,49,100,114,111,113,49,70,56,84,77,115,80,81,66,75,72,51,90,83,110,100,110,116,68,88,107,118,83,53,102,80,114,89,111,88,85,75,57,43,67,57,97,103,74,113,68,76,112,112,100,48,102,101,80,122,83,111,108,113,75,90,56,114,66,70,119,87,84,104,98,57,110,119,43,79,70,51,51,65,61,61],on=[87,67,49,81,97,71,70,117,100,71,57,116,81,88,86,48,97,70,82,118,97,50,86,117],sn=[87,67,49,81,97,71,70,117,100,71,57,116,84,109,57,117,89,50,85,61];function an(t){let e=new URL(t);return e.pathname+e.search}function or(t,e){let r=an(t),n=JSON.stringify(Math.floor(Date.now()/1e3)),o=r+n,i=ot(nr,se.Buffer.from(String.fromCharCode(...nn)),se.Buffer.from(o)),u=new Headers(e);return u.set(se.Buffer.from(String.fromCharCode(...on),"base64").toString(),encodeURIComponent(se.Buffer.from(i).toString("base64"))),u.set(se.Buffer.from(String.fromCharCode(...sn),"base64").toString(),n),u}var V=class extends Error{constructor(e,r){super(e),this.response=r}response},un={"Content-Type":"application/json","X-Phantom-Version":Ht,"X-Phantom-Platform":Nt},ae=async t=>{let e,r;try{r=await t.clone().blob()}catch{}try{e=await t.clone().json()}catch{}let{status:n,statusText:o}=t;return{blob:r,data:e,status:n,statusText:o}},st=class t{config;constructor(e={}){this.config={withClientAuth:!0,numRetries:0,delayBetweenEachRetryMs:0,timeoutMs:null,validateStatus:!1,headers:un,withApiEnvironment:"none",fetchBearerToken:!1,...e}}fetch=async(e,r={})=>{try{if(typeof e=="function"){let h=z()==="https://api.phantom.app"?"prod":"staging";e=e({apiEnv:h})}let n="";this.config.withApiEnvironment==="prod"?n="https://api.phantom.app":this.config.withApiEnvironment==="staging"?n="https://staging-api.phantom.app":this.config.withApiEnvironment==="default"?n=z():this.config.withApiEnvironment==="custom"&&this.config.customApiEnv&&(n=this.config.customApiEnv);let o=new URL(`${n}${e}`);r?.params&&(o.search=new URLSearchParams(r.params).toString());let i=r;r.headers=ve(this.config.headers,r.headers),r.headers=$t(r.headers),this.config.withClientAuth&&(r.headers=or(o.toString(),r.headers));let u=this.config.validateStatus;if(r?.validateStatus&&(u=r?.validateStatus),i.body&&typeof i.body!="string"&&(i.body=JSON.stringify(i.body)),this.config.timeoutMs&&(i.fetchTimeout=this.config.timeoutMs),this.config.numRetries&&(i.retryDelays=Array(this.config.numRetries).fill(this.config.delayBetweenEachRetryMs)),this.config.fetchBearerToken){let h=await Vt();if(h)i.headers=ve(i.headers,{authorization:`Bearer ${h}`});else throw new V("Unable to get bearer token. Full auth is required.")}let c=await Yt(o.toString(),i);if(u&&!c.ok)throw new V(`Request failed with status code ${c.status}`,await ae(c));return c}catch(n){throw n instanceof V?n:new V(n?.message,n?.response)}};auth(e){return new t({...this.config,withClientAuth:e})}bearer(e){return typeof e=="string"&&e?this.headers({authorization:`Bearer ${e}`}):typeof e=="boolean"&&e?new t({...this.config,fetchBearerToken:!0}):this}headers(e,r){let n=r?.mergeHeaders===!1?e:ve(this.config.headers,e);return new t({...this.config,headers:n})}timeout(e){return new t({...this.config,timeoutMs:e})}retry(e,r){return new t({...this.config,numRetries:e,delayBetweenEachRetryMs:r})}validateStatus(e){return new t({...this.config,validateStatus:e})}api(e="default",r){return new t({...this.config,withApiEnvironment:e,customApiEnv:e==="custom"?r:void 0})}async get(e,r={}){r.method="GET";let n=await this.fetch(e,r);return ae(n)}async post(e,r,n={}){n.method="POST";let o=await this.fetch(e,{...n,body:r});return ae(o)}async put(e,r,n={}){n.method="PUT";let o=await this.fetch(e,{...n,body:r});return ae(o)}async patch(e,r,n={}){n.method="PATCH";let o=await this.fetch(e,{...n,body:r});return ae(o)}async delete(e,r,n={}){n.method="DELETE";let o=await this.fetch(e,{...n,body:r});return ae(o)}},v=new st;function cn(t){if(t===void 0)throw new Error("rpcUrl undefined");return async(e,r)=>{let n={jsonrpc:"2.0",id:+new Date,method:e,params:r},i=(await v.post(t,n)).data;if("error"in i)throw new Error(JSON.stringify(i.error));return i.result}}async function hn(t,e={}){return v.fetch(t,e)}function ye(t){return t.status>199&&t.status<400}function pn(t){return t instanceof V}var fn="https://time.phantom.app/utc",dn=d.number().int().positive();async function at(){let t;try{let e=await v.get(fn);if(e.status!==200)throw new Error("Failed to fetch time from server");t=dn.parse(e.data)}catch{t=Date.now()}return Math.floor(t/1e3)}var ln=60,yn=()=>Math.floor(Date.now()/1e3);async function G(t=!0){let e={alg:"ES256",type:"JWT"},r=t?await at():yn(),n={iss:Ze,aud:et,nbf:r,exp:r+ln,iat:r};return{header:e,payload:n}}function Y(t){let e=ne(ut.Buffer.from(JSON.stringify(t.header))),r=ne(ut.Buffer.from(JSON.stringify(t.payload)));return[e,r,t.signature].join(".")}s();a();var sr=d.object({alg:d.string(),type:d.string(),kid:d.string()}),ar=d.object({sub:d.string(),iss:d.string(),aud:d.string(),nbf:d.number(),exp:d.number(),iat:d.number()}),gn=d.object({header:sr,payload:ar,signature:d.string()}),ur=d.object({alg:d.string(),type:d.string()}),cr=d.object({iss:d.string(),aud:d.string(),nbf:d.number(),exp:d.number(),iat:d.number()}),mn=d.object({header:ur,payload:cr}),ct=d.object({id_token:d.string(),access_token:d.string(),refresh_token:d.string(),scope:d.string(),token_type:d.string(),expires_in:d.number().gte(0)}),An=d.object({redirectTo:d.string()}),hr=d.object({at_hash:d.string(),aud:d.array(d.string()),auth_time:d.number(),exp:d.number(),iat:d.number(),iss:d.string(),jti:d.string(),rat:d.number(),sid:d.string(),sub:d.string(),email:d.string().optional()}),Ie=d.object({authenticationKeys:d.array(d.object({createdAt:d.string().datetime().nullish().default(null),updatedAt:d.string().datetime().nullish().default(null),id:d.string().uuid(),publicKey:d.string(),userId:d.string().uuid()})).optional()});s();a();var X=ee(vt());s();a();s();a();s();a();s();a();function _t(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function lo(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Ir(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function yo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");_t(t.outputLen),_t(t.blockLen)}function go(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function mo(t,e){Ir(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Ao={number:_t,bool:lo,bytes:Ir,hash:yo,exists:go,output:mo},Me=Ao;s();a();s();a();var xo={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Ke=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),P=(t,e)=>t<<32-e|t>>>e,wo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!wo)throw new Error("Non little-endian hardware is not supported");var Wa=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bo(t){if(typeof t!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof t}`);return new TextEncoder().encode(t)}function Rt(t){if(typeof t=="string"&&(t=bo(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}var We=class{clone(){return this._cloneInto()}};function kt(t){let e=n=>t().update(Rt(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function To(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),i=BigInt(4294967295),u=Number(r>>o&i),c=Number(r&i),h=n?4:0,l=n?0:4;t.setUint32(e+h,u,n),t.setUint32(e+l,c,n)}var Je=class extends We{constructor(e,r,n,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ke(this.buffer)}update(e){Me.exists(this);let{view:r,buffer:n,blockLen:o}=this;e=Rt(e);let i=e.length;for(let u=0;u<i;){let c=Math.min(o-this.pos,i-u);if(c===o){let h=Ke(e);for(;o<=i-u;u+=o)this.process(h,u);continue}n.set(e.subarray(u,u+c),this.pos),this.pos+=c,u+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Me.exists(this),Me.output(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:u}=this;r[u++]=128,this.buffer.subarray(u).fill(0),this.padOffset>o-u&&(this.process(n,0),u=0);for(let f=u;f<o;f++)r[f]=0;To(n,o-8,BigInt(this.length*8),i),this.process(n,0);let c=Ke(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=h/4,y=this.get();if(l>y.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)c.setUint32(4*f,y[f],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:u,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=u,o%r&&e.buffer.set(n),e}};var Eo=(t,e,r)=>t&e^~t&r,vo=(t,e,r)=>t&e^t&r^e&r,_o=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),W=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),K=new Uint32Array(64),ze=class extends Je{constructor(){super(64,32,8,!1),this.A=W[0]|0,this.B=W[1]|0,this.C=W[2]|0,this.D=W[3]|0,this.E=W[4]|0,this.F=W[5]|0,this.G=W[6]|0,this.H=W[7]|0}get(){let{A:e,B:r,C:n,D:o,E:i,F:u,G:c,H:h}=this;return[e,r,n,o,i,u,c,h]}set(e,r,n,o,i,u,c,h){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=u|0,this.G=c|0,this.H=h|0}process(e,r){for(let f=0;f<16;f++,r+=4)K[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){let m=K[f-15],A=K[f-2],T=P(m,7)^P(m,18)^m>>>3,w=P(A,17)^P(A,19)^A>>>10;K[f]=w+K[f-7]+T+K[f-16]|0}let{A:n,B:o,C:i,D:u,E:c,F:h,G:l,H:y}=this;for(let f=0;f<64;f++){let m=P(c,6)^P(c,11)^P(c,25),A=y+m+Eo(c,h,l)+_o[f]+K[f]|0,w=(P(n,2)^P(n,13)^P(n,22))+vo(n,o,i)|0;y=l,l=h,h=c,c=u+A|0,u=i,i=o,o=n,n=A+w|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,u=u+this.D|0,c=c+this.E|0,h=h+this.F|0,l=l+this.G|0,y=y+this.H|0,this.set(n,o,i,u,c,h,l,y)}roundClean(){K.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Ut=class extends ze{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Pr=kt(()=>new ze),eu=kt(()=>new Ut);var pe=ee(vt()),Sr=ee(Jr()),It={generateRandom:t=>{let e=(0,Sr.randomBytes)(t);return(0,pe.bufferToString)(e)},async deriveChallenge(t){let e=Pr((0,pe.textEncodeLite)(t));return(0,pe.urlSafe)(e)}};s();a();var U=()=>{let t=z();return t==="https://staging-api.phantom.app"?Ee.staging:t==="https://api.phantom.app"?Ee.prod:p.BASE_AUTH_ENDPOINT||Ee.staging},Pt=()=>`${U()}${Wt}`,Qe=()=>`${U()}${Kt}`;var Lr=new X.BasicQueryStringUtils;async function me(t,e){let{url:r,codeVerifier:n}=await Or(t.getClientID(),t.redirectURL,e),o=e.type==="email",i=await t.fetchAuthorizationCode(t.redirectURL,r,o);return await St({grantType:"authorization_code",clientID:t.getClientID(),redirectURI:t.redirectURL,tokenEndpoint:Qe(),code:i,codeVerifier:n})}async function Or(t,e,r){let n=Pt(),o,i=["openid","offline_access","user","incognito","seedless"],u;switch(r.type){case"key":{o={type:"key",jwt:Y(r.clientJWT)};break}case"email":{o={type:"email",provider:r.provider,existingAccessToken:r.existingAccessToken},u=r.prompt,i.push("email");break}case"session":{o={type:"session",existingAccessToken:r.existingAccessToken};break}}let h=await new X.AuthorizationRequest({client_id:t,redirect_uri:e,scope:i.join(" "),response_type:"code"},It).toJson(),l;switch(o.type){case"key":l=`jwt:${ne(Buffer.from(o.jwt,"utf8"))}`;break;case"email":l=`sso:${o.provider}`,o.existingAccessToken&&(l=`${l}:${o.existingAccessToken}`);break;case"session":l=`session:${o.existingAccessToken}`;break}let y={redirect_uri:h.redirect_uri,client_id:h.client_id,response_type:h.response_type,state:h.state??"",scope:h.scope,login_hint:l};u&&(y.prompt=u);let f=h.extras?.code_challenge,m=h.extras?.code_challenge_method,A=h.internal?.code_verifier;if(f&&m&&(y.code_challenge=f,y.code_challenge_method=m),!f||!m||!A)throw new Error("Missing code challenge or code verifier for PKCE.");let T=Lr.stringify(y);return{url:`${n}?${T}`,codeVerifier:A}}async function St(t){let{grantType:e,tokenEndpoint:r,clientID:n,redirectURI:o}=t,i;e==="authorization_code"?i=new X.TokenRequest({client_id:n,redirect_uri:o,grant_type:e,code:t.code,extras:{code_verifier:t.codeVerifier}}):i=new X.TokenRequest({client_id:n,redirect_uri:o,grant_type:e,refresh_token:t.refreshToken});let u=await v.headers({"Content-Type":"application/x-www-form-urlencoded"},{mergeHeaders:!1}).auth(Dt()).post(r,Lr.stringify(i.toStringMap()));Ro(u,e);let c=ct.safeParse(u.data);if(!c.success)throw new Error("Invalid OAuth2Token response.");let{data:h}=c;return{idToken:h.id_token,accessToken:h.access_token,refreshToken:h.refresh_token,scope:h.scope,tokenType:h.token_type,expiresAt:Date.now()+h.expires_in*1e3}}async function $e(t,e){return await St({clientID:t.getClientID(),redirectURI:t.redirectURL,grantType:"refresh_token",tokenEndpoint:Qe(),refreshToken:e})}function Ro(t,e){if([401,400].includes(t.status)){let r="";if(t.status===401)switch(r="Token Request Unauthorized (401): ",e){case"authorization_code":r+="Authorization code is expired or invalid.";break;case"refresh_token":r+="Refresh token is expired or invalid.";break;default:r+=`Unknown grant type [${e}]. `}if(t.status===400)switch(r="Bad Token Request (400): ",e){case"authorization_code":r="for [authorization_code]. Possible causes: 1. The authorization code is expired or invalid. 2. Redirect URI mismatch. 3. Code verifier mismatch (if using PKCE).";break;case"refresh_token":r="for [refresh_token]. Possible causes: 1. The refresh token is expired, invalid, or revoked. 2. Client ID mismatch. 3. Missing or malformed refresh token in the request.";break;default:r=`for unknown grant type [${e}]. Check the payload and OAuth provider documentation.`}throw new Error(r)}}s();a();s();a();s();a();var Ae=class{subscribers={};subscribe(e,r){return this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push(r),()=>{this.subscribers[e].splice(this.subscribers[e].indexOf(r),1)}}emitEvent(e,...r){(this.subscribers[e]??[]).forEach(o=>o(...r))}};var Ve=class extends Ae{emit(e){e&&(this.emitEvent("user",e),this.emitEvent("userID",e.userID),this.emitEvent("accessToken",e.accessToken),e.email&&this.emitEvent("email",e.email))}emitLoggedOut(){this.emitEvent("loggedOut")}};s();a();s();a();function q(t,e="expected value not found"){if(t==null)throw new Error(e);return t}function Cr(t,e="expected value not found"){if(!t)throw new Error(e)}var Ge=async(t,e)=>{let r=U(),n=q(t.signer,"Signer is required for key-based auth."),o=await n.getAuthenticationPublicKey(e),i=await G(t.isServerTimeEnabled()),u=await n.sign(i,e),c=await v.get(`${r}${Q}`,{params:{token:Y(u)}});if(!ye(c))throw new Error("Failed to get authentication keys: response is not okay");let h=c.data;return(Ie.parse(h).authenticationKeys??[]).some(f=>f.publicKey===o)};s();a();s();a();var qr=async t=>{try{let e=await v.headers({"Content-Type":"application/x-www-form-urlencoded"},{mergeHeaders:!1}).bearer(t).get(`${U()}/userinfo`);return ye(e)}catch{return!1}};s();a();var Lt=".phantom.auth",B=`${Lt}.tokens`,Br=`${Lt}.authentication-factors`,Uo=`${Lt}.email-provider`;s();a();s();a();var Fr=t=>Buffer.from(t.replace("-","+").replace("_","/").replace(/=+$/,""),"base64");var Z=t=>{let e=t.idToken.split(".");if(e.length!==3)throw new Error("Malformed ID token. Expected 3 period-delimited parts to ID token.");let r;try{let n=Fr(e[1]).toString("utf-8"),o=JSON.parse(n);r=hr.parse(o)}catch{throw new Error("Unable to parse ID token payload.")}return{accessToken:t.accessToken,userID:r.sub,email:r.email}};s();a();var Dr="@phantom/auth",R={user:["auth",`${Dr}:user`],authFactors:["auth",`${Dr}:user-auth-factors`]};s();a();var Ye=async(t,e,r)=>{let{storage:n,authConfig:o}=t,i,{type:u}=r;switch(u){case"key":{let h=q(t.signer,"Signer is required for key-based auth."),l=await G(t.isServerTimeEnabled()),y=await h.sign(l,r.secretIdentifier);i=await me(o,{type:u,clientJWT:y});break}case"email":{i=await me(o,{type:u,prompt:r.prompt,provider:r.provider});break}case"session":{i=await me(o,{type:u,existingAccessToken:r.accessToken});break}}await n.set(B,i);let c=Z(i);return await t.queryClient.setQueryData(R.user,c),e.emit(c),c};var Hr={queryKey:R.user,gcTime:Jt,staleTime:de({minutes:5})},fe=async(t,e)=>await t.queryClient.fetchQuery({...Hr,queryFn:()=>jr(t,e)}),Nr=(t,e)=>te({...Hr,queryFn:async()=>{let r=await jr(t,e);if(!r)throw new Error("Unable to log in.");return r},retryOnMount:!1}),jr=async(t,e)=>{let r=async()=>{let n=await Io(t);return n||(t.signer?await Po(t,e):null)};return t.runExclusive(async()=>{let n=await r();return e.emit(n),n})};async function Io({storage:t,authConfig:e}){let r=await t.get(B);if(!r)return null;if(await qr(r.accessToken))return Z(r);if(r.refreshToken)try{let n=await $e(e,r.refreshToken);return await t.set(B,n),Z(n)}catch(n){return E.addBreadcrumb("Error refreshing auth token.","Auth","error"),E.captureError(n,"Auth"),null}return null}async function Po(t,e){let n=await q(t.signer,"Unable to log in with key-based auth. Signer is not available.").getAllSecretIdentifiers();if(n.length===0)return E.addBreadcrumb("Unable to log in with key-based auth. Vault is not yet onboarded or has no secrets that can perform key-based auth.","Auth","info"),null;let o;try{for(let i of n)if(await Ge(t,i)){o=i;break}}catch(i){throw E.addBreadcrumb("Unable to log in with key-based auth. Error checking auth factors.","Auth","error"),i}if(!o)return E.addBreadcrumb("Unable to log in with key-based auth. No auth factor found for login.","Auth","info"),null;try{return await Ye(t,e,{type:"key",secretIdentifier:o})}catch(i){throw E.addBreadcrumb("Unable to log in with key-based auth. Error performing auth.","Auth","error"),i}}var So=t=>{let e=new Ve,r={getUser:()=>fe(t,e),useUser:()=>Nr(t,e),refreshTokens:()=>Lo(t),logIn:n=>Ye(t,e,n),isExistingAuthFactor:n=>Ge(t,n),getAuthenticationKeys:()=>Oo(t,e),getLocalAuthenticationPublicKeys:()=>Co(t),addAuthFactor:n=>qo(t,e,n),deleteAuthFactor:n=>Bo(t,e,n),deleteAllAuthFactors:()=>Fo(t,e),subscribe:(n,o)=>e.subscribe(n,o),logOut:()=>Do(t,e)};return rt(async()=>(await r.getUser())?.accessToken??null),r},Lo=async t=>{let e=await t.storage.get(B);if(!e)return!1;let r=await $e(t.authConfig,e.refreshToken);return await t.storage.set(B,r),await t.queryClient.setQueryData(R.user,Z(r)),!0},Oo=async(t,e)=>({authenticationPublicKeys:(await Mr(t,e)).map(n=>n.publicKey)}),Mr=async(t,e)=>{let r=U(),n=await fe(t,e);if(!n)throw new Error("User not authenticated.");let{data:o}=await v.bearer(n.accessToken).get(`${r}${Q}`),i=Ie.safeParse(o);if(!i.success)throw new Error("Unable to parse auth factors response.");return i.data.authenticationKeys??[]},Co=async t=>{try{let e=q(t.signer,"Signer is required for key-based auth."),r=await e.getAllSecretIdentifiers(),n={};for(let o of r)n[o]=await e.getAuthenticationPublicKey(o);return n}catch{return{}}},qo=async(t,e,{secretIdentifier:r})=>{let n=U(),o=q(t.signer,"Signer is required for key-based auth."),i=await fe(t,e);if(!i)throw new Error("User not authenticated.");let u=await G(t.isServerTimeEnabled()),c=await o.sign(u,r);await v.bearer(i.accessToken).post(`${n}${Q}`,{jwt:Y(c)})},Bo=async(t,e,{authenticationPublicKey:r})=>{let n=U(),o=await fe(t,e);if(!o)throw new Error("User not authenticated.");await v.bearer(o.accessToken).delete(`${n}${Q}/${encodeURIComponent(r)}`)},Fo=async(t,e)=>{let r=U(),n=t.storage,o=await fe(t,e);if(!o)throw new Error("User not authenticated.");let i=await Mr(t,e);await Promise.all(i.map(u=>v.bearer(o.accessToken).delete(`${r}${Q}/${u.id}`))),await n.remove(Br)},Do=async({storage:t},e)=>{await t.remove(B),e.emitLoggedOut()};s();a();var Ho=(t,e)=>{let r=new URL(e);if(!r.toString().startsWith(t))throw new Error("Unexpected redirectURL. RedirectURL from auth flow must match local redirect URL.");let n=r.searchParams.get("code");if(!n)throw new Error("No authorization code");return n};s();a();var No=(t,e)=>{let r=new URL(e);if(!r.toString().startsWith(t))throw new Error("Unexpected redirectURL. RedirectURL from auth flow must match local redirect URL.");let n=r.searchParams.get("error"),o=r.searchParams.get("error_description");if(n)throw new Error(`${n}: ${o}`,{cause:n});return!1};s();a();var jo=()=>z()==="https://api.phantom.app"?Te.prod:Te.staging;s();a();var Mo=()=>{let t=F(),{data:e}=S(),r=R.authFactors;return te({queryKey:r,queryFn:async()=>{let o=await t.getLocalAuthenticationPublicKeys();if(Object.keys(o).length===0)return{};let i=[];try{if(e){let{authenticationPublicKeys:c=[]}=await t.getAuthenticationKeys();i=c}}catch(c){c instanceof Error&&E.addBreadcrumb("Auth",`Unable to fetch existing AuthFactors for user (${e?.userID}): ${c.message}`,"error")}let u={};for(let[c,h]of Object.entries(o)){let l=i.includes(h);!l&&await t.isExistingAuthFactor(c)||(u[c]={authenticationPublicKey:h,isExistingAuthFactor:l})}return Object.keys(u).length===0&&E.addBreadcrumb("Auth",`Unable to build AuthFactors map: 
- user: ${e?.userID}
- locally available auth factors: ${Object.keys(o).length}
- auth factors registered with user: ${i.length}`,"error"),u},retryOnMount:!1})};s();a();s();a();var qt=()=>{let{data:t}=S();return!!t};function Wo(t,e){let r=qt(),n;return t.enabled===void 0?n=r:typeof t.enabled=="function"?n=o=>(Cr(typeof t.enabled=="function","expected enabled to be a function"),r&&t.enabled(o)):typeof t.enabled=="boolean"?n=r&&t.enabled:jt(t.enabled),te({...t,enabled:n},e)}s();a();s();a();var Ko=async t=>{await t.removeQueries({queryKey:R.user})},Jo=async t=>{await t.resetQueries({queryKey:R.user})},zo=async t=>{await t.invalidateQueries({queryKey:R.user})},xe=async t=>{await t.invalidateQueries({queryKey:R.authFactors})};var Qo=()=>{let t=we(),e=F(),r=async({secretIdentifier:n})=>{await e.addAuthFactor({secretIdentifier:n}),await xe(t)};return be({mutationFn:async n=>{try{return await r(n)}catch(o){E.addBreadcrumb("Auth",`Could not add auth factor: ${n.secretIdentifier}`,"error");let i;throw o instanceof Error?i=o:i=new Error(`Could not add auth factor: ${n.secretIdentifier}`),E.captureError(i,"Auth"),i}}})};s();a();var $o=()=>{let t=we(),e=F(),r=async({authenticationPublicKey:n})=>{await e.deleteAuthFactor({authenticationPublicKey:n}),await xe(t)};return be({mutationFn:async n=>{try{return await r(n)}catch(o){E.addBreadcrumb("Auth","Could not remove auth factor!","error");let i;throw o instanceof Error?i=o:i=new Error("Could not remove auth factor!"),E.captureError(i,"Auth"),i}}})};s();a();var Vo=()=>{let{data:t}=S();return t?.accessToken};s();a();s();a();var Go=()=>{let{data:t}=S();return t?.email};export{$r as a,Qt as b,Pi as c,rr as d,Li as e,ot as f,Ue as g,nr as h,v as i,cn as j,hn as k,ye as l,pn as m,Ze as n,et as o,Qr as p,ne as q,gn as r,mn as s,U as t,Ae as u,Uo as v,So as w,Ho as x,No as y,zr as z,F as A,S as B,jo as C,Mo as D,qt as E,Wo as F,Ko as G,Jo as H,zo as I,xe as J,Qo as K,$o as L,Vo as M,Go as N};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-RV6OM76W.js.map
