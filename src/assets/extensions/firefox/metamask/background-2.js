LavaPack.loadBundle([[2747,{"../snaps/Timer.cjs":2769,"../snaps/constants.cjs":2770,"./utils.cjs":2749,"@metamask/base-controller":1401,"@metamask/snaps-rpc-methods":2821,"@metamask/snaps-utils":2994,"@metamask/utils":3207,immer:4717,luxon:4951,nanoid:5139},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobController=n.DAILY_TIMEOUT=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-rpc-methods"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("immer"),h=e("luxon"),f=e("nanoid"),m=e("./utils.cjs"),g=e("../snaps/constants.cjs"),b=e("../snaps/Timer.cjs");n.DAILY_TIMEOUT=(0,d.inMilliseconds)(24,d.Duration.Hour);const y="CronjobController";var w=new WeakMap,v=new WeakMap,S=new WeakMap,_=new WeakSet,E=new WeakMap,k=new WeakMap,T=new WeakMap,P=new WeakMap,A=new WeakMap;class I extends c.BaseController{constructor({messenger:e,state:t,stateManager:c}){var l,u;super({messenger:e,metadata:{events:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!1}},name:y,state:{events:{},...t,...c.getInitialState()}}),r(l=this,u=_),u.add(l),s(this,w,void 0),s(this,v,void 0),s(this,S,new b.Timer(n.DAILY_TIMEOUT)),s(this,E,e=>{this.unregister(e.id),this.register(e.id)}),s(this,k,e=>{const t=this.get(e.id);o(_,this,L).call(this,t),this.register(e.id)}),s(this,T,e=>{this.unregister(e.id)}),s(this,P,e=>{this.unregister(e.id)}),s(this,A,e=>{this.unregister(e.id),this.register(e.id)}),a(w,this,new Map),a(v,this,c),this.messenger.subscribe("SnapController:snapInstalled",i(E,this)),this.messenger.subscribe("SnapController:snapUninstalled",i(T,this)),this.messenger.subscribe("SnapController:snapEnabled",i(k,this)),this.messenger.subscribe("SnapController:snapDisabled",i(P,this)),this.messenger.subscribe("SnapController:snapUpdated",i(A,this)),this.messenger.registerActionHandler(`${y}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${y}:schedule`,(...e)=>this.schedule(...e)),this.messenger.registerActionHandler(`${y}:cancel`,(...e)=>this.cancel(...e)),this.messenger.registerActionHandler(`${y}:get`,(...e)=>this.get(...e))}init(){o(_,this,j).call(this),o(_,this,$).call(this),o(_,this,L).call(this)}schedule(e){return o(_,this,O).call(this,{...e,recurring:!1})}cancel(e,t){(0,d.assert)(this.state.events[t],`A background event with the id of "${t}" does not exist.`),(0,d.assert)(this.state.events[t].snapId===e,"Only the origin that scheduled this event can cancel it."),o(_,this,x).call(this,t)}get(e){return Object.values(this.state.events).filter(t=>t.snapId===e&&!t.recurring).map(e=>({...e,date:(0,u.toCensoredISO8601String)(e.date),scheduledAt:(0,u.toCensoredISO8601String)(e.scheduledAt)}))}register(e){const t=o(_,this,N).call(this,e);null==t||t.forEach(e=>o(_,this,O).call(this,e))}unregister(e){for(const[t,n]of Object.entries(this.state.events))n.snapId===e&&o(_,this,x).call(this,t)}destroy(){super.destroy(),this.messenger.unsubscribe("SnapController:snapInstalled",i(E,this)),this.messenger.unsubscribe("SnapController:snapUninstalled",i(T,this)),this.messenger.unsubscribe("SnapController:snapEnabled",i(k,this)),this.messenger.unsubscribe("SnapController:snapDisabled",i(P,this)),this.messenger.unsubscribe("SnapController:snapUpdated",i(A,this)),i(w,this).forEach(e=>e.cancel()),i(w,this).clear(),"running"===i(S,this).status&&i(S,this).cancel()}}function j(){a(S,this,new b.Timer(n.DAILY_TIMEOUT)),i(S,this).start(()=>{o(_,this,L).call(this),o(_,this,j).call(this)})}function O(e){const t=e.id??(0,f.nanoid)(),n={...e,id:t,date:(0,m.getExecutionDate)(e.schedule),scheduledAt:(new Date).toISOString()},{nextState:s}=this.update(e=>{e.events[n.id]=(0,p.castDraft)(n)});return i(v,this).set(s),o(_,this,M).call(this,n),t}function M(e,t=!0){if(!t)return void o(_,this,R).call(this,e);const n=(0,m.getExecutionDate)(e.schedule),{nextState:s}=this.update(t=>{t.events[e.id].date=n});i(v,this).set(s),o(_,this,R).call(this,{...e,date:n})}function R(e){const t=h.DateTime.fromISO(e.date,{setZone:!0}).toMillis()-Date.now();if(t>n.DAILY_TIMEOUT)return;if(t<=0)return void o(_,this,C).call(this,e);const s=new b.Timer(t);s.start(()=>{o(_,this,C).call(this,e)}),i(w,this).set(e.id,s)}function C(e){if(this.messenger.call("SnapController:handleRequest",{snapId:e.snapId,origin:g.METAMASK_ORIGIN,handler:u.HandlerType.OnCronjob,request:e.request}).catch(t=>{(0,u.logError)(`An error occurred while executing an event for Snap "${e.snapId}":`,t)}),i(w,this).delete(e.id),!e.recurring){const{nextState:t}=this.update(t=>{delete t.events[e.id]});return void i(v,this).set(t)}o(_,this,M).call(this,e)}function x(e){const t=i(w,this).get(e);null==t||t.cancel(),i(w,this).delete(e);const{nextState:n}=this.update(t=>{delete t.events[e]});i(v,this).set(n)}function N(e){const t=this.messenger.call("PermissionController:getPermissions",e),n=null==t?void 0:t[l.SnapEndowments.Cronjob],s=(0,l.getCronjobCaveatJobs)(n);return s?s.map((t,n)=>({snapId:e,id:`cronjob-${e}-${n}`,request:t.request,schedule:(0,m.getCronjobSpecificationSchedule)(t),recurring:!0})):[]}function L(e=Object.values(this.state.events)){const t=Date.now();for(const n of e){if(i(w,this).has(n.id))continue;const e=h.DateTime.fromISO(n.date,{setZone:!0}).toUTC().toMillis();n.recurring&&e<=t?o(_,this,C).call(this,n):o(_,this,M).call(this,n,!1)}}function $(){const e=Date.now();for(const t of Object.values(this.state.events)){const n=h.DateTime.fromISO(t.date,{setZone:!0}).toUTC().toMillis();!t.recurring&&n<e&&o(_,this,x).call(this,t.id)}}n.CronjobController=I}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/CronjobController.cjs"}],[2748,{"./CronjobController.cjs":2747},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./CronjobController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/index.cjs"}],[2749,{"@metamask/utils":3207,"cron-parser":4281,luxon:4951},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getExecutionDate=n.getCronjobSpecificationSchedule=void 0;const s=e("@metamask/utils"),r=e("cron-parser"),i=e("luxon");n.getCronjobSpecificationSchedule=function(e){return(0,s.hasProperty)(e,"duration")?e.duration:e.expression},n.getExecutionDate=function(e){const t=i.DateTime.fromISO(e,{setZone:!0});if(t.isValid){const e=Date.now(),n=t.toUTC().startOf("second");if(n.toMillis()<e)throw new Error("Cannot schedule an event in the past.");return n.toISO({suppressMilliseconds:!0})}const n=i.Duration.fromISO(e);if(n.isValid){const e=function(e){return e.as("seconds")<1?i.Duration.fromObject({seconds:1}):e}(n);return i.DateTime.now().toUTC().plus(e).toISO()}try{const t=(0,r.parseExpression)(e,{utc:!0}).next(),n=i.DateTime.fromJSDate(t.toDate());return(0,s.assert)(n.isValid),n.toUTC().toISO()}catch{throw new Error(`Unable to parse "${e}" as ISO 8601 date, ISO 8601 duration, or cron expression.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/utils.cjs"}],[275,{"../../../../shared/lib/sentry":5992,"../../../../shared/modules/dapp-swap-comparison/dapp-swap-command-utils":6016,"../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils":6017,loglevel:4948},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesForConfirmation=function({req:e,fetchQuotes:t,setDappSwapComparisonData:n,getNetworkConfigurationByNetworkClientId:s,dappSwapMetricsFlag:l}){let u="";const d=String(e.id);try{const{enabled:o,bridge_quote_fees:p,origins:h}=l;if(!o)return;const{params:f,origin:m}=e;if(m&&h.includes(m)){const{chainId:o}=s(e.networkClientId)??{},{data:l,from:h}=c(f);if(l&&d&&o){const e=(0,a.parseTransactionData)(l);u=e.commands;const{quotesInput:s,amountMin:c}=(0,a.getDataFromSwap)(o,e.commandBytes,e.inputs);if(s){(0,a.checkValidSingleOrBatchTransaction)(f[0].calls,null==s?void 0:s.srcTokenAddress),n(d,{commands:u,swapInfo:{srcTokenAddress:null==s?void 0:s.srcTokenAddress,destTokenAddress:null==s?void 0:s.destTokenAddress,srcTokenAmount:null==s?void 0:s.srcTokenAmount,destTokenAmountMin:c}});const e=(new Date).getTime();t({...s,walletAddress:h,fee:p}).then(t=>{const s=(new Date).getTime();t&&n(d,{quotes:t,latency:s-e})}).catch(e=>{n(d,{error:`Error fetching bridge quotes: ${e.message}`,commands:u}),r.default.error("Error fetching dapp swap quotes",e),(0,i.captureException)(e)})}}}}catch(e){d&&n(d,{error:`Error fetching bridge quotes: ${e.message}`,commands:u}),e instanceof o.DappSwapDecodingError||(0,i.captureException)(e)}};var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("../../../../shared/lib/sentry"),a=e("../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils"),o=e("../../../../shared/modules/dapp-swap-comparison/dapp-swap-command-utils");const c=e=>{if(null==e||!e.length)return{data:undefined,from:undefined,chainId:undefined};const{calls:t,chainId:n,data:s,from:r}=e[0];let i=s;if(null!=t&&t.length){const e=null==t?void 0:t.find(({data:e})=>null==e?void 0:e.startsWith("0x3593564c"));e&&(i=null==e?void 0:e.data)}return{chainId:n,data:i,from:r}}}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-util.ts"}],[2750,{"@metamask/utils":3207,"@xstate/fsm":3681},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forceStrict=n.validateMachine=void 0;const s=e("@metamask/utils"),r=e("@xstate/fsm");n.validateMachine=function(e){(0,s.assert)("_options"in e,"The machine is not an @xstate/fsm machine");const t=e,n=new Set,r=e=>{return(t=e,Array.isArray(t)?t:t===undefined||null===t?[]:[t]).flatMap(e=>"string"==typeof e?[e]:((0,s.assert)("function"==typeof e),[])).forEach(n.add.bind(n));var t};for(const e of Object.values(t.config.states)){r(e.entry),r(e.exit);for(const t of Object.values(e.on??{}))r(t.actions)}n.forEach(e=>(0,s.assert)(t._options.actions!==undefined&&e in t._options.actions,`Action "${e}" doesn't have an implementation`))},n.forceStrict=function(e){let t=!1;e.subscribe(e=>{(0,s.assert)(!t||e.changed,"Invalid state transition"),t=!0});const n=e.send.bind(e);e.send=(...t)=>((0,s.assert)(e.status===r.InterpreterStatus.Running,"Interpreter is stopped"),n(...t))}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/fsm.cjs"}],[2751,{"./cronjob/index.cjs":2748,"./insights/index.cjs":2753,"./interface/index.cjs":2755,"./multichain/index.cjs":2759,"./services/index.cjs":2764,"./snaps/index.cjs":2771,"./utils.cjs":2781,"./websocket/index.cjs":2783},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./services/index.cjs"),n),r(e("./snaps/index.cjs"),n),r(e("./utils.cjs"),n),r(e("./cronjob/index.cjs"),n),r(e("./interface/index.cjs"),n),r(e("./insights/index.cjs"),n),r(e("./multichain/index.cjs"),n),r(e("./websocket/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/index.cjs"}],[2752,{"../snaps/index.cjs":2771,"@metamask/base-controller":1401,"@metamask/snaps-rpc-methods":2821,"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInsightsController=void 0;const i=e("@metamask/base-controller"),a=e("@metamask/snaps-rpc-methods"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("../snaps/index.cjs");var u=new WeakSet;class d extends i.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{insights:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}},name:"SnapInsightsController",state:{insights:{},...t}}),s(this,u),this.messenger.subscribe("TransactionController:unapprovedTransactionAdded",r(u,this,f).bind(this)),this.messenger.subscribe("TransactionController:transactionStatusUpdated",r(u,this,b).bind(this)),this.messenger.subscribe("SignatureController:stateChange",r(u,this,m).bind(this))}}function p(e){return(0,c.hasProperty)(this.state.insights,e)}function h(e){const t=this.messenger.call("SnapController:getAll");return(0,l.getRunnableSnaps)(t).reduce((t,n)=>{const s=this.messenger.call("PermissionController:getPermissions",n.id);return s&&(0,c.hasProperty)(s,e)&&t.push({snapId:n.id,permission:s[e]}),t},[])}function f(e){const{id:t,txParams:n,chainId:s,origin:i}=e,l=`eip155:${(0,c.hexToBigInt)(s).toString(10)}`;r(u,this,h).call(this,a.SnapEndowments.TransactionInsight).forEach(({snapId:e,permission:s})=>{const c=(0,a.getTransactionOriginCaveat)(s)&&i?i:null;this.update(n=>{var s;(s=n.insights)[t]??(s[t]={}),n.insights[t][e]={snapId:e,loading:!0}}),r(u,this,w).call(this,{snapId:e,handler:o.HandlerType.OnTransaction,params:{transaction:n,chainId:l,transactionOrigin:c}}).then(n=>r(u,this,v).call(this,{id:t,snapId:e,response:n})).catch(n=>r(u,this,v).call(this,{id:t,snapId:e,error:n}))})}function m(e){for(const t of Object.keys(this.state.insights))(0,c.hasProperty)(e.unapprovedTypedMessages,t)||(0,c.hasProperty)(e.unapprovedPersonalMsgs,t)||r(u,this,y).call(this,t);if(e.unapprovedPersonalMsgCount>0||e.unapprovedTypedMessagesCount>0){const t=r(u,this,h).call(this,a.SnapEndowments.SignatureInsight);for(const n of Object.values(e.unapprovedPersonalMsgs))r(u,this,g).call(this,t,n);for(const n of Object.values(e.unapprovedTypedMessages))r(u,this,g).call(this,t,n)}}function g(e,t){const{id:n,msgParams:s}=t;if(r(u,this,p).call(this,n))return;const{from:i,data:c,signatureMethod:l,origin:d}=s,h={from:i,data:"eth_signTypedData_v3"===l||"eth_signTypedData_v4"===l?JSON.parse(c):c,signatureMethod:l};e.forEach(({snapId:e,permission:t})=>{const s=(0,a.getSignatureOriginCaveat)(t),i=d&&s?d:null;this.update(t=>{var s;(s=t.insights)[n]??(s[n]={}),t.insights[n][e]={snapId:e,loading:!0}}),r(u,this,w).call(this,{snapId:e,handler:o.HandlerType.OnSignature,params:{signature:h,signatureOrigin:i}}).then(t=>r(u,this,v).call(this,{id:n,snapId:e,response:t})).catch(t=>r(u,this,v).call(this,{id:n,snapId:e,error:t}))})}function b({transactionMeta:e}){"unapproved"!==e.status&&r(u,this,y).call(this,e.id)}function y(e){r(u,this,p).call(this,e)&&(Object.values(this.state.insights[e]).filter(e=>e.interfaceId).forEach(e=>{this.messenger.call("SnapInterfaceController:deleteInterface",e.interfaceId)}),this.update(t=>{delete t.insights[e]}))}async function w({snapId:e,handler:t,params:n}){return this.messenger.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:t,request:{method:"",params:n}})}function v({id:e,snapId:t,response:n,error:s}){r(u,this,p).call(this,e)&&this.update(r=>{r.insights[e][t].loading=!1,r.insights[e][t].interfaceId=null==n?void 0:n.id,r.insights[e][t].severity=null==n?void 0:n.severity,r.insights[e][t].error=null==s?void 0:s.message})}n.SnapInsightsController=d}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/SnapInsightsController.cjs"}],[2753,{"./SnapInsightsController.cjs":2752},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SnapInsightsController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/index.cjs"}],[2754,{"./utils.cjs":2756,"@metamask/base-controller":1401,"@metamask/snaps-sdk":2877,"@metamask/snaps-utils":2994,"@metamask/utils":3207,immer:4717,nanoid:5139},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInterfaceController=void 0;const i=e("@metamask/base-controller"),a=e("@metamask/snaps-sdk"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("immer"),u=e("nanoid"),d=e("./utils.cjs"),p=1e7,h="SnapInterfaceController";var f=new WeakSet;class m extends i.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{interfaces:{includeInStateLogs:!0,persist:e=>Object.entries(e).reduce((e,[t,n])=>n.contentType===a.ContentType.Notification?(e[t]=n,e):e,{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:h,state:{interfaces:{},...t}}),s(this,f),this.messenger.subscribe("NotificationServicesController:notificationsListUpdated",r(f,this,j).bind(this)),r(f,this,g).call(this)}createInterface(e,t,n,s){const i=(0,d.getJsxInterface)(t);r(f,this,I).call(this,e,i),(0,d.validateInterfaceContext)(n);const a=(0,u.nanoid)(),c=(0,d.constructState)({},i,{getAssetsState:r(f,this,T).bind(this),getAccountByAddress:r(f,this,k).bind(this),getSelectedAccount:r(f,this,_).bind(this),listAccounts:r(f,this,E).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});return this.update(t=>{t.interfaces[a]={snapId:e,content:(0,l.castDraft)(i),state:c,context:n??null,contentType:s??null}}),a}getInterface(e,t){return r(f,this,b).call(this,e,t),this.state.interfaces[t]}updateInterface(e,t,n,s){r(f,this,b).call(this,e,t);const i=(0,d.getJsxInterface)(n);r(f,this,I).call(this,e,i),(0,d.validateInterfaceContext)(s);const a=this.state.interfaces[t].state,c=(0,d.constructState)(a,i,{getAssetsState:r(f,this,T).bind(this),getAccountByAddress:r(f,this,k).bind(this),getSelectedAccount:r(f,this,_).bind(this),listAccounts:r(f,this,E).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});this.update(e=>{e.interfaces[t].state=c,e.interfaces[t].content=(0,l.castDraft)(i),s&&(e.interfaces[t].context=s)})}deleteInterface(e){this.update(t=>{delete t.interfaces[e]})}updateInterfaceState(e,t){this.update(n=>{n.interfaces[e].state=t})}async resolveInterface(e,t,n){r(f,this,b).call(this,e,t),r(f,this,y).call(this,t),await r(f,this,S).call(this,t,n),this.deleteInterface(t)}}function g(){this.messenger.registerActionHandler(`${h}:createInterface`,this.createInterface.bind(this)),this.messenger.registerActionHandler(`${h}:getInterface`,this.getInterface.bind(this)),this.messenger.registerActionHandler(`${h}:updateInterface`,this.updateInterface.bind(this)),this.messenger.registerActionHandler(`${h}:deleteInterface`,this.deleteInterface.bind(this)),this.messenger.registerActionHandler(`${h}:updateInterfaceState`,this.updateInterfaceState.bind(this)),this.messenger.registerActionHandler(`${h}:resolveInterface`,this.resolveInterface.bind(this))}function b(e,t){const n=this.state.interfaces[t];(0,c.assert)(n!==undefined,`Interface with id '${t}' not found.`),(0,c.assert)(n.snapId===e,`Interface not created by ${e}.`)}function y(e){(0,c.assert)(r(f,this,v).call(this,e),`Approval request with id '${e}' not found.`)}function w(e){return this.messenger.call("PhishingController:testOrigin",e).result}function v(e){return this.messenger.call("ApprovalController:hasRequest",{id:e})}async function S(e,t){await this.messenger.call("ApprovalController:acceptRequest",e,t)}function _(){return this.messenger.call("AccountsController:getSelectedMultichainAccount")}function E(e){const t=this.messenger.call("AccountsController:listMultichainAccounts");return e&&0!==e.length?t.filter(t=>t.scopes.some(t=>(0,d.isMatchingChainId)(t,e))):t}function k(e){const{address:t}=(0,c.parseCaipAccountId)(e);return this.messenger.call("AccountsController:getAccountByAddress",t)}function T(){return this.messenger.call("MultichainAssetsController:getState")}function P(e){return this.messenger.call("SnapController:get",e)}function A(e,t){return this.messenger.call("PermissionController:hasPermission",e,t)}function I(e,t){const n=(0,o.getJsonSizeUnsafe)(t);(0,c.assert)(n<=p,"A Snap UI may not be larger than 10 MB."),(0,o.validateJsxElements)(t,{isOnPhishingList:r(f,this,w).bind(this),getSnap:r(f,this,P).bind(this),getAccountByAddress:r(f,this,k).bind(this),hasPermission:r(f,this,A).bind(this,e)})}function j(e){const t=e.filter(e=>"snap"===e.type&&(0,c.hasProperty)(e.data,"detailedView")),n=new Set(t.map(e=>e.data.detailedView.interfaceId));this.update(e=>{Object.entries(e.interfaces).forEach(([t,s])=>{s.contentType!==a.ContentType.Notification||n.has(t)||delete e.interfaces[t]})})}n.SnapInterfaceController=m}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/SnapInterfaceController.cjs"}],[2755,{"./SnapInterfaceController.cjs":2754},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SnapInterfaceController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/index.cjs"}],[2756,{"@metamask/snaps-sdk":2877,"@metamask/snaps-sdk/jsx":2964,"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateInterfaceContext=n.constructState=n.getAccountSelectorStateValue=n.getAssetSelectorStateValue=n.getAccountSelectorDefaultStateValue=n.getDefaultAsset=n.formatAccountSelectorStateValue=n.isMatchingChainId=n.assertNameIsUnique=n.getJsxInterface=n.isStatefulComponent=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/snaps-sdk/jsx"),i=e("@metamask/snaps-utils"),a=e("@metamask/utils"),o=["Input","Dropdown","RadioGroup","FileInput","Checkbox","Selector","AssetSelector","AddressInput","AccountSelector","DateTimePicker"];function c(e){return o.includes(e.type)}function l(e,t){(0,s.assert)(e[t]===undefined,`Duplicate component names are not allowed, found multiple instances of: "${t}".`)}function u(e,t){return"eip155:0"===e?t.some(e=>{const{namespace:t}=(0,a.parseCaipChainId)(e);return t===a.KnownCaipNamespace.Eip155}):t.includes(e)}function d(e,t){const{id:n,address:s,scopes:r}=e,a=(0,i.createChainIdList)(r,t);return{accountId:n,addresses:(0,i.createAccountList)(s,a)}}function p(e,t,{getAccountByAddress:n,getAssetsState:r}){var i;const{assetsMetadata:o,accountsAssets:c}=r(),l=e.map(e=>(0,a.parseCaipAccountId)(e)).map(({chainId:e})=>e),u=t&&t.length>0?l.filter(e=>t.includes(e)):l,d=null===(i=n(e[0]))||void 0===i?void 0:i.id;(0,s.assert)(d,`Account not found for address: ${e[0]}.`);const p=c[d];if(0===p.length)return null;const h=p.find(e=>{const{chainId:t,assetNamespace:n}=(0,a.parseCaipAssetType)(e);return u.includes(t)&&"slip44"===n});return h?{asset:h,name:o[h].name,symbol:o[h].symbol}:{asset:p[0],name:o[p[0]].name,symbol:o[p[0]].symbol}}function h(e,{getSelectedAccount:t,listAccounts:n,snapOwnsAccount:s}){const{chainIds:r,hideExternalAccounts:i}=e.props,a=t();if((!r||0===r.length||a.scopes.some(e=>u(e,r)))&&(!i||i&&s(a)))return d(a,r);const o=n(r),c=i?o.filter(e=>s(e)):o;return 0===c.length?null:d(c[0],r)}function f(e,t){if(!e)return null;const{assetsMetadata:n}=t(),s=n[e];return s?{asset:e,name:s.name??s.symbol??"Unknown",symbol:s.symbol??"Unknown"}:null}function m(e,{getAccountByAddress:t,snapOwnsAccount:n}){const{value:s,hideExternalAccounts:r}=e.props;if(!s)return null;const i=t(s);return i?r&&!n(i)?null:d(i,e.props.chainIds):null}function g(e,t,n,s){const r=s?e[s]:e,o=null==r?void 0:r[t.props.name];return"FileInput"===t.type?o??null:function(e,t){switch(e.type){case"Checkbox":return e.props.checked;case"AssetSelector":return f(e.props.value,t.getAssetsState);case"AddressInput":{if(!e.props.value)return null;const{namespace:t,reference:n}=(0,a.parseCaipChainId)(e.props.chainId);return(0,a.toCaipAccountId)(t,n,e.props.value)}case"AccountSelector":return m(e,t);default:return e.props.value}}(t,n)??o??function(e,t){switch(e.type){case"Dropdown":var n;return null===(n=(0,i.getJsxChildren)(e)[0])||void 0===n?void 0:n.props.value;case"RadioGroup":var s;return null===(s=(0,i.getJsxChildren)(e)[0])||void 0===s?void 0:s.props.value;case"Selector":var r;return null===(r=(0,i.getJsxChildren)(e)[0])||void 0===r?void 0:r.props.value;case"AccountSelector":return h(e,t);case"Checkbox":return!1;case"AssetSelector":return p(e.props.addresses,e.props.chainIds,t);default:return null}}(t,n)??null}n.isStatefulComponent=c,n.getJsxInterface=function(e){return(0,r.isJSXElementUnsafe)(e)?e:(0,i.getJsxElementFromComponent)(e)},n.assertNameIsUnique=l,n.isMatchingChainId=u,n.formatAccountSelectorStateValue=d,n.getDefaultAsset=p,n.getAccountSelectorDefaultStateValue=h,n.getAssetSelectorStateValue=f,n.getAccountSelectorStateValue=m,n.constructState=function(e,t,n){const s={},r=[];return(0,i.walkJsx)(t,(t,i)=>{let a=r[r.length-1];if(a&&i<=a.depth&&(r.pop(),a=r[r.length-1]),"Form"===t.type)return l(s,t.props.name),r.push({name:t.props.name,depth:i}),void(s[t.props.name]={});if(a&&c(t)){const r=s[a.name];return l(r,t.props.name),void(r[t.props.name]=g(e,t,n,a.name))}c(t)&&(l(s,t.props.name),s[t.props.name]=g(e,t,n))}),s};const b=5e6;n.validateInterfaceContext=function(e){if(!e)return;const t=(0,i.getJsonSizeUnsafe)(e);(0,s.assert)(t<=b,"A Snap interface context may not be larger than 5 MB.")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/utils.cjs"}],[2757,{"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.log=void 0;const s=e("@metamask/snaps-utils"),r=e("@metamask/utils");n.log=(0,r.createModuleLogger)(s.snapsLogger,"snaps-controllers")}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/logging.cjs"}],[2758,{"../snaps/index.cjs":2771,"@metamask/rpc-errors":2692,"@metamask/snaps-rpc-methods":2821,"@metamask/snaps-utils":2994,"@metamask/utils":3207,nanoid:5139},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainRouter=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-rpc-methods"),d=e("@metamask/snaps-utils"),p=e("@metamask/utils"),h=e("nanoid"),f=e("../snaps/index.cjs"),m="MultichainRouter";var g=new WeakMap,b=new WeakMap,y=new WeakSet;async function w(e,t,n){try{const s=await a(b,this).call(this,async({keyring:s})=>s.resolveAccountAddress(e,t,n)),r=null==s?void 0:s.address;return r?(0,p.parseCaipAccountId)(r).address:null}catch{throw l.rpcErrors.internal()}}async function v(e,t,n){const s=a(g,this).call("AccountsController:listMultichainAccounts",t).filter(e=>{var t;return Boolean(null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled)&&e.methods.includes(n.method)});if(0===s.length)return null;const r=s[0].metadata.snap.id,i=await c(y,this,w).call(this,r,t,n),o=e.map(e=>(0,p.parseCaipAccountId)(e).address),u=s.find(e=>o.includes(e.address)&&(!i||e.address===i));if(!u)throw l.rpcErrors.invalidParams({message:"No available account found for request."});return u.id}function S(e){const t=a(g,this).call("SnapController:getAll");return(0,f.getRunnableSnaps)(t).reduce((t,n)=>{const s=a(g,this).call("PermissionController:getPermissions",n.id);if(s&&(0,p.hasProperty)(s,u.SnapEndowments.Protocol)){const r=s[u.SnapEndowments.Protocol],i=(0,u.getProtocolCaveatScopes)(r);i&&(0,p.hasProperty)(i,e)&&t.push({snapId:n.id,methods:i[e].methods})}return t},[])}function _(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).filter(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})}n.MultichainRouter=class{constructor({messenger:e,withSnapKeyring:t}){var n,c;r(n=this,c=y),c.add(n),i(this,"name",m),i(this,"state",null),s(this,g,void 0),s(this,b,void 0),o(g,this,e),o(b,this,t),a(g,this).registerActionHandler(`${m}:handleRequest`,async(...e)=>this.handleRequest(...e)),a(g,this).registerActionHandler(`${m}:getSupportedMethods`,(...e)=>this.getSupportedMethods(...e)),a(g,this).registerActionHandler(`${m}:getSupportedAccounts`,(...e)=>this.getSupportedAccounts(...e)),a(g,this).registerActionHandler(`${m}:isSupportedScope`,(...e)=>this.isSupportedScope(...e))}async handleRequest({connectedAddresses:e,origin:t,scope:n,request:s}){(0,p.assert)(!n.startsWith(p.KnownCaipNamespace.Eip155)&&!n.startsWith("wallet:eip155"));const r={jsonrpc:"2.0",id:s.id??(0,h.nanoid)(),method:s.method,...s.params?{params:s.params}:{}},{method:i,params:o}=r,u=await c(y,this,v).call(this,e,n,r);if(u)return a(b,this).call(this,async({keyring:e})=>e.submitRequest({origin:t,account:u,scope:n,method:i,params:o}));const f=c(y,this,S).call(this,n).find(e=>e.methods.includes(i));if(f)return a(g,this).call("SnapController:handleRequest",{snapId:f.snapId,origin:t,request:{method:"",params:{request:r,scope:n}},handler:d.HandlerType.OnProtocolRequest});throw l.rpcErrors.methodNotFound()}getSupportedMethods(e){const t=c(y,this,_).call(this,e).flatMap(e=>e.methods),n=c(y,this,S).call(this,e).flatMap(e=>e.methods);return Array.from(new Set([...t,...n]))}getSupportedAccounts(e){return c(y,this,_).call(this,e).map(t=>`${e}:${t.address}`)}isSupportedScope(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).some(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})||c(y,this,S).call(this,e).length>0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/MultichainRouter.cjs"}],[2759,{"./MultichainRouter.cjs":2758},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./MultichainRouter.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/index.cjs"}],[276,{"../../../../shared/lib/deep-links/constants":5930,"../../../../shared/lib/deep-links/parse":5932,"../../../../shared/lib/deep-links/routes/route":5944,"../../../../shared/lib/deep-links/verify":5948,"../../../../shared/modules/mv3.utils":6026,events:4472,loglevel:4948,"webextension-polyfill":5864},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DeepLinkRouter=void 0;var s=d(e("events")),r=d(e("webextension-polyfill")),i=d(e("loglevel")),a=e("../../../../shared/modules/mv3.utils"),o=e("../../../../shared/lib/deep-links/parse"),c=e("../../../../shared/lib/deep-links/constants"),l=e("../../../../shared/lib/deep-links/routes/route"),u=e("../../../../shared/lib/deep-links/verify");function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=l.DEEP_LINK_ROUTE.replace(/^\//u,"");class f extends s.default{constructor({getExtensionURL:e,getState:t}){super(),p(this,"getExtensionURL",void 0),p(this,"getState",void 0),p(this,"handleBeforeRequest",({tabId:e,url:t})=>e===r.default.tabs.TAB_ID_NONE?{}:this.tryNavigateTo(e,t)),this.getExtensionURL=e,this.getState=t}formatUrlForInterstitialPage(e){return e.pathname+e.search}get404ErrorURL(e){const t=new URLSearchParams({errorCode:"404"});return e&&t.set("u",this.formatUrlForInterstitialPage(e)),this.getExtensionURL(h,t.toString())}async redirectTab(e,t){try{await r.default.tabs.update(e,{url:t})}catch(e){i.default.error("Error redirecting tab:",e),this.emit("error",e)}}install(){r.default.webRequest.onBeforeRequest.addListener(this.handleBeforeRequest,{urls:[`*://*.${c.DEEP_LINK_HOST}/*`],types:["main_frame"]},a.isManifestV3?[]:["blocking"])}uninstall(){r.default.webRequest.onBeforeRequest.removeListener(this.handleBeforeRequest)}async tryNavigateTo(e,t){if(t.length>c.DEEP_LINK_MAX_LENGTH)return i.default.debug("Url is too long, skipping deep link handling"),{};let n;try{const e=new URL(t),s=await(0,o.parse)(e);if(s)if(this.emit("navigate",{url:e,parsed:s}),"redirectTo"in s.destination)n=s.destination.redirectTo.toString();else if(this.canSkipInterstitial(s.signature))n=this.getExtensionURL(s.destination.path,s.destination.query.toString());else{const t=new URLSearchParams({u:this.formatUrlForInterstitialPage(e)});n=this.getExtensionURL(h,t.toString())}else n=this.get404ErrorURL(e)}catch(e){i.default.error("Invalid URL:",t,e),this.emit("error",e),n=this.get404ErrorURL()}return this.redirectTab(e,n),a.isManifestV3?{}:{cancel:!0}}canSkipInterstitial(e){var t;return e===u.VALID&&Boolean(null===(t=this.getState().preferences)||void 0===t?void 0:t.skipDeepLinkInterstitial)}}n.DeepLinkRouter=f}}},{package:"$root$",file:"app/scripts/lib/deep-links/deep-link-router.ts"}],[2760,{"../logging.cjs":2757,"../snaps/Timer.cjs":2769,"../utils.cjs":2781,"@metamask/json-rpc-engine":2216,"@metamask/json-rpc-middleware-stream":2229,"@metamask/object-multiplex":2486,"@metamask/rpc-errors":2692,"@metamask/snaps-utils":2994,"@metamask/utils":3207,nanoid:5139,"readable-stream":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setupMultiplex=n.AbstractExecutionService=void 0;const u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-middleware-stream"),p=l(e("@metamask/object-multiplex")),h=e("@metamask/rpc-errors"),f=e("@metamask/snaps-utils"),m=e("@metamask/utils"),g=e("nanoid"),b=e("readable-stream"),y=e("../logging.cjs"),w=e("../snaps/Timer.cjs"),v=e("../utils.cjs"),S="ExecutionService";var _=new WeakMap,E=new WeakMap,k=new WeakMap,T=new WeakMap,P=new WeakMap,A=new WeakMap,I=new WeakMap,j=new WeakMap,O=new WeakSet;function M(){a(T,this).registerActionHandler(`${S}:handleRpcRequest`,async(e,t)=>this.handleRpcRequest(e,t)),a(T,this).registerActionHandler(`${S}:executeSnap`,async e=>this.executeSnap(e)),a(T,this).registerActionHandler(`${S}:terminateSnap`,async e=>this.terminateSnap(e)),a(T,this).registerActionHandler(`${S}:terminateAllSnaps`,async()=>this.terminateAllSnaps())}async function R(e,t){const{streams:n,worker:s}=await c(O,this,C).call(this,e,t),r=new u.JsonRpcEngine,i=(0,d.createStreamMiddleware)();(0,b.pipeline)(i.stream,n.command,i.stream,e=>{var t;!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||(0,f.logError)("Command stream failure.",e)}),r.push(i.middleware);const o={id:e,streams:n,rpcEngine:r,worker:s};return a(_,this).set(e,o),o}async function C(e,t){const n=await(0,v.withTimeout)(this.initEnvStream(e),t);if(n===v.hasTimedOut){await this.terminateJob({id:e});if("created"===a(E,this).get(e))throw new Error(`The executor for "${e}" couldn't start initialization. The offscreen document may not exist.`);throw new Error(`The executor for "${e}" failed to initialize. The iframe/webview/worker failed to load.`)}const{worker:s,stream:r}=n,i=N(r,`Snap: "${e}"`),o=i.createStream(f.SNAP_STREAM_NAMES.COMMAND),c=t=>{(0,m.hasProperty)(t,"id")||("OutboundRequest"===t.method?a(T,this).publish("ExecutionService:outboundRequest",e):"OutboundResponse"===t.method?a(T,this).publish("ExecutionService:outboundResponse",e):"UnhandledError"===t.method?(a(T,this).publish("ExecutionService:unhandledError",e,t.params.error),o.removeListener("data",c)):(0,f.logError)(new Error(`Received unexpected command stream notification "${t.method}".`)))};o.on("data",c);const l=i.createStream(f.SNAP_STREAM_NAMES.JSON_RPC);l.on("data",t=>{null!=t&&t.data&&(0,m.hasProperty)(null==t?void 0:t.data,"id")&&a(T,this).publish("ExecutionService:outboundRequest",e)});const u=l.write.bind(l);return l.write=(t,n,s)=>{var r;return"metamask_chainChanged"===(null==t||null===(r=t.data)||void 0===r?void 0:r.method)||(null!=t&&t.data&&(0,m.hasProperty)(null==t?void 0:t.data,"id")&&a(T,this).publish("ExecutionService:outboundResponse",e),u(t,n,s))},{streams:{command:o,rpc:l,connection:r,mux:i},worker:s}}async function x(e,t){const n=a(_,this).get(e);if(!n)throw new Error(`"${e}" is not currently running.`);(0,y.log)("Parent: Sending Command",t);const s=await n.rpcEngine.handle(t);if((0,m.hasProperty)(s,"error")){const e=s.error;throw new h.JsonRpcError(e.code,e.message,e.data)}return s.result}function N(e,t){const n=new p.default;return(0,b.pipeline)(e,n,e,e=>{var n;!e||null!==(n=e.message)&&void 0!==n&&n.match("Premature close")||(0,f.logError)(`"${t}" stream failure.`,e)}),n}n.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,initTimeout:n=(0,m.inMilliseconds)(60,m.Duration.Second),pingTimeout:a=(0,m.inMilliseconds)(10,m.Duration.Second),terminationTimeout:l=(0,m.inMilliseconds)(1,m.Duration.Second),usePing:u=!0}){var d,p;r(d=this,p=O),p.add(d),i(this,"name",S),i(this,"state",null),s(this,_,void 0),s(this,E,void 0),s(this,k,void 0),s(this,T,void 0),s(this,P,void 0),s(this,A,void 0),s(this,I,void 0),s(this,j,void 0),o(_,this,new Map),o(E,this,new Map),o(k,this,e),o(T,this,t),o(P,this,n),o(A,this,a),o(I,this,l),o(j,this,u),c(O,this,M).call(this)}async terminateSnap(e){const t=a(_,this).get(e);if(t){try{const t=await(0,v.withTimeout)(c(O,this,x).call(this,e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,g.nanoid)()}),a(I,this));t!==v.hasTimedOut&&"OK"===t||(0,f.logWarning)(`Snap "${e}" failed to terminate gracefully.`)}catch{}Object.values(t.streams).forEach(e=>{try{e.destroyed||e.destroy()}catch(e){(0,f.logError)("Error while destroying stream",e)}}),await this.terminateJob(t),a(_,this).delete(e),a(E,this).delete(e),(0,y.log)(`Snap "${e}" terminated.`)}}setSnapStatus(e,t){a(E,this).set(e,t)}async terminateAllSnaps(){await Promise.all([...a(_,this).keys()].map(async e=>this.terminateSnap(e)))}async executeSnap({snapId:e,sourceCode:t,endowments:n}){if(a(_,this).has(e))throw new Error(`"${e}" is already running.`);this.setSnapStatus(e,"created");const s=new w.Timer(a(P,this)),r=await c(O,this,R).call(this,e,s);if(a(j,this)){if(await(0,v.withTimeout)(c(O,this,x).call(this,r.id,{jsonrpc:"2.0",method:"ping",id:(0,g.nanoid)()}),a(A,this))===v.hasTimedOut)throw new Error(`The executor for "${e}" was unreachable. The executor did not respond in time.`)}const i=r.streams.rpc;a(k,this).call(this,e,i);const o=Math.max(s.remaining,a(P,this)/2);this.setSnapStatus(e,"initialized");const l={jsonrpc:"2.0",method:"executeSnap",params:{snapId:e,sourceCode:t,endowments:n},id:(0,g.nanoid)()};(0,m.assertIsJsonRpcRequest)(l),this.setSnapStatus(e,"executing");const u=await(0,v.withTimeout)(c(O,this,x).call(this,r.id,l),o);if(u===v.hasTimedOut)throw new Error(`${e} failed to start.`);return"OK"===u&&this.setSnapStatus(e,"running"),u}async handleRpcRequest(e,t){const{handler:n,request:s,origin:r}=t;return await c(O,this,x).call(this,e,{id:(0,g.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:r,handler:n,request:s,target:e}})}},n.setupMultiplex=N}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/AbstractExecutionService.cjs"}],[2761,{"@metamask/post-message-stream":2557},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyPostMessageStream=void 0;const c=e("@metamask/post-message-stream");var l=new WeakMap,u=new WeakMap,d=new WeakSet;class p extends c.BasePostMessageStream{constructor({stream:e,jobId:t}){var n,c;super(),r(n=this,c=d),c.add(n),s(this,l,void 0),s(this,u,void 0),a(l,this,e),a(u,this,t),i(l,this).on("data",o(d,this,h).bind(this))}_postMessage(e){i(l,this).write({jobId:i(u,this),data:e})}}function h(e){e.jobId===i(u,this)&&this.push(e.data)}n.ProxyPostMessageStream=p}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/ProxyPostMessageStream.cjs"}],[2762,{"../../utils.cjs":2781,"../AbstractExecutionService.cjs":2760,"@metamask/post-message-stream":2557,"@metamask/snaps-utils":2994},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IframeExecutionService=void 0;const r=e("@metamask/post-message-stream"),i=e("@metamask/snaps-utils"),a=e("../../utils.cjs"),o=e("../AbstractExecutionService.cjs");class c extends o.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:n,...r}){super({...r,messenger:t,setupSnapProvider:n}),s(this,"iframeUrl",void 0),this.iframeUrl=e}async terminateJob(e){const t=document.getElementById(e.id);t&&(t.id="",await(0,a.withTimeout)(new Promise(e=>{t.addEventListener("load",()=>e(),{once:!0}),t.src="about:blank"}),10),t.remove())}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=await(0,i.createWindow)({uri:this.iframeUrl.toString(),id:e});return{worker:t,stream:new r.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}}n.IframeExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/IframeExecutionService.cjs"}],[2763,{"./IframeExecutionService.cjs":2762},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./IframeExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/index.cjs"}],[2764,{"./AbstractExecutionService.cjs":2760,"./ProxyPostMessageStream.cjs":2761,"./iframe/index.cjs":2763,"./offscreen/index.cjs":2766},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./AbstractExecutionService.cjs"),n),r(e("./ProxyPostMessageStream.cjs"),n),r(e("./iframe/index.cjs"),n),r(e("./offscreen/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/index.cjs"}],[2765,{"../proxy/ProxyExecutionService.cjs":2767,"@metamask/post-message-stream":2557},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.OffscreenExecutionService=void 0;const i=e("@metamask/post-message-stream"),a=e("../proxy/ProxyExecutionService.cjs");var o=new WeakMap;class c extends a.ProxyExecutionService{constructor({messenger:e,setupSnapProvider:t,offscreenPromise:n,...a}){var c,l,u;super({...a,messenger:e,setupSnapProvider:t,stream:new i.BrowserRuntimePostMessageStream({name:"parent",target:"child"})}),s(this,o,void 0),l=this,u=n,(c=o).set(r(c,l),u)}async initEnvStream(e){var t,n;return await(t=o,n=this,t.get(r(t,n))),await super.initEnvStream(e)}}n.OffscreenExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/OffscreenExecutionService.cjs"}],[2766,{"./OffscreenExecutionService.cjs":2765},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./OffscreenExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/index.cjs"}],[2767,{"../AbstractExecutionService.cjs":2760,"../ProxyPostMessageStream.cjs":2761,nanoid:5139},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyExecutionService=void 0;const a=e("nanoid"),o=e("../AbstractExecutionService.cjs"),c=e("../ProxyPostMessageStream.cjs");var l=new WeakMap;class u extends o.AbstractExecutionService{constructor({stream:e,messenger:t,setupSnapProvider:n,...r}){var a,o,c;super({...r,messenger:t,setupSnapProvider:n,usePing:!1}),s(this,l,void 0),o=this,c=e,(a=l).set(i(a,o),c)}async terminateJob(e){r(l,this).write({jobId:e.id,data:{jsonrpc:"2.0",method:"terminateJob",id:(0,a.nanoid)()}})}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=new c.ProxyPostMessageStream({stream:r(l,this),jobId:e});return await new Promise(e=>{t.once("data",e),t.write({name:"command",data:{jsonrpc:"2.0",method:"ping",id:(0,a.nanoid)()}})}),{worker:e,stream:t}}}n.ProxyExecutionService=u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/proxy/ProxyExecutionService.cjs"}],[2768,{"../fsm.cjs":2750,"../logging.cjs":2757,"../utils.cjs":2781,"./Timer.cjs":2769,"./constants.cjs":2770,"./location/index.cjs":2773,"./registry/index.cjs":2777,"./selectors.cjs":2780,"@metamask/approval-controller":1289,"@metamask/base-controller":1401,"@metamask/permission-controller":2528,"@metamask/rpc-errors":2692,"@metamask/snaps-rpc-methods":2821,"@metamask/snaps-sdk":2877,"@metamask/snaps-utils":2994,"@metamask/utils":3207,"@xstate/fsm":3681,"async-mutex":3998,nanoid:5139,semver:5688},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const l=e("@metamask/approval-controller"),u=e("@metamask/base-controller"),d=e("@metamask/permission-controller"),p=e("@metamask/rpc-errors"),h=e("@metamask/snaps-rpc-methods"),f=e("@metamask/snaps-sdk"),m=e("@metamask/snaps-utils"),g=e("@metamask/utils"),b=e("@xstate/fsm"),y=e("async-mutex"),w=e("nanoid"),v=e("semver"),S=e("./constants.cjs"),_=e("./location/index.cjs"),E=e("./registry/index.cjs"),k=e("./selectors.cjs"),T=e("./Timer.cjs"),P=e("../fsm.cjs"),A=e("../logging.cjs"),I=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const j=new Set(["initialPermissions","id","version","enabled","blocked"]),O={snaps:{},snapStates:{},unencryptedSnapStates:{},isReady:!1};function M(e){return Object.keys(e).reduce((t,n)=>(j.has(n)&&(t[n]=e[n]),t),{})}var R=new WeakMap,C=new WeakMap,x=new WeakMap,N=new WeakMap,L=new WeakMap,$=new WeakMap,D=new WeakMap,U=new WeakMap,q=new WeakMap,W=new WeakMap,H=new WeakMap,F=new WeakMap,V=new WeakMap,B=new WeakMap,K=new WeakMap,z=new WeakMap,Y=new WeakMap,G=new WeakMap,J=new WeakMap,X=new WeakMap,Z=new WeakMap,Q=new WeakSet,ee=new WeakMap;class te extends u.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["endowment:caip25","wallet_snap"],environmentEndowmentPermissions:d=[],excludedPermissions:p={},idleTimeCheckInterval:h=(0,g.inMilliseconds)(5,g.Duration.Second),maxIdleTime:b=(0,g.inMilliseconds)(30,g.Duration.Second),maxRequestTime:y=(0,g.inMilliseconds)(60,g.Duration.Second),fetchFunction:w=globalThis.fetch.bind(undefined),featureFlags:v={},detectSnapLocation:E=_.detectSnapLocation,preinstalledSnaps:k=null,encryptor:T,getMnemonicSeed:P,getFeatureFlags:A=()=>({}),clientCryptography:j,trackEvent:M,ensureOnboardingComplete:te}){var ae,oe,ce;super({messenger:t,metadata:{isReady:{includeInStateLogs:!0,includeInDebugSnapshot:!0,persist:!1,usedInUi:!1},snapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},unencryptedSnapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},snaps:{includeInStateLogs:e=>Object.values(e).reduce((e,t)=>{const n={...t};return delete n.sourceCode,delete n.auxiliaryFiles,e[t.id]=n,e},{}),persist:e=>Object.values(e).filter(e=>e.status!==m.SnapStatus.Installing).map(e=>({...e,status:m.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:n.controllerName,state:{...O,...l}}),i(oe=this,ce=Q),ce.add(oe),r(this,R,void 0),r(this,C,void 0),r(this,x,void 0),r(this,N,void 0),r(this,L,void 0),r(this,$,void 0),r(this,D,void 0),r(this,U,void 0),s(this,"maxRequestTime",void 0),r(this,q,void 0),r(this,W,void 0),r(this,H,void 0),r(this,F,void 0),r(this,V,void 0),r(this,B,void 0),r(this,K,void 0),r(this,z,void 0),r(this,Y,void 0),r(this,G,void 0),r(this,J,void 0),r(this,X,void 0),r(this,Z,void 0),r(this,ee,(0,I.debouncePersistState)((e,t,n)=>{c(Q,this,Xe).call(this,e).stateMutex.runExclusive(async()=>{const s=await c(Q,this,ye).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=s}):this.update(t=>{t.unencryptedSnapStates[e]=s})}).catch(m.logError)},S.STATE_DEBOUNCE_TIMEOUT)),o(R,this,e),o(C,this,u),o(x,this,d),o(N,this,p),o(L,this,v),o($,this,w),o(D,this,h),o(U,this,b),this.maxRequestTime=y,o(V,this,E),o(q,this,T),o(W,this,P),o(H,this,A),o(F,this,j),o(G,this,k),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(K,this,new Map),o(B,this,new Map),o(J,this,M),o(Z,this,te),c(Q,this,ie).call(this),this.messenger.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(Q,this,at).call(this,t,e,m.HandlerType.OnInstall).catch(t=>{(0,m.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,f.getErrorMessage)(t)}`)})}),this.messenger.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{c(Q,this,at).call(this,n,e,m.HandlerType.OnUpdate).catch(t=>{(0,m.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,f.getErrorMessage)(t)}`)})}),this.messenger.subscribe("KeyringController:lock",c(Q,this,ot).bind(this)),c(Q,this,ne).call(this),c(Q,this,se).call(this),Object.values((null===(ae=this.state)||void 0===ae?void 0:ae.snaps)??{}).forEach(e=>c(Q,this,Ze).call(this,e.id)),a(G,this)&&c(Q,this,re).call(this,a(G,this)),o(X,this,(0,I.throttleTracking)((e,t,n,s)=>{const r=this.messenger.call("SnapsRegistry:getMetadata",e);a(J,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==r?void 0:r.category,success:n,origin:s}})}))}init(){c(Q,this,ue).call(this).catch(m.logWarning),c(Q,this,it).call(this,S.METAMASK_ORIGIN,m.HandlerType.OnStart)}async updateRegistry(){await c(Q,this,ue).call(this),await this.messenger.call("SnapsRegistry:update");const e=await this.messenger.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));if(await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===E.SnapsRegistryStatus.Blocked?c(Q,this,ae).call(this,e,n):c(Q,this,oe).call(this,e))),!a(L,this).autoUpdatePreinstalledSnaps)return;await Promise.allSettled(Object.values(this.state.snaps).filter(e=>e.preinstalled).map(async e=>{const t=await c(Q,this,Ae).call(this,e.id,"*");if("*"!==t&&(0,g.gtVersion)(t,e.version)){const n=a(V,this).call(this,e.id,{versionRange:t,fetch:a($,this),allowLocal:!1,useNpmProxy:!0});await c(Q,this,Pe).call(this,{origin:l.ORIGIN_METAMASK,snapId:e.id,location:n,versionRange:t,automaticUpdate:!0})}}))}_onUnhandledSnapError(e,t){(0,m.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,m.SnapStatusEvents.Crash).catch(e=>{(0,m.logError)(e)})}_onOutboundRequest(e){const t=c(Q,this,Xe).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(Q,this,Xe).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){await c(Q,this,ue).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(Q,this,je).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messenger.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,m.SnapStatusEvents.Stop),this.messenger.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=m.SnapStatusEvents.Stop){const n=c(Q,this,Je).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:s,resolve:r}=(0,g.createDeferredPromise)();n.stopPromise=s;try{var i;if(this.isRunning(e))null===(i=a(R,this))||void 0===i||i.call(this,e),await c(Q,this,he).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&c(Q,this,pe).call(this,e,t),r()}}async stopAllSnaps(e=m.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,g.assert)(t!==undefined,`Snap "${e}" not found.`),t}getTruncated(e){const t=this.get(e);return t?M(t):null}getTruncatedExpect(e){return M(this.getExpect(e))}async updateSnapState(e,t,n){const s=c(Q,this,Xe).call(this,e);n?s.state=t:s.unencryptedState=t,a(ee,this).call(this,e,t,n)}clearSnapState(e,t){const n=c(Q,this,Xe).call(this,e);t?n.state=null:n.unencryptedState=null,a(ee,this).call(this,e,null,t)}async getSnapState(e,t){const n=c(Q,this,Xe).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const s=t?n.state:n.unencryptedState;if(s!==undefined)return s;const r=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===r||r===undefined)return null;if(!t){const e=JSON.parse(r);return n.unencryptedState=e,e}const i=await c(Q,this,ge).call(this,e,r);return n.state=i,i})}async getSnapFile(e,t,n=f.AuxiliaryFileEncoding.Base64){var s;const r=this.getExpect(e),i=(0,m.normalizeRelative)(t),a=null===(s=r.auxiliaryFiles)||void 0===s||null===(s=s.find(e=>e.path===i))||void 0===s?void 0:s.value;if(!a)return null;const o=await(0,m.encodeAuxiliaryFile)(a,n);return(0,g.assert)(o.length<m.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:s}=n.manifest;return!!s&&(0,v.gte)(s,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>c(Q,this,_e).call(this,e)),this.update(e=>{e.isReady=!1,e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),a(B,this).clear(),a(K,this).clear(),a(G,this)&&c(Q,this,re).call(this,a(G,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,g.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),c(Q,this,_e).call(this,e),c(Q,this,Se).call(this,e),a(B,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==m.SnapStatus.Installing&&this.messenger.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),i=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(!i)return;if(Boolean(null===(s=i.value)||void 0===s?void 0:s[t])){const n={...i.value};delete n[t],Object.keys(n).length>0?this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,n):this.messenger.call("PermissionController:revokePermissions",{[e]:[h.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,g.assert)(t.every(e=>a(C,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messenger.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(Q,this,Xe).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(Q,this,Xe).call(this,e);(0,g.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(M)}getRunnableSnaps(){return(0,k.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messenger.call("PermissionController:getPermissions",e)??{})[h.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===m.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),s=this.getTruncated(t);return s&&(null==n?void 0:n.status)!==m.SnapStatus.Installing&&(e[t]=s),e},{})}async installSnaps(e,t){await c(Q,this,ue).call(this);const n={},s=Object.keys(t),r=[],i=[];try{for(const[s,{version:o}]of Object.entries(t)){(0,m.assertIsValidSnapId)(s);const[t,l]=(0,m.resolveVersionRange)(o);if(t)throw p.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=a(V,this).call(this,s,{versionRange:l,fetch:a($,this),allowLocal:a(L,this).allowLocalSnaps,resolveVersion:async e=>a(L,this).requireAllowlist?await c(Q,this,Ae).call(this,s,e):e}),d=this.has(s)&&!u.shouldAlwaysReload;if(d&&c(Q,this,rt).call(this,s,l)){const e=this.getExpect(s);r.push({snapId:s,oldVersion:e.version});let t=c(Q,this,Ke).call(this,s);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(Q,this,ze).call(this,s),t.newVersion=l}else d||i.push(s);n[s]=await c(Q,this,Ee).call(this,e,s,u,l)}i.forEach(t=>this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),r.forEach(({snapId:t,oldVersion:n})=>this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),s.forEach(e=>a(K,this).delete(e))}catch(e){const t=i.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...a(K,this).keys()],s=r.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await c(Q,this,Ge).call(this,s),e}return n}destroy(){super.destroy(),a(z,this)&&clearTimeout(a(z,this)),this.messenger.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.clearEventSubscriptions("SnapController:snapInstalled"),this.messenger.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:s}){await c(Q,this,ue).call(this);const r=this.get(e);(0,g.assert)(r,`The Snap "${e}" is not installed. Please install it before invoking it.`),(0,g.assert)(t===S.METAMASK_ORIGIN||(0,m.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const i={jsonrpc:"2.0",id:(0,w.nanoid)(),...s};(0,g.assertIsJsonRpcRequest)(i);const a=h.handlerEndowments[n];(0,g.assert)("string"==typeof a||null===a,"'permissionName' must be either a string or null.");const o=this.messenger.call("PermissionController:getPermissions",e);if(!(null===a||o&&(0,g.hasProperty)(o,a)))throw new Error(`Snap "${e}" is not permitted to use "${a}".`);const l=a?o[a]:undefined;if(a===h.SnapEndowments.Rpc||a===h.SnapEndowments.Keyring){(0,g.assert)(l);const n=this.messenger.call("SubjectMetadataController:getSubjectMetadata",t),s=a===h.SnapEndowments.Rpc?(0,h.getRpcCaveatOrigins)(l):(0,h.getKeyringCaveatOrigins)(l);if((0,g.assert)(s),!(0,m.isOriginAllowed)(s,(null==n?void 0:n.subjectType)??d.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==S.METAMASK_ORIGIN&&S.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!r.enabled)throw new Error(`Snap "${e}" is disabled.`);if(r.status===m.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const u=c(Q,this,Ne).call(this,l),p=c(Q,this,Xe).call(this,e);if(p.stopPromise&&await p.stopPromise,!this.isRunning(e)){p.startPromise||(p.startPromise=this.startSnap(e));try{await p.startPromise}finally{p.startPromise=null}}const f=c(Q,this,He).call(this,e,n,i),b=new T.Timer(u);c(Q,this,Ve).call(this,e,f.id,b);const y=this.messenger.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:f});try{const s=await(0,I.withTimeout)(y,b);if(s===I.hasTimedOut){const t=null!==p.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(Q,this,Fe).call(this,e,n,s);const r=await c(Q,this,De).call(this,e,n,f,s);return c(Q,this,Be).call(this,e,f.id,n,t,!0),r}catch(s){c(Q,this,Be).call(this,e,f.id,n,t,!1);const[r,i]=(0,m.unwrapError)(s),a=null!==p.stopPromise||!this.isRunning(e);throw i||(a||(0,m.logError)(`"${e}" crashed due to an unhandled error:`,r),await this.stopSnap(e,m.SnapStatusEvents.Crash)),r}}setClientActive(e){e?c(Q,this,it).call(this,S.METAMASK_ORIGIN,m.HandlerType.OnActive):c(Q,this,it).call(this,S.METAMASK_ORIGIN,m.HandlerType.OnInactive)}}function ne(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:m.SnapStatus.Installing,states:{[m.SnapStatus.Installing]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e}}},[m.SnapStatus.Updating]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped}},[m.SnapStatus.Running]:{on:{[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped,[m.SnapStatusEvents.Crash]:m.SnapStatus.Crashed}},[m.SnapStatus.Stopped]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}},[m.SnapStatus.Crashed]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}}}};o(Y,this,(0,b.createMachine)(t)),(0,P.validateMachine)(a(Y,this))}function se(){this.messenger.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messenger.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messenger.registerActionHandler(`${n.controllerName}:updateRegistry`,async()=>this.updateRegistry()),this.messenger.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messenger.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messenger.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messenger.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function re(e){for(const{snapId:n,manifest:s,files:r,removable:i,hidden:a,hideSnapBranding:o}of e){var t;const e=this.get(n),l=e!==undefined,u=l&&(0,g.gtVersion)(s.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const d=new m.VirtualFile({path:m.NpmSnapFileNames.Manifest,value:JSON.stringify(s),result:s}),p=r.map(({path:e,value:t})=>new m.VirtualFile({value:t,path:e})),{filePath:f,iconPath:b}=s.source.location.npm,y=p.find(e=>e.path===f),w=b?p.find(e=>e.path===b):undefined;(0,g.assert)(y,"Source code not provided for preinstalled snap."),(0,g.assert)(!b||b&&w,"Icon not provided for preinstalled snap."),(0,g.assert)(s.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const v=(null===(t=s.source.locales)||void 0===t?void 0:t.map(e=>p.find(t=>t.path===e)))??[],_=(0,m.getValidatedLocalizationFiles)(v.filter(Boolean));(0,g.assert)(v.length===_.length,"Missing localization files for preinstalled snap.");const E={manifest:d,sourceCode:y,svgIcon:w,auxiliaryFiles:[],localizationFiles:_};c(Q,this,Me).call(this,{id:n,origin:S.METAMASK_ORIGIN,files:E,removable:i,hidden:a,hideSnapBranding:o,preinstalled:!0});const k=(0,h.processSnapPermissions)(s.initialPermissions);c(Q,this,Re).call(this,k);const{newPermissions:T,unusedPermissions:P}=c(Q,this,et).call(this,n,k);c(Q,this,st).call(this,{snapId:n,newPermissions:T,unusedPermissions:P}),s.initialConnections&&c(Q,this,we).call(this,n,(null==e?void 0:e.initialConnections)??null,s.initialConnections),this.update(e=>{e.snaps[n].status=m.SnapStatus.Stopped}),c(Q,this,Ze).call(this,n),u?this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,S.METAMASK_ORIGIN,!0):this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),S.METAMASK_ORIGIN,!0)}for(const t of Object.values(this.state.snaps).filter(({preinstalled:e})=>e)){const r=(0,h.processSnapPermissions)(t.manifest.initialPermissions);c(Q,this,Re).call(this,r);const{newPermissions:i,unusedPermissions:a}=c(Q,this,et).call(this,t.id,r);if((0,g.isNonEmptyArray)(Object.keys(i))||(0,g.isNonEmptyArray)(Object.keys(a))){var n,s;const{proposedName:r}=(0,m.getLocalizedSnapManifest)(t.manifest,"en",t.localizationFiles??[]),o=e.find(e=>e.snapId===t.id),{iconPath:l}=t.manifest.source.location.npm,u=l&&o?o.files.find(e=>e.path===l):undefined;this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:r,origin:t.id,version:t.version,svgIcon:u?new m.VirtualFile(u).toString():null}),c(Q,this,st).call(this,{snapId:t.id,newPermissions:i,unusedPermissions:a}),(0,m.logWarning)(`The permissions for "${t.id}" were out of sync and have been automatically restored. If you see this message, please file a bug report.`),null===(n=(s=this.messenger).captureException)||void 0===n||n.call(s,new Error(`The permissions for "${t.id}" were out of sync and have been automatically restored. This could indicate persistence issues.`))}}}function ie(){o(z,this,setTimeout(()=>{c(Q,this,de).call(this).catch(e=>{(0,m.logError)(e)}),c(Q,this,ie).call(this)},a(D,this)))}async function ae(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,m.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messenger.publish(`${n.controllerName}:snapBlocked`,e,t)}}function oe(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messenger.publish(`${n.controllerName}:snapUnblocked`,e))}async function ce(e,{platformVersion:t,...n}){const s=(await this.messenger.call("SnapsRegistry:get",{[e]:n}))[e];var r;if(s.status===E.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(r=s.reason)||void 0===r?void 0:r.explanation)??""}`);const i=Object.keys(n.permissions).some(e=>!S.ALLOWED_PERMISSIONS.includes(e));if(a(L,this).requireAllowlist&&i&&s.status!==E.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${s.status===E.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(Q,this,Ce).call(this,e,t)}function le(){(0,g.assert)(!0!==a(L,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}async function ue(){await a(Z,this).call(this);const e=!0!==a(H,this).call(this).disableSnaps;this.state.isReady!==e&&this.update(t=>{t.isReady=e}),(0,g.assert)(e,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function de(){const e=[...a(B,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&a(U,this)&&(0,g.timeSince)(t.lastRequest)>a(U,this)).map(async([e])=>this.stopSnap(e,m.SnapStatusEvents.Stop)))}function pe(e,t){const{interpreter:n}=c(Q,this,Xe).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function he(e){await this.messenger.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(Q,this,Xe).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messenger.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function fe(e,t=c(Q,this,Xe).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function me({snapId:e,salt:t,useCache:n,keyMetadata:s}){const r=c(Q,this,Xe).call(this,e);if(c(Q,this,fe).call(this,e,r)&&n)return{key:await a(q,this).importKey(r.encryptionKey),salt:r.encryptionSalt};const i=t??a(q,this).generateSalt(),o=await a(W,this).call(this),l=await(0,h.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:a(F,this)}),u=await a(q,this).keyFromPassword(l,i,!0,s),d=await a(q,this).exportKey(u);return n&&(r.encryptionKey=d,r.encryptionSalt=i),{key:u,salt:i}}async function ge(e,t){try{const n=JSON.parse(t),{salt:s,keyMetadata:r}=n,i=c(Q,this,fe).call(this,e)||a(q,this).isVaultUpdated(t),{key:o}=await c(Q,this,me).call(this,{snapId:e,salt:s,useCache:i,keyMetadata:r??S.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await a(q,this).decryptWithKey(o,n)}catch{throw p.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function be(e,t){const{key:n,salt:s}=await c(Q,this,me).call(this,{snapId:e,useCache:!0}),r=await a(q,this).encryptWithKey(n,t);return r.salt=s,JSON.stringify(r)}async function ye(e,t,n){return null===t?null:n?await c(Q,this,be).call(this,e,t):JSON.stringify(t)}function we(e,t,n){if(t){const s=(0,I.setDiff)(t,n);for(const t of Object.keys(s))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))c(Q,this,ve).call(this,t,e)}function ve(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),i=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(Boolean(null==i||null===(s=i.value)||void 0===s?void 0:s[t]))return;if(i)return void this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,{...i.value,[t]:{}});const a={[h.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:m.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:a,subject:{origin:e}})}function Se(e){const t=this.messenger.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function _e(e){this.messenger.call("PermissionController:hasPermissions",e)&&this.messenger.call("PermissionController:revokeAllPermissions",e)}async function Ee(e,t,s,r){const i=this.getTruncated(t);if(i&&!s.shouldAlwaysReload)return(0,g.satisfiesVersionRange)(i.version,r)?i:await c(Q,this,Pe).call(this,{origin:e,snapId:t,location:s,versionRange:r});c(Q,this,le).call(this);let a=c(Q,this,ke).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messenger.publish("SnapController:snapInstallStarted",t,e,!1),i&&this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),i&&s.shouldAlwaysReload&&c(Q,this,_e).call(this,t);try{const{sourceCode:i}=await c(Q,this,Ie).call(this,{origin:e,id:t,location:s,versionRange:r});await c(Q,this,xe).call(this,t,a),a=c(Q,this,ke).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await c(Q,this,je).call(this,{snapId:t,sourceCode:i});const o=this.getTruncatedExpect(t);return c(Q,this,Te).call(this,a.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(s){(0,m.logError)(`Error when adding ${t}.`,s);const r=s instanceof Error?s.message:s.toString();throw c(Q,this,Te).call(this,a.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:r}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!1,r),s}}function ke({origin:e,snapId:t,type:n}){const s=(0,w.nanoid)();return{id:s,promise:this.messenger.call("ApprovalController:addRequest",{origin:e,id:s,type:n,requestData:{metadata:{id:s,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function Te(e,t){try{this.messenger.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function Pe({origin:e,snapId:t,location:s,versionRange:r,automaticUpdate:i=!1}){i||c(Q,this,le).call(this),await c(Q,this,ue).call(this);const a=this.getExpect(t),{preinstalled:o,removable:l,hidden:u,hideSnapBranding:d}=a;if(o&&!i)throw new Error("Preinstalled Snaps cannot be manually updated.");let f=i?null:c(Q,this,ke).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messenger.publish("SnapController:snapInstallStarted",t,e,!0);const b=a.manifest,y=await(0,I.fetchSnap)(t,s),{sourceCode:w,manifest:v}=y,S=v.result,_=S.version;if(!(0,g.gtVersion)(_,a.version))throw p.rpcErrors.invalidParams(`Snap "${t}@${a.version}" is already installed. Couldn't update to a version inside requested "${r}" range.`);if(!(0,g.satisfiesVersionRange)(_,r))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${_}" which doesn't satisfy requested version range "${r}".`);await c(Q,this,ce).call(this,t,{version:_,checksum:S.source.shasum,permissions:S.initialPermissions,platformVersion:S.platformVersion});const E=(0,h.processSnapPermissions)(S.initialPermissions);c(Q,this,Re).call(this,E);const{newPermissions:k,unusedPermissions:T,approvedPermissions:P}=c(Q,this,et).call(this,t,E),{newConnections:A,unusedConnections:j,approvedConnections:O}=c(Q,this,nt).call(this,t,b.initialConnections??{},S.initialConnections??{});let M,R;if(f){c(Q,this,Te).call(this,f.id,{permissions:k,newVersion:S.version,newPermissions:k,approvedPermissions:P,unusedPermissions:T,newConnections:A,unusedConnections:j,approvedConnections:O,loading:!1});const{permissions:s,...r}=await f.promise;M=s,R=r,f=c(Q,this,ke).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT})}else(0,g.assert)(i),M=k;this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),c(Q,this,pe).call(this,t,m.SnapStatusEvents.Update),c(Q,this,Me).call(this,{origin:e,id:t,files:y,removable:l,preinstalled:o,hidden:u,hideSnapBranding:d,isUpdate:!0}),c(Q,this,st).call(this,{snapId:t,unusedPermissions:T,newPermissions:M,requestData:R});const C=b.initialConnections??null,x=S.initialConnections??{};c(Q,this,we).call(this,t,C,x);const N=c(Q,this,Ke).call(this,t);N!==undefined&&(N.permissions.revoked=T,N.permissions.granted=M,N.permissions.requestData=R,N.previousInitialConnections=C,N.newInitialConnections=x);const L=w.toString();(0,g.assert)("string"==typeof L&&L.length>0,`Invalid source code for snap "${t}".`);try{await c(Q,this,je).call(this,{snapId:t,sourceCode:L})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const $=this.getTruncatedExpect(t);return f&&c(Q,this,Te).call(this,f.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),$}catch(s){(0,m.logError)(`Error when updating ${t},`,s);const r=s instanceof Error?s.message:s.toString();throw f&&c(Q,this,Te).call(this,f.id,{loading:!1,error:r,type:n.SNAP_APPROVAL_UPDATE}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!0,r),s}}async function Ae(e,t){return await this.messenger.call("SnapsRegistry:resolveVersion",e,t)}async function Ie(e){const{id:t,location:n,versionRange:s}=e;c(Q,this,Ze).call(this,t);const r=c(Q,this,Xe).call(this,t);r.installPromise||((0,A.log)(`Adding snap: ${t}`),r.installPromise=(async()=>{const r=await(0,I.fetchSnap)(t,n),i=r.manifest.result;if(!(0,g.satisfiesVersionRange)(i.version,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${i.version}" which doesn't satisfy requested version range "${s}".`);await c(Q,this,ce).call(this,t,{version:i.version,checksum:i.source.shasum,permissions:i.initialPermissions,platformVersion:i.platformVersion});const o=a(L,this).forcePreinstalledSnaps&&(0,I.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(Q,this,Me).call(this,{...e,files:r,id:t,...o})})());try{return await r.installPromise}catch(e){throw r.installPromise=null,e}}async function je(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=c(Q,this,Xe).call(this,t),s=await this.messenger.call("ExecutionService:executeSnap",{...e,endowments:await c(Q,this,Oe).call(this,t)});return c(Q,this,pe).call(this,t,m.SnapStatusEvents.Start),n.lastRequest=Date.now(),s}catch(e){throw await c(Q,this,he).call(this,t),e}}async function Oe(e){let t=[];for(const n of a(x,this))if(this.messenger.call("PermissionController:hasPermission",e,n)){const s=await this.messenger.call("PermissionController:getEndowments",e,n);if(s){if(!Array.isArray(s)||s.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(s)}}const n=[...new Set([...m.DEFAULT_ENDOWMENTS,...t])];return n.length<m.DEFAULT_ENDOWMENTS.length+t.length&&(0,m.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function Me(e){const{id:t,origin:n,files:s,isUpdate:r=!1,removable:i,preinstalled:o,hidden:l,hideSnapBranding:u}=e,{manifest:p,sourceCode:h,svgIcon:f,auxiliaryFiles:b,localizationFiles:y}=s;(0,m.assertIsSnapManifest)(p.result);const{version:w}=p.result,v=h.toString();(0,g.assert)("string"==typeof v&&v.length>0,`Invalid source code for snap "${t}".`);const S=b.map(e=>((0,g.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),_=this.state.snaps[t],E=[...(null==_?void 0:_.versionHistory)??[],{version:w,date:Date.now(),origin:n}],k=y.map(e=>e.result),T={..._,blocked:!1,enabled:!0,removable:i,preinstalled:o,hidden:l,hideSnapBranding:u,id:t,initialConnections:p.result.initialConnections,initialPermissions:p.result.initialPermissions,manifest:p.result,status:a(Y,this).config.initial,sourceCode:v,version:w,versionHistory:E,auxiliaryFiles:S,localizationFiles:k};delete T.blockInformation;const{inversePatches:P}=this.update(e=>{e.snaps[t]=T});if(r){const e=c(Q,this,Ke).call(this,t);e!==undefined&&(e.statePatches=P)}const{proposedName:A}=(0,m.getLocalizedSnapManifest)(p.result,"en",k);return this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:A,origin:T.id,version:w,svgIcon:(null==f?void 0:f.toString())??null}),{...T,sourceCode:v}}function Re(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(h.handlerEndowments)));(0,g.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const s=t.reduce((e,t)=>((0,g.hasProperty)(a(N,this),t)&&e.push(a(N,this)[t]),e),[]);(0,g.assert)(0===s.length,`One or more permissions are not allowed:\n${s.join("\n")}`)}function Ce(e,t){if(t!==undefined&&(0,v.gt)(t,(0,m.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,m.getPlatformVersion)()}".`;if(a(L,this).rejectInvalidPlatformVersion)throw new Error(n);(0,m.logWarning)(n)}}async function xe(e,t){(0,A.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:s,initialConnections:r}=n;try{const i=(0,h.processSnapPermissions)(s);c(Q,this,Re).call(this,i),c(Q,this,Te).call(this,t.id,{loading:!1,connections:r??{},permissions:i});const{permissions:a,...o}=await t.promise;c(Q,this,st).call(this,{snapId:e,newPermissions:a,requestData:o}),n.manifest.initialConnections&&c(Q,this,we).call(this,e,null,n.manifest.initialConnections)}finally{c(Q,this,Xe).call(this,e).installPromise=null}}function Ne(e){return(0,h.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function Le(e,t,n){return this.messenger.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function $e(e,t){(0,g.assert)(this.messenger.call("SnapInterfaceController:getInterface",e,t))}async function De(e,t,n,s){switch(t){case m.HandlerType.OnTransaction:case m.HandlerType.OnSignature:case m.HandlerType.OnHomePage:case m.HandlerType.OnSettingsPage:{const t=s;if(t&&(0,g.hasProperty)(t,"content")){const{content:n,...s}=t;return{...s,id:await c(Q,this,Le).call(this,e,n)}}return s}case m.HandlerType.OnAssetsLookup:return c(Q,this,Ue).call(this,e,n,s);case m.HandlerType.OnAssetsConversion:return c(Q,this,qe).call(this,n,s);case m.HandlerType.OnAssetsMarketData:return c(Q,this,We).call(this,n,s);default:return s}}function Ue(e,{params:t},{assets:n}){const s=this.messenger.call("PermissionController:getPermissions",e);(0,g.assert)(s);const r=s[h.SnapEndowments.Assets],i=(0,h.getChainIdsCaveat)(r);(0,g.assert)(i);const{assets:a}=t;return{assets:Object.keys(n).reduce((e,t)=>{const s=t;return i.some(e=>s.startsWith(e))&&a.includes(s)&&(e[s]=n[s]),e},{})}}function qe({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var s;const r=null===(s=t[n.from])||void 0===s?void 0:s[n.to];var i;r&&(e[i=n.from]??(e[i]={}),e[n.from][n.to]=r);return e},{})}}function We({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var s;const r=null===(s=t[n.asset])||void 0===s?void 0:s[n.unit];var i;r&&(e[i=n.asset]??(e[i]={}),e[n.asset][n.unit]=r);return e},{})}}function He(e,t,n){if(t===m.HandlerType.OnUserInput){(0,g.assert)(n.params&&(0,g.hasProperty)(n.params,"id"));const t=n.params.id,{context:s}=this.messenger.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:s}}}return n}async function Fe(e,t,n){switch(t){case m.HandlerType.OnTransaction:(0,g.assertStruct)(n,m.OnTransactionResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case m.HandlerType.OnSignature:(0,g.assertStruct)(n,m.OnSignatureResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case m.HandlerType.OnHomePage:(0,g.assertStruct)(n,m.OnHomePageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case m.HandlerType.OnSettingsPage:(0,g.assertStruct)(n,m.OnSettingsPageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Q,this,$e).call(this,e,n.id);break;case m.HandlerType.OnNameLookup:(0,g.assertStruct)(n,m.OnNameLookupResponseStruct);break;case m.HandlerType.OnAssetsLookup:(0,g.assertStruct)(n,f.OnAssetsLookupResponseStruct);break;case m.HandlerType.OnAssetsConversion:(0,g.assertStruct)(n,m.OnAssetsConversionResponseStruct);break;case m.HandlerType.OnAssetHistoricalPrice:(0,g.assertStruct)(n,m.OnAssetHistoricalPriceResponseStruct);break;case m.HandlerType.OnAssetsMarketData:(0,g.assertStruct)(n,m.OnAssetsMarketDataResponseStruct)}}function Ve(e,t,n){const s=c(Q,this,Xe).call(this,e);s.pendingInboundRequests.push({requestId:t,timer:n}),s.lastRequest=null}function Be(e,t,n,s,r){const i=c(Q,this,Xe).call(this,e);i.pendingInboundRequests=i.pendingInboundRequests.filter(e=>e.requestId!==t),0===i.pendingInboundRequests.length&&(i.lastRequest=Date.now());const o=this.get(e);if((0,I.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{a(X,this).call(this,e,n,r,s)}catch(e){(0,m.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,f.getErrorMessage)(e)}`)}}function Ke(e){return a(K,this).get(e)}function ze(e){(0,g.assert)(a(K,this).get(e)===undefined,`Snap "${e}" rollback snapshot already exists.`),a(K,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=a(K,this).get(e);return(0,g.assert)(t!==undefined,`Snapshot creation failed for ${e}.`),t}async function Ye(e){var t,n;const s=c(Q,this,Ke).call(this,e);if(!s)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,m.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==m.SnapStatus.Stopped&&c(Q,this,pe).call(this,e,m.SnapStatusEvents.Stop);const{statePatches:r,permissions:i,previousInitialConnections:o,newInitialConnections:l}=s;null!=r&&r.length&&this.applyPatches(r),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==m.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=m.SnapStatus.Stopped}),c(Q,this,st).call(this,{snapId:e,unusedPermissions:i.granted,newPermissions:i.revoked,requestData:i.requestData}),c(Q,this,we).call(this,e,l??null,o??{});const u=this.getTruncatedExpect(e);this.messenger.publish("SnapController:snapRolledback",u,s.newVersion),a(K,this).delete(e)}async function Ge(e){for(const t of e)await c(Q,this,Ye).call(this,t)}function Je(e){return a(B,this).get(e)}function Xe(e){const t=c(Q,this,Je).call(this,e);return(0,g.assert)(t!==undefined,`Snap "${e}" runtime data not found`),t}function Ze(e){if(a(B,this).has(e))return;const t=this.get(e),n=(0,b.interpret)(a(Y,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??a(Y,this).config.initial}),(0,P.forceStrict)(n),a(B,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new y.Mutex,getStateMutex:new y.Mutex})}function Qe(e,t){return Object.keys(e).reduce((n,s)=>{if(a(C,this).includes(s)){var r;const i=(0,g.hasProperty)(S.DYNAMIC_PERMISSION_DEPENDENCIES,s),a=null===(r=S.DYNAMIC_PERMISSION_DEPENDENCIES[s])||void 0===r?void 0:r.some(e=>(0,g.hasProperty)(t,e));i&&!a||(n[s]=e[s])}return n},t)}function et(e,t){const n=this.messenger.call("PermissionController:getPermissions",e)??{},s=c(Q,this,Qe).call(this,n,t),r=(0,I.permissionsDiff)(s,n),i=(0,I.permissionsDiff)(n,s);return{newPermissions:r,unusedPermissions:i,approvedPermissions:(0,I.permissionsDiff)(n,i)}}function tt(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",t),i=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);return Boolean(null==i||null===(s=i.value)||void 0===s?void 0:s[e])}function nt(e,t,n){const s=Object.keys(t).filter(t=>c(Q,this,tt).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),r=(0,I.setDiff)(n,s),i=(0,I.setDiff)(s,n);return{newConnections:r,unusedConnections:i,approvedConnections:(0,I.setDiff)(s,i)}}function st({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:s}){const r=Object.keys(t);(0,g.isNonEmptyArray)(r)&&this.messenger.call("PermissionController:revokePermissions",{[e]:r}),(0,g.isNonEmptyArray)(Object.keys(n))&&this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:n,subject:{origin:e},requestData:s})}function rt(e,t){const n=this.getExpect(e);return!(0,g.satisfiesVersionRange)(n.version,t)&&!(0,g.gtRange)(n.version,t)}function it(e,t){const n=this.getRunnableSnaps();for(const{id:s}of n){this.messenger.call("PermissionController:hasPermission",s,h.SnapEndowments.LifecycleHooks)&&c(Q,this,at).call(this,e,s,t).catch(e=>{(0,m.logError)(`Error calling lifecycle hook "${t}" for Snap "${s}": ${(0,f.getErrorMessage)(e)}`)})}}async function at(e,t,n){const s=h.handlerEndowments[n];(0,g.assert)(s,"Lifecycle hook must have an endowment.");this.messenger.call("PermissionController:hasPermission",t,s)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function ot(){for(const e of a(B,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=te}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[2769,{"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const r=e("@metamask/utils");n.Timer=class{constructor(e){s(this,"state",void 0),(0,r.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,r.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,r.assert)("paused"===this.status||"running"===this.status,"Tried to cancel a not running Timer"),this.onFinish(!1)}finish(){(0,r.assert)("finished"!==this.status,"Tried to finish a finished Timer."),this.onFinish(!0)}pause(){(0,r.assert)("running"===this.state.value,"Tried to pause a not running Timer");const{callback:e,start:t,timeout:n,remaining:s}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:s-(Date.now()-t)}}start(e){(0,r.assert)("stopped"===this.state.value,"Tried to start an already running Timer");const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,r.assert)("paused"===this.state.value,"Tried to resume not paused Timer");const{remaining:e,callback:t}=this.state,n=Date.now();let s;e!==Number.POSITIVE_INFINITY&&(s=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:s}}onFinish(e){(0,r.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[277,{"../../../../shared/constants/metametrics":5892},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEvent=function({signature:e,url:t}){const n={route:t.pathname,signature:e},i={};for(const[e,s]of t.searchParams.entries())"sig"!==e&&("attributionId"===e?n.attribution_id=s:r.has(e)?n[e]=s:i[e]=s);return{category:s.MetaMetricsEventCategory.DeepLink,event:s.MetaMetricsEventName.DeepLinkUsed,properties:n,sensitiveProperties:i}};var s=e("../../../../shared/constants/metametrics");const r=new Set(["utm_campaign","utm_content","utm_medium","utm_source","utm_term"])}}},{package:"$root$",file:"app/scripts/lib/deep-links/metrics.ts"}],[2770,{"@metamask/snaps-rpc-methods":2821,"@metamask/snaps-utils":2994},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DYNAMIC_PERMISSION_DEPENDENCIES=n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const s=e("@metamask/snaps-rpc-methods"),r=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",s.SnapEndowments.Cronjob,s.SnapEndowments.HomePage,s.SnapEndowments.LifecycleHooks,s.SnapEndowments.EthereumProvider,s.SnapEndowments.TransactionInsight,s.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([r.HandlerType.OnClientRequest,r.HandlerType.OnSignature,r.HandlerType.OnTransaction,r.HandlerType.OnCronjob,r.HandlerType.OnNameLookup,r.HandlerType.OnHomePage,r.HandlerType.OnSettingsPage,r.HandlerType.OnUserInput,r.HandlerType.OnAssetsLookup,r.HandlerType.OnAssetsConversion,r.HandlerType.OnAssetHistoricalPrice,r.HandlerType.OnAssetsMarketData,r.HandlerType.OnWebSocketEvent]),n.DYNAMIC_PERMISSION_DEPENDENCIES=Object.freeze({"endowment:caip25":["endowment:ethereum-provider"]})}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2771,{"./SnapController.cjs":2768,"./constants.cjs":2770,"./location/index.cjs":2773,"./registry/index.cjs":2777,"./selectors.cjs":2780},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./constants.cjs"),n),r(e("./location/index.cjs"),n),r(e("./SnapController.cjs"),n),r(e("./selectors.cjs"),n),r(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2772,{"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const r=e("@metamask/snaps-utils"),i=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){s(this,"cache",new Map),s(this,"validatedManifest",void 0),s(this,"url",void 0),s(this,"fetchFn",void 0),s(this,"fetchOptions",void 0),(0,i.assertStruct)(e.toString(),r.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(r.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),s=(0,r.parseJson)(n),i=new r.VirtualFile({value:n,result:(0,r.createSnapManifest)(s),path:r.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=i,this.manifest()}async fetch(e){const t=(0,r.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const s=this.toCanonical(t).toString(),a=await this.fetchFn(s,this.fetchOptions);if(!a.ok)throw new Error(`Failed to fetch "${s}". Status code: ${a.status}.`);const o=await a.arrayBuffer(),c=new r.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:s}});return(0,i.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,i.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[2773,{"./http.cjs":2772,"./local.cjs":2774,"./location.cjs":2775,"./npm.cjs":2776},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./location.cjs"),n),r(e("./npm.cjs"),n),r(e("./local.cjs"),n),r(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2774,{"./http.cjs":2772,"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const a=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,r,u;s(this,l,void 0),(0,o.assertStruct)(e.toString(),a.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=l,r=this,u=new c.HttpLocation(new URL(e.toString().slice(a.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(i(n,r),u)}async manifest(){return u(await r(l,this).manifest())}async fetch(e){return u(await r(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[2775,{"./http.cjs":2772,"./local.cjs":2774,"./npm.cjs":2776,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const s=e("@metamask/utils"),r=e("./http.cjs"),i=e("./local.cjs"),a=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new a.NpmLocation(c,t);case"local:":return(0,s.assert)(o,new TypeError("Fetching local snaps is disabled.")),new i.LocalLocation(c,t);case"http:":case"https:":return(0,s.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new r.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2776,{"@metamask/snaps-utils":2994,"@metamask/utils":3207,"concat-stream":2784,"get-npm-tarball-url":4528,"readable-stream":2799,"readable-web-to-node-stream":5385,"tar-stream":5774},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n){return e.set(c(e,t),n),n}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.NPM_REGISTRY_PROXY=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=l(e("concat-stream")),h=l(e("get-npm-tarball-url")),f=e("readable-stream"),m=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org"),n.NPM_REGISTRY_PROXY=new URL("https://npm-ota.api.cx.metamask.io");var b=new WeakMap,y=new WeakMap,w=new WeakSet;class v{constructor(e,t={}){var a,o;r(a=this,o=w),o.add(a),i(this,"meta",void 0),s(this,b,void 0),s(this,y,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),p=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,h=t.resolveVersion??(async e=>e);let f;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?f=t.useNpmProxy?n.NPM_REGISTRY_PROXY:n.DEFAULT_NPM_REGISTRY:(f="https://",e.username&&(f+=e.username,e.password&&(f+=`:${e.password}`),f+="@"),f+=e.host,f=new URL(f),(0,d.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${f.toString()}".`))),(0,d.assert)("/"===f.pathname&&""===f.search&&""===f.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let m=e.pathname;m.startsWith("/")&&(m=m.slice(1)),this.meta={requestedRange:p,registry:f,packageName:m,fetch:l,resolveVersion:h}}async manifest(){if(o(b,this))return o(b,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),a(b,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(y,this)||(await c(w,this,S).call(this),(0,d.assert)(o(y,this)!==undefined));const n=o(y,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function S(){(0,d.assert)(o(y,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,s){var r;if(k(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,h.default)(e,t),targetVersion:t};const i=await _(e,n,s),a=Object.keys((null==i?void 0:i.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(a,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==i||null===(r=i.versions)||void 0===r||null===(r=r[o])||void 0===r||null===(r=r.dist)||void 0===r?void 0:r.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const s=new URL(t);s.hostname=this.meta.registry.hostname,s.protocol=this.meta.registry.protocol;const r=await this.fetchNpmTarball(s);a(y,this,r),this.meta.version=n}n.BaseNpmLocation=v,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function _(e,t,n){const s=await n(new URL(e,t).toString(),{headers:{accept:k(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${s.status}.`);const r=await s.json();if(!(0,d.isObject)(r))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return r}function E(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function k(e){const t=e.toString();return t===n.DEFAULT_NPM_REGISTRY.toString()||t===n.NPM_REGISTRY_PROXY.toString()}n.NpmLocation=class extends v{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());(0,d.assert)(404!==t.status,`"${this.meta.packageName}" was not found in the NPM registry`),(0,d.assert)(t.ok&&t.body,`Failed to fetch tarball for package "${this.meta.packageName}"`);const s=t.headers.get("content-length");(0,d.assert)(s,"Snap tarball has invalid content-length");const r=parseInt(s,10);return(0,d.assert)(r<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,s)=>{const r=new Map,i=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const s=(0,g.extract)();let r=0;return s.on("entry",(i,a,o)=>{const{name:c,type:l}=i;if("file"===l){const i=c.replace(T,"");return a.pipe((0,p.default)({encoding:"uint8array"},a=>{try{r+=a.byteLength,(0,d.assert)(r<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const s=new u.VirtualFile({value:a,path:i,data:{canonicalPath:new URL(i,e).toString()}});return(0,d.assert)(!t.has(i),"Malformed tarball, multiple files with the same path."),t.set(i,s),o()}catch(e){return s.destroy(e)}}))}return a.on("end",()=>o()),a.resume()}),s}(E(this.meta.registry,this.meta.packageName),r),a=t.body,o=new DecompressionStream("gzip"),c=a.pipeThrough(o);(0,f.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new m.ReadableWebToNodeStream(e)}(c),i,t=>{t?s(t):e(r)})})}},n.fetchNpmMetadata=_,n.getNpmCanonicalBasePath=E;const T=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2777,{"./json.cjs":2778,"./registry.cjs":2779},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./registry.cjs"),n),r(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[2778,{"./registry.cjs":2779,"@metamask/base-controller":1401,"@metamask/snaps-registry":2800,"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("./registry.cjs"),h={database:null,signature:null,lastUpdated:null,databaseUnavailable:!1};var f=new WeakMap,m=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,S=new WeakSet;class _ extends c.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:i="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",clientConfig:c,fetchFunction:l=globalThis.fetch.bind(undefined),recentFetchThreshold:u=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:p=!0}){var _,E;super({messenger:e,metadata:{database:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},signature:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},lastUpdated:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},databaseUnavailable:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}},name:"SnapsRegistry",state:{...h,...t}}),r(_=this,E=S),E.add(_),s(this,f,void 0),s(this,m,void 0),s(this,g,void 0),s(this,b,void 0),s(this,y,void 0),s(this,w,void 0),s(this,v,void 0),a(f,this,n),a(m,this,i),a(g,this,c),a(b,this,l),a(y,this,u),a(w,this,p),a(v,this,null),this.messenger.registerActionHandler("SnapsRegistry:get",async(...e)=>o(S,this,I).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(S,this,O).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(S,this,j).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:update",async()=>o(S,this,k).call(this))}}function E(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<i(y,this)}async function k(){i(v,this)?await i(v,this):(null===i(v,this)&&a(v,this,o(S,this,T).call(this)),await i(v,this),a(v,this,null))}async function T(){if(!o(S,this,E).call(this))try{const[e,t]=await Promise.all([o(S,this,R).call(this,i(f,this).registry),o(S,this,R).call(this,i(f,this).signature)]),n=JSON.parse(t);if(n.signature===this.state.signature)return void this.update(e=>{e.lastUpdated=Date.now(),e.databaseUnavailable=!1});await o(S,this,M).call(this,e,n),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1,t.signature=n.signature})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function P(){return null===this.state.database&&await o(S,this,k).call(this),this.state.database}async function A(e,t,n=!1){var s,r;const a=await o(S,this,P).call(this),c=null==a?void 0:a.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(c)return{status:p.SnapsRegistryStatus.Blocked,reason:c.reason};const l=null==a?void 0:a.verifiedSnaps[e],u=null==l||null===(s=l.versions)||void 0===s?void 0:s[t.version],h=null==u||null===(r=u.clientVersions)||void 0===r?void 0:r[i(g,this).type],f=!h||(0,d.satisfiesVersionRange)(i(g,this).version,h);return u&&u.checksum===t.checksum&&f?{status:p.SnapsRegistryStatus.Verified}:i(w,this)&&!n?(await o(S,this,k).call(this),o(S,this,A).call(this,e,t,!0)):{status:this.state.databaseUnavailable?p.SnapsRegistryStatus.Unavailable:p.SnapsRegistryStatus.Unverified}}async function I(e){return Object.entries(e).reduce(async(e,[t,n])=>{const s=await o(S,this,A).call(this,t,n),r=await e;return r[t]=s,r},Promise.resolve({}))}async function j(e,t,n=!1){var s;const r=await o(S,this,P).call(this),a=(null==r||null===(s=r.verifiedSnaps[e])||void 0===s?void 0:s.versions)??null;if(!a&&i(w,this)&&!n)return await o(S,this,k).call(this),o(S,this,j).call(this,e,t,!0);if(!a)return t;const c=Object.entries(a).reduce((e,[t,n])=>{var s;const r=null===(s=n.clientVersions)||void 0===s?void 0:s[i(g,this).type];return r&&!(0,d.satisfiesVersionRange)(i(g,this).version,r)||e.push(t),e},[]),l=(0,u.getTargetVersion)(c,t);return l||!i(w,this)||n?l?((0,d.assertIsSemVerRange)(l),l):t:(await o(S,this,k).call(this),o(S,this,j).call(this,e,t,!0))}function O(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}async function M(e,t){(0,d.assert)(i(m,this),"No public key provided.");const n=await(0,l.verify)({registry:e,signature:t,publicKey:i(m,this)});(0,d.assert)(n,"Invalid registry signature.")}async function R(e){const t=await i(b,this).call(this,e,{cache:"no-cache"});if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=_}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[2779,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(s||(n.SnapsRegistryStatus=s={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[278,{"@metamask/browser-passworder":1456},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.encryptorFactory=void 0;var s=e("@metamask/browser-passworder");const r=e=>async(t,n,r,i)=>(0,s.encrypt)(t,n,r,i,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,n,r)=>(0,s.encryptWithDetail)(t,n,r,{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>async(t,n,r,i)=>(0,s.keyFromPassword)(t,n,r,i??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,s.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});n.encryptorFactory=e=>({encrypt:r(e),encryptWithKey:s.encryptWithKey,encryptWithDetail:i(e),decrypt:s.decrypt,decryptWithKey:s.decryptWithKey,decryptWithDetail:s.decryptWithDetail,keyFromPassword:a(e),isVaultUpdated:o(e),importKey:s.importKey,exportKey:s.exportKey,generateSalt:s.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[2780,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2781,{"./snaps/Timer.cjs":2769,"@metamask/snaps-sdk":2877,"@metamask/snaps-utils":2994,"fast-deep-equal":4484},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const r=e("@metamask/snaps-sdk"),i=e("@metamask/snaps-utils"),a=s(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let n;const s=new Promise((s,r)=>{e.start(()=>{t===undefined?s():s(t)}),n=r});return s.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},s}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>(n in t||(e[n]=s),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>{const r=n in t;return(!r||r&&!(0,a.default)(s.caveats??[],t[n].caveats??[]))&&(e[n]=s),e},{})},n.delay=function(e,t){return c(new o.Timer(e),t)},n.delayWithTimer=c,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const s=c("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}},n.getSnapFiles=l,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,r.assert)(n.size<i.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:s}=e.result.source.location.npm,a=s?await t.fetch(s):undefined,o=await l(t,e.result.source.files);(0,i.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,i.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:a,auxiliaryFiles:o,localizationFiles:(0,i.getValidatedLocalizationFiles)(c)};return await(0,i.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,r.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(s,r,i)=>{const a=`${s}-${i}`;n.has(a)&&clearTimeout(n.get(a)),n.set(a,setTimeout(()=>{e(s,r,i),n.delete(a)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([i.HandlerType.OnHomePage,i.HandlerType.OnInstall,i.HandlerType.OnNameLookup,i.HandlerType.OnRpcRequest,i.HandlerType.OnSignature,i.HandlerType.OnTransaction,i.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,s=new Map;return(r,i,a,o)=>{const c=`${r}${i}${a}${o}`,l=Date.now(),u=n.get(c)??0,d=[r,i,a,o];if(l-u>=t)return n.set(c,l),void e(...d);const p=s.get(c);null!=p&&p.timer&&clearTimeout(p.timer),n.set(c,l),s.set(c,{args:d,timer:setTimeout(()=>{e(...d),s.delete(c)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2782,{"../snaps/index.cjs":2771,"@metamask/rpc-errors":2692,"@metamask/snaps-utils":2994,"@metamask/utils":3207,nanoid:5139},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("nanoid"),h=e("../snaps/index.cjs"),f="WebSocketService";var m=new WeakMap,g=new WeakMap,b=new WeakSet;function y(e,t){const n=a(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function w(e,t,n){return c(b,this,T).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function v(e,t){a(m,this).call("SnapController:handleRequest",{origin:h.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function S(e,t,n=[]){(0,d.assert)(!c(b,this,w).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const s=new URL(t),{origin:r}=s,i=(0,p.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:h,reject:f}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{h(),c(b,this,v).call(this,e,{type:"open",id:i,origin:r})}),o.addEventListener("close",t=>{a(g,this).delete(i),c(b,this,v).call(this,e,{type:"close",id:i,origin:r,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const m=()=>{f(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",m),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(b,this,v).call(this,e,{type:"message",id:i,origin:r,data:n})}),a(g,this).set(i,{id:i,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",m),i}function _(e,t){const{socket:n}=c(b,this,y).call(this,e,t);n.close()}function E(e){for(const t of c(b,this,T).call(this,e))c(b,this,_).call(this,e,t.id)}async function k(e,t,n){const{socket:s,openPromise:r}=c(b,this,y).call(this,e,t);await r;const i=Array.isArray(n)?new Uint8Array(n):n;s.send(i)}function T(e){return[...a(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;r(t=this,n=b),n.add(t),i(this,"name",f),i(this,"state",null),s(this,m,void 0),s(this,g,void 0),o(m,this,e),o(g,this,new Map),a(m,this).registerActionHandler(`${f}:open`,async(...e)=>c(b,this,S).call(this,...e)),a(m,this).registerActionHandler(`${f}:close`,(...e)=>c(b,this,_).call(this,...e)),a(m,this).registerActionHandler(`${f}:sendMessage`,async(...e)=>c(b,this,k).call(this,...e)),a(m,this).registerActionHandler(`${f}:getAll`,(...e)=>c(b,this,T).call(this,...e)),a(m,this).subscribe("SnapController:snapUpdated",e=>{c(b,this,E).call(this,e.id)}),a(m,this).subscribe("SnapController:snapUninstalled",e=>{c(b,this,E).call(this,e.id)}),a(m,this).subscribe("SnapController:snapInstalled",e=>{c(b,this,E).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[2783,{"./WebSocketService.cjs":2782},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2784,{buffer:4176,"buffer-from":4182,inherits:4718,"readable-stream":2799,typedarray:5793},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("readable-stream").Writable,r=e("inherits"),i=e("buffer-from");if("undefined"==typeof Uint8Array)var a=e("typedarray").Uint8Array;else a=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,r=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):r=!0,s.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=r,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,r(o,s),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];"string"==typeof r||n.isBuffer(r)?t.push(r):c(r)?t.push(i(r)):t.push(i(String(r)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];n.isBuffer(r)?t.push(r):c(r)?t.push(i(r)):t.push(i(String(r)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=i(e[n])),t+=e[n].length;for(var s=new a(t),r=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)s[r++]=o[c];return s}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[2785,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s={};function r(e,t,n){n||(n=Error);var r=function(e){var n,s;function r(n,s,r){return e.call(this,function(e,n,s){return"string"==typeof t?t:t(e,n,s)}(n,s,r))||this}return s=e,(n=r).prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s,r}(n);r.prototype.name=n.name,r.prototype.code=e,s[e]=r}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,n){var s,r,a,o;if("string"==typeof t&&(r="not ",t.substr(!a||a<0?0:+a,r.length)===r)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(s," ").concat(i(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(s," ").concat(i(t,"type"))}return o+=". Received type ".concat(typeof n)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=s}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/errors-browser.js"}],[2786,{"./_stream_readable":2788,"./_stream_writable":2790,_process:5191,inherits:4718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=l;var r=e("./_stream_readable"),i=e("./_stream_writable");e("inherits")(l,r);for(var a=s(i.prototype),o=0;o<a.length;o++){var c=a[o];l.prototype[c]||(l.prototype[c]=i.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);r.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_duplex.js"}],[2787,{"./_stream_transform":2789,inherits:4718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=r;var s=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}e("inherits")(r,s),r.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_passthrough.js"}],[2788,{"../errors":2785,"./_stream_duplex":2786,"./internal/streams/async_iterator":2791,"./internal/streams/buffer_list":2792,"./internal/streams/destroy":2793,"./internal/streams/from":2795,"./internal/streams/state":2797,"./internal/streams/stream":2798,_process:5191,buffer:4176,events:4472,inherits:4718,"string_decoder/":5767,util:4128},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;t.exports=k,k.ReadableState=E;e("events").EventEmitter;var r=function(e,t){return e.listeners(t).length},i=e("./internal/streams/stream"),a=e("buffer").Buffer,o=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,l=e("util");c=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,p,h=e("./internal/streams/buffer_list"),f=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,b=g.ERR_INVALID_ARG_TYPE,y=g.ERR_STREAM_PUSH_AFTER_EOF,w=g.ERR_METHOD_NOT_IMPLEMENTED,v=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(k,i);var S=f.errorOrDestroy,_=["error","close","destroy","pause","resume"];function E(t,n,r){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof r&&(r=n instanceof s),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",r),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function k(t){if(s=s||e("./_stream_duplex"),!(this instanceof k))return new k(t);var n=this instanceof s;this._readableState=new E(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function T(e,t,n,s,r){c("readableAddChunk",t);var i,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?j(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,O(e)))}(e,l);else if(r||(i=function(e,t){var n;s=t,a.isBuffer(s)||s instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new b("chunk",["string","Buffer","Uint8Array"],t));var s;return n}(l,t)),i)S(e,i);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),s)l.endEmitted?S(e,new v):P(e,l,t,!0);else if(l.ended)S(e,new y);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?P(e,l,t,!1):M(e,l)):P(e,l,t,!1)}else s||(l.reading=!1,M(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function P(e,t,n,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&j(e)),M(e,t)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),k.prototype.destroy=f.destroy,k.prototype._undestroy=f.undestroy,k.prototype._destroy=function(e,t){t(e)},k.prototype.push=function(e,t){var n,s=this._readableState;return s.objectMode?n=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=a.from(e,t),t=""),n=!0),T(this,e,t,!1,n)},k.prototype.unshift=function(e){return T(this,e,null,!0,!1)},k.prototype.isPaused=function(){return!1===this._readableState.flowing},k.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var n=new u(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=n.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var A=1073741824;function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function j(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(O,e))}function O(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,L(e)}function M(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(R,e,t))}function R(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function C(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function x(e){c("readable nexttick read 0"),e.read(0)}function N(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function $(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function D(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(U,t,e))}function U(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function q(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1}k.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?D(this):j(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&D(this),null;var s,r=t.needReadable;return c("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",r=!0),t.ended||t.reading?c("reading or ended",r=!1):r&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(s=e>0?$(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&D(this)),null!==s&&this.emit("data",s),s},k.prototype._read=function(e){S(this,new w("_read()"))},k.prototype.pipe=function(e,t){var s=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:g;function o(t,n){c("onunpipe"),t===s&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",f),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",h),e.removeListener("unpipe",o),s.removeListener("end",l),s.removeListener("end",g),s.removeListener("data",p),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function l(){c("onend"),e.end()}i.endEmitted?n.nextTick(a):s.once("end",a),e.on("unpipe",o);var u=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&r(e,"data")&&(t.flowing=!0,L(e))}}(s);e.on("drain",u);var d=!1;function p(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==q(i.pipes,e))&&!d&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),s.pause())}function h(t){c("onerror",t),g(),e.removeListener("error",h),0===r(e,"error")&&S(e,t)}function f(){e.removeListener("finish",m),g()}function m(){c("onfinish"),e.removeListener("close",f),g()}function g(){c("unpipe"),s.unpipe(e)}return s.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",f),e.once("finish",m),e.emit("pipe",s),i.flowing||(c("pipe resume"),s.resume()),e},k.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)s[i].emit("unpipe",this,{hasUnpiped:!1});return this}var a=q(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},k.prototype.on=function(e,t){var s=i.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?j(this):r.reading||n.nextTick(x,this))),s},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(e,t){var s=i.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(C,this),s},k.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(C,this),t},k.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(N,e,t))}(this,e)),e.paused=!1,this},k.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(e){var t=this,n=this._readableState,s=!1;for(var r in e.on("end",function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(r){(c("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&r!==undefined)&&((n.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause())))}),e)this[r]===undefined&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var i=0;i<_.length;i++)e.on(_[i],this.emit.bind(this,_[i]));return this._read=function(t){c("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(k.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),k._fromList=$,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(k.from=function(t,n){return p===undefined&&(p=e("./internal/streams/from")),p(k,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_readable.js"}],[2789,{"../errors":2785,"./_stream_duplex":2786,inherits:4718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=u;var s=e("../errors").codes,r=s.ERR_METHOD_NOT_IMPLEMENTED,i=s.ERR_MULTIPLE_CALLBACK,a=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function l(e,t){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(null===s)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush(function(t,n){p(e,t,n)})}function p(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var s=this._transformState;if(s.writecb=n,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,function(e){t(e)})}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_transform.js"}],[279,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[2790,{"../errors":2785,"./_stream_duplex":2786,"./internal/streams/destroy":2793,"./internal/streams/state":2797,"./internal/streams/stream":2798,_process:5191,buffer:4176,inherits:4718,"util-deprecate":5831},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(n),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}var r;t.exports=k,k.WritableState=E;var i={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),o=e("buffer").Buffer,c=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,p=e("../errors").codes,h=p.ERR_INVALID_ARG_TYPE,f=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,g=p.ERR_STREAM_CANNOT_PIPE,b=p.ERR_STREAM_DESTROYED,y=p.ERR_STREAM_NULL_VALUES,w=p.ERR_STREAM_WRITE_AFTER_END,v=p.ERR_UNKNOWN_ENCODING,S=u.errorOrDestroy;function _(){}function E(t,i,a){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof a&&(a=i instanceof r),this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var s=e._writableState,r=s.sync,i=s.writecb;if("function"!=typeof i)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(s),t)!function(e,t,s,r,i){--t.pendingcb,s?(n.nextTick(i,r),n.nextTick(O,e,t),e._writableState.errorEmitted=!0,S(e,r)):(i(r),e._writableState.errorEmitted=!0,S(e,r),O(e,t))}(e,s,r,t,i);else{var a=I(s)||e.destroyed;a||s.corked||s.bufferProcessing||!s.bufferedRequest||A(e,s),r?n.nextTick(P,e,s,a,i):P(e,s,a,i)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function k(t){var n=this instanceof(r=r||e("./_stream_duplex"));if(!n&&!l.call(k,this))return new k(t);this._writableState=new E(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function T(e,t,n,s,r,i,a){t.writelen=s,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):n?e._writev(r,t.onwrite):e._write(r,i,t.onwrite),t.sync=!1}function P(e,t,n,s){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),O(e,t)}function A(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var o=0,c=!0;n;)i[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;i.allBuffers=c,T(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,d=n.callback;if(T(e,t,!1,t.objectMode?1:l.length,l,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function j(e,t){e._final(function(n){t.pendingcb--,n&&S(e,n),t.prefinished=!0,e.emit("prefinish"),O(e,t)})}function O(e,t){var s=I(t);if(s&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(j,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return s}e("inherits")(k,a),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===k&&(e&&e._writableState instanceof E)}})):l=function(e){return e instanceof this},k.prototype.pipe=function(){S(this,new g)},k.prototype.write=function(e,t,s){var r,i=this._writableState,a=!1,l=!i.objectMode&&(r=e,o.isBuffer(r)||r instanceof c);return l&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(s=t,t=null),l?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof s&&(s=_),i.ending?function(e,t){var s=new w;S(e,s),n.nextTick(t,s)}(this,s):(l||function(e,t,s,r){var i;return null===s?i=new y:"string"==typeof s||t.objectMode||(i=new h("chunk",["string","Buffer"],s)),!i||(S(e,i),n.nextTick(r,i),!1)}(this,i,e,s))&&(i.pendingcb++,a=function(e,t,n,s,r,i){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,s,r);s!==a&&(n=!0,r="buffer",s=a)}var c=t.objectMode?1:s.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:n,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,c,s,r,i);return l}(this,i,l,e,t,s)),a},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},k.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(e,t,n){n(new f("_write()"))},k.prototype._writev=null,k.prototype.end=function(e,t,s){var r=this._writableState;return"function"==typeof e?(s=e,e=null,t=null):"function"==typeof t&&(s=t,t=null),null!==e&&e!==undefined&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,s){t.ending=!0,O(e,t),s&&(t.finished?n.nextTick(s):e.once("finish",s));t.ended=!0,e.writable=!1}(this,r,s),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),k.prototype.destroy=u.destroy,k.prototype._undestroy=u.undestroy,k.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_writable.js"}],[2791,{"./end-of-stream":2794,_process:5191},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=e("./end-of-stream"),a=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function f(e){var t=e[a];if(null!==t){var n=e[p].read();null!==n&&(e[u]=null,e[a]=null,e[o]=null,t(h(n,!1)))}}function m(e){n.nextTick(f,e)}var g=Object.getPrototypeOf(function(){}),b=Object.setPrototypeOf((r(s={get stream(){return this[p]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(h(undefined,!0));if(this[p].destroyed)return new Promise(function(t,s){n.nextTick(function(){e[c]?s(e[c]):t(h(undefined,!0))})});var s,r=this[u];if(r)s=new Promise(function(e,t){return function(n,s){e.then(function(){t[l]?n(h(undefined,!0)):t[d](n,s)},s)}}(r,this));else{var i=this[p].read();if(null!==i)return Promise.resolve(h(i,!1));s=new Promise(this[d])}return this[u]=s,s}},Symbol.asyncIterator,function(){return this}),r(s,"return",function(){var e=this;return new Promise(function(t,n){e[p].destroy(null,function(e){e?n(e):t(h(undefined,!0))})})}),s),g);t.exports=function(e){var t,n=Object.create(b,(r(t={},p,{value:e,writable:!0}),r(t,a,{value:null,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,c,{value:null,writable:!0}),r(t,l,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var s=n[p].read();s?(n[u]=null,n[a]=null,n[o]=null,e(h(s,!1))):(n[a]=e,n[o]=t)},writable:!0}),t));return n[u]=null,i(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[u]=null,n[a]=null,n[o]=null,t(e)),void(n[c]=e)}var s=n[a];null!==s&&(n[u]=null,n[a]=null,n[o]=null,s(h(undefined,!0))),n[l]=!0}),e.on("readable",m.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[2792,{buffer:4176,util:4128},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,o(s.key),s)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var c=e("buffer").Buffer,l=e("util").inspect,u=l&&l.custom||"inspect";function d(e,t,n){c.prototype.copy.call(e,t,n)}t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,s;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),n=this.head,s=0;n;)d(n.data,t,s),s+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,i=e>r.length?r.length:e;if(i===r.length?s+=r:s+=r.slice(0,e),0===(e-=i)){i===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(i));break}++n}return this.length-=n,s}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,s=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,i=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,i),0===(e-=i)){i===r.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(i));break}++s}return this.length-=s,t}},{key:u,value:function(e,t){return l(this,r(r({},t),{},{depth:0,customInspect:!1}))}}])&&a(t.prototype,n),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[2793,{_process:5191},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){r(e,t),s(e)}function s(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,i){var a=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!i&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(s,a):(a._writableState.errorEmitted=!0,e.nextTick(n,a,t)):e.nextTick(n,a,t):i?(e.nextTick(s,a),i(t)):e.nextTick(s,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,s=e._writableState;n&&n.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[2794,{"../../../errors":2785},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];e.apply(this,s)}}}(i||r);var a=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){o=!1,l=!0,a||i.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){a=!1,d=!0,o||i.call(t)},h=function(e){i.call(t,e)},f=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new s),i.call(t,e)):o&&!l?(t._writableState&&t._writableState.ended||(e=new s),i.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)),t.on("end",p),t.on("finish",u),!1!==n.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[2795,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[2796,{"../../../errors":2785,"./end-of-stream":2794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;var r=e("../../../errors").codes,i=r.ERR_MISSING_ARGS,a=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new i("streams");var p=n.map(function(t,r){var i=r<n.length-1;return function(t,n,r,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var o=!1;t.on("close",function(){o=!0}),s===undefined&&(s=e("./end-of-stream")),s(t,{readable:n,writable:r},function(e){if(e)return i(e);o=!0,i()});var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void i(e||new a("pipe"))}}(t,i,r>0,function(e){u||(u=e),e&&p.forEach(c),i||(p.forEach(c),d(u))})});return n.reduce(l)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[2797,{"../../../errors":2785},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,r){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new s(r?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/state.js"}],[2798,{events:4472},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[2799,{"./lib/_stream_duplex.js":2786,"./lib/_stream_passthrough.js":2787,"./lib/_stream_readable.js":2788,"./lib/_stream_transform.js":2789,"./lib/_stream_writable.js":2790,"./lib/internal/streams/end-of-stream.js":2794,"./lib/internal/streams/pipeline.js":2796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/readable-browser.js"}],[28,{"../../../../shared/modules/shield/config":6039,"@metamask/claims-controller":1478},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsServiceInit=void 0;var s=e("@metamask/claims-controller"),r=e("../../../../shared/modules/shield/config");n.ClaimsServiceInit=e=>{const{controllerMessenger:t}=e,{claimsEnv:n}=(0,r.loadShieldConfig)();return{controller:new s.ClaimsService({messenger:t,env:n,fetchFunction:fetch.bind(globalThis)}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-service-init.ts"}],[280,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[2800,{"./verify":2801,"@metamask/superstruct":3027,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const i=e("@metamask/superstruct"),a=e("@metamask/utils"),o=(0,i.refine)((0,i.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,i.object)({checksum:a.ChecksumStruct,clientVersions:(0,i.optional)((0,i.object)({extension:(0,i.optional)(a.VersionRangeStruct),mobile:(0,i.optional)(a.VersionRangeStruct)}))});n.AuthorStruct=(0,i.object)({name:(0,i.string)(),website:(0,i.string)()}),n.AuditStruct=(0,i.object)({auditor:(0,i.string)(),report:(0,i.string)()}),n.SupportStruct=(0,i.object)({knowledgeBase:(0,i.optional)((0,i.string)()),faq:(0,i.optional)((0,i.string)()),contact:(0,i.optional)((0,i.string)()),keyRecovery:(0,i.optional)((0,i.string)())}),n.AdditionalSourceCodeStruct=(0,i.object)({name:(0,i.string)(),url:(0,i.string)()}),n.ImagePathStruct=(0,i.pattern)((0,i.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,i.object)({id:o,metadata:(0,i.object)({name:(0,i.string)(),type:(0,i.optional)((0,i.enums)(["account"])),author:(0,i.optional)(n.AuthorStruct),website:(0,i.optional)((0,i.string)()),onboard:(0,i.optional)((0,i.boolean)()),summary:(0,i.optional)((0,i.string)()),description:(0,i.optional)((0,i.string)()),audits:(0,i.optional)((0,i.array)(n.AuditStruct)),category:(0,i.optional)((0,i.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,i.optional)((0,i.array)((0,i.string)())),support:(0,i.optional)(n.SupportStruct),sourceCode:(0,i.optional)((0,i.string)()),hidden:(0,i.optional)((0,i.boolean)()),privateCode:(0,i.optional)((0,i.boolean)()),privacyPolicy:(0,i.optional)((0,i.string)()),termsOfUse:(0,i.optional)((0,i.string)()),additionalSourceCode:(0,i.optional)((0,i.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,i.optional)((0,i.size)((0,i.array)(n.ImagePathStruct),3,3))}),versions:(0,i.record)(a.VersionStruct,c)}),n.BlockReasonStruct=(0,i.object)({explanation:(0,i.optional)((0,i.string)()),url:(0,i.optional)((0,i.string)())}),n.BlockedSnapStruct=(0,i.union)([(0,i.object)({id:o,versionRange:a.VersionRangeStruct,reason:(0,i.optional)(n.BlockReasonStruct)}),(0,i.object)({checksum:a.ChecksumStruct,reason:(0,i.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,i.object)({verifiedSnaps:(0,i.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,i.array)(n.BlockedSnapStruct)}),r(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[2801,{"@metamask/superstruct":3027,"@metamask/utils":3207,"@noble/curves/secp256k1":3248,"@noble/hashes/sha256":3261},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const s=e("@metamask/superstruct"),r=e("@metamask/utils"),i=e("@noble/curves/secp256k1"),a=e("@noble/hashes/sha256");n.SignatureStruct=(0,s.object)({signature:r.StrictHexStruct,curve:(0,s.literal)("secp256k1"),format:(0,s.literal)("DER")}),n.verify=async function({registry:e,signature:t,publicKey:s}){(0,r.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,r.hexToBytes)(s),c=await async function(e){var t;return"crypto"in globalThis&&"object"==typeof globalThis.crypto&&(null===(t=crypto.subtle)||void 0===t?void 0:t.digest)?new Uint8Array(await crypto.subtle.digest("SHA-256",e)):(0,a.sha256)(e)}((0,r.stringToBytes)(e));return i.secp256k1.verify((0,r.remove0x)(t.signature),c,o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[281,{"./contracts/registry":279,"./contracts/resolver":280,"@ensdomains/content-hash":656,"@ethersproject/contracts":771,"@ethersproject/providers":809,"eth-ens-namehash":4380},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=async function({provider:e,name:t}){const n=s.default.hash(t),l=Number.parseInt(await e.request({method:"net_version"}),10),d=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(l);if(!d)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${l}"`);const p=new i.Web3Provider(e),h=new a.Contract(d,o.default,p),f=await h.resolver(n);if(u(f))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const m=new a.Contract(f,c.default,p),g=await m.supportsInterface("0xbc1c58d1"),b=await m.supportsInterface("0xd8389dc5");if(g){const e=await m.contenthash(n);let t=r.default.decode(e);const s=r.default.getCodec(e);return"ipfs-ns"!==s&&"ipns-ns"!==s||(t=r.default.helpers.cidV0ToV1Base32(t)),{type:s,hash:t}}if(b){const e=await m.content(n);if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var s=l(e("eth-ens-namehash")),r=l(e("@ensdomains/content-hash")),i=e("@ethersproject/providers"),a=e("@ethersproject/contracts"),o=l(e("./contracts/registry")),c=l(e("./contracts/resolver"));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[282,{"../../../../shared/modules/fetch-with-timeout":6021,"./resolver":281,"base32-encode":4061,"base64-js":4062,"webextension-polyfill":5864},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:a}){const c=u.map(e=>`*://*.${e}/*`);return i.default.webRequest.onErrorOccurred.addListener(d,{urls:c,types:["main_frame"]}),{remove(){i.default.webRequest.onErrorOccurred.removeListener(d)}};async function d(c){const{tabId:d,url:p}=c;if(-1===d||"0x1"!==t())return;const{hostname:h,pathname:f,search:m,hash:g}=new URL(p),b=h.split("."),y=b[b.length-1];u.includes(y)&&async function({tabId:t,name:c,pathname:u,search:d,fragment:p}){const h=n(),f=a(),m=`https://app.ens.domains/name/${c}`;f&&h&&await i.default.tabs.update(t,{url:"loading.html"});let g=m;0;try{const{type:t,hash:n}=await(0,o.default)({provider:e,name:c});if("ipfs-ns"===t||"ipns-ns"===t){if(""===h)return void(g=null);const e=`https://${n}.${t.slice(0,4)}.${h}${u}${d||""}${p||""}`;try{200===(await l(e,{method:"HEAD"})).status&&(g=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)g=`https://swarm-gateways.net/bzz:/${n}${u}${d||""}${p||""}`;else if("onion"===t||"onion3"===t)g=`http://${n}.onion${u}${d||""}${p||""}`;else if("zeronet"===t)g=`http://127.0.0.1:43110/${n}${u}${d||""}${p||""}`;else if("skynet-ns"===t){const e=n.padEnd(n.length+4-n.length%4,"="),t=r.default.toByteArray(e),i={padding:!1};g=`https://${(0,s.default)(t,"RFC4648-HEX",i).toLowerCase()}.siasky.net${u}${d||""}${p||""}`}}catch(e){console.warn(e)}finally{g&&(f||!f&&g!==m)&&await i.default.tabs.update(t,{url:g})}}({tabId:d,name:h,pathname:f,search:m,fragment:g})}};var s=c(e("base32-encode")),r=c(e("base64-js")),i=c(e("webextension-polyfill")),a=c(e("../../../../shared/modules/fetch-with-timeout")),o=c(e("./resolver"));function c(e){return e&&e.__esModule?e:{default:e}}const l=(0,a.default)(),u=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[283,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionLazyListener=void 0;var o=new WeakMap,c=new WeakMap,l=new WeakSet;function u(e){setTimeout(()=>{for(const[t,n]of i(c,this))for(const[s,{args:r}]of n){const n=`ExtensionLazyListener: Possible memory leak detected. The event "${t}.${s}" has been listened to, but no application code has added a listener after ${e}ms. There are currently ${r.length} buffered calls. If you are a developer of this extension, please ensure that you have added a listener for this event. If you are a user of this extension, please report this warning to the developers of the extension.`;console.warn(n)}},e)}function d(e,t){return i(o,this)[e][t]}n.ExtensionLazyListener=class{constructor(e,t={},n=2e4){var p,h;r(p=this,h=l),h.add(p),s(this,o,void 0),s(this,c,new Map),function(e,t,n){e.set(a(e,t),n)}(o,this,e);for(const[e,n]of Object.entries(t)){const t=new Map;for(const s of n){const n=[],r=(...e)=>{n.push(e)};a(l,this,d).call(this,e,s).addListener(r),t.set(s,{listener:r,args:n})}i(c,this).set(e,t)}a(l,this,u).call(this,n)}addListener(e,t,n){const s=a(l,this,d).call(this,e,t);s.addListener(n);const r=i(c,this).get(e);if(r){const a=r.get(t);if(a){s.removeListener(a.listener),r.delete(t),0===r.size&&i(c,this).delete(e);const{args:o}=a;for(let l=0,{length:u}=o;l<u;l++)try{if(n(...o[l]),!s.hasListener(n)){const n=l+1;n!==u&&(o.splice(0,n),r.set(t,a),i(c,this).set(e,r),s.addListener(a.listener));break}}catch(n){const d=l+1;throw d!==u&&(o.splice(0,d),r.set(t,a),i(c,this).set(e,r),s.addListener(a.listener)),n}}}}once(e,t){return new Promise(n=>{const s=a(l,this,d).call(this,e,t),r=i(c,this).get(e);if(r){const a=r.get(t),o=null==a?void 0:a.args.length;if(o)return n(a.args.shift()),s.removeListener(a.listener),void(1===o&&(r.delete(t),0===r.size&&i(c,this).delete(e)))}const o=(...e)=>{s.removeListener(o),n(e)};s.addListener(o)})}}}}},{package:"$root$",file:"app/scripts/lib/extension-lazy-listener/extension-lazy-listener.ts"}],[284,{"@metamask/snaps-sdk":2877,"@metamask/snaps-utils":2994},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forwardRequestToSnap=async function(e,t,n,i){const{method:a,params:o}=n,{handleRequest:c,snapId:l,onBeforeRequest:u,onAfterRequest:d}=e;if(!l)throw new r.InternalError(`No snapId configured for method ${a}`);const p=i.get("origin");if(!p)throw new r.InternalError(`No origin specified for method ${a}`);try{null==u||u()}catch(e){try{null==d||d()}catch(e){console.error("Error from onAfterRequest hook:",e)}throw e}let h;try{h=await c({snapId:l,origin:p,handler:s.HandlerType.OnRpcRequest,request:{jsonrpc:"2.0",method:a,params:o}})}catch(e){try{null==d||d()}catch(e){console.error("Error from onAfterRequest hook:",e)}throw e}return null==d||d(),h};var s=e("@metamask/snaps-utils"),r=e("@metamask/snaps-sdk")}}},{package:"$root$",file:"app/scripts/lib/forwardRequestToSnap.ts"}],[285,{lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return r((0,s.cloneDeep)(e),e=>null===e?"null":typeof e)};var s=e("lodash");function r(e={},t){return Object.entries(e).forEach(([n,s])=>{e[n]="object"==typeof s&&null!==s?r(s,t):t(s)}),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[286,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[287,{"../../../shared/lib/sentry":5992,"@metamask/messenger":2365},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRootMessenger=n.ROOT_MESSENGER_NAMESPACE=void 0;var s=e("@metamask/messenger"),r=e("../../../shared/lib/sentry");const i=n.ROOT_MESSENGER_NAMESPACE="Root";n.getRootMessenger=()=>new s.Messenger({namespace:i,captureException:r.captureException})}}},{package:"$root$",file:"app/scripts/lib/messenger.ts"}],[289,{"../util":368},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return async({request:t,context:n,next:s})=>{const{method:r,params:i}=t;if("eth_getTransactionCount"!==r)return s();const[a,o]=i;return"pending"!==o?s():await e(a,n.get("networkClientId"))}},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return async({request:t,next:n})=>{const{method:r,params:i}=t;if("eth_getTransactionByHash"!==r)return n();const[a]=i,o=e(a);return o?(0,s.formatTxMetaForRpcResult)(o):n()}};var s=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.ts"}],[29,{"./claims-controller-init":27,"./claims-service-init":28},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ClaimsControllerInit",{enumerable:!0,get:function(){return s.ClaimsControllerInit}}),Object.defineProperty(n,"ClaimsServiceInit",{enumerable:!0,get:function(){return r.ClaimsServiceInit}});var s=e("./claims-controller-init"),r=e("./claims-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/claims/index.ts"}],[290,{"../stores/persistence-manager":345,"@metamask/utils":3207,events:4472,loglevel:4948},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=o(e("events")),r=o(e("loglevel")),i=e("@metamask/utils"),a=e("../stores/persistence-manager");function o(e){return e&&e.__esModule?e:{default:e}}class c extends s.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort((e,t)=>e.version-t.version);const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=(0,i.isObject)(e.data)&&e.meta.version<186?new Set(Object.keys(e.data)):new Set;let n=e;for(const e of this.migrations)if(a(e))try{let s;if(r.default.info(`Running migration ${e.version}...`),e.version<186)s=await e.migrate(n),o(s,e);else{s=structuredClone(n);const i=new Set,a=await e.migrate(s,i);if(o(s,e),void 0!==a)throw new Error("Migrator - migration returned value when none expected");if(0===i.size)r.default.debug(`Migrator - migration ${e.version} did not report any changes`);else for(const e of i)t.add(e)}n=s,r.default.info(`Migration ${e.version} complete`)}catch(t){const n=t.message;t.message=`MetaMask Migration Error #${e.version}: ${n}`,this.emit("error",t);break}const s=e.meta.version<186&&(0,i.isObject)(n.data)?new Set(Object.keys(n.data)):new Set;for(const e of t)s.add(e);return{state:n,changedKeys:s};function a(e){return e.version>n.meta.version}function o(e,t){if(!e.data)throw new Error("Migrator - migration returned empty data");if(e.version!==undefined&&e.meta.version!==t.version)throw new Error("Migrator - Migration did not update version number correctly")}}generateInitialState(e){return{data:e,meta:{storageKind:a.PersistenceManager.defaultStorageKind,version:this.defaultVersion}}}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[292,{"../../../../shared/constants/metametrics":5892,"../../../../shared/lib/network-utils":5988,"../../../../shared/lib/only-keep-host":5989,"./utils":293,"@metamask/utils":3207,loglevel:4948},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.onRpcEndpointDegraded=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:i}){u(a.MetaMetricsEventName.RpcServiceDegraded,{chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:i})},n.onRpcEndpointUnavailable=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:i}){u(a.MetaMetricsEventName.RpcServiceUnavailable,{chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:i})},n.trackRpcEndpointEvent=u;var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("@metamask/utils"),a=e("../../../../shared/constants/metametrics"),o=e("../../../../shared/lib/only-keep-host"),c=e("../../../../shared/lib/network-utils"),l=e("./utils");function u(e,{chainId:t,endpointUrl:n,error:s,infuraProjectId:u,trackEvent:d,metaMetricsId:p}){if(!(0,l.shouldCreateRpcServiceEvents)({error:s,metaMetricsId:p}))return;const h=(0,c.isPublicEndpointUrl)(n,u)?(0,o.onlyKeepHost)(n):"custom",f={chain_id_caip:`eip155:${(0,i.hexToNumber)(t)}`,rpc_domain:h,rpc_endpoint_url:h,...(0,i.isObject)(s)&&"httpStatus"in s&&(0,i.isValidJson)(s.httpStatus)?{http_status:s.httpStatus}:{}};r.default.debug(`Creating Segment event "${e}" with ${JSON.stringify(f)}`),d({category:a.MetaMetricsEventCategory.Network,event:e,properties:f})}}}},{package:"$root$",file:"app/scripts/lib/network-controller/messenger-action-handlers.ts"}],[293,{"../../../../development/build/constants":608,"@metamask/network-controller":2426,"@metamask/remote-feature-flag-controller":2684},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PRODUCTION_LIKE_ENVIRONMENTS=void 0,n.shouldCreateRpcServiceEvents=function({error:e,metaMetricsId:t}){return(!e||!(0,s.isConnectionError)(e))&&t!==undefined&&null!==t&&function(e){if("production"===undefined)return!1;if(o.includes("production"))return(0,r.generateDeterministicRandomNumber)(e)<a;return!0}(t)};var s=e("@metamask/network-controller"),r=e("@metamask/remote-feature-flag-controller"),i=e("../../../../development/build/constants");const a=.01,o=n.PRODUCTION_LIKE_ENVIRONMENTS=[i.ENVIRONMENT.PRODUCTION,i.ENVIRONMENT.RELEASE_CANDIDATE]}}},{package:"$root$",file:"app/scripts/lib/network-controller/utils.ts"}],[294,{"../../../shared/constants/notifications":5897,"../platforms/extension":593,"@metamask/safe-event-emitter":2694},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var s=a(e("@metamask/safe-event-emitter")),r=a(e("../platforms/extension")),i=e("../../../shared/constants/notifications");function a(e){return e&&e.__esModule?e:{default:e}}const o=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends s.default{constructor(){super(),this.platform=new r.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-i.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:s,screenY:r,outerWidth:a}=window;t=Math.max(r,0),e=Math.max(s+(a-i.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:i.NOTIFICATION_WIDTH,height:i.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find(e=>e&&"popup"===e.type&&e.id===this._popupId):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[295,{"../../../../shared/constants/offscreen-communication":5898,"eth-lattice-keyring":4381},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var s,r=(s=e("eth-lattice-keyring"))&&s.__esModule?s:{default:s},i=e("../../../../shared/constants/offscreen-communication");class a extends r.default{constructor(e={}){super(e)}async _getCreds(){try{if(this._hasCreds())return undefined;const e=this.appName?this.appName:"Unknown",t=`${i.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`,n=await new Promise((e,n)=>{chrome.runtime.sendMessage({target:i.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},t=>{chrome.runtime.lastError?n(chrome.runtime.lastError):null!=t&&t.error?n(t.error):e(null==t?void 0:t.result)})});if(null==n||!n.deviceID||null==n||!n.password)throw new Error("Invalid credentials returned from Lattice.");return n}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=a,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(a,"type",void 0),a.type=r.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[296,{"../../../../shared/constants/offscreen-communication":5898,"@ledgerhq/errors":978},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var s=e("@ledgerhq/errors"),r=e("../../../../shared/constants/offscreen-communication");function i(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const c=4e3;var l=new WeakSet;async function u(e,{timeout:t}={}){return new Promise((n,i)=>{let a;t&&(a=setTimeout(()=>{i(new Error("Ledger iframe timeout"))},t)),chrome.runtime.sendMessage({...e,target:r.OffscreenCommunicationTarget.ledgerOffscreen},e=>{if(clearTimeout(a),null!=e&&e.success)n(e.payload||e.success);else{var t;const n=null==e||null===(t=e.payload)||void 0===t?void 0:t.error;if(n&&"number"==typeof n.statusCode&&n.statusCode>0){const e=new s.TransportStatusError(n.statusCode);i(e)}else if(null!=n&&n.message){const e=new Error(n.message,{cause:n});i(e)}else i(new Error("Unknown Ledger error occurred"))}})})}n.LedgerOffscreenBridge=class{constructor(){i(this,l),a(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener(e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)}),Promise.resolve()}destroy(){return Promise.resolve()}getOptions(){return Promise.resolve({})}setOptions(){return Promise.resolve()}attemptMakeApp(){return o(l,this,u).call(this,{action:r.LedgerAction.makeApp},{timeout:c})}updateTransportMethod(e){return o(l,this,u).call(this,{action:r.LedgerAction.updateTransport,params:{transportType:e}},{timeout:c})}getAppNameAndVersion(){return o(l,this,u).call(this,{action:r.LedgerAction.getAppNameAndVersion},{timeout:c})}getPublicKey(e){return o(l,this,u).call(this,{action:r.LedgerAction.getPublicKey,params:e})}deviceSignTransaction(e){return o(l,this,u).call(this,{action:r.LedgerAction.signTransaction,params:e})}deviceSignMessage(e){return o(l,this,u).call(this,{action:r.LedgerAction.signPersonalMessage,params:e})}deviceSignTypedData(e){return o(l,this,u).call(this,{action:r.LedgerAction.signTypedData,params:e})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[297,{"../../../../shared/constants/offscreen-communication":5898},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var s=e("../../../../shared/constants/offscreen-communication");function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){r(this,"model",void 0),r(this,"minorVersion",void 0)}init(e){return chrome.runtime.onMessage.addListener(e=>{e.target===s.OffscreenCommunicationTarget.extension&&e.event===s.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload.model,this.minorVersion=e.payload.minorVersion)}),new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.init,params:e},()=>{t()})})}dispose(){return new Promise(e=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.dispose},()=>{e()})})}getPublicKey(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.getPublicKey,params:e},e=>{t(e)})})}ethereumSignTransaction(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.signTransaction,params:e},e=>{t(e)})})}ethereumSignMessage(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.signMessage,params:e},e=>{t(e)})})}ethereumSignTypedData(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.signTypedData,params:e},e=>{t(e)})})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[298,{"webextension-polyfill":5864},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openUpdateTabAndReload=async function(e){try{await r.default.tabs.create({url:"https://metamask.io/updating",active:!0})}catch(e){console.error(e)}await e()};var s,r=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/lib/open-update-tab-and-reload.ts"}],[299,{"../../../shared/lib/promise-with-resolvers":5991,lodash:4940,loglevel:4948},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OperationSafener=void 0;var s,r=e("lodash"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/lib/promise-with-resolvers");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function l(e,t){return e.get(d(e,t))}function u(e,t,n){return e.set(d(e,t),n),n}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,h=new WeakMap;n.OperationSafener=class{constructor({op:e,wait:t,options:n}){c(this,p,void 0),c(this,h,null),o(this,"evacuate",()=>{if(l(h,this))return i.default.warn("already evacuating"),l(h,this);const e=l(p,this).flush();if(e){const{promise:t,resolve:n}=(0,a.withResolvers)();e.finally(n),u(h,this,t)}else u(h,this,Promise.resolve());return l(h,this)}),o(this,"execute",(...e)=>l(h,this)?(i.default.warn("evacuating, ignoring call to `execute`"),!1):(l(p,this).call(this,...e),!0));const s={mode:"exclusive"};u(p,this,(0,r.debounce)((...t)=>navigator.locks.request("operation-safener-lock",s,()=>e(...t)),t,n))}}}}},{package:"$root$",file:"app/scripts/lib/operation-safener.ts"}],[30,{"@metamask/address-book-controller":1284},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookControllerInit=void 0;var s=e("@metamask/address-book-controller");n.AddressBookControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new s.AddressBookController({messenger:e,state:t.AddressBookController})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/address-book-controller-init.ts"}],[300,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const i=async(e,t,n)=>{const s=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var a=new WeakSet;function o(e){return new Promise((t,n)=>{const s=indexedDB.open(this.storeName,this.dbVersion);s.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},s.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},s.onsuccess=n=>{const s=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(s)}})}n.IndexedDBPPOMStorage=class{constructor(e,t){s(this,a),r(this,"storeName",void 0),r(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise((s,r)=>{(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")})(a,this,o).call(this,n).then(n=>{const i=n[e](t);i.onsuccess=async e=>{s(e)},i.onerror=t=>{var n;r(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}}).catch(e=>{r(e)})})}async read(e,t){var n;const s=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await i(e,s,t),s}async write(e,t,n){await i(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map(([e,t])=>({name:e,chainId:t}))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[301,{"../../../../shared/constants/app":5876,"../../../../shared/constants/security-provider":5904,"../../../../shared/constants/transaction":5915,"../../../../shared/lib/trace":5999,"./ppom-util":302,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,u,d,p,h){return async(f,m,g)=>{try{const{securityAlertsEnabled:m}=t.state,{chainId:g}=n.getNetworkConfigurationByNetworkClientId(f.networkClientId)??{};if(!g)throw Error("ChainID not found for networkClientId");if(!m||!l.includes(f.method))return;const b=f.params[0];if("string"==typeof b){const{isSIWEMessage:e}=(0,s.detectSIWE)({data:b});if(e)return}else if(f.method===r.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=b??{},t=d.listAccounts();if(t.some(({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase())))return}const y=(0,c.generateSecurityAlertId)();(0,a.trace)({name:a.TraceName.PPOMValidation,parentContext:f.traceContext},()=>(0,c.validateRequestWithPPOM)({ppomController:e,request:f,securityAlertId:y,chainId:g,updateSecurityAlertResponse:p,getSecurityAlertsConfig:h}));const w={...o.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:y};i.SIGNING_METHODS.includes(f.method)&&u.addSignatureSecurityAlertResponse(w),f.securityAlertResponse=w}catch(e){f.securityAlertResponse=(0,c.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{g()}}};var s=e("@metamask/controller-utils"),r=e("../../../../shared/constants/app"),i=e("../../../../shared/constants/transaction"),a=e("../../../../shared/lib/trace"),o=e("../../../../shared/constants/security-provider"),c=e("./ppom-util");const l=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...i.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[3015,{"./types.cjs":3018},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.InMemoryStorageAdapter=void 0;const a=e("./types.cjs");n.InMemoryStorageAdapter=class{constructor(){s.set(this,void 0),r(this,s,new Map,"f")}async getItem(e,t){const n=`${a.STORAGE_KEY_PREFIX}${e}:${t}`,r=i(this,s,"f").get(n);if(r===undefined)return{};try{return{result:JSON.parse(r)}}catch(e){return console.error(`Failed to parse stored data for ${n}:`,e),{error:e}}}async setItem(e,t,n){const r=`${a.STORAGE_KEY_PREFIX}${e}:${t}`;i(this,s,"f").set(r,JSON.stringify(n))}async removeItem(e,t){const n=`${a.STORAGE_KEY_PREFIX}${e}:${t}`;i(this,s,"f").delete(n)}async getAllKeys(e){const t=`${a.STORAGE_KEY_PREFIX}${e}:`;return Array.from(i(this,s,"f").keys()).filter(e=>e.startsWith(t)).map(e=>e.slice(t.length))}async clear(e){const t=`${a.STORAGE_KEY_PREFIX}${e}:`;Array.from(i(this,s,"f").keys()).filter(e=>e.startsWith(t)).forEach(e=>i(this,s,"f").delete(e))}},s=new WeakMap}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/InMemoryStorageAdapter.cjs"}],[3016,{"./InMemoryStorageAdapter.cjs":3015,"./types.cjs":3018},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.StorageService=void 0;const o=e("./InMemoryStorageAdapter.cjs"),c=e("./types.cjs"),l=["setItem","getItem","removeItem","getAllKeys","clear"];n.StorageService=class{constructor({messenger:e,storage:t}){s.set(this,void 0),r.set(this,void 0),this.name=c.SERVICE_NAME,i(this,s,e,"f"),i(this,r,t??new o.InMemoryStorageAdapter,"f"),t||console.warn(`${c.SERVICE_NAME}: No storage adapter provided. Using in-memory storage. Data will be lost on restart. Provide a storage adapter for persistence.`),a(this,s,"f").registerMethodActionHandlers(this,l)}async setItem(e,t,n){await a(this,r,"f").setItem(e,t,n),a(this,s,"f").publish(`${c.SERVICE_NAME}:itemSet:${e}`,t,n)}async getItem(e,t){return await a(this,r,"f").getItem(e,t)}async removeItem(e,t){await a(this,r,"f").removeItem(e,t)}async getAllKeys(e){return await a(this,r,"f").getAllKeys(e)}async clear(e){await a(this,r,"f").clear(e)}},s=new WeakMap,r=new WeakMap}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/StorageService.cjs"}],[3017,{"./InMemoryStorageAdapter.cjs":3015,"./StorageService.cjs":3016,"./types.cjs":3018},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.STORAGE_KEY_PREFIX=n.SERVICE_NAME=n.InMemoryStorageAdapter=n.StorageService=void 0;var s=e("./StorageService.cjs");Object.defineProperty(n,"StorageService",{enumerable:!0,get:function(){return s.StorageService}});var r=e("./InMemoryStorageAdapter.cjs");Object.defineProperty(n,"InMemoryStorageAdapter",{enumerable:!0,get:function(){return r.InMemoryStorageAdapter}});var i=e("./types.cjs");Object.defineProperty(n,"SERVICE_NAME",{enumerable:!0,get:function(){return i.SERVICE_NAME}}),Object.defineProperty(n,"STORAGE_KEY_PREFIX",{enumerable:!0,get:function(){return i.STORAGE_KEY_PREFIX}})}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/index.cjs"}],[3018,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.STORAGE_KEY_PREFIX=n.SERVICE_NAME=void 0,n.SERVICE_NAME="StorageService",n.STORAGE_KEY_PREFIX="storageService:"}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/types.cjs"}],[302,{"../../../../shared/constants/app":5876,"../../../../shared/constants/security-provider":5904,"../../../../shared/constants/transaction":5915,"../../../../shared/lib/snaps/snaps":5994,"../../../../shared/modules/transaction.utils":6047,"../../../../shared/modules/typed-signature":6048,"./security-alerts-api":304,"@metamask/snaps-utils":2994,"@metamask/transaction-controller":3085,"@metamask/utils":3207,lodash:4940,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,i.v4)()},n.handlePPOMError=y,n.normalizeSignatureRequest=w,n.updateSecurityAlertResponse=async function({appStateController:e,messenger:t,method:n,securityAlertId:s,securityAlertResponse:r,signatureController:i,transactionController:a}){if(u.SIGNING_METHODS.includes(n)){const n=await async function(e,t,n){const s=e=>Object.values(e.signatureRequests).find(e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t});return new Promise(r=>{const i=s(e.state);if(i)return void r(i);const a=e=>{const t=s(e);t&&(m("Found signature request",t),n.unsubscribe("SignatureController:stateChange",a),r(t))};m("Waiting for signature request",t),n.subscribe("SignatureController:stateChange",a)})}(i,s,t);return e.addSignatureSecurityAlertResponse({...r,securityAlertId:s}),n}const o=await async function(e,t,n){const s=e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t};return new Promise(r=>{const i=e.state.transactions.find(s);if(i)return void r(i);const a=e=>{s(e)&&(m("Found transaction metadata",e),n.unsubscribe("TransactionController:unapprovedTransactionAdded",a),r(e))};m("Waiting for transaction metadata",t),n.subscribe("TransactionController:unapprovedTransactionAdded",a)})}(a,s,t);return a.updateSecurityAlertResponse(o.id,{...r,securityAlertId:s}),o},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:r,updateSecurityAlertResponse:i,getSecurityAlertsConfig:o}){try{const l=function(e,t){let n=(0,a.cloneDeep)(e);n=w(n,t),n=function(e,t){if(e.method!==h.MESSAGE_TYPE.ETH_SEND_TRANSACTION)return e;if(!Array.isArray(e.params)||!e.params[0])return e;const n=e.params[0];n.gas=t.txParams.gas,n.gasPrice=t.txParams.maxFeePerGas??t.txParams.gasPrice,delete n.gasLimit,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.type;const r=(0,s.normalizeTransactionParams)(n);return m("Normalized transaction params",r),{...e,params:[r]}}(n,t);const{delegationMock:r,id:i,jsonrpc:o,method:c,origin:l,params:u}=n;return{delegationMock:r,id:i,jsonrpc:o,method:c,origin:l,params:u}}(t,await i(t.method,n,c.LOADING_SECURITY_ALERT_RESPONSE));m("Normalized request",l);const u=(0,f.isSecurityAlertsAPIEnabled)()?await async function(e,t,n,s){try{return{...await(0,f.validateWithSecurityAlertsAPI)(t,n,s),source:c.SecurityAlertSource.API}}catch(s){return y(s,"Error validating request with security alerts API"),await v(e,n,t)}}(e,r,l,o):await v(e,l,r);await i(t.method,n,u)}catch(e){m("Error",e),await i(t.method,n,y(e,"Error validating JSON RPC using PPOM: "))}};var s=e("@metamask/transaction-controller"),r=e("@metamask/utils"),i=e("uuid"),a=e("lodash"),o=e("@metamask/snaps-utils"),c=e("../../../../shared/constants/security-provider"),l=e("../../../../shared/lib/snaps/snaps"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/modules/typed-signature"),p=e("../../../../shared/modules/transaction.utils"),h=e("../../../../shared/constants/app"),f=e("./security-alerts-api");const m=(0,r.createProjectLogger)("ppom-util"),{sentry:g}=global,b={result_type:c.BlockaidResultType.Errored,reason:c.BlockaidReason.errored};function y(e,t,n=c.SecurityAlertSource.API){const s=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),r=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return n===c.SecurityAlertSource.Local&&(null==g||g.captureException(e)),console.error(t,s),{...b,description:r,source:n}}function w(e,t){var n;if(e.method!==h.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3&&e.method!==h.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4)return e;if(!Array.isArray(e.params)||!e.params[1])return e;const s=(0,p.parseTypedDataMessage)(e.params[1]),r=(0,d.sanitizeMessageRecursively)(s.message,s.types,s.primaryType);let i=e.origin;if(t&&"decodedPermission"in t&&null!==(n=t.decodedPermission)&&void 0!==n&&n.origin){const n=(0,o.isSnapId)(e.origin),s=n&&(0,l.isSnapPreinstalled)(e.origin);n&&s&&(i=t.decodedPermission.origin)}return{...e,origin:i,params:[e.params[0],JSON.stringify({...s,message:r})]}}async function v(e,t,n){try{return{...await e.usePPOM(e=>e.validateJsonRpc(t),n),source:c.SecurityAlertSource.Local}}catch(e){return y(e,"Error validating request with PPOM controller",c.SecurityAlertSource.Local)}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[303,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let s;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(s!==undefined)return s;const t=P();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return A(n,e)},n.main=function(){s.main()};const r="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&r.decode();let i=null;function a(){return null!==i&&0!==i.byteLength||(i=new Uint8Array(s.memory.buffer)),i}function o(e,t){return e>>>=0,r.decode(a().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let l=c.length;function u(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}function d(e){return c[e]}function p(e){const t=d(e);return function(e){e<132||(c[e]=l,l=e)}(e),t}let h=0;const f="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},m="function"==typeof f.encodeInto?function(e,t){return f.encodeInto(e,t)}:function(e,t){const n=f.encode(e);return t.set(n),{read:e.length,written:n.length}};function g(e,t,n){if(n===undefined){const n=f.encode(e),s=t(n.length,1)>>>0;return a().subarray(s,s+n.length).set(n),h=n.length,s}let s=e.length,r=t(s,1)>>>0;const i=a();let o=0;for(;o<s;o++){const t=e.charCodeAt(o);if(t>127)break;i[r+o]=t}if(o!==s){0!==o&&(e=e.slice(o)),r=n(r,s,s=o+3*e.length,1)>>>0;const t=a().subarray(r+o,r+s);o+=m(e,t).written}return h=o,r}let b=null;function y(){return null!==b&&0!==b.byteLength||(b=new Int32Array(s.memory.buffer)),b}function w(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=w(e[0]));for(let s=1;s<t;s++)n+=", "+w(e[s]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let s;if(!(n.length>1))return toString.call(e);if(s=n[1],"Object"==s)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:s}function v(e,t,n){s.wasm_bindgen__convert__closures__invoke1_mut(e,t,u(n))}function S(e,t){s._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let _=null;function E(e,t){const n=t(4*e.length,4)>>>0,r=(null!==_&&0!==_.byteLength||(_=new Uint32Array(s.memory.buffer)),_);for(let t=0;t<e.length;t++)r[n/4+t]=u(e[t]);return h=e.length,n}function k(e,t){try{return e.apply(this,t)}catch(e){s.__wbindgen_exn_store(u(e))}}class T{static __wrap(e){e>>>=0;const t=Object.create(T.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();s.__wbg_ppom_free(e)}static new(e,t){const n=E(t,s.__wbindgen_malloc),r=h;return p(s.ppom_new(u(e),n,r))}validateJsonRpc(e){return p(s.ppom_validateJsonRpc(this.__wbg_ptr,u(e)))}static version(){return p(s.ppom_version())}}function P(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return u(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return k(function(e,t,n){return u(d(e).call(d(t),d(n)))},arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return k(function(e,t,n,s){return u(d(e).call(d(t),d(n),d(s)))},arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return u(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return u(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const r=new Promise((e,t)=>{const r=n.a;n.a=0;try{return function(e,t,n,r){s.wasm_bindgen__convert__closures__invoke2_mut(e,t,u(n),u(r))}(r,n.b,e,t)}finally{n.a=r}});return u(r)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return u(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return k(function(e,t){return u(JSON.parse(o(e,t)))},arguments)},e.wbg.__wbg_ppom_new=function(e){return u(T.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return u(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return k(function(e){return u(JSON.stringify(d(e)))},arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return u(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return u(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=p(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const s=function(e,t,n,s){const r={a:e,b:t,cnt:1},i=(...e)=>{r.cnt++;const t=r.a;r.a=0;try{return s(t,r.b,...e)}finally{0===--r.cnt?n(t,r.b):r.a=t}};return i.original=r,i}(e,t,S,v);return u(s)},e.wbg.__wbindgen_debug_string=function(e,t){const n=g(w(d(t)),s.__wbindgen_malloc,s.__wbindgen_realloc),r=h;y()[e/4+1]=r,y()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return u(new Error(o(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return u(s.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){p(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),r="string"==typeof n?n:undefined;var i,a=(i=r)===undefined||null===i?0:g(r,s.__wbindgen_malloc,s.__wbindgen_realloc),o=h;y()[e/4+1]=o,y()[e/4+0]=a},e.wbg.__wbindgen_string_new=function(e,t){return u(o(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e}function A(e,t){return s=e.exports,I.__wbindgen_wasm_module=t,b=null,_=null,i=null,s.__wbindgen_start(),s}async function I(e){if(s!==undefined)return s;const t=P();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return A(n,r)}n.PPOM=T;n.default=I}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[305,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.qrKeyringBuilderFactory=function(e,t,n){const s=()=>new e({bridge:new t(n)});return s.type=e.type,s}}}},{package:"$root$",file:"app/scripts/lib/qr-keyring-builder-factory.ts"}],[306,{"./handlers":312,"./handlers/wallet-getPermissions":317,"./handlers/wallet-requestPermissions":318,"./handlers/wallet-revokePermissions":319,"@metamask/rpc-errors":2692,"@metamask/snaps-rpc-methods":2821,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMultichainMethodMiddleware=n.createEthAccountsMethodMiddleware=n.createEip1193MethodMiddleware=void 0,n.makeMethodMiddlewareMaker=u;var s=e("@metamask/rpc-errors"),r=e("@metamask/snaps-rpc-methods"),i=e("@metamask/utils"),a=e("./handlers"),o=e("./handlers/wallet-getPermissions"),c=e("./handlers/wallet-requestPermissions"),l=e("./handlers/wallet-revokePermissions");n.createEip1193MethodMiddleware=u([...a.handlers,...a.eip1193OnlyHandlers,o.getPermissionsHandler,c.requestPermissionsHandler,l.revokePermissionsHandler]),n.createEthAccountsMethodMiddleware=u([a.ethAccountsHandler]),n.createMultichainMethodMiddleware=u(a.handlers);function u(e){const t=e.reduce((e,t)=>{for(const n of t.methodNames)e[n]=t;return e},{}),n=new Set(e.flatMap(({hookNames:e})=>Object.getOwnPropertyNames(e)));return e=>{!function(e,t){const n=[];if(t.forEach(t=>{(0,i.hasProperty)(e,t)||n.push(t)}),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const s=Object.getOwnPropertyNames(e).filter(e=>!t.has(e));if(s.length>0)throw new Error(`Received unexpected hooks:\n\n${s.join("\n")}\n`)}(e,n);return async(n,i,a,o)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:l}=c;try{return await t(n,i,a,o,(0,r.selectHooks)(e,l))}catch(e){return o(e instanceof Error?e:s.rpcErrors.internal({data:e}))}}return a()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[307,{"../../../../shared/constants/network":5896,"@metamask/rpc-errors":2692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createUnsupportedMethodMiddleware=function(e=r.UNSUPPORTED_RPC_METHODS){return async function(t,n,r,i){return e.has(t.method)?i(s.rpcErrors.methodNotSupported()):r()}};var s=e("@metamask/rpc-errors"),r=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[308,{"../../../../../shared/constants/app":5876,"../../../../../shared/constants/network":5896,"./ethereum-chain-utils":310,"@metamask/controller-utils":1488,"@metamask/network-controller":2426,"@metamask/rpc-errors":2692,lodash:4940,"uri-js":5809},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var s={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(s,i,a):s[i]=e[i]}return s.default=e,n&&n.set(e,s),s}(e("uri-js")),r=e("@metamask/controller-utils"),i=e("@metamask/network-controller"),a=e("@metamask/rpc-errors"),o=e("lodash"),c=e("../../../../../shared/constants/app"),l=e("../../../../../shared/constants/network"),u=e("./ethereum-chain-utils");function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const p={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,n,c,{addNetwork:d,updateNetwork:p,getNetworkConfigurationByChainId:h,setActiveNetwork:f,requestUserApproval:m,getCurrentChainIdForDomain:g,getCaveat:b,requestPermittedChainsPermissionIncrementalForOrigin:y,rejectApprovalRequestsForOrigin:w,setTokenNetworkFilter:v,setEnabledNetworks:S,getEnabledNetworks:_}){var E,k;let T;try{T=(0,u.validateAddEthereumChainParams)(e.params[0])}catch(e){return c(e)}const{chainId:P,chainName:A,firstValidBlockExplorerUrl:I,firstValidRPCUrl:j,ticker:O}=T,{origin:M}=e,R=g(M),C=h(P);if(C&&C.chainId===P&&C.nativeCurrency!==O)return c(a.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${O}`}));let x=C,N=null==C?void 0:C.rpcEndpoints.findIndex(({url:e})=>s.equal(e,j)),L=I?null==C?void 0:C.blockExplorerUrls.findIndex(e=>s.equal(e,I)):undefined;const $=!C||N!==C.defaultRpcEndpointIndex||I&&L!==C.defaultBlockExplorerUrlIndex;if($)try{if(await m({origin:M,type:r.ApprovalType.AddEthereumChain,requestData:{chainId:P,rpcPrefs:{blockExplorerUrl:I},chainName:A,rpcUrl:j,ticker:O}}),C){const e=(0,o.cloneDeep)(C);-1===N&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:j,type:i.RpcEndpointType.Custom,name:A}],N=e.rpcEndpoints.length-1),I&&(-1===L&&(e.blockExplorerUrls=[...e.blockExplorerUrls,I],L=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=L),x=await p(e.chainId,e,R===P?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else{const e=l.FEATURED_RPCS.find(e=>e.chainId===P),t=e?e.rpcEndpoints[e.defaultRpcEndpointIndex]:undefined;x=await d({blockExplorerUrls:I?[I]:[],defaultBlockExplorerUrlIndex:I?0:undefined,chainId:P,defaultRpcEndpointIndex:0,name:A,nativeCurrency:O,rpcEndpoints:[...t&&!s.equal(j,t.url)?[t]:[],{url:j,name:A,type:i.RpcEndpointType.Custom}]})}}catch(e){return c(e)}const D=null==C||null===(E=C.rpcEndpoints)||void 0===E||null===(E=E[C.defaultRpcEndpointIndex])||void 0===E?void 0:E.networkClientId,U=null===(k=x)||void 0===k||null===(k=k.rpcEndpoints)||void 0===k||null===(k=k[x.defaultRpcEndpointIndex])||void 0===k?void 0:k.networkClientId,q=D??U;return(0,u.switchChain)(t,c,P,q,{isAddFlow:!0,autoApprove:$,setActiveNetwork:f,getCaveat:b,requestPermittedChainsPermissionIncrementalForOrigin:y,rejectApprovalRequestsForOrigin:w,setTokenNetworkFilter:v,setEnabledNetworks:S,getEnabledNetworks:_})},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0}};n.default=p}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[309,{"../../../../../shared/constants/app":5876},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,n,s,{getAccounts:r}){return t.result=r(),s()},hookNames:{getAccounts:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.ts"}],[31,{"../../../../shared/constants/app":5876,"@metamask/approval-controller":1289,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ApprovalControllerInit=void 0;var s=e("@metamask/approval-controller"),r=e("@metamask/controller-utils"),i=e("../../../../shared/constants/app");n.ApprovalControllerInit=({controllerMessenger:e,showUserConfirmation:t})=>({persistedStateKey:null,memStateKey:null,controller:new s.ApprovalController({messenger:e,showApprovalRequest:t,typesExcludedFromRateLimiting:[r.ApprovalType.PersonalSign,r.ApprovalType.EthSignTypedData,r.ApprovalType.Transaction,r.ApprovalType.WatchAsset,r.ApprovalType.EthGetEncryptionPublicKey,r.ApprovalType.EthDecrypt,i.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage]})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/approval-controller-init.ts"}],[310,{"../../../../../shared/constants/app":5876,"../../../../../shared/modules/network.utils":6027,"../../util":368,"@metamask/chain-agnostic-permission":1459,"@metamask/controller-utils":1488,"@metamask/rpc-errors":2692,"@metamask/snaps-utils":2994,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.switchChain=async function(e,t,n,r,{origin:l,isAddFlow:u,isSwitchFlow:d,autoApprove:p,setActiveNetwork:h,getCaveat:f,requestPermittedChainsPermissionIncrementalForOrigin:m,setTokenNetworkFilter:g,setEnabledNetworks:b,getEnabledNetworks:y,rejectApprovalRequestsForOrigin:w,requestUserApproval:v,hasApprovalRequestsForOrigin:S,toNetworkConfiguration:_,fromNetworkConfiguration:E}){try{const k=f({target:i.Caip25EndowmentPermissionName,caveatType:i.Caip25CaveatType});if(k){if((0,i.getPermittedEthChainIds)(k.value).includes(n))null==S||!S()||u||p||await v({origin:l,type:s.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:_,fromNetworkConfiguration:E}});else{let e;d&&(e={isSwitchEthereumChain:!0}),await m({chainId:n,autoApprove:p,metadata:e})}}else await m({chainId:n,autoApprove:p});if((0,o.isSnapId)(l)||null==w||w(),await h(r),!(0,o.isSnapId)(l))if(g(n),(0,c.isPrefixedFormattedHexString)(n)){const e=y(a.KnownCaipNamespace.Eip155);Object.keys(e).includes(n)||b(n)}else{const{namespace:e}=(0,a.parseCaipChainId)(n),t=y(e);Object.keys(t).includes(n)||b(n)}return e.result=null,t()}catch(e){return t(e)}},n.validateAddEthereumChainParams=function(e){if(!e||"object"!=typeof e)throw r.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:t,chainName:n,blockExplorerUrls:s,nativeCurrency:i,rpcUrls:a,...o}=e,c=Object.keys(o).filter(e=>!["iconUrls"].includes(e));if(c.length>0)throw r.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${c}`});const p=d(t);if(!a||!Array.isArray(a)||0===a.length)throw r.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${a}`});const h=e=>{const t=(0,u.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},f=a.find(e=>h(e)),m=Array.isArray(s)?s.find(e=>h(e)):null;if(!f)throw r.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${a}`});if("string"!=typeof n||!n)throw r.rpcErrors.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${n}`});const g=n.length>100?n.substring(0,100):n;if(null!==i){if("object"!=typeof i||Array.isArray(i))throw r.rpcErrors.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${i}`});if(18!==i.decimals)throw r.rpcErrors.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${i.decimals}`});if(!i.symbol||"string"!=typeof i.symbol)throw r.rpcErrors.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${i.symbol}`})}const b=(null==i?void 0:i.symbol)||l.UNKNOWN_TICKER_SYMBOL;if(b!==l.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof b||b.length<1||b.length>6))throw r.rpcErrors.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${b}`});return{chainId:p,chainName:g,firstValidBlockExplorerUrl:m,firstValidRPCUrl:f,ticker:b}},n.validateChainId=d,n.validateSwitchEthereumChainParams=function(e){var t;if(null===(t=e.params)||void 0===t||!t[0]||"object"!=typeof e.params[0])throw r.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:n,...s}=e.params[0];if(Object.keys(s).length>0)throw r.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(s)}`});return d(n)};var s=e("@metamask/controller-utils"),r=e("@metamask/rpc-errors"),i=e("@metamask/chain-agnostic-permission"),a=e("@metamask/utils"),o=e("@metamask/snaps-utils"),c=e("../../../../../shared/modules/network.utils"),l=e("../../../../../shared/constants/app"),u=e("../../util");function d(e){const t="string"==typeof e?e.toLowerCase():null;if(!(0,c.isPrefixedFormattedHexString)(t))throw r.rpcErrors.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,c.isSafeChainId)(parseInt(e,16)))throw r.rpcErrors.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[311,{"../../../../../shared/constants/app":5876},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,n,s,{getProviderState:r}){var i;const a=null===(i=e.params)||void 0===i?void 0:i.isInitializingStreamProvider;return t.result={...await r(e.origin,{isInitializingStreamProvider:a})},s()},hookNames:{getProviderState:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.ts"}],[312,{"./add-ethereum-chain":308,"./eth-accounts":309,"./get-provider-state":311,"./log-web3-shim-usage":313,"./request-accounts":314,"./send-metadata":315,"./switch-ethereum-chain":316,"./watch-asset":320},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handlers=n.ethAccountsHandler=n.eip1193OnlyHandlers=void 0;var s=d(e("./add-ethereum-chain")),r=d(e("./eth-accounts")),i=d(e("./get-provider-state")),a=d(e("./log-web3-shim-usage")),o=d(e("./request-accounts")),c=d(e("./send-metadata")),l=d(e("./switch-ethereum-chain")),u=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}n.handlers=[s.default,i.default,a.default,c.default,u.default],n.eip1193OnlyHandlers=[l.default,r.default,o.default],n.ethAccountsHandler=r.default}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[313,{"../../../../../shared/constants/app":5876},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,n,s,{getWeb3ShimUsageState:r,setWeb3ShimUsageRecorded:i}){const{origin:a}=e;r(a)===undefined&&i(a);return t.result=!0,s()},hookNames:{getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/log-web3-shim-usage.ts"}],[314,{"../../../../../shared/constants/app":5876,"../../../../../shared/constants/metametrics":5892,"../../util":368,"@metamask/rpc-errors":2692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("../../../../../shared/constants/app"),i=e("../../../../../shared/constants/metametrics"),a=e("../../util");const o={methodNames:[r.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,n,o,{getAccounts:l,sendMetrics:u,metamaskState:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p,requestPermissionsForOrigin:h}){const{origin:f}=e??{};if(c.has(f))return t.error=s.rpcErrors.resourceUnavailable(`Already processing ${r.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();let m=l(f);if(m.length>0){try{c.add(f),t.result=m,o()}catch(e){o(e)}finally{c.delete(f)}return undefined}try{const e=p();await h(e)}catch(e){return o(e)}if(m=l(f),(0,a.shouldEmitDappViewedEvent)(d.metaMetricsId)){const e=!Object.keys(d.permissionHistory).includes(f);u({event:i.MetaMetricsEventName.DappViewed,category:i.MetaMetricsEventCategory.InpageProvider,referrer:{url:f},properties:{is_first_visit:e,number_of_accounts:Object.keys(d.identities).length,number_of_accounts_connected:m.length}},{excludeMetaMetricsId:!0})}return t.result=m,o()},hookNames:{getAccounts:!0,sendMetrics:!0,metamaskState:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0,requestPermissionsForOrigin:!0}};n.default=o;const c=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.ts"}],[315,{"../../../../../shared/constants/app":5876,"@metamask/rpc-errors":2692,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("@metamask/utils");const i={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,n,i,{addSubjectMetadata:a,subjectType:o}){const{origin:c,params:l}=e;if(!(0,r.isObject)(l))return i(s.rpcErrors.invalidParams({data:l}));{const{icon:e=null,name:t=null,...n}=l;a({...n,iconUrl:e,name:t,subjectType:o,origin:c})}return t.result=!0,i()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};n.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.ts"}]],[],{});