LavaPack.loadBundle([[3019,{"./constants.cjs":3021,"./types.cjs":3024,"@metamask/polling-controller":2555,"@metamask/transaction-controller":3085,"bignumber.js":3025},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},E=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionController=n.getDefaultSubscriptionControllerState=void 0;const y=e("@metamask/polling-controller"),S=e("@metamask/transaction-controller"),I=e("bignumber.js"),k=e("./constants.cjs"),A=e("./types.cjs");function C(){return{subscriptions:[],trialedProducts:[]}}n.getDefaultSubscriptionControllerState=C;const _={subscriptions:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastSubscription:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},customerId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},trialedProducts:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},pricing:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lastSelectedPaymentMethod:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};class P extends((0,y.StaticIntervalPollingController)()){constructor({messenger:e,state:t,subscriptionService:n,pollingInterval:i=k.DEFAULT_POLLING_INTERVAL}){super({name:k.controllerName,metadata:_,state:{subscriptions:[],trialedProducts:[],...t},messenger:e}),r.add(this),a.set(this,void 0),this.setIntervalLength(i),T(this,a,n,"f"),E(this,r,"m",s).call(this)}async getPricing(){const e=await E(this,a,"f").getPricing();return this.update(t=>{t.pricing=e}),e}async getSubscriptions(){const e=this.state.subscriptions,t=this.state.trialedProducts,n=this.state.customerId,s=this.state.lastSubscription,{customerId:i,subscriptions:o,trialedProducts:c,lastSubscription:l}=await E(this,a,"f").getSubscriptions(),u=E(this,r,"m",g).call(this,e,o),d=E(this,r,"m",p).call(this,t,c),h=E(this,r,"m",w).call(this,s,l);return u&&h&&d&&n===i||(this.update(e=>{e.subscriptions=o,e.customerId=i,e.trialedProducts=c,e.lastSubscription=l}),this.triggerAccessTokenRefresh()),o}getSubscriptionByProduct(e){return this.state.subscriptions.find(t=>t.products.some(t=>t.name===e))}async getSubscriptionsEligibilities(e){return await E(this,a,"f").getSubscriptionsEligibilities(e)}async cancelSubscription(e){E(this,r,"m",d).call(this,{subscriptionId:e.subscriptionId});const t=await E(this,a,"f").cancelSubscription({subscriptionId:e.subscriptionId});this.update(n=>{n.subscriptions=n.subscriptions.map(n=>n.id===e.subscriptionId?{...n,...t}:n)}),this.triggerAccessTokenRefresh()}async unCancelSubscription(e){E(this,r,"m",d).call(this,{subscriptionId:e.subscriptionId});const t=await E(this,a,"f").unCancelSubscription({subscriptionId:e.subscriptionId});this.update(n=>{n.subscriptions=n.subscriptions.map(n=>n.id===e.subscriptionId?{...n,...t}:n)}),this.triggerAccessTokenRefresh()}async startShieldSubscriptionWithCard(e){E(this,r,"m",u).call(this,{products:e.products});return await E(this,a,"f").startSubscriptionWithCard(e)}async startSubscriptionWithCrypto(e){E(this,r,"m",u).call(this,{products:e.products});return await E(this,a,"f").startSubscriptionWithCrypto(e)}async submitShieldSubscriptionCryptoApproval(e,t,n){if(e.type!==S.TransactionType.shieldSubscriptionApprove)return;const{chainId:a,rawTx:s}=e;if(!a||!s)throw new Error("Chain ID or raw transaction not found");const{pricing:i,trialedProducts:o,lastSelectedPaymentMethod:u}=this.state;if(!i)throw new Error("Subscription pricing not found");if(!u)throw new Error("Last selected payment method not found");const d=u[A.PRODUCT_TYPES.SHIELD];E(this,r,"m",h).call(this,d);const f=E(this,r,"m",c).call(this,A.PRODUCT_TYPES.SHIELD,d.plan),m=o?.includes(A.PRODUCT_TYPES.SHIELD);await this.getSubscriptions();const p=this.state.subscriptions.find(e=>e.products.some(e=>e.name===A.PRODUCT_TYPES.SHIELD));E(this,r,"m",l).call(this,{product:A.PRODUCT_TYPES.SHIELD});if(Boolean(p))await this.updatePaymentMethod({paymentType:A.PAYMENT_TYPES.byCrypto,subscriptionId:p.id,chainId:a,payerAddress:e.txParams.from,tokenSymbol:d.paymentTokenSymbol,rawTransaction:s,recurringInterval:f.interval,billingCycles:f.minBillingCycles});else{const r={products:[A.PRODUCT_TYPES.SHIELD],isTrialRequested:!m,recurringInterval:f.interval,billingCycles:f.minBillingCycles,chainId:a,payerAddress:e.txParams.from,tokenSymbol:d.paymentTokenSymbol,rawTransaction:s,isSponsored:t,useTestClock:d.useTestClock,rewardAccountId:n};await this.startSubscriptionWithCrypto(r)}await this.getSubscriptions()}getCryptoApproveTransactionParams(e){const{pricing:t}=this.state;if(!t)throw new Error("Subscription pricing not found");const n=t.products.find(t=>t.name===e.productType);if(!n)throw new Error("Product price not found");const r=n.prices.find(t=>t.interval===e.interval);if(!r)throw new Error("Price not found");const a=t.paymentMethods.find(e=>e.type===A.PAYMENT_TYPES.byCrypto);if(!a)throw new Error("Chains payment info not found");const s=a.chains?.find(t=>t.chainId===e.chainId);if(!s)throw new Error("Invalid chain id");const i=s.tokens.find(t=>t.address===e.paymentTokenAddress);if(!i)throw new Error("Invalid token address");return{approveAmount:this.getTokenApproveAmount(r,i),paymentAddress:s.paymentAddress,paymentTokenAddress:e.paymentTokenAddress,chainId:e.chainId}}async updatePaymentMethod(e){if(e.paymentType===A.PAYMENT_TYPES.byCard){const{paymentType:t,...n}=e;return await E(this,a,"f").updatePaymentMethodCard(n)}if(e.paymentType===A.PAYMENT_TYPES.byCrypto){const{paymentType:t,...n}=e;return await E(this,a,"f").updatePaymentMethodCrypto(n),await this.getSubscriptions()}throw new Error("Invalid payment type")}async getBillingPortalUrl(){return await E(this,a,"f").getBillingPortalUrl()}cacheLastSelectedPaymentMethod(e,t){if(!(t.type!==A.PAYMENT_TYPES.byCrypto||t.paymentTokenAddress&&t.paymentTokenSymbol))throw new Error(k.SubscriptionControllerErrorMessage.PaymentTokenAddressAndSymbolRequiredForCrypto);this.update(n=>{n.lastSelectedPaymentMethod={...n.lastSelectedPaymentMethod,[e]:t}})}async submitSponsorshipIntents(e){if(0===e.products.length)throw new Error(k.SubscriptionControllerErrorMessage.SubscriptionProductsEmpty);E(this,r,"m",u).call(this,{products:e.products});const t=this.state.lastSelectedPaymentMethod?.[e.products[0]];E(this,r,"m",h).call(this,t);if(!E(this,r,"m",f).call(this,e.chainId,e.products))return!1;const{paymentTokenSymbol:n,plan:s}=t,i=E(this,r,"m",c).call(this,e.products[0],s).minBillingCycles;return await E(this,a,"f").submitSponsorshipIntents({...e,paymentTokenSymbol:n,billingCycles:i,recurringInterval:s}),!0}async submitUserEvent(e){await E(this,a,"f").submitUserEvent(e)}async assignUserToCohort(e){await E(this,a,"f").assignUserToCohort(e)}async linkRewards(e){E(this,r,"m",d).call(this,{subscriptionId:e.subscriptionId});if(!(await E(this,a,"f").linkRewards({rewardAccountId:e.rewardAccountId})).success)throw new Error(k.SubscriptionControllerErrorMessage.LinkRewardsFailed)}async _executePoll(){await this.getSubscriptions()}getTokenApproveAmount(e,t){const n=t.conversionRate[e.currency];if(!n)throw new Error("Conversion rate not found");const a=new I.BigNumber(E(this,r,"m",i).call(this,e)),s=new I.BigNumber(10).pow(t.decimals);return a.multipliedBy(s).div(n).toFixed(0)}getTokenMinimumBalanceAmount(e,t){const n=t.conversionRate[e.currency];if(!n)throw new Error("Conversion rate not found");const a=new I.BigNumber(E(this,r,"m",o).call(this,e)),s=new I.BigNumber(10).pow(t.decimals);return a.multipliedBy(s).div(n).toFixed(0)}triggerAccessTokenRefresh(){this.messenger.call("AuthenticationController:performSignOut")}}n.SubscriptionController=P,a=new WeakMap,r=new WeakSet,s=function(){this.messenger.registerActionHandler("SubscriptionController:getSubscriptions",this.getSubscriptions.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getSubscriptionByProduct",this.getSubscriptionByProduct.bind(this)),this.messenger.registerActionHandler("SubscriptionController:cancelSubscription",this.cancelSubscription.bind(this)),this.messenger.registerActionHandler("SubscriptionController:startShieldSubscriptionWithCard",this.startShieldSubscriptionWithCard.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getPricing",this.getPricing.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getCryptoApproveTransactionParams",this.getCryptoApproveTransactionParams.bind(this)),this.messenger.registerActionHandler("SubscriptionController:startSubscriptionWithCrypto",this.startSubscriptionWithCrypto.bind(this)),this.messenger.registerActionHandler("SubscriptionController:updatePaymentMethod",this.updatePaymentMethod.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getBillingPortalUrl",this.getBillingPortalUrl.bind(this)),this.messenger.registerActionHandler(`${k.controllerName}:submitSponsorshipIntents`,this.submitSponsorshipIntents.bind(this)),this.messenger.registerActionHandler(`${k.controllerName}:submitShieldSubscriptionCryptoApproval`,this.submitShieldSubscriptionCryptoApproval.bind(this)),this.messenger.registerActionHandler(`${k.controllerName}:linkRewards`,this.linkRewards.bind(this))},i=function(e){return new I.BigNumber(e.unitAmount).div(10**e.unitDecimals).multipliedBy(e.minBillingCycles).toString()},o=function(e){return new I.BigNumber(e.unitAmount).div(10**e.unitDecimals).multipliedBy(e.minBillingCyclesForBalance).toString()},c=function(e,t){const{pricing:n}=this.state,r=n?.products.find(t=>t.name===e),a=r?.prices.find(e=>e.interval===t);if(!a)throw new Error(k.SubscriptionControllerErrorMessage.ProductPriceNotFound);return a},l=function({product:e}){const t=this.state.subscriptions.find(t=>t.products.some(t=>t.name===e));if(!(!t||[A.SUBSCRIPTION_STATUSES.pastDue,A.SUBSCRIPTION_STATUSES.unpaid,A.SUBSCRIPTION_STATUSES.paused,A.SUBSCRIPTION_STATUSES.provisional,A.SUBSCRIPTION_STATUSES.active,A.SUBSCRIPTION_STATUSES.trialing].includes(t.status)))throw new Error(k.SubscriptionControllerErrorMessage.SubscriptionNotValidForCryptoApproval)},u=function({products:e}){const t=this.state.subscriptions.find(t=>t.products.some(t=>e.includes(t.name)));if(t&&k.ACTIVE_SUBSCRIPTION_STATUSES.includes(t.status))throw new Error(k.SubscriptionControllerErrorMessage.UserAlreadySubscribed)},d=function(e){if(!this.state.subscriptions.find(t=>t.id===e.subscriptionId))throw new Error(k.SubscriptionControllerErrorMessage.UserNotSubscribed)},h=function(e){if(!e||e.type!==A.PAYMENT_TYPES.byCrypto||!e.paymentTokenAddress||!e.paymentTokenSymbol)throw new Error(k.SubscriptionControllerErrorMessage.PaymentMethodNotCrypto)},f=function(e,t){const n=E(this,r,"m",m).call(this,e),a=this.state.trialedProducts.some(e=>t.includes(e));return n&&!a},m=function(e){const t=this.state.pricing?.paymentMethods.find(e=>e.type===A.PAYMENT_TYPES.byCrypto),n=t?.chains?.find(t=>t.chainId===e)?.isSponsorshipSupported;return Boolean(n)},p=function(e,t){return e.length===t?.length&&e.every(e=>t?.includes(e))},g=function(e,t){if(e.length!==t.length)return!1;const n=[...e].sort((e,t)=>e.id.localeCompare(t.id)),a=[...t].sort((e,t)=>e.id.localeCompare(t.id));return n.every((e,t)=>{const n=a[t];return E(this,r,"m",w).call(this,e,n)})},w=function(e,t){return e&&t?E(this,r,"m",b).call(this,e)===E(this,r,"m",b).call(this,t):!e&&!t},b=function(e){const t={...e,products:[...e.products].sort((e,t)=>e.name.localeCompare(t.name))};return JSON.stringify(t)}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/SubscriptionController.cjs"}],[3020,{"./constants.cjs":3021,"./errors.cjs":3022,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionService=n.SUBSCRIPTION_URL=void 0;const l=e("@metamask/controller-utils"),u=e("./constants.cjs"),d=e("./errors.cjs");n.SUBSCRIPTION_URL=(e,t)=>`${(0,u.getEnvUrls)(e).subscriptionApiUrl}/v1/${t}`;n.SubscriptionService=class{constructor(e){r.add(this),a.set(this,void 0),o(this,a,e.env,"f"),this.authUtils=e.auth}async getSubscriptions(){return await c(this,r,"m",s).call(this,"subscriptions")}async cancelSubscription(e){const t=`subscriptions/${e.subscriptionId}/cancel`;return await c(this,r,"m",s).call(this,t,"POST",{})}async unCancelSubscription(e){const t=`subscriptions/${e.subscriptionId}/uncancel`;return await c(this,r,"m",s).call(this,t,"POST",{})}async startSubscriptionWithCard(e){if(0===e.products.length)throw new d.SubscriptionServiceError(u.SubscriptionControllerErrorMessage.SubscriptionProductsEmpty);return await c(this,r,"m",s).call(this,"subscriptions/card","POST",e)}async startSubscriptionWithCrypto(e){return await c(this,r,"m",s).call(this,"subscriptions/crypto","POST",e)}async updatePaymentMethodCard(e){const t=`subscriptions/${e.subscriptionId}/payment-method/card`;return await c(this,r,"m",s).call(this,t,"PATCH",{...e,subscriptionId:undefined})}async updatePaymentMethodCrypto(e){const t=`subscriptions/${e.subscriptionId}/payment-method/crypto`;await c(this,r,"m",s).call(this,t,"PATCH",{...e,subscriptionId:undefined})}async getSubscriptionsEligibilities(e){let t;e?.balanceCategory!==undefined&&(t={balanceCategory:e.balanceCategory});return(await c(this,r,"m",s).call(this,"subscriptions/eligibility","GET",undefined,t)).map(e=>({...e,canSubscribe:e.canSubscribe||!1,canViewEntryModal:e.canViewEntryModal||!1,cohorts:e.cohorts||[],assignedCohort:e.assignedCohort||null,hasAssignedCohortExpired:e.hasAssignedCohortExpired||!1}))}async submitUserEvent(e){await c(this,r,"m",s).call(this,"user-events","POST",e)}async assignUserToCohort(e){await c(this,r,"m",s).call(this,"cohorts/assign","POST",e)}async submitSponsorshipIntents(e){await c(this,r,"m",s).call(this,"transaction-sponsorship/intents","POST",e)}async linkRewards(e){return await c(this,r,"m",s).call(this,"rewards/link","POST",e)}async getPricing(){return await c(this,r,"m",s).call(this,"pricing")}async getBillingPortalUrl(){return await c(this,r,"m",s).call(this,"billing-portal")}},a=new WeakMap,r=new WeakSet,s=async function(e,t="GET",s,o){try{const u=await c(this,r,"m",i).call(this),d=new URL((0,n.SUBSCRIPTION_URL)(c(this,a,"f"),e));o&&Object.entries(o).forEach(([e,t])=>{d.searchParams.append(e,t)});return await(0,l.handleFetch)(d.toString(),{method:t,headers:{"Content-Type":"application/json",...u},body:s?JSON.stringify(s):undefined})}catch(e){const t=e instanceof Error?e.message:JSON.stringify(e);throw new d.SubscriptionServiceError(`failed to make request. ${t}`)}},i=async function(){return{Authorization:`Bearer ${await this.authUtils.getAccessToken()}`}}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/SubscriptionService.cjs"}],[3021,{"./types.cjs":3024},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ACTIVE_SUBSCRIPTION_STATUSES=n.DEFAULT_POLLING_INTERVAL=n.SubscriptionControllerErrorMessage=n.getEnvUrls=n.Env=n.controllerName=void 0;const r=e("./types.cjs");var a;n.controllerName="SubscriptionController",function(e){e.DEV="dev",e.UAT="uat",e.PRD="prd"}(a||(n.Env=a={}));const s={dev:{subscriptionApiUrl:"https://subscription.dev-api.cx.metamask.io"},uat:{subscriptionApiUrl:"https://subscription.uat-api.cx.metamask.io"},prd:{subscriptionApiUrl:"https://subscription.api.cx.metamask.io"}};var i;n.getEnvUrls=function(e){if(!s[e])throw new Error("invalid environment configuration");return s[e]},function(e){e.UserAlreadySubscribed="SubscriptionController - User is already subscribed",e.UserNotSubscribed="SubscriptionController - User is not subscribed",e.SubscriptionProductsEmpty="SubscriptionController - Subscription products array cannot be empty",e.PaymentTokenAddressAndSymbolRequiredForCrypto="SubscriptionController - Payment token address and symbol are required for crypto payment",e.PaymentMethodNotCrypto="SubscriptionController - Payment method is not crypto",e.ProductPriceNotFound="SubscriptionController - Product price not found",e.SubscriptionNotValidForCryptoApproval="SubscriptionController - Subscription is not valid for crypto approval",e.LinkRewardsFailed="SubscriptionController - Failed to link rewards"}(i||(n.SubscriptionControllerErrorMessage=i={})),n.DEFAULT_POLLING_INTERVAL=3e5,n.ACTIVE_SUBSCRIPTION_STATUSES=[r.SUBSCRIPTION_STATUSES.active,r.SUBSCRIPTION_STATUSES.trialing,r.SUBSCRIPTION_STATUSES.provisional]}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/constants.cjs"}],[3022,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionServiceError=void 0;class r extends Error{constructor(e){super(e),this.name="SubscriptionServiceError"}}n.SubscriptionServiceError=r}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/errors.cjs"}],[3023,{"./SubscriptionController.cjs":3019,"./SubscriptionService.cjs":3020,"./constants.cjs":3021,"./errors.cjs":3022,"./types.cjs":3024},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionService=n.SubscriptionControllerErrorMessage=n.Env=n.SubscriptionServiceError=n.MODAL_TYPE=n.BALANCE_CATEGORIES=n.COHORT_NAMES=n.SubscriptionUserEvent=n.PAYMENT_TYPES=n.RECURRING_INTERVALS=n.PRODUCT_TYPES=n.SUBSCRIPTION_STATUSES=n.CRYPTO_PAYMENT_METHOD_ERRORS=n.getDefaultSubscriptionControllerState=n.SubscriptionController=void 0;var r=e("./SubscriptionController.cjs");Object.defineProperty(n,"SubscriptionController",{enumerable:!0,get:function(){return r.SubscriptionController}}),Object.defineProperty(n,"getDefaultSubscriptionControllerState",{enumerable:!0,get:function(){return r.getDefaultSubscriptionControllerState}});var a=e("./types.cjs");Object.defineProperty(n,"CRYPTO_PAYMENT_METHOD_ERRORS",{enumerable:!0,get:function(){return a.CRYPTO_PAYMENT_METHOD_ERRORS}}),Object.defineProperty(n,"SUBSCRIPTION_STATUSES",{enumerable:!0,get:function(){return a.SUBSCRIPTION_STATUSES}}),Object.defineProperty(n,"PRODUCT_TYPES",{enumerable:!0,get:function(){return a.PRODUCT_TYPES}}),Object.defineProperty(n,"RECURRING_INTERVALS",{enumerable:!0,get:function(){return a.RECURRING_INTERVALS}}),Object.defineProperty(n,"PAYMENT_TYPES",{enumerable:!0,get:function(){return a.PAYMENT_TYPES}}),Object.defineProperty(n,"SubscriptionUserEvent",{enumerable:!0,get:function(){return a.SubscriptionUserEvent}}),Object.defineProperty(n,"COHORT_NAMES",{enumerable:!0,get:function(){return a.COHORT_NAMES}}),Object.defineProperty(n,"BALANCE_CATEGORIES",{enumerable:!0,get:function(){return a.BALANCE_CATEGORIES}}),Object.defineProperty(n,"MODAL_TYPE",{enumerable:!0,get:function(){return a.MODAL_TYPE}});var s=e("./errors.cjs");Object.defineProperty(n,"SubscriptionServiceError",{enumerable:!0,get:function(){return s.SubscriptionServiceError}});var i=e("./constants.cjs");Object.defineProperty(n,"Env",{enumerable:!0,get:function(){return i.Env}}),Object.defineProperty(n,"SubscriptionControllerErrorMessage",{enumerable:!0,get:function(){return i.SubscriptionControllerErrorMessage}});var o=e("./SubscriptionService.cjs");Object.defineProperty(n,"SubscriptionService",{enumerable:!0,get:function(){return o.SubscriptionService}})}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/index.cjs"}],[3024,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionUserEvent=n.BALANCE_CATEGORIES=n.COHORT_NAMES=n.MODAL_TYPE=n.CRYPTO_PAYMENT_METHOD_ERRORS=n.SUBSCRIPTION_STATUSES=n.RECURRING_INTERVALS=n.PAYMENT_TYPES=n.PRODUCT_TYPES=void 0,n.PRODUCT_TYPES={SHIELD:"shield"},n.PAYMENT_TYPES={byCard:"card",byCrypto:"crypto"},n.RECURRING_INTERVALS={month:"month",year:"year"},n.SUBSCRIPTION_STATUSES={incomplete:"incomplete",incompleteExpired:"incomplete_expired",provisional:"provisional",trialing:"trialing",active:"active",pastDue:"past_due",unpaid:"unpaid",canceled:"canceled",paused:"paused"},n.CRYPTO_PAYMENT_METHOD_ERRORS={APPROVAL_TRANSACTION_TOO_OLD:"approval_transaction_too_old",APPROVAL_TRANSACTION_REVERTED:"approval_transaction_reverted",APPROVAL_TRANSACTION_MAX_VERIFICATION_ATTEMPTS_REACHED:"approval_transaction_max_verification_attempts_reached",INSUFFICIENT_BALANCE:"insufficient_balance",INSUFFICIENT_ALLOWANCE:"insufficient_allowance"},n.MODAL_TYPE={A:"A",B:"B"},n.COHORT_NAMES={POST_TX:"post_tx",WALLET_HOME:"wallet_home"},n.BALANCE_CATEGORIES={RANGE_0_99:"0-99",RANGE_100_999:"100-999",RANGE_1K_9_9K:"1k-9.9k",RANGE_10K_99_9K:"10k-99.9k",RANGE_100K_999_9K:"100k-999.9k",RANGE_1M_PLUS:"1M+"},n.SubscriptionUserEvent={ShieldEntryModalViewed:"shield_entry_modal_viewed",ShieldCohortAssigned:"shield_cohort_assigned"}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/types.cjs"}],[3025,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,s=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,f=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,r=1,a=e.length,s=e[0]+"";r<a;){for(t=e[r++]+"",n=l-t.length;n--;t="0"+t);s+=t}for(a=s.length;48===s.charCodeAt(--a););return s.slice(0,a+1||1)}function g(e,t){var n,r,a=e.c,s=t.c,i=e.s,o=t.s,c=e.e,l=t.e;if(!i||!o)return null;if(n=a&&!a[0],r=s&&!s[0],n||r)return n?r?0:-o:i;if(i!=o)return i;if(n=i<0,r=c==l,!a||!s)return r?0:!a^n?1:-1;if(!r)return c>l^n?1:-1;for(o=(c=a.length)<(l=s.length)?c:l,i=0;i<o;i++)if(a[i]!=s[i])return a[i]>s[i]^n?1:-1;return c==l?0:c>l^n?1:-1}function w(e,t,n,r){if(e<t||e>n||e!==s(e))throw Error(i+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function b(e){var t=e.c.length-1;return m(e.e/l)==t&&e.c[t]%2!=0}function T(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function E(e,t,n){var r,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(r=e.length)){for(a=n,t-=r;--t;a+=n);e+=a}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,y,S,I,k,A,C,_,P,v,N=W.prototype={constructor:W,toString:null,valueOf:null},R=new W(1),j=20,O=4,x=-7,L=21,M=-1e7,F=1e7,D=!1,B=1,G=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",q=!0;function W(e,t){var n,a,i,c,d,h,f,m,p=this;if(!(p instanceof W))return new W(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>F?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>F?p.c=p.e=null:(p.e=c,p.c=[e]))}m=String(e)}else{if(!r.test(m=String(e)))return S(p,m,h);p.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(w(t,2,H.length,"Base"),10==t&&q)return Y(p=new W(e),j+p.e+1,O);if(m=String(e),h="number"==typeof e){if(0*e!=0)return S(p,m,h,t);if(p.s=1/e<0?(m=m.slice(1),-1):1,W.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,f=m.length;d<f;d++)if(n.indexOf(a=m.charAt(d))<0){if("."==a){if(d>c){c=f;continue}}else if(!i&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){i=!0,d=-1,c=0;continue}return S(p,String(e),h,t)}h=!1,(c=(m=y(m,t,10,p.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(f=m.length;48===m.charCodeAt(--f););if(m=m.slice(d,++f)){if(f-=d,h&&W.DEBUG&&f>15&&(e>u||e!==s(e)))throw Error(o+p.s*e);if((c=c-d-1)>F)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%l,c<0&&(d+=l),d<f){for(d&&p.c.push(+m.slice(0,d)),f-=l;d<f;)p.c.push(+m.slice(d,d+=l));d=l-(m=m.slice(d)).length}else d-=f;for(;d--;m+="0");p.c.push(+m)}}else p.c=[p.e=0]}function $(e,t,n,r){var a,s,i,o,c;if(null==n?n=O:w(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=p(e.c),c=1==r||2==r&&(i<=x||i>=L)?T(c,i):E(c,i,"0");else if(s=(e=Y(new W(e),t,n)).e,o=(c=p(e.c)).length,1==r||2==r&&(t<=s||s<=x)){for(;o<t;c+="0",o++);c=T(c,s)}else if(t-=i,c=E(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function K(e,t){for(var n,r,a=1,s=new W(e[0]);a<e.length;a++)(!(r=new W(e[a])).s||(n=g(s,r))===t||0===n&&s.s===t)&&(s=r);return s}function V(e,t,n){for(var r=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,r++);return(n=r+n*l-1)>F?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function Y(e,t,n,r){var i,o,u,h,f,m,p,g=e.c,w=d;if(g){e:{for(i=1,h=g[0];h>=10;h/=10,i++);if((o=t-i)<0)o+=l,u=t,f=g[m=0],p=s(f/w[i-u-1]%10);else if((m=a((o+1)/l))>=g.length){if(!r)break e;for(;g.length<=m;g.push(0));f=p=0,i=1,u=(o%=l)-l+1}else{for(f=h=g[m],i=1;h>=10;h/=10,i++);p=(u=(o%=l)-l+i)<0?0:s(f/w[i-u-1]%10)}if(r=r||t<0||null!=g[m+1]||(u<0?f:f%w[i-u-1]),r=n<4?(p||r)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||r||6==n&&(o>0?u>0?f/w[i-u]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,r?(t-=e.e+1,g[0]=w[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,h=1,m--):(g.length=m+1,h=w[l-o],g[m]=u>0?s(f/w[i-u]%w[u])*h:0),r)for(;;){if(0==m){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=h,h=1;u>=10;u/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=h,g[m]!=c)break;g[m--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>F?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function z(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=x||n>=L?T(t,n):E(t,n,"0"),e.s<0?"-"+t:t)}return W.clone=e,W.ROUND_UP=0,W.ROUND_DOWN=1,W.ROUND_CEIL=2,W.ROUND_FLOOR=3,W.ROUND_HALF_UP=4,W.ROUND_HALF_DOWN=5,W.ROUND_HALF_EVEN=6,W.ROUND_HALF_CEIL=7,W.ROUND_HALF_FLOOR=8,W.EUCLID=9,W.config=W.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(w(n=e[t],0,f,t),j=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(w(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(w(n[0],-f,0,t),w(n[1],0,f,t),x=n[0],L=n[1]):(w(n,-f,f,t),x=-(L=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)w(n[0],-f,-1,t),w(n[1],1,f,t),M=n[0],F=n[1];else{if(w(n,-f,f,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(F=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw D=!n,Error(i+"crypto unavailable");D=n}else D=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(w(n=e[t],0,9,t),B=n),e.hasOwnProperty(t="POW_PRECISION")&&(w(n=e[t],0,f,t),G=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);q="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:j,ROUNDING_MODE:O,EXPONENTIAL_AT:[x,L],RANGE:[M,F],CRYPTO:D,MODULO_MODE:B,POW_PRECISION:G,FORMAT:U,ALPHABET:H}},W.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!W.DEBUG)return!0;var t,n,r=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&a>=-f&&a<=f&&a===s(a)){if(0===r[0]){if(0===a&&1===r.length)return!0;break e}if((t=(a+1)%l)<1&&(t+=l),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=c||n!==s(n))break e;if(0!==n)return!0}}}else if(null===r&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},W.maximum=W.max=function(){return K(arguments,-1)},W.minimum=W.min=function(){return K(arguments,1)},W.random=(I=9007199254740992,k=Math.random()*I&2097151?function(){return s(Math.random()*I)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,o,c,u=0,h=[],m=new W(R);if(null==e?e=j:w(e,0,f),o=a(e/l),D)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(h.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw D=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=o/7}if(!D)for(;u<o;)(c=k())<9e15&&(h[u++]=c%1e14);for(o=h[--u],e%=l,o&&e&&(c=d[l-e],h[u]=s(o/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[r=0];else{for(r=-1;0===h[0];h.splice(0,1),r-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(r-=l-u)}return m.e=r,m.c=h,m}),W.sum=function(){for(var e=1,t=arguments,n=new W(t[0]);e<t.length;)n=n.plus(t[e++]);return n},y=function(){var e="0123456789";function t(e,t,n,r){for(var a,s,i=[0],o=0,c=e.length;o<c;){for(s=i.length;s--;i[s]*=t);for(i[0]+=r.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(r,a,s,i,o){var c,l,u,d,h,f,m,g,w=r.indexOf("."),b=j,T=O;for(w>=0&&(d=G,G=0,r=r.replace(".",""),f=(g=new W(a)).pow(r.length-w),G=d,g.c=t(E(p(f.c),f.e,"0"),10,s,e),g.e=g.c.length),u=d=(m=t(r,a,s,o?(c=H,e):(c=e,H))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(w<0?--u:(f.c=m,f.e=u,f.s=i,m=(f=n(f,g,b,T,s)).c,h=f.r,u=f.e),w=m[l=u+b+1],d=s/2,h=h||l<0||null!=m[l+1],h=T<4?(null!=w||h)&&(0==T||T==(f.s<0?3:2)):w>d||w==d&&(4==T||h||6==T&&1&m[l-1]||T==(f.s<0?8:7)),l<1||!m[0])r=h?E(c.charAt(1),-b,c.charAt(0)):c.charAt(0);else{if(m.length=l,h)for(--s;++m[--l]>s;)m[l]=0,l||(++u,m=[1].concat(m));for(d=m.length;!m[--d];);for(w=0,r="";w<=d;r+=c.charAt(m[w++]));r=E(r,u,c.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,a,s,i,o=0,c=e.length,l=t%h,u=t/h|0;for(e=e.slice();c--;)o=((a=l*(s=e[c]%h)+(r=u*s+(i=e[c]/h|0)*l)%h*h+o)/n|0)+(r/h|0)+u*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,r){var a,s;if(n!=r)s=n>r?1:-1;else for(a=s=0;a<n;a++)if(e[a]!=t[a]){s=e[a]>t[a]?1:-1;break}return s}function n(e,t,n,r){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,a,i,o,u){var d,h,f,p,g,w,b,T,E,y,S,I,k,A,C,_,P,v=r.s==a.s?1:-1,N=r.c,R=a.c;if(!(N&&N[0]&&R&&R[0]))return new W(r.s&&a.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*v:v/0:NaN);for(E=(T=new W(v)).c=[],v=i+(h=r.e-a.e)+1,u||(u=c,h=m(r.e/l)-m(a.e/l),v=v/l|0),f=0;R[f]==(N[f]||0);f++);if(R[f]>(N[f]||0)&&h--,v<0)E.push(1),p=!0;else{for(A=N.length,_=R.length,f=0,v+=2,(g=s(u/(R[0]+1)))>1&&(R=e(R,g,u),N=e(N,g,u),_=R.length,A=N.length),k=_,S=(y=N.slice(0,_)).length;S<_;y[S++]=0);P=R.slice(),P=[0].concat(P),C=R[0],R[1]>=u/2&&C++;do{if(g=0,(d=t(R,y,_,S))<0){if(I=y[0],_!=S&&(I=I*u+(y[1]||0)),(g=s(I/C))>1)for(g>=u&&(g=u-1),b=(w=e(R,g,u)).length,S=y.length;1==t(w,y,b,S);)g--,n(w,_<b?P:R,b,u),b=w.length,d=1;else 0==g&&(d=g=1),b=(w=R.slice()).length;if(b<S&&(w=[0].concat(w)),n(y,w,S,u),S=y.length,-1==d)for(;t(R,y,_,S)<1;)g++,n(y,_<S?P:R,S,u),S=y.length}else 0===d&&(g++,y=[0]);E[f++]=g,y[0]?y[S++]=N[k]||0:(y=[N[k]],S=1)}while((k++<A||null!=y[0])&&v--);p=null!=y[0],E[0]||E.splice(0,1)}if(u==c){for(f=1,v=E[0];v>=10;v/=10,f++);Y(T,i+(T.e=f+h*l-1)+1,o,p)}else T.e=h,T.r=+p;return T}}(),A=/^(-?)0([xbo])(?=\w[\w.]*$)/i,C=/^([^.]+)\.$/,_=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,n,r){var a,s=n?t:t.replace(v,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!n&&(s=s.replace(A,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=a?e:t}),r&&(a=r,s=s.replace(C,"$1").replace(_,"0.$1")),t!=s))return new W(s,a);if(W.DEBUG)throw Error(i+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new W(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return g(this,new W(e,t))},N.decimalPlaces=N.dp=function(e,t){var n,r,a,s=this;if(null!=e)return w(e,0,f),null==t?t=O:w(t,0,8),Y(new W(s),e+s.e+1,t);if(!(n=s.c))return null;if(r=((a=n.length-1)-m(this.e/l))*l,a=n[a])for(;a%10==0;a/=10,r--);return r<0&&(r=0),r},N.dividedBy=N.div=function(e,t){return n(this,new W(e,t),j,O)},N.dividedToIntegerBy=N.idiv=function(e,t){return n(this,new W(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var n,r,o,c,u,d,h,f,m=this;if((e=new W(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+z(e));if(null!=t&&(t=new W(t)),u=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return f=new W(Math.pow(+z(m),u?e.s*(2-b(e)):+z(e))),t?f.mod(t):f;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new W(NaN);(r=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||u&&m.c[1]>=24e7:m.c[0]<8e13||u&&m.c[0]<=9999975e7)))return c=m.s<0&&b(e)?-0:0,m.e>-1&&(c=1/c),new W(d?1/c:c);G&&(c=a(G/l+2))}for(u?(n=new W(.5),d&&(e.s=1),h=b(e)):h=(o=Math.abs(+z(e)))%2,f=new W(R);;){if(h){if(!(f=f.times(m)).c)break;c?f.c.length>c&&(f.c.length=c):r&&(f=f.mod(t))}if(o){if(0===(o=s(o/2)))break;h=o%2}else if(Y(e=e.times(n),e.e+1,1),e.e>14)h=b(e);else{if(0===(o=+z(e)))break;h=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):r&&(m=m.mod(t))}return r?f:(d&&(f=R.div(f)),t?f.mod(t):c?Y(f,G,O,undefined):f)},N.integerValue=function(e){var t=new W(this);return null==e?e=O:w(e,0,8),Y(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===g(this,new W(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return g(this,new W(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=g(this,new W(e,t)))||0===t},N.isInteger=function(){return!!this.c&&m(this.e/l)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return g(this,new W(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=g(this,new W(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var n,r,a,s,i=this,o=i.s;if(t=(e=new W(e,t)).s,!o||!t)return new W(NaN);if(o!=t)return e.s=-t,i.plus(e);var u=i.e/l,d=e.e/l,h=i.c,f=e.c;if(!u||!d){if(!h||!f)return h?(e.s=-t,e):new W(f?i:NaN);if(!h[0]||!f[0])return f[0]?(e.s=-t,e):new W(h[0]?i:3==O?-0:0)}if(u=m(u),d=m(d),h=h.slice(),o=u-d){for((s=o<0)?(o=-o,a=h):(d=u,a=f),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(r=(s=(o=h.length)<(t=f.length))?o:t,o=t=0;t<r;t++)if(h[t]!=f[t]){s=h[t]<f[t];break}if(s&&(a=h,h=f,f=a,e.s=-e.s),(t=(r=f.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;r>o;){if(h[--r]<f[r]){for(n=r;n&&!h[--n];h[n]=t);--h[n],h[r]+=c}h[r]-=f[r]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var r,a,s=this;return e=new W(e,t),!s.c||!e.s||e.c&&!e.c[0]?new W(NaN):!e.c||s.c&&!s.c[0]?new W(s):(9==B?(a=e.s,e.s=1,r=n(s,e,0,3),e.s=a,r.s*=a):r=n(s,e,0,B),(e=s.minus(r.times(e))).c[0]||1!=B||(e.s=s.s),e)},N.multipliedBy=N.times=function(e,t){var n,r,a,s,i,o,u,d,f,p,g,w,b,T,E,y=this,S=y.c,I=(e=new W(e,t)).c;if(!(S&&I&&S[0]&&I[0]))return!y.s||!e.s||S&&!S[0]&&!I||I&&!I[0]&&!S?e.c=e.e=e.s=null:(e.s*=y.s,S&&I?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=m(y.e/l)+m(e.e/l),e.s*=y.s,(u=S.length)<(p=I.length)&&(b=S,S=I,I=b,a=u,u=p,p=a),a=u+p,b=[];a--;b.push(0));for(T=c,E=h,a=p;--a>=0;){for(n=0,g=I[a]%E,w=I[a]/E|0,s=a+(i=u);s>a;)n=((d=g*(d=S[--i]%E)+(o=w*d+(f=S[i]/E|0)*g)%E*E+b[s]+n)/T|0)+(o/E|0)+w*f,b[s--]=d%T;b[s]=n}return n?++r:b.splice(0,1),V(e,b,r)},N.negated=function(){var e=new W(this);return e.s=-e.s||null,e},N.plus=function(e,t){var n,r=this,a=r.s;if(t=(e=new W(e,t)).s,!a||!t)return new W(NaN);if(a!=t)return e.s=-t,r.minus(e);var s=r.e/l,i=e.e/l,o=r.c,u=e.c;if(!s||!i){if(!o||!u)return new W(a/0);if(!o[0]||!u[0])return u[0]?e:new W(o[0]?r:0*a)}if(s=m(s),i=m(i),o=o.slice(),a=s-i){for(a>0?(i=s,n=u):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+u[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),V(e,o,i)},N.precision=N.sd=function(e,t){var n,r,a,s=this;if(null!=e&&e!==!!e)return w(e,1,f),null==t?t=O:w(t,0,8),Y(new W(s),e,t);if(!(n=s.c))return null;if(r=(a=n.length-1)*l+1,a=n[a]){for(;a%10==0;a/=10,r--);for(a=n[0];a>=10;a/=10,r++);}return e&&s.e+1>r&&(r=s.e+1),r},N.shiftedBy=function(e){return w(e,-9007199254740991,u),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,r,a,s,i=this,o=i.c,c=i.s,l=i.e,u=j+4,d=new W("0.5");if(1!==c||!o||!o[0])return new W(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+z(i)))||c==1/0?(((t=p(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=m((l+1)/2)-(l<0||l%2),r=new W(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):r=new W(c+""),r.c[0])for((c=(l=r.e)+u)<3&&(c=0);;)if(s=r,r=d.times(s.plus(n(i,s,u,1))),p(s.c).slice(0,c)===(t=p(r.c)).slice(0,c)){if(r.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(Y(r,r.e+j+2,1),e=!r.times(r).eq(i));break}if(!a&&(Y(s,s.e+j+2,0),s.times(s).eq(i))){r=s;break}u+=4,c+=4,a=1}return Y(r,r.e+j+1,O,e)},N.toExponential=function(e,t){return null!=e&&(w(e,0,f),e++),$(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(w(e,0,f),e=e+this.e+1),$(this,e,t)},N.toFormat=function(e,t,n){var r,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(r=a.toFixed(e,t),a.c){var s,o=r.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],h=o[1],f=a.s<0,m=f?d.slice(1):d,p=m.length;if(l&&(s=c,c=l,l=s,p-=s),c>0&&p>0){for(s=p%c||c,d=m.substr(0,s);s<p;s+=c)d+=u+m.substr(s,c);l>0&&(d+=u+m.slice(s)),f&&(d="-"+d)}r=h?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+r+(n.suffix||"")},N.toFraction=function(e){var t,r,a,s,o,c,u,h,f,m,g,w,b=this,T=b.c;if(null!=e&&(!(u=new W(e)).isInteger()&&(u.c||1!==u.s)||u.lt(R)))throw Error(i+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+z(u));if(!T)return new W(b);for(t=new W(R),f=r=new W(R),a=h=new W(R),w=p(T),o=t.e=w.length-b.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:f:u,c=F,F=1/0,u=new W(w),h.c[0]=0;m=n(u,t,0,1),1!=(s=r.plus(m.times(a))).comparedTo(e);)r=a,a=s,f=h.plus(m.times(s=f)),h=s,t=u.minus(m.times(s=t)),u=s;return s=n(e.minus(r),a,0,1),h=h.plus(s.times(f)),r=r.plus(s.times(a)),h.s=f.s=b.s,g=n(f,a,o*=2,O).minus(b).abs().comparedTo(n(h,r,o,O).minus(b).abs())<1?[f,a]:[h,r],F=c,g},N.toNumber=function(){return+z(this)},N.toPrecision=function(e,t){return null!=e&&w(e,1,f),$(this,e,t,2)},N.toString=function(e){var t,n=this,r=n.s,a=n.e;return null===a?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=a<=x||a>=L?T(p(n.c),a):E(p(n.c),a,"0"):10===e&&q?t=E(p((n=Y(new W(n),j+a+1,O)).c),n.e,"0"):(w(e,2,H.length,"Base"),t=y(E(p(n.c),a,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return z(this)},N._isBigNumber=!0,null!=t&&W.set(t),W}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/subscription-controller>bignumber.js",file:"node_modules/@metamask/subscription-controller/node_modules/bignumber.js/bignumber.js"}],[3026,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StructError=void 0;class r extends TypeError{constructor(e,t){let n;const{message:r,explanation:a,...s}=e,{path:i}=e,o=0===i.length?r:`At path: ${i.join(".")} -- ${r}`;super(a??o),null!==a&&a!==undefined&&(this.cause=o),Object.assign(this,s),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}n.StructError=r}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/error.cjs"}],[3027,{"./error.cjs":3026,"./struct.cjs":3028,"./structs/coercions.cjs":3029,"./structs/refinements.cjs":3030,"./structs/types.cjs":3031,"./structs/utilities.cjs":3032},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./error.cjs"),n),a(e("./struct.cjs"),n),a(e("./structs/coercions.cjs"),n),a(e("./structs/refinements.cjs"),n),a(e("./structs/types.cjs"),n),a(e("./structs/utilities.cjs"),n)}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/index.cjs"}],[3028,{"./error.cjs":3026,"./utils.cjs":3033},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validate=n.is=n.mask=n.create=n.assert=n.ExactOptionalStruct=n.Struct=void 0;const r=e("./error.cjs"),a=e("./utils.cjs");class s{constructor(e){const{type:t,schema:n,validator:r,refiner:s,coercer:i=e=>e,entries:o=function*(){}}=e;this.type=t,this.schema=n,this.entries=o,this.coercer=i,this.validator=r?(e,t)=>{const n=r(e,t);return(0,a.toFailures)(n,t,this,e)}:()=>[],this.refiner=s?(e,t)=>{const n=s(e,t);return(0,a.toFailures)(n,t,this,e)}:()=>[]}assert(e,t){return o(e,this,t)}create(e,t){return c(e,this,t)}is(e){return u(e,this)}mask(e,t){return l(e,this,t)}validate(e,t={}){return d(e,this,t)}}n.Struct=s;const i="EXACT_OPTIONAL";function o(e,t,n){const r=d(e,t,{message:n});if(r[0])throw r[0]}function c(e,t,n){const r=d(e,t,{coerce:!0,message:n});if(r[0])throw r[0];return r[1]}function l(e,t,n){const r=d(e,t,{coerce:!0,mask:!0,message:n});if(r[0])throw r[0];return r[1]}function u(e,t){return!d(e,t)[0]}function d(e,t,n={}){const s=(0,a.run)(e,t,n),i=(0,a.shiftIterator)(s);if(i[0]){return[new r.StructError(i[0],function*(){for(const e of s)e[0]&&(yield e[0])}),undefined]}const o=i[1];return[undefined,o]}n.ExactOptionalStruct=class extends s{constructor(e){super({...e,type:`exact optional ${e.type}`}),this.brand=i}static isExactOptional(e){return(0,a.isObject)(e)&&"brand"in e&&e.brand===i}},n.assert=o,n.create=c,n.mask=l,n.is=u,n.validate=d}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/struct.cjs"}],[3029,{"../struct.cjs":3028,"../utils.cjs":3033,"./types.cjs":3031},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.trimmed=n.defaulted=n.coerce=void 0;const r=e("../struct.cjs"),a=e("../utils.cjs"),s=e("./types.cjs");function i(e,t,n){return new r.Struct({...e,coercer:(a,s)=>(0,r.is)(a,t)?e.coercer(n(a,s),s):e.coercer(a,s)})}n.coerce=i,n.defaulted=function(e,t,n={}){return i(e,(0,s.unknown)(),e=>{const r="function"==typeof t?t():t;if(e===undefined)return r;if(!n.strict&&(0,a.isPlainObject)(e)&&(0,a.isPlainObject)(r)){const t={...e};let n=!1;for(const e in r)t[e]===undefined&&(t[e]=r[e],n=!0);if(n)return t}return e})},n.trimmed=function(e){return i(e,(0,s.string)(),e=>e.trim())}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/coercions.cjs"}],[3030,{"../struct.cjs":3028,"../utils.cjs":3033},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refine=n.size=n.pattern=n.nonempty=n.min=n.max=n.empty=void 0;const r=e("../struct.cjs"),a=e("../utils.cjs");function s(e){return e instanceof Map||e instanceof Set?e.size:e.length}function i(e,t,n){return new r.Struct({...e,*refiner(r,s){yield*e.refiner(r,s);const i=n(r,s),o=(0,a.toFailures)(i,s,e,r);for(const e of o)yield{...e,refinement:t}}})}n.empty=function(e){return i(e,"empty",t=>{const n=s(t);return 0===n||`Expected an empty ${e.type} but received one with a size of \`${n}\``})},n.max=function(e,t,n={}){const{exclusive:r}=n;return i(e,"max",n=>r?n<t:n<=t||`Expected a ${e.type} less than ${r?"":"or equal to "}${t} but received \`${n}\``)},n.min=function(e,t,n={}){const{exclusive:r}=n;return i(e,"min",n=>r?n>t:n>=t||`Expected a ${e.type} greater than ${r?"":"or equal to "}${t} but received \`${n}\``)},n.nonempty=function(e){return i(e,"nonempty",t=>s(t)>0||`Expected a nonempty ${e.type} but received an empty one`)},n.pattern=function(e,t){return i(e,"pattern",n=>t.test(n)||`Expected a ${e.type} matching \`/${t.source}/\` but received "${n}"`)},n.size=function(e,t,n=t){const r=`Expected a ${e.type}`,a=t===n?`of \`${t}\``:`between \`${t}\` and \`${n}\``;return i(e,"size",e=>{if("number"==typeof e||e instanceof Date)return t<=e&&e<=n||`${r} ${a} but received \`${e}\``;if(e instanceof Map||e instanceof Set){const{size:s}=e;return t<=s&&s<=n||`${r} with a size ${a} but received one with a size of \`${s}\``}const{length:s}=e;return t<=s&&s<=n||`${r} with a length ${a} but received one with a length of \`${s}\``})},n.refine=i}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/refinements.cjs"}],[3031,{"../struct.cjs":3028,"../utils.cjs":3033,"./utilities.cjs":3032},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.unknown=n.union=n.type=n.tuple=n.string=n.set=n.regexp=n.record=n.exactOptional=n.optional=n.object=n.number=n.nullable=n.never=n.map=n.literal=n.intersection=n.integer=n.instance=n.func=n.enums=n.date=n.boolean=n.bigint=n.array=n.any=void 0;const r=e("../struct.cjs"),a=e("../utils.cjs"),s=e("./utilities.cjs");function i(){return(0,s.define)("never",()=>!1)}n.any=function(){return(0,s.define)("any",()=>!0)},n.array=function(e){return new r.Struct({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(const[n,r]of t.entries())yield[n,r,e]},coercer:e=>Array.isArray(e)?e.slice():e,validator:e=>Array.isArray(e)||`Expected an array value, but received: ${(0,a.print)(e)}`})},n.bigint=function(){return(0,s.define)("bigint",e=>"bigint"==typeof e)},n.boolean=function(){return(0,s.define)("boolean",e=>"boolean"==typeof e)},n.date=function(){return(0,s.define)("date",e=>e instanceof Date&&!isNaN(e.getTime())||`Expected a valid \`Date\` object, but received: ${(0,a.print)(e)}`)},n.enums=function(e){const t={},n=e.map(e=>(0,a.print)(e)).join();for(const n of e)t[n]=n;return new r.Struct({type:"enums",schema:t,validator:t=>e.includes(t)||`Expected one of \`${n}\`, but received: ${(0,a.print)(t)}`})},n.func=function(){return(0,s.define)("func",e=>"function"==typeof e||`Expected a function, but received: ${(0,a.print)(e)}`)},n.instance=function(e){return(0,s.define)("instance",t=>t instanceof e||`Expected a \`${e.name}\` instance, but received: ${(0,a.print)(t)}`)},n.integer=function(){return(0,s.define)("integer",e=>"number"==typeof e&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${(0,a.print)(e)}`)},n.intersection=function(e){return new r.Struct({type:"intersection",schema:null,*entries(t,n){for(const{entries:r}of e)yield*r(t,n)},*validator(t,n){for(const{validator:r}of e)yield*r(t,n)},*refiner(t,n){for(const{refiner:r}of e)yield*r(t,n)}})},n.literal=function(e){const t=(0,a.print)(e),n=typeof e;return new r.Struct({type:"literal",schema:"string"===n||"number"===n||"boolean"===n?e:null,validator:n=>n===e||`Expected the literal \`${t}\`, but received: ${(0,a.print)(n)}`})},n.map=function(e,t){return new r.Struct({type:"map",schema:null,*entries(n){if(e&&t&&n instanceof Map)for(const[r,a]of n.entries())yield[r,r,e],yield[r,a,t]},coercer:e=>e instanceof Map?new Map(e):e,validator:e=>e instanceof Map||`Expected a \`Map\` object, but received: ${(0,a.print)(e)}`})},n.never=i,n.nullable=function(e){return new r.Struct({...e,validator:(t,n)=>null===t||e.validator(t,n),refiner:(t,n)=>null===t||e.refiner(t,n)})},n.number=function(){return(0,s.define)("number",e=>"number"==typeof e&&!isNaN(e)||`Expected a number, but received: ${(0,a.print)(e)}`)},n.object=function(e){const t=e?Object.keys(e):[],n=i();return new r.Struct({type:"object",schema:e??null,*entries(s){if(e&&(0,a.isObject)(s)){const a=new Set(Object.keys(s));for(const n of t){a.delete(n);const t=e[n];r.ExactOptionalStruct.isExactOptional(t)&&!Object.prototype.hasOwnProperty.call(s,n)||(yield[n,s[n],e[n]])}for(const e of a)yield[e,s[e],n]}},validator:e=>(0,a.isObject)(e)||`Expected an object, but received: ${(0,a.print)(e)}`,coercer:e=>(0,a.isObject)(e)?{...e}:e})},n.optional=function(e){return new r.Struct({...e,validator:(t,n)=>t===undefined||e.validator(t,n),refiner:(t,n)=>t===undefined||e.refiner(t,n)})},n.exactOptional=function(e){return new r.ExactOptionalStruct(e)},n.record=function(e,t){return new r.Struct({type:"record",schema:null,*entries(n){if((0,a.isObject)(n))for(const r in n){const a=n[r];yield[r,r,e],yield[r,a,t]}},validator:e=>(0,a.isObject)(e)||`Expected an object, but received: ${(0,a.print)(e)}`})},n.regexp=function(){return(0,s.define)("regexp",e=>e instanceof RegExp)},n.set=function(e){return new r.Struct({type:"set",schema:null,*entries(t){if(e&&t instanceof Set)for(const n of t)yield[n,n,e]},coercer:e=>e instanceof Set?new Set(e):e,validator:e=>e instanceof Set||`Expected a \`Set\` object, but received: ${(0,a.print)(e)}`})},n.string=function(){return(0,s.define)("string",e=>"string"==typeof e||`Expected a string, but received: ${(0,a.print)(e)}`)},n.tuple=function(e){const t=i();return new r.Struct({type:"tuple",schema:null,*entries(n){if(Array.isArray(n)){const r=Math.max(e.length,n.length);for(let a=0;a<r;a++)yield[a,n[a],e[a]||t]}},validator:e=>Array.isArray(e)||`Expected an array, but received: ${(0,a.print)(e)}`})},n.type=function(e){const t=Object.keys(e);return new r.Struct({type:"type",schema:e,*entries(n){if((0,a.isObject)(n))for(const r of t)yield[r,n[r],e[r]]},validator:e=>(0,a.isObject)(e)||`Expected an object, but received: ${(0,a.print)(e)}`,coercer:e=>(0,a.isObject)(e)?{...e}:e})},n.union=function(e){const t=e.map(e=>e.type).join(" | ");return new r.Struct({type:"union",schema:null,coercer(t){for(const n of e){const[e,r]=n.validate(t,{coerce:!0});if(!e)return r}return t},validator(n,r){const s=[];for(const t of e){const[...e]=(0,a.run)(n,t,r),[i]=e;if(!i?.[0])return[];for(const[t]of e)t&&s.push(t)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${(0,a.print)(n)}`,...s]}})},n.unknown=function(){return(0,s.define)("unknown",()=>!0)}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/types.cjs"}],[3032,{"../struct.cjs":3028,"./types.cjs":3031},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.pick=n.partial=n.omit=n.lazy=n.dynamic=n.deprecated=n.define=n.assign=void 0;const r=e("../struct.cjs"),a=e("./types.cjs");n.assign=function(...e){const t="type"===e[0]?.type,n=e.map(({schema:e})=>e),r=Object.assign({},...n);return t?(0,a.type)(r):(0,a.object)(r)},n.define=function(e,t){return new r.Struct({type:e,schema:null,validator:t})},n.deprecated=function(e,t){return new r.Struct({...e,refiner:(t,n)=>t===undefined||e.refiner(t,n),validator:(n,r)=>n===undefined||(t(n,r),e.validator(n,r))})},n.dynamic=function(e){return new r.Struct({type:"dynamic",schema:null,*entries(t,n){const r=e(t,n);yield*r.entries(t,n)},validator:(t,n)=>e(t,n).validator(t,n),coercer:(t,n)=>e(t,n).coercer(t,n),refiner:(t,n)=>e(t,n).refiner(t,n)})},n.lazy=function(e){let t;return new r.Struct({type:"lazy",schema:null,*entries(n,r){t??(t=e()),yield*t.entries(n,r)},validator:(n,r)=>(t??(t=e()),t.validator(n,r)),coercer:(n,r)=>(t??(t=e()),t.coercer(n,r)),refiner:(n,r)=>(t??(t=e()),t.refiner(n,r))})},n.omit=function(e,t){const{schema:n}=e,r={...n};for(const e of t)delete r[e];return"type"===e.type?(0,a.type)(r):(0,a.object)(r)},n.partial=function(e){const t=e instanceof r.Struct,n=t?{...e.schema}:{...e};for(const e in n)n[e]=(0,a.optional)(n[e]);return t&&"type"===e.type?(0,a.type)(n):(0,a.object)(n)},n.pick=function(e,t){const{schema:n}=e,r={};for(const e of t)r[e]=n[e];return"type"===e.type?(0,a.type)(r):(0,a.object)(r)}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/utilities.cjs"}],[3033,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e){return"object"==typeof e&&null!==e}function a(e){return"symbol"==typeof e?e.toString():"string"==typeof e?JSON.stringify(e):`${e}`}function s(e,t,n,r){if(!0===e)return undefined;!1===e?e={}:"string"==typeof e&&(e={message:e});const{path:s,branch:i}=t,{type:o}=n,{refinement:c,message:l=`Expected a value of type \`${o}\`${c?` with refinement \`${c}\``:""}, but received: \`${a(r)}\``}=e;return{value:r,type:o,refinement:c,key:s[s.length-1],path:s,branch:i,...e,message:l}}Object.defineProperty(n,"__esModule",{value:!0}),n.run=n.toFailures=n.toFailure=n.shiftIterator=n.print=n.isPlainObject=n.isObject=void 0,n.isObject=r,n.isPlainObject=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},n.print=a,n.shiftIterator=function(e){const{done:t,value:n}=e.next();return t?undefined:n},n.toFailure=s,n.toFailures=function*(e,t,n,a){(function(e){return r(e)&&"function"==typeof e[Symbol.iterator]})(e)||(e=[e]);for(const r of e){const e=s(r,t,n,a);e&&(yield e)}},n.run=function*e(t,n,a={}){const{path:s=[],branch:i=[t],coerce:o=!1,mask:c=!1}=a,l={path:s,branch:i};if(o&&(t=n.coercer(t,l),c&&"type"!==n.type&&r(n.schema)&&r(t)&&!Array.isArray(t)))for(const e in t)n.schema[e]===undefined&&delete t[e];let u="valid";for(const e of n.validator(t,l))e.explanation=a.message,u="not_valid",yield[e,undefined];for(let[d,h,f]of n.entries(t,l)){const n=e(h,f,{path:d===undefined?s:[...s,d],branch:d===undefined?i:[...i,h],coerce:o,mask:c,message:a.message});for(const e of n)e[0]?(u=null===e[0].refinement||e[0].refinement===undefined?"not_valid":"not_refined",yield[e[0],undefined]):o&&(h=e[1],d===undefined?t=h:t instanceof Map?t.set(d,h):t instanceof Set?t.add(h):r(t)&&(h!==undefined||d in t)&&(t[d]=h))}if("not_valid"!==u)for(const e of n.refiner(t,l))e.explanation=a.message,u="not_refined",yield[e,undefined];"valid"===u&&(yield[undefined,t])}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/utils.cjs"}],[3034,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEventEmitterProxy=void 0;const r=()=>!0,a=["newListener","removeListener"],s=e=>!a.includes(e);n.createEventEmitterProxy=function(e,{eventFilter:t=r}={}){const n="skipInternal"===t?s:t;if("function"!=typeof n)throw new Error("createEventEmitterProxy - Invalid eventFilter");let a=[],i=e,o=e=>{const t=i;i=e,a.forEach(({name:n,handler:r,addedWith:a,filtered:s})=>{s||e[a](n,r),t.off(n,r)})};const c=(e,t)=>{a=a.filter(n=>e!==n.name||t!==n.handler&&t!==n.unwrappedHandler)};return new Proxy(i,{get(e,t,r){if("setTarget"===t)return o;const s=i[t];return"function"==typeof s?function(...e){const o=e[1];if("once"===t){const t=(...n)=>(c(e[0],t),o(...n));e[1]=t}if("on"===t||"addListener"===t||"prependListener"===t||"once"===t)a.push({addedWith:t,name:e[0],unwrappedHandler:o,handler:e[1],filtered:!n(e[0])});else if("off"===t||"removeListener"===t){const t=a.find(({name:t,unwrappedHandler:n})=>t===e[0]&&n===e[1]);if(t===undefined)return i;c(e[0],e[1]),e[1]=t.handler}return s.apply(this===r?i:this,e)}:s},set:(e,t,n)=>"setTarget"===t?(o=n,!0):(i[t]=n,!0)})}}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/createEventEmitterProxy.js"}],[3035,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSwappableProxy=void 0,n.createSwappableProxy=function(e){let t=e,n=e=>{t=e};return new Proxy(t,{get(e,r,a){if("setTarget"===r)return n;const s=t[r];return s instanceof Function?function(...e){return s.apply(this===a?t:this,e)}:s},set:(e,r,a)=>"setTarget"===r?(n=a,!0):(t[r]=a,!0)})}}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/createSwappableProxy.js"}],[3036,{"./createEventEmitterProxy":3034,"./createSwappableProxy":3035,"./types":3037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./createEventEmitterProxy"),n),a(e("./createSwappableProxy"),n),a(e("./types"),n)}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/index.js"}],[3037,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/types.js"}],[3038,{"./constants.cjs":3040,"./errors.cjs":3041,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@toruslabs/http-helpers":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.authenticateUser=n.createAuthResponseHandler=void 0;const r=e("@metamask/auth-network-utils"),a=e("@toruslabs/http-helpers"),s=e("./constants.cjs"),i=e("./errors.cjs"),o=e("./utils.cjs");n.createAuthResponseHandler=(e,t)=>{let n=null;return async()=>{const a=(0,r.filterCompletedRequests)(e);if(a.length>=s.AUTHENTICATION_THRESHOLD){n??(n=Date.now());const e=Date.now()-n>1e3;if(t||e){const e=a.map(e=>{const{pubKey:t,keyIndex:n}=e.result;return{pubKey:t,keyIndex:n}}),t=(0,r.thresholdSame)(e,s.AUTHENTICATION_THRESHOLD);if(!t)throw i.TOPRFError.invalidAuthenticateResults(`Authentication threshold met, but pubKey/keyIndex data inconsistent: ${JSON.stringify(e)}`);return{authRequestResults:a.map(e=>e.result),isNewUser:!t.pubKey}}return undefined}if(t)throw i.TOPRFError.invalidAuthenticateResults(`Authentication threshold not met after all requests processed. Expected: ${s.AUTHENTICATION_THRESHOLD}, got: ${a.length}`);return undefined}};n.authenticateUser=async e=>{const{idToken:t,nodeEndpointsMap:c,authConnectionId:l,userId:u,commitmentSignatures:d,groupedAuthConnectionId:h,hashedIdToken:f,sessionPrivateKey:m}=e,p=(e=>{const t=e.groupedAuthConnectionId?{subVerifierAuthParams:[{subVerifierIdToken:e.idToken,subVerifier:e.authConnectionId}]}:undefined;if(e.groupedAuthConnectionId&&!e.hashedIdToken)throw i.TOPRFError.fromCode(i.TOPRFErrorCode.NoHashedIdToken);return{authData:{authenticationContext:{idToken:e.groupedAuthConnectionId&&e.hashedIdToken?e.hashedIdToken:e.idToken,verifier:e.groupedAuthConnectionId??e.authConnectionId,verifierId:e.userId},singleIdVerifierParams:t},commitmentSignatures:e.commitmentSignatures,clientTime:Math.floor(Date.now()/1e3).toString()}})({idToken:t,authConnectionId:l,userId:u,commitmentSignatures:d,groupedAuthConnectionId:h,hashedIdToken:f}),g=Object.values(c).map(async e=>(async(e,t)=>{const n=(0,a.generateJsonRPCObject)(s.JRPC_METHODS.AUTHENTICATE_REQUEST,t);return(0,o.postJRPCRequest)(e,n)})(e,p)),w=await(0,r.Some)(g,async(e,t)=>(0,n.createAuthResponseHandler)(e,t.allSettled)());return{authTokensData:await Promise.all(w.authRequestResults.map(async e=>{const{authToken:t,nodeIndex:n,nodePubKey:r,pubKey:a,keyIndex:s}=e;return{authToken:await(0,o.decryptAuthToken)(t,m),nodeIndex:n,nodePubKey:r,pubKey:a,keyIndex:s}})),isNewUser:w.isNewUser}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/authenticateRequest.cjs"}],[3039,{"./constants.cjs":3040,"./errors.cjs":3041,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@noble/hashes/utils":3264,"@toruslabs/http-helpers":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.commitIdToken=n.createHandleCommitmentResponses=void 0;const r=e("@metamask/auth-network-utils"),a=e("@noble/hashes/utils"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.createHandleCommitmentResponses=(e,t)=>{let n=null;return async()=>{const a=(0,r.filterCompletedRequests)(e);if(a.length>=i.COMMIT_RESPONSE_THRESHOLD){n??(n=Date.now());const e=Date.now()-n>1e3;return t||e?a.map(e=>e.result):undefined}if(t)throw o.TOPRFError.invalidCommitResults(`Threshold not met after all requests processed. Expected: ${i.COMMIT_RESPONSE_THRESHOLD}, got: ${a.length}`);return undefined}};n.commitIdToken=async e=>{const{idToken:t,endpoints:o,authConnectionId:l,sessionPubKeyX:u,sessionPubKeyY:d}=e,h=((e,t,n,r)=>({tokenCommitment:e,verifier:t,tempPubKeyX:n,tempPubKeyY:r}))((0,r.keccak256AndHexify)((0,a.utf8ToBytes)(t)).slice(2),l,u,d),f=o.map(async e=>(async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.COMMITMENT_REQUEST,t);return(0,c.postJRPCRequest)(e,n)})(e,h));return(0,r.Some)(f,async(e,t)=>(0,n.createHandleCommitmentResponses)(e,t.allSettled)())}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/commitRequest.cjs"}],[304,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSecurityAlertsAPIEnabled=function(){const e="true";return"true"===e.toString()},n.validateWithSecurityAlertsAPI=async function(e,t,n){let a=function(e){const t="https://security-alerts.api.cx.metamask.io";if(!t)throw new Error("Security alerts API URL is not set");return`${t}/${e}`}(`${r}/${e}`);const{newUrl:s,authorization:i}=await(null==n?void 0:n(a))||{};s&&(a=s);const o={"Content-Type":"application/json"};i&&(o.Authorization=i);return async function(e,t){const n=await fetch(e,t);if(!n.ok)throw new Error(`Security alerts API request failed with status: ${n.status}`);return await n.json()}(a,{method:"POST",body:JSON.stringify(t),headers:o})};const r="validate"}}},{package:"$root$",file:"app/scripts/lib/ppom/security-alerts-api.ts"}],[3040,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.JsonRpcErrorCodes=n.PW_BACKUP_ITEM_ID=n.MAX_PASSWORD_CHAIN_LENGTH=n.FIRST_KEY_INDEX=n.GENERATE_SHARE_THRESHOLD=n.GET_PUB_KEY_THRESHOLD=n.TOPRF_EVAL_THRESHOLD=n.AUTHENTICATION_THRESHOLD=n.COMMIT_RESPONSE_THRESHOLD=n.JRPC_METHODS=void 0,n.JRPC_METHODS={COMMITMENT_REQUEST:"TOPRFCommitmentRequest",AUTHENTICATE_REQUEST:"TOPRFAuthenticateRequest",STORE_KEY_SHARES_REQUEST:"TOPRFStoreKeyShareRequest",RESET_RATE_LIMIT_REQUEST:"TOPRFResetRateLimitRequest",TOPRF_EVAL_REQUEST:"TOPRFEvalRequest",GET_PUB_KEY_REQUEST:"TOPRFGetPubKeyRequest"},n.COMMIT_RESPONSE_THRESHOLD=4,n.AUTHENTICATION_THRESHOLD=4,n.TOPRF_EVAL_THRESHOLD=3,n.GET_PUB_KEY_THRESHOLD=3,n.GENERATE_SHARE_THRESHOLD=3,n.FIRST_KEY_INDEX=1,n.MAX_PASSWORD_CHAIN_LENGTH=10,n.PW_BACKUP_ITEM_ID="PW_BACKUP",function(e){e[e.ErrorCodeInvalidParams=-32602]="ErrorCodeInvalidParams",e[e.ErrorCodeInternal=-32603]="ErrorCodeInternal"}(r||(n.JsonRpcErrorCodes=r={}))}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/constants.cjs"}],[3041,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.TOPRFError=n.TOPRFErrorCode=void 0,function(e){e[e.Default=1e3]="Default",e[e.InvalidAuthenticateResults=1001]="InvalidAuthenticateResults",e[e.InvalidCommitResults=1002]="InvalidCommitResults",e[e.PwdInputRateLimitExceeded=1003]="PwdInputRateLimitExceeded",e[e.InsufficientValidResponses=1004]="InsufficientValidResponses",e[e.CouldNotDeriveThresholdAuthPubKey=1005]="CouldNotDeriveThresholdAuthPubKey",e[e.CouldNotDeriveEncryptionKey=1006]="CouldNotDeriveEncryptionKey",e[e.EndpointNotFound=1007]="EndpointNotFound",e[e.InsufficientAuthTokens=1008]="InsufficientAuthTokens",e[e.RateLimitExceeded=1009]="RateLimitExceeded",e[e.InvalidAuthToken=1010]="InvalidAuthToken",e[e.AuthTokenExpired=1011]="AuthTokenExpired",e[e.JsonRpcError=1012]="JsonRpcError",e[e.CouldNotFetchPassword=1013]="CouldNotFetchPassword",e[e.NoHashedIdToken=1014]="NoHashedIdToken",e[e.MaxKeyChainLengthExceeded=1015]="MaxKeyChainLengthExceeded"}(r||(n.TOPRFErrorCode=r={}));class a extends Error{constructor(e,t,n){super(t),this.code=e,this.meta=n,Object.defineProperty(this,"name",{value:"TOPRFError"})}static fromCode(e,t="",n){const s=t?` ${t}`:"";return a.messages[e]?new a(e,`${a.messages[e]}${s}`,n):new a(1e3,`${a.messages[r.Default]}${s}`,n)}static default(e=""){return new a(r.Default,`${a.messages[r.Default]} ${e}`)}static invalidAuthenticateResults(e=""){return a.fromCode(r.InvalidAuthenticateResults,e)}static invalidCommitResults(e=""){return a.fromCode(r.InvalidCommitResults,e)}static pwdInputRateLimitExceeded(e=""){return a.fromCode(r.PwdInputRateLimitExceeded,e)}static insufficientValidResponses(e=""){return a.fromCode(r.InsufficientValidResponses,e)}static couldNotDeriveThresholdAuthPubKey(e=""){return a.fromCode(r.CouldNotDeriveThresholdAuthPubKey,e)}static couldNotDeriveEncryptionKey(e=""){return a.fromCode(r.CouldNotDeriveEncryptionKey,e)}static endpointNotFound(e=""){return a.fromCode(r.EndpointNotFound,e)}static insufficientAuthTokens(e=""){return a.fromCode(r.InsufficientAuthTokens,e)}static rateLimitExceeded(e,t=""){return a.fromCode(r.RateLimitExceeded,t||e.message,{rateLimitDetails:e})}static invalidAuthToken(e=""){return a.fromCode(r.InvalidAuthToken,e)}static authTokenExpired(e=""){return a.fromCode(r.AuthTokenExpired,e)}static jsonRpcError(e){return a.fromCode(r.JsonRpcError,e)}static couldNotFetchPassword(e=""){return a.fromCode(r.CouldNotFetchPassword,e)}static maxKeyChainLengthExceeded(e=""){return a.fromCode(r.MaxKeyChainLengthExceeded,e)}toJSON(){return{name:this.name,code:this.code,message:this.message,meta:this.meta}}toString(){return JSON.stringify(this.toJSON())}}n.TOPRFError=a,a.messages={[r.Default]:"Something went wrong.",[r.InvalidAuthenticateResults]:"Invalid authenticate results.",[r.InvalidCommitResults]:"Invalid commit results.",[r.PwdInputRateLimitExceeded]:"Rate limit exceeded for password input attempts.",[r.InsufficientValidResponses]:"Insufficient valid responses.",[r.CouldNotDeriveThresholdAuthPubKey]:"Could not derive threshold auth pub key.",[r.CouldNotDeriveEncryptionKey]:"Could not derive encryption key.",[r.EndpointNotFound]:"Endpoint not found.",[r.InsufficientAuthTokens]:"Insufficient number of auth tokens.",[r.RateLimitExceeded]:"Rate limit error from server.",[r.InvalidAuthToken]:"Invalid auth token.",[r.AuthTokenExpired]:"Auth token expired.",[r.JsonRpcError]:"Json rpc error.",[r.CouldNotFetchPassword]:"Could not fetch password.",[r.MaxKeyChainLengthExceeded]:"Exceeded maximum key chain length.",[r.NoHashedIdToken]:"hashedIdToken is required when using single-id(aggregate) verifier."}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/errors.cjs"}],[3042,{"./constants.cjs":3040,"./errors.cjs":3041,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@noble/hashes/utils":3264,"@toruslabs/http-helpers":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPubKey=n.validatePubKey=void 0;const r=e("@metamask/auth-network-utils"),a=e("@noble/hashes/utils"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.validatePubKey=async e=>{const t=(0,c.checkAuthTokenErrors)(e);if(t)throw t;const n=(0,r.filterCompletedRequests)(e);if(n.length<i.GET_PUB_KEY_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient get pub key request results, expected ${i.GET_PUB_KEY_THRESHOLD} but got ${n.length}`);const s=(0,r.thresholdSame)(n.map(e=>({pubKey:e.result?.pubKey,keyIndex:e.result?.keyIndex})),i.GET_PUB_KEY_THRESHOLD);if(!s?.pubKey||!s?.keyIndex)throw o.TOPRFError.couldNotDeriveThresholdAuthPubKey();return{authPubKey:(0,a.hexToBytes)(s.pubKey),keyIndex:s.keyIndex}};n.getPubKey=async e=>{const{authTokens:t,nodeEndpointsMap:a,authConnectionId:l,userId:u,groupedAuthConnectionId:d}=e;if(t.length<i.GET_PUB_KEY_THRESHOLD)throw o.TOPRFError.insufficientAuthTokens(`At least ${i.GET_PUB_KEY_THRESHOLD} auth tokens are required.`);const h=(0,c.mergeEndpointsWithAuthTokens)(t,a).map(async({endpoint:e,authToken:t})=>{const n=((e,t,n,r)=>({authToken:e,verifier:r??t,verifierId:n}))(t.authToken,l,u,d);return(async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.GET_PUB_KEY_REQUEST,t);return(0,c.postJRPCRequest)(e,n)})(e,n)});return(0,r.Some)(h,async e=>(0,n.validatePubKey)(e))}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/getPubKeyRequest.cjs"}],[3043,{"./errors.cjs":3041,"./toprfSecureBackup.cjs":3050,"./utils.cjs":3051},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.TOPRFErrorCode=n.TOPRFError=void 0,a(e("./toprfSecureBackup.cjs"),n);var s=e("./errors.cjs");Object.defineProperty(n,"TOPRFError",{enumerable:!0,get:function(){return s.TOPRFError}}),Object.defineProperty(n,"TOPRFErrorCode",{enumerable:!0,get:function(){return s.TOPRFErrorCode}}),a(e("./utils.cjs"),n)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/index.cjs"}],[3044,{"@noble/curves/abstract/utils":3245,"@noble/curves/secp256k1":3248,"@noble/hashes/hkdf":3254,"@noble/hashes/sha2":3260},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.derivePwEncKey=n.deriveEncryptionKey=n.deriveAuthenticationKeyPair=void 0;const r=e("@noble/curves/abstract/utils"),a=e("@noble/curves/secp256k1"),s=e("@noble/hashes/hkdf"),i=e("@noble/hashes/sha2");n.deriveAuthenticationKeyPair=function(e){const t=(0,s.hkdf)(i.sha256,e,undefined,"authentication-key",32),n=(0,r.bytesToNumberBE)(t)%a.secp256k1.CURVE.n;return{sk:n,pk:a.secp256k1.getPublicKey(n,!1)}},n.deriveEncryptionKey=function(e){return(0,s.hkdf)(i.sha256,e,undefined,"encryption-key",32)},n.derivePwEncKey=function(e){return(0,s.hkdf)(i.sha256,e,undefined,"pwd-encryption-key",32)}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/keyDerivation.cjs"}],[3045,{"./constants.cjs":3040,"@metamask/auth-network-utils":3056,"@noble/ciphers/aes":3235,"@noble/ciphers/webcrypto":3238,"@noble/curves/secp256k1":3248,"@noble/hashes/sha3":3262,"@noble/hashes/utils":3264,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},T=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MetadataStore=n.MetadataStoreError=n.MetadataLockStatus=void 0;const E=e("@metamask/auth-network-utils"),y=e("@noble/ciphers/aes"),S=e("@noble/ciphers/webcrypto"),I=e("@noble/curves/secp256k1"),k=e("@noble/hashes/sha3"),A=e("@noble/hashes/utils"),C=e("./constants.cjs");var _;!function(e){e[e.FAILED=0]="FAILED",e[e.SUCCESS=1]="SUCCESS"}(_||(n.MetadataLockStatus=_={}));class P extends Error{constructor(e){super(e),this.name="MetadataStoreError",Object.setPrototypeOf(this,P.prototype)}}n.MetadataStoreError=P;n.MetadataStore=class{constructor(e){r.add(this),a.set(this,"srp-backup"),s.set(this,void 0),i.set(this,void 0),b(this,s,e.metadataEndpoint,"f"),b(this,i,e.fetchMetadataAccessCreds,"f")}async addSecretDataItem(e){try{const{secretData:t,encKey:n,authKeyPair:a}=e;await T(this,r,"m",o).call(this,{secretData:t,encKey:n,authKeyPair:a,metadataEndpoint:T(this,s,"f")})}catch(e){throw new P(`failed to add metadata: ${e.message}`)}}async batchAddSecretData(e){try{const{secretData:t,encKey:n,authKeyPair:a}=e;await T(this,r,"m",c).call(this,{secretData:t,encKey:n,authKeyPair:a,metadataEndpoint:T(this,s,"f")})}catch(e){throw new P(`failed to add batch metadata: ${e.message}`)}}async fetchAllSecretDataItems(e,t,n){try{return await T(this,r,"m",l).call(this,{encKey:e,authKeyPair:t,metadataEndpoint:T(this,s,"f"),itemId:n})}catch(e){throw new P(`failed to fetch metadata: ${e.message}`)}}async acquireMetadataLock(e){const{status:t,id:n}=await T(this,r,"m",u).call(this,T(this,s,"f"),e);if(t!==_.SUCCESS)throw new P("Failed to acquire metadata lock");if(!n)throw new P("Failed to acquire metadata lock. Missing lock id");return n}async releaseMetadataLock(e,t){const n=await T(this,r,"m",d).call(this,T(this,s,"f"),e,t);if(n!==_.SUCCESS)throw new P(`Failed to release metadata lock with id ${t}`);return n}},a=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakSet,o=async function(e){try{const t=`${e.metadataEndpoint}/enc_account_data/set`,n=T(this,r,"m",g).call(this,e.secretData.data,e.encKey),a=await T(this,r,"m",h).call(this,{itemId:e.secretData.itemId,data:n},e.authKeyPair),s=JSON.stringify(a),i=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:s});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).success}catch(e){const t=e.message||"Unknown error";throw new P(`failed to upsert metadata: ${t}`)}},c=async function(e){const t=Array.isArray(e.encKey)?e.encKey:e.secretData.map(()=>e.encKey);if(t.length!==e.secretData.length)throw new P("encKey must be of same length as secretData");try{const n=`${e.metadataEndpoint}/enc_account_data/batch_set`,a=e.secretData.map((e,n)=>({data:T(this,r,"m",g).call(this,e.data,t[n]),itemId:e.itemId})),s=await T(this,r,"m",h).call(this,a,e.authKeyPair),i=await fetch(n,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(s)});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).success}catch(e){const t=e.message||"Unknown error";throw new P(`failed to upsert metadata: ${t}`)}},l=async function(e){try{const n=`${e.metadataEndpoint}/enc_account_data/get`,a=await T(this,r,"m",f).call(this,e.authKeyPair,e.itemId),s=await fetch(n,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)});if(!s.ok){const e=await s.json();throw new Error(`HTTP error message: ${e.error}`)}const i=await s.json();if(!i.data)throw new P("Failed to fetch metadata");return i.data.filter((t,n)=>e.itemId?i.ids[n]===e.itemId:i.ids[n]!==C.PW_BACKUP_ITEM_ID).map((n,a)=>{const s=new Uint8Array(t.from(n,"base64"));return{itemId:i.ids[a],data:T(this,r,"m",w).call(this,s,e.encKey)}}).filter(e=>e.data.length>0)}catch(e){const t=e.message||"Unknown error";throw new P(`failed to fetch metadata: ${t}`)}},u=async function(e,t){try{const n=T(this,r,"m",m).call(this,t),a=`${e}/acquireLock`,s=await fetch(a,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)});if(!s.ok){const e=await s.json();throw new Error(`HTTP error message: ${e.error}`)}const i=await s.json();return{status:i.status,id:i.id}}catch(e){const t=e.message||"Unknown error";throw new P(`failed to acquire metadata lock: ${t}`)}},d=async function(e,t,n){try{const a=T(this,r,"m",m).call(this,t,n),s=`${e}/releaseLock`,i=await fetch(s,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).status}catch(e){const t=e.message||"Unknown error";throw new P(`failed to release metadata lock: ${t}`)}},h=async function(e,n){const s=Date.now().toString(),o=T(this,a,"f"),{metadataAccessToken:c}=await T(this,i,"f").call(this),l={timestamp:s,feature:o,authToken:c};Array.isArray(e)?l.data=e.map(e=>{const n=e.data;return{data:t.from(n).toString("base64"),itemId:e.itemId}}):(l.data=t.from(e.data).toString("base64"),l.itemId=e.itemId);const{pk:u,sk:d}=n,h=T(this,r,"m",p).call(this,l,d),f=(0,A.bytesToHex)(u);return{...l,signature:h,pubKey:f}},f=async function(e,t){const n=Date.now().toString(),s=T(this,a,"f"),{pk:o,sk:c}=e,{metadataAccessToken:l}=await T(this,i,"f").call(this),u={feature:s,timestamp:n,itemId:t,authToken:l},d=T(this,r,"m",p).call(this,u,c),h=(0,A.bytesToHex)(o);return{...u,pubKey:h,signature:d}},m=function(e,t){const{pk:n,sk:a}=e,s={timestamp:Date.now()};return{data:s,signature:T(this,r,"m",p).call(this,s,a,!0),key:(0,A.bytesToHex)(n),id:t}},p=function(e,t,n=!1){const r=(0,E.safeStringify)(e),a=(0,k.keccak_256)(r),s=I.secp256k1.sign(a,t);return n?s.toDERHex():s.toCompactHex()},g=function(e,t){return(0,S.managedNonce)(y.gcm)(t).encrypt(e)},w=function(e,t){return(0,S.managedNonce)(y.gcm)(t).decrypt(e)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/metadata.cjs"}],[3046,{"@noble/curves/abstract/modular":3243,"@noble/curves/abstract/utils":3245,"@noble/curves/secp256k1":3248},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OPRF=n.generateRandomScalar=void 0;const r=e("@noble/curves/abstract/modular"),a=e("@noble/curves/abstract/utils"),s=e("@noble/curves/secp256k1");function i(){return(0,a.bytesToNumberBE)(s.secp256k1.utils.randomPrivateKey())}n.generateRandomScalar=i;const o=(0,r.Field)(s.secp256k1.CURVE.n);n.OPRF=class{static blind(e){const t=i(),n=(0,s.hashToCurve)(e).multiply(t);return{a:s.secp256k1.ProjectivePoint.fromAffine(n.toAffine()),r:t}}static blindEval(e,t){return t.multiply(e)}static async unblindAndHash(e,t,n,r){const a=o.inv(n),i=t.multiply(a);let c=s.secp256k1.CURVE.hash(new Uint8Array([...e,...i.toRawBytes()]));if(r){const e=c.length;c=await r.deriveKey(c.slice(0,e/2),c.slice(e/2))}return c}static async localEval(e,t,n){const{a:r,r:a}=this.blind(t),s=r.multiply(e);return this.unblindAndHash(t,s,a,n)}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/oprf.cjs"}],[3047,{"./constants.cjs":3040,"./errors.cjs":3041,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@noble/hashes/sha3":3262,"@toruslabs/http-helpers":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resetRateLimits=n.validateThresholdResetRateLimitResponses=n.sendResetRateLimitRequest=void 0;const r=e("@metamask/auth-network-utils"),a=e("@noble/hashes/sha3"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.sendResetRateLimitRequest=async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.RESET_RATE_LIMIT_REQUEST,t);return(0,c.postJRPCRequest)(e,n)};n.validateThresholdResetRateLimitResponses=(e,t)=>{const n=(0,c.checkAuthTokenErrors)(e);if(n)throw n;const a=(0,r.filterCompletedRequests)(e);if(a.length<t)throw o.TOPRFError.insufficientValidResponses(`invalid reset rate limit results, expected ${t} but got ${a.length}`);return!0};n.resetRateLimits=async e=>{const{authTokens:t,nodeEndpointsMap:s,authConnectionId:i,groupedAuthConnectionId:o,userId:l,authPrivKey:u}=e,d=(0,c.mergeEndpointsWithAuthTokens)(t,s).map(async({endpoint:e,authToken:t})=>{const s=(0,r.toSnakeCaseKeys)({timestamp:Date.now(),nodeIndex:t.nodeIndex,action:"reset_ratelimit"}),d=(0,r.safeStringify)(s,{cmp:c.preserveKeyOrder}),h=(0,a.keccak_256)(d),f=(0,c.createEthereumSignature)(h,u),m=((e,t,n,r,a,s)=>({authToken:e,signature:t,signedData:n,verifier:s??r,verifierId:a}))(t.authToken,f,d,i,l,o);return(0,n.sendResetRateLimitRequest)(e,m)});return(0,r.Some)(d,async e=>(0,n.validateThresholdResetRateLimitResponses)(e,t.length))}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/resetRateLimits.cjs"}],[3048,{"./constants.cjs":3040,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@toruslabs/http-helpers":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.changeKeyShares=n.createKeyChangeRequestParams=n.storeKeyShares=n.sendStoreKeySharesRequest=n.createStoreKeySharesRequestParams=void 0;const r=e("@metamask/auth-network-utils"),a=e("@toruslabs/http-helpers"),s=e("./constants.cjs"),i=e("./utils.cjs");n.createStoreKeySharesRequestParams=async e=>{const{nodeEndpointsMap:t,authTokens:n,authConnectionId:a,groupedAuthConnectionId:s,userId:o,keyShareIndex:c,oprfKey:l,authPubKey:u}=e,d=await(0,i.generateShareImportItems)(t,n,l,c);return{verifier:s??a,verifierId:o,pubKey:(0,r.uint8ArrayToHex)(u),shareImportItems:d}};n.sendStoreKeySharesRequest=async(e,t)=>{const n=(0,a.generateJsonRPCObject)(s.JRPC_METHODS.STORE_KEY_SHARES_REQUEST,(0,r.toSnakeCaseKeys)(t));return(0,i.postJRPCRequest)(e,n)};n.storeKeyShares=async e=>{const{authTokens:t,nodeEndpointsMap:a,authConnectionId:s,groupedAuthConnectionId:o,userId:c,keyShareIndex:l,oprfKey:u,authPubKey:d}=e,h=await(0,n.createStoreKeySharesRequestParams)({nodeEndpointsMap:a,authTokens:t,authConnectionId:s,groupedAuthConnectionId:o,userId:c,keyShareIndex:l,oprfKey:u,authPubKey:d}),f=a[(0,r.getProxyCoordinatorNodeIndex)(t.map(e=>e.nodeIndex),o??s,c)],m=await(0,n.sendStoreKeySharesRequest)(f,h);if((0,r.isJSONRPCError)(m.error)){throw(0,i.parseJsonRpcError)(m.error)}return m};n.createKeyChangeRequestParams=async e=>{const{nodeEndpointsMap:t,authTokens:n,keyShareIndex:a,newOprfKey:s,newAuthPubKey:o,oldAuthPrivKey:c,authConnectionId:l,groupedAuthConnectionId:u,userId:d}=e,h=await(0,i.generateShareImportItems)(t,n,s,a,c);return{pubKey:(0,r.uint8ArrayToHex)(o),shareImportItems:h,verifier:u??l,verifierId:d}};n.changeKeyShares=async e=>{const{nodeEndpointsMap:t,authTokens:a,keyShareIndex:s,newOprfKey:o,newAuthPubKey:c,oldAuthPrivKey:l,authConnectionId:u,groupedAuthConnectionId:d,userId:h}=e,f=await(0,n.createKeyChangeRequestParams)({nodeEndpointsMap:t,authTokens:a,keyShareIndex:s,newOprfKey:o,newAuthPubKey:c,oldAuthPrivKey:l,authConnectionId:u,groupedAuthConnectionId:d,userId:h}),m=t[(0,r.getProxyCoordinatorNodeIndex)(a.map(e=>e.nodeIndex),u,h)],p=await(0,n.sendStoreKeySharesRequest)(m,f);if((0,r.isJSONRPCError)(p.error)){throw(0,i.parseJsonRpcError)(p.error)}return p}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/storeSharesRequest.cjs"}],[3049,{"./constants.cjs":3040,"./errors.cjs":3041,"./keyDerivation.cjs":3044,"./oprf.cjs":3046,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@noble/curves/secp256k1":3248,"@toruslabs/http-helpers":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.recoverTOPRFSeed=n.validateSeed=void 0;const r=e("@metamask/auth-network-utils"),a=e("@noble/curves/secp256k1"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./keyDerivation.cjs"),l=e("./oprf.cjs"),u=e("./utils.cjs");n.validateSeed=async(e,t,n,s)=>{const d=(0,u.checkAuthTokenErrors)(n);if(d)throw d;let h=(0,u.checkRateLimitErrors)(n);if(h)throw o.TOPRFError.rateLimitExceeded(h);const f=(0,r.filterCompletedRequests)(n);if(f.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient toprf eval request results, expected ${i.TOPRF_EVAL_THRESHOLD} but got ${f.length}`);const m=(0,r.thresholdSame)(f.map(e=>e.result?.pubKey),i.TOPRF_EVAL_THRESHOLD);if(!m)throw o.TOPRFError.couldNotDeriveThresholdAuthPubKey();const p=f.reduce((e,t)=>{const n=t.result;if(!("object"==typeof(r=n)&&null!==r&&"blindedOutputX"in r&&"string"==typeof r.blindedOutputX&&"blindedOutputY"in r&&"string"==typeof r.blindedOutputY&&"nodeIndex"in r&&"number"==typeof r.nodeIndex&&"keyShareIndex"in r&&"number"==typeof r.keyShareIndex&&"pubKey"in r&&"string"==typeof r.pubKey))return e;var r;const{blindedOutputX:s,blindedOutputY:i,nodeIndex:o,keyShareIndex:c}=n;return e.push({blindedOutput:a.secp256k1.ProjectivePoint.fromAffine({x:BigInt(`0x${s}`),y:BigInt(`0x${i}`)}),nodeIndex:o,keyShareIndex:c}),e},[]);if(p.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient valid blinded outputs, expected: ${i.TOPRF_EVAL_THRESHOLD}, received: ${p.length}`);const g=await(async(e,t,n,s,o)=>{const u=(0,r.kCombinations)(e.length,i.TOPRF_EVAL_THRESHOLD);for(const i of u){const u=e.filter((e,t)=>i.includes(t)),d=u.map(e=>e.blindedOutput),h=u.map(e=>BigInt(e.nodeIndex)),f=(0,r.lagrangeInterpolationForPoints)(a.secp256k1.CURVE.n,d,h),m=await l.OPRF.unblindAndHash(t,f,n,o),{pk:p}=(0,c.deriveAuthenticationKeyPair)(m),g=a.secp256k1.ProjectivePoint.fromHex(p),w=a.secp256k1.ProjectivePoint.fromHex(s);if(g.equals(w))return{seed:m,keyShareIndex:u[0].keyShareIndex}}return null})(p,e,t,m,s);if(!g){if(h=(0,u.extractRateLimitErrorFromResults)(n),h)throw o.TOPRFError.rateLimitExceeded(h);throw o.TOPRFError.couldNotDeriveEncryptionKey()}return g};n.recoverTOPRFSeed=async e=>{const{authTokens:t,nodeEndpointsMap:a,authConnectionId:c,groupedAuthConnectionId:d,userId:h,userInput:f,keyDeriver:m}=e;if(t.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientAuthTokens(`At least ${i.TOPRF_EVAL_THRESHOLD} auth tokens are required.`);const{a:p,r:g}=l.OPRF.blind(f),w=(0,u.mergeEndpointsWithAuthTokens)(t,a).map(async({endpoint:e,authToken:t})=>{const n=((e,t,n,r,a,s)=>({authToken:e,shareCoefficient:"1",blindedInputX:t,blindedInputY:n,verifier:s??r,verifierId:a}))(t.authToken,p.x.toString(16),p.y.toString(16),c,h,d);return(async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.TOPRF_EVAL_REQUEST,t);return(0,u.postJRPCRequest)(e,n)})(e,n)});try{return await(0,r.Some)(w,async e=>(0,n.validateSeed)(f,g,e,m))}catch(e){throw(0,u.getTOPRFError)(e)}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/toprfEvalRequest.cjs"}],[3050,{"./authenticateRequest.cjs":3038,"./commitRequest.cjs":3039,"./constants.cjs":3040,"./errors.cjs":3041,"./getPubKeyRequest.cjs":3042,"./keyDerivation.cjs":3044,"./metadata.cjs":3045,"./oprf.cjs":3046,"./resetRateLimits.cjs":3047,"./storeSharesRequest.cjs":3048,"./toprfEvalRequest.cjs":3049,"./utils.cjs":3051,"@metamask/auth-network-utils":3056,"@noble/ciphers/utils":3237,"@noble/curves/abstract/utils":3245,"@noble/curves/secp256k1":3248,"@noble/hashes/utils":3264,"@toruslabs/fetch-node-details":3311,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r,a,s,i,o,c,l,u,d,h,f,m,p=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ToprfSecureBackup=void 0;const w=e("@metamask/auth-network-utils"),b=e("@noble/ciphers/utils"),T=e("@noble/curves/abstract/utils"),E=e("@noble/curves/secp256k1"),y=e("@noble/hashes/utils"),S=e("@toruslabs/fetch-node-details"),I=e("./authenticateRequest.cjs"),k=e("./commitRequest.cjs"),A=e("./constants.cjs"),C=e("./errors.cjs"),_=e("./getPubKeyRequest.cjs"),P=e("./keyDerivation.cjs"),v=e("./metadata.cjs"),N=e("./oprf.cjs"),R=e("./resetRateLimits.cjs"),j=e("./storeSharesRequest.cjs"),O=e("./toprfEvalRequest.cjs"),x=e("./utils.cjs");class L{constructor(e){r.add(this),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),p(this,s,new S.NodeDetailManager({network:e.network}),"f"),p(this,i,e.nodeDetailsOverride,"f"),p(this,o,e.keyDeriver,"f"),p(this,c,e.fetchMetadataAccessCreds,"f")}async authenticate(e){const{nodeEndpoints:n,nodeEndpointsMap:a}=await g(this,r,"m",u).call(this);let s=E.secp256k1.utils.randomPrivateKey();try{const r=E.secp256k1.ProjectivePoint.fromPrivateKey(s),i=r.x.toString(16),o=r.y.toString(16);let c;e.groupedAuthConnectionId&&(c=(0,w.remove0x)((0,w.keccak256AndHexify)(t.from(e.idTokens[0],"utf8"))));const l=await(0,k.commitIdToken)({idToken:c??e.idTokens[0],authConnectionId:e.groupedAuthConnectionId??e.authConnectionId,sessionPubKeyX:i,sessionPubKeyY:o,endpoints:n}),u=l.reduce((e,t)=>(e[t.nodeIndex]=a[t.nodeIndex],e),{}),{authTokensData:d,isNewUser:h}=await(0,I.authenticateUser)({idToken:e.idTokens[0],authConnectionId:e.authConnectionId,userId:e.userId,sessionPrivateKey:s,nodeEndpointsMap:u,commitmentSignatures:l,groupedAuthConnectionId:e.groupedAuthConnectionId,hashedIdToken:c});return{nodeAuthTokens:d.map(e=>({authToken:e.authToken,nodeIndex:e.nodeIndex,nodePubKey:e.nodePubKey})),isNewUser:h}}finally{s.fill(0),s=null}}async createLocalKey(e){const{password:t,oprfKey:n=(0,N.generateRandomScalar)()}=e;let r=null;try{r=(0,T.utf8ToBytes)(t);const e=await N.OPRF.localEval(n,r,g(this,o,"f")),a=(0,P.deriveAuthenticationKeyPair)(e),s=(0,P.deriveEncryptionKey)(e);return{oprfKey:n,seed:e,authKeyPair:a,encKey:s,pwEncKey:(0,P.derivePwEncKey)(e)}}finally{r&&(r.fill(0),r=null)}}async persistLocalKey(e){const{nodeAuthTokens:t,oprfKey:n,authPubKey:a,authConnectionId:s,groupedAuthConnectionId:i,userId:o,keyShareIndex:c=A.FIRST_KEY_INDEX,oldAuthKeyPair:l}=e,{nodeEndpointsMap:d}=await g(this,r,"m",u).call(this),h=t.reduce((e,t)=>(e[t.nodeIndex]=d[t.nodeIndex],e),{});l?await(0,j.changeKeyShares)({nodeEndpointsMap:h,authConnectionId:s,groupedAuthConnectionId:i,userId:o,authTokens:t,keyShareIndex:c,newOprfKey:n,newAuthPubKey:a,oldAuthPrivKey:l.sk}):await(0,j.storeKeyShares)({nodeEndpointsMap:h,authConnectionId:s,groupedAuthConnectionId:i,userId:o,authTokens:t,keyShareIndex:c,oprfKey:n,authPubKey:a})}async createAndPersistEncKey(e){const{nodeAuthTokens:t,password:n,authConnectionId:r,userId:a}=e,{oprfKey:s,authKeyPair:i,encKey:o,pwEncKey:c}=await this.createLocalKey({password:n});return await this.persistLocalKey({nodeAuthTokens:t,oprfKey:s,authPubKey:i.pk,authConnectionId:r,userId:a}),{authKeyPair:{sk:i.sk,pk:i.pk},encKey:o,pwEncKey:c}}async recoverEncKey(e){const{nodeAuthTokens:t,password:n,authConnectionId:a,groupedAuthConnectionId:s,userId:i}=e;let c=null,l=null;try{const{nodeEndpointsMap:e}=await g(this,r,"m",u).call(this);c=(0,T.utf8ToBytes)(n);const{seed:d,keyShareIndex:h}=await(0,O.recoverTOPRFSeed)({authTokens:t,nodeEndpointsMap:e,authConnectionId:a,groupedAuthConnectionId:s,userId:i,userInput:c,keyDeriver:g(this,o,"f")});l=d;const f=(0,P.deriveAuthenticationKeyPair)(l),m=(0,P.deriveEncryptionKey)(l),p=(0,P.derivePwEncKey)(l),w=new Promise((n,r)=>{(0,R.resetRateLimits)({authTokens:t,nodeEndpointsMap:e,authConnectionId:a,groupedAuthConnectionId:s,userId:i,authPrivKey:f.sk}).then(()=>n()).catch(e=>{r(e)})});return{authKeyPair:f,encKey:m,pwEncKey:p,keyShareIndex:h,rateLimitResetResult:w}}finally{c&&(c.fill(0),c=null),l&&(l.fill(0),l=null)}}async changeEncKey(e){const{nodeAuthTokens:t,authConnectionId:n,groupedAuthConnectionId:a,userId:s,oldEncKey:i,oldPwEncKey:o,oldAuthKeyPair:c,newPassword:l,newKeyShareIndex:u,pregeneratedOprfKey:h}=e;if(!h&&!l)throw new Error("Either newPassword or pregeneratedOprfKey is required");if(h&&l)throw new Error("Only one of newPassword or pregeneratedOprfKey is allowed");const{oprfKey:f,authKeyPair:m,encKey:p,pwEncKey:w}=l?await this.createLocalKey({password:l}):h;let b,T,E;try{b=await g(this,r,"m",d).call(this),[T,E]=await Promise.all([b.acquireMetadataLock(c),b.acquireMetadataLock(m)]);const e=(await b.fetchAllSecretDataItems(i,c)).map(e=>({data:e.data}));if(!e||0===e.length)throw new Error("No existing data found to change key");const l=[{data:M("",o,c),itemId:A.PW_BACKUP_ITEM_ID},...e],h=[w,...e.map(()=>p)];return await b.batchAddSecretData({secretData:l,encKey:h,authKeyPair:m}),await this.persistLocalKey({nodeAuthTokens:t,oprfKey:f,authPubKey:m.pk,authConnectionId:n,groupedAuthConnectionId:a,userId:s,keyShareIndex:u,oldAuthKeyPair:c}),{authKeyPair:m,encKey:p,pwEncKey:w}}finally{if(b&&T&&E)try{await Promise.all([b.releaseMetadataLock(c,T),b.releaseMetadataLock(m,E)])}catch(e){console.error("Failed to release metadata lock:",e)}}}async addSecretDataItem(e){const t=await g(this,r,"m",d).call(this);await t.addSecretDataItem({...e,secretData:{data:e.secretData}})}async batchAddSecretDataItems(e){const t=await g(this,r,"m",d).call(this);let n;try{n=await t.acquireMetadataLock(e.authKeyPair),await t.batchAddSecretData({...e,secretData:e.secretData.map(e=>({data:e}))})}finally{if(n)try{await t.releaseMetadataLock(e.authKeyPair,n)}catch(e){console.error("Failed to release metadata lock:",e)}}}async fetchAllSecretDataItems(e){const t=await g(this,r,"m",d).call(this);return(await t.fetchAllSecretDataItems(e.decKey,e.authKeyPair)).map(e=>e.data)}async fetchAuthPubKey(e){const{nodeAuthTokens:t,authConnectionId:n,userId:a,groupedAuthConnectionId:s}=e,{nodeEndpointsMap:i}=await g(this,r,"m",u).call(this);return(0,_.getPubKey)({authTokens:t,nodeEndpointsMap:i,authConnectionId:n,userId:a,groupedAuthConnectionId:s})}async recoverPwEncKey(e){const{targetAuthPubKey:t,curPwEncKey:n,curAuthKeyPair:a,maxPwChainLength:s=A.MAX_PASSWORD_CHAIN_LENGTH}=e;let i={password:"",encKey:n,authKeyPair:a};for(let e=0;e<s;e++)try{if(i=await g(this,r,"m",f).call(this,{encKey:i.encKey,authKeyPair:i.authKeyPair}),(0,b.equalBytes)(i.authKeyPair.pk,t))return{pwEncKey:i.encKey}}catch(e){throw C.TOPRFError.couldNotFetchPassword(e.message)}throw C.TOPRFError.maxKeyChainLengthExceeded()}async getNodeDetails(){return g(this,r,"m",u).call(this)}}function M(e,t,n){return(0,T.utf8ToBytes)(JSON.stringify({pw:e,encKey:(0,y.bytesToHex)(t),authKeyPair:{sk:n.sk.toString(),pk:(0,y.bytesToHex)(n.pk)}}))}n.ToprfSecureBackup=L,a=L,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,r=new WeakSet,u=async function(){let e=g(this,i,"f")?.indexes,t=g(this,i,"f")?.pubKeys,n=g(this,i,"f")?.endpoints;if(e&&t&&Array.isArray(n))return g(a,a,"m",m).call(a,e,t,n),{nodeEndpoints:n,nodeEndpointsMap:(0,x.createNodeEndpointsMap)(n,e),nodeIndexes:e,nodePubkeys:t};const{torusNodeSSSEndpoints:r,torusIndexes:o,torusNodePub:c}=await g(this,s,"f").getNodeDetails({verifier:"auth-connection-id",verifierId:"user-id"});if(e??(e=o),t??(t=c),!Array.isArray(n)){if(!r){throw new Error("Failed to get node details")}n=n?r.map(e=>{const t=new URL(e);return t.pathname=n,t.href}):r}return g(a,a,"m",m).call(a,e,t,n),{nodeEndpoints:n,nodeEndpointsMap:(0,x.createNodeEndpointsMap)(n,e),nodeIndexes:e,nodePubkeys:t}},d=async function(){if(g(this,l,"f"))return g(this,l,"f");const{nodeEndpointsMap:e}=await g(this,r,"m",u).call(this),t=(await g(this,r,"m",h).call(this,e))[1],n=new v.MetadataStore({metadataEndpoint:t,fetchMetadataAccessCreds:g(this,c,"f")});return p(this,l,n,"f"),n},h=async function(e){const t={};return Object.entries(e).forEach(([e,n])=>{const r=new URL(n);t[e]=`${r.origin}/metadata`}),t},f=async function(e){const t=await g(this,r,"m",d).call(this),n=await t.fetchAllSecretDataItems(e.encKey,e.authKeyPair,A.PW_BACKUP_ITEM_ID);if(0===n.length)throw new Error("Failed to get previous password and keys");const a=function(e){const t=JSON.parse((0,b.bytesToUtf8)(e));return{pw:t.pw,encKey:(0,y.hexToBytes)(t.encKey),authKeyPair:{sk:BigInt(t.authKeyPair.sk),pk:(0,y.hexToBytes)(t.authKeyPair.pk)}}}(n[0].data);return{password:a.pw,encKey:a.encKey,authKeyPair:a.authKeyPair}},m=function(e,t,n){if(e.length!==t.length||e.length!==n.length){throw new Error("Node details arrays (indexes, pubKeys, endpoints) must have equal lengths")}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/toprfSecureBackup.cjs"}],[3051,{"./constants.cjs":3040,"./errors.cjs":3041,"@metamask/auth-network-utils":3056,"@noble/curves/secp256k1":3248,"@noble/hashes/sha3":3262,"@toruslabs/eccrypto":3310,"@toruslabs/http-helpers":3061,"bn.js":4115,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.preserveKeyOrder=n.getTOPRFError=n.parseJsonRpcError=n.mergeEndpointsWithAuthTokens=n.checkAuthTokenErrors=n.checkRateLimitErrors=n.extractRateLimitErrorFromResults=n.getMaxRateLimitError=n.createNodeEndpointsMap=n.generateShareImportItems=n.createKeyChangeShareImportItems=n.createNewUserShareImportItems=n.createKeyChangeProof=n.createEthereumSignature=n.prepareNodeShares=n.decryptAuthToken=n.postJRPCRequest=n.bigIntToBN=void 0;const a=e("@metamask/auth-network-utils"),s=e("@noble/curves/secp256k1"),i=e("@noble/hashes/sha3"),o=e("@toruslabs/eccrypto"),c=e("@toruslabs/http-helpers"),l=r(e("bn.js")),u=e("./constants.cjs"),d=e("./errors.cjs");n.bigIntToBN=e=>new l.default(e.toString());n.postJRPCRequest=async(e,t)=>{const n={...t};return n.params=(0,a.toSnakeCaseKeys)(t.params),(0,c.post)(e,n,{},{logTracingHeader:!1}).then(e=>(e.result&&(e.result=(0,a.toCamelCaseKeys)(e.result)),e)).catch(e=>({id:t.id,jsonrpc:"2.0",error:{code:-32e3,message:"Internal error",data:e}}))};n.decryptAuthToken=async(e,n)=>{const r=JSON.parse(e),s=(0,a.encParamsHexToBuf)(r.metadata),i=await(0,o.decrypt)(t.from(n),{...s,ciphertext:t.from(r.data,"hex")});return t.from(i).toString("base64")};const h=async(e,n)=>{const r=await(0,o.encrypt)(n,e,{padding:!0}),s=(0,a.encryptedParamsBufToHex)(r);return{data:t.from(r.ciphertext).toString("hex"),metadata:{...s}}};n.prepareNodeShares=(e,t)=>{const r=(0,n.bigIntToBN)(t),s=(0,a.getSecp256K1Curve)(),i=Object.keys(e).map(e=>parseInt(e,10)),o=((e,t,n,r)=>{const s=t.map(e=>new l.default(e)),i=r-1;return(0,a.generateRandomPolynomial)(e,i,n).generateShares(s)})(s,i,r,u.GENERATE_SHARE_THRESHOLD);return{shares:o,nodeIndexes:i}};n.createEthereumSignature=(e,t)=>{const n=t.toString(16).padStart(64,"0"),r=s.secp256k1.sign(e,n);return r.toCompactHex()+(r.recovery+27).toString(16).padStart(2,"0")};n.createKeyChangeProof=(e,r,s,o)=>{const c=Math.floor(Date.now()/1e3),l=(e=>e.toArrayLike(t,"be",32).toString("base64"))(e),u=(0,a.toSnakeCaseKeys)({shareData:l,keyShareIndex:r,nodeIndex:s,timestamp:c}),d=JSON.stringify(u),h=(0,i.keccak_256)(d);return{oldKeySignature:(0,n.createEthereumSignature)(h,o),signatureTimestamp:c}};n.createNewUserShareImportItems=async(e,n,r,a)=>Promise.all(r.map(async r=>{const{nodePubKey:s,nodeIndex:i,authToken:o}=r,c=new l.default(i).toString("hex",64),u=e[c].toJSON(),d=await h(t.from(u.share,"hex"),t.from(s,"hex")),f=await h(t.from(o,"base64"),t.from(s,"hex"));return{encryptedShare:JSON.stringify(d),encryptedAuthToken:JSON.stringify(f),keyShareIndex:a,nodeIndex:i,sssEndpoint:n[i]}}));n.createKeyChangeShareImportItems=async(e,r,a,s,i)=>Promise.all(a.map(async a=>{const{nodePubKey:o,nodeIndex:c,authToken:u}=a,d=new l.default(c).toString("hex",64),f=e[d].toJSON(),m=new l.default(f.share,16),p=(0,n.createKeyChangeProof)(m,s,c,i),g=await h(t.from(f.share,"hex"),t.from(o,"hex")),w=await h(t.from(u,"base64"),t.from(o,"hex"));return{encryptedShare:JSON.stringify(g),encryptedAuthToken:JSON.stringify(w),keyShareIndex:s,nodeIndex:c,sssEndpoint:r[c],...p}}));n.generateShareImportItems=async(e,t,r,a,...s)=>{const{shares:i}=(0,n.prepareNodeShares)(e,r),o=s[0];return o!==undefined?(0,n.createKeyChangeShareImportItems)(i,e,t,a,o):(0,n.createNewUserShareImportItems)(i,e,t,a)};function f(e,t){return e.remainingTime>t.remainingTime?e:t}function m(e){if(!(0,a.isJSONRPCError)(e)||-32602!==e.code||"Rate limit exceeded"!==e.message||!e.data)return undefined;const t=(0,a.toCamelCaseKeys)(e.data);return"string"!=typeof t?.message||"number"!=typeof t?.remainingTime||"number"!=typeof t?.lockTime||"number"!=typeof t?.guessCount?undefined:{message:t.message,remainingTime:t.remainingTime,lockTime:t.lockTime,guessCount:t.guessCount}}function p(e){if(e.code===u.JsonRpcErrorCodes.ErrorCodeInvalidParams){if(e.message.toLowerCase().includes("auth token expired"))return d.TOPRFError.authTokenExpired();if(e.message.toLowerCase().includes("invalid auth token"))return d.TOPRFError.invalidAuthToken();let t=e.message;if("string"==typeof e.data)t=e.data;else if(e.data){const n=(0,a.toCamelCaseKeys)(e.data);t=JSON.stringify(n)}return d.TOPRFError.jsonRpcError(t)}if(e.code===u.JsonRpcErrorCodes.ErrorCodeInternal){const t=e.data??e.message;return d.TOPRFError.jsonRpcError(t)}return d.TOPRFError.default(e.message)}n.createNodeEndpointsMap=(e,t)=>t.reduce((t,n)=>(t[n]=e[n-1],t),{}),n.getMaxRateLimitError=f,n.extractRateLimitErrorFromResults=function(e){let t;for(const n of e)if(n.result?.lockTimeSeconds&&n.result.lockTimeSeconds>0&&n.result.guessCount){const e={remainingTime:n.result.lockTimeSeconds,message:"Rate limit exceeded",lockTime:n.result.lockTimeSeconds,guessCount:n.result.guessCount};t=t?f(t,e):e}return t},n.checkRateLimitErrors=function(e){const t=(0,a.filterErrorResponses)(e);let n;for(const e of t){const t=m(e.error);t&&(n=n?f(n,t):t)}return n},n.checkAuthTokenErrors=function(e){const t=(0,a.filterErrorResponses)(e);for(const e of t)if((0,a.isJSONRPCError)(e.error)){const t=p(e.error);if(t.code===d.TOPRFErrorCode.AuthTokenExpired||t.code===d.TOPRFErrorCode.InvalidAuthToken)return t}return undefined},n.mergeEndpointsWithAuthTokens=function(e,t){return e.map(e=>{const n=t[e.nodeIndex];if(!n)throw d.TOPRFError.endpointNotFound(`Endpoint not found for node index ${e.nodeIndex}`);return{endpoint:n,authToken:e}})},n.parseJsonRpcError=p,n.getTOPRFError=function(e){return e instanceof a.SomeError&&e.predicate&&e.predicate instanceof d.TOPRFError?e.predicate:e},n.preserveKeyOrder=function(e,t){return 0}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/utils.cjs"}],[3052,{"./errors.cjs":3054,"@noble/hashes/sha3":3262,"bn.js":4115,buffer:4176,"json-stable-stringify-without-jsonify":4756},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.toSnakeCaseKeys=n.toCamelCaseKeys=n.convertKeys=n.toSnake=n.toCamel=n.isJSONRPCError=n.filterErrorResponses=n.filterCompletedRequests=n.Some=n.getProxyCoordinatorNodeIndex=n.kCombinations=n.thresholdSame=n.safeStringify=n.add0x=n.remove0x=n.keccak256AndHexify=void 0;const a=e("@noble/hashes/sha3"),s=r(e("bn.js")),i=r(e("json-stable-stringify-without-jsonify")),o=e("./errors.cjs");function c(e){return`0x${t.from((0,a.keccak_256)(e)).toString("hex")}`}n.keccak256AndHexify=c,n.remove0x=function(e){return e.startsWith("0x")?e.slice(2):e},n.add0x=function(e){return e.startsWith("0x")?e:`0x${e}`},n.safeStringify=function(e,t){const n=(0,i.default)(e,t);if(!n)throw new Error("Failed to stringify");return n},n.thresholdSame=function(e,t){const n={};for(const r of e){const e=(0,i.default)(r);if(e&&(n[e]=n[e]?n[e]+1:1,n[e]===t))return r}return undefined},n.kCombinations=function*e(t,n){let r=t;if("number"==typeof r&&(r=Array.from({length:r},(e,t)=>t)),n>r.length||n<=0)return;if(n===r.length)return void(yield r);if(1===n){for(const e of r)yield[e];return}const a=Array.from({length:r.length-n+2},(e,t)=>t);for(const t of a)for(const a of e(r.slice(t+1),n-1))yield[r[t],...a]};function l(e){return e.replace(/_([a-z])/gu,(e,t)=>t.toUpperCase())}function u(e){return e.replace(/([A-Z])/gu,"_$1").toLowerCase()}function d(e,t){if(Array.isArray(e))return e.map(e=>d(e,t));if(null!==e&&"object"==typeof e){const n={};for(const[r,a]of Object.entries(e))n[t(r)]=d(a,t);return n}return e}n.getProxyCoordinatorNodeIndex=(e,n,r)=>{const a=`${n}${r}`,i=c(t.from(a,"utf8")).slice(2);return e[new s.default(i,"hex").mod(new s.default(e.length)).toNumber()]},n.Some=async function(e,t){let n;const r=new Array(e.length).fill(undefined),a=new Array(e.length).fill(undefined);for(const[s,i]of e.entries()){let e;try{const t=new Promise((t,n)=>{e=setTimeout(()=>n(new Error("Promise timed out")),1e4)});r[s]=await Promise.race([i,t])}catch(e){a[s]=e}finally{e&&clearTimeout(e)}try{const e=r.every(e=>e!==undefined),n=await t(r,{allSettled:e});if(n)return n}catch(e){n=e}}!function(e,t,n){let r=e.some(e=>e!==undefined);if(r)throw new o.SomeError({errors:e,responses:t,predicate:n});if(r=t.some(e=>Boolean(e?.error)),r){const e=t.map(e=>{const{error:t}=e;return t?.data&&t.data.length>0?new Error(t.data):undefined});throw new o.SomeError({errors:e,responses:t,predicate:n})}throw new o.SomeError({errors:e,responses:t,predicate:n})}(a,r,n)},n.filterCompletedRequests=function(e){return e.filter(e=>{const t=e&&"object"==typeof e,n=e,r=!n?.error,a=Boolean(n?.result);return t&&r&&a})},n.filterErrorResponses=function(e){return e.filter(e=>{const t=e&&"object"==typeof e,n=e,r=Boolean(n?.error);return t&&r})},n.isJSONRPCError=function(e){const t=e;return Boolean(e&&"object"==typeof e)&&"number"==typeof t?.code&&"string"==typeof t?.message},n.toCamel=l,n.toSnake=u,n.convertKeys=d;n.toCamelCaseKeys=e=>d(e,l);n.toSnakeCaseKeys=e=>d(e,u)}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/common.cjs"}],[3053,{"./common.cjs":3052,buffer:4176,elliptic:4349},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.uint8ArrayToHex=n.derivePubKey=n.toChecksumAddress=n.encParamsHexToBuf=n.encryptedParamsBufToHex=n.generatePrivateKey=n.getSecp256K1Curve=void 0;const r=e("elliptic"),a=e("./common.cjs");let s=null;n.getSecp256K1Curve=function(){return s=s??new r.ec("secp256k1"),s},n.generatePrivateKey=function(e){return e.genKeyPair().getPrivate()},n.encryptedParamsBufToHex=function(e){return{iv:t.from(e.iv).toString("hex"),ephemPublicKey:t.from(e.ephemPublicKey).toString("hex"),mac:t.from(e.mac).toString("hex"),mode:"AES256"}},n.encParamsHexToBuf=function(e){return{iv:t.from(e.iv,"hex"),ephemPublicKey:t.from(e.ephemPublicKey,"hex"),mac:t.from(e.mac,"hex")}},n.toChecksumAddress=function(e){const n=(r=e,r.startsWith("0x")||r.startsWith("0X")?r.slice(2):r).toLowerCase();var r;const s=t.from(n,"utf8"),i=(0,a.keccak256AndHexify)(s).slice(2);let o="0x";for(let e=0;e<n.length;e++)parseInt(i[e],16)>=8?o+=n[e].toUpperCase():o+=n[e];return o},n.derivePubKey=function(e,t){const n=t.toString(16,64);return e.keyFromPrivate(n,"hex").getPublic()},n.uint8ArrayToHex=function(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/cryptoUtils.cjs"}],[3054,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SomeError=void 0;class r extends Error{constructor({errors:e,responses:t,predicate:n}){const a=n?.message??"unknown error";super(`Unable to resolve enough promises. \n      errors: ${e.map(e=>e?.message??e).join(", ")}, \n      predicate error: ${a},\n      ${t.length} responses,\n      responses: ${JSON.stringify(t)}`),this.errors=e,this.responses=t,this.predicate=n,Object.setPrototypeOf(this,r.prototype)}toString(){return this.message}}n.SomeError=r}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/errors.cjs"}],[3055,{"bn.js":4115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.waitFor=n.capitalizeFirstLetter=n.generateEmptyBNArray=void 0;const a=r(e("bn.js"));n.generateEmptyBNArray=function(e){return Array.from({length:e},()=>new a.default(0))},n.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},n.waitFor=async function(e=2e3){return new Promise(t=>{setTimeout(t,e)})}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/helpers.cjs"}],[3056,{"./common.cjs":3052,"./cryptoUtils.cjs":3053,"./errors.cjs":3054,"./helpers.cjs":3055,"./lagrangeInterpolation.cjs":3057,"./point.cjs":3058,"./polynomial.cjs":3059,"./share.cjs":3060},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Share=n.Polynomial=n.Point=void 0;var i=e("./point.cjs");Object.defineProperty(n,"Point",{enumerable:!0,get:function(){return s(i).default}});var o=e("./polynomial.cjs");Object.defineProperty(n,"Polynomial",{enumerable:!0,get:function(){return s(o).default}});var c=e("./share.cjs");Object.defineProperty(n,"Share",{enumerable:!0,get:function(){return s(c).default}}),a(e("./errors.cjs"),n),a(e("./common.cjs"),n),a(e("./lagrangeInterpolation.cjs"),n),a(e("./cryptoUtils.cjs"),n),a(e("./helpers.cjs"),n)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/index.cjs"}],[3057,{"./cryptoUtils.cjs":3053,"./helpers.cjs":3055,"./point.cjs":3058,"./polynomial.cjs":3059,"@noble/curves/abstract/modular":3243,"@noble/curves/abstract/utils":3245,"@noble/curves/secp256k1":3248,"@noble/hashes/utils":3264,"bn.js":4115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.lagrangeInterpolation=n.lagrangeInterpolationForScalars=n.lagrangeInterpolationForPoints=n.lagrangeInterpolationNoble=n.generateRandomScalar=n.generateRandomPolynomialNoble=n.generateRandomPolynomial=n.lagrangeInterpolatePolynomial=void 0;const o=e("@noble/curves/abstract/modular"),c=e("@noble/curves/abstract/utils"),l=e("@noble/curves/secp256k1"),u=e("@noble/hashes/utils"),d=i(e("bn.js")),h=e("./cryptoUtils.cjs"),f=e("./helpers.cjs"),m=i(e("./point.cjs")),p=s(e("./polynomial.cjs"));function g(e,t){const n=(0,h.generatePrivateKey)(t);return e.find(e=>e.eq(n))?g(e,t):n}function w(e,t,n){const r=(0,f.generateEmptyBNArray)(e.length+t.length-1);for(let a=0;a<e.length;a++)for(let s=0;s<t.length;s++)r[a+s]=r[a+s].add(e[a].mul(t[s])).umod(n);return r}function b(e,t){const n=t.length,r=(0,f.generateEmptyBNArray)(n);if(!e.n)throw new Error("Curve is not set");for(let a=0;a<n;a++){let s=[new d.default(1)];for(let r=0;r<n;r++){if(r===a)continue;const n=t[a].xCoordinate.sub(t[r].xCoordinate).umod(e.n).invm(e.n);s=w(s,[t[r].xCoordinate.neg().umod(e.n).mul(n).umod(e.n),n],e.n)}for(let n=0;n<s.length;n++)r[n]=r[n].add(s[n].mul(t[a].yCoordinate)).umod(e.n)}return new p.default(r,e)}function T(e=l.secp256k1.CURVE.n){const t=(0,o.getMinHashLength)(e),n=(0,u.randomBytes)(t);return(0,c.bytesToNumberBE)(n)%e}function E(e,t,n){if(t.length!==n.length)throw new Error("Values and nodeIndex arrays must have the same length");if(0===t.length)throw new Error("Cannot interpolate with empty arrays");const r=(0,o.Field)(e),a="bigint"==typeof t[0];let s=a?0n:l.secp256k1.ProjectivePoint.ZERO;for(let e=0;e<t.length;e++){let i=1n,o=1n;for(let t=0;t<n.length;t++){if(e===t)continue;const a=n[e],s=n[t],c=r.neg(s),l=r.sub(a,s);i=r.mul(i,c),o=r.mul(o,l)}const c=r.mul(i,r.inv(o));if(a){const n=t[e],a=r.mul(n,c);s=r.add(s,a)}else{const n=t[e].multiply(c);s=s.add(n)}}return s}n.lagrangeInterpolatePolynomial=b,n.generateRandomPolynomial=function(e,t,n,r){let a;if(a=n||g([new d.default(0)],e),!r){const n=[a];for(let r=0;r<t;r+=1){const t=g(n,e);n.push(t)}return new p.default(n,e)}if(!Array.isArray(r))throw new Error("deterministic shares in generateRandomPolynomial should be an array");if(r.length>t)throw new Error("deterministicShares in generateRandomPolynomial should be less or equal than degree to ensure an element of randomness");const s={};r.forEach(t=>{s[t.shareIndex.toString("hex",64)]=new m.default(t.shareIndex,t.share,e)});for(let n=0;n<t-r.length;n+=1){const t=[new d.default(0)];Object.keys(s).forEach(e=>{t.push(new d.default(e,"hex"))});const n=g(t,e);s[n.toString("hex",64)]=new m.default(n,(0,h.generatePrivateKey)(e),e)}return s[0]=new m.default(new d.default(0),a,e),b(e,Object.values(s))},n.generateRandomPolynomialNoble=function(e,t,n){const r=[n??T(e)];for(let n=1;n<=t;n++)r[n]=T(e);return new p.PolynomialNoble(r,e)},n.generateRandomScalar=T,n.lagrangeInterpolationNoble=E,n.lagrangeInterpolationForPoints=function(e,t,n){return E(e,t,n)},n.lagrangeInterpolationForScalars=function(e,t,n){return E(e,t,n)},n.lagrangeInterpolation=function(e,t,n){if(t.length!==n.length)throw new Error("shares not equal to nodeIndex length in lagrangeInterpolation");const r=t.map((t,r)=>new m.default(n[r],t,e));return b(e,r).polynomial[0]}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/lagrangeInterpolation.cjs"}],[3058,{"bn.js":4115,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=r(e("bn.js"));n.default=class{constructor(e,t,n){this.xCoordinate=new a.default(e,"hex"),this.yCoordinate=new a.default(t,"hex"),this.ecCurve=n}encode(e){switch(e){case"arr":return t.concat([t.from("04","hex"),t.from(this.xCoordinate.toString("hex",64),"hex"),t.from(this.yCoordinate.toString("hex",64),"hex")]);case"elliptic-compressed":{const e=this.ecCurve.keyFromPublic({x:this.xCoordinate.toString("hex",64),y:this.yCoordinate.toString("hex",64)},"hex");return t.from(e.getPublic(!0,"hex"),"hex")}default:throw new Error("encoding doesn't exist in Point")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/point.cjs"}],[3059,{"./share.cjs":3060,"@noble/curves/abstract/modular":3243,"bn.js":4115,elliptic:4349},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PolynomialNoble=void 0;const c=e("@noble/curves/abstract/modular"),l=o(e("bn.js")),u=e("elliptic"),d=o(e("./share.cjs"));class h{constructor(e,t,n){r.set(this,void 0),a.set(this,void 0),n?(s(this,r,e,"f"),s(this,a,(0,c.Field)(n.curveN),"f"),this.polynomial=i(this,r,"f").map(e=>new l.default(e.toString()))):this.polynomial=e,this.ecCurve=t}getThreshold(){return this.polynomial.length}polyEval(e){const t=new l.default(e,"hex");let n=new l.default(t),r=new l.default(0);r=r.add(this.polynomial[0]);const{n:a}=this.ecCurve;if(!a)throw new Error("Curve is not set");for(const e of this.polynomial.slice(1)){const s=n.mul(e);r=r.add(s),r=r.umod(a),n=n.mul(new l.default(t)),n=n.umod(a)}return r}polyEvalNoble(e){if(!i(this,r,"f")||!i(this,a,"f"))throw new Error("Noble implementation not initialized");if(0===i(this,r,"f").length)return 0n;let t=i(this,r,"f")[0],n=e;for(let s=1;s<i(this,r,"f").length;s++)t=i(this,a,"f").add(t,i(this,a,"f").mul(i(this,r,"f")[s],n)),n=i(this,a,"f").mul(n,e);return t}generateShares(e){const t=e.map(e=>{if("bigint"==typeof e)return new l.default(e.toString());if("number"==typeof e)return new l.default(e);if(e instanceof l.default)return e;if("string"==typeof e)return new l.default(e,"hex");throw new Error("Invalid share index")}),n={};for(const e of t)n[e.toString("hex",64)]=new d.default(e,this.polyEval(e));return n}}r=new WeakMap,a=new WeakMap,n.default=h;n.PolynomialNoble=class extends h{constructor(e,t){super(e,new u.ec("secp256k1"),{curveN:t})}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/polynomial.cjs"}],[3060,{"bn.js":4115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=r(e("bn.js"));class s{constructor(e,t){this.share=new a.default(t,"hex"),this.shareIndex=new a.default(e,"hex")}static fromJSON(e){const{share:t,shareIndex:n}=e;return new s(n,t)}toJSON(){return{share:this.share.toString("hex",64),shareIndex:this.shareIndex.toString("hex",64)}}}n.default=s}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/share.cjs"}],[3061,{"@babel/runtime/helpers/objectSpread2":628,deepmerge:4329,loglevel:4948},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/objectSpread2"),a=e("deepmerge"),s=e("loglevel");const i=s.getLogger("http-helpers");i.setLevel(s.levels.INFO);let o="torus-default",c="";const l="x-api-key",u="x-embed-host";let d=null;const h=[],f=[];async function m(e,t){let n=null;try{n=new URL(e)}catch{}if(d&&n&&(h.includes(n.origin)||f.includes(n.pathname))){return await d.startSpan({name:e,op:"http.client"},async()=>await fetch(e,t))}return fetch(e,t)}function p(){const e={};return o&&(e[l]=o),c&&(e[u]=c),e}function g(e){i.info(`Response: ${e.status} ${e.statusText}`),i.info(`Url: ${e.url}`)}const w=async(e,t)=>{let n=null;try{const r=new Promise((t,r)=>{n=setTimeout(()=>{r(new Error(`Timed out in ${e}ms`))},e)}),a=await Promise.race([t,r]);return null!=n&&clearTimeout(n),a}catch(e){throw null!=n&&clearTimeout(n),e}},b=async(e,t={},n={})=>{const s={mode:"cors",headers:{}};n.useAPIKey&&(s.headers=r(r({},s.headers),p())),t.method="GET";const i=a(s,t),o=await m(e,i);if(o.ok){const e=o.headers.get("content-type");return null!=e&&e.includes("application/json")?o.json():o.text()}throw g(o),o};n.clearAPIKey=function(){o="torus-default"},n.clearEmbedHost=function(){c=""},n.enableSentryTracing=function(e,t,n){d=e,h.push(...t),f.push(...n)},n.gatewayAuthHeader=l,n.gatewayEmbedHostHeader=u,n.generateJsonRPCObject=(e,t)=>({jsonrpc:"2.0",method:e,id:10,params:t}),n.get=b,n.getAPIKey=function(){return o},n.getEmbedHost=function(){return c},n.patch=async(e,t={},n={},s={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(i.headers=r(r({},i.headers),p())),n.method="PATCH";const o=a(i,n);s.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await m(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.post=(e,t={},n={},s={})=>{const o={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(o.headers=r(r({},o.headers),p())),n.method="POST";const c=a(o,n);return s.isUrlEncodedData?(c.body=t,"application/json; charset=utf-8"===c.headers["Content-Type"]&&delete c.headers["Content-Type"]):c.body=JSON.stringify(t),w(s.timeout||6e4,m(e,c).then(e=>{if(s.logTracingHeader&&function(e){const t=e.headers.get("x-web3-correlation-id");t&&i.info(`Request tracing with traceID = ${t}`)}(e),e.ok){const t=e.headers.get("content-type");return null!=t&&t.includes("application/json")?e.json():e.text()}throw g(e),e}))},n.promiseRace=(e,t,n=6e4)=>Promise.race([b(e,t),new Promise((e,t)=>{setTimeout(()=>{t(new Error("timed out"))},n)})]),n.promiseTimeout=w,n.put=async(e,t={},n={},s={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(i.headers=r(r({},i.headers),p())),n.method="PUT";const o=a(i,n);s.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await m(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.remove=async(e,t={},n={},s={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(i.headers=r(r({},i.headers),p())),n.method="DELETE";const o=a(i,n);s.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await m(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.setAPIKey=function(e){o=e},n.setEmbedHost=function(e){c=e},n.setLogLevel=function(e){i.setLevel(e)}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@toruslabs/http-helpers",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@toruslabs/http-helpers/dist/lib.cjs/index.js"}],[3062,{"./gas-flows/DefaultGasFeeFlow.cjs":3067,"./gas-flows/LineaGasFeeFlow.cjs":3068,"./gas-flows/OptimismLayer1GasFeeFlow.cjs":3069,"./gas-flows/RandomisedEstimationsGasFeeFlow.cjs":3071,"./gas-flows/ScrollLayer1GasFeeFlow.cjs":3072,"./gas-flows/TestGasFeeFlow.cjs":3073,"./helpers/AccountsApiRemoteTransactionSource.cjs":3074,"./helpers/GasFeePoller.cjs":3075,"./helpers/IncomingTransactionHelper.cjs":3076,"./helpers/MethodDataHelper.cjs":3077,"./helpers/MultichainTrackingHelper.cjs":3078,"./helpers/PendingTransactionTracker.cjs":3079,"./helpers/ResimulateHelper.cjs":3080,"./hooks/ExtraTransactionsPublishHook.cjs":3083,"./logger.cjs":3086,"./types.cjs":3087,"./utils/balance-changes.cjs":3088,"./utils/batch.cjs":3090,"./utils/eip7702.cjs":3091,"./utils/external-transactions.cjs":3092,"./utils/first-time-interaction.cjs":3094,"./utils/gas-fee-tokens.cjs":3095,"./utils/gas-fees.cjs":3096,"./utils/gas-flow.cjs":3097,"./utils/gas.cjs":3098,"./utils/layer1-gas-fee-flow.cjs":3099,"./utils/nonce.cjs":3100,"./utils/prepare.cjs":3101,"./utils/retry.cjs":3102,"./utils/swaps.cjs":3104,"./utils/transaction-type.cjs":3105,"./utils/utils.cjs":3106,"./utils/validation.cjs":3107,"@metamask/base-controller":1401,"@metamask/controller-utils":1488,"@metamask/eth-query":2073,"@metamask/network-controller":2426,"@metamask/nonce-tracker":2437,"@metamask/rpc-errors":2692,"@metamask/utils":3207,events:4472,lodash:4940,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T,E,y,S,I,k,A,C,_,P,v,N,R,j,O,x,L,M,F,D,B,G,U,H,q,W,$,K,V,Y,z,Q,J,X,Z,ee,te,ne,re,ae,se,ie,oe,ce,le,ue,de,he,fe,me,pe,ge,we,be,Te,Ee,ye,Se,Ie,ke,Ae,Ce,_e,Pe,ve,Ne,Re,je,Oe,xe,Le,Me,Fe,De,Be,Ge,Ue,He,qe,We,$e,Ke,Ve,Ye,ze,Qe,Je,Xe,Ze,et,tt,nt=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},rt=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},at=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionController=n.ApprovalState=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;const st=e("@metamask/base-controller"),it=e("@metamask/controller-utils"),ot=at(e("@metamask/eth-query")),ct=e("@metamask/network-controller"),lt=e("@metamask/nonce-tracker"),ut=e("@metamask/rpc-errors"),dt=e("@metamask/utils"),ht=e("events"),ft=e("lodash"),mt=e("uuid"),pt=e("./gas-flows/DefaultGasFeeFlow.cjs"),gt=e("./gas-flows/LineaGasFeeFlow.cjs"),wt=e("./gas-flows/OptimismLayer1GasFeeFlow.cjs"),bt=e("./gas-flows/RandomisedEstimationsGasFeeFlow.cjs"),Tt=e("./gas-flows/ScrollLayer1GasFeeFlow.cjs"),Et=e("./gas-flows/TestGasFeeFlow.cjs"),yt=e("./helpers/AccountsApiRemoteTransactionSource.cjs"),St=e("./helpers/GasFeePoller.cjs"),It=e("./helpers/IncomingTransactionHelper.cjs"),kt=e("./helpers/MethodDataHelper.cjs"),At=e("./helpers/MultichainTrackingHelper.cjs"),Ct=e("./helpers/PendingTransactionTracker.cjs"),_t=e("./helpers/ResimulateHelper.cjs"),Pt=e("./hooks/ExtraTransactionsPublishHook.cjs"),vt=e("./logger.cjs"),Nt=e("./types.cjs"),Rt=e("./utils/balance-changes.cjs"),jt=e("./utils/batch.cjs"),Ot=e("./utils/eip7702.cjs"),xt=e("./utils/external-transactions.cjs"),Lt=e("./utils/first-time-interaction.cjs"),Mt=e("./utils/gas.cjs"),Ft=e("./utils/gas-fee-tokens.cjs"),Dt=e("./utils/gas-fees.cjs"),Bt=e("./utils/gas-flow.cjs"),Gt=e("./utils/layer1-gas-fee-flow.cjs"),Ut=e("./utils/nonce.cjs"),Ht=e("./utils/prepare.cjs"),qt=e("./utils/retry.cjs"),Wt=e("./utils/swaps.cjs"),$t=e("./utils/transaction-type.cjs"),Kt=e("./utils/utils.cjs"),Vt=e("./utils/validation.cjs"),Yt={transactions:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},transactionBatches:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},methodData:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastFetchedBlockNumbers:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},submitHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};n.CANCEL_RATE=1.1,n.SPEED_UP_RATE=1.1;const zt="TransactionController";var Qt;!function(e){e.Approved="approved",e.NotApproved="not-approved",e.SkippedViaBeforePublishHook="skipped-via-before-publish-hook"}(Qt||(n.ApprovalState=Qt={}));class Jt extends st.BaseController{constructor(e){const{disableSwaps:t,getCurrentAccountEIP1559Compatibility:n,getCurrentNetworkEIP1559Compatibility:W,getExternalPendingTransactions:$,getGasFeeEstimates:K,getNetworkClientRegistry:V,getNetworkState:z,getPermittedAccounts:Q,getSavedGasFees:J,getSimulationConfig:X,hooks:Z,incomingTransactions:te={},isAutomaticGasFeeUpdateEnabled:ne,isEIP7702GasFeeTokensEnabled:re,isFirstTimeInteractionEnabled:ae,isSimulationEnabled:se,messenger:ie,pendingTransactions:oe={},publicKeyEIP7702:ce,securityProviderRequest:le,sign:ue,state:he,testGasFeeFlows:fe,trace:me,transactionHistoryLimit:pe=40}=e;super({name:zt,metadata:Yt,messenger:ie,state:{methodData:{},transactions:[],transactionBatches:[],lastFetchedBlockNumbers:{},submitHistory:[],...he}}),r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,new Set),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),f.set(this,void 0),m.set(this,void 0),p.set(this,void 0),g.set(this,void 0),w.set(this,void 0),b.set(this,void 0),T.set(this,void 0),E.set(this,void 0),y.set(this,void 0),S.set(this,void 0),I.set(this,new ht.EventEmitter),k.set(this,void 0),A.set(this,void 0),C.set(this,void 0),_.set(this,void 0),P.set(this,void 0),v.set(this,void 0),N.set(this,void 0),R.set(this,void 0),j.set(this,void 0),O.set(this,void 0),x.set(this,void 0),L.set(this,void 0),M.set(this,void 0),F.set(this,void 0),D.set(this,void 0),B.set(this,new Map),G.set(this,new Set),U.set(this,void 0),H.set(this,void 0),q.set(this,void 0),Pe.set(this,()=>{rt(this,j,"f").checkForPendingTransactionAndStartPolling()}),this.messenger=ie,nt(this,a,Z?.afterAdd??(()=>Promise.resolve({})),"f"),nt(this,s,Z?.afterSign??(()=>!0),"f"),nt(this,i,Z?.afterSimulate??(()=>Promise.resolve({})),"f"),nt(this,c,Z?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),nt(this,l,Z?.beforePublish??(()=>Promise.resolve(!0)),"f"),nt(this,u,Z?.beforeSign??(()=>Promise.resolve({})),"f"),nt(this,h,Z?.getAdditionalSignArguments??(()=>[]),"f"),nt(this,f,n??(()=>Promise.resolve(!0)),"f"),nt(this,m,W,"f"),nt(this,p,$??(()=>[]),"f"),nt(this,g,K??(()=>Promise.resolve({})),"f"),nt(this,w,z,"f"),nt(this,b,Q,"f"),nt(this,T,J??(e=>undefined),"f"),nt(this,E,X??(()=>Promise.resolve({})),"f"),nt(this,S,te,"f"),nt(this,k,ne??(e=>!1),"f"),nt(this,A,re??(()=>Promise.resolve(!1)),"f"),nt(this,C,ae??(()=>!0),"f"),nt(this,_,se??(()=>!0),"f"),nt(this,P,t??!1,"f"),nt(this,v,Z?.isTimeoutEnabled??(()=>!0),"f"),nt(this,O,oe,"f"),nt(this,x,ce,"f"),nt(this,L,Z?.publish??(()=>Promise.resolve({transactionHash:undefined})),"f"),nt(this,M,Z?.publishBatch,"f"),nt(this,F,le,"f"),nt(this,D,ue,"f"),nt(this,U,!0===fe,"f"),nt(this,H,me??((e,t)=>t?.()),"f"),nt(this,q,pe,"f");const ge=e=>this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);nt(this,j,new At.MultichainTrackingHelper({findNetworkClientIdByChainId:ge,getNetworkClientById:e=>this.messenger.call("NetworkController:getNetworkClientById",e),getNetworkClientRegistry:V,removePendingTransactionTrackerListeners:rt(this,r,"m",Re).bind(this),createNonceTracker:rt(this,r,"m",Ce).bind(this),createPendingTransactionTracker:rt(this,r,"m",_e).bind(this),onNetworkStateChange:e=>{this.messenger.subscribe("NetworkController:stateChange",e)}}),"f"),rt(this,j,"f").initialize(),nt(this,d,rt(this,r,"m",Me).call(this),"f"),nt(this,N,rt(this,r,"m",Fe).call(this),"f");const we=new St.GasFeePoller({findNetworkClientIdByChainId:ge,gasFeeFlows:rt(this,d,"f"),getGasFeeControllerEstimates:rt(this,g,"f"),getProvider:e=>rt(this,r,"m",de).call(this,{networkClientId:e}),getTransactions:()=>this.state.transactions,getTransactionBatches:()=>this.state.transactionBatches,layer1GasFeeFlows:rt(this,N,"f"),messenger:this.messenger,onStateChange:e=>{this.messenger.subscribe("TransactionController:stateChange",e)}});we.hub.on("transaction-updated",rt(this,r,"m",Ge).bind(this)),we.hub.on("transaction-batch-updated",rt(this,r,"m",Ue).bind(this)),nt(this,R,new kt.MethodDataHelper({getProvider:e=>rt(this,r,"m",de).call(this,{networkClientId:e}),getState:()=>this.state.methodData}),"f"),rt(this,R,"f").hub.on("update",({fourBytePrefix:e,methodData:t})=>{this.update(n=>{n.methodData[e]=t})}),nt(this,y,new It.IncomingTransactionHelper({client:rt(this,S,"f").client,getCurrentAccount:()=>rt(this,r,"m",qe).call(this),getLocalTransactions:()=>this.state.transactions,includeTokenTransfers:rt(this,S,"f").includeTokenTransfers,isEnabled:rt(this,S,"f").isEnabled,messenger:this.messenger,remoteTransactionSource:new yt.AccountsApiRemoteTransactionSource,trimTransactions:rt(this,r,"m",ee).bind(this),updateTransactions:rt(this,S,"f").updateTransactions}),"f"),rt(this,r,"m",Ne).call(this,rt(this,y,"f")),this.messenger.subscribe("TransactionController:stateChange",rt(this,Pe,"f")),new _t.ResimulateHelper({simulateTransaction:rt(this,r,"m",Be).bind(this),onTransactionsUpdate:e=>{this.messenger.subscribe("TransactionController:stateChange",e,e=>e.transactions)},getTransactions:()=>this.state.transactions}),rt(this,r,"m",Y).call(this),rt(this,Pe,"f").call(this),rt(this,r,"m",Ve).call(this)}destroy(){rt(this,r,"m",ve).call(this)}async handleMethodData(e,t){return rt(this,R,"f").lookup(e,t)}async addTransactionBatch(e){const{blockTracker:t}=this.messenger.call("NetworkController:getNetworkClientById",e.networkClientId);return await(0,jt.addTransactionBatch)({addTransaction:this.addTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getChainId:rt(this,r,"m",ce).bind(this),getEthQuery:e=>rt(this,r,"m",ue).call(this,{networkClientId:e}),getGasFeeEstimates:rt(this,g,"f"),getInternalAccounts:rt(this,r,"m",We).bind(this),getSimulationConfig:rt(this,E,"f").bind(this),getPendingTransactionTracker:e=>rt(this,r,"m",_e).call(this,{provider:rt(this,r,"m",de).call(this,{networkClientId:e}),blockTracker:t,chainId:rt(this,r,"m",ce).call(this,e),networkClientId:e}),getTransaction:e=>rt(this,r,"m",se).call(this,e),isSimulationEnabled:rt(this,_,"f"),messenger:this.messenger,publishBatchHook:rt(this,M,"f"),publicKeyEIP7702:rt(this,x,"f"),publishTransaction:(e,t)=>rt(this,r,"m",X).call(this,e,t),request:e,signTransaction:rt(this,r,"m",ye).bind(this),update:this.update.bind(this),updateTransaction:rt(this,r,"m",De).bind(this)})}async isAtomicBatchSupported(e){return(0,jt.isAtomicBatchSupported)({...e,getEthQuery:e=>rt(this,r,"m",ue).call(this,{chainId:e}),messenger:this.messenger,publicKeyEIP7702:rt(this,x,"f")})}async addTransaction(e,t){(0,vt.projectLogger)("Adding transaction",e,t);const{actionId:n,assetsFiatValues:s,batchId:i,deviceConfirmedOn:o,disableGasBuffer:c,gasFeeToken:l,isGasFeeIncluded:u,isGasFeeSponsored:d,isStateOnly:h,method:f,nestedTransactions:m,networkClientId:p,origin:g,publishHook:w,requestId:T,requireApproval:E,securityAlertResponse:y,skipInitialGasEstimate:S,swaps:I={},traceContext:k,type:A}=t;if(e=(0,Kt.normalizeTransactionParams)(e),!rt(this,j,"f").has(p))throw new Error(`Network client not found - ${p}`);const _=rt(this,r,"m",ce).call(this,p),v=rt(this,r,"m",ue).call(this,{networkClientId:p}),N=g===undefined?undefined:await(rt(this,b,"f")?.call(this,g)),R=rt(this,r,"m",We).call(this);await(0,Vt.validateTransactionOrigin)({data:e.data,from:e.from,internalAccounts:R,origin:g,permittedAddresses:N,txParams:e,type:A});const O=(0,Ot.getDelegationAddress)(e.from,v).catch(()=>undefined),x=await rt(this,r,"m",Ee).call(this,p);(0,Vt.validateTxParams)(e,x,_),e.type||(0,Kt.setEnvelopeType)(e,x);if(i?.length&&this.state.transactions.some(e=>e.batchId?.toLowerCase()===i?.toLowerCase())&&g&&g!==it.ORIGIN_METAMASK)throw new ut.JsonRpcError(Vt.ErrorCode.DuplicateBundleId,"Batch ID already exists");const L=rt(this,r,"m",fe).call(this,e,g),M=A??(await(0,$t.determineTransactionType)(e,v)).type,D=rt(this,r,"m",we).call(this,n);let B=D?(0,ft.cloneDeep)(D):{actionId:n,assetsFiatValues:s,batchId:i,chainId:_,dappSuggestedGasFees:L,deviceConfirmedOn:o,disableGasBuffer:c,id:(0,mt.v1)(),isGasFeeTokenIgnoredIfBalance:Boolean(l),isGasFeeIncluded:u,isGasFeeSponsored:d,isFirstTimeInteraction:undefined,isStateOnly:h,nestedTransactions:m,networkClientId:p,origin:g,requestId:T,securityAlertResponse:y,selectedGasFeeToken:l,status:Nt.TransactionStatus.unapproved,time:Date.now(),txParams:e,type:M,userEditedGasLimit:!1,verifiedOnBlockchain:!1};const{updateTransaction:G}=await rt(this,a,"f").call(this,{transactionMeta:B});if(G&&((0,vt.projectLogger)("Updating transaction using afterAdd hook"),B.txParamsOriginal=(0,ft.cloneDeep)(B.txParams),G(B)),S){const e=(0,ft.cloneDeep)(B);rt(this,r,"m",V).call(this,e).then(()=>(rt(this,r,"m",De).call(this,{transactionId:e.id,skipResimulateCheck:!0,skipValidation:!0},t=>{t.txParams.gas=e.txParams.gas,t.txParams.gasPrice=e.txParams.gasPrice,t.txParams.maxFeePerGas=e.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas}),undefined)).catch(ft.noop)}else await rt(this,H,"f").call(this,{name:"Estimate Gas Properties",parentContext:k},e=>rt(this,r,"m",V).call(this,B,{traceContext:e}));if(!D){if(f&&rt(this,F,"f")){const e=await rt(this,F,"f").call(this,B,f);B.securityProviderResponse=e}B=(0,Wt.updateSwapsTransaction)(B,M,I,{isSwapsDisabled:rt(this,P,"f"),cancelTransaction:rt(this,r,"m",Z).bind(this),messenger:this.messenger}),rt(this,r,"m",K).call(this,B),O.then(e=>(rt(this,r,"m",De).call(this,{transactionId:B.id,skipResimulateCheck:!0,skipValidation:!0},t=>{t.delegationAddress=e}),undefined)).catch(ft.noop),!1===E||h?(0,vt.projectLogger)("Skipping simulation & first interaction update as approval not required"):(rt(this,r,"m",Be).call(this,B,{traceContext:k}).catch(e=>{throw(0,vt.projectLogger)("Error while updating simulation data",e),e}),(0,Lt.updateFirstTimeInteraction)({existingTransactions:this.state.transactions,getTransaction:e=>rt(this,r,"m",ae).call(this,e),isFirstTimeInteractionEnabled:rt(this,C,"f"),trace:rt(this,H,"f"),traceContext:k,transactionMeta:B,updateTransaction:rt(this,r,"m",De).bind(this)}).catch(e=>{(0,vt.projectLogger)("Error while updating first interaction properties",e)})),this.messenger.publish(`${zt}:unapprovedTransactionAdded`,B)}return{result:rt(this,r,"m",Q).call(this,B,{actionId:n,isExisting:Boolean(D),publishHook:w,requireApproval:E,traceContext:k}),transactionMeta:B}}startIncomingTransactionPolling(){rt(this,y,"f").start()}stopIncomingTransactionPolling(){rt(this,y,"f").stop()}async updateIncomingTransactions({tags:e}={}){await rt(this,y,"f").update({tags:e})}async stopTransaction(e,t,{estimatedBaseFee:a,actionId:s}={}){await rt(this,r,"m",W).call(this,{actionId:s,estimatedBaseFee:a,gasValues:t,label:"cancel",rate:n.CANCEL_RATE,transactionId:e,transactionType:Nt.TransactionType.cancel,prepareTransactionParams:e=>{delete e.data,e.to=e.from,e.value="0x0"},afterSubmit:e=>{this.messenger.publish(`${zt}:transactionFinished`,e),rt(this,I,"f").emit(`${e.id}:finished`,e)}})}async speedUpTransaction(e,t,{actionId:a,estimatedBaseFee:s}={}){await rt(this,r,"m",W).call(this,{actionId:a,estimatedBaseFee:s,gasValues:t,label:"speed up",rate:n.SPEED_UP_RATE,transactionId:e,transactionType:Nt.TransactionType.retry,afterSubmit:e=>{this.messenger.publish(`${zt}:speedupTransactionAdded`,e)}})}async estimateGas(e,t,{ignoreDelegationSignatures:n}={}){const a=rt(this,r,"m",ue).call(this,{networkClientId:t}),{estimatedGas:s,simulationFails:i}=await(0,Mt.estimateGas)({chainId:rt(this,r,"m",ce).call(this,t),ethQuery:a,ignoreDelegationSignatures:n,isSimulationEnabled:rt(this,_,"f").call(this),getSimulationConfig:rt(this,E,"f"),messenger:this.messenger,txParams:e});return{gas:s,simulationFails:i}}async estimateGasBatch({chainId:e,from:t,transactions:n}){const a=rt(this,r,"m",ue).call(this,{chainId:e});return(0,Mt.estimateGasBatch)({chainId:e,ethQuery:a,from:t,getSimulationConfig:rt(this,E,"f"),isAtomicBatchSupported:this.isAtomicBatchSupported.bind(this),messenger:this.messenger,transactions:n})}async estimateGasBuffered(e,t,n){const a=rt(this,r,"m",ue).call(this,{networkClientId:n}),{blockGasLimit:s,estimatedGas:i,simulationFails:o}=await(0,Mt.estimateGas)({chainId:rt(this,r,"m",ce).call(this,n),ethQuery:a,isSimulationEnabled:rt(this,_,"f").call(this),getSimulationConfig:rt(this,E,"f"),messenger:this.messenger,txParams:e});return{gas:(0,Mt.addGasBuffer)(i,s,t),simulationFails:o}}updateTransaction(e,t){const{id:n}=e;rt(this,r,"m",De).call(this,{transactionId:n},()=>({...e})),(0,vt.projectLogger)("Transaction updated",{transactionId:n,note:t})}updateSecurityAlertResponse(e,t){if(!t)throw new Error("updateSecurityAlertResponse: securityAlertResponse should not be null");const n=rt(this,r,"m",ae).call(this,e);if(!n)throw new Error("Cannot update security alert response as no transaction metadata found");const a={...n,securityAlertResponse:t};this.updateTransaction(a,`${zt}:updatesecurityAlertResponse - securityAlertResponse updated`)}wipeTransactions({address:e,chainId:t}={}){if(!t&&!e)return void this.update(e=>{e.transactions=[]});const n=this.state.transactions.filter(({chainId:n,txParams:r,type:a})=>{if(!(!t||t===n))return!0;return!(!e||r.from?.toLowerCase()===e.toLowerCase()||a===Nt.TransactionType.incoming&&r.to?.toLowerCase()===e.toLowerCase())});this.update(e=>{e.transactions=rt(this,r,"m",ee).call(this,n)})}updateTransactionSendFlowHistory(e,t,n){return rt(this,r,"m",se).call(this,e)}async confirmExternalTransaction(e,t,n){const a=rt(this,r,"m",me).call(this,e);try{const e=a.id,s={...a,status:Nt.TransactionStatus.confirmed,txReceipt:t};n&&(s.baseFeePerGas=n),rt(this,r,"m",pe).call(this,e),this.updateTransaction(s,`${zt}:confirmExternalTransaction - Add external transaction`),rt(this,r,"m",Se).call(this,s),rt(this,r,"m",Ae).call(this,s).catch(e=>{throw(0,vt.projectLogger)("Error while updating post balance",e),e}),this.messenger.publish(`${zt}:transactionConfirmed`,s)}catch(e){console.error("Failed to confirm external transaction",e)}}updateTransactionGasFees(e,{defaultGasEstimates:t,estimateUsed:n,estimateSuggested:a,gas:s,gasLimit:i,gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:l,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:h}){const f=rt(this,r,"m",ae).call(this,e);if(!f)throw new Error("Cannot update transaction as no transaction metadata found");(0,Kt.validateIfTransactionUnapproved)(f,"updateTransactionGasFees");const m=(0,ft.cloneDeep)(f),p=f.gasFeeEstimates,g=rt(this,k,"f").call(this,f),w=h,b=Object.values(Nt.GasFeeEstimateLevel).includes(w),T=p&&g&&b;T&&(0,St.updateTransactionGasEstimates)({txMeta:m,userFeeLevel:w});const E={gas:s,gasLimit:i};T?Object.assign(E,{gasPrice:m.txParams.gasPrice,maxPriorityFeePerGas:m.txParams.maxPriorityFeePerGas,maxFeePerGas:m.txParams.maxFeePerGas}):Object.assign(E,{gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:l});const y={txParams:(0,ft.pickBy)(E),defaultGasEstimates:t,estimateUsed:n,estimateSuggested:a,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:w},S=(0,ft.pickBy)(y);return rt(this,r,"m",De).call(this,{transactionId:e,skipResimulateCheck:!0},e=>{const{txParams:t,...n}=S;Object.assign(e,n),t&&Object.assign(e.txParams,t)}),rt(this,r,"m",ae).call(this,e)}updatePreviousGasParams(e,{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:a}){const s=rt(this,r,"m",ae).call(this,e);if(!s)throw new Error("Cannot update transaction as no transaction metadata found");(0,Kt.validateIfTransactionUnapproved)(s,"updatePreviousGasParams");const i={previousGas:{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:a}};i.previousGas=(0,ft.pickBy)(i.previousGas);const o=(0,ft.merge)({},s,i);return this.updateTransaction(o,`${zt}:updatePreviousGasParams - Previous gas values updated`),rt(this,r,"m",ae).call(this,e)}async getNonceLock(e,t){return rt(this,j,"f").getNonceLock(e,t)}async updateEditableParams(e,{containerTypes:t,data:n,from:a,gas:s,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c,to:l,updateType:u,value:d}){const h=rt(this,r,"m",ae).call(this,e);if(!h)throw new Error("Cannot update editable params as no transaction metadata found");(0,Kt.validateIfTransactionUnapproved)(h,"updateEditableParams");const f={txParams:{data:n,from:a,to:l,value:d,gas:s,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c}};f.txParams=(0,ft.pickBy)(f.txParams);const m=(0,ft.merge)({},h,f),{networkClientId:p}=h,g=rt(this,r,"m",de).call(this,{networkClientId:p}),w=new ot.default(g);if(!1!==u){const{type:e}=await(0,$t.determineTransactionType)(m.txParams,w);m.type=e}return t&&(m.containerTypes=t),await(0,Gt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:rt(this,N,"f"),messenger:this.messenger,provider:g,transactionMeta:m}),this.updateTransaction(m,`Update Editable Params for ${e}`),rt(this,r,"m",ae).call(this,e)}setTransactionActive(e,t){if(!rt(this,r,"m",ae).call(this,e))throw new Error(`Transaction with id ${e} not found`);rt(this,r,"m",De).call(this,{transactionId:e,skipValidation:!0,skipResimulateCheck:!0},e=>{e.isActive=t})}async approveTransactionsWithSameNonce(e=[],{hasNonce:t}={}){if((0,vt.projectLogger)("Approving transactions with same nonce",{transactions:e}),0===e.length)return"";const n=e[0],{chainId:a}=n,s=rt(this,r,"m",le).call(this,{chainId:a}),i=(0,Ht.prepareTransaction)(a,n),c=(0,Ht.serializeTransaction)(i);if(rt(this,o,"f").has(c))return"";let l,u;rt(this,o,"f").add(c);try{const a=n.from;u=!0!==t?await this.getNonceLock(a,s):undefined;const i=u?(0,dt.add0x)(u.nextNonce.toString(16)):n.nonce;u&&(0,vt.projectLogger)("Using nonce from nonce tracker",i,u.nonceDetails),l=await Promise.all(e.map(e=>(e.nonce=i,rt(this,r,"m",$).call(this,e.chainId,e))))}catch(e){throw(0,vt.projectLogger)("Error while signing transactions with same nonce",e),e}finally{u?.releaseLock(),rt(this,o,"f").delete(c)}return l}updateCustodialTransaction(e){const{transactionId:t,errorMessage:n,hash:a,status:s,gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:l,nonce:u,type:d}=e,h=rt(this,r,"m",ae).call(this,t);if(!h)throw new Error("Cannot update custodial transaction as no transaction metadata found");if(s&&![Nt.TransactionStatus.submitted,Nt.TransactionStatus.signed,Nt.TransactionStatus.failed].includes(s))throw new Error(`Cannot update custodial transaction with status: ${s}`);const f=(0,ft.merge)({},h,(0,ft.pickBy)({hash:a,status:s}));return f.status===Nt.TransactionStatus.submitted&&(f.submittedTime=(new Date).getTime()),f.status===Nt.TransactionStatus.failed&&(f.error=(0,Kt.normalizeTxError)(new Error(n))),f.txParams=(0,ft.merge)({},f.txParams,(0,ft.pickBy)({gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:l,nonce:u,type:d})),d===Nt.TransactionEnvelopeType.legacy&&(delete f.txParams.maxFeePerGas,delete f.txParams.maxPriorityFeePerGas),this.updateTransaction(f,`${zt}:updateCustodialTransaction - Custodial transaction updated`),s&&[Nt.TransactionStatus.submitted,Nt.TransactionStatus.failed].includes(s)&&(this.messenger.publish(`${zt}:transactionFinished`,f),rt(this,I,"f").emit(`${f.id}:finished`,f)),f}getTransactions({initialList:e,limit:t,searchCriteria:n={}}={}){const r=(0,ft.mapValues)(n,e=>"function"==typeof e?e:t=>t===e),a=e??this.state.transactions,s=(0,ft.sortBy)((0,ft.pickBy)(a,e=>{for(const[t,n]of Object.entries(r))if(t in e.txParams){if(!1===n(e.txParams[t]))return!1}else if(!1===n(e[t]))return!1;return!0}),"time");if(t!==undefined){const e=new Set,n=[];for(let r=s.length-1;r>-1;r--){const a=s[r],{nonce:i}=a.txParams;if(!e.has(i)){if(!(e.size<t))continue;e.add(i)}n.unshift(a)}return n}return s}async estimateGasFee({transactionParams:e,chainId:t,networkClientId:n}){const{id:r,provider:a}=rt(this,j,"f").getNetworkClient({chainId:t,networkClientId:n}),s={txParams:e,chainId:t,networkClientId:r},i=(0,Bt.getGasFeeFlow)(s,rt(this,d,"f"),this.messenger),o=new ot.default(a),c=await rt(this,g,"f").call(this,{networkClientId:r});return i.getGasFees({ethQuery:o,gasFeeControllerData:c,messenger:this.messenger,transactionMeta:s})}async getLayer1GasFee({transactionParams:e,chainId:t,networkClientId:n}){const a=rt(this,r,"m",de).call(this,{chainId:t,networkClientId:n});return await(0,Gt.getTransactionLayer1GasFee)({layer1GasFeeFlows:rt(this,N,"f"),messenger:this.messenger,provider:a,transactionMeta:{txParams:e,chainId:t}})}clearUnapprovedTransactions(){const e=this.state.transactions.filter(({status:e})=>e!==Nt.TransactionStatus.unapproved);this.update(t=>{t.transactions=rt(this,r,"m",ee).call(this,e)})}abortTransactionSigning(e){if(!rt(this,r,"m",ae).call(this,e))throw new Error("Cannot abort signing as no transaction metadata found");const t=rt(this,B,"f").get(e);if(!t)throw new Error("Cannot abort signing as transaction is not waiting for signing");t(),rt(this,B,"f").delete(e)}async updateAtomicBatchData({transactionId:e,transactionIndex:t,transactionData:n}){(0,vt.projectLogger)("Updating atomic batch data",{transactionId:e,transactionIndex:t,transactionData:n});const a=rt(this,r,"m",De).call(this,{transactionId:e},e=>{const{nestedTransactions:r,txParams:a}=e,s=a.from,i=r?.[t];if(!i)throw new Error(`Nested transaction not found with index - ${t}`);i.data=n;const o=(0,Ot.generateEIP7702BatchTransaction)(s,r);e.txParams.data=o.data}),s=(0,ft.cloneDeep)({...a,txParams:{...a.txParams,gas:undefined}});return await rt(this,r,"m",Ke).call(this,s),rt(this,r,"m",De).call(this,{transactionId:e},e=>{e.txParams.gas=s.txParams.gas,e.simulationFails=s.simulationFails,e.gasLimitNoBuffer=s.gasLimitNoBuffer}),a.txParams.data}updateBatchTransactions({transactionId:e,batchTransactions:t}){(0,vt.projectLogger)("Updating batch transactions",{transactionId:e,batchTransactions:t}),rt(this,r,"m",De).call(this,{transactionId:e},e=>{e.batchTransactions=t})}updateSelectedGasFeeToken(e,t){rt(this,r,"m",De).call(this,{transactionId:e},e=>{const n=e.gasFeeTokens?.some(e=>e.tokenAddress.toLowerCase()===t?.toLowerCase());if(t&&!n)throw new Error(`No matching gas fee token found with address - ${t}`);e.selectedGasFeeToken=t})}updateRequiredTransactionIds({transactionId:e,requiredTransactionIds:t,append:n}){rt(this,r,"m",De).call(this,{transactionId:e},e=>{const{requiredTransactionIds:r}=e;e.requiredTransactionIds=[...r&&!1!==n?r:[],...t]})}emulateNewTransaction(e){const t=this.state.transactions.find(t=>t.id===e);t&&(t.type===Nt.TransactionType.swap?this.messenger.publish("TransactionController:transactionNewSwap",{transactionMeta:t}):t.type===Nt.TransactionType.swapApproval&&this.messenger.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:t}))}emulateTransactionUpdate(e){const t={...e,txParams:{...e.txParams,from:this.messenger.call("AccountsController:getSelectedAccount").address}};this.state.transactions.some(e=>e.id===t.id)||this.update(e=>{e.transactions.push(t)}),this.updateTransaction(t,"Generated from user operation"),this.messenger.publish("TransactionController:transactionStatusUpdated",{transactionMeta:t})}}n.TransactionController=Jt,a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,w=new WeakMap,b=new WeakMap,T=new WeakMap,E=new WeakMap,y=new WeakMap,S=new WeakMap,I=new WeakMap,k=new WeakMap,A=new WeakMap,C=new WeakMap,_=new WeakMap,P=new WeakMap,v=new WeakMap,N=new WeakMap,R=new WeakMap,j=new WeakMap,O=new WeakMap,x=new WeakMap,L=new WeakMap,M=new WeakMap,F=new WeakMap,D=new WeakMap,B=new WeakMap,G=new WeakMap,U=new WeakMap,H=new WeakMap,q=new WeakMap,Pe=new WeakMap,r=new WeakSet,W=async function({actionId:e,afterSubmit:t,estimatedBaseFee:n,gasValues:a,label:s,prepareTransactionParams:i,rate:o,transactionId:c,transactionType:l}){if(rt(this,r,"m",we).call(this,e))return;a&&(a=(0,Kt.normalizeGasFeeValues)(a),(0,Kt.validateGasValues)(a)),(0,vt.projectLogger)(`Creating ${s} transaction`,c,a);const u=rt(this,r,"m",ae).call(this,c);if(!u)return;if(!rt(this,D,"f"))throw new Error("No sign method defined.");const d=(0,qt.getTransactionParamsWithIncreasedGasFee)(u.txParams,o,a);i?.(d);const h=(0,Ht.prepareTransaction)(u.chainId,d),f=await rt(this,D,"f").call(this,h,u.txParams.from),m=rt(this,r,"m",Te).call(this,u,f),p=(0,Ht.serializeTransaction)(f),g=d.maxFeePerGas??d.gasPrice,w=d.maxFeePerGas?m.txParams.maxFeePerGas:m.txParams.gasPrice;(0,vt.projectLogger)(`Submitting ${s} transaction`,{oldFee:w,newFee:g,txParams:d});const{networkClientId:b}=u,T=rt(this,r,"m",ue).call(this,{networkClientId:b}),E={...m,actionId:e,estimatedBaseFee:n,id:(0,mt.v1)(),originalGasEstimate:u.txParams.gas,originalType:u.type,rawTx:p,time:Date.now(),txParams:d,type:l},y=await rt(this,r,"m",xe).call(this,T,{...E,origin:s});E.hash=y,rt(this,r,"m",K).call(this,E),this.messenger.publish(`${zt}:transactionApproved`,{transactionMeta:E,actionId:e}),this.messenger.publish(`${zt}:transactionSubmitted`,{transactionMeta:E,actionId:e}),t?.(E)},$=async function(e,t){if(!rt(this,D,"f"))throw new Error("No sign method defined.");const n=(0,Kt.normalizeTransactionParams)(t),r=(0,Kt.isEIP1559Transaction)(n)?Nt.TransactionEnvelopeType.feeMarket:Nt.TransactionEnvelopeType.legacy,a={...n,type:r,gasLimit:n.gas,chainId:e},{from:s}=a,i=(0,Ht.prepareTransaction)(e,a),o=await rt(this,D,"f").call(this,i,s);return(0,Ht.serializeTransaction)(o)},K=function(e){(0,Vt.validateTxParams)(e.txParams),this.update(t=>{t.transactions=rt(this,r,"m",ee).call(this,[...t.transactions,e])})},V=async function(e,{traceContext:t}={}){const n=e.txParams.type!==Nt.TransactionEnvelopeType.legacy&&await rt(this,r,"m",Ee).call(this,e.networkClientId),{networkClientId:a}=e,s=rt(this,r,"m",ue).call(this,{networkClientId:a}),i=rt(this,r,"m",de).call(this,{networkClientId:a});await rt(this,H,"f").call(this,{name:"Update Gas",parentContext:t},async()=>{await rt(this,r,"m",Ke).call(this,e)}),await rt(this,H,"f").call(this,{name:"Update Gas Fees",parentContext:t},async()=>await(0,Dt.updateGasFees)({eip1559:n,ethQuery:s,gasFeeFlows:rt(this,d,"f"),getGasFeeEstimates:rt(this,g,"f"),getSavedGasFees:rt(this,T,"f").bind(this),messenger:this.messenger,txMeta:e})),await rt(this,H,"f").call(this,{name:"Update Layer 1 Gas Fees",parentContext:t},async()=>await(0,Gt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:rt(this,N,"f"),messenger:this.messenger,provider:i,transactionMeta:e}))},Y=function(){this.clearUnapprovedTransactions(),rt(this,r,"m",z).call(this)},z=function(){const e=this.state.transactions.filter(e=>[Nt.TransactionStatus.approved,Nt.TransactionStatus.signed].includes(e.status));for(const t of e){rt(this,r,"m",Je).call(this,t,new Error("Transaction incomplete at startup"));const e=t.requiredTransactionIds??[];for(const t of e){const e=rt(this,r,"m",ae).call(this,t);e&&!rt(this,r,"m",te).call(this,e.status)&&rt(this,r,"m",Je).call(this,e,new Error("Parent transaction incomplete at startup"))}}},Q=async function(e,{actionId:t,isExisting:n=!1,publishHook:a,requireApproval:s,shouldShowRequest:i=!0,traceContext:o}){const{id:c,isStateOnly:l}=e;if(l)return rt(this,r,"m",De).call(this,{transactionId:c,skipValidation:!0},e=>{e.status=Nt.TransactionStatus.submitted,e.submittedTime=(new Date).getTime()}),"";let u;const{meta:d,isCompleted:h}=rt(this,r,"m",oe).call(this,c),f=h?Promise.resolve(d):rt(this,r,"m",be).call(this,c);if(d&&!n&&!h)try{if(!1!==s){const t=await rt(this,H,"f").call(this,{name:"Await Approval",parentContext:o},t=>rt(this,r,"m",re).call(this,e,{shouldShowRequest:i,traceContext:t}));u=t.resultCallbacks;const n=t.value,a=n?.txMeta;a&&((0,vt.projectLogger)("Updating transaction with approval data",{customNonce:a.customNonceValue,params:a.txParams}),this.updateTransaction(a,"TransactionController#processApproval - Updated with approval data"))}const{isCompleted:n}=rt(this,r,"m",oe).call(this,c);if(!n){const e=await rt(this,r,"m",J).call(this,c,o,a);e===Qt.SkippedViaBeforePublishHook&&u&&u.success();const n=rt(this,r,"m",ae).call(this,c);e===Qt.Approved&&this.messenger.publish(`${zt}:transactionApproved`,{transactionMeta:n,actionId:t})}}catch(e){const n=e,{isCompleted:a}=rt(this,r,"m",oe).call(this,c);a||(rt(this,r,"m",ze).call(this,n)?rt(this,r,"m",Qe).call(this,c,t,n):rt(this,r,"m",Je).call(this,d,n,t))}finally{rt(this,G,"f").delete(c)}const m=await f;switch(m?.status){case Nt.TransactionStatus.failed:{const e=m.error;throw u?.error(e),ut.rpcErrors.internal(e.message)}case Nt.TransactionStatus.submitted:return u?.success(),m.hash;default:{const e=ut.rpcErrors.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(m??c)}`);throw u?.error(e),e}}},J=async function(e,t,n){let a,s,i=rt(this,r,"m",se).call(this,e);(0,vt.projectLogger)("Approving transaction",i);try{if(!rt(this,D,"f"))return rt(this,r,"m",Je).call(this,i,new Error("No sign method defined.")),Qt.NotApproved;if(!i.chainId)return rt(this,r,"m",Je).call(this,i,new Error("No chainId defined.")),Qt.NotApproved;if(rt(this,o,"f").has(e))return(0,vt.projectLogger)("Skipping approval as signing in progress",e),Qt.NotApproved;rt(this,o,"f").add(e),a=()=>rt(this,o,"f").delete(e);const{networkClientId:c}=i,u=rt(this,r,"m",ue).call(this,{networkClientId:c}),[d,h]=await(0,Ut.getNextNonce)(i,e=>rt(this,j,"f").getNonceLock(e,i.networkClientId));s=h,i=rt(this,r,"m",De).call(this,{transactionId:e},e=>{const{chainId:t,txParams:n}=e,{gas:r,type:a}=n;e.status=Nt.TransactionStatus.approved,e.txParams.chainId=t,e.txParams.gasLimit=r,e.txParams.nonce=d,!a&&(0,Kt.isEIP1559Transaction)(n)&&(e.txParams.type=Nt.TransactionEnvelopeType.feeMarket)}),rt(this,r,"m",Se).call(this,i);const f=await rt(this,H,"f").call(this,{name:"Sign",parentContext:t},()=>rt(this,r,"m",ye).call(this,i));if(i=rt(this,r,"m",se).call(this,e),!await rt(this,l,"f").call(this,i))return(0,vt.projectLogger)("Skipping publishing transaction based on hook"),this.messenger.publish(`${zt}:transactionPublishingSkipped`,i),Qt.SkippedViaBeforePublishHook;if(!f&&!i.isExternalSign)return Qt.NotApproved;let m;const p=i.type===Nt.TransactionType.swap;p&&((0,vt.projectLogger)("Determining pre-transaction balance"),m=await(0,it.query)(u,"getBalance",[i.txParams.from])),(0,vt.projectLogger)("Publishing transaction",i.txParams),s?.(),s=undefined;let g=rt(this,r,"m",Ze).bind(this,{ethQuery:u,publishHookOverride:n,traceContext:t});if(i.batchTransactions?.length){(0,vt.projectLogger)("Found batch transactions",i.batchTransactions);g=new Pt.ExtraTransactionsPublishHook({addTransactionBatch:this.addTransactionBatch.bind(this),getTransaction:rt(this,r,"m",se).bind(this),originalPublishHook:g}).getHook()}const{transactionHash:w}=await g(i,f??"0x");return i=rt(this,r,"m",De).call(this,{transactionId:e},e=>{e.hash=w,e.status=Nt.TransactionStatus.submitted,e.submittedTime=(new Date).getTime(),p&&(e.preTxBalance=m,(0,vt.projectLogger)("Updated pre-transaction balance",m))}),this.messenger.publish(`${zt}:transactionSubmitted`,{transactionMeta:i}),this.messenger.publish(`${zt}:transactionFinished`,i),rt(this,I,"f").emit(`${e}:finished`,i),rt(this,r,"m",Se).call(this,i),Qt.Approved}catch(e){return rt(this,r,"m",Je).call(this,i,e),Qt.NotApproved}finally{a?.(),s?.()}},X=async function(e,t,{skipSubmitHistory:n}={}){try{const a=await(0,it.query)(e,"sendRawTransaction",[t.rawTx]);return!0!==n&&rt(this,r,"m",$e).call(this,t,a),a}catch(e){const t=e,n=t?.data?.message??t?.message??String(e);throw new Error(n)}},Z=function(e,t,n){const a=rt(this,r,"m",ae).call(this,e);if(!a)return;rt(this,r,"m",Ye).call(this,e);const s={...a,status:Nt.TransactionStatus.rejected,error:(0,Kt.normalizeTxError)(n??ut.providerErrors.userRejectedRequest())};this.messenger.publish(`${zt}:transactionFinished`,s),rt(this,I,"f").emit(`${a.id}:finished`,s),this.messenger.publish(`${zt}:transactionRejected`,{transactionMeta:s,actionId:t}),rt(this,r,"m",Se).call(this,s)},ee=function(e){const t=new Set,n=[...e].sort((e,t)=>e.time>t.time?-1:1).filter(e=>{const{chainId:n,status:a,txParams:s,time:i}=e;if(s){const e=`${String(s.nonce)}-${(0,it.convertHexToDecimal)(n)}-${new Date(i).toDateString()}`;if(t.has(e))return!0;if(t.size<rt(this,q,"f")||!rt(this,r,"m",te).call(this,a))return t.add(e),!0}return!1});return n.reverse(),n},te=function(e){return e===Nt.TransactionStatus.rejected||e===Nt.TransactionStatus.confirmed||e===Nt.TransactionStatus.failed||e===Nt.TransactionStatus.dropped},ne=function(e){return[Nt.TransactionStatus.confirmed,Nt.TransactionStatus.failed,Nt.TransactionStatus.rejected,Nt.TransactionStatus.submitted].includes(e)},re=async function(e,{shouldShowRequest:t,traceContext:n}){const a=rt(this,r,"m",ie).call(this,e),{origin:s}=e,i=it.ApprovalType.Transaction,o={txId:e.id};return await rt(this,H,"f").call(this,{name:"Notification Display",id:a,parentContext:n}),await this.messenger.call("ApprovalController:addRequest",{id:a,origin:s??it.ORIGIN_METAMASK,type:i,requestData:o,expectsResult:!0},t)},ae=function(e){const{transactions:t}=this.state;return t.find(({id:t})=>t===e)},se=function(e,t="TransactionController"){const n=rt(this,r,"m",ae).call(this,e);if(!n)throw new Error(`${t}: No transaction found with id ${e}`);return n},ie=function(e){return String(e.id)},oe=function(e){const t=rt(this,r,"m",ae).call(this,e);if(!t)return{meta:undefined,isCompleted:!1};return{meta:t,isCompleted:rt(this,r,"m",ne).call(this,t.status)}},ce=function(e){return rt(this,j,"f").getNetworkClient({networkClientId:e}).configuration.chainId},le=function({chainId:e,networkClientId:t}){return t||rt(this,j,"f").getNetworkClient({chainId:e}).id},ue=function({chainId:e,networkClientId:t}){return new ot.default(rt(this,r,"m",de).call(this,{chainId:e,networkClientId:t}))},de=function({chainId:e,networkClientId:t}){return rt(this,j,"f").getNetworkClient({chainId:e,networkClientId:t}).provider},he=function(e){if(!e.length)return;const t=[];for(const n of e){const{chainId:e}=n;try{const a=rt(this,r,"m",le).call(this,{chainId:e});t.push({...n,networkClientId:a})}catch(t){(0,vt.projectLogger)("Failed to get network client ID for incoming transaction",{chainId:e,error:t})}}this.update(e=>{const{transactions:n}=e;e.transactions=rt(this,r,"m",ee).call(this,[...t,...n]),(0,vt.projectLogger)("Added incoming transactions to state",t.length,t)}),this.messenger.publish(`${zt}:incomingTransactionsReceived`,t)},fe=function(e,t){if(!t||t===it.ORIGIN_METAMASK)return undefined;const{gasPrice:n,maxFeePerGas:r,maxPriorityFeePerGas:a,gas:s}=e;if(n===undefined&&r===undefined&&a===undefined&&s===undefined)return undefined;const i={};return n!==undefined?i.gasPrice=n:r===undefined&&a===undefined||(i.maxFeePerGas=r,i.maxPriorityFeePerGas=a),s!==undefined&&(i.gas=s),i},me=function(e){const{chainId:t}=e,{transactions:n}=this.state,a=e?.txParams?.from,s=n.filter(e=>e.txParams.from===a&&e.chainId===t),i=s.filter(e=>e.status===Nt.TransactionStatus.confirmed),o=s.filter(e=>e.status===Nt.TransactionStatus.submitted);return(0,xt.validateConfirmedExternalTransaction)(e,i,o),this.update(t=>{t.transactions=rt(this,r,"m",ee).call(this,[...t.transactions,e])}),e},pe=function(e){const t=rt(this,r,"m",ae).call(this,e);if(!t)return;const n=t.txParams?.nonce,a=t.txParams?.from,{chainId:s}=t,i=this.state.transactions.filter(t=>t.id!==e&&t.txParams.from===a&&n&&t.txParams.nonce===n&&t.chainId===s&&t.type!==Nt.TransactionType.incoming&&t.isTransfer===undefined),o=i.map(e=>e.id);if(0!==i.length){this.update(e=>{for(const n of e.transactions)o.includes(n.id)&&(n.replacedBy=t?.hash,n.replacedById=t?.id)});for(const e of this.state.transactions)o.includes(e.id)&&e.status!==Nt.TransactionStatus.failed&&rt(this,r,"m",ge).call(this,e)}},ge=function(e){const t={...e,status:Nt.TransactionStatus.dropped};this.messenger.publish(`${zt}:transactionDropped`,{transactionMeta:t}),this.updateTransaction(t,"TransactionController#setTransactionStatusDropped - Transaction dropped"),rt(this,r,"m",Se).call(this,t)},we=function(e){return this.state.transactions.find(t=>e&&t.actionId===e)},be=async function(e){return new Promise(t=>{rt(this,I,"f").once(`${e}:finished`,e=>{t(e)})})},Te=function(e,t){const n=(0,ft.cloneDeep)(e);for(const e of["r","s","v"]){const r=t[e];r!==undefined&&null!==r&&(n[e]=(0,dt.add0x)(r.toString(16)))}return n},Ee=async function(e){const t=await rt(this,m,"f").call(this,e),n=await rt(this,f,"f").call(this);return t&&n},ye=async function(e){let t=e;const{id:n}=t;(0,vt.projectLogger)("Calling before sign hook",t);const{updateTransaction:a}=await rt(this,u,"f").call(this,{transactionMeta:t})??{};a&&(rt(this,r,"m",De).call(this,{transactionId:n,skipResimulateCheck:!0},a),(0,vt.projectLogger)("Updated transaction after before sign hook")),t=rt(this,r,"m",se).call(this,n);const{networkClientId:i}=t,c=rt(this,r,"m",ue).call(this,{networkClientId:i});await(0,Ft.checkGasFeeTokenBeforePublish)({ethQuery:c,fetchGasFeeTokens:async e=>(await rt(this,r,"m",et).call(this,e)).gasFeeTokens,transaction:t,updateTransaction:(e,t)=>rt(this,r,"m",De).call(this,{transactionId:e},t)}),t=rt(this,r,"m",se).call(this,n);const{chainId:l,isExternalSign:d,txParams:f}=t;if(d)return(0,vt.projectLogger)("Skipping sign as signed externally"),undefined;const{authorizationList:m,from:p}=f,g=await(0,Ot.signAuthorizationList)({authorizationList:m,messenger:this.messenger,transactionMeta:t});g&&rt(this,r,"m",De).call(this,{transactionId:n},e=>{e.txParams.authorizationList=g}),t=rt(this,r,"m",se).call(this,n);const w=rt(this,r,"m",se).call(this,n),{txParams:b}=w,T=(0,Ht.prepareTransaction)(l,b);rt(this,o,"f").add(n),(0,vt.projectLogger)("Signing transaction",b);const E=await new Promise((e,t)=>{rt(this,D,"f")?.call(this,T,p,...rt(this,h,"f").call(this,w)).then(e,t),rt(this,B,"f").set(n,()=>t(new Error("Signing aborted by user")))});if(rt(this,B,"f").delete(n),!E)return(0,vt.projectLogger)("Skipping signed status as no signed transaction"),undefined;const y=(0,ft.cloneDeep)(w);if(!rt(this,s,"f").call(this,y,E))return this.updateTransaction(y,"TransactionController#signTransaction - Update after sign"),(0,vt.projectLogger)("Skipping signed status based on hook"),undefined;const S={...rt(this,r,"m",Te).call(this,y,E),status:Nt.TransactionStatus.signed,txParams:b};this.updateTransaction(S,"TransactionController#approveTransaction - Transaction signed"),rt(this,r,"m",Se).call(this,S);const I=(0,Ht.serializeTransaction)(E),k=(0,ft.merge)({},S,{rawTx:I});return this.updateTransaction(k,"TransactionController#approveTransaction - RawTransaction added"),I},Se=function(e){this.messenger.publish(`${zt}:transactionStatusUpdated`,{transactionMeta:e})},Ie=function(e,t,n){return(0,Ut.getAndFormatTransactionsForNonceTracker)(n,t,e,this.state.transactions)},ke=function(e){(0,vt.projectLogger)("Processing confirmed transaction",e.id),rt(this,r,"m",pe).call(this,e.id),this.messenger.publish(`${zt}:transactionConfirmed`,e),rt(this,r,"m",Se).call(this,e),rt(this,r,"m",Ae).call(this,e).catch(e=>{throw(0,vt.projectLogger)("Error while updating post balance",e),e})},Ae=async function(e){try{const{networkClientId:t,type:n}=e;if(n!==Nt.TransactionType.swap)return;const a=rt(this,r,"m",ue).call(this,{networkClientId:t}),{updatedTransactionMeta:s,approvalTransactionMeta:i}=await(0,Wt.updatePostTransactionBalance)(e,{ethQuery:a,getTransaction:rt(this,r,"m",ae).bind(this),updateTransaction:this.updateTransaction.bind(this)});this.messenger.publish(`${zt}:postTransactionBalanceUpdated`,{transactionMeta:s,approvalTransactionMeta:i})}catch(e){(0,vt.projectLogger)("Error while updating post transaction balance",e)}},Ce=function({provider:e,blockTracker:t,chainId:n}){return new lt.NonceTracker({provider:e,blockTracker:t,getPendingTransactions:rt(this,r,"m",Oe).bind(this,n),getConfirmedTransactions:rt(this,r,"m",Ie).bind(this,[Nt.TransactionStatus.confirmed],n)})},_e=function({provider:e,blockTracker:t,chainId:n,networkClientId:a}){const s=new ot.default(e),i=new Ct.PendingTransactionTracker({blockTracker:t,getChainId:()=>n,getEthQuery:()=>s,getGlobalLock:()=>rt(this,j,"f").acquireNonceLockForChainIdKey({chainId:n}),getNetworkClientId:()=>a,getTransactions:()=>this.state.transactions,hooks:{beforeCheckPendingTransaction:rt(this,c,"f").bind(this)},isResubmitEnabled:rt(this,O,"f").isResubmitEnabled,isTimeoutEnabled:rt(this,v,"f"),messenger:this.messenger,publishTransaction:(e,t)=>rt(this,r,"m",X).call(this,e,t,{skipSubmitHistory:!0})});return rt(this,r,"m",je).call(this,i),i},ve=function(){rt(this,j,"f").stopAllTracking()},Ne=function(e){e.hub.on("transactions",rt(this,r,"m",he).bind(this))},Re=function(e){e.hub.removeAllListeners("transaction-confirmed"),e.hub.removeAllListeners("transaction-dropped"),e.hub.removeAllListeners("transaction-failed"),e.hub.removeAllListeners("transaction-updated")},je=function(e){e.hub.on("transaction-confirmed",rt(this,r,"m",ke).bind(this)),e.hub.on("transaction-dropped",rt(this,r,"m",ge).bind(this)),e.hub.on("transaction-failed",rt(this,r,"m",Je).bind(this)),e.hub.on("transaction-updated",this.updateTransaction.bind(this))},Oe=function(e,t){return[...rt(this,r,"m",Ie).call(this,[Nt.TransactionStatus.approved,Nt.TransactionStatus.signed,Nt.TransactionStatus.submitted],t,e),...rt(this,p,"f").call(this,t,e)]},xe=async function(e,t){try{return await rt(this,r,"m",X).call(this,e,t)}catch(e){if(rt(this,r,"m",Le).call(this,e))throw new Error("Previous transaction is already confirmed");throw e}},Le=function(e){return Boolean(e?.message?.includes("nonce too low"))||Boolean(e?.data?.message?.includes("nonce too low"))},Me=function(){return rt(this,U,"f")?[new Et.TestGasFeeFlow]:[new bt.RandomisedEstimationsGasFeeFlow,new gt.LineaGasFeeFlow,new pt.DefaultGasFeeFlow]},Fe=function(){return[new wt.OptimismLayer1GasFeeFlow,new Tt.ScrollLayer1GasFeeFlow]},De=function({transactionId:e,skipValidation:t,skipResimulateCheck:n},a){let s;this.update(r=>{const i=r.transactions.findIndex(({id:t})=>t===e);if(-1===i)throw new Error(`Cannot update transaction as ID not found - ${e}`);let o=r.transactions[i];const c=(0,ft.cloneDeep)(o);o=a(o)??o,!0!==t&&(o.txParams=(0,Kt.normalizeTransactionParams)(o.txParams),(0,Vt.validateTxParams)(o.txParams)),!n&&rt(this,_,"f").call(this)&&(s=(0,_t.shouldResimulate)(c,o)),r.transactions[i]=o});const i=rt(this,r,"m",ae).call(this,e);return s?.resimulate&&rt(this,r,"m",Be).call(this,i,{blockTime:s.blockTime}).catch(e=>{throw(0,vt.projectLogger)("Error during re-simulation",e),e}),i},Be=async function(e,{blockTime:t,traceContext:n}={}){const{chainId:a,id:s,nestedTransactions:i,networkClientId:o,simulationData:c,txParams:l}=e;let u,d={error:{code:Nt.SimulationErrorCode.Disabled,message:"Simulation disabled"},tokenBalanceChanges:[]},h=[],f=!1;const m=rt(this,G,"f").has(s);if(rt(this,_,"f").call(this)&&!m){const s=await rt(this,H,"f").call(this,{name:"Simulate",parentContext:n},()=>(0,Rt.getBalanceChanges)({blockTime:t,chainId:a,ethQuery:rt(this,r,"m",ue).call(this,{networkClientId:o}),getSimulationConfig:(t,n)=>rt(this,E,"f").call(this,t,{txMeta:e,...n}),nestedTransactions:i,txParams:l}));d=s.simulationData,u=s.gasUsed,t&&c&&(0,_t.hasSimulationDataChanged)(c,d)&&(d={...d,isUpdatedAfterSecurityCheck:!0});const m=await rt(this,r,"m",et).call(this,e);h=m?.gasFeeTokens??[],f=m?.isGasFeeSponsored??!1}if(!rt(this,r,"m",ae).call(this,s))return void(0,vt.projectLogger)("Cannot update simulation data as transaction not found",s,d);const p=rt(this,r,"m",De).call(this,{transactionId:s,skipResimulateCheck:Boolean(t)},e=>{e.gasFeeTokens=h,e.isGasFeeSponsored=f,e.gasUsed=u,m||(e.simulationData=d)});(0,vt.projectLogger)("Updated simulation data",s,p),await rt(this,r,"m",Xe).call(this,p)},Ge=function({transactionId:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,layer1GasFee:a}){rt(this,r,"m",De).call(this,{transactionId:e},e=>{(0,St.updateTransactionGasProperties)({txMeta:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,isTxParamsGasFeeUpdatesEnabled:rt(this,k,"f"),layer1GasFee:a})})},Ue=function({transactionBatchId:e,gasFeeEstimates:t}){rt(this,r,"m",He).call(this,e,e=>({...e,gasFeeEstimates:t}))},He=function(e,t){this.update(n=>{const r=n.transactionBatches.findIndex(t=>t.id===e);if(-1===r)throw new Error(`Cannot update batch, ID not found - ${e}`);const a=n.transactionBatches[r],s=t(a);n.transactionBatches[r]=s??a})},qe=function(){return this.messenger.call("AccountsController:getSelectedAccount")},We=function(){const e=this.messenger.call("AccountsController:getState");return Object.values(e.internalAccounts?.accounts??{}).filter(e=>"eip155:eoa"===e.type).map(e=>e.address)},$e=function(e,t){const{chainId:n,networkClientId:r,origin:a,rawTx:s,txParams:i}=e,{networkConfigurationsByChainId:o}=rt(this,w,"f").call(this),c=o[n],l=c?.rpcEndpoints.find(e=>e.networkClientId===r),u=l?.url,d={chainId:n,hash:t,networkType:l?.name??r,networkUrl:u,origin:a,rawTransaction:s,time:Date.now(),transaction:i};(0,vt.projectLogger)("Updating submit history",d),this.update(e=>{const{submitHistory:t}=e;100===t.length&&t.pop(),t.unshift(d)})},Ke=async function(e){const{chainId:t,networkClientId:n}=e,a=rt(this,j,"f").getNetworkClient({networkClientId:n}).configuration.type===ct.NetworkClientType.Custom,s=rt(this,r,"m",ue).call(this,{networkClientId:n});await(0,Mt.updateGas)({chainId:t,ethQuery:s,isCustomNetwork:a,isSimulationEnabled:rt(this,_,"f").call(this),getSimulationConfig:rt(this,E,"f"),messenger:this.messenger,txMeta:e})},Ve=function(){this.messenger.registerActionHandler(`${zt}:addTransaction`,this.addTransaction.bind(this)),this.messenger.registerActionHandler(`${zt}:addTransactionBatch`,this.addTransactionBatch.bind(this)),this.messenger.registerActionHandler(`${zt}:confirmExternalTransaction`,this.confirmExternalTransaction.bind(this)),this.messenger.registerActionHandler(`${zt}:emulateNewTransaction`,this.emulateNewTransaction.bind(this)),this.messenger.registerActionHandler(`${zt}:emulateTransactionUpdate`,this.emulateTransactionUpdate.bind(this)),this.messenger.registerActionHandler(`${zt}:estimateGas`,this.estimateGas.bind(this)),this.messenger.registerActionHandler(`${zt}:estimateGasBatch`,this.estimateGasBatch.bind(this)),this.messenger.registerActionHandler(`${zt}:getGasFeeTokens`,rt(this,r,"m",tt).bind(this)),this.messenger.registerActionHandler(`${zt}:getNonceLock`,this.getNonceLock.bind(this)),this.messenger.registerActionHandler(`${zt}:getTransactions`,this.getTransactions.bind(this)),this.messenger.registerActionHandler(`${zt}:updateCustodialTransaction`,this.updateCustodialTransaction.bind(this)),this.messenger.registerActionHandler(`${zt}:updateTransaction`,this.updateTransaction.bind(this))},Ye=function(e){this.update(t=>{const n=t.transactions.filter(({id:t})=>t!==e);t.transactions=rt(this,r,"m",ee).call(this,n)})},ze=function(e){return[ut.errorCodes.provider.userRejectedRequest,Vt.ErrorCode.RejectedUpgrade].includes(e.code)},Qe=function(e,t,n){if(rt(this,r,"m",Z).call(this,e,t,n),n.code===ut.errorCodes.provider.userRejectedRequest)throw ut.providerErrors.userRejectedRequest({message:"MetaMask Tx Signature: User denied transaction signature.",data:n?.data});throw n},Je=function(e,t,n){let a;try{a=rt(this,r,"m",De).call(this,{transactionId:e.id,skipValidation:!0},e=>{e.status=Nt.TransactionStatus.failed,e.error=(0,Kt.normalizeTxError)(t)})}catch(n){(0,vt.projectLogger)("Failed to mark transaction as failed",n),a={...e,status:Nt.TransactionStatus.failed,error:(0,Kt.normalizeTxError)(t)}}this.messenger.publish(`${zt}:transactionFailed`,{actionId:n,error:t.message,transactionMeta:a}),rt(this,r,"m",Se).call(this,a),this.messenger.publish(`${zt}:transactionFinished`,a),rt(this,I,"f").emit(`${e.id}:finished`,a)},Xe=async function(e){(0,vt.projectLogger)("Calling afterSimulate hook",e);const{id:t}=e,n=await rt(this,i,"f").call(this,{transactionMeta:e}),{skipSimulation:a,updateTransaction:s}=n??{};if(a?rt(this,G,"f").add(t):!1===a&&rt(this,G,"f").delete(t),!s)return;const o=rt(this,r,"m",De).call(this,{transactionId:t,skipResimulateCheck:!0},e=>{e.txParamsOriginal=(0,ft.cloneDeep)(e.txParams),s(e)});(0,vt.projectLogger)("Updated transaction with afterSimulate data",o)},Ze=async function({ethQuery:e,publishHookOverride:t,traceContext:n},a,s){let i;return await rt(this,H,"f").call(this,{name:"Publish",parentContext:n},async()=>{const n=t??rt(this,L,"f");({transactionHash:i}=await n(a,s)),i??(i=await rt(this,r,"m",X).call(this,e,{...a,rawTx:s}))}),(0,vt.projectLogger)("Publish successful",i),{transactionHash:i}},et=async function(e){const{chainId:t}=e;return await(0,Ft.getGasFeeTokens)({chainId:t,getSimulationConfig:rt(this,E,"f"),isEIP7702GasFeeTokensEnabled:rt(this,A,"f"),messenger:this.messenger,publicKeyEIP7702:rt(this,x,"f"),transactionMeta:e})},tt=async function(e){const{chainId:t,data:n,from:a,to:s,value:i}=e,o=rt(this,r,"m",ue).call(this,{chainId:t}),c={chainId:t,delegationAddress:await(0,Ot.getDelegationAddress)(a,o),isExternalSign:!0,txParams:{data:n,from:a,to:s,value:i}};return(await rt(this,r,"m",et).call(this,c)).gasFeeTokens}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/TransactionController.cjs"}],[3063,{"../errors.cjs":3066,"../logger.cjs":3086,"@metamask/controller-utils":1488,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountTransactions=n.getAccountAddressRelationship=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/utils"),s=e("../errors.cjs"),i=e("../logger.cjs"),o="https://accounts.api.cx.metamask.io",c=`${o}/v1/accounts/`,l="x-metamask-clientproduct",u="metamask-transaction-controller",d=[1,10,56,137,8453,42161,59144,534352,1329,143],h=(0,a.createModuleLogger)(i.projectLogger,"accounts-api");n.getAccountAddressRelationship=async function(e){const{chainId:t,from:n,to:a}=e;if(!d.includes(t))throw h("Unsupported chain ID for account relationship API",t),new s.FirstTimeInteractionError("Unsupported chain ID");const i=`${o}/v1/networks/${t}/accounts/${n}/relationships/${a}`;h("Getting account address relationship",{request:e,url:i});const c={[l]:u},f=await(0,r.successfulFetch)(i,{headers:c});if(204===f.status)return{count:0};const m=await f.json();if(h("Retrieved account address relationship",m),m.error){const{code:e,message:t}=m.error;throw new s.FirstTimeInteractionError(t,e)}return m},n.getAccountTransactions=async function(e){const{address:t,chainIds:n,cursor:a,endTimestamp:s,sortDirection:i,startTimestamp:o,tags:d}=e;let f=`${c}${t}/transactions`;const m=[];if(n){const e=n.join(",");m.push(`networks=${e}`)}o&&m.push(`startTimestamp=${o}`),s&&m.push(`endTimestamp=${s}`),a&&m.push(`cursor=${a}`),i&&m.push(`sortDirection=${i}`),m.length&&(f+=`?${m.join("&")}`),h("Getting account transactions",{request:e,url:f});const p=[u,...d??[]].join("__"),g={[l]:p},w=await(0,r.successfulFetch)(f,{headers:g}),b=await w.json();return h("Retrieved account transactions",b),b}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/api/accounts-api.cjs"}],[3064,{"../constants.cjs":3065,"../errors.cjs":3066,"../logger.cjs":3086,"@metamask/controller-utils":1488,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateTransactions=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/utils"),s=e("lodash"),i=e("../constants.cjs"),o=e("../errors.cjs"),c=e("../logger.cjs"),l=(0,a.createModuleLogger)(c.projectLogger,"simulation-api"),u="networks";let d=0;function h(e){return"https://tx-sentinel-{0}.api.cx.metamask.io/".replace("{0}",e)}n.simulateTransactions=async function(e,t){let n=await async function(e){const t=await async function(){const e=`${h("ethereum-mainnet")}${u}`,t=await fetch(e);return t.json()}(),n=(0,r.convertHexToDecimal)(e),a=t[n];if(!a?.confirmations)throw l("Chain is not supported",e),new o.SimulationChainNotSupportedError(e);return h(a.network)}(e);const{newUrl:a,authorization:c}=await t.getSimulationConfig(n)||{};a&&(n=a);const f=d;d+=1;const m=function(e){const t=(0,s.cloneDeep)(e);for(const e of t.transactions){const n=e.to?.toLowerCase();i.DELEGATION_MANAGER_ADDRESSES.includes(n)&&(t.overrides=t.overrides??{},t.overrides[n]={code:i.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS})}return t}(t);l("Sending request",n,t);const p={"Content-Type":"application/json"};c&&(p.Authorization=c);const g=await fetch(n,{method:"POST",headers:p,body:JSON.stringify({id:String(f),jsonrpc:"2.0",method:"infura_simulateTransactions",params:[m]})}),w=await g.json();if(l("Received response",w),w.error){const{code:e,message:t}=w.error;throw new o.SimulationError(t,e)}return w?.result}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/api/simulation-api.cjs"}],[3065,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS=n.DELEGATION_MANAGER_ADDRESSES=n.ABI_IERC7821=n.ABI_SIMULATION_ERC721_LEGACY=n.ABI_SIMULATION_ERC20_WRAPPED=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",BASE:"0x2105",BASE_TESTNET:"0x14a33",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0x1a4",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",OPTIMISM_SEPOLIA:"0xaa37dc",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",SEPOLIA:"0xaa36a7",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",LINEA_MAINNET:"0xe708",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",MONAD:"0x8f",GNOSIS:"0x64",ARBITRUM:"0xa4b1",ZKSYNC_ERA:"0x144",ZORA:"0x76adf1",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",MEGAETH_TESTNET:"0x18c6",SEI:"0x531"},n.ABI_SIMULATION_ERC20_WRAPPED=[{anonymous:!1,inputs:[{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Withdrawal",type:"event"}],n.ABI_SIMULATION_ERC721_LEGACY=[{anonymous:!1,inputs:[{indexed:!1,name:"_from",type:"address"},{indexed:!1,name:"_to",type:"address"},{indexed:!1,name:"_tokenId",type:"uint256"}],name:"Transfer",type:"event"}],n.ABI_IERC7821=[{type:"function",name:"execute",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"},{name:"executionData",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"supportsExecutionMode",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"}],n.DELEGATION_MANAGER_ADDRESSES=["0xdb9b1e94b5b69df7e401ddbede43491141047db3"],n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS="0x608060405234801561001057600080fd5b506004361061012c5760003560e01c806383ebb771116100ad578063acb8cc4911610071578063acb8cc491461027f578063cef6d2091461029f578063e30c3978146102b2578063f2fde38b146102c3578063ffa1ad74146102d657600080fd5b806383ebb771146102065780638456cb591461020e57806384b0196e146102165780638da5cb5b14610231578063a3f4df7e1461024257600080fd5b806358909ebc116100f457806358909ebc146101b05780635c975abb146101d157806366134607146101e3578063715018a6146101f657806379ba5097146101fe57600080fd5b80631b13cac2146101315780632d40d0521461014d5780633ed01015146101805780633f4ba83a14610195578063499340471461019d575b600080fd5b61013a60001981565b6040519081526020015b60405180910390f35b61017061015b36600461207e565b60046020526000908152604090205460ff1681565b6040519015158152602001610144565b61019361018e366004612097565b6102fa565b005b6101936103f4565b6101936101ab366004612097565b610406565b6101b9610a1181565b6040516001600160a01b039091168152602001610144565b600154600160a01b900460ff16610170565b61013a6101f1366004612097565b6104f6565b61019361050f565b610193610521565b61013a61056a565b610193610579565b61021e610589565b6040516101449796959493929190612128565b6000546001600160a01b03166101b9565b610272604051806040016040528060118152602001702232b632b3b0ba34b7b726b0b730b3b2b960791b81525081565b60405161014491906121c1565b610272604051806040016040528060018152602001603160f81b81525081565b6101936102ad36600461221f565b6105cf565b6001546001600160a01b03166101b9565b6101936102d13660046122d4565b611829565b610272604051806040016040528060058152602001640312e332e360dc1b81525081565b61030a60408201602083016122d4565b6001600160a01b03811633146103335760405163b9f0f17160e01b815260040160405180910390fd5b600061033e836104f6565b60008181526004602052604090205490915060ff1661037057604051637952fbad60e11b815260040160405180910390fd5b6000818152600460209081526040909120805460ff19169055610395908401846122d4565b6001600160a01b03166103ae60408501602086016122d4565b6001600160a01b0316827f3feadce88fc1b49db633a56fd5307ed6ee18734df83bcc4011daa720c9cd95f1866040516103e7919061241c565b60405180910390a4505050565b6103fc61189a565b6104046118c7565b565b61041660408201602083016122d4565b6001600160a01b038116331461043f5760405163b9f0f17160e01b815260040160405180910390fd5b600061044a836104f6565b60008181526004602052604090205490915060ff161561047c57604051625ecddb60e01b815260040160405180910390fd5b6000818152600460209081526040909120805460ff191660011790556104a4908401846122d4565b6001600160a01b03166104bd60408501602086016122d4565b6001600160a01b0316827fea589ba9473ee1fe77d352c7ed919747715a5d22931b972de9b02a907c66d5dd866040516103e7919061241c565b6000610509610504836127bb565b61191c565b92915050565b61051761189a565b61040460006119b7565b60015433906001600160a01b0316811461055e5760405163118cdaa760e01b81526001600160a01b03821660048201526024015b60405180910390fd5b610567816119b7565b50565b60006105746119d0565b905090565b61058161189a565b610404611afb565b60006060806000806000606061059d611b3e565b6105a5611b6b565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b6105d7611b98565b8481811415806105e75750808414155b1561060557604051631bcaf69f60e01b815260040160405180910390fd5b6000816001600160401b0381111561061f5761061f6124ed565b60405190808252806020026020018201604052801561065257816020015b606081526020019060019003908161063d5790505b5090506000826001600160401b0381111561066f5761066f6124ed565b6040519080825280602002602001820160405280156106a257816020015b606081526020019060019003908161068d5790505b50905060005b83811015610c195760008a8a838181106106c4576106c46127c7565b90506020028101906106d691906127dd565b8101906106e39190612823565b905080516000036107d1576040805160008082526020820190925290610765565b6107526040518060c0016040528060006001600160a01b0316815260200160006001600160a01b03168152602001600080191681526020016060815260200160008152602001606081525090565b8152602001906001900390816107045790505b50848381518110610778576107786127c7565b602090810291909101015260006040519080825280602002602001820160405280156107ae578160200160208202803683370190505b508383815181106107c1576107c16127c7565b6020026020010181905250610c10565b808483815181106107e4576107e46127c7565b6020026020010181905250600081516001600160401b0381111561080a5761080a6124ed565b604051908082528060200260200182016040528015610833578160200160208202803683370190505b50905080848481518110610849576108496127c7565b6020026020010181905250336001600160a01b031682600081518110610871576108716127c7565b6020026020010151600001516001600160a01b0316141580156108c65750610a116001600160a01b0316826000815181106108ae576108ae6127c7565b6020026020010151600001516001600160a01b031614155b156108e457604051632d618d8160e21b815260040160405180910390fd5b60005b8251811015610a4d576000838281518110610904576109046127c7565b602002602001015190506109178161191c565b838381518110610929576109296127c7565b60200260200101818152505080602001516001600160a01b03163b6000036109a657600061099e61099461095b61056a565b86868151811061096d5761096d6127c7565b602002602001015160405161190160f01b8152600281019290925260228201526042902090565b8360a00151611bc3565b905050610a44565b60006109c56109b361056a565b85858151811061096d5761096d6127c7565b9050600082602001516001600160a01b0316631626ba7e838560a001516040518363ffffffff1660e01b81526004016109ff9291906128d3565b602060405180830381865afa158015610a1c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a4091906128f4565b5050505b506001016108e7565b5060005b8251811015610c0d5760046000838381518110610a7057610a706127c7565b60209081029190910181015182528101919091526040016000205460ff1615610aac576040516302dd502960e11b815260040160405180910390fd5b60018351610aba9190612934565b8114610bc35781610acc826001612947565b81518110610adc57610adc6127c7565b6020026020010151838281518110610af657610af66127c7565b60200260200101516040015114610b2057604051636f6a1b8760e11b815260040160405180910390fd5b600083610b2e836001612947565b81518110610b3e57610b3e6127c7565b6020026020010151600001519050610a116001600160a01b0316816001600160a01b031614158015610b9f5750806001600160a01b0316848381518110610b8757610b876127c7565b6020026020010151602001516001600160a01b031614155b15610bbd57604051632d618d8160e21b815260040160405180910390fd5b50610c05565b60001960001b838281518110610bdb57610bdb6127c7565b60200260200101516040015114610c0557604051636f6a1b8760e11b815260040160405180910390fd5b600101610a51565b50505b506001016106a8565b5060005b83811015610e3e576000838281518110610c3957610c396127c7565b6020026020010151511115610e365760005b838281518110610c5d57610c5d6127c7565b602002602001015151811015610e34576000848381518110610c8157610c816127c7565b60200260200101518281518110610c9a57610c9a6127c7565b602002602001015160600151905060005b8151811015610e2a576000828281518110610cc857610cc86127c7565b6020026020010151600001519050806001600160a01b031663414c3e33848481518110610cf757610cf76127c7565b602002602001015160200151858581518110610d1557610d156127c7565b6020026020010151604001518f8f8a818110610d3357610d336127c7565b905060200201358e8e8b818110610d4c57610d4c6127c7565b9050602002810190610d5e91906127dd565b8c8c81518110610d7057610d706127c7565b60200260200101518b81518110610d8957610d896127c7565b60200260200101518e8d81518110610da357610da36127c7565b60200260200101518c81518110610dbc57610dbc6127c7565b602002602001015160200151336040518963ffffffff1660e01b8152600401610dec98979695949392919061295a565b600060405180830381600087803b158015610e0657600080fd5b505af1158015610e1a573d6000803e3d6000fd5b5050505050806001019050610cab565b5050600101610c4b565b505b600101610c1d565b5060005b8381101561146257828181518110610e5c57610e5c6127c7565b602002602001015151600003610f1a573363d691c964898984818110610e8457610e846127c7565b90506020020135888885818110610e9d57610e9d6127c7565b9050602002810190610eaf91906127dd565b6040518463ffffffff1660e01b8152600401610ecd939291906129c5565b6000604051808303816000875af1158015610eec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610f1491908101906129e8565b5061145a565b60005b838281518110610f2f57610f2f6127c7565b602002602001015151811015611106576000848381518110610f5357610f536127c7565b60200260200101518281518110610f6c57610f6c6127c7565b602002602001015160600151905060005b81518110156110fc576000828281518110610f9a57610f9a6127c7565b6020026020010151600001519050806001600160a01b031663a145832a848481518110610fc957610fc96127c7565b602002602001015160200151858581518110610fe757610fe76127c7565b6020026020010151604001518f8f8a818110611005576110056127c7565b905060200201358e8e8b81811061101e5761101e6127c7565b905060200281019061103091906127dd565b8c8c81518110611042576110426127c7565b60200260200101518b8151811061105b5761105b6127c7565b60200260200101518e8d81518110611075576110756127c7565b60200260200101518c8151811061108e5761108e6127c7565b602002602001015160200151336040518963ffffffff1660e01b81526004016110be98979695949392919061295a565b600060405180830381600087803b1580156110d857600080fd5b505af11580156110ec573d6000803e3d6000fd5b5050505050806001019050610f7d565b5050600101610f1d565b50828181518110611119576111196127c7565b60200260200101516001848381518110611135576111356127c7565b6020026020010151516111489190612934565b81518110611158576111586127c7565b6020026020010151602001516001600160a01b031663d691c964898984818110611184576111846127c7565b9050602002013588888581811061119d5761119d6127c7565b90506020028101906111af91906127dd565b6040518463ffffffff1660e01b81526004016111cd939291906129c5565b6000604051808303816000875af11580156111ec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261121491908101906129e8565b506000838281518110611229576112296127c7565b60200260200101515190505b801561145857600084838151811061124f5761124f6127c7565b60200260200101516001836112649190612934565b81518110611274576112746127c7565b60200260200101516060015190506000815190505b80156114455760008261129d600184612934565b815181106112ad576112ad6127c7565b6020026020010151600001519050806001600160a01b031663d3eddcc5846001856112d89190612934565b815181106112e8576112e86127c7565b602002602001015160200151856001866113029190612934565b81518110611312576113126127c7565b6020026020010151604001518f8f8a818110611330576113306127c7565b905060200201358e8e8b818110611349576113496127c7565b905060200281019061135b91906127dd565b8c8c8151811061136d5761136d6127c7565b602002602001015160018c6113829190612934565b81518110611392576113926127c7565b60200260200101518e8d815181106113ac576113ac6127c7565b602002602001015160018d6113c19190612934565b815181106113d1576113d16127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161140198979695949392919061295a565b600060405180830381600087803b15801561141b57600080fd5b505af115801561142f573d6000803e3d6000fd5b50505050508061143e90612ac7565b9050611289565b50508061145190612ac7565b9050611235565b505b600101610e42565b5060005b838110156116de576000838281518110611482576114826127c7565b60200260200101515111156116d65760008382815181106114a5576114a56127c7565b60200260200101515190505b80156116d45760008483815181106114cb576114cb6127c7565b60200260200101516001836114e09190612934565b815181106114f0576114f06127c7565b60200260200101516060015190506000815190505b80156116c157600082611519600184612934565b81518110611529576115296127c7565b6020026020010151600001519050806001600160a01b031663ed463367846001856115549190612934565b81518110611564576115646127c7565b6020026020010151602001518560018661157e9190612934565b8151811061158e5761158e6127c7565b6020026020010151604001518f8f8a8181106115ac576115ac6127c7565b905060200201358e8e8b8181106115c5576115c56127c7565b90506020028101906115d791906127dd565b8c8c815181106115e9576115e96127c7565b602002602001015160018c6115fe9190612934565b8151811061160e5761160e6127c7565b60200260200101518e8d81518110611628576116286127c7565b602002602001015160018d61163d9190612934565b8151811061164d5761164d6127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161167d98979695949392919061295a565b600060405180830381600087803b15801561169757600080fd5b505af11580156116ab573d6000803e3d6000fd5b5050505050806116ba90612ac7565b9050611505565b5050806116cd90612ac7565b90506114b1565b505b600101611466565b5060005b8381101561181d5760008382815181106116fe576116fe6127c7565b60200260200101515111156118155760005b838281518110611722576117226127c7565b60200260200101515181101561181357336001600160a01b031684838151811061174e5761174e6127c7565b6020026020010151600186858151811061176a5761176a6127c7565b60200260200101515161177d9190612934565b8151811061178d5761178d6127c7565b6020026020010151602001516001600160a01b03167f40dadaa36c6c2e3d7317e24757451ffb2d603d875f0ad5e92c5dd156573b18738685815181106117d5576117d56127c7565b602002602001015184815181106117ee576117ee6127c7565b60200260200101516040516118039190612ade565b60405180910390a3600101611710565b505b6001016116e2565b50505050505050505050565b61183161189a565b600180546001600160a01b0383166001600160a01b031990911681179091556118626000546001600160a01b031690565b6001600160a01b03167f38d16b8cac22d99fc7c124b9cd0de2d3fa1faef420bfe791d8c362d765e2270060405160405180910390a350565b6000546001600160a01b031633146104045760405163118cdaa760e01b8152336004820152602401610555565b6118cf611bed565b6001805460ff60a01b191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b6000807f88c1d2ecf185adf710588203a5f263f0ff61be0d33da39792cde19ba9aa4331e83600001518460200151856040015161195c8760600151611c17565b6080808901516040805160208101989098526001600160a01b03968716908801529490931660608601529184015260a083015260c082015260e0015b60408051601f1981840301815291905280516020909101209392505050565b600180546001600160a01b031916905561056781611ce2565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016148015611a2957507f000000000000000000000000000000000000000000000000000000000000000046145b15611a5357507f000000000000000000000000000000000000000000000000000000000000000090565b610574604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f0000000000000000000000000000000000000000000000000000000000000000918101919091527f000000000000000000000000000000000000000000000000000000000000000060608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b611b03611b98565b6001805460ff60a01b1916600160a01b1790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586118ff3390565b60606105747f00000000000000000000000000000000000000000000000000000000000000006002611d32565b60606105747f00000000000000000000000000000000000000000000000000000000000000006003611d32565b600154600160a01b900460ff16156104045760405163d93c066560e01b815260040160405180910390fd5b600080600080611bd38686611ddd565b925092509250611be38282611e2a565b5090949350505050565b600154600160a01b900460ff1661040457604051638dfc202b60e01b815260040160405180910390fd5b60008082516001600160401b03811115611c3357611c336124ed565b604051908082528060200260200182016040528015611c5c578160200160208202803683370190505b50905060005b8351811015611cb257611c8d848281518110611c8057611c806127c7565b6020026020010151611ee7565b828281518110611c9f57611c9f6127c7565b6020908102919091010152600101611c62565b5080604051602001611cc49190612bcb565b60405160208183030381529060405280519060200120915050919050565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b606060ff8314611d4c57611d4583611f48565b9050610509565b818054611d5890612c01565b80601f0160208091040260200160405190810160405280929190818152602001828054611d8490612c01565b8015611dd15780601f10611da657610100808354040283529160200191611dd1565b820191906000526020600020905b815481529060010190602001808311611db457829003601f168201915b50505050509050610509565b60008060008351604103611e175760208401516040850151606086015160001a611e0988828585611f87565b955095509550505050611e23565b50508151600091506002905b9250925092565b6000826003811115611e3e57611e3e612c3b565b03611e47575050565b6001826003811115611e5b57611e5b612c3b565b03611e795760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115611e8d57611e8d612c3b565b03611eae5760405163fce698f760e01b815260048101829052602401610555565b6003826003811115611ec257611ec2612c3b565b03611ee3576040516335e2f38360e21b815260048101829052602401610555565b5050565b6000807f80ad7e1b04ee6d994a125f4714ca0720908bd80ed16063ec8aee4b88e9253e2d8360000151846020015180519060200120604051602001611998939291909283526001600160a01b03919091166020830152604082015260600190565b60606000611f5583612056565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b600080807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0841115611fc2575060009150600390508261204c565b604080516000808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015612016573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166120425750600092506001915082905061204c565b9250600091508190505b9450945094915050565b600060ff8216601f81111561050957604051632cd44ac360e21b815260040160405180910390fd5b60006020828403121561209057600080fd5b5035919050565b6000602082840312156120a957600080fd5b81356001600160401b038111156120bf57600080fd5b820160c081850312156120d157600080fd5b9392505050565b60005b838110156120f35781810151838201526020016120db565b50506000910152565b600081518084526121148160208601602086016120d8565b601f01601f19169290920160200192915050565b60ff60f81b881681526000602060e0602084015261214960e084018a6120fc565b838103604085015261215b818a6120fc565b606085018990526001600160a01b038816608086015260a0850187905284810360c08601528551808252602080880193509091019060005b818110156121af57835183529284019291840191600101612193565b50909c9b505050505050505050505050565b6020815260006120d160208301846120fc565b60008083601f8401126121e657600080fd5b5081356001600160401b038111156121fd57600080fd5b6020830191508360208260051b850101111561221857600080fd5b9250929050565b6000806000806000806060878903121561223857600080fd5b86356001600160401b038082111561224f57600080fd5b61225b8a838b016121d4565b9098509650602089013591508082111561227457600080fd5b6122808a838b016121d4565b9096509450604089013591508082111561229957600080fd5b506122a689828a016121d4565b979a9699509497509295939492505050565b80356001600160a01b03811681146122cf57600080fd5b919050565b6000602082840312156122e657600080fd5b6120d1826122b8565b6000808335601e1984360301811261230657600080fd5b83016020810192503590506001600160401b0381111561232557600080fd5b80360382131561221857600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60008383855260208086019550808560051b830101846000805b8881101561240e57858403601f19018a52823536899003605e1901811261239c578283fd5b880160606001600160a01b036123b1836122b8565b1686526123c0878301836122ef565b82898901526123d28389018284612334565b9250505060406123e4818401846122ef565b9350878303828901526123f8838583612334565b9d89019d97505050938601935050600101612377565b509198975050505050505050565b6020815260006001600160a01b0380612434856122b8565b16602084015280612447602086016122b8565b16604084015250604083013560608301526060830135601e1984360301811261246f57600080fd5b83016020810190356001600160401b0381111561248b57600080fd5b8060051b360382131561249d57600080fd5b60c060808501526124b260e08501828461235d565b915050608084013560a08401526124cc60a08501856122ef565b848303601f190160c08601526124e3838284612334565b9695505050505050565b634e487b7160e01b600052604160045260246000fd5b604051606081016001600160401b0381118282101715612525576125256124ed565b60405290565b60405160c081016001600160401b0381118282101715612525576125256124ed565b604051601f8201601f191681016001600160401b0381118282101715612575576125756124ed565b604052919050565b60006001600160401b03821115612596576125966124ed565b5060051b60200190565b60006001600160401b038211156125b9576125b96124ed565b50601f01601f191660200190565b600082601f8301126125d857600080fd5b81356125eb6125e6826125a0565b61254d565b81815284602083860101111561260057600080fd5b816020850160208301376000918101602001919091529392505050565b600082601f83011261262e57600080fd5b8135602061263e6125e68361257d565b82815260059290921b8401810191818101908684111561265d57600080fd5b8286015b8481101561270c5780356001600160401b03808211156126815760008081fd5b908801906060828b03601f190181131561269b5760008081fd5b6126a3612503565b6126ae8885016122b8565b8152604080850135848111156126c45760008081fd5b6126d28e8b838901016125c7565b838b0152509184013591838311156126ea5760008081fd5b6126f88d8a858801016125c7565b908201528652505050918301918301612661565b509695505050505050565b600060c0828403121561272957600080fd5b61273161252b565b905061273c826122b8565b815261274a602083016122b8565b60208201526040820135604082015260608201356001600160401b038082111561277357600080fd5b61277f8583860161261d565b60608401526080840135608084015260a08401359150808211156127a257600080fd5b506127af848285016125c7565b60a08301525092915050565b60006105093683612717565b634e487b7160e01b600052603260045260246000fd5b6000808335601e198436030181126127f457600080fd5b8301803591506001600160401b0382111561280e57600080fd5b60200191503681900382131561221857600080fd5b6000602080838503121561283657600080fd5b82356001600160401b038082111561284d57600080fd5b818501915085601f83011261286157600080fd5b813561286f6125e68261257d565b81815260059190911b8301840190848101908883111561288e57600080fd5b8585015b838110156128c6578035858111156128aa5760008081fd5b6128b88b89838a0101612717565b845250918601918601612892565b5098975050505050505050565b8281526040602082015260006128ec60408301846120fc565b949350505050565b60006020828403121561290657600080fd5b81516001600160e01b0319811681146120d157600080fd5b634e487b7160e01b600052601160045260246000fd5b818103818111156105095761050961291e565b808201808211156105095761050961291e565b60e08152600061296d60e083018b6120fc565b828103602084015261297f818b6120fc565b9050886040840152828103606084015261299a81888a612334565b608084019690965250506001600160a01b0392831660a0820152911660c09091015295945050505050565b8381526040602082015260006129df604083018486612334565b95945050505050565b600060208083850312156129fb57600080fd5b82516001600160401b0380821115612a1257600080fd5b818501915085601f830112612a2657600080fd5b8151612a346125e68261257d565b81815260059190911b83018401908481019088831115612a5357600080fd5b8585015b838110156128c657805185811115612a6f5760008081fd5b8601603f81018b13612a815760008081fd5b878101516040612a936125e6836125a0565b8281528d82848601011115612aa85760008081fd5b612ab7838c83018487016120d8565b8652505050918601918601612a57565b600081612ad657612ad661291e565b506000190190565b602080825282516001600160a01b0390811683830152838201518116604080850191909152808501516060808601919091528086015160c06080870152805160e0870181905260009594610100600583901b8901810195919493870193919290890190885b81811015612b9d5760ff198b8903018352855187815116895289810151858b8b0152612b71868b01826120fc565b918701518a83038b890152919050612b8981836120fc565b995050509488019491880191600101612b43565b50505050505050608085015160a085015260a08501519150601f198482030160c08501526129df81836120fc565b815160009082906020808601845b83811015612bf557815185529382019390820190600101612bd9565b50929695505050505050565b600181811c90821680612c1557607f821691505b602082108103612c3557634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052602160045260246000fdfea264697066735822122073f8fd2b36b643aff6f988638bc7c8ab2f41546c01a777524170b479e36618c564736f6c63430008170033"}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/constants.cjs"}],[3066,{"./types.cjs":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationRevertedError=n.SimulationInvalidResponseError=n.SimulationChainNotSupportedError=n.FirstTimeInteractionError=n.SimulationError=void 0;const r=e("./types.cjs");class a extends Error{constructor(e,t){super(e??"Simulation failed"),this.code=t}}n.SimulationError=a;class s extends Error{constructor(e,t){super(e??"Error checking first time interaction"),this.code=t}}n.FirstTimeInteractionError=s;n.SimulationChainNotSupportedError=class extends a{constructor(e){super(`Chain is not supported: ${e}`,r.SimulationErrorCode.ChainNotSupported)}};n.SimulationInvalidResponseError=class extends a{constructor(){super("Invalid response from simulation API",r.SimulationErrorCode.InvalidResponse)}};n.SimulationRevertedError=class extends a{constructor(){super("Transaction was reverted",r.SimulationErrorCode.Reverted)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/errors.cjs"}],[3067,{"../logger.cjs":3086,"../types.cjs":3087,"../utils/gas-fees.cjs":3096,"@metamask/gas-fee-controller":3111,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultGasFeeFlow=void 0;const u=e("@metamask/gas-fee-controller"),d=e("@metamask/utils"),h=e("../logger.cjs"),f=e("../types.cjs"),m=e("../utils/gas-fees.cjs"),p=(0,d.createModuleLogger)(h.projectLogger,"default-gas-fee-flow");n.DefaultGasFeeFlow=class{constructor(){r.add(this)}matchesTransaction(){return!0}async getGasFees(e){const{gasFeeControllerData:t}=e,{gasEstimateType:n,gasFeeEstimates:o}=t;let c;switch(n){case u.GAS_ESTIMATE_TYPES.FEE_MARKET:p("Using fee market estimates",o),c=l(this,r,"m",a).call(this,o);break;case u.GAS_ESTIMATE_TYPES.LEGACY:p("Using legacy estimates",o),c=l(this,r,"m",s).call(this,o);break;case u.GAS_ESTIMATE_TYPES.ETH_GASPRICE:p("Using eth_gasPrice estimates",o),c=l(this,r,"m",i).call(this,o);break;default:throw new Error(`Unsupported gas estimate type: ${n}`)}return{estimates:c}}},r=new WeakSet,a=function(e){const t=Object.values(f.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:l(this,r,"m",o).call(this,e,n)}),{});return{type:f.GasFeeEstimateType.FeeMarket,...t}},s=function(e){const t=Object.values(f.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:l(this,r,"m",c).call(this,e,n)}),{});return{type:f.GasFeeEstimateType.Legacy,...t}},i=function(e){return{type:f.GasFeeEstimateType.GasPrice,gasPrice:(0,m.gweiDecimalToWeiHex)(e.gasPrice)}},o=function(e,t){return{maxFeePerGas:(0,m.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:(0,m.gweiDecimalToWeiHex)(e[t].suggestedMaxPriorityFeePerGas)}},c=function(e,t){return(0,m.gweiDecimalToWeiHex)(e[t])}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/DefaultGasFeeFlow.cjs"}],[3068,{"../logger.cjs":3086,"../types.cjs":3087,"./DefaultGasFeeFlow.cjs":3067,"@metamask/controller-utils":1488,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.LineaGasFeeFlow=void 0;const u=e("@metamask/controller-utils"),d=e("@metamask/utils"),h=e("./DefaultGasFeeFlow.cjs"),f=e("../logger.cjs"),m=e("../types.cjs"),p=(0,d.createModuleLogger)(f.projectLogger,"linea-gas-fee-flow"),g=[u.ChainId["linea-mainnet"],u.ChainId["linea-goerli"],u.ChainId["linea-sepolia"]],w={low:1,medium:1.35,high:1.7},b={low:1,medium:1.05,high:1.1};n.LineaGasFeeFlow=class{constructor(){r.add(this)}matchesTransaction({transactionMeta:e}){return g.includes(e.chainId)}async getGasFees(e){try{return await l(this,r,"m",a).call(this,e)}catch(t){return p("Using default flow as fallback due to error",t),(new h.DefaultGasFeeFlow).getGasFees(e)}}},r=new WeakSet,a=async function(e){const{ethQuery:t,transactionMeta:n}=e,a=await l(this,r,"m",s).call(this,n,t);p("Received Linea response",a);const d=l(this,r,"m",i).call(this,a.baseFeePerGas,w);p("Generated base fees",l(this,r,"m",c).call(this,d));const h=l(this,r,"m",i).call(this,a.priorityFeePerGas,b);p("Generated priority fees",l(this,r,"m",c).call(this,h));const f=l(this,r,"m",o).call(this,d,h);p("Generated max fees",l(this,r,"m",c).call(this,f));return{estimates:Object.values(m.GasFeeEstimateLevel).reduce((e,t)=>({...e,[t]:{maxFeePerGas:(0,u.toHex)(f[t]),maxPriorityFeePerGas:(0,u.toHex)(h[t])}}),{type:m.GasFeeEstimateType.FeeMarket})}},s=function(e,t){return(0,u.query)(t,"linea_estimateGas",[{from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,input:e.txParams.data}])},i=function(e,t){const n=(0,u.hexToBN)(e);return{low:n.muln(t.low),medium:n.muln(t.medium),high:n.muln(t.high)}},o=function(e,t){return{low:e.low.add(t.low),medium:e.medium.add(t.medium),high:e.high.add(t.high)}},c=function(e){return Object.values(m.GasFeeEstimateLevel).map(t=>e[t].toString(10))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/LineaGasFeeFlow.cjs"}],[3069,{"../constants.cjs":3065,"./OracleLayer1GasFeeFlow.cjs":3070,"@metamask/controller-utils":1488,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.OptimismLayer1GasFeeFlow=void 0;const i=e("@metamask/controller-utils"),o=e("@metamask/utils"),c=e("./OracleLayer1GasFeeFlow.cjs"),l=e("../constants.cjs"),u=[l.CHAIN_IDS.OPTIMISM,l.CHAIN_IDS.OPTIMISM_TESTNET,l.CHAIN_IDS.BASE,l.CHAIN_IDS.BASE_TESTNET,l.CHAIN_IDS.OPBNB,l.CHAIN_IDS.OPBNB_TESTNET,l.CHAIN_IDS.ZORA];class d extends c.OracleLayer1GasFeeFlow{constructor(){super(...arguments),r.add(this)}async matchesTransaction({transactionMeta:e}){const t=(0,o.hexToNumber)(e.chainId),n=await s(this,r,"m",a).call(this);return!!n?.has(t)||u.includes(e.chainId)}}n.OptimismLayer1GasFeeFlow=d,r=new WeakSet,a=async function(){try{const e=await(0,i.handleFetch)("https://gas.api.cx.metamask.io/v1/supportedNetworks");return new Set(e?.partialSupport?.optimism??[])}catch{return null}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/OptimismLayer1GasFeeFlow.cjs"}],[3070,{"../logger.cjs":3086,"../utils/prepare.cjs":3101,"../utils/utils.cjs":3106,"@ethersproject/contracts":771,"@ethersproject/providers":809,"@metamask/utils":3207,"bn.js":4115,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OracleLayer1GasFeeFlow=void 0;const d=e("@ethersproject/contracts"),h=e("@ethersproject/providers"),f=e("@metamask/utils"),m=u(e("bn.js")),p=e("../logger.cjs"),g=e("../utils/prepare.cjs"),w=e("../utils/utils.cjs"),b=(0,f.createModuleLogger)(p.projectLogger,"oracle-layer1-gas-fee-flow"),T=new m.default(0),E=[{inputs:[{internalType:"bytes",name:"_data",type:"bytes"}],name:"getL1Fee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_gasUsed",type:"uint256"}],name:"getOperatorFee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];n.OracleLayer1GasFeeFlow=class{constructor(){r.add(this)}getOracleAddressForChain(e){return"0x420000000000000000000000000000000000000F"}shouldSignTransaction(){return!1}async getLayer1Fee(e){try{const{provider:t,transactionMeta:n}=e,i=l(this,r,"m",c).call(this,t,n.chainId),o=await l(this,r,"m",a).call(this,i,n),u=await l(this,r,"m",s).call(this,i,n);return{layer1Fee:(0,f.add0x)((0,w.padHexToEvenLength)(o.add(u).toString(16)))}}catch(e){throw b("Failed to get oracle layer 1 gas fee",e),new Error("Failed to get oracle layer 1 gas fee")}}},r=new WeakSet,a=async function(e,t){const n=l(this,r,"m",i).call(this,t,this.shouldSignTransaction()).serialize(),a=await e.getL1Fee(n);if(a===undefined)throw new Error("No value returned from oracle contract");return(0,w.toBN)(a)},s=async function(e,t){const{gasUsed:n}=t;if(!n)return T;try{const t=await e.getOperatorFee(n);return t===undefined?T:(0,w.toBN)(t)}catch(e){return b("Failed to get operator layer 1 gas fee",e),T}},i=function(e,n){const a=l(this,r,"m",o).call(this,e),{chainId:s}=e;let i=(0,g.prepareTransaction)(s,a);if(n){const e=t.from("abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789","hex"),n=Uint8Array.from(e);i=i.sign(n)}return i},o=function(e){return{...e.txParams,gasLimit:e.txParams.gas}},c=function(e,t){return new d.Contract(this.getOracleAddressForChain(t),E,new h.Web3Provider(e))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/OracleLayer1GasFeeFlow.cjs"}],[3071,{"../logger.cjs":3086,"../types.cjs":3087,"../utils/feature-flags.cjs":3093,"../utils/gas-fees.cjs":3096,"./DefaultGasFeeFlow.cjs":3067,"@metamask/gas-fee-controller":3111,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.randomiseDecimalGWEIAndConvertToHex=n.RandomisedEstimationsGasFeeFlow=void 0;const l=e("@metamask/gas-fee-controller"),u=e("@metamask/utils"),d=e("./DefaultGasFeeFlow.cjs"),h=e("../logger.cjs"),f=e("../types.cjs"),m=e("../utils/feature-flags.cjs"),p=e("../utils/gas-fees.cjs"),g=(0,u.createModuleLogger)(h.projectLogger,"randomised-estimation-gas-fee-flow");function w(e,t,n){const r=(0,p.gweiDecimalToWeiDecimal)(e),a=r.length,s=Math.min(t,a-n);if(0===Number(r)||s<=0)return`0x${Number(r).toString(16)}`;const i=a-s,o=r.slice(0,i),c=r.slice(-s),l=function(e,t){const n=10**e;return t+Math.floor(Math.random()*(n-t))}(s,Number(c)),d=`0x${(BigInt(o+"0".repeat(s))+BigInt(l)).toString(16)}`;return(0,u.add0x)(d)}n.RandomisedEstimationsGasFeeFlow=class{constructor(){r.add(this)}matchesTransaction({transactionMeta:e,messenger:t}){const{chainId:n}=e;return(0,m.getGasFeeRandomisation)(t).randomisedGasFeeDigits[n]!==undefined}async getGasFees(e){try{return await c(this,r,"m",s).call(this,e)}catch(t){return g("Using default flow as fallback due to error",t),await c(this,r,"m",a).call(this,e)}}},r=new WeakSet,a=async function(e){return(new d.DefaultGasFeeFlow).getGasFees(e)},s=async function(e){const{messenger:t,gasFeeControllerData:n,transactionMeta:s}=e,{gasEstimateType:o,gasFeeEstimates:u}=n,d=(0,m.getGasFeeRandomisation)(t),h=d.randomisedGasFeeDigits[s.chainId],f=d.preservedNumberOfDigits??2;if(o===l.GAS_ESTIMATE_TYPES.FEE_MARKET){g("Randomising fee market estimates",u);const e=c(this,r,"m",i).call(this,u,h,f);return g("Added randomised fee market estimates",e),{estimates:e}}return await c(this,r,"m",a).call(this,e)},i=function(e,t,n){const a=Object.values(f.GasFeeEstimateLevel).reduce((a,s)=>({...a,[s]:c(this,r,"m",o).call(this,e,s,t,n)}),{});return{type:f.GasFeeEstimateType.FeeMarket,...a}},o=function(e,t,n,r){return{maxFeePerGas:(0,p.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:w(e[t].suggestedMaxPriorityFeePerGas,n,r)}},n.randomiseDecimalGWEIAndConvertToHex=w}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/RandomisedEstimationsGasFeeFlow.cjs"}],[3072,{"../constants.cjs":3065,"./OracleLayer1GasFeeFlow.cjs":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollLayer1GasFeeFlow=void 0;const r=e("./OracleLayer1GasFeeFlow.cjs"),a=e("../constants.cjs"),s=[a.CHAIN_IDS.SCROLL,a.CHAIN_IDS.SCROLL_SEPOLIA];class i extends r.OracleLayer1GasFeeFlow{getOracleAddressForChain(e){return"0x5300000000000000000000000000000000000002"}shouldSignTransaction(){return!0}async matchesTransaction({transactionMeta:e}){return s.includes(e.chainId)}}n.ScrollLayer1GasFeeFlow=i}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/ScrollLayer1GasFeeFlow.cjs"}],[3073,{"../types.cjs":3087,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.TestGasFeeFlow=void 0;const c=e("@metamask/controller-utils"),l=e("../types.cjs"),u=1e15;n.TestGasFeeFlow=class{constructor(){r.add(this),a.set(this,1)}matchesTransaction(){return!0}async getGasFees(e){const{transactionMeta:t}=e,{txParams:n}=t,{gas:c}=n;if(!c)throw new Error("Cannot estimate fee without gas value");const d=parseInt(c,16),h=.5*u,f=(i(this,a,"f")+1)*u,m=i(this,a,"f")*u,p=f-h,g=m-h,w=f+h,b=m+h;return o(this,a,i(this,a,"f")+1,"f"),{estimates:{type:l.GasFeeEstimateType.FeeMarket,low:{maxFeePerGas:i(this,r,"m",s).call(this,p,d),maxPriorityFeePerGas:i(this,r,"m",s).call(this,g,d)},medium:{maxFeePerGas:i(this,r,"m",s).call(this,f,d),maxPriorityFeePerGas:i(this,r,"m",s).call(this,m,d)},high:{maxFeePerGas:i(this,r,"m",s).call(this,w,d),maxPriorityFeePerGas:i(this,r,"m",s).call(this,b,d)}}}}},a=new WeakMap,r=new WeakSet,s=function(e,t){const n=Math.ceil(e/t);return(0,c.toHex)(n)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/TestGasFeeFlow.cjs"}],[3074,{"../api/accounts-api.cjs":3063,"../constants.cjs":3065,"../index.cjs":3085,"../logger.cjs":3086,"../types.cjs":3087,"@metamask/controller-utils":1488,"bn.js":4115,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AccountsApiRemoteTransactionSource=n.SUPPORTED_CHAIN_IDS=void 0;const l=e("@metamask/controller-utils"),u=c(e("bn.js")),d=e("uuid"),h=e("../index.cjs"),f=e("../api/accounts-api.cjs"),m=e("../constants.cjs"),p=e("../logger.cjs"),g=e("../types.cjs");n.SUPPORTED_CHAIN_IDS=[m.CHAIN_IDS.MAINNET,m.CHAIN_IDS.POLYGON,m.CHAIN_IDS.BSC,m.CHAIN_IDS.LINEA_MAINNET,m.CHAIN_IDS.BASE,m.CHAIN_IDS.OPTIMISM,m.CHAIN_IDS.ARBITRUM,m.CHAIN_IDS.SCROLL,m.CHAIN_IDS.SEI,m.CHAIN_IDS.MONAD];const w=(0,p.createModuleLogger)(p.incomingTransactionsLogger,"accounts-api-source");n.AccountsApiRemoteTransactionSource=class{constructor(){r.add(this)}getSupportedChains(){return n.SUPPORTED_CHAIN_IDS}async fetchTransactions(e){const{address:t}=e,c=await o(this,r,"m",a).call(this,e,n.SUPPORTED_CHAIN_IDS);w("Fetched transactions",c.length,c);const l=await Promise.all(c.map(e=>o(this,r,"m",i).call(this,t,e)));w("Normalized transactions",l);const u=o(this,r,"m",s).call(this,e,l);return w("Filtered transactions",u.length,u),u}},r=new WeakSet,a=async function(e,t){const{address:n,tags:r}=e,a=[];try{const e=await(0,f.getAccountTransactions)({address:n,chainIds:t,sortDirection:"DESC",tags:r});e?.data&&a.push(...e.data)}catch(e){w("Error while fetching transactions",e)}return a},s=function(e,t){const{address:n,includeTokenTransfers:r,updateTransactions:a}=e;let s=t;return a||(s=s.filter(e=>e.txParams.to===n)),r||(s=s.filter(e=>!e.isTransfer)),s},i=async function(e,t){const n=String(t.blockNumber),r=`0x${t.chainId.toString(16)}`,{hash:a}=t,s=new Date(t.timestamp).getTime(),i=(0,d.v1)({msecs:s}),{from:o}=t,c=(0,l.BNToHex)(new u.default(t.gas)),f=(0,l.BNToHex)(new u.default(t.gasPrice)),m=(0,l.BNToHex)(new u.default(t.gasUsed)),p=(0,l.BNToHex)(new u.default(t.nonce)),w=t.methodId,b=g.TransactionType.incoming,T=t.isError?g.TransactionStatus.failed:g.TransactionStatus.confirmed,E=t.valueTransfers.find(t=>(t.to.toLowerCase()===e.toLowerCase()||t.from.toLowerCase()===e.toLowerCase())&&t.contractAddress),y=E?.to.toLowerCase()===e.toLowerCase()&&o.toLowerCase()!==e.toLowerCase(),S=o.toLowerCase()===e.toLowerCase(),I=E?.amount,k=E?.contractAddress,A=E?.decimal,C=E?.symbol,_=(0,l.BNToHex)(new u.default(y?E?.amount??t.value:t.value)),P=y?e:t.to,v={blockNumber:n,chainId:r,error:T===g.TransactionStatus.failed?new Error("Transaction failed"):undefined,hash:a,id:i,isTransfer:y,networkClientId:"",status:T,time:s,toSmartContract:!1,transferInformation:E?{amount:I,contractAddress:k,decimals:A,symbol:C}:undefined,txParams:{chainId:r,data:w,from:o,gas:c,gasPrice:f,gasUsed:m,nonce:p,to:P,value:_},type:b,verifiedOnBlockchain:!1};return S&&(v.type=(await(0,h.determineTransactionType)(v.txParams)).type),v}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/AccountsApiRemoteTransactionSource.cjs"}],[3075,{"../gas-flows/DefaultGasFeeFlow.cjs":3067,"../logger.cjs":3086,"../types.cjs":3087,"../utils/gas-flow.cjs":3097,"../utils/layer1-gas-fee-flow.cjs":3099,"@metamask/eth-query":2073,"@metamask/utils":3207,events:4472},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T,E,y,S,I,k,A,C=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},_=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},P=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateTransactionGasEstimates=n.updateTransactionGasProperties=n.GasFeePoller=void 0;const v=P(e("@metamask/eth-query")),N=e("@metamask/utils"),R=P(e("events")),j=e("../gas-flows/DefaultGasFeeFlow.cjs"),O=e("../logger.cjs"),x=e("../types.cjs"),L=e("../utils/gas-flow.cjs"),M=e("../utils/layer1-gas-fee-flow.cjs"),F=(0,N.createModuleLogger)(O.projectLogger,"gas-fee-poller");function D(e,t,n,r){const{type:a}=t;if(r){if(a===x.GasFeeEstimateType.FeeMarket){const r=t;e.maxFeePerGas=r[n]?.maxFeePerGas,e.maxPriorityFeePerGas=r[n]?.maxPriorityFeePerGas}if(a===x.GasFeeEstimateType.GasPrice){const n=t;e.maxFeePerGas=n.gasPrice,e.maxPriorityFeePerGas=n.gasPrice}if(a===x.GasFeeEstimateType.Legacy){const r=t[n];e.maxFeePerGas=r,e.maxPriorityFeePerGas=r}delete e.gasPrice}else{if(a===x.GasFeeEstimateType.FeeMarket){const r=t;e.gasPrice=r[n]?.maxFeePerGas}if(a===x.GasFeeEstimateType.GasPrice){const n=t;e.gasPrice=n.gasPrice}if(a===x.GasFeeEstimateType.Legacy){const r=t;e.gasPrice=r[n]}delete e.maxFeePerGas,delete e.maxPriorityFeePerGas}}n.GasFeePoller=class{constructor({findNetworkClientIdByChainId:e,gasFeeFlows:t,getGasFeeControllerEstimates:n,getProvider:g,getTransactions:w,getTransactionBatches:b,layer1GasFeeFlows:T,messenger:E,onStateChange:y}){r.add(this),this.hub=new R.default,a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),f.set(this,!1),C(this,a,e,"f"),C(this,s,t,"f"),C(this,u,T,"f"),C(this,i,n,"f"),C(this,o,g,"f"),C(this,c,w,"f"),C(this,l,b,"f"),C(this,d,E,"f"),y(()=>{const e=_(this,r,"m",I).call(this),t=_(this,r,"m",k).call(this);e.length||t.length?_(this,r,"m",m).call(this):_(this,r,"m",p).call(this)})}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,r=new WeakSet,m=function(){_(this,f,"f")||(_(this,r,"m",g).call(this),C(this,f,!0,"f"),F("Started polling"))},p=function(){_(this,f,"f")&&(clearTimeout(_(this,h,"f")),C(this,h,undefined,"f"),C(this,f,!1,"f"),F("Stopped polling"))},g=async function e(){await _(this,r,"m",w).call(this),await _(this,r,"m",b).call(this),C(this,h,setTimeout(()=>_(this,r,"m",e).call(this),1e4),"f")},w=async function(){const e=_(this,r,"m",I).call(this);if(!e.length)return;F("Found unapproved transactions",e.length);const t=await _(this,r,"m",A).call(this,e);F("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,a=t.get(n);return _(this,r,"m",T).call(this,e,a)}))},b=async function(){const e=_(this,r,"m",k).call(this);if(!e.length)return;F("Found unapproved transaction batches",e.length);const t=await _(this,r,"m",A).call(this,e);F("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,a=t.get(n);return _(this,r,"m",E).call(this,e,a)}))},T=async function(e,t){const{id:n}=e,[a,s]=await Promise.all([_(this,r,"m",y).call(this,e,t),_(this,r,"m",S).call(this,e)]);(a||s)&&this.hub.emit("transaction-updated",{transactionId:n,gasFeeEstimates:a?.gasFeeEstimates,gasFeeEstimatesLoaded:a?.gasFeeEstimatesLoaded,layer1GasFee:s})},E=async function(e,t){const{id:n}=e,r=new v.default(_(this,o,"f").call(this,e.networkClientId)),a=new j.DefaultGasFeeFlow,s={ethQuery:r,gasFeeControllerData:t,messenger:_(this,d,"f"),transactionMeta:{...e,txParams:{...e.transactions?.[0],from:e.from,gas:e.gas},time:Date.now()}};let i;try{i=(await a.getGasFees(s)).estimates}catch(t){F("Failed to get gas fees for batch",e.id,t)}i&&this.hub.emit("transaction-batch-updated",{transactionBatchId:n,gasFeeEstimates:i,gasFeeEstimatesLoaded:!0})},y=async function(e,t){const{networkClientId:n}=e,r=new v.default(_(this,o,"f").call(this,n)),a=(0,L.getGasFeeFlow)(e,_(this,s,"f"),_(this,d,"f"));a&&F("Found gas fee flow",a.constructor.name,e.id);const i={ethQuery:r,gasFeeControllerData:t,messenger:_(this,d,"f"),transactionMeta:e};let c;if(a)try{c=(await a.getGasFees(i)).estimates}catch(t){F("Failed to get suggested gas fees",e.id,t)}return!c&&e.gasFeeEstimatesLoaded?undefined:(F("Updated gas fee estimates",{gasFeeEstimates:c,transaction:e.id}),{gasFeeEstimates:c,gasFeeEstimatesLoaded:!0})},S=async function(e){const{networkClientId:t}=e,n=_(this,o,"f").call(this,t),r=await(0,M.getTransactionLayer1GasFee)({layer1GasFeeFlows:_(this,u,"f"),messenger:_(this,d,"f"),provider:n,transactionMeta:e});return r&&F("Updated layer 1 gas fee",r,e.id),r},I=function(){return _(this,c,"f").call(this).filter(e=>e.status===x.TransactionStatus.unapproved)},k=function(){return _(this,l,"f").call(this).filter(e=>e.status===x.TransactionStatus.unapproved)},A=async function(e){const t=new Map;for(const n of e){const{chainId:e,networkClientId:r}=n;if(t.has(e))continue;const s=r??_(this,a,"f").call(this,e);t.set(e,s)}F("Extracted network client IDs by chain ID",t);const n=Array.from(t.entries()).map(async([e,t])=>[e,await _(this,i,"f").call(this,{networkClientId:t})]);return new Map(await Promise.all(n))},n.updateTransactionGasProperties=function({gasFeeEstimates:e,gasFeeEstimatesLoaded:t,isTxParamsGasFeeUpdatesEnabled:n,layer1GasFee:r,txMeta:a}){const s=a.userFeeLevel,i=Object.values(x.GasFeeEstimateLevel).includes(s);if(n(a)&&i&&e){const t=a.txParams.type!==x.TransactionEnvelopeType.legacy;D(a.txParams,e,s,t)}e&&(a.gasFeeEstimates=e),t!==undefined&&(a.gasFeeEstimatesLoaded=t),r&&(a.layer1GasFee=r)},n.updateTransactionGasEstimates=function({txMeta:e,userFeeLevel:t}){const{txParams:n,gasFeeEstimates:r}=e;if(!r)return;D(n,r,t,e.txParams.type!==x.TransactionEnvelopeType.legacy)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/GasFeePoller.cjs"}],[3076,{"../logger.cjs":3086,"../utils/feature-flags.cjs":3093,events:4472},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T,E,y=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},S=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},I=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.IncomingTransactionHelper=void 0;const k=I(e("events")),A=e("../logger.cjs"),C=e("../utils/feature-flags.cjs");n.IncomingTransactionHelper=class{constructor({client:e,getCurrentAccount:t,getLocalTransactions:n,includeTokenTransfers:g,isEnabled:w,messenger:b,remoteTransactionSource:T,trimTransactions:E,updateTransactions:S}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),f.set(this,void 0),m.set(this,void 0),p.set(this,void 0),this.hub=new k.default,y(this,a,e,"f"),y(this,s,t,"f"),y(this,i,n,"f"),y(this,o,g,"f"),y(this,c,w??(()=>!0),"f"),y(this,l,!1,"f"),y(this,u,!1,"f"),y(this,d,b,"f"),y(this,h,T,"f"),y(this,m,E,"f"),y(this,p,S,"f")}start(){if(S(this,l,"f"))return;if(!S(this,r,"m",b).call(this))return;const e=S(this,r,"m",T).call(this);(0,A.incomingTransactionsLogger)("Started polling",{interval:e}),y(this,l,!0,"f"),S(this,u,"f")||S(this,r,"m",g).call(this).catch(e=>{(0,A.incomingTransactionsLogger)("Initial polling failed",e)})}stop(){S(this,f,"f")&&clearTimeout(S(this,f,"f")),S(this,l,"f")&&(y(this,l,!1,"f"),(0,A.incomingTransactionsLogger)("Stopped polling"))}async update({isInterval:e,tags:t}={}){const n=S(this,r,"m",E).call(this,t,e);if((0,A.incomingTransactionsLogger)("Checking for incoming transactions",{isInterval:Boolean(e),tags:n}),!S(this,r,"m",b).call(this))return;const a=S(this,s,"f").call(this),c=S(this,o,"f")??!0,l=S(this,p,"f")??!1;let u=[];try{u=await S(this,h,"f").fetchTransactions({address:a.address,includeTokenTransfers:c,tags:n,updateTransactions:l})}catch(e){return void(0,A.incomingTransactionsLogger)("Error while fetching remote transactions",e)}if(!u.length)return;S(this,r,"m",w).call(this,u),(0,A.incomingTransactionsLogger)("Found potential transactions",u.length,u);const d=S(this,i,"f").call(this),f=u.filter(e=>!d.some(t=>t.hash?.toLowerCase()===e.hash?.toLowerCase()&&t.txParams.from?.toLowerCase()===e.txParams.from?.toLowerCase()&&t.type===e.type));if(!f.length)return void(0,A.incomingTransactionsLogger)("All transactions are already known");(0,A.incomingTransactionsLogger)("Found unique transactions",f.length,f);const g=S(this,m,"f").call(this,[...f,...d]),T=f.map(e=>e.id),y=g.filter(e=>T.includes(e.id));y.length?((0,A.incomingTransactionsLogger)("Adding new transactions",y.length,y),this.hub.emit("transactions",y)):(0,A.incomingTransactionsLogger)("All unique transactions truncated due to limit")}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,r=new WeakSet,g=async function e(){y(this,u,!0,"f");try{await this.update({isInterval:!0})}catch(e){console.error("Error while checking incoming transactions",e)}y(this,u,!1,"f"),S(this,l,"f")&&(S(this,f,"f")&&clearTimeout(S(this,f,"f")),y(this,f,setTimeout(()=>S(this,r,"m",e).call(this),S(this,r,"m",T).call(this)),"f"))},w=function(e){e.sort((e,t)=>e.time<t.time?-1:1)},b=function(){return S(this,c,"f").call(this)},T=function(){return(0,C.getIncomingTransactionsPollingInterval)(S(this,d,"f"))},E=function(e,t){const n=[];return S(this,a,"f")&&n.push(S(this,a,"f")),e?.length?n.push(...e):t&&n.push("automatic-polling"),n?.length?n:undefined}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/IncomingTransactionHelper.cjs"}],[3077,{"../logger.cjs":3086,"@metamask/utils":3207,"async-mutex":3998,"eth-method-registry":4418,events:4472},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.MethodDataHelper=void 0;const h=e("@metamask/utils"),f=e("async-mutex"),m=e("eth-method-registry"),p=d(e("events")),g=e("../logger.cjs"),w=(0,h.createModuleLogger)(g.projectLogger,"method-data");n.MethodDataHelper=class{constructor({getProvider:e,getState:t}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,new f.Mutex),this.hub=new p.default,l(this,a,e,"f"),l(this,s,t,"f"),l(this,i,new Map,"f")}async lookup(e,t){w("lookup",e,t);const n=await u(this,o,"f").acquire();try{const n=u(this,s,"f").call(this)[e];if(n)return w("Cached",n),n;let o=u(this,i,"f").get(t);if(!o){const e=u(this,a,"f").call(this,t);o=new m.MethodRegistry({provider:e}),u(this,i,"f").set(t,o),w("Created registry",t)}const l=await u(this,r,"m",c).call(this,e,o);return w("Result",l),this.hub.emit("update",{fourBytePrefix:e,methodData:l}),l}finally{n()}}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,r=new WeakSet,c=async function(e,t){const n=await t.lookup(e);if(!n)return w("No method found",e),{registryMethod:"",parsedRegistryMethod:{name:undefined,args:undefined}};w("Parsing",n);return{registryMethod:n,parsedRegistryMethod:t.parse(n)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/MethodDataHelper.cjs"}],[3078,{"../logger.cjs":3086,"async-mutex":3998},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainTrackingHelper=void 0;const w=e("async-mutex"),b=e("../logger.cjs"),T=(0,b.createModuleLogger)(b.projectLogger,"multichain-tracking");n.MultichainTrackingHelper=class{constructor({findNetworkClientIdByChainId:e,getNetworkClientById:t,getNetworkClientRegistry:n,removePendingTransactionTrackerListeners:w,createNonceTracker:b,createPendingTransactionTracker:E,onNetworkStateChange:y}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,new Map),d.set(this,new Map),this.checkForPendingTransactionAndStartPolling=()=>{for(const[,e]of g(this,d,"f"))e.pendingTransactionTracker.startIfPendingTransactions()},h.set(this,e=>{const t=Object.keys(e),n=Array.from(g(this,d,"f").keys()),a=n.filter(e=>!t.includes(e));a.forEach(e=>{g(this,r,"m",f).call(this,e)});const s=t.filter(e=>!n.includes(e));s.forEach(e=>{g(this,r,"m",m).call(this,e)}),s.length&&T("Added trackers",s),a.length&&T("Removed trackers",a)}),p(this,a,e,"f"),p(this,s,t,"f"),p(this,i,n,"f"),p(this,o,w,"f"),p(this,c,b,"f"),p(this,l,E,"f"),y((e,t)=>{const n=g(this,i,"f").call(this);t.forEach(({op:e,path:t})=>{if("remove"===e&&"networkConfigurations"===t[0]){const e=t[1];delete n[e]}}),g(this,h,"f").call(this,n)})}initialize(){const e=g(this,i,"f").call(this);g(this,h,"f").call(this,e),T("Initialized")}has(e){return g(this,d,"f").has(e)}async acquireNonceLockForChainIdKey({chainId:e,key:t="global"}){let n=g(this,u,"f").get(e);n||(n=new Map,g(this,u,"f").set(e,n));let r=n.get(t);return r||(r=new w.Mutex,n.set(t,r)),await r.acquire()}async getNonceLock(e,t){const n=g(this,s,"f").call(this,t),r=await this.acquireNonceLockForChainIdKey({chainId:n.configuration.chainId,key:e}),a=g(this,d,"f").get(t)?.nonceTracker;if(!a)throw new Error(`Missing nonce tracker for network client ID - ${t}`);try{const t=await a.getNonceLock(e),n=()=>{t.releaseLock(),r?.()};return{...t,releaseLock:n}}catch(e){throw r?.(),e}}stopAllTracking(){for(const[e]of g(this,d,"f"))g(this,r,"m",f).call(this,e)}getNetworkClient({chainId:e,networkClientId:t}){if(!t&&!e)throw new Error("Cannot locate network client without networkClientId or chainId");let n,r=t;try{t&&(n=g(this,s,"f").call(this,t))}catch(n){if(T("No network client found with ID",t),!e)throw n}return!n&&e&&(r=g(this,a,"f").call(this,e),n=g(this,s,"f").call(this,r)),{...n,id:r}}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,r=new WeakSet,f=function(e){const t=g(this,d,"f").get(e);t&&(t.pendingTransactionTracker.stop(),g(this,o,"f").call(this,t.pendingTransactionTracker),g(this,d,"f").delete(e))},m=function(e){if(g(this,d,"f").get(e))return;const{provider:t,blockTracker:n,configuration:{chainId:r}}=g(this,s,"f").call(this,e),a=g(this,c,"f").call(this,{provider:t,blockTracker:n,chainId:r}),i=g(this,l,"f").call(this,{provider:t,blockTracker:n,chainId:r,networkClientId:e});g(this,d,"f").set(e,{nonceTracker:a,pendingTransactionTracker:i})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/MultichainTrackingHelper.cjs"}],[3079,{"../logger.cjs":3086,"../types.cjs":3087,"../utils/feature-flags.cjs":3093,"./TransactionPoller.cjs":3081,"@metamask/controller-utils":1488,events:4472,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T,E,y,S,I,k,A,C,_,P,v,N,R,j,O,x,L,M,F,D,B,G,U,H,q,W,$=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},K=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},V=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingTransactionTracker=void 0;const Y=e("@metamask/controller-utils"),z=V(e("events")),Q=e("lodash"),J=e("./TransactionPoller.cjs"),X=e("../logger.cjs"),Z=e("../types.cjs"),ee=e("../utils/feature-flags.cjs"),te=["replacement transaction underpriced","known transaction","gas price too low to replace","transaction with the same hash was already imported","gateway timeout","nonce too low"],ne=(0,X.createModuleLogger)(X.projectLogger,"pending-transactions");n.PendingTransactionTracker=class{constructor({blockTracker:e,getChainId:t,getEthQuery:n,getGlobalLock:I,getNetworkClientId:k,getTransactions:A,isTimeoutEnabled:C,hooks:_,isResubmitEnabled:P,messenger:v,publishTransaction:N}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),f.set(this,void 0),m.set(this,void 0),p.set(this,void 0),g.set(this,void 0),w.set(this,void 0),b.set(this,void 0),T.set(this,void 0),E.set(this,void 0),this.startIfPendingTransactions=()=>{const e=K(this,r,"m",x).call(this);e.length?K(this,r,"m",y).call(this,e):this.stop()},this.hub=new z.default,$(this,s,new Map,"f"),$(this,o,t,"f"),$(this,c,n,"f"),$(this,l,I,"f"),$(this,u,k,"f"),$(this,d,A,"f"),$(this,h,P??(()=>!0),"f"),$(this,f,new Map,"f"),$(this,m,K(this,r,"m",S).bind(this),"f"),$(this,g,v,"f"),$(this,w,N,"f"),$(this,b,!1,"f"),$(this,E,undefined,"f"),$(this,T,new J.TransactionPoller({blockTracker:e,chainId:t(),messenger:v}),"f"),$(this,a,_?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),$(this,i,C,"f"),$(this,p,(0,X.createModuleLogger)(ne,`${t()}:${k()}`),"f")}addTransactionToPoll(e){K(this,r,"m",y).call(this,[e]),$(this,E,e,"f")}async forceCheckTransaction(e){const t=await K(this,l,"f").call(this);try{await K(this,r,"m",v).call(this,e)}catch(e){K(this,p,"f").call(this,"Failed to check transaction",e)}finally{t()}}stop(){K(this,b,"f")&&(K(this,T,"f").stop(),$(this,b,!1,"f"),K(this,p,"f").call(this,"Stopped polling"))}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,w=new WeakMap,b=new WeakMap,T=new WeakMap,E=new WeakMap,r=new WeakSet,y=function(e){K(this,T,"f").setPendingTransactions(e),K(this,b,"f")||(K(this,T,"f").start(K(this,m,"f")),$(this,b,!0,"f"),K(this,p,"f").call(this,"Started polling"))},S=async function(e){const t=await K(this,l,"f").call(this);try{await K(this,r,"m",I).call(this)}catch(e){K(this,p,"f").call(this,"Failed to check transactions",e)}finally{t()}try{await K(this,r,"m",k).call(this,e)}catch(e){K(this,p,"f").call(this,"Failed to resubmit transactions",e)}},I=async function(){K(this,p,"f").call(this,"Checking transactions");const e=[...K(this,r,"m",x).call(this),...K(this,E,"f")?[K(this,E,"f")]:[]];e.length?(K(this,p,"f").call(this,"Found pending transactions to check",{count:e.length,ids:e.map(e=>e.id)}),await Promise.all(e.map(e=>K(this,r,"m",v).call(this,e)))):K(this,p,"f").call(this,"No pending transactions to check")},k=async function(e){if(!K(this,h,"f").call(this)||!K(this,b,"f"))return;K(this,p,"f").call(this,"Resubmitting transactions");const t=K(this,r,"m",x).call(this);if(t.length){K(this,p,"f").call(this,"Found pending transactions to resubmit",{count:t.length,ids:t.map(e=>e.id)});for(const n of t)try{await K(this,r,"m",C).call(this,n,e)}catch(e){const t=e.value?.message?.toLowerCase()??e.message?.toLowerCase()??String(e);if(K(this,r,"m",A).call(this,t)){K(this,p,"f").call(this,"Ignoring known transaction error",t);continue}K(this,r,"m",L).call(this,n,e.message,"There was an error when resubmitting this transaction.")}}else K(this,p,"f").call(this,"No pending transactions to resubmit")},A=function(e){return te.some(t=>e.includes(t))},C=async function(e,t){if(!K(this,r,"m",_).call(this,e,t))return;if(!await K(this,a,"f").call(this,e))return;const n=K(this,c,"f").call(this,e.networkClientId);await K(this,w,"f").call(this,n,e);const s=(e.retryCount??0)+1;K(this,r,"m",D).call(this,(0,Q.merge)({},e,{retryCount:s}),"PendingTransactionTracker:transaction-retry - Retry count increased")},_=function(e,t){const n=(0,Q.cloneDeep)(e);n.firstRetryBlockNumber||(n.firstRetryBlockNumber=t,K(this,r,"m",D).call(this,n,"PendingTransactionTracker:#isResubmitDue - First retry block number set"));const{firstRetryBlockNumber:a}=n,s=Number.parseInt(t,16)-Number.parseInt(a,16),i=e.retryCount??0;return s>=Math.min(50,Math.pow(2,i))},P=function(e){const{hash:t,id:n}=e;K(this,E,"f")?.id===n&&$(this,E,undefined,"f"),t&&K(this,f,"f").delete(t)},v=async function(e){const{hash:t,id:n,isIntentComplete:s,txParams:{from:i}}=e;if(s)await K(this,r,"m",N).call(this,e);else{if(!t&&await K(this,a,"f").call(this,e)){const t=new Error("We had an error while submitting this transaction, please try again.");return t.name="NoTxHashError",void K(this,r,"m",M).call(this,e,t)}if(K(this,r,"m",O).call(this,e))return K(this,p,"f").call(this,"Nonce already taken",n),void K(this,r,"m",F).call(this,e);try{const n=await K(this,r,"m",B).call(this,t),a="0x1"===n?.status;if("0x0"===n?.status)return K(this,p,"f").call(this,"Transaction receipt has failed status"),void K(this,r,"m",M).call(this,e,new Error("Transaction failed on-chain"));const{blockNumber:s,blockHash:o}=n??{};if(a&&s&&o)return void await K(this,r,"m",N).call(this,e,{...n,blockNumber:s,blockHash:o});K(this,p,"f").call(this,"No receipt status",{hash:t,receipt:n});const c=await K(this,r,"m",H).call(this,i),l=parseInt(c,16);if(!n&&await K(this,r,"m",R).call(this,e,l))return;await K(this,r,"m",j).call(this,e,l)&&K(this,r,"m",F).call(this,e)}catch(t){K(this,p,"f").call(this,"Failed to check transaction",n,t),K(this,r,"m",L).call(this,e,t.message,"There was a problem loading this transaction.")}}},N=async function(e,t){const{id:n}=e,{blockHash:a}=t??{};K(this,p,"f").call(this,"Transaction confirmed",n);const s=K(this,E,"f")?.id===n;if(K(this,r,"m",P).call(this,e),s)return void this.hub.emit("transaction-confirmed",e);const i=(0,Q.cloneDeep)(e);if(t&&a){const{baseFeePerGas:e,timestamp:n}=await K(this,r,"m",U).call(this,a,!1);i.baseFeePerGas=e,i.blockTimestamp=n,i.txParams={...i.txParams,gasUsed:t.gasUsed},i.txReceipt=t,i.verifiedOnBlockchain=!0}i.status=Z.TransactionStatus.confirmed,K(this,r,"m",D).call(this,i,"PendingTransactionTracker:#onTransactionConfirmed - Transaction confirmed"),this.hub.emit("transaction-confirmed",i)},R=async function(e,t){const{chainId:n,hash:a,id:s,submittedTime:o,txParams:{nonce:c}}=e;if(!a||!c)return!1;if(!K(this,i,"f").call(this,e))return K(this,p,"f").call(this,"Timeout disabled for transaction",e),!1;const l=(0,ee.getTimeoutAttempts)(n,K(this,g,"f"));if(l===undefined||0===l)return K(this,p,"f").call(this,"Timeout disabled due to threshold",{chainId:n,threshold:l}),!1;const u=parseInt(c,16);if(u>t)return K(this,p,"f").call(this,"Skipping timeout as queued transaction",{transactionNonce:u,nextNonce:t}),!1;try{if(null!==await K(this,r,"m",G).call(this,a)){const e=Date.now();return K(this,p,"f").call(this,"Transaction found on network, recording timestamp",s),K(this,f,"f").set(a,e),!1}const t=K(this,f,"f").get(a)??o;if(t===undefined)return K(this,p,"f").call(this,"Transaction not yet seen on network and has no submitted time, skipping timeout check",s),!1;const{blockTime:i}=(0,ee.getAcceleratedPollingParams)(n,K(this,g,"f")),c=Date.now()-t,u=i*l;return K(this,p,"f").call(this,"Checking timeout duration",{transactionId:s,durationSinceLastSeen:c,timeoutDuration:u,threshold:l,blockTime:i}),c<u?!1:(K(this,p,"f").call(this,"Hit timeout duration threshold",s),K(this,f,"f").delete(a),K(this,r,"m",M).call(this,e,new Error("Transaction not found on network after timeout")),!0)}catch(e){return K(this,p,"f").call(this,"Failed to check transaction by hash",s,e),!1}},j=async function(e,t){const{hash:n,id:r,txParams:{nonce:a}}=e;if(!a||!n)return!1;if(parseInt(a,16)>=t)return!1;let i=K(this,s,"f").get(n);return i===undefined&&(i=0,K(this,s,"f").set(n,i)),i<3?(K(this,p,"f").call(this,"Incrementing dropped block count",{id:r,droppedBlockCount:i}),K(this,s,"f").set(n,i+1),!1):(K(this,p,"f").call(this,"Hit dropped block count",r),K(this,s,"f").delete(n),!0)},O=function(e){const{id:t,txParams:n}=e;return K(this,r,"m",q).call(this).some(e=>e.id!==t&&e.txParams.from===n.from&&e.status===Z.TransactionStatus.confirmed&&e.txParams.nonce&&e.txParams.nonce===n.nonce&&e.type!==Z.TransactionType.incoming&&e.isTransfer===undefined)},x=function(){return K(this,r,"m",W).call(this).filter(e=>e.status===Z.TransactionStatus.submitted&&!e.verifiedOnBlockchain&&!e.isUserOperation&&!e.isStateOnly)},L=function(e,t,n){K(this,r,"m",D).call(this,{...e,warning:{error:t,message:n}},"PendingTransactionTracker:#warnTransaction - Warning added")},M=function(e,t){K(this,p,"f").call(this,"Transaction failed",e.id,t),K(this,r,"m",P).call(this,e),this.hub.emit("transaction-failed",e,t)},F=function(e){K(this,p,"f").call(this,"Transaction dropped",e.id),K(this,r,"m",P).call(this,e),this.hub.emit("transaction-dropped",e)},D=function(e,t){this.hub.emit("transaction-updated",e,t)},B=async function(e){return await(0,Y.query)(K(this,c,"f").call(this),"getTransactionReceipt",[e])},G=async function(e){return await(0,Y.query)(K(this,c,"f").call(this),"getTransactionByHash",[e])},U=async function(e,t){return await(0,Y.query)(K(this,c,"f").call(this),"getBlockByHash",[e,t])},H=async function(e){return await(0,Y.query)(K(this,c,"f").call(this),"getTransactionCount",[e])},q=function(){const e=K(this,o,"f").call(this);return K(this,d,"f").call(this).filter(t=>t.chainId===e)},W=function(){const e=K(this,u,"f").call(this);return K(this,d,"f").call(this).filter(t=>t.networkClientId===e)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/PendingTransactionTracker.cjs"}],[3080,{"../logger.cjs":3086,"../types.cjs":3087,"../utils/utils.cjs":3106,"@metamask/utils":3207,"bn.js":4115,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.hasSimulationDataChanged=n.shouldResimulate=n.ResimulateHelper=n.RESIMULATE_INTERVAL_MS=n.BLOCK_TIME_ADDITIONAL_SECONDS=n.VALUE_COMPARISON_PERCENT_THRESHOLD=n.BLOCKAID_RESULT_TYPE_MALICIOUS=n.RESIMULATE_PARAMS=void 0;const m=e("@metamask/utils"),p=e("bn.js"),g=e("lodash"),w=e("../logger.cjs"),b=e("../types.cjs"),T=e("../utils/utils.cjs"),E=(0,w.createModuleLogger)(w.projectLogger,"resimulate-helper");n.RESIMULATE_PARAMS=["to","value","data"],n.BLOCKAID_RESULT_TYPE_MALICIOUS="Malicious",n.VALUE_COMPARISON_PERCENT_THRESHOLD=5,n.BLOCK_TIME_ADDITIONAL_SECONDS=60,n.RESIMULATE_INTERVAL_MS=3e3;function y(e,t){return!S(e?.difference??"0x0",t?.difference??"0x0",!1===e?.isDecrease,!1===t?.isDecrease)}function S(e,t,r,a){let s=new p.BN((0,m.remove0x)(e),"hex"),i=new p.BN((0,m.remove0x)(t),"hex");return r&&(s=s.neg()),a&&(i=i.neg()),(0,T.getPercentageChange)(s,i)<=n.VALUE_COMPARISON_PERCENT_THRESHOLD}n.ResimulateHelper=class{constructor({getTransactions:e,simulateTransaction:t,onTransactionsUpdate:n}){r.add(this),a.set(this,new Map),s.set(this,void 0),i.set(this,void 0),h(this,s,e,"f"),h(this,i,t,"f"),n(f(this,r,"m",o).bind(this))}},a=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakSet,o=function(){const e=f(this,s,"f").call(this).filter(e=>e.status===b.TransactionStatus.unapproved),t=new Set(e.map(e=>e.id));new Set([...t,...f(this,a,"f").keys()]).forEach(t=>{const n=e.find(e=>e.id===t);n?.isActive?f(this,r,"m",c).call(this,n):f(this,r,"m",u).call(this,t)})},c=function(e){const{id:t}=e;if(f(this,a,"f").has(t))return;const s=()=>{f(this,i,"f").call(this,e).catch(e=>{E("Error during transaction resimulation",e)}).finally(()=>{f(this,a,"f").has(t)&&f(this,r,"m",l).call(this,t,s)})};f(this,r,"m",l).call(this,t,s),E(`Started resimulating transaction ${t} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`)},l=function(e,t){const r=setTimeout(t,n.RESIMULATE_INTERVAL_MS);f(this,a,"f").set(e,r)},u=function(e){f(this,a,"f").has(e)&&(f(this,r,"m",d).call(this,e),E(`Stopped resimulating transaction ${e} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`))},d=function(e){const t=f(this,a,"f").get(e);t&&(clearTimeout(t),f(this,a,"f").delete(e))},n.shouldResimulate=function(e,t){const{id:r}=t,a=function(e,t){const{id:r,txParams:a}=t,{txParams:s}=e;if(!s||(0,g.isEqual)(s,a))return!1;const i=Object.keys(a).filter(e=>a[e]!==s[e]);return E("Transaction parameters updated",{transactionId:r,updatedProperties:i,originalParams:s,newParams:a}),n.RESIMULATE_PARAMS.some(e=>i.includes(e))}(e,t),s=function(e,t){const{securityAlertResponse:r}=e,{id:a,securityAlertResponse:s}=t;if((0,g.isEqual)(r,s))return!1;return E("Security alert updated",{transactionId:a,originalSecurityAlertResponse:r,newSecurityAlertResponse:s}),s?.result_type===n.BLOCKAID_RESULT_TYPE_MALICIOUS}(e,t),i=function(e,t){const{simulationData:n}=e,{simulationData:r,txParams:a}=t;if(!r||(0,g.isEqual)(n,r))return!1;return!S(a?.value??"0x0",r?.nativeBalanceChange?.difference??"0x0",!1,!1===r?.nativeBalanceChange?.isDecrease)}(e,t),o=a||s||i;let c;if(s||i){c=Math.floor(Date.now()/1e3)+n.BLOCK_TIME_ADDITIONAL_SECONDS}return o&&E("Transaction should be resimulated",{transactionId:r,blockTime:c,parametersUpdated:a,securityAlert:s,valueAndNativeBalanceMismatch:i}),{blockTime:c,resimulate:o}},n.hasSimulationDataChanged=function(e,t){if((0,g.isEqual)(e,t))return!1;if(y(e?.nativeBalanceChange,t?.nativeBalanceChange))return E("Simulation data native balance changed"),!0;if(e.tokenBalanceChanges.length!==t.tokenBalanceChanges.length)return!0;for(const n of e.tokenBalanceChanges){const e=t.tokenBalanceChanges.find(({address:e,id:t})=>e===n.address&&t===n.id);if(!e)return E("Missing new token balance",{address:n.address,id:n.id}),!0;if(y(n,e))return E("Simulation data token balance changed",{originalTokenBalanceChange:n,newTokenBalanceChange:e}),!0}return!1}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/ResimulateHelper.cjs"}],[3081,{"../logger.cjs":3086,"../utils/feature-flags.cjs":3093,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},b=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPoller=void 0;const T=e("@metamask/utils"),E=e("lodash"),y=e("../logger.cjs"),S=e("../utils/feature-flags.cjs"),I=(0,T.createModuleLogger)(y.projectLogger,"transaction-poller");n.TransactionPoller=class{constructor({blockTracker:e,chainId:t,messenger:n}){r.add(this),a.set(this,0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,!1),h.set(this,void 0),w(this,s,e,"f"),w(this,i,t,"f"),w(this,o,n,"f")}start(e){b(this,d,"f")||(w(this,l,e,"f"),w(this,d,!0,"f"),b(this,r,"m",f).call(this),I("Started"))}stop(){b(this,d,"f")&&(w(this,d,!1,"f"),w(this,l,undefined,"f"),w(this,a,0,"f"),w(this,u,undefined,"f"),b(this,r,"m",p).call(this),b(this,r,"m",g).call(this),I("Stopped"))}setPendingTransactions(e){const t=(b(this,u,"f")??[]).map(e=>e.id);w(this,u,e,"f");const n=e.map(e=>e.id),s=!(0,E.isEqual)(t,n);b(this,d,"f")&&s&&(I("Detected new pending transactions",n),w(this,a,0,"f"),b(this,c,"f")&&(b(this,r,"m",g).call(this),b(this,r,"m",f).call(this)))}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,r=new WeakSet,f=function e(){if(!b(this,d,"f"))return;const{countMax:t,intervalMs:n}=(0,S.getAcceleratedPollingParams)(b(this,i,"f"),b(this,o,"f"));if(b(this,a,"f")>=t)return w(this,c,e=>b(this,r,"m",m).call(this,!1,e),"f"),b(this,s,"f").on("latest",b(this,c,"f")),void I("Added block tracker listener");b(this,r,"m",p).call(this),w(this,h,setTimeout(async()=>{await b(this,r,"m",m).call(this,!0),b(this,r,"m",e).call(this)},n),"f")},m=async function(e,t){e?I("Accelerated interval",b(this,a,"f")+1):I("Block tracker interval",t);const n=t??await b(this,s,"f").getLatestBlock();await(b(this,l,"f")?.call(this,n)),e&&b(this,d,"f")&&w(this,a,b(this,a,"f")+1,"f")},p=function(){b(this,h,"f")&&(clearTimeout(b(this,h,"f")),w(this,h,undefined,"f"))},g=function(){b(this,c,"f")&&(b(this,s,"f").removeListener("latest",b(this,c,"f")),w(this,c,undefined,"f"))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/TransactionPoller.cjs"}],[3082,{"../logger.cjs":3086,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.CollectPublishHook=void 0;const u=e("@metamask/utils"),d=e("lodash"),h=e("../logger.cjs"),f=(0,u.createModuleLogger)(h.projectLogger,"collect-publish-hook");n.CollectPublishHook=class{constructor(e){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),c(this,i,(0,u.createDeferredPromise)(),"f"),c(this,a,[],"f"),c(this,s,e,"f")}getHook(){return l(this,r,"m",o).bind(this)}ready(){return l(this,i,"f").promise}success(e){if(f("Success",{transactionHashes:e}),e.length!==l(this,s,"f"))throw new Error("Transaction hash count mismatch");for(let t=0;t<l(this,a,"f").length;t++){const n=l(this,a,"f")[t],r=e[t];n.promise.resolve({transactionHash:r})}}error(e){f("Error",{error:e});for(const t of l(this,a,"f"))t.promise.reject(e)}},a=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakSet,o=function(e,t){const n=e.txParams.nonce??"0x0",r=parseInt(n,16);f("Processing transaction",{nonce:r,signedTx:t,transactionMeta:e});const o=(0,u.createDeferredPromise)();if(l(this,a,"f").push({nonce:r,promise:o,signedTransaction:t}),c(this,a,(0,d.sortBy)(l(this,a,"f"),e=>e.nonce),"f"),l(this,a,"f").length===l(this,s,"f")){f("All transactions signed");const e=l(this,a,"f").map(e=>e.signedTransaction);l(this,i,"f").resolve({signedTransactions:e})}return o.promise}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/CollectPublishHook.cjs"}],[3083,{"../logger.cjs":3086,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ExtraTransactionsPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),h=(0,u.createModuleLogger)(d.projectLogger,"extra-transactions-publish-hook");n.ExtraTransactionsPublishHook=class{constructor({addTransactionBatch:e,getTransaction:t,originalPublishHook:n}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),c(this,a,e,"f"),c(this,s,t,"f"),c(this,i,n,"f")}getHook(){return l(this,r,"m",o).bind(this)}},a=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakSet,o=async function(e,t){h("Publishing transaction as batch",{transactionMeta:e,signedTx:t});const{batchTransactions:n,batchTransactionsOptions:r,id:o,networkClientId:c,txParams:d}=e,f=d.from,m=d.to,p=d.data,g=d.value,w=d.gas,b=d.maxFeePerGas,T=d.maxPriorityFeePerGas,E=t,y=(0,u.createDeferredPromise)(),S={existingTransaction:{id:o,onPublish:({newSignature:e,transactionHash:t})=>{if(e){const t=l(this,s,"f").call(this,o);return h("Calling original publish hook with new signature",{latestTransactionMeta:t,newSignature:e}),void l(this,i,"f").call(this,t,e).then(y.resolve).catch(y.reject)}y.resolve({transactionHash:t})},signedTransaction:E},params:{data:p,gas:w,maxFeePerGas:b,maxPriorityFeePerGas:T,to:m,value:g}},I=(n??[]).map(e=>{const{isAfter:t,type:n,...r}=e;return{isAfter:t,params:r,type:n}}),k=[...I.filter(e=>!1===e.isAfter).map(({isAfter:e,...t})=>({...t})),S,...I.filter(e=>e.isAfter===undefined||e.isAfter).map(({isAfter:e,...t})=>({...t}))];h("Adding transaction batch",{from:f,networkClientId:c,transactions:k});const A=r??{disable7702:!0,disableHook:!1,disableSequential:!0};return await l(this,a,"f").call(this,{from:f,networkClientId:c,requireApproval:!1,transactions:k,...A}),y.promise}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/ExtraTransactionsPublishHook.cjs"}],[3084,{"../logger.cjs":3086,"@metamask/rpc-errors":2692,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialPublishBatchHook=void 0;const g=e("@metamask/rpc-errors"),w=e("@metamask/utils"),b=e("../logger.cjs"),T=(0,w.createModuleLogger)(b.projectLogger,"sequential-publish-batch-hook");n.SequentialPublishBatchHook=class{constructor({publishTransaction:e,getTransaction:t,getPendingTransactionTracker:n,getEthQuery:l}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,{}),m(this,a,e,"f"),m(this,s,t,"f"),m(this,i,l,"f"),m(this,o,n,"f")}getHook(){return p(this,r,"m",l).bind(this)}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,r=new WeakSet,l=async function({from:e,networkClientId:t,transactions:n}){T("Starting sequential publish batch hook",{from:e,networkClientId:t});const c=p(this,o,"f").call(this,t),l=[];for(const e of n)try{const n=p(this,s,"f").call(this,String(e.id)),o=await p(this,a,"f").call(this,p(this,i,"f").call(this,t),n);T("Transaction published",{transactionHash:o});const d={...n,hash:o},h=p(this,r,"m",u).call(this,c,d.id,d.hash);c.addTransactionToPoll(d),await h,l.push({transactionHash:o})}catch(t){throw T("Batch transaction failed",{transaction:e,error:t}),c.stop(),g.rpcErrors.internal("Failed to publish batch transaction")}return T("Sequential publish batch hook completed",{results:l}),c.stop(),{results:l}},u=async function(e,t,n){return new Promise((a,s)=>{const i=p(this,r,"m",d).bind(this,t,n,a,e),o=p(this,r,"m",h).bind(this,t,n,s,e);p(this,c,"f")[t]={onConfirmed:i,onFailedOrDropped:o},e.hub.on("transaction-confirmed",i),e.hub.on("transaction-failed",o),e.hub.on("transaction-dropped",o)})},d=function(e,t,n,a,s){s.id===e&&(T("Transaction confirmed",{transactionHash:t}),p(this,r,"m",f).call(this,a,e),n(s))},h=function(e,t,n,a,s,i){s.id===e&&(T("Transaction failed or dropped",{transactionHash:t,error:i}),p(this,r,"m",f).call(this,a,e),n(new Error(`Transaction ${t} failed or dropped.`)))},f=function(e,t){const n=p(this,c,"f")[t];e.hub.off("transaction-confirmed",n.onConfirmed),e.hub.off("transaction-failed",n.onFailedOrDropped),e.hub.off("transaction-dropped",n.onFailedOrDropped),delete p(this,c,"f")[t]}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/SequentialPublishBatchHook.cjs"}],[3085,{"./TransactionController.cjs":3062,"./constants.cjs":3065,"./helpers/AccountsApiRemoteTransactionSource.cjs":3074,"./types.cjs":3087,"./utils/gas-flow.cjs":3097,"./utils/prepare.cjs":3101,"./utils/transaction-type.cjs":3105,"./utils/utils.cjs":3106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.HARDFORK=n.INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS=n.CHAIN_IDS=n.normalizeTransactionParams=n.isEIP1559Transaction=n.mergeGasFeeEstimates=n.determineTransactionType=n.WalletDevice=n.UserFeeLevel=n.TransactionType=n.TransactionStatus=n.TransactionEnvelopeType=n.TransactionContainerType=n.SimulationTokenStandard=n.SimulationErrorCode=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.TransactionController=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;var r=e("./TransactionController.cjs");Object.defineProperty(n,"CANCEL_RATE",{enumerable:!0,get:function(){return r.CANCEL_RATE}}),Object.defineProperty(n,"SPEED_UP_RATE",{enumerable:!0,get:function(){return r.SPEED_UP_RATE}}),Object.defineProperty(n,"TransactionController",{enumerable:!0,get:function(){return r.TransactionController}});var a=e("./types.cjs");Object.defineProperty(n,"GasFeeEstimateLevel",{enumerable:!0,get:function(){return a.GasFeeEstimateLevel}}),Object.defineProperty(n,"GasFeeEstimateType",{enumerable:!0,get:function(){return a.GasFeeEstimateType}}),Object.defineProperty(n,"SimulationErrorCode",{enumerable:!0,get:function(){return a.SimulationErrorCode}}),Object.defineProperty(n,"SimulationTokenStandard",{enumerable:!0,get:function(){return a.SimulationTokenStandard}}),Object.defineProperty(n,"TransactionContainerType",{enumerable:!0,get:function(){return a.TransactionContainerType}}),Object.defineProperty(n,"TransactionEnvelopeType",{enumerable:!0,get:function(){return a.TransactionEnvelopeType}}),Object.defineProperty(n,"TransactionStatus",{enumerable:!0,get:function(){return a.TransactionStatus}}),Object.defineProperty(n,"TransactionType",{enumerable:!0,get:function(){return a.TransactionType}}),Object.defineProperty(n,"UserFeeLevel",{enumerable:!0,get:function(){return a.UserFeeLevel}}),Object.defineProperty(n,"WalletDevice",{enumerable:!0,get:function(){return a.WalletDevice}});var s=e("./utils/transaction-type.cjs");Object.defineProperty(n,"determineTransactionType",{enumerable:!0,get:function(){return s.determineTransactionType}});var i=e("./utils/gas-flow.cjs");Object.defineProperty(n,"mergeGasFeeEstimates",{enumerable:!0,get:function(){return i.mergeGasFeeEstimates}});var o=e("./utils/utils.cjs");Object.defineProperty(n,"isEIP1559Transaction",{enumerable:!0,get:function(){return o.isEIP1559Transaction}}),Object.defineProperty(n,"normalizeTransactionParams",{enumerable:!0,get:function(){return o.normalizeTransactionParams}});var c=e("./constants.cjs");Object.defineProperty(n,"CHAIN_IDS",{enumerable:!0,get:function(){return c.CHAIN_IDS}});var l=e("./helpers/AccountsApiRemoteTransactionSource.cjs");Object.defineProperty(n,"INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS",{enumerable:!0,get:function(){return l.SUPPORTED_CHAIN_IDS}});var u=e("./utils/prepare.cjs");Object.defineProperty(n,"HARDFORK",{enumerable:!0,get:function(){return u.HARDFORK}})}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/index.cjs"}],[3086,{"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.incomingTransactionsLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("transaction-controller"),n.incomingTransactionsLogger=(0,r.createModuleLogger)(n.projectLogger,"incoming-transactions")}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/logger.cjs"}],[3087,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h;Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationErrorCode=n.SimulationTokenStandard=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.UserFeeLevel=n.TransactionEnvelopeType=n.TransactionContainerType=n.TransactionType=n.WalletDevice=n.TransactionStatus=void 0,function(e){e.unapproved="unapproved",e.approved="approved",e.signed="signed",e.submitted="submitted",e.confirmed="confirmed",e.failed="failed",e.dropped="dropped",e.rejected="rejected",e.cancelled="cancelled"}(r||(n.TransactionStatus=r={})),function(e){e.MM_MOBILE="metamask_mobile",e.MM_EXTENSION="metamask_extension",e.OTHER="other_device"}(a||(n.WalletDevice=a={})),function(e){e.batch="batch",e.bridge="bridge",e.bridgeApproval="bridgeApproval",e.cancel="cancel",e.contractInteraction="contractInteraction",e.deployContract="contractDeployment",e.ethDecrypt="eth_decrypt",e.ethGetEncryptionPublicKey="eth_getEncryptionPublicKey",e.gasPayment="gas_payment",e.incoming="incoming",e.lendingDeposit="lendingDeposit",e.lendingWithdraw="lendingWithdraw",e.musdConversion="musdConversion",e.perpsDeposit="perpsDeposit",e.personalSign="personal_sign",e.predictBuy="predictBuy",e.predictClaim="predictClaim",e.predictDeposit="predictDeposit",e.predictSell="predictSell",e.predictWithdraw="predictWithdraw",e.relayDeposit="relayDeposit",e.retry="retry",e.revokeDelegation="revokeDelegation",e.simpleSend="simpleSend",e.signTypedData="eth_signTypedData",e.smart="smart",e.stakingClaim="stakingClaim",e.stakingDeposit="stakingDeposit",e.stakingUnstake="stakingUnstake",e.swap="swap",e.swapAndSend="swapAndSend",e.swapApproval="swapApproval",e.tokenMethodApprove="approve",e.tokenMethodSafeTransferFrom="safetransferfrom",e.tokenMethodTransfer="transfer",e.tokenMethodTransferFrom="transferfrom",e.tokenMethodSetApprovalForAll="setapprovalforall",e.tokenMethodIncreaseAllowance="increaseAllowance",e.shieldSubscriptionApprove="shieldSubscriptionApprove"}(s||(n.TransactionType=s={})),function(e){e.EnforcedSimulations="enforcedSimulations"}(i||(n.TransactionContainerType=i={})),function(e){e.legacy="0x0",e.accessList="0x1",e.feeMarket="0x2",e.setCode="0x4"}(o||(n.TransactionEnvelopeType=o={})),function(e){e.CUSTOM="custom",e.DAPP_SUGGESTED="dappSuggested",e.MEDIUM="medium"}(c||(n.UserFeeLevel=c={})),function(e){e.Low="low",e.Medium="medium",e.High="high"}(l||(n.GasFeeEstimateLevel=l={})),function(e){e.FeeMarket="fee-market",e.Legacy="legacy",e.GasPrice="eth_gasPrice"}(u||(n.GasFeeEstimateType=u={})),function(e){e.erc20="erc20",e.erc721="erc721",e.erc1155="erc1155"}(d||(n.SimulationTokenStandard=d={})),function(e){e.ChainNotSupported="chain-not-supported",e.Disabled="disabled",e.InvalidResponse="invalid-response",e.Reverted="reverted"}(h||(n.SimulationErrorCode=h={}))}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/types.cjs"}],[3088,{"../api/simulation-api.cjs":3064,"../constants.cjs":3065,"../errors.cjs":3066,"../logger.cjs":3086,"../types.cjs":3087,"./balance.cjs":3089,"@ethersproject/abi":748,"@metamask/controller-utils":1488,"@metamask/metamask-eth-abis":2370,"@metamask/utils":3207,"bn.js":4115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getBalanceChanges=n.SupportedToken=void 0;const a=e("@ethersproject/abi"),s=e("@metamask/controller-utils"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=r(e("bn.js")),l=e("./balance.cjs"),u=e("../api/simulation-api.cjs"),d=e("../constants.cjs"),h=e("../errors.cjs"),f=e("../logger.cjs"),m=e("../types.cjs");var p;!function(e){e.ERC20="erc20",e.ERC721="erc721",e.ERC1155="erc1155",e.ERC20_WRAPPED="erc20Wrapped",e.ERC721_LEGACY="erc721Legacy"}(p||(n.SupportedToken=p={}));const g=(0,o.createModuleLogger)(f.projectLogger,"balance-changes"),w=["Transfer","TransferSingle","TransferBatch","Deposit","Withdrawal"],b={[p.ERC20]:{abi:i.abiERC20,standard:m.SimulationTokenStandard.erc20},[p.ERC721]:{abi:i.abiERC721,standard:m.SimulationTokenStandard.erc721},[p.ERC1155]:{abi:i.abiERC1155,standard:m.SimulationTokenStandard.erc1155},[p.ERC20_WRAPPED]:{abi:d.ABI_SIMULATION_ERC20_WRAPPED,standard:m.SimulationTokenStandard.erc20},[p.ERC721_LEGACY]:{abi:d.ABI_SIMULATION_ERC721_LEGACY,standard:m.SimulationTokenStandard.erc721}},T=["execution reverted","insufficient funds for gas"];function E(e){if(Array.isArray(e))return e.map(E);let t=e;return t=t.toHexString?.()??t,t=t.toLowerCase?.()??t,t}function y(e){return"Transfer"===e.name&&e.tokenStandard===m.SimulationTokenStandard.erc721&&0===parseInt(e.args.from,16)}function S(e){return e.tokenStandard===m.SimulationTokenStandard.erc721?[e.args.tokenId]:e.tokenStandard===m.SimulationTokenStandard.erc1155&&"TransferSingle"===e.name?[e.args.id]:e.tokenStandard===m.SimulationTokenStandard.erc1155&&"TransferBatch"===e.name?e.args.ids:[undefined]}function I(e){switch(e){case m.SimulationTokenStandard.erc721:return new a.Interface(i.abiERC721);case m.SimulationTokenStandard.erc1155:return new a.Interface(i.abiERC1155);default:return new a.Interface(i.abiERC20)}}function k(e,t,n){const r=I(t.standard);try{if(t.standard===m.SimulationTokenStandard.erc721){const t=r.decodeFunctionResult("ownerOf",n.return);return t[0].toLowerCase()===e.toLowerCase()?"0x1":"0x0"}const a=r.decodeFunctionResult("balanceOf",n.return);return(0,s.toHex)(a[0])}catch(e){throw g("Failed to decode balance transaction",e,{token:t,response:n}),new h.SimulationError(`Failed to decode balance transaction for token ${t.address}: ${String(e)}`)}}function A(e,t,n){const r=I(e);switch(e){case m.SimulationTokenStandard.erc721:return r.encodeFunctionData("ownerOf",[n]);case m.SimulationTokenStandard.erc1155:return r.encodeFunctionData("balanceOf",[t,n]);default:return r.encodeFunctionData("balanceOf",[t])}}function C(e){return[...e.logs??[],...(e.calls??[]).map(e=>C(e)).flat()]}function _(e,t,n=0){const r=(0,s.hexToBN)(t).add(new c.default(n)),a=(0,s.hexToBN)(e),i=r.sub(a),o=i.isNeg(),l=(0,s.toHex)(i.abs());return i.isZero()?(g("Balance change is zero"),undefined):{previousBalance:e,newBalance:(0,s.toHex)(r),difference:l,isDecrease:o}}async function P({request:e,params:t,before:n=[],after:r=[]}){const{blockTime:a,chainId:i,ethQuery:o,getSimulationConfig:d,txParams:h}=e,{authorizationList:f}=h,m=h.from,p=f?.map(e=>({address:e.address,from:m})),w=[...n,{authorizationList:p,data:h.data,from:h.from,gas:h.gas,maxFeePerGas:h.maxFeePerGas??h.gasPrice,maxPriorityFeePerGas:h.maxPriorityFeePerGas??h.gasPrice,to:h.to,value:h.value},...r],b=function(e){const{txParams:t}=e,n=(0,s.hexToBN)(t.gas??"0x0"),r=(0,s.hexToBN)(t.maxFeePerGas??t.gasPrice??"0x0"),a=(0,s.hexToBN)(t.value??"0x0"),i=(e.nestedTransactions??[]).map(e=>(0,s.hexToBN)(e.value??"0x0")).reduce((e,t)=>e.add(t),new c.default(0));return n.mul(r).add(a).add(i)}(e),T=(0,s.toHex)(b);g("Required balance",T);const{balanceRaw:E}=await(0,l.getNativeBalance)(m,o),y=(0,s.toHex)(E),S=(0,s.hexToBN)(y);g("Current balance",y);const I=S.lt(b);return await(0,u.simulateTransactions)(i,{...t,getSimulationConfig:d,transactions:w,withGas:!0,withDefaultBlockOverrides:!0,...a&&{blockOverrides:{...t?.blockOverrides,time:(0,s.toHex)(a)}},...I&&{overrides:{...t?.overrides,[m]:{...t?.overrides?.[m],balance:T}}}})}n.getBalanceChanges=async function(e){g("Request",e);try{const t=await P({request:e,params:{withCallTrace:!0,withLogs:!0}}),n=t.transactions?.[0]?.error;if(n)throw new h.SimulationError(n);const r=function(e,t){const n=t.transactions[0];if(!n)return undefined;const{txParams:r}=e,a=r.from,{stateDiff:s}=n,i=s?.pre?.[a]?.balance,o=s?.post?.[a]?.balance;if(!i||!o)return undefined;return _(i,o,n.gasCost)}(e,t),s=function(e){const t=C(e.transactions[0]?.callTrace??{});g("Extracted logs",t);const n=function(){const e=Object.values(p);return new Map(e.map(e=>{const{abi:t}=b[e];return[e,new a.Interface(t)]}))}();return t.map(e=>{const t=function(e,t){const n=Object.values(p);for(const r of n)try{const n=t.get(r),{abi:a,standard:s}=b[r];return{...n.parseLog(e),abi:a,standard:s}}catch{continue}return undefined}(e,n);if(!t)return g("Failed to parse log",e),undefined;const r=t.abi.find(e=>e.name===t.name)?.inputs;if(!r)return g("Failed to find inputs for event",t),undefined;if(!w.includes(t.name))return g("Ignoring unsupported event",t.name,t),undefined;g("Normalizing event args",t.name,t);const a=function(e,t){return e.reduce((e,n,r)=>{const a=t[r].name.replace("_",""),s=E(n);return e[a]=s,e},{})}(t.args,r);return{contractAddress:e.address,tokenStandard:t.standard,name:t.name,args:a,abi:t.abi}}).filter(e=>e!==undefined)}(t);g("Parsed events",s);const i=await async function(e,t){const{txParams:n}=e,r=n.from,a=function(e,t){const n=new Set,r=new Map,a=new Map,s=e.txParams.from,i=t.filter(e=>[e.args.from,e.args.to].includes(s));g("Filtered user events",i);for(const e of i){const t=S(e);g("Extracted token IDs",t);for(const i of t){const t={address:e.contractAddress,standard:e.tokenStandard,id:i},o=JSON.stringify(t);if(n.has(o)){g("Ignoring additional event with same contract and token ID",t);continue}n.add(o);const c=A(e.tokenStandard,s,i),l={from:s,to:e.contractAddress,data:c};y(e)||r.set(t,l),a.set(t,l)}}return{before:r,after:a}}(e,t);g("Generated balance transactions",[...a.after.values()]);const s=a.before.size+a.after.size+1;if(1===s)return[];const i=await P({request:e,before:[...a.before.values()],after:[...a.after.values()]});if(g("Balance simulation response",i),i.transactions.length!==s)throw new h.SimulationInvalidResponseError;let o=0;return[...a.after.keys()].map((e,t)=>{const n=_(!a.before.get(e)?"0x0":k(r,e,i.transactions[o++]),k(r,e,i.transactions[t+a.before.size+1]));return n?{...e,...n}:undefined}).filter(e=>e!==undefined)}(e,s),o=t.transactions?.[0]?.gasUsed;return{simulationData:{nativeBalanceChange:r,tokenBalanceChanges:i},gasUsed:o}}catch(t){g("Failed to get balance changes",t,e);let n=t;T.some(e=>n.message?.includes(e))&&(n=new h.SimulationRevertedError);const{code:r,message:a}=n;return{simulationData:{tokenBalanceChanges:[],error:{code:r,message:a}},gasUsed:undefined}}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/balance-changes.cjs"}],[3089,{"@metamask/controller-utils":1488,"bignumber.js":3112},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isNativeBalanceSufficientForGas=n.getNativeBalance=void 0;const r=e("@metamask/controller-utils"),a=e("bignumber.js");async function s(e,t){const n=await(0,r.query)(t,"getBalance",[e,"latest"]),s=new a.BigNumber(n).toString(10);return{balanceHuman:new a.BigNumber(s).shiftedBy(-18).toString(10),balanceRaw:s}}n.getNativeBalance=s,n.isNativeBalanceSufficientForGas=async function(e,t){const n=e.txParams.from,r=new a.BigNumber(e.txParams.gas??"0x0").multipliedBy(e.txParams.maxFeePerGas??e.txParams.gasPrice??"0x0"),{balanceRaw:i}=await s(n,t);return r.isLessThanOrEqualTo(i)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/balance.cjs"}],[3090,{"../gas-flows/DefaultGasFeeFlow.cjs":3067,"../helpers/GasFeePoller.cjs":3075,"../hooks/CollectPublishHook.cjs":3082,"../hooks/SequentialPublishBatchHook.cjs":3084,"../index.cjs":3085,"../logger.cjs":3086,"../types.cjs":3087,"./eip7702.cjs":3091,"./feature-flags.cjs":3093,"./gas.cjs":3098,"./validation.cjs":3107,"@metamask/controller-utils":1488,"@metamask/rpc-errors":2692,"@metamask/utils":3207,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAtomicBatchSupported=n.addTransactionBatch=n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/rpc-errors"),s=e("@metamask/utils"),i=e("uuid"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),l=e("./gas.cjs"),u=e("./validation.cjs"),d=e("../index.cjs"),h=e("../gas-flows/DefaultGasFeeFlow.cjs"),f=e("../helpers/GasFeePoller.cjs"),m=e("../hooks/CollectPublishHook.cjs"),p=e("../hooks/SequentialPublishBatchHook.cjs"),g=e("../logger.cjs"),w=e("../types.cjs"),b=(0,s.createModuleLogger)(g.projectLogger,"batch");function T(){const e=(0,i.v4)(),t=new Uint8Array((0,i.parse)(e));return(0,s.bytesToHex)(t)}async function E(e,t,n,a,s,i){const{assetsFiatValues:o,existingTransaction:c,params:l,type:u}=t,{addTransaction:h,getTransaction:m,request:p,updateTransaction:g}=a,{from:w,networkClientId:T,origin:E}=p;if(c){const{id:t,onPublish:s}=c;let o=m(t);const u=o.txParams.nonce;let{signedTransaction:d}=c;const h=u?parseInt(u,16):undefined,f=i>0&&h!==undefined?h+i:undefined;if(g({transactionId:t},t=>{t.batchId=e,f&&(t.txParams.nonce=(0,r.toHex)(f))}),f){const e=await y({transactionId:t,request:a});d=e.newSignature,o=e.transactionMeta}return n(o,d).then(s).catch(()=>{}),b("Processed existing transaction with hook",{id:t,params:l}),{id:t,params:l}}const S={...s,txParams:{...l,from:w,gas:s?.gas??l.gas}};s&&(0,f.updateTransactionGasEstimates)({txMeta:S,userFeeLevel:d.GasFeeEstimateLevel.Medium});const{transactionMeta:I}=await h(S.txParams,{assetsFiatValues:o,batchId:e,disableGasBuffer:!0,networkClientId:T,origin:E,publishHook:n,requireApproval:!1,type:u}),{id:k,txParams:A}=I,C={data:A.data,gas:A.gas,maxFeePerGas:A.maxFeePerGas,maxPriorityFeePerGas:A.maxPriorityFeePerGas,to:A.to,value:A.value};return b("Processed new transaction with hook",{id:k,params:C,type:u}),{id:k,params:C,type:u}}async function y({request:e,transactionId:t}){const{getTransaction:n,signTransaction:r}=e,a=n(t);b("Re-signing existing transaction",{transactionId:t,txParams:a.txParams});const s=await r(a);if(!s)throw new Error("Failed to re-sign transaction");const i=n(t);return b("New signature",s),{newSignature:s,transactionMeta:i}}n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT="Upgrade contract address not found",n.addTransactionBatch=async function(e){const{getInternalAccounts:t,messenger:s,request:i}=e,f=(0,c.getBatchSizeLimit)(s);if((0,u.validateBatchRequest)({internalAccounts:t(),request:i,sizeLimit:f}),b("Adding",i),!i.disable7702)try{return await async function(e){const{addTransaction:t,getChainId:r,messenger:s,publicKeyEIP7702:i,request:l}=e,{batchId:u,disableUpgrade:h,from:f,gasFeeToken:m,gasLimit7702:p,networkClientId:g,origin:E,overwriteUpgrade:S,requestId:I,requireApproval:k,securityAlertId:A,skipInitialGasEstimate:C,transactions:_,validateSecurity:P}=l,v=r(g),N=e.getEthQuery(g),R=(0,o.doesChainSupportEIP7702)(v,s);if(!R)throw b("Chain does not support EIP-7702",v),a.rpcErrors.internal("Chain does not support EIP-7702");if(!i)throw a.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);let j=!1;if(!h){const{delegationAddress:e,isSupported:t}=await(0,o.isAccountUpgradedToEIP7702)(f,v,i,s,N);if(b("Account",{delegationAddress:e,isSupported:t}),!t&&e&&!S)throw b("Account upgraded to unsupported contract",f,e),a.rpcErrors.internal("Account upgraded to unsupported contract");j=!t,j&&e&&b("Overwriting authorization as already upgraded",{current:e})}const O=await Promise.all(_.map(e=>async function(e,t,n){const{from:r}=e,{params:a,type:s}=t;if(s)return{...a,type:s};const{type:i}=await(0,d.determineTransactionType)({from:r,...a},n);return{...a,type:i}}(l,e,N))),x={...(0,o.generateEIP7702BatchTransaction)(f,O),from:f,gas:p,maxFeePerGas:O[0]?.maxFeePerGas,maxPriorityFeePerGas:O[0]?.maxPriorityFeePerGas};if(j){const e=(0,c.getEIP7702UpgradeContractAddress)(v,s,i);if(!e)throw a.rpcErrors.internal(n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);x.type=w.TransactionEnvelopeType.setCode,x.authorizationList=[{address:e}]}if(P){const e={method:"eth_sendTransaction",params:[{...x,authorizationList:undefined,type:w.TransactionEnvelopeType.feeMarket}],delegationMock:x.authorizationList?.[0]?.address,origin:E};b("Security request",e),P(e,v).catch(e=>{b("Security validation failed",e)})}b("Adding batch transaction",x,g);const L=u??T(),M=A?{securityAlertId:A}:undefined,F=_.find(e=>e.existingTransaction)?.existingTransaction;if(F)return await async function({batchId:e,existingTransaction:t,nestedTransactions:n,request:r,txParams:a}){const{getTransaction:s,estimateGas:i,updateTransaction:o}=r,c=s(t.id);if(!c)throw new Error("Existing transaction not found");b("Converting existing transaction to 7702",{batchId:e,txParams:a});const{networkClientId:l}=c,u=await i(a,l);b("Estimated gas for converted EIP-7702 transaction",u),o({transactionId:c.id},t=>{var r;t.batchId=e,t.nestedTransactions=n,t.txParams=a,t.txParams.gas=u.gas,t.txParams.gasLimit=u.gas,t.txParams.maxFeePerGas=c.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=c.txParams.maxPriorityFeePerGas,t.txParams.nonce=c.txParams.nonce,(r=t.txParams).type??(r.type=w.TransactionEnvelopeType.feeMarket)});const{newSignature:d}=await y({request:r,transactionId:c.id});t.onPublish?.({transactionHash:undefined,newSignature:d}),b("Transaction updated to EIP-7702",{batchId:e,txParams:a,newSignature:d})}({batchId:L,existingTransaction:F,nestedTransactions:O,request:e,txParams:x}),{batchId:L};const{result:D}=await t(x,{batchId:L,gasFeeToken:m,isGasFeeIncluded:l.isGasFeeIncluded,isGasFeeSponsored:l.isGasFeeSponsored,nestedTransactions:O,networkClientId:g,origin:E,requestId:I,requireApproval:k,securityAlertResponse:M,skipInitialGasEstimate:C,type:w.TransactionType.batch}),B=await D;return b("Batch transaction added",{batchId:L,transactionHash:B}),{batchId:L}}(e)}catch(e){if(!(e instanceof a.JsonRpcError&&"Chain does not support EIP-7702"===e.message))throw e}return await async function(e){const{messenger:t,publishBatchHook:n,request:s,update:i}=e,{from:o,networkClientId:c,origin:u,requireApproval:f,transactions:g}=s;let w,y=!1;b("Adding transaction batch using hook",s);const S=new p.SequentialPublishBatchHook({publishTransaction:e.publishTransaction,getTransaction:e.getTransaction,getEthQuery:e.getEthQuery,getPendingTransactionTracker:e.getPendingTransactionTracker});let{disable7702:I,disableSequential:k}=s;const{disableHook:A,useHook:C}=s;C&&(I=!0,k=!0);let _,P=null;!A&&n?P=n:k||(P=S.getHook(),y=!0);if(!P)throw b("No supported batch methods found",{disable7702:I,disableHook:A,disableSequential:k}),a.rpcErrors.internal("Can't process batch");const v=T(),N=g.map(e=>({...e,origin:u})),R=N.length,j=new m.CollectPublishHook(R);try{f&&(_=await async function({batchId:e,request:t}){const{messenger:n,request:r,isSimulationEnabled:a,getChainId:s,getEthQuery:i,getGasFeeEstimates:o,getSimulationConfig:c,update:u}=t,{from:f,origin:m,networkClientId:p,transactions:g}=r,w=i(p);if(!a())throw new Error("Cannot create transaction batch as simulation not supported");b("Preparing approval data for batch");const T=s(p),{totalGasLimit:E}=await(0,l.simulateGasBatch)({chainId:T,from:f,getSimulationConfig:c,transactions:g}),y=(A={chainId:T,from:f,gas:E,id:e,networkClientId:p,origin:m,transactions:g},{...A,status:d.TransactionStatus.unapproved}),S=new h.DefaultGasFeeFlow,I=await o({networkClientId:p}),k=await S.getGasFees({ethQuery:w,gasFeeControllerData:I,messenger:n,transactionMeta:{...y,txParams:{from:f,gas:E},time:Date.now()}});var A;return y.gasFeeEstimates=k.estimates,b("Saving transaction batch metadata",y),function(e,t){t(t=>{t.transactionBatches=[...t.transactionBatches,e]})}(y,u),y}({batchId:v,request:e}),w=(await async function(e,t){const n=String(e.id),{origin:a}=e,s=r.ApprovalType.TransactionBatch,i={txBatchId:n};return b("Requesting approval for transaction batch",n),await t.call("ApprovalController:addRequest",{id:n,origin:a??r.ORIGIN_METAMASK,requestData:i,expectsResult:!0,type:s},!0)}(_,t)).resultCallbacks);const n=j.getHook(),a=[];let s=0;for(const t of N){const r=await E(v,t,n,e,_,s);a.push(r),s+=1}const{signedTransactions:i}=await j.ready(),u={from:o,networkClientId:c,transactions:a.map((e,t)=>({...e,signedTx:i[t]}))};b("Calling publish batch hook",u);let m=await P(u);if(b("Publish batch hook result",m),!m&&!y&&!k){b("Fallback to sequential publish batch hook due to empty results");const e=S.getHook();m=await e(u)}if(!m?.results?.length)throw new Error("Publish batch hook did not return a result");const p=m.results.map(({transactionHash:e})=>e);return j.success(p),w?.success(),b("Completed batch transaction with hook",p),{batchId:v}}catch(e){throw b("Publish batch hook failed",e),j.error(e),w?.error(e),e}finally{b("Cleaning up publish batch hook",v),function(e,t){e(e=>{e.transactionBatches=e.transactionBatches.filter(e=>e.id!==t)})}(i,v)}}(e)},n.isAtomicBatchSupported=async function(e){const{address:t,chainIds:n,getEthQuery:r,messenger:s,publicKeyEIP7702:i}=e;if(!i)throw a.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const l=(0,c.getEIP7702SupportedChains)(s).filter(e=>!n||n.includes(e)),u=(await Promise.all(l.map(async e=>{try{const n=r(e),{isSupported:a,delegationAddress:l}=await(0,o.isAccountUpgradedToEIP7702)(t,e,i,s,n);return{chainId:e,delegationAddress:l,isSupported:a,upgradeContractAddress:(0,c.getEIP7702UpgradeContractAddress)(e,s,i)}}catch(t){return b("Error checking atomic batch support",e,t),undefined}}))).filter(e=>Boolean(e));return b("Atomic batch supported results",u),u}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/batch.cjs"}],[3091,{"../constants.cjs":3065,"../logger.cjs":3086,"./feature-flags.cjs":3093,"@ethersproject/abi":748,"@ethersproject/contracts":771,"@metamask/controller-utils":1488,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.signAuthorizationList=n.generateEIP7702BatchTransaction=n.isAccountUpgradedToEIP7702=n.getDelegationAddress=n.doesChainSupportEIP7702=n.ERROR_MESSGE_PUBLIC_KEY=n.CALLS_SIGNATURE=n.BATCH_FUNCTION_NAME=n.DELEGATION_PREFIX=void 0;const r=e("@ethersproject/abi"),a=e("@ethersproject/contracts"),s=e("@metamask/controller-utils"),i=e("@metamask/utils"),o=e("./feature-flags.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs");n.DELEGATION_PREFIX="0xef0100",n.BATCH_FUNCTION_NAME="execute",n.CALLS_SIGNATURE="(address,uint256,bytes)[]",n.ERROR_MESSGE_PUBLIC_KEY="EIP-7702 public key not specified";const u=(0,i.createModuleLogger)(l.projectLogger,"eip-7702");async function d(e,t){const r=await(0,s.query)(t,"eth_getCode",[e]),a=(0,i.add0x)(r?.toLowerCase?.()??"");return 48===r?.length&&a.startsWith(n.DELEGATION_PREFIX)?(0,i.add0x)(a.slice(n.DELEGATION_PREFIX.length)):undefined}async function h(e,t,n,r){const a=function(e,t,n){const{chainId:r,nonce:a}=e,{txParams:i,chainId:o}=t,{nonce:c}=i,l=r??o;let d=a;d??(d=(0,s.toHex)(parseInt(c,16)+1+n));const h={...e,chainId:l,nonce:d};return u("Prepared authorization",h),h}(e,t,r),{txParams:o}=t,{from:c}=o,{address:l,chainId:d,nonce:h}=a,f=parseInt(d,16),m=parseInt(h,16),p=await n.call("KeyringController:signEip7702Authorization",{chainId:f,contractAddress:l,from:c,nonce:m}),g=p.slice(0,66),w=(0,i.add0x)(p.slice(66,130)),b=parseInt(p.slice(130,132),16),T={address:l,chainId:d,nonce:h,r:g,s:w,yParity:(0,s.toHex)(b-27==0?0:1)};return u("Signed authorization",T),T}n.doesChainSupportEIP7702=function(e,t){return(0,o.getEIP7702SupportedChains)(t).some(t=>t.toLowerCase()===e.toLowerCase())},n.getDelegationAddress=d,n.isAccountUpgradedToEIP7702=async function(e,t,n,r,a){const s=(0,o.getEIP7702ContractAddresses)(t,r,n),i=await d(e,a),c=Boolean(i&&s.some(e=>e.toLowerCase()===i.toLowerCase()));return{delegationAddress:i,isSupported:c}},n.generateEIP7702BatchTransaction=function(e,t){const s=a.Contract.getInterface(c.ABI_IERC7821),i=t.map(e=>{const{data:t,to:n,value:r}=e;return[n??"0x0000000000000000000000000000000000000000",r??"0x0",t??"0x"]}),o="0x01".padEnd(66,"0"),l=r.defaultAbiCoder.encode([n.CALLS_SIGNATURE],[i]),d=s.encodeFunctionData(n.BATCH_FUNCTION_NAME,[o,l]);return u("Transaction data",d),{data:d,to:e}},n.signAuthorizationList=async function({authorizationList:e,messenger:t,transactionMeta:n}){if(!e)return undefined;const r=[];let a=0;for(const s of e){const e=await h(s,n,t,a);r.push(e),a+=1}return r}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/eip7702.cjs"}],[3092,{"../types.cjs":3087,"@metamask/rpc-errors":2692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateConfirmedExternalTransaction=void 0;const r=e("@metamask/rpc-errors"),a=e("../types.cjs");n.validateConfirmedExternalTransaction=function(e,t,n){if(!e?.txParams)throw r.rpcErrors.invalidParams('"transactionMeta" or "transactionMeta.txParams" is missing');if(e.status!==a.TransactionStatus.confirmed)throw r.rpcErrors.invalidParams('External transaction status should be "confirmed"');const s=e.txParams.nonce;if(n&&n.length>0){if(n.find(e=>e.txParams?.nonce===s))throw r.rpcErrors.invalidParams("External transaction nonce should not be in pending txs")}if(t&&t.length>0){if(t.find(e=>e.txParams?.nonce===s))throw r.rpcErrors.invalidParams("External transaction nonce should not be in confirmed txs")}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/external-transactions.cjs"}],[3093,{"../logger.cjs":3086,"./signature.cjs":3103,"./utils.cjs":3106,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTimeoutAttempts=n.getIncomingTransactionsPollingInterval=n.getGasEstimateBuffer=n.getGasEstimateFallback=n.getGasFeeRandomisation=n.getAcceleratedPollingParams=n.getBatchSizeLimit=n.getEIP7702UpgradeContractAddress=n.getEIP7702ContractAddresses=n.getEIP7702SupportedChains=n.FeatureFlag=void 0;const r=e("@metamask/utils"),a=e("./signature.cjs"),s=e("./utils.cjs"),i=e("../logger.cjs");var o;!function(e){e.EIP7702="confirmations_eip_7702",e.GasBuffer="confirmations_gas_buffer",e.IncomingTransactions="confirmations_incoming_transactions",e.Transactions="confirmations_transactions"}(o||(n.FeatureFlag=o={}));const c=(0,r.createModuleLogger)(i.projectLogger,"feature-flags");function l(e,t,n){const r=u(t);return(r?.[o.EIP7702]?.contracts?.[e.toLowerCase()]??[]).filter(t=>(0,a.isValidSignature)([t.address,(0,s.padHexToEvenLength)(e)],t.signature,n)).map(e=>e.address)}function u(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags;return c("Retrieved feature flags",t),t}n.getEIP7702SupportedChains=function(e){const t=u(e);return t?.[o.EIP7702]?.supportedChains??[]},n.getEIP7702ContractAddresses=l,n.getEIP7702UpgradeContractAddress=function(e,t,n){return l(e,t,n)?.[0]},n.getBatchSizeLimit=function(e){const t=u(e);return t?.[o.Transactions]?.batchSizeLimit??10},n.getAcceleratedPollingParams=function(e,t){const n=u(t),r=n?.[o.Transactions]?.acceleratedPolling,a=r?.perChainConfig?.[e]?.countMax??r?.defaultCountMax??10,s=r?.perChainConfig?.[e]?.intervalMs??r?.defaultIntervalMs??3e3;return{blockTime:r?.perChainConfig?.[e]?.blockTime??12e3,countMax:a,intervalMs:s}},n.getGasFeeRandomisation=function(e){const t=u(e),n=t?.[o.Transactions]?.gasFeeRandomisation??{};return{randomisedGasFeeDigits:n.randomisedGasFeeDigits??{},preservedNumberOfDigits:n.preservedNumberOfDigits}},n.getGasEstimateFallback=function(e,t){const n=u(t),r=n?.[o.Transactions]?.gasEstimateFallback,a=r?.perChainConfig?.[e],s=a?.percentage??r?.default?.percentage??35;return{fixed:a?.fixed??r?.default?.fixed,percentage:s}},n.getGasEstimateBuffer=function({chainId:e,isCustomRPC:t,isUpgradeWithDataToSelf:n,messenger:r}){const a=u(r),s=a?.[o.GasBuffer],i=s?.perChainConfig?.[e],c=t?undefined:i?.included,l=t?undefined:s?.included;return(n?i?.eip7702:undefined)??c??i?.base??l??s?.default??1},n.getIncomingTransactionsPollingInterval=function(e){const t=u(e);return t?.[o.IncomingTransactions]?.pollingIntervalMs??24e4},n.getTimeoutAttempts=function(e,t){const n=u(t),r=n?.[o.Transactions]?.timeoutAttempts;return r?.perChainConfig?.[e]??r?.default}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/feature-flags.cjs"}],[3094,{"../api/accounts-api.cjs":3063,"../logger.cjs":3086,"../types.cjs":3087,"./transaction-type.cjs":3105,"./validation.cjs":3107,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateFirstTimeInteraction=void 0;const r=e("@metamask/utils"),a=e("./transaction-type.cjs"),s=e("./validation.cjs"),i=e("../api/accounts-api.cjs"),o=e("../logger.cjs"),c=e("../types.cjs");n.updateFirstTimeInteraction=async function({existingTransactions:e,getTransaction:t,isFirstTimeInteractionEnabled:n,trace:l,traceContext:u,transactionMeta:d,updateTransaction:h}){if(!n())return;const{chainId:f,id:m,txParams:{data:p,from:g,to:w},type:b}=d;let T;if(p&&[c.TransactionType.tokenMethodTransfer,c.TransactionType.tokenMethodTransferFrom].includes(b)){const e=(0,a.decodeTransactionData)(p);T=e?.args?._to??e?.args?.to}T??(T=w);const E={chainId:(0,r.hexToNumber)(f),to:T,from:g};if((0,s.validateParamTo)(T),!e.find(e=>e.chainId===f&&e.txParams.from.toLowerCase()===g.toLowerCase()&&e.txParams.to?.toLowerCase()===w?.toLowerCase()&&e.id!==m))try{const{count:e}=await l({name:"Account Address Relationship",parentContext:u},()=>(0,i.getAccountAddressRelationship)(E)),n=e===undefined?undefined:0===e;if(!t(m))return void(0,o.projectLogger)("Cannot update first time interaction as transaction not found",m);h({transactionId:m,note:"TransactionController#updateFirstInteraction - Update first time interaction"},e=>{e.isFirstTimeInteraction=n}),(0,o.projectLogger)("Updated first time interaction",m,{isFirstTimeInteraction:n})}catch(e){(0,o.projectLogger)("Error fetching account address relationship, skipping first time interaction update",e)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/first-time-interaction.cjs"}],[3095,{"../api/simulation-api.cjs":3064,"../logger.cjs":3086,"./balance.cjs":3089,"./batch.cjs":3090,"./eip7702.cjs":3091,"./feature-flags.cjs":3093,"@metamask/rpc-errors":2692,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.checkGasFeeTokenBeforePublish=n.getGasFeeTokens=void 0;const r=e("@metamask/rpc-errors"),a=e("@metamask/utils"),s=e("./balance.cjs"),i=e("./batch.cjs"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),l=e("../api/simulation-api.cjs"),u=e("../logger.cjs"),d=(0,a.createModuleLogger)(u.projectLogger,"gas-fee-tokens");n.getGasFeeTokens=async function({chainId:e,isEIP7702GasFeeTokensEnabled:t,messenger:n,publicKeyEIP7702:a,transactionMeta:s,getSimulationConfig:u}){const{delegationAddress:h,txParams:f}=s,{authorizationList:m}=f,p=f.data,g=f.from,w=f.to,b=f.value;d("Request",{chainId:e,txParams:f});const T=await t(s)&&(0,o.doesChainSupportEIP7702)(e,n);let E=m?.map(e=>({address:e.address,from:g}));!T||h||E||(E=function({chainId:e,from:t,messenger:n,publicKeyEIP7702:a}){if(!a)throw r.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const s=(0,c.getEIP7702UpgradeContractAddress)(e,n,a);if(!s)throw r.rpcErrors.internal(i.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);return[{address:s,from:t}]}({chainId:e,from:g,messenger:n,publicKeyEIP7702:a}));try{const t=await(0,l.simulateTransactions)(e,{getSimulationConfig:u,transactions:[{authorizationList:E,data:p,from:g,to:w,value:b}],suggestFees:{withTransfer:!0,withFeeTransfer:!0,with7702:T}});d("Response",t);const n=function(e){const t=e.transactions?.[0]?.fees?.[0],n=e.sponsorship?.isSponsored??!1;return{gasFeeTokens:(t?.tokenFees??[]).map(e=>({amount:e.balanceNeededToken,balance:e.currentBalanceToken,decimals:e.token.decimals,fee:e.serviceFee,gas:t.gas,gasTransfer:e.transferEstimate,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,rateWei:e.rateWei,recipient:e.feeRecipient,symbol:e.token.symbol,tokenAddress:e.token.address})),isGasFeeSponsored:n}}(t);return d("Gas fee tokens",n),n}catch(e){return d("Failed to gas fee tokens",e),{gasFeeTokens:[],isGasFeeSponsored:!1}}},n.checkGasFeeTokenBeforePublish=async function({ethQuery:e,fetchGasFeeTokens:t,transaction:n,updateTransaction:r}){const{isGasFeeTokenIgnoredIfBalance:a,selectedGasFeeToken:i}=n;if(!i||!a)return;if(d("Checking gas fee token before publish",{selectedGasFeeToken:i}),await(0,s.isNativeBalanceSufficientForGas)(n,e))return d("Ignoring gas fee token before publish due to sufficient native balance"),void r(n.id,e=>{e.isExternalSign=!1,e.selectedGasFeeToken=undefined});const o=await t({...n,isExternalSign:!0});if(r(n.id,e=>{e.gasFeeTokens=o,e.isExternalSign=!0,e.txParams.nonce=undefined}),d("Updated gas fee tokens before publish",o),!o?.some(e=>e.tokenAddress.toLowerCase()===i.toLowerCase()))throw new Error("Gas fee token not found and insufficient native balance");d("Publishing with selected gas fee token",{selectedGasFeeToken:i})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-fee-tokens.cjs"}],[3096,{"../logger.cjs":3086,"../types.cjs":3087,"./gas-flow.cjs":3097,"./swaps.cjs":3104,"@metamask/controller-utils":1488,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.gweiDecimalToWeiDecimal=n.gweiDecimalToWeiHex=n.updateGasFees=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/utils"),s=e("./gas-flow.cjs"),i=e("./swaps.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),l=(0,a.createModuleLogger)(o.projectLogger,"gas-fees");function u(e){return(0,r.toHex)((0,r.gweiDecToWEIBN)(e))}n.updateGasFees=async function(e){const{txMeta:t}=e,n={...t.txParams},o=i.SWAP_TRANSACTION_TYPES.includes(t.type)?undefined:e.getSavedGasFees(t.chainId),d=await async function(e){const{eip1559:t,ethQuery:n,gasFeeFlows:i,getGasFeeEstimates:o,messenger:u,txMeta:d}=e,{networkClientId:h}=d;if(!t&&d.txParams.gasPrice||t&&d.txParams.maxFeePerGas&&d.txParams.maxPriorityFeePerGas)return{};const f=(0,s.getGasFeeFlow)(d,i,u);try{const e=await o({networkClientId:h}),t=await f.getGasFees({ethQuery:n,gasFeeControllerData:e,messenger:u,transactionMeta:d}),r=t.estimates?.type;switch(r){case c.GasFeeEstimateType.FeeMarket:return t.estimates.medium;case c.GasFeeEstimateType.Legacy:return{gasPrice:t.estimates.medium};case c.GasFeeEstimateType.GasPrice:return{gasPrice:t.estimates.gasPrice};default:throw new Error(`Unsupported gas fee estimate type returned from flow: ${r}`)}}catch(e){l("Failed to get suggested gas fees",e)}const m=await(0,r.query)(n,"gasPrice");return{gasPrice:m?(0,a.add0x)(m.toString(16)):undefined}}(e);l("Suggested gas fees",d);const h={...e,initialParams:n,savedGasFees:o,suggestedGasFees:d};t.txParams.maxFeePerGas=function(e){const{savedGasFees:t,eip1559:n,initialParams:r,suggestedGasFees:a}=e;if(!n)return undefined;if(t){const e=u(t.maxBaseFee);return l("Using maxFeePerGas from savedGasFees",e),e}if(r.maxFeePerGas)return l("Using maxFeePerGas from request",r.maxFeePerGas),r.maxFeePerGas;if(r.gasPrice&&!r.maxPriorityFeePerGas)return l("Setting maxFeePerGas to gasPrice from request",r.gasPrice),r.gasPrice;if(a.maxFeePerGas)return l("Using suggested maxFeePerGas",a.maxFeePerGas),a.maxFeePerGas;if(a.gasPrice)return l("Setting maxFeePerGas to suggested gasPrice",a.gasPrice),a.gasPrice;return l("maxFeePerGas not set"),undefined}(h),t.txParams.maxPriorityFeePerGas=function(e){const{eip1559:t,initialParams:n,savedGasFees:r,suggestedGasFees:a,txMeta:s}=e;if(!t)return undefined;if(r){const e=u(r.priorityFee);return l("Using maxPriorityFeePerGas from savedGasFees.priorityFee",e),e}if(n.maxPriorityFeePerGas)return l("Using maxPriorityFeePerGas from request",n.maxPriorityFeePerGas),n.maxPriorityFeePerGas;if(n.gasPrice&&!n.maxFeePerGas)return l("Setting maxPriorityFeePerGas to gasPrice from request",n.gasPrice),n.gasPrice;if(a.maxPriorityFeePerGas)return l("Using suggested maxPriorityFeePerGas",a.maxPriorityFeePerGas),a.maxPriorityFeePerGas;if(s.txParams.maxFeePerGas)return l("Setting maxPriorityFeePerGas to maxFeePerGas",s.txParams.maxFeePerGas),s.txParams.maxFeePerGas;return l("maxPriorityFeePerGas not set"),undefined}(h),t.txParams.gasPrice=function(e){const{eip1559:t,initialParams:n,suggestedGasFees:r}=e;if(t)return undefined;if(n.gasPrice)return l("Using gasPrice from request",n.gasPrice),n.gasPrice;if(r.maxFeePerGas)return l("Using suggested maxFeePerGas",r.maxFeePerGas),r.maxFeePerGas;if(r.gasPrice)return l("Using suggested gasPrice",r.gasPrice),r.gasPrice;return l("gasPrice not set"),undefined}(h),t.userFeeLevel=function(e){const{initialParams:t,savedGasFees:n,suggestedGasFees:a,txMeta:s}=e;if(n)return c.UserFeeLevel.CUSTOM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&t.gasPrice)return s.origin===r.ORIGIN_METAMASK?c.UserFeeLevel.CUSTOM:c.UserFeeLevel.DAPP_SUGGESTED;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&a.maxFeePerGas&&a.maxPriorityFeePerGas)return c.UserFeeLevel.MEDIUM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&a.gasPrice)return c.UserFeeLevel.MEDIUM;if(s.origin===r.ORIGIN_METAMASK)return c.UserFeeLevel.MEDIUM;return c.UserFeeLevel.DAPP_SUGGESTED}(h),l("Updated gas fee properties",{maxFeePerGas:t.txParams.maxFeePerGas,maxPriorityFeePerGas:t.txParams.maxPriorityFeePerGas,gasPrice:t.txParams.gasPrice}),(t.txParams.maxFeePerGas||t.txParams.maxPriorityFeePerGas)&&delete t.txParams.gasPrice,t.txParams.gasPrice&&(delete t.txParams.maxFeePerGas,delete t.txParams.maxPriorityFeePerGas),function(e){e.defaultGasEstimates??(e.defaultGasEstimates={}),e.defaultGasEstimates.maxFeePerGas=e.txParams.maxFeePerGas,e.defaultGasEstimates.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas,e.defaultGasEstimates.gasPrice=e.txParams.gasPrice,e.defaultGasEstimates.estimateType=e.userFeeLevel}(t)},n.gweiDecimalToWeiHex=u,n.gweiDecimalToWeiDecimal=function(e){return(1e9*Number(e)).toString().split(".")[0]}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-fees.cjs"}],[3097,{"../types.cjs":3087,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeGasFeeEstimates=n.getGasFeeFlow=void 0;const r=e("@metamask/controller-utils"),a=e("../types.cjs");function s(e,t){return(0,r.weiHexToGweiDec)(e[t])}n.getGasFeeFlow=function(e,t,n){return t.find(t=>t.matchesTransaction({transactionMeta:e,messenger:n}))},n.mergeGasFeeEstimates=function({gasFeeControllerEstimates:e,transactionGasFeeEstimates:t}){const n=t.type;return n===a.GasFeeEstimateType.FeeMarket?Object.values(a.GasFeeEstimateLevel).reduce((n,a)=>{return{...n,[a]:(s=e?.[a],i=t[a],{...s,suggestedMaxFeePerGas:(0,r.weiHexToGweiDec)(i.maxFeePerGas),suggestedMaxPriorityFeePerGas:(0,r.weiHexToGweiDec)(i.maxPriorityFeePerGas)})};var s,i},{...e}):n===a.GasFeeEstimateType.Legacy?Object.values(a.GasFeeEstimateLevel).reduce((e,n)=>({...e,[n]:s(t,n)}),{}):n===a.GasFeeEstimateType.GasPrice?{gasPrice:(i=t,(0,r.weiHexToGweiDec)(i.gasPrice))}:e;var i}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-flow.cjs"}],[3098,{"../api/simulation-api.cjs":3064,"../logger.cjs":3086,"../types.cjs":3087,"./eip7702.cjs":3091,"./feature-flags.cjs":3093,"@metamask/controller-utils":1488,"@metamask/utils":3207,"bignumber.js":3112},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateGasBatch=n.addGasBuffer=n.estimateGasBatch=n.estimateGas=n.updateGas=n.DUMMY_AUTHORIZATION_SIGNATURE=n.INTRINSIC_GAS=n.MAX_GAS_BLOCK_PERCENT=n.DEFAULT_GAS_MULTIPLIER=n.FIXED_GAS=n.log=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/utils"),s=e("bignumber.js"),i=e("./eip7702.cjs"),o=e("./feature-flags.cjs"),c=e("../api/simulation-api.cjs"),l=e("../logger.cjs"),u=e("../types.cjs");async function d({chainId:e,ethQuery:t,ignoreDelegationSignatures:s,isSimulationEnabled:i,getSimulationConfig:c,messenger:l,txParams:d}){const h={...d},{authorizationList:f,data:g,from:w,value:b,to:T}=h;if(s&&!i)throw new Error("Gas estimation with ignored delegation signatures is not supported as simulation disabled");const{gasLimit:E,number:y}=await async function(e){return await(0,r.query)(e,"getBlockByNumber",["latest",!1])}(t),S=(0,r.hexToBN)(E),{percentage:I,fixed:k}=(0,o.getGasEstimateFallback)(e,l),A=k?(0,r.toHex)(k):(0,r.BNToHex)((0,r.fractionBN)(S,I,100));(0,n.log)("Estimation fallback values",A),h.data=g?(0,a.add0x)(g):g,h.value=b??"0x0",h.authorizationList=function(e,t){return e?.map(e=>({...e,chainId:e.chainId??t,nonce:e.nonce??"0x1",r:e.r??n.DUMMY_AUTHORIZATION_SIGNATURE,s:e.s??n.DUMMY_AUTHORIZATION_SIGNATURE,yParity:e.yParity??"0x1"}))}(h.authorizationList,e),delete h.gasPrice,delete h.maxFeePerGas,delete h.maxPriorityFeePerGas;let C,_=A;const P=d.type===u.TransactionEnvelopeType.setCode&&Boolean(f?.length)&&Boolean(g)&&"0x"!==g&&w?.toLowerCase()===T?.toLowerCase();try{_=i&&P?await async function(e,t,a,s){const i=await(0,r.query)(t,"estimateGas",[{...e,data:"0x"}]);(0,n.log)("Upgrade only gas",i);const o=e.authorizationList?.[0].address;let c;try{c=await m({chainId:a,delegationAddress:o,getSimulationConfig:s,transaction:e})}catch(e){(0,n.log)("Error while simulating data portion of upgrade",e)}if(c===undefined){try{c=await p(t,{...e,authorizationList:undefined,type:undefined},o)}catch(e){throw(0,n.log)("Error while estimating data portion of upgrade",e),e}(0,n.log)("Success estimating data portion of upgrade",c)}(0,n.log)("Execute gas",c);const l=(0,r.BNToHex)((0,r.hexToBN)(i).add((0,r.hexToBN)(c)).subn(n.INTRINSIC_GAS));return(0,n.log)("Total type 4 gas",l),l}(h,t,e,c):s&&i?await m({chainId:e,getSimulationConfig:c,transaction:h}):await p(t,h)}catch(e){C={reason:e.message,errorKey:e.errorKey,debug:{blockNumber:y,blockGasLimit:E}},(0,n.log)("Estimation failed",{...C,fallback:A})}return{blockGasLimit:E,estimatedGas:_,isUpgradeWithDataToSelf:P,simulationFails:C}}function h(e,t,s){const i=(0,r.hexToBN)(e),o=(0,r.fractionBN)((0,r.hexToBN)(t),n.MAX_GAS_BLOCK_PERCENT,100),c=(0,r.fractionBN)(i,100*s,100);if(i.gt(o)){const t=(0,a.add0x)(e);return(0,n.log)("Using estimated value",t),t}if(c.lt(o)){const e=(0,a.add0x)((0,r.BNToHex)(c));return(0,n.log)("Using padded estimate",e,s),e}const l=(0,a.add0x)((0,r.BNToHex)(o));return(0,n.log)("Using 90% of block gas limit",l),l}async function f({chainId:e,from:t,getSimulationConfig:a,transactions:s}){try{const n=await(0,c.simulateTransactions)(e,{getSimulationConfig:a,transactions:s.map(e=>({...e.params,from:t}))});if(!n?.transactions||n.transactions.length!==s.length)throw new Error("Simulation response does not match transaction count");return n.transactions.reduce((e,t)=>{const n=t?.gasLimit;if(!n)throw new Error("No simulated gas returned for one of the transactions");return e.gasLimits.push(n),e.totalGasLimit=(0,r.BNToHex)((0,r.hexToBN)(e.totalGasLimit).add((0,r.hexToBN)(n))),e},{totalGasLimit:"0x0",gasLimits:[]})}catch(e){throw(0,n.log)("Error while simulating gas batch",e),new Error("Cannot estimate transaction batch total gas as simulation failed")}}async function m({chainId:e,delegationAddress:t,getSimulationConfig:n,transaction:r}){const s=await(0,c.simulateTransactions)(e,{getSimulationConfig:n,transactions:[{to:r.to,from:r.from,data:r.data,value:r.value}],overrides:{[r.from]:{code:t&&i.DELEGATION_PREFIX+(0,a.remove0x)(t)}}}),o=s?.transactions?.[0].gasLimit;if(!o)throw new Error("No simulated gas returned");return o}function p(e,t,n){const{from:s}=t,o=[t];return n&&(o.push("latest"),o.push({[s]:{code:i.DELEGATION_PREFIX+(0,a.remove0x)(n)}})),(0,r.query)(e,"estimateGas",o)}n.log=(0,a.createModuleLogger)(l.projectLogger,"gas"),n.FIXED_GAS="0x5208",n.DEFAULT_GAS_MULTIPLIER=1.5,n.MAX_GAS_BLOCK_PERCENT=90,n.INTRINSIC_GAS=21e3,n.DUMMY_AUTHORIZATION_SIGNATURE="0x1111111111111111111111111111111111111111111111111111111111111111",n.updateGas=async function(e){const{txMeta:t}=e,a={...t.txParams},[s,i,c]=await async function(e){const{chainId:t,isCustomNetwork:a,isSimulationEnabled:s,getSimulationConfig:i,messenger:c,txMeta:l}=e,{disableGasBuffer:f}=l;if(l.txParams.gas)return(0,n.log)("Using value from request",l.txParams.gas),[l.txParams.gas,undefined,l.txParams.gas];if(await async function({ethQuery:e,txMeta:t,isCustomNetwork:n}){const{txParams:{to:a,data:s,type:i}}=t;if(n||!a||s||i===u.TransactionEnvelopeType.setCode)return!1;const o=await async function(e,t){return await(0,r.query)(e,"getCode",[t])}(e,a);return!o||"0x"===o}(e))return(0,n.log)("Using fixed value",n.FIXED_GAS),[n.FIXED_GAS,undefined,n.FIXED_GAS];const{blockGasLimit:m,estimatedGas:p,isUpgradeWithDataToSelf:g,simulationFails:w}=await d({chainId:t,ethQuery:e.ethQuery,isSimulationEnabled:s,getSimulationConfig:i,messenger:c,txParams:l.txParams});(0,n.log)("Original estimated gas",p),w&&(0,n.log)("Using original fallback estimate as simulation failed");f&&(0,n.log)("Gas buffer disabled");if(w||f)return[p,w,p];const b=(0,o.getGasEstimateBuffer)({chainId:t,isCustomRPC:a,isUpgradeWithDataToSelf:g,messenger:c});(0,n.log)("Buffer",b);const T=h(p,m,b);return(0,n.log)("Buffered gas",T),[T,w,p]}(e);t.txParams.gas=s,t.simulationFails=i,t.gasLimitNoBuffer=c,a.gas||(t.originalGasEstimate=t.txParams.gas),t.defaultGasEstimates??(t.defaultGasEstimates={}),t.defaultGasEstimates.gas=t.txParams.gas},n.estimateGas=d,n.estimateGasBatch=async function({chainId:e,ethQuery:t,from:r,getSimulationConfig:a,isAtomicBatchSupported:o,messenger:c,transactions:l}){const h=(await o({address:r,chainIds:[e]})).find(t=>t.chainId===e),m=Boolean(h&&!h.isSupported);if(m&&!h?.upgradeContractAddress)throw new Error("Upgrade contract address not found");if(h){const o=m?[{address:h.upgradeContractAddress}]:undefined,f=m?u.TransactionEnvelopeType.setCode:undefined,p={...(0,i.generateEIP7702BatchTransaction)(r,l),authorizationList:o,from:r,type:f},{estimatedGas:g}=await d({chainId:e,ethQuery:t,isSimulationEnabled:!0,getSimulationConfig:a,messenger:c,txParams:p}),w=new s.BigNumber(g).toNumber();return(0,n.log)("Estimated EIP-7702 gas limit",w),{totalGasLimit:w,gasLimits:[w]}}if(l.every(e=>e.gas!==undefined)){const e=l.map(e=>new s.BigNumber(e.gas).toNumber()),t=e.reduce((e,t)=>e+t,0);return(0,n.log)("Using batch parameter gas limits",{gasLimits:e,total:t}),{totalGasLimit:t,gasLimits:e}}const{gasLimits:p}=await f({chainId:e,from:r,getSimulationConfig:a,transactions:l.map(e=>({params:e}))}),g=l.map((e,t)=>e.gas?new s.BigNumber(e.gas).toNumber():new s.BigNumber(p[t]).toNumber()),w=g.reduce((e,t)=>e+t,0);return(0,n.log)("Simulated batch gas limits",{totalGasLimit:w,gasLimits:g}),{totalGasLimit:w,gasLimits:g}},n.addGasBuffer=h,n.simulateGasBatch=f}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas.cjs"}],[3099,{"../logger.cjs":3086,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionLayer1GasFee=n.updateTransactionLayer1GasFee=void 0;const r=e("@metamask/utils"),a=e("../logger.cjs"),s=(0,r.createModuleLogger)(a.projectLogger,"layer-1-gas-fee-flow");async function i({layer1GasFeeFlows:e,messenger:t,provider:n,transactionMeta:r}){const a=await async function(e,t,n){for(const r of t)if(await r.matchesTransaction({transactionMeta:e,messenger:n}))return r;return undefined}(r,e,t);if(!a)return undefined;s("Found layer 1 gas fee flow",a.constructor.name,r.id);try{const{layer1Fee:e}=await a.getLayer1Fee({provider:n,transactionMeta:r});return e}catch(e){return s("Failed to get layer 1 gas fee",r.id,e),undefined}}n.updateTransactionLayer1GasFee=async function(e){const t=await i(e);if(!t)return;const{transactionMeta:n}=e;n.layer1GasFee=t,s("Updated layer 1 gas fee",t,n.id)},n.getTransactionLayer1GasFee=i}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/layer1-gas-fee-flow.cjs"}],[3100,{"../logger.cjs":3086,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAndFormatTransactionsForNonceTracker=n.getNextNonce=void 0;const r=e("@metamask/controller-utils"),a=e("../logger.cjs"),s=(0,a.createModuleLogger)(a.projectLogger,"nonce");n.getNextNonce=async function(e,t){const{customNonceValue:n,isExternalSign:a,txParams:{from:i,nonce:o}}=e;if(a)return s("Skipping nonce as signed externally"),[undefined,undefined];const c=n?(0,r.toHex)(n):undefined;if(c)return s("Using custom nonce",c),[c,undefined];if(o)return s("Using existing nonce",o),[o,undefined];const l=await t(i),u=(0,r.toHex)(l.nextNonce),d=l.releaseLock.bind(l);return s("Using nonce from nonce tracker",u,l.nonceDetails),[u,d]},n.getAndFormatTransactionsForNonceTracker=function(e,t,n,r){return r.filter(({chainId:r,isTransfer:a,isUserOperation:s,status:i,txParams:{from:o,nonce:c}})=>!a&&!s&&r===e&&n.includes(i)&&o.toLowerCase()===t.toLowerCase()&&c).flatMap(({status:e,txParams:{authorizationList:t,from:n,gas:r,value:a,nonce:s}})=>[s,...(t??[]).map(e=>e.nonce).filter(e=>e!==undefined)].map(t=>({status:e,history:[{}],txParams:{from:n??"",gas:r??"",value:a??"",nonce:t??""}})))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/nonce.cjs"}],[3101,{"@ethereumjs/common":664,"@ethereumjs/tx":681,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeTransaction=n.prepareTransaction=n.HARDFORK=void 0;const r=e("@ethereumjs/common"),a=e("@ethereumjs/tx"),s=e("@metamask/utils"),i=e("lodash");function o(e){const t={chainId:parseInt(e,16),defaultHardfork:n.HARDFORK};return r.Common.custom(t,{eips:[7702]})}function c(e){return e?"0x0"===e?"0x":e.replace?.(/^0x(00)+/u,"0x")??e:e}n.HARDFORK=r.Hardfork.Prague,n.prepareTransaction=function(e,t){const n=function(e){const t=(0,i.cloneDeep)(e);return function(e){if(!e)return;for(const t of e)t.nonce=c(t.nonce),t.r=c(t.r),t.s=c(t.s),t.yParity=c(t.yParity)}(t.authorizationList),t}(t);return a.TransactionFactory.fromTxData(n,{freeze:!1,common:o(e)})},n.serializeTransaction=function(e){return(0,s.bytesToHex)(e.serialize())}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/prepare.cjs"}],[3102,{"@metamask/controller-utils":1488,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionParamsWithIncreasedGasFee=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/utils");function s(e,t){const n=(0,r.convertHexToDecimal)(e),s=parseInt(""+n*t,10);return(0,a.add0x)(s.toString(16))}n.getTransactionParamsWithIncreasedGasFee=function(e,t,n){const r=function(e,t,n){if(n&&"gasPrice"in n)return n.gasPrice;const r=e.gasPrice;if(!r||"0x0"===r)return undefined;return s(r,t)}(e,t,n),a=function(e,t,n){if(n&&"maxFeePerGas"in n&&"maxPriorityFeePerGas"in n)return n;const r=e.maxFeePerGas,a=e.maxPriorityFeePerGas;if(!r||!a||"0x0"===r||"0x0"===a)return undefined;const i=s(r,t),o=s(a,t);return{maxFeePerGas:i,maxPriorityFeePerGas:o}}(e,t,n);if(a){const t={...e,...a};return delete t.gasPrice,t}if(r){const t={...e,gasPrice:r};return delete t.maxFeePerGas,delete t.maxPriorityFeePerGas,t}throw new Error("Cannot increase gas fee as no current values and no new values were provided")}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/retry.cjs"}],[3103,{"@ethersproject/wallet":845,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidSignature=void 0;const r=e("@ethersproject/wallet"),a=e("@metamask/utils");n.isValidSignature=function(e,t,n){try{const s=(0,a.add0x)(e.map(a.remove0x).join("")),i=(0,a.hexToBytes)(s);return(0,r.verifyMessage)(i,t).toLowerCase()===n.toLowerCase()}catch{return!1}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/signature.cjs"}],[3104,{"../constants.cjs":3065,"../logger.cjs":3086,"../types.cjs":3087,"./utils.cjs":3106,"@metamask/controller-utils":1488,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePostTransactionBalance=n.updateSwapsTransaction=n.SWAP_TRANSACTION_TYPES=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=n.UPDATE_POST_TX_BALANCE_ATTEMPTS=n.UPDATE_POST_TX_BALANCE_TIMEOUT=void 0;const r=e("@metamask/controller-utils"),a=e("lodash"),s=e("./utils.cjs"),i=e("../constants.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),l=(0,o.createModuleLogger)(o.projectLogger,"swaps");n.UPDATE_POST_TX_BALANCE_TIMEOUT=5e3,n.UPDATE_POST_TX_BALANCE_ATTEMPTS=6;const u="0x539";n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const d={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},h={name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},f={name:"Matic",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},m={name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},p={name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},g={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},w={...d},b={...d},T={...d},E={name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},y={name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18};function S(e,t){return!(!e||!t)&&e===n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[t]?.address}function I(e){return new Promise(t=>setTimeout(t,e))}n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[i.CHAIN_IDS.MAINNET]:d,[u]:p,[i.CHAIN_IDS.BSC]:h,[i.CHAIN_IDS.POLYGON]:f,[i.CHAIN_IDS.GOERLI]:g,[i.CHAIN_IDS.AVALANCHE]:m,[i.CHAIN_IDS.OPTIMISM]:b,[i.CHAIN_IDS.ARBITRUM]:w,[i.CHAIN_IDS.ZKSYNC_ERA]:T,[i.CHAIN_IDS.SEI]:E,[i.CHAIN_IDS.MONAD]:y},n.SWAP_TRANSACTION_TYPES=[c.TransactionType.swap,c.TransactionType.swapAndSend,c.TransactionType.swapApproval],n.updateSwapsTransaction=function(e,t,r,{isSwapsDisabled:i,cancelTransaction:o,messenger:l}){if(i||!n.SWAP_TRANSACTION_TYPES.includes(t))return e;if(t===c.TransactionType.swap&&!1===r?.hasApproveTx&&e.simulationFails)throw o(e.id),new Error("Simulation failed");const u=r?.meta;if(!u)return e;let d=e;return t===c.TransactionType.swapApproval&&(d=function(e,{type:t,sourceTokenSymbol:n}){(0,s.validateIfTransactionUnapproved)(e,"updateSwapApprovalTransaction");let r={type:t,sourceTokenSymbol:n};return r=(0,a.pickBy)({type:t,sourceTokenSymbol:n}),(0,a.merge)({},e,r)}(e,u),l.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:d})),t===c.TransactionType.swapAndSend&&(d=function(e,{approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:r,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:l,sourceTokenAmount:u,sourceTokenDecimals:d,sourceTokenSymbol:h,swapAndSendRecipient:f,swapMetaData:m,swapTokenValue:p,type:g}){(0,s.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let w={approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:r,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:l,sourceTokenAmount:u,sourceTokenDecimals:d,sourceTokenSymbol:h,swapAndSendRecipient:f,swapMetaData:m,swapTokenValue:p,type:g};return w=(0,a.pickBy)(w),(0,a.merge)({},e,w)}(e,u),l.publish("TransactionController:transactionNewSwapAndSend",{transactionMeta:d})),t===c.TransactionType.swap&&(d=function(e,{sourceTokenSymbol:t,destinationTokenSymbol:n,type:r,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:l,estimatedBaseFee:u,approvalTxId:d}){(0,s.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let h={sourceTokenSymbol:t,destinationTokenSymbol:n,type:r,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:l,estimatedBaseFee:u,approvalTxId:d};return h=(0,a.pickBy)(h),(0,a.merge)({},e,h)}(e,u),l.publish("TransactionController:transactionNewSwap",{transactionMeta:d})),d},n.updatePostTransactionBalance=async function(e,{ethQuery:t,getTransaction:a,updateTransaction:s}){l("Updating post transaction balance",e.id);const i=e.id;let o,c;for(let s=0;s<n.UPDATE_POST_TX_BALANCE_ATTEMPTS;s++){l("Querying balance",{attempt:s});const u=await(0,r.query)(t,"getBalance",[e.txParams.from]);o={...a(i)??{}},c=o.approvalTxId?a(o.approvalTxId):undefined,o.postTxBalance=u.toString(16);const d=S(e.destinationTokenAddress,e.chainId);if(!d||e.preTxBalance!==o.postTxBalance){l("Finishing post balance update",{isDefaultTokenAddress:d,preTxBalance:e.preTxBalance,postTxBalance:o.postTxBalance});break}l("Waiting for balance to update",{delay:n.UPDATE_POST_TX_BALANCE_TIMEOUT}),await I(n.UPDATE_POST_TX_BALANCE_TIMEOUT)}return s(o,"TransactionController#updatePostTransactionBalance - Add post transaction balance"),l("Completed post balance update",o?.postTxBalance),{updatedTransactionMeta:o,approvalTransactionMeta:c}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/swaps.cjs"}],[3105,{"../types.cjs":3087,"./eip7702.cjs":3091,"@ethersproject/abi":748,"@metamask/controller-utils":1488,"@metamask/metamask-eth-abis":2370},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=n.determineTransactionType=n.ESTIMATE_GAS_ERROR=void 0;const r=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("./eip7702.cjs"),o=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const c=new r.Interface(s.abiERC20),l=new r.Interface(s.abiERC721),u=new r.Interface(s.abiERC1155),d=new r.Interface(s.abiFiatTokenV2);function h(e,t){if(!e||e.length<10)return undefined;const n=e.substring(0,10).toLowerCase();for(const r of[c,l,u,d])try{return t?.getMethodName?r.getFunction(n)?.name:r.parseTransaction({data:e})}catch{}return undefined}n.determineTransactionType=async function(e,t){const{data:n,to:r}=e;if(n&&!r)return{type:o.TransactionType.deployContract,getCodeResponse:undefined};let s,c=Boolean(n?.length);if(t){const e=await async function(e,t){let n;try{n=await(0,a.query)(e,"getCode",[t])}catch(e){n=null}const r=!!n&&("0x"!==n&&"0x0"!==n&&!n.startsWith(i.DELEGATION_PREFIX));return{contractCode:n,isContractAddress:r}}(t,r);s=e.contractCode,c=e.isContractAddress}if(!c)return{type:o.TransactionType.simpleSend,getCodeResponse:s};const l=0!==Number(e.value??"0"),u={type:o.TransactionType.contractInteraction,getCodeResponse:s};if(!n||l)return u;const d=function(e){return h(e,{getMethodName:!0})}(n);if(!d)return u;const f=[o.TransactionType.tokenMethodApprove,o.TransactionType.tokenMethodSetApprovalForAll,o.TransactionType.tokenMethodTransfer,o.TransactionType.tokenMethodTransferFrom,o.TransactionType.tokenMethodSafeTransferFrom,o.TransactionType.tokenMethodIncreaseAllowance].find(e=>e.toLowerCase()===d.toLowerCase());return f?{type:f,getCodeResponse:s}:u},n.decodeTransactionData=h}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/transaction-type.cjs"}],[3106,{"../types.cjs":3087,"@metamask/utils":3207,"bn.js":4115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setEnvelopeType=n.getPercentageChange=n.toBN=n.bnFromHex=n.padHexToEvenLength=n.normalizeGasFeeValues=n.normalizeTxError=n.validateIfTransactionUnapproved=n.validateGasValues=n.isEIP1559Transaction=n.normalizeTransactionParams=n.ESTIMATE_GAS_ERROR=void 0;const a=e("@metamask/utils"),s=r(e("bn.js")),i=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const o={accessList:e=>e,authorizationList:e=>e,data:e=>(0,a.add0x)(l(e)),from:e=>(0,a.add0x)(e).toLowerCase(),gas:e=>(0,a.add0x)(e),gasLimit:e=>(0,a.add0x)(e),gasPrice:e=>(0,a.add0x)(e),nonce:e=>(0,a.add0x)(e),to:e=>(0,a.add0x)(e).toLowerCase(),value:e=>(0,a.add0x)(e),maxFeePerGas:e=>(0,a.add0x)(e),maxPriorityFeePerGas:e=>(0,a.add0x)(e),estimatedBaseFee:e=>(0,a.add0x)(e),type:e=>(0,a.add0x)(e)};n.normalizeTransactionParams=function(e){const t={from:""};for(const n of(0,a.getKnownPropertyNames)(o))e[n]&&(t[n]=o[n](e[n]));return t.value??(t.value="0x0"),t.gasLimit&&!t.gas&&(t.gas=t.gasLimit),t},n.isEIP1559Transaction=function(e){const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);return t(e,"maxFeePerGas")&&t(e,"maxPriorityFeePerGas")};function c(e){try{return JSON.parse(JSON.stringify(e)),!0}catch{return!1}}function l(e){const t=e.toLowerCase().startsWith("0x")?e.slice(0,2):"",n=t?e.slice(2):e;return t+(n.length%2==0?n:`0${n}`)}function u(e){const t=e,n=t.startsWith("0x")||t.startsWith("0X")?t.slice(2):t;return 0===n.length?new s.default(0):new s.default(n,16)}n.validateGasValues=e=>{Object.keys(e).forEach(t=>{const n=e[t];if("string"!=typeof n||!(0,a.isStrictHexString)(n))throw new TypeError(`expected hex string for ${t} but received: ${n}`)})},n.validateIfTransactionUnapproved=function(e,t){if(e?.status!==i.TransactionStatus.unapproved)throw new Error(`TransactionsController: Can only call ${t} on an unapproved transaction.\n      Current tx status: ${e?.status}`)},n.normalizeTxError=function(e){return{name:e.name,message:e.message,stack:e.stack,code:e.code,rpc:c(e.value)?e.value:undefined}},n.normalizeGasFeeValues=function(e){const t=e=>"string"==typeof e?(0,a.add0x)(e):e;return"gasPrice"in e?{gasPrice:t(e.gasPrice)}:{maxFeePerGas:t(e.maxFeePerGas),maxPriorityFeePerGas:t(e.maxPriorityFeePerGas)}},n.padHexToEvenLength=l,n.bnFromHex=u,n.toBN=function(e){if(e instanceof s.default)return e;if("function"==typeof s.default.isBN&&s.default.isBN(e))return e;if(null!==e&&"object"==typeof e&&"function"==typeof e.toHexString)return u(e.toHexString());if(null!==e&&"object"==typeof e&&"string"==typeof e._hex)return u(e._hex);if("string"==typeof e)return u(e);if("bigint"==typeof e)return new s.default(e.toString());if("number"==typeof e)return new s.default(e);throw new Error("Unexpected value returned from oracle contract")},n.getPercentageChange=function(e,t){const n=new s.default(10).pow(new s.default(18)),r=e.mul(n),a=t.mul(n),i=a.sub(r);return i.isZero()?0:r.isZero()&&!a.isZero()?100:i.muln(100).div(r).abs().toNumber()},n.setEnvelopeType=function(e,t){e.accessList?e.type=i.TransactionEnvelopeType.accessList:e.authorizationList?e.type=i.TransactionEnvelopeType.setCode:e.type=t?i.TransactionEnvelopeType.feeMarket:i.TransactionEnvelopeType.legacy}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/utils.cjs"}],[3107,{"../types.cjs":3087,"./utils.cjs":3106,"@ethersproject/abi":748,"@metamask/controller-utils":1488,"@metamask/metamask-eth-abis":2370,"@metamask/rpc-errors":2692,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateBatchRequest=n.validateParamTo=n.validateTxParams=n.validateTransactionOrigin=n.ErrorCode=void 0;const r=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("@metamask/rpc-errors"),o=e("@metamask/utils"),c=e("./utils.cjs"),l=e("../types.cjs");var u;!function(e){e[e.DuplicateBundleId=5720]="DuplicateBundleId",e[e.BundleTooLarge=5740]="BundleTooLarge",e[e.RejectedUpgrade=5750]="RejectedUpgrade"}(u||(n.ErrorCode=u={}));const d=[l.TransactionEnvelopeType.feeMarket,l.TransactionEnvelopeType.setCode];function h(e,t){const n=e.type;switch(t){case"authorizationList":if(n&&n!==l.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including authorizationList requires type: "${l.TransactionEnvelopeType.setCode}"`);break;case"maxFeePerGas":case"maxPriorityFeePerGas":if(n&&!d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${d.join(", ")}"`);break;default:if(n&&d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`)}}function f(e,t,n){if(void 0!==e[n])throw i.rpcErrors.invalidParams(`Invalid transaction params: specified ${t} but also included ${n}, these cannot be mixed`)}function m(e,t){const n=e[t];if("string"!=typeof n||!(0,o.isStrictHexString)(n))throw i.rpcErrors.invalidParams(`Invalid transaction params: ${String(t)} is not a valid hexadecimal string. got: (${String(n)})`)}function p(e){m(e,"address"),function(e,t,n){const r=(0,o.remove0x)(e).length/2;if(r!==t)throw i.rpcErrors.invalidParams(`Invalid transaction params: ${n} must be ${t} bytes. got: ${r} bytes`)}(e.address,20,"address");for(const t of["chainId","nonce","r","s"])e[t]&&m(e,t);const{yParity:t}=e;if(t&&!["0x0","0x1"].includes(t))throw i.rpcErrors.invalidParams(`Invalid transaction params: yParity must be '0x0' or '0x1'. got: ${t}`)}n.validateTransactionOrigin=async function({data:e,from:t,internalAccounts:n,origin:r,permittedAddresses:s,txParams:o,type:c}){if(!r||r===a.ORIGIN_METAMASK)return;const{authorizationList:u,to:d,type:h}=o;if(s&&!s.includes(t))throw i.providerErrors.unauthorized({data:{origin:r}});if(c===l.TransactionType.batch)return;if(u||h===l.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams("External EIP-7702 transactions are not supported");if(Boolean(e&&"0x"!==e)&&n?.some(e=>e.toLowerCase()===d?.toLowerCase()))throw i.rpcErrors.invalidParams("External transactions to internal accounts cannot include data")},n.validateTxParams=function(e,t=!0,n){!function(e){if(e&&!Object.values(l.TransactionEnvelopeType).includes(e))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: "${e}". Must be one of: ${Object.values(l.TransactionEnvelopeType).join(", ")}`)}(e.type),function(e,t){if((0,c.isEIP1559Transaction)(e)&&!t)throw i.rpcErrors.invalidParams("Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559")}(e,t),function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams(`Invalid "from" address ${e}: not a string.`);if(!(0,a.isValidHexAddress)(e))throw i.rpcErrors.invalidParams('Invalid "from" address.')}(e.from),function(e){if("0x"===e.to||e.to===undefined){if(!e.data)throw i.rpcErrors.invalidParams('Invalid "to" address.');delete e.to}else if(e.to!==undefined&&!(0,a.isValidHexAddress)(e.to))throw i.rpcErrors.invalidParams('Invalid "to" address.')}(e),function(e){if(e!==undefined){if(e.includes("-"))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": not a positive number.`);if(e.includes("."))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": number must be in wei.`);const t=parseInt(e,10);if(!(Number.isFinite(t)&&!Number.isNaN(t)&&!isNaN(Number(e))&&Number.isSafeInteger(t)))throw i.rpcErrors.invalidParams(`Invalid transaction value ${e}: number must be a valid number.`)}}(e.value),function(e){if(e){const t=new r.Interface(s.abiERC20);try{t.parseTransaction({data:e})}catch(e){if(e.message.match(/BUFFER_OVERRUN/u))throw i.rpcErrors.invalidParams("Invalid transaction params: data out-of-bounds, BUFFER_OVERRUN.")}}}(e.data),function(e,t){if(e&&t&&e.toLowerCase?.()!==t.toLowerCase())throw i.rpcErrors.invalidParams(`Invalid transaction params: chainId must match the network client, got: ${e}, expected: ${t}`)}(e.chainId,n),function(e){e.gasPrice&&(h(e,"gasPrice"),f(e,"gasPrice","maxFeePerGas"),f(e,"gasPrice","maxPriorityFeePerGas"),m(e,"gasPrice"));e.maxFeePerGas&&(h(e,"maxFeePerGas"),f(e,"maxFeePerGas","gasPrice"),m(e,"maxFeePerGas"));e.maxPriorityFeePerGas&&(h(e,"maxPriorityFeePerGas"),f(e,"maxPriorityFeePerGas","gasPrice"),m(e,"maxPriorityFeePerGas"));e.gasLimit&&m(e,"gasLimit");e.gas&&m(e,"gas")}(e),function(e){const{authorizationList:t}=e;if(!t)return;if(h(e,"authorizationList"),!Array.isArray(t))throw i.rpcErrors.invalidParams("Invalid transaction params: authorizationList must be an array");for(const e of t)p(e)}(e)},n.validateParamTo=function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams('Invalid "to" address')},n.validateBatchRequest=function({internalAccounts:e,request:t,sizeLimit:n}){const{origin:r}=t,s=r&&r!==a.ORIGIN_METAMASK,o=e.map(e=>e.toLowerCase());if(s&&t.transactions.some(e=>{const t=e.params.to?.toLowerCase(),n=e.params.data,r=o.includes(t),a=Boolean(n&&"0x"!==n);return r&&a}))throw i.rpcErrors.invalidParams("External calls to internal accounts cannot include data");if(s&&t.transactions.length>n)throw new i.JsonRpcError(u.BundleTooLarge,`Batch size cannot exceed ${n}. got: ${t.transactions.length}`)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/validation.cjs"}],[3108,{"./determineGasFeeCalculations.cjs":3109,"./gas-util.cjs":3110,"@metamask/controller-utils":1488,"@metamask/eth-query":2073,"@metamask/polling-controller":2555,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.GasFeeController=n.GAS_ESTIMATE_TYPES=n.LEGACY_GAS_PRICES_API_URL=void 0;const l=e("@metamask/controller-utils"),u=c(e("@metamask/eth-query")),d=e("@metamask/polling-controller"),h=e("uuid"),f=c(e("./determineGasFeeCalculations.cjs")),m=e("./gas-util.cjs");n.LEGACY_GAS_PRICES_API_URL="https://api.metaswap.codefi.network/gasPrices",n.GAS_ESTIMATE_TYPES={FEE_MARKET:"fee-market",LEGACY:"legacy",ETH_GASPRICE:"eth_gasPrice",NONE:"none"};const p={gasFeeEstimatesByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasFeeEstimates:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},estimatedGasFeeTimeBounds:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasEstimateType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},nonRPCGasFeeApisDisabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}},g={gasFeeEstimatesByChainId:{},gasFeeEstimates:{},estimatedGasFeeTimeBounds:{},gasEstimateType:n.GAS_ESTIMATE_TYPES.NONE,nonRPCGasFeeApisDisabled:!1};class w extends((0,d.StaticIntervalPollingController)()){constructor({interval:e=15e3,messenger:t,state:c,getCurrentNetworkEIP1559Compatibility:l,getCurrentAccountEIP1559Compatibility:d,getChainId:h,getCurrentNetworkLegacyGasAPICompatibility:f,getProvider:m,onNetworkDidChange:w,legacyAPIEndpoint:b=n.LEGACY_GAS_PRICES_API_URL,EIP1559APIEndpoint:T,clientId:E}){if(super({name:"GasFeeController",metadata:p,messenger:t,state:{...g,...c}}),r.add(this),a.set(this,void 0),this.intervalDelay=e,this.setIntervalLength(e),this.pollTokens=new Set,this.getCurrentNetworkEIP1559Compatibility=l,this.getCurrentNetworkLegacyGasAPICompatibility=f,this.getCurrentAccountEIP1559Compatibility=d,i(this,a,m,"f"),this.EIP1559APIEndpoint=T,this.legacyAPIEndpoint=b,this.clientId=E,this.ethQuery=new u.default(o(this,a,"f").call(this)),w&&h)this.currentChainId=h(),w(async e=>{await o(this,r,"m",s).call(this,e)});else{const{selectedNetworkClientId:e}=this.messenger.call("NetworkController:getState");this.currentChainId=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId,this.messenger.subscribe("NetworkController:networkDidChange",async e=>{await o(this,r,"m",s).call(this,e)})}}async resetPolling(){if(0!==this.pollTokens.size){const e=Array.from(this.pollTokens);this.stopPolling(),await this.getGasFeeEstimatesAndStartPolling(e[0]),e.slice(1).forEach(e=>{this.pollTokens.add(e)})}}async fetchGasFeeEstimates(e){return await this._fetchGasFeeEstimateData(e)}async getGasFeeEstimatesAndStartPolling(e){const t=e||(0,h.v1)();return this.pollTokens.add(t),1===this.pollTokens.size&&(await this._fetchGasFeeEstimateData(),this._poll()),t}async _fetchGasFeeEstimateData(e={}){const{shouldUpdateState:t=!0,networkClientId:n}=e;let r,a,s,i;if(n!==undefined){const e=this.messenger.call("NetworkController:getNetworkClientById",n);s="0x38"===e.configuration.chainId,i=(0,l.convertHexToDecimal)(e.configuration.chainId);try{a=await this.messenger.call("NetworkController:getEIP1559Compatibility",n)||!1}catch{a=!1}r=new u.default(e.provider)}r??(r=this.ethQuery),s??(s=this.getCurrentNetworkLegacyGasAPICompatibility()),i??(i=(0,l.convertHexToDecimal)(this.currentChainId));try{a??(a=await this.getEIP1559Compatibility())}catch(e){console.error(e),a??(a=!1)}const o=await(0,f.default)({isEIP1559Compatible:a,isLegacyGasAPICompatible:s,fetchGasEstimates:m.fetchGasEstimates,fetchGasEstimatesUrl:this.EIP1559APIEndpoint.replace("<chain_id>",`${i}`),fetchLegacyGasPriceEstimates:m.fetchLegacyGasPriceEstimates,fetchLegacyGasPriceEstimatesUrl:this.legacyAPIEndpoint.replace("<chain_id>",`${i}`),fetchEthGasPriceEstimate:m.fetchEthGasPriceEstimate,calculateTimeEstimate:m.calculateTimeEstimate,clientId:this.clientId,ethQuery:r,nonRPCGasFeeApisDisabled:this.state.nonRPCGasFeeApisDisabled});if(t){const e=(0,l.toHex)(i);this.update(t=>{this.currentChainId===e&&(t.gasFeeEstimates=o.gasFeeEstimates,t.estimatedGasFeeTimeBounds=o.estimatedGasFeeTimeBounds,t.gasEstimateType=o.gasEstimateType),t.gasFeeEstimatesByChainId??(t.gasFeeEstimatesByChainId={}),t.gasFeeEstimatesByChainId[e]={gasFeeEstimates:o.gasFeeEstimates,estimatedGasFeeTimeBounds:o.estimatedGasFeeTimeBounds,gasEstimateType:o.gasEstimateType}})}return o}disconnectPoller(e){this.pollTokens.delete(e),0===this.pollTokens.size&&this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId),this.pollTokens.clear(),this.resetState()}destroy(){super.destroy(),this.stopPolling()}_poll(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{await(0,l.safelyExecute)(()=>this._fetchGasFeeEstimateData())},this.intervalDelay)}async _executePoll({networkClientId:e}){await this._fetchGasFeeEstimateData({networkClientId:e})}resetState(){this.update(()=>g)}async getEIP1559Compatibility(){const e=await this.getCurrentNetworkEIP1559Compatibility(),t=this.getCurrentAccountEIP1559Compatibility?.()??!0;return e&&t}getTimeEstimate(e,t){return this.state.gasFeeEstimates&&this.state.gasEstimateType===n.GAS_ESTIMATE_TYPES.FEE_MARKET?(0,m.calculateTimeEstimate)(e,t,this.state.gasFeeEstimates):{}}enableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!1})}disableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!0})}}n.GasFeeController=w,a=new WeakMap,r=new WeakSet,s=async function({selectedNetworkClientId:e}){const t=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId;t!==this.currentChainId&&(this.ethQuery=new u.default(o(this,a,"f").call(this)),await this.resetPolling(),this.currentChainId=t)},n.default=w}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/GasFeeController.cjs"}],[3109,{"./GasFeeController.cjs":3108},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("./GasFeeController.cjs");n.default=async function(e){try{return await async function(e){const{isEIP1559Compatible:t,isLegacyGasAPICompatible:n,nonRPCGasFeeApisDisabled:a}=e;try{if(t&&!a)return await async function(e){const{fetchGasEstimates:t,fetchGasEstimatesUrl:n,clientId:a,calculateTimeEstimate:s}=e,i=await t(n,a),{suggestedMaxPriorityFeePerGas:o,suggestedMaxFeePerGas:c}=i.medium,l=s(o,c,i);return{gasFeeEstimates:i,estimatedGasFeeTimeBounds:l,gasEstimateType:r.GAS_ESTIMATE_TYPES.FEE_MARKET}}(e);if(n&&!a)return await async function(e){const{fetchLegacyGasPriceEstimates:t,fetchLegacyGasPriceEstimatesUrl:n,clientId:a}=e;return{gasFeeEstimates:await t(n,a),estimatedGasFeeTimeBounds:{},gasEstimateType:r.GAS_ESTIMATE_TYPES.LEGACY}}(e);throw new Error("Main gas fee/price estimation failed. Use fallback")}catch{return await async function(e){const{ethQuery:t,fetchEthGasPriceEstimate:n}=e;return{gasFeeEstimates:await n(t),estimatedGasFeeTimeBounds:{},gasEstimateType:r.GAS_ESTIMATE_TYPES.ETH_GASPRICE}}(e)}}(e)}catch(e){if(e instanceof Error)throw new Error(`Gas fee/price estimation failed. Message: ${e.message}`);throw e}}}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/determineGasFeeCalculations.cjs"}],[3110,{"@metamask/controller-utils":1488,"bn.js":4115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTimeEstimate=n.fetchEthGasPriceEstimate=n.fetchLegacyGasPriceEstimates=n.fetchGasEstimates=n.normalizeGWEIDecimalNumbers=void 0;const a=e("@metamask/controller-utils"),s=r(e("bn.js")),i=e=>({"X-Client-Id":e});function o(e){const t=(0,a.gweiDecToWEIBN)(e).toString(16);return(0,a.weiHexToGweiDec)(t)}n.normalizeGWEIDecimalNumbers=o,n.fetchGasEstimates=async function(e,t){const n=await(0,a.handleFetch)(e,t?{headers:i(t)}:undefined);return{low:{...n.low,suggestedMaxPriorityFeePerGas:o(n.low.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.low.suggestedMaxFeePerGas)},medium:{...n.medium,suggestedMaxPriorityFeePerGas:o(n.medium.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.medium.suggestedMaxFeePerGas)},high:{...n.high,suggestedMaxPriorityFeePerGas:o(n.high.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.high.suggestedMaxFeePerGas)},estimatedBaseFee:o(n.estimatedBaseFee),historicalBaseFeeRange:n.historicalBaseFeeRange,baseFeeTrend:n.baseFeeTrend,latestPriorityFeeRange:n.latestPriorityFeeRange,historicalPriorityFeeRange:n.historicalPriorityFeeRange,priorityFeeTrend:n.priorityFeeTrend,networkCongestion:n.networkCongestion}},n.fetchLegacyGasPriceEstimates=async function(e,t){const n=await(0,a.handleFetch)(e,{referrer:e,referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors",headers:{"Content-Type":"application/json",...t&&i(t)}});return{low:n.SafeGasPrice,medium:n.ProposeGasPrice,high:n.FastGasPrice}},n.fetchEthGasPriceEstimate=async function(e){const t=await(0,a.query)(e,"gasPrice");return{gasPrice:(0,a.weiHexToGweiDec)(t).toString()}},n.calculateTimeEstimate=function(e,t,n){const{low:r,medium:i,high:o,estimatedBaseFee:c}=n,l=(0,a.gweiDecToWEIBN)(e),u=(0,a.gweiDecToWEIBN)(t),d=(0,a.gweiDecToWEIBN)(c),h=s.default.min(l,u.sub(d)),f=(0,a.gweiDecToWEIBN)(r.suggestedMaxPriorityFeePerGas),m=(0,a.gweiDecToWEIBN)(i.suggestedMaxPriorityFeePerGas),p=(0,a.gweiDecToWEIBN)(o.suggestedMaxPriorityFeePerGas);let g,w;return h.lt(f)?(g=null,w="unknown"):h.gte(f)&&h.lt(m)?(g=r.minWaitTimeEstimate,w=r.maxWaitTimeEstimate):h.gte(m)&&h.lt(p)?(g=i.minWaitTimeEstimate,w=i.maxWaitTimeEstimate):h.eq(p)?(g=o.minWaitTimeEstimate,w=o.maxWaitTimeEstimate):(g=0,w=o.maxWaitTimeEstimate),{lowerTimeBound:g,upperTimeBound:w}}}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/gas-util.cjs"}],[3111,{"./GasFeeController.cjs":3108},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./GasFeeController.cjs"),n)}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/index.cjs"}],[3112,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,s=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,f=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,r=1,a=e.length,s=e[0]+"";r<a;){for(t=e[r++]+"",n=l-t.length;n--;t="0"+t);s+=t}for(a=s.length;48===s.charCodeAt(--a););return s.slice(0,a+1||1)}function g(e,t){var n,r,a=e.c,s=t.c,i=e.s,o=t.s,c=e.e,l=t.e;if(!i||!o)return null;if(n=a&&!a[0],r=s&&!s[0],n||r)return n?r?0:-o:i;if(i!=o)return i;if(n=i<0,r=c==l,!a||!s)return r?0:!a^n?1:-1;if(!r)return c>l^n?1:-1;for(o=(c=a.length)<(l=s.length)?c:l,i=0;i<o;i++)if(a[i]!=s[i])return a[i]>s[i]^n?1:-1;return c==l?0:c>l^n?1:-1}function w(e,t,n,r){if(e<t||e>n||e!==s(e))throw Error(i+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function b(e){var t=e.c.length-1;return m(e.e/l)==t&&e.c[t]%2!=0}function T(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function E(e,t,n){var r,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(r=e.length)){for(a=n,t-=r;--t;a+=n);e+=a}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,y,S,I,k,A,C,_,P,v,N=W.prototype={constructor:W,toString:null,valueOf:null},R=new W(1),j=20,O=4,x=-7,L=21,M=-1e7,F=1e7,D=!1,B=1,G=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",q=!0;function W(e,t){var n,a,i,c,d,h,f,m,p=this;if(!(p instanceof W))return new W(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>F?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>F?p.c=p.e=null:(p.e=c,p.c=[e]))}m=String(e)}else{if(!r.test(m=String(e)))return S(p,m,h);p.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(w(t,2,H.length,"Base"),10==t&&q)return Y(p=new W(e),j+p.e+1,O);if(m=String(e),h="number"==typeof e){if(0*e!=0)return S(p,m,h,t);if(p.s=1/e<0?(m=m.slice(1),-1):1,W.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,f=m.length;d<f;d++)if(n.indexOf(a=m.charAt(d))<0){if("."==a){if(d>c){c=f;continue}}else if(!i&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){i=!0,d=-1,c=0;continue}return S(p,String(e),h,t)}h=!1,(c=(m=y(m,t,10,p.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(f=m.length;48===m.charCodeAt(--f););if(m=m.slice(d,++f)){if(f-=d,h&&W.DEBUG&&f>15&&(e>u||e!==s(e)))throw Error(o+p.s*e);if((c=c-d-1)>F)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%l,c<0&&(d+=l),d<f){for(d&&p.c.push(+m.slice(0,d)),f-=l;d<f;)p.c.push(+m.slice(d,d+=l));d=l-(m=m.slice(d)).length}else d-=f;for(;d--;m+="0");p.c.push(+m)}}else p.c=[p.e=0]}function $(e,t,n,r){var a,s,i,o,c;if(null==n?n=O:w(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=p(e.c),c=1==r||2==r&&(i<=x||i>=L)?T(c,i):E(c,i,"0");else if(s=(e=Y(new W(e),t,n)).e,o=(c=p(e.c)).length,1==r||2==r&&(t<=s||s<=x)){for(;o<t;c+="0",o++);c=T(c,s)}else if(t-=i,c=E(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function K(e,t){for(var n,r,a=1,s=new W(e[0]);a<e.length;a++)(!(r=new W(e[a])).s||(n=g(s,r))===t||0===n&&s.s===t)&&(s=r);return s}function V(e,t,n){for(var r=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,r++);return(n=r+n*l-1)>F?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function Y(e,t,n,r){var i,o,u,h,f,m,p,g=e.c,w=d;if(g){e:{for(i=1,h=g[0];h>=10;h/=10,i++);if((o=t-i)<0)o+=l,u=t,f=g[m=0],p=s(f/w[i-u-1]%10);else if((m=a((o+1)/l))>=g.length){if(!r)break e;for(;g.length<=m;g.push(0));f=p=0,i=1,u=(o%=l)-l+1}else{for(f=h=g[m],i=1;h>=10;h/=10,i++);p=(u=(o%=l)-l+i)<0?0:s(f/w[i-u-1]%10)}if(r=r||t<0||null!=g[m+1]||(u<0?f:f%w[i-u-1]),r=n<4?(p||r)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||r||6==n&&(o>0?u>0?f/w[i-u]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,r?(t-=e.e+1,g[0]=w[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,h=1,m--):(g.length=m+1,h=w[l-o],g[m]=u>0?s(f/w[i-u]%w[u])*h:0),r)for(;;){if(0==m){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=h,h=1;u>=10;u/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=h,g[m]!=c)break;g[m--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>F?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function z(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=x||n>=L?T(t,n):E(t,n,"0"),e.s<0?"-"+t:t)}return W.clone=e,W.ROUND_UP=0,W.ROUND_DOWN=1,W.ROUND_CEIL=2,W.ROUND_FLOOR=3,W.ROUND_HALF_UP=4,W.ROUND_HALF_DOWN=5,W.ROUND_HALF_EVEN=6,W.ROUND_HALF_CEIL=7,W.ROUND_HALF_FLOOR=8,W.EUCLID=9,W.config=W.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(w(n=e[t],0,f,t),j=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(w(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(w(n[0],-f,0,t),w(n[1],0,f,t),x=n[0],L=n[1]):(w(n,-f,f,t),x=-(L=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)w(n[0],-f,-1,t),w(n[1],1,f,t),M=n[0],F=n[1];else{if(w(n,-f,f,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(F=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw D=!n,Error(i+"crypto unavailable");D=n}else D=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(w(n=e[t],0,9,t),B=n),e.hasOwnProperty(t="POW_PRECISION")&&(w(n=e[t],0,f,t),G=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);q="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:j,ROUNDING_MODE:O,EXPONENTIAL_AT:[x,L],RANGE:[M,F],CRYPTO:D,MODULO_MODE:B,POW_PRECISION:G,FORMAT:U,ALPHABET:H}},W.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!W.DEBUG)return!0;var t,n,r=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&a>=-f&&a<=f&&a===s(a)){if(0===r[0]){if(0===a&&1===r.length)return!0;break e}if((t=(a+1)%l)<1&&(t+=l),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=c||n!==s(n))break e;if(0!==n)return!0}}}else if(null===r&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},W.maximum=W.max=function(){return K(arguments,-1)},W.minimum=W.min=function(){return K(arguments,1)},W.random=(I=9007199254740992,k=Math.random()*I&2097151?function(){return s(Math.random()*I)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,o,c,u=0,h=[],m=new W(R);if(null==e?e=j:w(e,0,f),o=a(e/l),D)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(h.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw D=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=o/7}if(!D)for(;u<o;)(c=k())<9e15&&(h[u++]=c%1e14);for(o=h[--u],e%=l,o&&e&&(c=d[l-e],h[u]=s(o/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[r=0];else{for(r=-1;0===h[0];h.splice(0,1),r-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(r-=l-u)}return m.e=r,m.c=h,m}),W.sum=function(){for(var e=1,t=arguments,n=new W(t[0]);e<t.length;)n=n.plus(t[e++]);return n},y=function(){var e="0123456789";function t(e,t,n,r){for(var a,s,i=[0],o=0,c=e.length;o<c;){for(s=i.length;s--;i[s]*=t);for(i[0]+=r.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(r,a,s,i,o){var c,l,u,d,h,f,m,g,w=r.indexOf("."),b=j,T=O;for(w>=0&&(d=G,G=0,r=r.replace(".",""),f=(g=new W(a)).pow(r.length-w),G=d,g.c=t(E(p(f.c),f.e,"0"),10,s,e),g.e=g.c.length),u=d=(m=t(r,a,s,o?(c=H,e):(c=e,H))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(w<0?--u:(f.c=m,f.e=u,f.s=i,m=(f=n(f,g,b,T,s)).c,h=f.r,u=f.e),w=m[l=u+b+1],d=s/2,h=h||l<0||null!=m[l+1],h=T<4?(null!=w||h)&&(0==T||T==(f.s<0?3:2)):w>d||w==d&&(4==T||h||6==T&&1&m[l-1]||T==(f.s<0?8:7)),l<1||!m[0])r=h?E(c.charAt(1),-b,c.charAt(0)):c.charAt(0);else{if(m.length=l,h)for(--s;++m[--l]>s;)m[l]=0,l||(++u,m=[1].concat(m));for(d=m.length;!m[--d];);for(w=0,r="";w<=d;r+=c.charAt(m[w++]));r=E(r,u,c.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,a,s,i,o=0,c=e.length,l=t%h,u=t/h|0;for(e=e.slice();c--;)o=((a=l*(s=e[c]%h)+(r=u*s+(i=e[c]/h|0)*l)%h*h+o)/n|0)+(r/h|0)+u*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,r){var a,s;if(n!=r)s=n>r?1:-1;else for(a=s=0;a<n;a++)if(e[a]!=t[a]){s=e[a]>t[a]?1:-1;break}return s}function n(e,t,n,r){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,a,i,o,u){var d,h,f,p,g,w,b,T,E,y,S,I,k,A,C,_,P,v=r.s==a.s?1:-1,N=r.c,R=a.c;if(!(N&&N[0]&&R&&R[0]))return new W(r.s&&a.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*v:v/0:NaN);for(E=(T=new W(v)).c=[],v=i+(h=r.e-a.e)+1,u||(u=c,h=m(r.e/l)-m(a.e/l),v=v/l|0),f=0;R[f]==(N[f]||0);f++);if(R[f]>(N[f]||0)&&h--,v<0)E.push(1),p=!0;else{for(A=N.length,_=R.length,f=0,v+=2,(g=s(u/(R[0]+1)))>1&&(R=e(R,g,u),N=e(N,g,u),_=R.length,A=N.length),k=_,S=(y=N.slice(0,_)).length;S<_;y[S++]=0);P=R.slice(),P=[0].concat(P),C=R[0],R[1]>=u/2&&C++;do{if(g=0,(d=t(R,y,_,S))<0){if(I=y[0],_!=S&&(I=I*u+(y[1]||0)),(g=s(I/C))>1)for(g>=u&&(g=u-1),b=(w=e(R,g,u)).length,S=y.length;1==t(w,y,b,S);)g--,n(w,_<b?P:R,b,u),b=w.length,d=1;else 0==g&&(d=g=1),b=(w=R.slice()).length;if(b<S&&(w=[0].concat(w)),n(y,w,S,u),S=y.length,-1==d)for(;t(R,y,_,S)<1;)g++,n(y,_<S?P:R,S,u),S=y.length}else 0===d&&(g++,y=[0]);E[f++]=g,y[0]?y[S++]=N[k]||0:(y=[N[k]],S=1)}while((k++<A||null!=y[0])&&v--);p=null!=y[0],E[0]||E.splice(0,1)}if(u==c){for(f=1,v=E[0];v>=10;v/=10,f++);Y(T,i+(T.e=f+h*l-1)+1,o,p)}else T.e=h,T.r=+p;return T}}(),A=/^(-?)0([xbo])(?=\w[\w.]*$)/i,C=/^([^.]+)\.$/,_=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,n,r){var a,s=n?t:t.replace(v,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!n&&(s=s.replace(A,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=a?e:t}),r&&(a=r,s=s.replace(C,"$1").replace(_,"0.$1")),t!=s))return new W(s,a);if(W.DEBUG)throw Error(i+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new W(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return g(this,new W(e,t))},N.decimalPlaces=N.dp=function(e,t){var n,r,a,s=this;if(null!=e)return w(e,0,f),null==t?t=O:w(t,0,8),Y(new W(s),e+s.e+1,t);if(!(n=s.c))return null;if(r=((a=n.length-1)-m(this.e/l))*l,a=n[a])for(;a%10==0;a/=10,r--);return r<0&&(r=0),r},N.dividedBy=N.div=function(e,t){return n(this,new W(e,t),j,O)},N.dividedToIntegerBy=N.idiv=function(e,t){return n(this,new W(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var n,r,o,c,u,d,h,f,m=this;if((e=new W(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+z(e));if(null!=t&&(t=new W(t)),u=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return f=new W(Math.pow(+z(m),u?e.s*(2-b(e)):+z(e))),t?f.mod(t):f;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new W(NaN);(r=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||u&&m.c[1]>=24e7:m.c[0]<8e13||u&&m.c[0]<=9999975e7)))return c=m.s<0&&b(e)?-0:0,m.e>-1&&(c=1/c),new W(d?1/c:c);G&&(c=a(G/l+2))}for(u?(n=new W(.5),d&&(e.s=1),h=b(e)):h=(o=Math.abs(+z(e)))%2,f=new W(R);;){if(h){if(!(f=f.times(m)).c)break;c?f.c.length>c&&(f.c.length=c):r&&(f=f.mod(t))}if(o){if(0===(o=s(o/2)))break;h=o%2}else if(Y(e=e.times(n),e.e+1,1),e.e>14)h=b(e);else{if(0===(o=+z(e)))break;h=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):r&&(m=m.mod(t))}return r?f:(d&&(f=R.div(f)),t?f.mod(t):c?Y(f,G,O,undefined):f)},N.integerValue=function(e){var t=new W(this);return null==e?e=O:w(e,0,8),Y(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===g(this,new W(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return g(this,new W(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=g(this,new W(e,t)))||0===t},N.isInteger=function(){return!!this.c&&m(this.e/l)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return g(this,new W(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=g(this,new W(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var n,r,a,s,i=this,o=i.s;if(t=(e=new W(e,t)).s,!o||!t)return new W(NaN);if(o!=t)return e.s=-t,i.plus(e);var u=i.e/l,d=e.e/l,h=i.c,f=e.c;if(!u||!d){if(!h||!f)return h?(e.s=-t,e):new W(f?i:NaN);if(!h[0]||!f[0])return f[0]?(e.s=-t,e):new W(h[0]?i:3==O?-0:0)}if(u=m(u),d=m(d),h=h.slice(),o=u-d){for((s=o<0)?(o=-o,a=h):(d=u,a=f),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(r=(s=(o=h.length)<(t=f.length))?o:t,o=t=0;t<r;t++)if(h[t]!=f[t]){s=h[t]<f[t];break}if(s&&(a=h,h=f,f=a,e.s=-e.s),(t=(r=f.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;r>o;){if(h[--r]<f[r]){for(n=r;n&&!h[--n];h[n]=t);--h[n],h[r]+=c}h[r]-=f[r]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var r,a,s=this;return e=new W(e,t),!s.c||!e.s||e.c&&!e.c[0]?new W(NaN):!e.c||s.c&&!s.c[0]?new W(s):(9==B?(a=e.s,e.s=1,r=n(s,e,0,3),e.s=a,r.s*=a):r=n(s,e,0,B),(e=s.minus(r.times(e))).c[0]||1!=B||(e.s=s.s),e)},N.multipliedBy=N.times=function(e,t){var n,r,a,s,i,o,u,d,f,p,g,w,b,T,E,y=this,S=y.c,I=(e=new W(e,t)).c;if(!(S&&I&&S[0]&&I[0]))return!y.s||!e.s||S&&!S[0]&&!I||I&&!I[0]&&!S?e.c=e.e=e.s=null:(e.s*=y.s,S&&I?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=m(y.e/l)+m(e.e/l),e.s*=y.s,(u=S.length)<(p=I.length)&&(b=S,S=I,I=b,a=u,u=p,p=a),a=u+p,b=[];a--;b.push(0));for(T=c,E=h,a=p;--a>=0;){for(n=0,g=I[a]%E,w=I[a]/E|0,s=a+(i=u);s>a;)n=((d=g*(d=S[--i]%E)+(o=w*d+(f=S[i]/E|0)*g)%E*E+b[s]+n)/T|0)+(o/E|0)+w*f,b[s--]=d%T;b[s]=n}return n?++r:b.splice(0,1),V(e,b,r)},N.negated=function(){var e=new W(this);return e.s=-e.s||null,e},N.plus=function(e,t){var n,r=this,a=r.s;if(t=(e=new W(e,t)).s,!a||!t)return new W(NaN);if(a!=t)return e.s=-t,r.minus(e);var s=r.e/l,i=e.e/l,o=r.c,u=e.c;if(!s||!i){if(!o||!u)return new W(a/0);if(!o[0]||!u[0])return u[0]?e:new W(o[0]?r:0*a)}if(s=m(s),i=m(i),o=o.slice(),a=s-i){for(a>0?(i=s,n=u):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+u[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),V(e,o,i)},N.precision=N.sd=function(e,t){var n,r,a,s=this;if(null!=e&&e!==!!e)return w(e,1,f),null==t?t=O:w(t,0,8),Y(new W(s),e,t);if(!(n=s.c))return null;if(r=(a=n.length-1)*l+1,a=n[a]){for(;a%10==0;a/=10,r--);for(a=n[0];a>=10;a/=10,r++);}return e&&s.e+1>r&&(r=s.e+1),r},N.shiftedBy=function(e){return w(e,-9007199254740991,u),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,r,a,s,i=this,o=i.c,c=i.s,l=i.e,u=j+4,d=new W("0.5");if(1!==c||!o||!o[0])return new W(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+z(i)))||c==1/0?(((t=p(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=m((l+1)/2)-(l<0||l%2),r=new W(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):r=new W(c+""),r.c[0])for((c=(l=r.e)+u)<3&&(c=0);;)if(s=r,r=d.times(s.plus(n(i,s,u,1))),p(s.c).slice(0,c)===(t=p(r.c)).slice(0,c)){if(r.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(Y(r,r.e+j+2,1),e=!r.times(r).eq(i));break}if(!a&&(Y(s,s.e+j+2,0),s.times(s).eq(i))){r=s;break}u+=4,c+=4,a=1}return Y(r,r.e+j+1,O,e)},N.toExponential=function(e,t){return null!=e&&(w(e,0,f),e++),$(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(w(e,0,f),e=e+this.e+1),$(this,e,t)},N.toFormat=function(e,t,n){var r,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(r=a.toFixed(e,t),a.c){var s,o=r.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],h=o[1],f=a.s<0,m=f?d.slice(1):d,p=m.length;if(l&&(s=c,c=l,l=s,p-=s),c>0&&p>0){for(s=p%c||c,d=m.substr(0,s);s<p;s+=c)d+=u+m.substr(s,c);l>0&&(d+=u+m.slice(s)),f&&(d="-"+d)}r=h?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+r+(n.suffix||"")},N.toFraction=function(e){var t,r,a,s,o,c,u,h,f,m,g,w,b=this,T=b.c;if(null!=e&&(!(u=new W(e)).isInteger()&&(u.c||1!==u.s)||u.lt(R)))throw Error(i+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+z(u));if(!T)return new W(b);for(t=new W(R),f=r=new W(R),a=h=new W(R),w=p(T),o=t.e=w.length-b.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:f:u,c=F,F=1/0,u=new W(w),h.c[0]=0;m=n(u,t,0,1),1!=(s=r.plus(m.times(a))).comparedTo(e);)r=a,a=s,f=h.plus(m.times(s=f)),h=s,t=u.minus(m.times(s=t)),u=s;return s=n(e.minus(r),a,0,1),h=h.plus(s.times(f)),r=r.plus(s.times(a)),h.s=f.s=b.s,g=n(f,a,o*=2,O).minus(b).abs().comparedTo(n(h,r,o,O).minus(b).abs())<1?[f,a]:[h,r],F=c,g},N.toNumber=function(){return+z(this)},N.toPrecision=function(e,t){return null!=e&&w(e,1,f),$(this,e,t,2)},N.toString=function(e){var t,n=this,r=n.s,a=n.e;return null===a?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=a<=x||a>=L?T(p(n.c),a):E(p(n.c),a,"0"):10===e&&q?t=E(p((n=Y(new W(n),j+a+1,O)).c),n.e,"0"):(w(e,2,H.length,"Base"),t=y(E(p(n.c),a,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return z(this)},N._isBigNumber=!0,null!=t&&W.set(t),W}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/transaction-controller>bignumber.js",file:"node_modules/@metamask/transaction-controller/node_modules/bignumber.js/bignumber.js"}],[3113,{"./actions/update-payment-token.cjs":3114,"./constants.cjs":3115,"./helpers/QuoteRefresher.cjs":3116,"./utils/quotes.cjs":3130,"./utils/source-amounts.cjs":3132,"./utils/transaction.cjs":3136,"@metamask/base-controller":1401,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayController=void 0;const d=e("@metamask/base-controller"),h=e("lodash"),f=e("./actions/update-payment-token.cjs"),m=e("./constants.cjs"),p=e("./helpers/QuoteRefresher.cjs"),g=e("./utils/quotes.cjs"),w=e("./utils/source-amounts.cjs"),b=e("./utils/transaction.cjs"),T={transactionData:{includeInDebugSnapshot:!1,includeInStateLogs:!0,persist:!1,usedInUi:!0}};class E extends d.BaseController{constructor({getDelegationTransaction:e,getStrategy:t,messenger:n,state:d}){super({name:m.CONTROLLER_NAME,metadata:T,messenger:n,state:{transactionData:{},...d}}),r.add(this),a.set(this,void 0),s.set(this,void 0),l(this,a,e,"f"),l(this,s,t,"f"),u(this,r,"m",c).call(this),(0,b.pollTransactionChanges)(n,u(this,r,"m",o).bind(this),u(this,r,"m",i).bind(this)),new p.QuoteRefresher({messenger:n,updateTransactionData:u(this,r,"m",o).bind(this)})}setIsMaxAmount(e,t){u(this,r,"m",o).call(this,e,e=>{e.isMaxAmount=t})}updatePaymentToken(e){(0,f.updatePaymentToken)(e,{messenger:this.messenger,updateTransactionData:u(this,r,"m",o).bind(this)})}}n.TransactionPayController=E,a=new WeakMap,s=new WeakMap,r=new WeakSet,i=function(e){this.update(t=>{delete t.transactionData[e]})},o=function e(t,n){let a=!1;this.update(e=>{const{transactionData:r}=e;let s=r[t];const i=s?.paymentToken,o=s?.tokens,c=s?.isMaxAmount;s||(r[t]={isLoading:!1,tokens:[]},s=r[t]),n(s);const l=s.paymentToken!==i,u=s.tokens!==o,d=s.isMaxAmount!==c;(l||d||u)&&((0,w.updateSourceAmounts)(t,s,this.messenger),a=!0)}),a&&(0,g.updateQuotes)({messenger:this.messenger,transactionData:this.state.transactionData[t],transactionId:t,updateTransactionData:u(this,r,"m",e).bind(this)}).catch(h.noop)},c=function(){this.messenger.registerActionHandler("TransactionPayController:getDelegationTransaction",u(this,a,"f").bind(this)),this.messenger.registerActionHandler("TransactionPayController:getStrategy",u(this,s,"f")??(()=>m.TransactionPayStrategy.Relay)),this.messenger.registerActionHandler("TransactionPayController:setIsMaxAmount",this.setIsMaxAmount.bind(this)),this.messenger.registerActionHandler("TransactionPayController:updatePaymentToken",this.updatePaymentToken.bind(this))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/TransactionPayController.cjs"}],[3114,{"../logger.cjs":3119,"../utils/token.cjs":3134,"../utils/transaction.cjs":3136,"@metamask/utils":3207,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePaymentToken=void 0;const r=e("@metamask/utils"),a=e("bignumber.js"),s=e("../logger.cjs"),i=e("../utils/token.cjs"),o=e("../utils/transaction.cjs"),c=(0,r.createModuleLogger)(s.projectLogger,"update-payment-token");n.updatePaymentToken=function(e,t){const{transactionId:n,tokenAddress:r,chainId:s}=e,{messenger:l,updateTransactionData:u}=t,d=(0,o.getTransaction)(n,l);if(!d)throw new Error("Transaction not found");const h=function({chainId:e,from:t,messenger:n,tokenAddress:r}){const{decimals:s,symbol:o}=(0,i.getTokenInfo)(n,r,e)??{};if(s===undefined||!o)return undefined;const c=(0,i.getTokenFiatRate)(n,r,e);if(c===undefined)return undefined;const l=(0,i.getTokenBalance)(n,t,e,r),u=new a.BigNumber(l),d=new a.BigNumber(l).shiftedBy(-s),h=u.toFixed(0),f=d.toString(10),m=d.multipliedBy(c.fiatRate).toString(10),p=d.multipliedBy(c.usdRate).toString(10);return{address:r,balanceFiat:m,balanceHuman:f,balanceRaw:h,balanceUsd:p,chainId:e,decimals:s,symbol:o}}({chainId:s,from:d?.txParams.from,messenger:l,tokenAddress:r});if(!h)throw new Error("Payment token not found");c("Updated payment token",{transactionId:n,paymentToken:h}),u(n,e=>{e.paymentToken=h})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/actions/update-payment-token.cjs"}],[3115,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayStrategy=n.POLYGON_USDCE_ADDRESS=n.ARBITRUM_USDC_ADDRESS=n.NATIVE_TOKEN_ADDRESS=n.CHAIN_ID_POLYGON=n.CHAIN_ID_ARBITRUM=n.CONTROLLER_NAME=void 0,n.CONTROLLER_NAME="TransactionPayController",n.CHAIN_ID_ARBITRUM="0xa4b1",n.CHAIN_ID_POLYGON="0x89",n.NATIVE_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000",n.ARBITRUM_USDC_ADDRESS="0xaf88d065e77c8cC2239327C5EDb3A432268e5831",n.POLYGON_USDCE_ADDRESS="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",function(e){e.Bridge="bridge",e.Relay="relay",e.Test="test"}(r||(n.TransactionPayStrategy=r={}))}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/constants.cjs"}],[3116,{"../logger.cjs":3119,"../utils/quotes.cjs":3130,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteRefresher=void 0;const g=e("@metamask/utils"),w=e("lodash"),b=e("../logger.cjs"),T=e("../utils/quotes.cjs"),E=(0,g.createModuleLogger)(b.projectLogger,"quote-refresh");n.QuoteRefresher=class{constructor({messenger:e,updateTransactionData:t}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),m(this,i,e,"f"),m(this,a,!1,"f"),m(this,s,!1,"f"),m(this,c,t,"f"),e.subscribe("TransactionPayController:stateChange",p(this,r,"m",f).bind(this))}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,r=new WeakSet,l=function(){m(this,a,!0,"f"),E("Started"),p(this,s,"f")||p(this,r,"m",h).call(this)},u=function(){p(this,o,"f")&&clearTimeout(p(this,o,"f")),m(this,a,!1,"f"),E("Stopped")},d=async function(){m(this,s,!0,"f");try{await(0,T.refreshQuotes)(p(this,i,"f"),p(this,c,"f"))}catch(e){E("Error refreshing quotes",e)}finally{m(this,s,!1,"f"),p(this,r,"m",h).call(this)}},h=function(){p(this,a,"f")&&(p(this,o,"f")&&clearTimeout(p(this,o,"f")),m(this,o,setTimeout(()=>{p(this,r,"m",d).call(this).catch(w.noop)},1e3),"f"))},f=function(e){const t=Object.values(e.transactionData).some(e=>Boolean(e.quotes?.length));t&&!p(this,a,"f")?p(this,r,"m",l).call(this):!t&&p(this,a,"f")&&p(this,r,"m",u).call(this)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/QuoteRefresher.cjs"}],[3117,{"../logger.cjs":3119,"../utils/strategy.cjs":3133,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),h=e("../utils/strategy.cjs"),f=(0,u.createModuleLogger)(d.projectLogger,"pay-publish-hook"),m={transactionHash:undefined};n.TransactionPayPublishHook=class{constructor({isSmartTransaction:e,messenger:t}){r.add(this),a.set(this,void 0),s.set(this,void 0),c(this,a,e,"f"),c(this,s,t,"f")}getHook(){return l(this,r,"m",i).bind(this)}},a=new WeakMap,s=new WeakMap,r=new WeakSet,i=async function(e,t){try{return await l(this,r,"m",o).call(this,e,t)}catch(e){throw f("Error",e),e}},o=async function(e,t){const{id:n}=e,r=l(this,s,"f").call("TransactionPayController:getState"),i=r.transactionData?.[n]?.quotes??[];if(!i?.length)return f("Skipping as no quotes found"),m;const o=(0,h.getStrategy)(l(this,s,"f"),e);return await o.execute({isSmartTransaction:l(this,a,"f"),quotes:i,messenger:l(this,s,"f"),transaction:e})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/TransactionPayPublishHook.cjs"}],[3118,{"./TransactionPayController.cjs":3113,"./constants.cjs":3115,"./helpers/TransactionPayPublishHook.cjs":3117},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=n.TransactionPayController=n.TransactionPayStrategy=void 0;var r=e("./constants.cjs");Object.defineProperty(n,"TransactionPayStrategy",{enumerable:!0,get:function(){return r.TransactionPayStrategy}});var a=e("./TransactionPayController.cjs");Object.defineProperty(n,"TransactionPayController",{enumerable:!0,get:function(){return a.TransactionPayController}});var s=e("./helpers/TransactionPayPublishHook.cjs");Object.defineProperty(n,"TransactionPayPublishHook",{enumerable:!0,get:function(){return s.TransactionPayPublishHook}})}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/index.cjs"}],[3119,{"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("transaction-pay-controller")}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/logger.cjs"}],[3120,{"./bridge-quotes.cjs":3121,"./bridge-submit.cjs":3122},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStrategy=void 0;const r=e("./bridge-quotes.cjs"),a=e("./bridge-submit.cjs");n.BridgeStrategy=class{async getQuotes(e){return(0,r.getBridgeQuotes)(e)}async getBatchTransactions(e){return(0,r.getBridgeBatchTransactions)(e)}async getRefreshInterval(e){return(0,r.getBridgeRefreshInterval)(e)}async execute(e){const{isSmartTransaction:t,quotes:n,messenger:r,transaction:s}=e,i=s.txParams.from;return await(0,a.submitBridgeQuotes)({from:i,isSmartTransaction:t,messenger:r,quotes:n,transaction:s}),{transactionHash:undefined}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/BridgeStrategy.cjs"}],[3121,{"../../index.cjs":3118,"../../logger.cjs":3119,"../../utils/gas.cjs":3129,"../../utils/token.cjs":3134,"@metamask/bridge-controller":3143,"@metamask/controller-utils":1488,"@metamask/transaction-controller":3085,"@metamask/utils":3207,"bignumber.js":3178,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuote=n.getBridgeRefreshInterval=n.getBridgeBatchTransactions=n.getBridgeQuotes=void 0;const r=e("@metamask/bridge-controller"),a=e("@metamask/controller-utils"),s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("lodash"),l=e("../../index.cjs"),u=e("../../logger.cjs"),d=e("../../utils/gas.cjs"),h=e("../../utils/token.cjs"),f="All quotes under minimum",m=new Map([[s.TransactionType.perpsDeposit,r.FeatureId.PERPS]]),p=(0,i.createModuleLogger)(u.projectLogger,"bridge-strategy");function g(e){return{data:e.data,gas:e.gasLimit?(0,a.toHex)(e.gasLimit):undefined,isAfter:!1,to:e.to,value:e.value}}async function w(e,t,n){const{from:r,slippage:s,sourceChainId:i,sourceTokenAddress:l,sourceTokenAmount:u,targetChainId:d,targetTokenAddress:h}=e,{type:g}=n,w=m.get(g),b={destChainId:d,destTokenAddress:(0,a.toChecksumHexAddress)(h),destWalletAddress:r,gasIncluded:!1,gasIncluded7702:!1,insufficientBal:!1,slippage:100*s,srcChainId:i,srcTokenAddress:(0,a.toChecksumHexAddress)(l),srcTokenAmount:u,walletAddress:r},T=await t.call("BridgeController:fetchQuotes",b,undefined,w);if(!T.length)throw new Error("No quotes found");const E=function(e,t){const n=(0,c.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc").slice(0,3),r=n.filter(e=>new o.BigNumber(e.quote.minDestTokenAmount).isGreaterThanOrEqualTo(t.targetAmountMinimum));if(p("Finding best quote",{allQuotes:e,fastestQuotes:n,quotesOverMinimumTarget:r}),!r.length)throw new Error(f);return(0,c.orderBy)(r,e=>(0,o.BigNumber)(e.quote.minDestTokenAmount).toNumber(),"desc")[0]}(T,e);return{...E,request:e}}function b(e,t,n,r){const a=new o.BigNumber(e).shiftedBy(-t),s=a.toString(10),i=a.multipliedBy(r).toString(10);return{fiat:a.multipliedBy(n).toString(10),human:s,raw:e,usd:i}}function T(e,t,{isMax:n=!1}={}){const{approval:r,trade:a}=e,s=r?E(r,t,{isMax:n}):{fiat:"0",human:"0",raw:"0",usd:"0"},i=E(a,t,{isMax:n});return{fiat:new o.BigNumber(s.fiat).plus(i.fiat).toString(10),human:new o.BigNumber(s.human).plus(i.human).toString(10),raw:new o.BigNumber(s.raw).plus(i.raw).toString(10),usd:new o.BigNumber(s.usd).plus(i.usd).toString(10)}}function E(e,t,{isMax:n}){const{effectiveGas:r,gasLimit:a}=e,s=n?undefined:r;return(0,d.calculateGasCost)({...e,gas:s??a??"0x0",messenger:t,isMax:n})}n.getBridgeQuotes=async function(e){p("Fetching quotes",e);const{requests:t,messenger:n,transaction:r}=e;try{const a=function(e,t){const n=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay;return{attemptsMax:t?.attemptsMax??5,bufferInitial:t?.bufferInitial??.04,bufferStep:t?.bufferStep??.04,bufferSubsequent:t?.bufferSubsequent??.05,slippage:t?.slippage??.005}}(t);return e.map(e=>({...e,...n})).map((t,n)=>{const r=0===n,a=r?t.attemptsMax:1,s=e.reduce((e,a,s)=>{const i=a.sourceTokenAddress.toLowerCase()===t.sourceTokenAddress.toLowerCase()&&a.sourceChainId===t.sourceChainId;return r&&s>n&&i?e.minus(a.sourceTokenAmount):e},new o.BigNumber(t.sourceBalanceRaw)).toFixed(0);return{...t,attemptsMax:a,sourceBalanceRaw:s}})}(t,n),s=await Promise.all(a.map((t,n)=>async function(e,t,n){const{attemptsMax:r,bufferInitial:a,bufferStep:s,bufferSubsequent:i,sourceBalanceRaw:c,sourceTokenAmount:l,targetAmountMinimum:u,targetTokenAddress:d}=e,h=new o.BigNumber(l),m=0===t?a:i,g=h.div(1+m),b=Date.now();let T=l;for(let t=0;t<r;t++){const i={...e,sourceTokenAmount:T};try{p("Attempt",{attempt:t+1,attemptsMax:r,bufferInitial:a,bufferStep:s,currentSourceAmount:T,target:d});const e=await w(i,n.messenger,n.transaction),c=new o.BigNumber(e.quote.minDestTokenAmount).minus(u).toString(10);return p("Found valid quote",{attempt:t+1,target:d,targetAmount:e.quote.minDestTokenAmount,goalAmount:u,dust:c,quote:e}),{...e,metrics:{attempts:t+1,buffer:m+s*t,latency:Date.now()-b}}}catch(e){if(e.message!==f)throw e}if(new o.BigNumber(T).isGreaterThanOrEqualTo(c)){p("Reached balance limit",{targetTokenAddress:d,sourceBalanceRaw:c,currentSourceAmount:T,attempt:t+1});break}const l=g.multipliedBy(1+m+s*(t+1));T=l.isLessThan(c)?l.toFixed(0):c}throw p("All attempts failed",d),new Error(f)}(t,n,e)));return s.map((e,t)=>function(e,t,n,r){const a=(0,h.getTokenFiatRate)(n,t.sourceTokenAddress,t.sourceChainId);if(a===undefined)throw new Error(`Fiat rate not found for source token - Chain ID: ${t.sourceChainId}, Address: ${t.sourceTokenAddress}`);const s=(0,h.getTokenFiatRate)(n,t.targetTokenAddress,t.targetChainId);if(s===undefined)throw new Error(`Fiat rate not found for target token - Chain ID: ${t.targetChainId}, Address: ${t.targetTokenAddress}`);const i=b(e.quote.minDestTokenAmount,e.quote.destAsset.decimals,s.fiatRate,s.usdRate),c=b(e.quote.srcTokenAmount,e.quote.srcAsset.decimals,a.fiatRate,a.usdRate),u=b(t.targetAmountMinimum,e.quote.destAsset.decimals,s.fiatRate,s.usdRate),f=(0,d.calculateTransactionGasCost)(r,n),m={estimate:T(e,n),max:T(e,n,{isMax:!0})};return{estimatedDuration:e.estimatedProcessingTimeInSeconds,dust:{fiat:new o.BigNumber(i.fiat).minus(u.fiat).toString(10),usd:new o.BigNumber(i.usd).minus(u.usd).toString(10)},fees:{provider:{fiat:new o.BigNumber(c.fiat).minus(i.fiat).toString(10),usd:new o.BigNumber(c.usd).minus(i.usd).toString(10)},sourceNetwork:m,targetNetwork:f},original:e,request:t,sourceAmount:c,targetAmount:u,strategy:l.TransactionPayStrategy.Bridge}}(e,a[t],n,r))}catch(e){throw p("Error fetching quotes",{error:e}),new Error(`Failed to fetch bridge quotes: ${String(e)}`)}},n.getBridgeBatchTransactions=async function(e){const{quotes:t}=e,n=t[0]?.original?.quote;return n?.srcChainId!==n?.destChainId?(p("No batch transactions needed for bridge quotes"),[]):t.map(e=>e.original).flatMap(e=>{const t=[];return e.approval&&t.push({...g(e.approval),type:s.TransactionType.swapApproval}),t.push({...g(e.trade),type:s.TransactionType.swap}),t})},n.getBridgeRefreshInterval=function(e){const{chainId:t,messenger:n}=e,r=n.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.bridgeConfigV2,a=r?.chains?.[parseInt(t,16)]?.refreshRate,s=r?.refreshRate;return a??s},n.refreshQuote=async function(e,t,n){const r=await w({...e.original.request,attemptsMax:1},t,n);return p("Refreshed quote",{old:e,new:r}),r}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-quotes.cjs"}],[3122,{"../../logger.cjs":3119,"../../utils/transaction.cjs":3136,"./bridge-quotes.cjs":3121,"@metamask/bridge-controller":3143,"@metamask/controller-utils":1488,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitBridgeQuotes=void 0;const r=e("@metamask/bridge-controller"),a=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=e("lodash"),o=e("./bridge-quotes.cjs"),c=e("../../logger.cjs"),l=e("../../utils/transaction.cjs"),u=(0,s.createModuleLogger)(c.projectLogger,"bridge-strategy");async function d(e,t){const{isSmartTransaction:n,messenger:s,from:o,transaction:c}=e,d=(0,i.cloneDeep)(t),h=(0,a.toHex)(d.quote.srcChainId),f=n(h),m=[],p=(0,l.collectTransactionIds)(h,o,s,e=>(0,l.updateTransaction)({transactionId:c.id,messenger:s,note:"Add required transaction ID"},t=>{t.requiredTransactionIds??(t.requiredTransactionIds=[]),t?.requiredTransactionIds.push(e),m.push(e)})),g={amount:"0",valueInCurrency:null,usd:null},w={gasFee:{effective:g,max:g,total:g},totalNetworkFee:g,totalMaxNetworkFee:g,toTokenAmount:g,minToTokenAmount:g,adjustedReturn:g,sentAmount:g,swapRate:"0",cost:g},b=await s.call("BridgeStatusController:submitTx",o,{...d,...w},f);p.end(),u("Bridge transaction submitted",{requiredTransactionIds:m,result:b}),await Promise.all(m.map(e=>(0,l.waitForTransactionConfirmed)(e,s))),u("All required transactions confirmed",m);const{id:T}=b;u("Waiting for bridge completion",T),await async function(e,t){return new Promise((n,a)=>{const s=(e,t)=>{const s=e?.status?.status;return u("Checking bridge status",s??"missing"),s===r.StatusTypes.COMPLETE?(t?.(),n(),!0):s===r.StatusTypes.FAILED&&(t?.(),a(new Error("Bridge failed")),!0)},i=t.call("BridgeStatusController:getState").txHistory[e];if(s(i))return;const o=e=>{s(e,()=>t.unsubscribe("BridgeStatusController:stateChange",o))};t.subscribe("BridgeStatusController:stateChange",o,t=>t.txHistory[e])})}(T,s)}n.submitBridgeQuotes=async function(e){const{quotes:t,messenger:n,transaction:r}=e;if(!t?.length)return void u("No quotes found");if(t[0].original.quote.srcChainId===t[0].original.quote.destChainId)return void u("Ignoring quotes as source is same chain",t[0].original.quote.srcChainId);let a=0;for(const s of t){u("Submitting bridge",a,s);let t=s.original;if(a>0)try{t=await(0,o.refreshQuote)(s,n,r)}catch(e){u("Failed to refresh subsequent quote before submit",e)}await d(e,t),a+=1}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-submit.cjs"}],[3123,{"./relay-quotes.cjs":3125,"./relay-submit.cjs":3126},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStrategy=void 0;const r=e("./relay-quotes.cjs"),a=e("./relay-submit.cjs");n.RelayStrategy=class{async getQuotes(e){return(0,r.getRelayQuotes)(e)}async execute(e){return await(0,a.submitRelayQuotes)(e)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/RelayStrategy.cjs"}],[3124,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_TRANSFER_FOUR_BYTE=n.RELAY_POLLING_INTERVAL=n.RELAY_STATUS_URL=n.RELAY_URL_BASE=n.CHAIN_ID_HYPERCORE=void 0,n.CHAIN_ID_HYPERCORE="0x539",n.RELAY_URL_BASE="https://api.relay.link",n.RELAY_STATUS_URL=`${n.RELAY_URL_BASE}/intents/status/v3`,n.RELAY_POLLING_INTERVAL=1e3,n.TOKEN_TRANSFER_FOUR_BYTE="0xa9059cbb"}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/constants.cjs"}],[3125,{"../../constants.cjs":3115,"../../index.cjs":3118,"../../logger.cjs":3119,"../../utils/feature-flags.cjs":3128,"../../utils/gas.cjs":3129,"../../utils/token.cjs":3134,"./constants.cjs":3124,"@ethersproject/abi":748,"@metamask/controller-utils":1488,"@metamask/utils":3207,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRelayQuotes=void 0;const r=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=e("bignumber.js"),o=e("./constants.cjs"),c=e("../../index.cjs"),l=e("../../constants.cjs"),u=e("../../logger.cjs"),d=e("../../utils/feature-flags.cjs"),h=e("../../utils/gas.cjs"),f=e("../../utils/token.cjs"),m=(0,s.createModuleLogger)(u.projectLogger,"relay-strategy");function p(e,t){const n=e.multipliedBy(t);return{usd:e.toString(10),fiat:n.toString(10)}}function g(e,t){return new r.Interface(["function transfer(address to, uint256 amount)"]).encodeFunctionData("transfer",[e,t])}function w(e){return new r.Interface(["function transfer(address to, uint256 amount)"]).decodeFunctionData("transfer",e).to.toLowerCase()}n.getRelayQuotes=async function(e){const{requests:t}=e;m("Fetching quotes",t);try{const n=t.filter(e=>"0"!==e.targetAmountMinimum).map(e=>function(e){const t={...e},n=e.targetChainId===l.CHAIN_ID_ARBITRUM&&e.targetTokenAddress.toLowerCase()===l.ARBITRUM_USDC_ADDRESS.toLowerCase(),r=e.sourceChainId===l.CHAIN_ID_POLYGON&&e.sourceTokenAddress===(0,f.getNativeToken)(e.sourceChainId);r&&(t.sourceTokenAddress=l.NATIVE_TOKEN_ADDRESS);n&&(t.targetChainId=o.CHAIN_ID_HYPERCORE,t.targetTokenAddress="0x00000000000000000000000000000000",t.targetAmountMinimum=new i.BigNumber(e.targetAmountMinimum).shiftedBy(2).toString(10),m("Converting Arbitrum Hyperliquid deposit to direct deposit",{originalRequest:e,normalizedRequest:t}));return t}(e));return m("Normalized requests",n),await Promise.all(n.map(t=>async function(e,t){const{messenger:n,transaction:r}=t,{slippage:s}=(0,d.getFeatureFlags)(n),u=new i.BigNumber(100*s*100).toFixed(0),{from:b,isMaxAmount:T,sourceChainId:E,sourceTokenAddress:y,sourceTokenAmount:S,targetAmountMinimum:I,targetChainId:k,targetTokenAddress:A}=e;try{const s={amount:T?S:I,destinationChainId:Number(k),destinationCurrency:A,originChainId:Number(E),originCurrency:y,recipient:b,slippageTolerance:u,tradeType:T?"EXACT_INPUT":"EXPECTED_OUTPUT",user:b};await async function(e,t,n,r){const{nestedTransactions:a,txParams:s}=e,{isMaxAmount:i,targetChainId:c}=t,l=s?.data,u=1===a?.length?a[0].data:l,d=c===o.CHAIN_ID_HYPERCORE,h=!d&&Boolean(u?.startsWith(o.TOKEN_TRANSFER_FOUR_BYTE));h&&(n.recipient=w(u),m("Updating recipient as token transfer",n.recipient));const f=u===undefined||"0x"===u;if(f||h||d)return void m("Skipping delegation as token transfer or Hypercore deposit");if(i)throw new Error("Max amount quotes do not support included transactions");const p=await r.call("TransactionPayController:getDelegationTransaction",{transaction:e}),b=p.authorizationList?.map(e=>({...e,chainId:Number(e.chainId),nonce:Number(e.nonce),r:e.r,s:e.s,yParity:Number(e.yParity)}));n.authorizationList=b,n.tradeType="EXACT_OUTPUT";const T=a?.find(e=>e.data?.startsWith(o.TOKEN_TRANSFER_FOUR_BYTE))?.data;T&&(n.recipient=w(T),n.refundTo=t.from);n.txs=[{to:t.targetTokenAddress,data:g(t.from,t.targetAmountMinimum),value:"0x0"},{to:p.to,data:p.data,value:p.value}]}(r,e,s,n);const C=(0,d.getFeatureFlags)(n).relayQuoteUrl;m("Request body",{body:s,url:C});const _=await(0,a.successfulFetch)(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),P=await _.json();return P.request=s,m("Fetched relay quote",P),async function(e,t,n){const{messenger:r}=n,{details:s}=e,{currencyIn:o,currencyOut:u}=s,{usdToFiatRate:g}=function(e,t){const{sourceChainId:n,sourceTokenAddress:r}=t,a=n===l.CHAIN_ID_POLYGON&&r===l.NATIVE_TOKEN_ADDRESS?(0,f.getNativeToken)(n):r,s=(0,f.getTokenFiatRate)(e,a,n);if(!s)throw new Error("Source token fiat rate not found");const o=new i.BigNumber(s.fiatRate).dividedBy(s.usdRate);return{sourceFiatRate:s,usdToFiatRate:o}}(r,t),w=p(function(e,t){const{currencyOut:n}=e.details,{amountUsd:r,amountFormatted:a,minimumAmount:s}=n,{decimals:o}=n.currency,c=new i.BigNumber(r).dividedBy(a),l=new i.BigNumber(s).minus(t.targetAmountMinimum);return l.shiftedBy(-o).multipliedBy(c)}(e,t),g),b=p(function(e){return new i.BigNumber(e.details.totalImpact.usd).abs()}(e),g),{gasLimits:T,isGasFeeToken:E,...y}=await async function(e,t,n){const{from:r,sourceChainId:s,sourceTokenAddress:o}=n,c=e.steps.flatMap(e=>e.items).map(e=>e.data),{relayDisabledGasStationChains:l}=(0,d.getFeatureFlags)(t),{chainId:u,data:p,maxFeePerGas:g,maxPriorityFeePerGas:w,to:b,value:T}=c[0],{totalGasEstimate:E,totalGasLimit:y,gasLimits:S}=await async function(e,t){if(1===e.length)return async function(e,t){const n=e.gas?new i.BigNumber(e.gas).toNumber():undefined;if(n)return m("Using single gas limit from params",{paramGasLimit:n}),{totalGasEstimate:n,totalGasLimit:n,gasLimits:[n]};try{const{chainId:n,data:r,from:s,to:o,value:c}=e,l=(0,a.toHex)(n),u=(0,a.toHex)(c??"0"),h=(0,d.getGasBuffer)(t,l),f=t.call("NetworkController:findNetworkClientIdByChainId",l),{gas:p,simulationFails:g}=await t.call("TransactionController:estimateGas",{from:s,data:r,to:o,value:u},f),w=new i.BigNumber(p).toNumber(),b=Math.ceil(w*h);if(!g)return m("Estimated gas limit for single transaction",{chainId:l,estimatedGas:w,bufferedGas:b,gasBuffer:h}),{totalGasEstimate:b,totalGasLimit:b,gasLimits:[b]}}catch(e){m("Failed to estimate gas limit for single transaction",e)}const r=(0,d.getFeatureFlags)(t).relayFallbackGas;return m("Using fallback gas for single transaction",{fallbackGas:r}),{totalGasEstimate:r.estimate,totalGasLimit:r.max,gasLimits:[r.max]}}(e[0],t);return async function(e,t){try{const{chainId:n,from:r}=e[0],s=(0,a.toHex)(n),o=(0,d.getGasBuffer)(t,s),c=e.map(e=>({...e,gas:e.gas?(0,a.toHex)(e.gas):undefined,maxFeePerGas:undefined,maxPriorityFeePerGas:undefined,value:(0,a.toHex)(e.value??"0")})),l=e.map(e=>e.gas?new i.BigNumber(e.gas).toNumber():undefined),{totalGasLimit:u,gasLimits:h}=await t.call("TransactionController:estimateGasBatch",{chainId:s,from:r,transactions:c}),f=h.map((e,t)=>{const n=1===h.length||l[t]!==h[t]?o:1;return Math.ceil(e*n)}),p=f.reduce((e,t)=>e+t,0);return m("Estimated gas limit for batch",{chainId:s,totalGasLimit:u,gasLimits:h,bufferedTotalGasLimit:p,bufferedGasLimits:f,gasBuffer:o}),{totalGasEstimate:p,totalGasLimit:p,gasLimits:f}}catch(e){m("Failed to estimate gas limit for batch",e)}const n=(0,d.getFeatureFlags)(t).relayFallbackGas,r=e.reduce((e,t)=>{const r=t.gas??n.estimate;return e+new i.BigNumber(r).toNumber()},0),s=e.map(e=>{const t=e.gas??n.max;return new i.BigNumber(t).toNumber()}),o=s.reduce((e,t)=>e+t,0);return m("Using fallback gas for batch",{totalGasEstimate:r,totalGasLimit:o,gasLimits:s}),{totalGasEstimate:r,totalGasLimit:o,gasLimits:s}}(e,t)}(c,t);m("Gas limit",{totalGasEstimate:E,totalGasLimit:y,gasLimits:S});const I=(0,h.calculateGasCost)({chainId:u,gas:E,maxFeePerGas:g,maxPriorityFeePerGas:w,messenger:t}),k=(0,h.calculateGasCost)({chainId:u,gas:y,maxFeePerGas:g,maxPriorityFeePerGas:w,messenger:t,isMax:!0}),A=(0,f.getTokenBalance)(t,r,s,(0,f.getNativeToken)(s)),C={estimate:I,max:k,gasLimits:S};if(new i.BigNumber(A).isGreaterThanOrEqualTo(k.raw))return C;if(l.includes(s))return m("Skipping gas station as disabled chain",{sourceChainId:s,disabledChainIds:l}),C;m("Checking gas fee tokens as insufficient native balance",{nativeBalance:A,max:k.raw});const _=await t.call("TransactionController:getGasFeeTokens",{chainId:s,data:p,from:r,to:b,value:(0,a.toHex)(T??"0")});m("Source gas fee tokens",{gasFeeTokens:_});const P=_.find(e=>e.tokenAddress.toLowerCase()===o.toLowerCase());if(!P)return m("No matching gas fee token found",{sourceTokenAddress:o,gasFeeTokens:_}),C;let v=P.amount;if(c.length>1){const e=new i.BigNumber(P.amount,16).dividedBy(P.gas,16),t=e.multipliedBy(E);v=(0,a.toHex)(t.toFixed(0)),m("Estimated gas fee token amount for batch",{finalAmount:t.toString(10),gasRate:e.toString(10),totalGasEstimate:E})}const N={...P,amount:v},R=(0,h.calculateGasFeeTokenCost)({chainId:s,gasFeeToken:N,messenger:t});if(!R)return C;return m("Using gas fee token for source network",{gasFeeTokenCost:R}),{isGasFeeToken:!0,estimate:R,max:R,gasLimits:S}}(e,r,t),S={usd:"0",fiat:"0"},I={human:o.amountFormatted,raw:o.amount,...p(new i.BigNumber(o.amountUsd),g)},k={human:u.amountFormatted,raw:u.amount,...p(new i.BigNumber(u.amountUsd),g)},A={gasLimits:T};return{dust:w,estimatedDuration:s.timeEstimate,fees:{isSourceGasFeeToken:E,provider:b,sourceNetwork:y,targetNetwork:S},original:{...e,metamask:A},request:t,sourceAmount:I,targetAmount:k,strategy:c.TransactionPayStrategy.Relay}}(P,e,t)}catch(e){throw m("Error fetching relay quote",e),e}}(t,e)))}catch(e){throw m("Error fetching quotes",{error:e}),new Error(`Failed to fetch Relay quotes: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-quotes.cjs"}],[3126,{"../../logger.cjs":3119,"../../utils/feature-flags.cjs":3128,"../../utils/transaction.cjs":3136,"./constants.cjs":3124,"@metamask/controller-utils":1488,"@metamask/transaction-controller":3085,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitRelayQuotes=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/transaction-controller"),s=e("@metamask/utils"),i=e("./constants.cjs"),o=e("../../logger.cjs"),c=e("../../utils/feature-flags.cjs"),l=e("../../utils/transaction.cjs"),u="0x0",d=(0,s.createModuleLogger)(o.projectLogger,"relay-strategy");async function h(e,t,n){d("Executing single quote",e),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Remove nonce from skipped transaction"},e=>{e.txParams.nonce=undefined}),await async function(e,t,n){const{steps:s}=e.original,i=s.flatMap(e=>e.items).map(e=>e.data),o=s.find(e=>"transaction"!==e.kind)?.kind;if(o)throw new Error(`Unsupported step kind: ${o}`);const u=i.map(e=>function(e,t){const n=(0,c.getFeatureFlags)(t);return{data:e.data,from:e.from,gas:(0,r.toHex)(e.gas??n.relayFallbackGas.max),maxFeePerGas:(0,r.toHex)(e.maxFeePerGas),maxPriorityFeePerGas:(0,r.toHex)(e.maxPriorityFeePerGas),to:e.to,value:(0,r.toHex)(e.value??"0")}}(e,n)),h=[],{from:f,sourceChainId:m,sourceTokenAddress:p}=e.request,g=n.call("NetworkController:findNetworkClientIdByChainId",m);d("Adding transactions",{normalizedParams:u,sourceChainId:m,from:f,networkClientId:g});const{end:w}=(0,l.collectTransactionIds)(m,f,n,e=>{h.push(e),(0,l.updateTransaction)({transactionId:t,messenger:n,note:"Add required transaction ID from Relay submission"},t=>{t.requiredTransactionIds??(t.requiredTransactionIds=[]),t.requiredTransactionIds.push(e)})});let b;const T=e.fees.isSourceGasFeeToken?p:undefined,E=e.original.details.currencyIn.currency.chainId===e.original.details.currencyOut.currency.chainId,y=E&&e.original.request.authorizationList?.length?e.original.request.authorizationList.map(e=>({address:e.address,chainId:(0,r.toHex)(e.chainId)})):undefined,{gasLimits:S}=e.original.metamask;if(1===i.length){const e={...u[0],authorizationList:y,gas:(0,r.toHex)(S[0])};b=await n.call("TransactionController:addTransaction",e,{gasFeeToken:T,networkClientId:g,origin:r.ORIGIN_METAMASK,requireApproval:!1,type:a.TransactionType.relayDeposit})}else{const e=1===S.length?(0,r.toHex)(S[0]):undefined,t=u.map((t,n)=>({params:{data:t.data,gas:e?undefined:(0,r.toHex)(S[n]),maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,to:t.to,value:t.value},type:0===n?a.TransactionType.tokenMethodApprove:a.TransactionType.relayDeposit}));await n.call("TransactionController:addTransactionBatch",{from:f,disable7702:!e,disableHook:Boolean(e),disableSequential:Boolean(e),gasFeeToken:T,gasLimit7702:e,networkClientId:g,origin:r.ORIGIN_METAMASK,overwriteUpgrade:!0,requireApproval:!1,transactions:t})}if(w(),d("Added transactions",h),b){const e=await b.result;d("Submitted transaction",e)}await Promise.all(h.map(e=>(0,l.waitForTransactionConfirmed)(e,n))),d("All transactions confirmed",h);const I=(0,l.getTransaction)(h.slice(-1)[0],n)?.hash;return I}(e,n.id,t);const s=await async function(e){if(e.details.currencyIn.currency.chainId===e.details.currencyOut.currency.chainId)return d("Skipping polling as same chain"),u;const{requestId:t}=e.steps[0],n=`${i.RELAY_STATUS_URL}?requestId=${t}`;for(;;){const e=await(0,r.successfulFetch)(n,{method:"GET"}),t=await e.json();if(d("Polled status",t.status,t),"success"===t.status){const e=t.txHashes?.slice(-1)[0];return e??u}if(["failure","refund","refunded"].includes(t.status))throw new Error(`Relay request failed with status: ${t.status}`);await new Promise(e=>setTimeout(e,i.RELAY_POLLING_INTERVAL))}}(e.original);return d("Relay request completed",s),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Intent complete after Relay completion"},e=>{e.isIntentComplete=!0}),{transactionHash:s}}n.submitRelayQuotes=async function(e){d("Executing quotes",e);const{quotes:t,messenger:n,transaction:r}=e;let a;for(const e of t)({transactionHash:a}=await h(e,n,r));return{transactionHash:a}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-submit.cjs"}],[3127,{"../../index.cjs":3118,"../../logger.cjs":3119,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TestStrategy=void 0;const i=e("@metamask/utils"),o=e("../../index.cjs"),c=e("../../logger.cjs"),l=(0,i.createModuleLogger)(c.projectLogger,"test-strategy");n.TestStrategy=class{constructor(){r.add(this)}async getQuotes(e){const{requests:t}=e;return l("Getting quotes",t),await s(this,r,"m",a).call(this,5e3),[{dust:{fiat:"0.12",usd:"0.34"},estimatedDuration:5,fees:{provider:{fiat:"1.23",usd:"1.23"},sourceNetwork:{estimate:{human:"2.34",fiat:"2.34",usd:"2.34",raw:"234000"},max:{human:"2.35",fiat:"2.35",usd:"2.35",raw:"235000"}},targetNetwork:{fiat:"3.45",usd:"3.45"}},original:undefined,request:t[0],sourceAmount:{human:"4.56",fiat:"4.56",raw:"456000",usd:"4.56"},targetAmount:{human:"5.67",fiat:"5.67",raw:"567000",usd:"5.67"},strategy:o.TransactionPayStrategy.Test}]}async execute(e){const{quotes:t}=e;return l("Executing",t),await s(this,r,"m",a).call(this,5e3),{transactionHash:undefined}}},r=new WeakSet,a=function(e){return new Promise(t=>setTimeout(t,e))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/test/TestStrategy.cjs"}],[3128,{"../logger.cjs":3119,"../strategy/relay/constants.cjs":3124,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getGasBuffer=n.getFeatureFlags=n.DEFAULT_SLIPPAGE=n.DEFAULT_RELAY_QUOTE_URL=n.DEFAULT_RELAY_FALLBACK_GAS_MAX=n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=n.DEFAULT_GAS_BUFFER=void 0;const r=e("@metamask/utils"),a=e("../logger.cjs"),s=e("../strategy/relay/constants.cjs"),i=(0,r.createModuleLogger)(a.projectLogger,"feature-flags");function o(e){return e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay??{}}n.DEFAULT_GAS_BUFFER=1,n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=9e5,n.DEFAULT_RELAY_FALLBACK_GAS_MAX=15e5,n.DEFAULT_RELAY_QUOTE_URL=`${s.RELAY_URL_BASE}/quote`,n.DEFAULT_SLIPPAGE=.005,n.getFeatureFlags=function(e){const t=o(e),r=t.relayFallbackGas?.estimate??n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE,a=t.relayFallbackGas?.max??n.DEFAULT_RELAY_FALLBACK_GAS_MAX,s=t.relayQuoteUrl??n.DEFAULT_RELAY_QUOTE_URL,c={relayDisabledGasStationChains:t.relayDisabledGasStationChains??[],relayFallbackGas:{estimate:r,max:a},relayQuoteUrl:s,slippage:t.slippage??n.DEFAULT_SLIPPAGE};return i("Feature flags:",{raw:t,result:c}),c},n.getGasBuffer=function(e,t){const r=o(e);return r.gasBuffer?.perChainConfig?.[t]?.buffer??r.gasBuffer?.default??n.DEFAULT_GAS_BUFFER}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/feature-flags.cjs"}],[3129,{"../logger.cjs":3119,"./token.cjs":3134,"@metamask/controller-utils":1488,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGasFeeTokenCost=n.calculateGasCost=n.calculateTransactionGasCost=void 0;const r=e("@metamask/controller-utils"),a=e("bignumber.js"),s=e("./token.cjs"),i=e("../logger.cjs"),o=(0,i.createModuleLogger)(i.projectLogger,"gas");function c(e){const{chainId:t,gas:n,isMax:i,maxFeePerGas:o,maxPriorityFeePerGas:c,messenger:l}=e,u=(0,r.toHex)(t),{estimatedBaseFee:d,maxFeePerGas:h,maxPriorityFeePerGas:f}=function(e,t){const n=t.call("GasFeeController:getState"),r=n?.gasFeeEstimatesByChainId?.[e],{estimatedBaseFee:s,medium:i}=r?.gasFeeEstimates??{},o=i?.suggestedMaxFeePerGas,c=i?.suggestedMaxPriorityFeePerGas,l=s?new a.BigNumber(s).shiftedBy(9).toString(10):undefined,u=o?new a.BigNumber(o).shiftedBy(9).toString(10):undefined,d=c?new a.BigNumber(c).shiftedBy(9).toString(10):undefined;return{estimatedBaseFee:l,maxFeePerGas:u,maxPriorityFeePerGas:d}}(u,l),m=o??h,p=c??f,g=d&&p&&!i?new a.BigNumber(d).plus(p):new a.BigNumber(m??"0x0"),w=new a.BigNumber(n).multipliedBy(g),b=w.toString(10),T=w.shiftedBy(-18),E=T.toString(10),y=(0,s.getTokenFiatRate)(l,(0,s.getNativeToken)(u),u);if(!y)throw new Error("Could not fetch fiat rate for native token");const S=T.multipliedBy(y.usdRate).toString(10);return{fiat:T.multipliedBy(y.fiatRate).toString(10),human:E,raw:b,usd:S}}function l({chainId:e,gasFeeToken:t,messenger:n}){const{amount:r,decimals:i,tokenAddress:c}=t,l=(0,s.getTokenFiatRate)(n,c,e);if(!l)return o("Cannot get gas fee token info"),undefined;const u=new a.BigNumber(r),d=u.toString(10),h=u.shiftedBy(-i),f=h.toString(10);return{isGasFeeToken:!0,fiat:h.multipliedBy(l.fiatRate).toString(10),human:f,raw:d,usd:h.multipliedBy(l.usdRate).toString(10)}}n.calculateTransactionGasCost=function(e,t,{isMax:n}={}){const{chainId:r,gasUsed:i,gasLimitNoBuffer:u,txParams:d}=e,{from:h,gas:f,maxFeePerGas:m,maxPriorityFeePerGas:p}=d,g=(n?undefined:i)??u??f??"0x0",w=c({chainId:r,gas:g,isMax:n,maxFeePerGas:m,maxPriorityFeePerGas:p,messenger:t}),b=c({chainId:r,gas:g,isMax:!0,messenger:t}),T=(0,s.getTokenBalance)(t,h,r,(0,s.getNativeToken)(r)),E=function({hasBalance:e,messenger:t,transaction:n}){const{chainId:r,gasFeeTokens:a,isGasFeeTokenIgnoredIfBalance:s,selectedGasFeeToken:i}=n;if(!a||!i||s&&e)return undefined;o("Calculating gas fee token cost",{selectedGasFeeToken:i,chainId:r});const c=a?.find(e=>e.tokenAddress.toLowerCase()===i.toLowerCase());if(!c)return o("Gas fee token not found",{gasFeeTokens:a,selectedGasFeeToken:i}),undefined;return l({chainId:r,gasFeeToken:c,messenger:t})}({hasBalance:new a.BigNumber(T).gte(b.raw),messenger:t,transaction:e});return E||w},n.calculateGasCost=c,n.calculateGasFeeTokenCost=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/gas.cjs"}],[3130,{"../logger.cjs":3119,"./strategy.cjs":3133,"./totals.cjs":3135,"./transaction.cjs":3136,"@metamask/transaction-controller":3085,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuotes=n.updateQuotes=void 0;const r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("./strategy.cjs"),i=e("./totals.cjs"),o=e("./transaction.cjs"),c=e("../logger.cjs"),l=(0,a.createModuleLogger)(c.projectLogger,"quotes");async function u(e){const{messenger:t,transactionData:n,transactionId:a,updateTransactionData:c}=e,u=(0,o.getTransaction)(a,t);if(!u||!n)throw new Error("Transaction not found");if(u?.status!==r.TransactionStatus.unapproved)return!1;l("Updating quotes",{transactionId:a});const{isMaxAmount:d,paymentToken:h,sourceAmounts:f,tokens:m}=n,p=function({from:e,isMaxAmount:t,paymentToken:n,sourceAmounts:r,tokens:a,transactionId:s}){if(!n)return[];const i=(r??[]).map(r=>{const s=a.find(e=>e.address===r.targetTokenAddress);return{from:e,isMaxAmount:t,sourceBalanceRaw:n.balanceRaw,sourceTokenAmount:r.sourceAmountRaw,sourceChainId:n.chainId,sourceTokenAddress:n.address,targetAmountMinimum:s.allowUnderMinimum?"0":s.amountRaw,targetChainId:s.chainId,targetTokenAddress:s.address}});i.length||l("No quote requests",{transactionId:s});return i}({from:u.txParams.from,isMaxAmount:d??!1,paymentToken:h,sourceAmounts:f,tokens:m,transactionId:a});c(a,e=>{e.isLoading=!0});try{const{batchTransactions:e,quotes:n}=await async function(e,t,n){const{id:r}=e,a=(0,s.getStrategy)(n,e);let i=[];try{i=t?.length?await a.getQuotes({messenger:n,requests:t,transaction:e}):[]}catch(e){l("Error fetching quotes",{error:e,transactionId:r})}l("Updated",{transactionId:r,quotes:i});const o=i?.length&&a.getBatchTransactions?await a.getBatchTransactions({messenger:n,quotes:i}):[];return l("Batch transactions",{transactionId:r,batchTransactions:o}),{batchTransactions:o,quotes:i}}(u,p,t),r=(0,i.calculateTotals)({isMaxAmount:d,messenger:t,quotes:n,tokens:m,transaction:u});l("Calculated totals",{transactionId:a,totals:r}),function({batchTransactions:e,messenger:t,paymentToken:n,totals:r,transactionId:a}){if(!n)return;(0,o.updateTransaction)({transactionId:a,messenger:t,note:"Update transaction pay data"},t=>{t.batchTransactions=e,t.batchTransactionsOptions={},t.metamaskPay={bridgeFeeFiat:r.fees.provider.usd,chainId:n.chainId,networkFeeFiat:r.fees.sourceNetwork.estimate.usd,targetFiat:r.targetAmount.usd,tokenAddress:n.address,totalFiat:r.total.usd}})}({batchTransactions:e,messenger:t,paymentToken:h,totals:r,transactionId:a}),c(a,e=>{e.quotes=n,e.quotesLastUpdated=Date.now(),e.totals=r})}finally{c(a,e=>{e.isLoading=!1})}return!0}n.updateQuotes=u,n.refreshQuotes=async function(e,t){const n=e.call("TransactionPayController:getState"),r=Object.keys(n.transactionData);for(const a of r){const r=n.transactionData[a],{isLoading:i,quotes:o,quotesLastUpdated:c}=r;if(i||!o?.length)continue;const d=o[0].strategy,h=(0,s.getStrategyByName)(d),f=await(h.getRefreshInterval?.({chainId:o[0].request.sourceChainId,messenger:e}))??3e4;if(!(Date.now()-(c??0)>f))continue;await u({messenger:e,transactionData:r,transactionId:a,updateTransactionData:t})&&l("Refreshed quotes",{transactionId:a,strategy:d})}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/quotes.cjs"}],[3131,{"./token.cjs":3134,"@ethersproject/abi":748,"@metamask/controller-utils":1488,"@metamask/metamask-eth-abis":2370,"@metamask/utils":3207,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseRequiredTokens=void 0;const r=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("./token.cjs"),l="0xa9059cbb";function u(e,t){const{data:n,to:i}=function(e){const{nestedTransactions:t,txParams:n}=e,{data:r}=n,a=n?.to;if(r?.startsWith(l)&&a)return{data:r,to:a,index:undefined};const s=t?.findIndex(e=>e.data?.startsWith(l)),i=s===undefined?undefined:t?.[s];if(i?.data&&i.to)return{data:i.data,to:i.to,index:s};return undefined}(e)??{};if(!i||!n)return undefined;let o;try{const e=new r.Interface(s.abiERC20).decodeFunctionData("transfer",n);o=(0,a.toHex)(e._value)}catch{}return o===undefined?undefined:h(e,i,o,t)}function d(e,t){const{chainId:n,txParams:r}=e,{gas:a,maxFeePerGas:s}=r,l=(0,c.getNativeToken)(n),u=h(e,l,(0,i.add0x)(new o.BigNumber(a??"0x0").multipliedBy(new o.BigNumber(s??"0x0")).toString(16)),t);if(!u)return undefined;const d=new o.BigNumber(u.amountUsd);if(new o.BigNumber(u.balanceRaw).isGreaterThanOrEqualTo(u.amountRaw)||d.isGreaterThanOrEqualTo(1))return{...u,allowUnderMinimum:!0,skipIfBalance:!0};const f=(0,c.getTokenFiatRate)(t,l,n),m=h(e,l,(0,i.add0x)(new o.BigNumber(1).dividedBy(f.usdRate).shiftedBy(18).toString(16)),t);return m?{...m,allowUnderMinimum:!0,skipIfBalance:!0}:undefined}function h(e,t,n,r){const{chainId:a,txParams:s}=e,i=s.from,{decimals:o,symbol:l}=(0,c.getTokenInfo)(r,t,a)??{},u=(0,c.getTokenFiatRate)(r,t,a),d=(0,c.getTokenBalance)(r,i,a,t);if(o===undefined||!l||u===undefined)return undefined;const{amountHuman:h,amountRaw:m,amountFiat:p,amountUsd:g}=f(d,o,u),{amountHuman:w,amountRaw:b,amountFiat:T,amountUsd:E}=f(n,o,u);return{address:t,allowUnderMinimum:!1,amountFiat:T,amountHuman:w,amountRaw:b,amountUsd:E,balanceFiat:p,balanceHuman:h,balanceRaw:m,balanceUsd:g,chainId:a,decimals:o,skipIfBalance:!1,symbol:l}}function f(e,t,n){const r=new o.BigNumber(e),a=r.shiftedBy(-t),s=a.multipliedBy(n.fiatRate).toString(10),i=a.multipliedBy(n.usdRate).toString(10),c=r.toFixed(0);return{amountFiat:s,amountHuman:a.toString(10),amountRaw:c,amountUsd:i}}n.parseRequiredTokens=function(e,t){return[u(e,t),d(e,t)].filter(Boolean)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/required-tokens.cjs"}],[3132,{"../constants.cjs":3115,"../index.cjs":3118,"../logger.cjs":3119,"./token.cjs":3134,"./transaction.cjs":3136,"@metamask/utils":3207,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateSourceAmounts=void 0;const r=e("@metamask/utils"),a=e("bignumber.js"),s=e("./token.cjs"),i=e("./transaction.cjs"),o=e("../index.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs"),u=(0,r.createModuleLogger)(l.projectLogger,"source-amounts");n.updateSourceAmounts=function(e,t,n){if(!t)return;const{isMaxAmount:r,paymentToken:l,tokens:d}=t;if(!d.length||!l)return;const h=d.map(t=>function(e,t,n,r,l){const d=(0,s.getTokenFiatRate)(n,e.address,e.chainId);if(!d)return undefined;const h=new a.BigNumber(t.balanceRaw).gte(t.amountRaw);if(t.skipIfBalance&&h)return u("Skipping token as sufficient balance",{tokenAddress:t.address}),undefined;const f=function(e,t){const n=(0,i.getTransaction)(e,t);return t.call("TransactionPayController:getStrategy",n)}(r,n),m=t.address.toLowerCase()===e.address.toLowerCase()&&t.chainId===e.chainId,p=function(e,t){const n=e.chainId===c.CHAIN_ID_ARBITRUM&&e.address.toLowerCase()===c.ARBITRUM_USDC_ADDRESS.toLowerCase();return t===o.TransactionPayStrategy.Relay&&n}(t,f);if(m&&!p)return u("Skipping token as same as payment token"),undefined;const g=new a.BigNumber(t.amountUsd).div(d.usdRate),w=g.toString(10),b=g.shiftedBy(e.decimals).toFixed(0);if("0"===t.amountRaw)return u("Skipping token as zero amount",{tokenAddress:t.address}),undefined;if(l)return{sourceAmountHuman:e.balanceHuman,sourceAmountRaw:e.balanceRaw,targetTokenAddress:t.address};return{sourceAmountHuman:w,sourceAmountRaw:b,targetTokenAddress:t.address}}(l,t,n,e,r??!1)).filter(Boolean);u("Updated source amounts",{transactionId:e,sourceAmounts:h}),t.sourceAmounts=h}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/source-amounts.cjs"}],[3133,{"../constants.cjs":3115,"../strategy/bridge/BridgeStrategy.cjs":3120,"../strategy/relay/RelayStrategy.cjs":3123,"../strategy/test/TestStrategy.cjs":3127},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getStrategyByName=n.getStrategy=void 0;const r=e("../constants.cjs"),a=e("../strategy/bridge/BridgeStrategy.cjs"),s=e("../strategy/relay/RelayStrategy.cjs"),i=e("../strategy/test/TestStrategy.cjs");function o(e){switch(e){case r.TransactionPayStrategy.Bridge:return new a.BridgeStrategy;case r.TransactionPayStrategy.Relay:return new s.RelayStrategy;case r.TransactionPayStrategy.Test:return new i.TestStrategy;default:throw new Error(`Unknown strategy: ${e}`)}}n.getStrategy=function(e,t){return o(e.call("TransactionPayController:getStrategy",t))},n.getStrategyByName=o}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/strategy.cjs"}],[3134,{"../constants.cjs":3115,"@metamask/controller-utils":1488,"bignumber.js":3178,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNativeToken=n.getTokenFiatRate=n.getTokenInfo=n.getAllTokenBalances=n.getTokenBalance=void 0;const r=e("@metamask/controller-utils"),a=e("bignumber.js"),s=e("lodash"),i=e("../constants.cjs"),o={[i.CHAIN_ID_ARBITRUM]:[i.ARBITRUM_USDC_ADDRESS.toLowerCase()],[i.CHAIN_ID_POLYGON]:[i.POLYGON_USDCE_ADDRESS.toLowerCase()]};function c(e,t,n,s){const i=e.call("TokenBalancesController:getState"),o=t.toLowerCase(),c=(0,r.toChecksumHexAddress)(s),u=c===l(n),d=i.tokenBalances?.[o]?.[n]?.[c];if(!u&&d===undefined)return"0";if(!u&&d)return new a.BigNumber(d,16).toString(10);const h=e.call("AccountTrackerController:getState"),f=h.accountsByChainId?.[n],m=(0,r.toChecksumHexAddress)(o),p=f?.[m]?.balance;return new a.BigNumber(p??"0x0",16).toString(10)}function l(e){return"0x89"===e?"0x0000000000000000000000000000000000001010":i.NATIVE_TOKEN_ADDRESS}function u(e,t){try{const n=t.call("NetworkController:findNetworkClientIdByChainId",e);return t.call("NetworkController:getNetworkClientById",n).configuration.ticker}catch{return undefined}}n.getTokenBalance=c,n.getAllTokenBalances=function(e,t){const n=e.call("TokenBalancesController:getState"),r=e.call("AccountTrackerController:getState"),a=Object.keys(r.accountsByChainId),i=t.toLowerCase(),o=n.tokenBalances?.[i],u=Object.keys(o);return(0,s.uniq)([...u,...a]).flatMap(n=>[...Object.keys(o[n]??{}),l(n)].map(r=>({chainId:n,tokenAddress:r,balance:c(e,t,n,r)})))},n.getTokenInfo=function(e,t,n){const r=e.call("TokensController:getState"),a=t.toLowerCase(),s=a===l(n).toLowerCase(),i=Object.values(r.allTokens?.[n]??{}).flat().find(e=>e.address.toLowerCase()===a);if(!i&&!s)return undefined;if(i&&!s)return{decimals:Number(i.decimals),symbol:i.symbol};const o=u(n,e);return o?{decimals:18,symbol:o}:undefined},n.getTokenFiatRate=function(e,t,n){const s=u(n,e);if(!s)return undefined;const i=e.call("TokenRatesController:getState"),c=e.call("CurrencyRateController:getState"),d=(0,r.toChecksumHexAddress)(t),h=d===l(n),f=i.marketData?.[n]?.[d]?.price;if(f===undefined&&!h)return undefined;const{conversionRate:m,usdConversionRate:p}=c.currencyRates?.[s]??{conversionRate:null,usdConversionRate:null};if(null===m||null===p)return undefined;const g=o[n]?.includes(t.toLowerCase());return{usdRate:g?"1":new a.BigNumber(f??1).multipliedBy(p).toString(10),fiatRate:new a.BigNumber(f??1).multipliedBy(m).toString(10)}},n.getNativeToken=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/token.cjs"}],[3135,{"./gas.cjs":3129,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTotals=void 0;const r=e("bignumber.js"),a=e("./gas.cjs");function s(e){return{...i(e),human:o(e,e=>e.human),raw:o(e,e=>e.raw)}}function i(e){return{fiat:o(e,e=>e.fiat),usd:o(e,e=>e.usd)}}function o(e,t){return e.map(t).reduce((e,t)=>e.plus(t),new r.BigNumber(0)).toString(10)}n.calculateTotals=function({isMaxAmount:e,quotes:t,messenger:n,tokens:c,transaction:l}){const u=i(t.map(e=>e.fees.provider)),d=s(t.map(e=>e.fees.sourceNetwork.max)),h=s(t.map(e=>e.fees.sourceNetwork.estimate)),f=(0,a.calculateTransactionGasCost)(l,n),m=t?.length?{...i(t.map(e=>e.fees.targetNetwork)),isGasFeeToken:!1}:f,p=s(t.map(e=>e.sourceAmount)),g=s(t.map(e=>e.targetAmount)),w=c.filter(e=>!e.skipIfBalance),b=o(w,e=>e.amountFiat),T=o(w,e=>e.amountUsd),E=t.length>0,y=new r.BigNumber(u.fiat).plus(h.fiat).plus(m.fiat).plus(e&&E?g.fiat:b).toString(10),S=new r.BigNumber(u.usd).plus(h.usd).plus(m.usd).plus(e&&E?g.usd:T).toString(10);return{estimatedDuration:Number(o(t,e=>e.estimatedDuration)),fees:{isSourceGasFeeToken:t.some(e=>e.fees.isSourceGasFeeToken),isTargetGasFeeToken:Boolean(m.isGasFeeToken)||t.some(e=>e.fees.isTargetGasFeeToken),provider:u,sourceNetwork:{estimate:h,max:d},targetNetwork:m},sourceAmount:p,targetAmount:g,total:{fiat:y,usd:S}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/totals.cjs"}],[3136,{"../logger.cjs":3119,"./required-tokens.cjs":3131,"@metamask/transaction-controller":3085,"@metamask/utils":3207,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.collectTransactionIds=n.updateTransaction=n.waitForTransactionConfirmed=n.pollTransactionChanges=n.getTransaction=n.FINALIZED_STATUSES=void 0;const r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("lodash"),i=e("./required-tokens.cjs"),o=e("../logger.cjs"),c=(0,a.createModuleLogger)(o.projectLogger,"transaction");function l(e,t){return t.call("TransactionController:getState").transactions.find(t=>t.id===e)}n.FINALIZED_STATUSES=[r.TransactionStatus.confirmed,r.TransactionStatus.dropped,r.TransactionStatus.failed],n.getTransaction=l,n.pollTransactionChanges=function(e,t,r){e.subscribe("TransactionController:stateChange",(a,s)=>{const o=a.filter(e=>!s?.find(t=>t.id===e.id)),l=a.filter(e=>{const t=s?.find(t=>t.id===e.id);return t&&t?.txParams.data!==e.txParams.data});[...a.filter(e=>{const t=s?.find(t=>t.id===e.id);return t&&!n.FINALIZED_STATUSES.includes(t.status)&&n.FINALIZED_STATUSES.includes(e.status)}),...(s??[]).filter(e=>!a.find(t=>t.id===e.id))].forEach(e=>function(e,t){c("Transaction finalized",{transaction:e}),t(e.id)}(e,r)),[...o,...l].forEach(n=>function(e,t,n){const r=(0,i.parseRequiredTokens)(e,t);c("Transaction changed",{transaction:e,tokens:r}),n(e.id,e=>{e.tokens=r})}(n,e,t))},e=>e.transactions)},n.waitForTransactionConfirmed=function(e,t){return new Promise((n,a)=>{const s=(e,t)=>(c("Checking transaction status",e?.status,e?.type),e?.status===r.TransactionStatus.confirmed?(t?.(),n(),!0):!![r.TransactionStatus.dropped,r.TransactionStatus.failed].includes(e?.status)&&(t?.(),a(new Error(`Transaction failed - ${e?.type} - ${e?.error?.message}`)),!0)),i=t.call("TransactionController:getState").transactions.find(t=>t.id===e);if(s(i))return;const o=e=>{s(e,()=>t.unsubscribe("TransactionController:stateChange",o))};t.subscribe("TransactionController:stateChange",o,t=>t.transactions.find(t=>t.id===e))})},n.updateTransaction=function({transactionId:e,messenger:t,note:n},r){const a=l(e,t);if(!a)throw new Error(`Transaction not found: ${e}`);const i=(0,s.cloneDeep)(a);r(i),t.call("TransactionController:updateTransaction",i,n)},n.collectTransactionIds=function(e,t,n,r){const a=n=>{n.chainId===e&&n.txParams.from.toLowerCase()===t.toLowerCase()&&r(n.id)};return n.subscribe("TransactionController:unapprovedTransactionAdded",a),{end:()=>{n.unsubscribe("TransactionController:unapprovedTransactionAdded",a)}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/transaction.cjs"}],[3137,{"./constants/bridge.cjs":3138,"./constants/chains.cjs":3139,"./constants/swaps.cjs":3140,"./constants/traces.cjs":3142,"./selectors.cjs":3144,"./types.cjs":3145,"./utils/assets.cjs":3146,"./utils/balance.cjs":3147,"./utils/bridge.cjs":3148,"./utils/caip-formatters.cjs":3149,"./utils/feature-flags.cjs":3150,"./utils/fetch.cjs":3152,"./utils/metrics/constants.cjs":3153,"./utils/metrics/properties.cjs":3154,"./utils/quote-fees.cjs":3155,"./utils/quote.cjs":3156,"./utils/snaps.cjs":3158,"@ethersproject/bignumber":762,"@ethersproject/contracts":771,"@ethersproject/providers":809,"@metamask/metamask-eth-abis":2370,"@metamask/polling-controller":2555},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T,E,y,S,I,k,A,C,_,P=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},v=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeController=void 0;const N=e("@ethersproject/bignumber"),R=e("@ethersproject/contracts"),j=e("@ethersproject/providers"),O=e("@metamask/metamask-eth-abis"),x=e("@metamask/polling-controller"),L=e("./constants/bridge.cjs"),M=e("./constants/chains.cjs"),F=e("./constants/swaps.cjs"),D=e("./constants/traces.cjs"),B=e("./selectors.cjs"),G=e("./types.cjs"),U=e("./utils/assets.cjs"),H=e("./utils/balance.cjs"),q=e("./utils/bridge.cjs"),W=e("./utils/caip-formatters.cjs"),$=e("./utils/feature-flags.cjs"),K=e("./utils/fetch.cjs"),V=e("./utils/metrics/constants.cjs"),Y=e("./utils/metrics/properties.cjs"),z=e("./utils/quote.cjs"),Q=e("./utils/quote-fees.cjs"),J=e("./utils/snaps.cjs"),X={quoteRequest:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotes:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesInitialLoadTime:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesLastFetched:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesLoadingStatus:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quoteFetchError:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesRefreshCount:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},assetExchangeRates:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},minimumBalanceForRentExemptionInLamports:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};class Z extends((0,x.StaticIntervalPollingController)()){constructor({messenger:e,state:t,clientId:n,clientVersion:x,getLayer1GasFee:Z,fetchFn:ee,config:te,trackMetaMetricsFn:ne,traceFn:re}){super({name:L.BRIDGE_CONTROLLER_NAME,metadata:X,messenger:e,state:{...(0,q.getDefaultBridgeControllerState)(),...t}}),r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),this._executePoll=async e=>{await v(this,b,"f").call(this,e)},this.updateBridgeQuoteRequestParams=async(e,t)=>{v(this,C,"f").call(this,e),this.resetState(V.AbortReason.QuoteRequestUpdated);const n={...L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,...e};if(this.update(e=>{e.quoteRequest=n}),await v(this,p,"f").call(this,n).catch(e=>console.warn("Failed to fetch asset exchange rates",e)),(0,z.isValidQuoteRequest)(n)){P(this,s,Date.now(),"f");const a=(0,q.isNonEvmChainId)(n.srcChainId),i=a?undefined:v(this,r,"m",S).call(this,(0,W.formatChainIdToHex)(n.srcChainId))?.configuration;let o,c=Boolean(e.resetApproval);a?o=e.insufficientBal:i?.rpcUrl?.includes("tenderly")?o=!0:(this.update(e=>{e.quotesLoadingStatus=G.RequestStatus.LOADING}),c=await v(this,w,"f").call(this,n),o=e.insufficientBal??await v(this,g,"f").call(this,n)),this.setChainIntervalLength(),this.startPolling({updatedQuoteRequest:{...n,insufficientBal:o,resetApproval:c},context:t})}},this.fetchQuotes=async(e,t=null,n=null)=>{const a=(0,$.getBridgeFeatureFlags)(this.messenger),s=n?a.quoteRequestOverrides?.[n]:undefined,u=await v(this,w,"f").call(this,e),{quotes:d,validationFailures:m}=await(0,K.fetchBridgeQuotes)(s?{...e,...s,resetApproval:u}:{...e,resetApproval:u},t,v(this,i,"f"),v(this,l,"f"),v(this,h,"f").customBridgeApiBaseUrl??L.BRIDGE_PROD_API_BASE_URL,n,v(this,o,"f"));v(this,f,"f").call(this,m);const p=await(0,Q.appendFeesToQuotes)(d,this.messenger,v(this,c,"f"),v(this,r,"m",y).call(this,e.walletAddress));return(0,z.sortQuotes)(p,n)},f.set(this,e=>{0!==e.length&&this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesValidationFailed,{failures:e})}),m.set(this,()=>({...this.messenger.call("MultichainAssetsRatesController:getState"),...this.messenger.call("CurrencyRateController:getState"),...this.messenger.call("TokenRatesController:getState"),...this.state})),p.set(this,async({srcChainId:e,srcTokenAddress:t,destChainId:n,destTokenAddress:r})=>{const s=new Set([]),c=v(this,m,"f").call(this);t&&e&&!(0,B.selectIsAssetExchangeRateInState)(c,e,t)&&(0,U.getAssetIdsForToken)(t,e).forEach(e=>s.add(e)),r&&n&&!(0,B.selectIsAssetExchangeRateInState)(c,n,r)&&(0,U.getAssetIdsForToken)(r,n).forEach(e=>s.add(e));const u=this.messenger.call("CurrencyRateController:getState").currentCurrency;if(0===s.size)return;const d=await(0,K.fetchAssetPrices)({assetIds:s,currencies:new Set([u]),clientId:v(this,i,"f"),clientVersion:v(this,o,"f"),fetchFn:v(this,l,"f"),signal:v(this,a,"f")?.signal}),h=(0,U.toExchangeRates)(u,d);this.update(e=>{e.assetExchangeRates={...e.assetExchangeRates,...h}})}),g.set(this,async e=>{try{const t=(0,W.formatChainIdToHex)(e.srcChainId),n=v(this,r,"m",S).call(this,t)?.provider,a=(0,W.formatAddressToCaipReference)(e.srcTokenAddress);return!(n&&a&&e.srcTokenAmount&&t&&await(0,H.hasSufficientBalance)(n,e.walletAddress,a,e.srcTokenAmount,t))}catch(e){return console.warn("Failed to set insufficientBal",e),!0}}),w.set(this,async e=>{if((0,q.isNonEvmChainId)(e.srcChainId))return!1;try{const t=(0,W.formatAddressToCaipReference)(e.srcTokenAddress);if((0,q.isEthUsdt)(e.srcChainId,t)){const n=N.BigNumber.from(await v(this,_,"f").call(this,e.walletAddress,t,e.destChainId));return n.lt(e.srcTokenAmount)&&n.gt(0)}return!1}catch(e){return console.warn("Failed to set resetApproval",e),!0}}),this.stopPollingForQuotes=(e,t)=>{this.stopAllPolling(),this.state.quotesLoadingStatus===G.RequestStatus.LOADING&&t&&this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesReceived,t),v(this,a,"f")?.abort(e)},this.resetState=(e=V.AbortReason.ResetState)=>{this.stopPollingForQuotes(e),this.update(e=>{e.quoteRequest=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,e.quotesInitialLoadTime=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime,e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes,e.quotesLastFetched=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched,e.quotesLoadingStatus=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus,e.quoteFetchError=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError,e.quotesRefreshCount=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount,e.assetExchangeRates=L.DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates,e.minimumBalanceForRentExemptionInLamports=L.DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports})},this.setChainIntervalLength=()=>{const{state:e}=this,{srcChainId:t}=e.quoteRequest,n=(0,$.getBridgeFeatureFlags)(this.messenger),r=t?n.chains[(0,W.formatChainIdToCaip)(t)]?.refreshRate:undefined,a=n.refreshRate;this.setIntervalLength(r??a)},b.set(this,async({updatedQuoteRequest:e,context:t})=>{v(this,a,"f")?.abort("New quote request"),P(this,a,new AbortController,"f"),this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesRequested,t);const{sse:n,maxRefreshCount:i}=(0,$.getBridgeFeatureFlags)(this.messenger),c=n?.enabled&&(0,$.hasMinimumRequiredVersion)(v(this,o,"f"),n.minimumVersion);this.update(t=>{t.quoteRequest=e,t.quoteFetchError=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError,t.quotesLastFetched=Date.now(),t.quotesLoadingStatus=G.RequestStatus.LOADING});try{await v(this,d,"f").call(this,{name:(0,q.isCrossChain)(e.srcChainId,e.destChainId)?D.TraceName.BridgeQuotesFetched:D.TraceName.SwapQuotesFetched,data:{srcChainId:(0,W.formatChainIdToCaip)(e.srcChainId),destChainId:(0,W.formatChainIdToCaip)(e.destChainId)}},async()=>{const t=v(this,r,"m",y).call(this,e.walletAddress);if(v(this,E,"f").call(this,e.srcChainId,t?.metadata?.snap?.id),c)return void await v(this,T,"f").call(this,e,t);const n=await this.fetchQuotes(e,v(this,a,"f")?.signal);this.update(e=>{e.quotesRefreshCount===L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount&&v(this,s,"f")&&(e.quotesInitialLoadTime=Date.now()-v(this,s,"f")),e.quotes=n,e.quotesLoadingStatus=G.RequestStatus.FETCHED})})}catch(e){if(this.update(e=>{e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes}),e.toString().includes("AbortError")||e.toString().includes("FetchRequestCanceledException")||[V.AbortReason.ResetState,V.AbortReason.NewQuoteRequest,V.AbortReason.QuoteRequestUpdated,V.AbortReason.TransactionSubmitted].includes(e))return;this.update(t=>{let n;try{n=e?.message??e.toString()}catch{}finally{t.quoteFetchError=n??"Unknown error"}t.quotesLoadingStatus=G.RequestStatus.ERROR}),this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesError,t),console.log(`Failed to ${c?"stream":"fetch"} bridge quotes`,e)}this.update(e=>{e.quotesRefreshCount+=1}),(e.insufficientBal||!e.insufficientBal&&this.state.quotesRefreshCount>=i)&&this.stopAllPolling()}),T.set(this,async(e,t)=>{let n=0;const r=new Set;await(0,K.fetchBridgeQuoteStream)(v(this,l,"f"),e,v(this,a,"f")?.signal,v(this,i,"f"),v(this,h,"f").customBridgeApiBaseUrl??L.BRIDGE_PROD_API_BASE_URL,{onValidationFailure:v(this,f,"f"),onValidQuoteReceived:async e=>{const a=(async()=>{const r=await(0,Q.appendFeesToQuotes)([e],this.messenger,v(this,c,"f"),t);r.length>0&&(n+=1),this.update(e=>{1===n&&(e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes,!e.quotesInitialLoadTime&&v(this,s,"f")&&(e.quotesInitialLoadTime=Date.now()-v(this,s,"f"))),e.quotes=[...e.quotes,...r]})})();r.add(a),a.catch(e=>{console.error("Error appending fees to quote",e)}).finally(()=>{r.delete(a)}),await a},onClose:async()=>{await Promise.allSettled(Array.from(r)),this.update(e=>{0===n&&(e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes),e.quotesLoadingStatus=G.RequestStatus.FETCHED})}},v(this,o,"f"))}),E.set(this,async(e,t)=>{if(!(0,q.isSolanaChainId)(e)||!t)return;const n=await(0,J.getMinimumBalanceForRentExemptionInLamports)(t,this.messenger);this.update(e=>{e.minimumBalanceForRentExemptionInLamports=n})}),I.set(this,()=>({slippage_limit:this.state.quoteRequest.slippage,swap_type:(0,Y.getSwapTypeFromQuote)(this.state.quoteRequest),custom_slippage:(0,Y.isCustomSlippage)(this.state.quoteRequest.slippage)})),k.set(this,()=>({quotes_count:this.state.quotes.length,quotes_list:this.state.quotes.map(({quote:e})=>(0,Y.formatProviderLabel)(e)),initial_load_time_all_quotes:this.state.quotesInitialLoadTime??0,has_gas_included_quote:this.state.quotes.some(({quote:e})=>e.gasIncluded)})),A.set(this,(e,t)=>{const n={...t,action_type:V.MetricsActionType.SWAPBRIDGE_V1};switch(e){case V.UnifiedSwapBridgeEventName.ButtonClicked:case V.UnifiedSwapBridgeEventName.PageViewed:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...n};case V.UnifiedSwapBridgeEventName.QuotesValidationFailed:return{...(0,Y.getRequestParams)(this.state.quoteRequest),refresh_count:this.state.quotesRefreshCount,...n};case V.UnifiedSwapBridgeEventName.QuotesReceived:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,I,"f").call(this),...v(this,k,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,r,"m",y).call(this)),refresh_count:this.state.quotesRefreshCount,...n};case V.UnifiedSwapBridgeEventName.QuotesRequested:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,I,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,r,"m",y).call(this)),has_sufficient_funds:!this.state.quoteRequest.insufficientBal,...n};case V.UnifiedSwapBridgeEventName.QuotesError:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,I,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,r,"m",y).call(this)),error_message:this.state.quoteFetchError,has_sufficient_funds:!this.state.quoteRequest.insufficientBal,...n};case V.UnifiedSwapBridgeEventName.AllQuotesOpened:case V.UnifiedSwapBridgeEventName.AllQuotesSorted:case V.UnifiedSwapBridgeEventName.QuoteSelected:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,I,"f").call(this),...v(this,k,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,r,"m",y).call(this)),...n};case V.UnifiedSwapBridgeEventName.Failed:return{...n,...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,I,"f").call(this),...v(this,k,"f").call(this),...t};case V.UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:return n;case V.UnifiedSwapBridgeEventName.Submitted:case V.UnifiedSwapBridgeEventName.Completed:return t;case V.UnifiedSwapBridgeEventName.InputChanged:default:return n}}),C.set(this,e=>{Object.entries(e).forEach(([t,n])=>{const r=Y.toInputChangedPropertyKey[t],a=Y.toInputChangedPropertyValue[t]?.(e);r&&a!==undefined&&n!==this.state.quoteRequest[t]&&this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.InputChanged,{input:r,input_value:a})})}),this.trackUnifiedSwapBridgeEvent=(e,t)=>{try{const n=v(this,A,"f").call(this,e,t);v(this,u,"f").call(this,e,n)}catch(t){console.error(`Error tracking cross-chain swaps MetaMetrics event ${e}`,t)}},_.set(this,async(e,t,n)=>{const a=v(this,r,"m",S).call(this,M.CHAIN_IDS.MAINNET),s=a?.provider;if(!s)throw new Error("No provider found");const i=new j.Web3Provider(s),o=new R.Contract(t,O.abiERC20,i),c=(0,q.isCrossChain)(M.CHAIN_IDS.MAINNET,n)?L.METABRIDGE_ETHEREUM_ADDRESS:F.SWAPS_CONTRACT_ADDRESSES[M.CHAIN_IDS.MAINNET];return(await o.allowance(e,c)).toString()}),this.setIntervalLength(L.REFRESH_INTERVAL_MS),P(this,a,new AbortController,"f"),P(this,c,Z,"f"),P(this,i,n,"f"),P(this,o,x,"f"),P(this,l,ee,"f"),P(this,u,ne,"f"),P(this,h,te??{},"f"),P(this,d,re??((e,t)=>t?.()),"f"),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,this.setChainIntervalLength.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,this.updateBridgeQuoteRequestParams.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:resetState`,this.resetState.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,this.trackUnifiedSwapBridgeEvent.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,this.stopPollingForQuotes.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:fetchQuotes`,this.fetchQuotes.bind(this))}}n.BridgeController=Z,a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,w=new WeakMap,b=new WeakMap,T=new WeakMap,E=new WeakMap,I=new WeakMap,k=new WeakMap,A=new WeakMap,C=new WeakMap,_=new WeakMap,r=new WeakSet,y=function(e){const t=e??this.state.quoteRequest.walletAddress;if(!t)throw new Error("Account address is required");return this.messenger.call("AccountsController:getAccountByAddress",t)},S=function(e){const t=this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);if(!t)throw new Error(`No network client found for chainId: ${e}`);return this.messenger.call("NetworkController:getNetworkClientById",t)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/bridge-controller.cjs"}],[3138,{"./chains.cjs":3139,"@ethersproject/constants":768,"@metamask/keyring-api":2300},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.METABRIDGE_CHAIN_TO_ADDRESS_MAP=n.DEFAULT_BRIDGE_CONTROLLER_STATE=n.DEFAULT_FEATURE_FLAG_CONFIG=n.BRIDGE_CONTROLLER_NAME=n.DEFAULT_MAX_REFRESH_COUNT=n.REFRESH_INTERVAL_MS=n.BRIDGE_MM_FEE_RATE=n.BRIDGE_PREFERRED_GAS_ESTIMATE=n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=n.BRIDGE_QUOTE_MAX_ETA_SECONDS=n.METABRIDGE_ETHEREUM_ADDRESS=n.ETH_USDT_ADDRESS=n.BridgeClientId=n.BRIDGE_PROD_API_BASE_URL=n.BRIDGE_DEV_API_BASE_URL=n.ALLOWED_BRIDGE_CHAIN_IDS=void 0;const r=e("@ethersproject/constants"),a=e("@metamask/keyring-api"),s=e("./chains.cjs");var i;n.ALLOWED_BRIDGE_CHAIN_IDS=[s.CHAIN_IDS.MAINNET,s.CHAIN_IDS.BSC,s.CHAIN_IDS.POLYGON,s.CHAIN_IDS.ZKSYNC_ERA,s.CHAIN_IDS.AVALANCHE,s.CHAIN_IDS.OPTIMISM,s.CHAIN_IDS.ARBITRUM,s.CHAIN_IDS.LINEA_MAINNET,s.CHAIN_IDS.BASE,s.CHAIN_IDS.SEI,s.CHAIN_IDS.MONAD,a.SolScope.Mainnet,a.BtcScope.Mainnet,a.TrxScope.Mainnet],n.BRIDGE_DEV_API_BASE_URL="https://bridge.dev-api.cx.metamask.io",n.BRIDGE_PROD_API_BASE_URL="https://bridge.api.cx.metamask.io",function(e){e.EXTENSION="extension",e.MOBILE="mobile"}(i||(n.BridgeClientId=i={})),n.ETH_USDT_ADDRESS="0xdac17f958d2ee523a2206206994597c13d831ec7",n.METABRIDGE_ETHEREUM_ADDRESS="0x0439e60F02a8900a951603950d8D4527f400C3f1",n.BRIDGE_QUOTE_MAX_ETA_SECONDS=3600,n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=.5,n.BRIDGE_PREFERRED_GAS_ESTIMATE="medium",n.BRIDGE_MM_FEE_RATE=.875,n.REFRESH_INTERVAL_MS=3e4,n.DEFAULT_MAX_REFRESH_COUNT=5,n.BRIDGE_CONTROLLER_NAME="BridgeController",n.DEFAULT_FEATURE_FLAG_CONFIG={minimumVersion:"0.0.0",refreshRate:n.REFRESH_INTERVAL_MS,maxRefreshCount:n.DEFAULT_MAX_REFRESH_COUNT,support:!1,chains:{}},n.DEFAULT_BRIDGE_CONTROLLER_STATE={quoteRequest:{srcTokenAddress:r.AddressZero},quotesInitialLoadTime:null,quotes:[],quotesLastFetched:null,quotesLoadingStatus:null,quoteFetchError:null,quotesRefreshCount:0,assetExchangeRates:{},minimumBalanceForRentExemptionInLamports:"0"},n.METABRIDGE_CHAIN_TO_ADDRESS_MAP={[s.CHAIN_IDS.MAINNET]:n.METABRIDGE_ETHEREUM_ADDRESS}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/bridge.cjs"}],[3139,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NETWORK_TO_NAME_MAP=n.MONAD_DISPLAY_NAME=n.SEI_DISPLAY_NAME=n.MODE_DISPLAY_NAME=n.MODE_SEPOLIA_DISPLAY_NAME=n.SONEIUM_DISPLAY_NAME=n.INK_DISPLAY_NAME=n.INK_SEPOLIA_DISPLAY_NAME=n.LISK_SEPOLIA_DISPLAY_NAME=n.LISK_DISPLAY_NAME=n.METACHAIN_ONE_DISPLAY_NAME=n.BERACHAIN_DISPLAY_NAME=n.OP_BNB_DISPLAY_NAME=n.SCROLL_SEPOLIA_DISPLAY_NAME=n.SCROLL_DISPLAY_NAME=n.MOONRIVER_DISPLAY_NAME=n.MOONBEAM_DISPLAY_NAME=n.POLYGON_ZKEVM_DISPLAY_NAME=n.CRONOS_DISPLAY_NAME=n.AURORA_DISPLAY_NAME=n.BASE_DISPLAY_NAME=n.ZK_SYNC_ERA_DISPLAY_NAME=n.GNOSIS_DISPLAY_NAME=n.CELO_DISPLAY_NAME=n.PALM_DISPLAY_NAME=n.HARMONY_DISPLAY_NAME=n.FANTOM_DISPLAY_NAME=n.OPTIMISM_DISPLAY_NAME=n.BNB_DISPLAY_NAME=n.ARBITRUM_DISPLAY_NAME=n.AVALANCHE_DISPLAY_NAME=n.POLYGON_DISPLAY_NAME=n.BSC_DISPLAY_NAME=n.LOCALHOST_DISPLAY_NAME=n.LINEA_MAINNET_DISPLAY_NAME=n.LINEA_SEPOLIA_DISPLAY_NAME=n.LINEA_GOERLI_DISPLAY_NAME=n.SEPOLIA_DISPLAY_NAME=n.GOERLI_DISPLAY_NAME=n.MAINNET_DISPLAY_NAME=n.NETWORK_TYPES=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",LOCALHOST:"0x539",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0xaa37dc",OPTIMISM_GOERLI:"0x1a4",BASE:"0x2105",BASE_TESTNET:"0x14a33",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",CELO:"0xa4ec",ARBITRUM:"0xa4b1",HARMONY:"0x63564c40",PALM:"0x2a15c308d",SEPOLIA:"0xaa36a7",HOLESKY:"0x4268",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",AMOY:"0x13882",BASE_SEPOLIA:"0x14a34",BLAST_SEPOLIA:"0xa0c71fd",OPTIMISM_SEPOLIA:"0xaa37dc",PALM_TESTNET:"0x2a15c3083",CELO_TESTNET:"0xaef3",ZK_SYNC_ERA_TESTNET:"0x12c",MANTA_SEPOLIA:"0x138b",UNICHAIN_SEPOLIA:"0x515",LINEA_MAINNET:"0xe708",AURORA:"0x4e454152",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",CRONOS:"0x19",GNOSIS:"0x64",ZKSYNC_ERA:"0x144",TEST_ETH:"0x539",ARBITRUM_GOERLI:"0x66eed",BLAST:"0x13e31",FILECOIN:"0x13a",POLYGON_ZKEVM:"0x44d",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",WETHIO:"0x4e",CHZ:"0x15b38",NUMBERS:"0x290b",SEI:"0x531",APE_TESTNET:"0x8157",APE_MAINNET:"0x8173",BERACHAIN:"0x138d5",METACHAIN_ONE:"0x1b6e6",ARBITRUM_SEPOLIA:"0x66eee",NEAR:"0x18d",NEAR_TESTNET:"0x18e",B3:"0x208d",B3_TESTNET:"0x7c9",GRAVITY_ALPHA_MAINNET:"0x659",GRAVITY_ALPHA_TESTNET_SEPOLIA:"0x34c1",LISK:"0x46f",LISK_SEPOLIA:"0x106a",INK_SEPOLIA:"0xba5eD",INK:"0xdef1",MODE_SEPOLIA:"0x397",MODE:"0x868b",MONAD:"0x8f"},n.NETWORK_TYPES={GOERLI:"goerli",LOCALHOST:"localhost",MAINNET:"mainnet",SEPOLIA:"sepolia",LINEA_GOERLI:"linea-goerli",LINEA_SEPOLIA:"linea-sepolia",LINEA_MAINNET:"linea-mainnet"},n.MAINNET_DISPLAY_NAME="Ethereum Mainnet",n.GOERLI_DISPLAY_NAME="Goerli",n.SEPOLIA_DISPLAY_NAME="Sepolia",n.LINEA_GOERLI_DISPLAY_NAME="Linea Goerli",n.LINEA_SEPOLIA_DISPLAY_NAME="Linea Sepolia",n.LINEA_MAINNET_DISPLAY_NAME="Linea Mainnet",n.LOCALHOST_DISPLAY_NAME="Localhost 8545",n.BSC_DISPLAY_NAME="Binance Smart Chain",n.POLYGON_DISPLAY_NAME="Polygon",n.AVALANCHE_DISPLAY_NAME="Avalanche Network C-Chain",n.ARBITRUM_DISPLAY_NAME="Arbitrum One",n.BNB_DISPLAY_NAME="BNB Chain",n.OPTIMISM_DISPLAY_NAME="OP Mainnet",n.FANTOM_DISPLAY_NAME="Fantom Opera",n.HARMONY_DISPLAY_NAME="Harmony Mainnet Shard 0",n.PALM_DISPLAY_NAME="Palm",n.CELO_DISPLAY_NAME="Celo Mainnet",n.GNOSIS_DISPLAY_NAME="Gnosis",n.ZK_SYNC_ERA_DISPLAY_NAME="zkSync Era Mainnet",n.BASE_DISPLAY_NAME="Base Mainnet",n.AURORA_DISPLAY_NAME="Aurora Mainnet",n.CRONOS_DISPLAY_NAME="Cronos",n.POLYGON_ZKEVM_DISPLAY_NAME="Polygon zkEVM",n.MOONBEAM_DISPLAY_NAME="Moonbeam",n.MOONRIVER_DISPLAY_NAME="Moonriver",n.SCROLL_DISPLAY_NAME="Scroll",n.SCROLL_SEPOLIA_DISPLAY_NAME="Scroll Sepolia",n.OP_BNB_DISPLAY_NAME="opBNB",n.BERACHAIN_DISPLAY_NAME="Berachain Artio",n.METACHAIN_ONE_DISPLAY_NAME="Metachain One Mainnet",n.LISK_DISPLAY_NAME="Lisk",n.LISK_SEPOLIA_DISPLAY_NAME="Lisk Sepolia",n.INK_SEPOLIA_DISPLAY_NAME="Ink Sepolia",n.INK_DISPLAY_NAME="Ink Mainnet",n.SONEIUM_DISPLAY_NAME="Soneium Mainnet",n.MODE_SEPOLIA_DISPLAY_NAME="Mode Sepolia",n.MODE_DISPLAY_NAME="Mode Mainnet",n.SEI_DISPLAY_NAME="Sei Network",n.MONAD_DISPLAY_NAME="Monad",n.NETWORK_TO_NAME_MAP={[n.NETWORK_TYPES.GOERLI]:n.GOERLI_DISPLAY_NAME,[n.NETWORK_TYPES.MAINNET]:n.MAINNET_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_GOERLI]:n.LINEA_GOERLI_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_SEPOLIA]:n.LINEA_SEPOLIA_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_MAINNET]:n.LINEA_MAINNET_DISPLAY_NAME,[n.NETWORK_TYPES.LOCALHOST]:n.LOCALHOST_DISPLAY_NAME,[n.NETWORK_TYPES.SEPOLIA]:n.SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.ARBITRUM]:n.ARBITRUM_DISPLAY_NAME,[n.CHAIN_IDS.AVALANCHE]:n.AVALANCHE_DISPLAY_NAME,[n.CHAIN_IDS.BSC]:n.BSC_DISPLAY_NAME,[n.CHAIN_IDS.BASE]:n.BASE_DISPLAY_NAME,[n.CHAIN_IDS.GOERLI]:n.GOERLI_DISPLAY_NAME,[n.CHAIN_IDS.MAINNET]:n.MAINNET_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_GOERLI]:n.LINEA_GOERLI_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_MAINNET]:n.LINEA_MAINNET_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_SEPOLIA]:n.LINEA_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.LOCALHOST]:n.LOCALHOST_DISPLAY_NAME,[n.CHAIN_IDS.OPTIMISM]:n.OPTIMISM_DISPLAY_NAME,[n.CHAIN_IDS.POLYGON]:n.POLYGON_DISPLAY_NAME,[n.CHAIN_IDS.SCROLL]:n.SCROLL_DISPLAY_NAME,[n.CHAIN_IDS.SCROLL_SEPOLIA]:n.SCROLL_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.SEPOLIA]:n.SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.OPBNB]:n.OP_BNB_DISPLAY_NAME,[n.CHAIN_IDS.ZKSYNC_ERA]:n.ZK_SYNC_ERA_DISPLAY_NAME,[n.CHAIN_IDS.BERACHAIN]:n.BERACHAIN_DISPLAY_NAME,[n.CHAIN_IDS.METACHAIN_ONE]:n.METACHAIN_ONE_DISPLAY_NAME,[n.CHAIN_IDS.LISK]:n.LISK_DISPLAY_NAME,[n.CHAIN_IDS.LISK_SEPOLIA]:n.LISK_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.SEI]:n.SEI_DISPLAY_NAME,[n.CHAIN_IDS.MONAD]:n.MONAD_DISPLAY_NAME}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/chains.cjs"}],[3140,{"./chains.cjs":3139},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ALLOWED_CONTRACT_ADDRESSES=n.SWAPS_WRAPPED_TOKENS_ADDRESSES=n.SWAPS_CONTRACT_ADDRESSES=n.SWAPS_API_V2_BASE_URL=void 0;const r=e("./chains.cjs");n.SWAPS_API_V2_BASE_URL="https://swap.api.cx.metamask.io";const a="0x881d40237659c251811cec9c364ef91dc08d300c";n.SWAPS_CONTRACT_ADDRESSES={[r.CHAIN_IDS.MAINNET]:a,[r.CHAIN_IDS.LOCALHOST]:a,[r.CHAIN_IDS.BSC]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[r.CHAIN_IDS.POLYGON]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[r.CHAIN_IDS.AVALANCHE]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[r.CHAIN_IDS.ARBITRUM]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[r.CHAIN_IDS.OPTIMISM]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[r.CHAIN_IDS.ZKSYNC_ERA]:"0xf504c1fe13d14df615e66dcd0abf39e60c697f34",[r.CHAIN_IDS.LINEA_MAINNET]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[r.CHAIN_IDS.BASE]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[r.CHAIN_IDS.SEI]:"0x962287c9d5B8a682389E61edAE90ec882325d08b"};const s="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2";n.SWAPS_WRAPPED_TOKENS_ADDRESSES={[r.CHAIN_IDS.MAINNET]:s,[r.CHAIN_IDS.LOCALHOST]:s,[r.CHAIN_IDS.BSC]:"0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",[r.CHAIN_IDS.POLYGON]:"0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270",[r.CHAIN_IDS.AVALANCHE]:"0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7",[r.CHAIN_IDS.ARBITRUM]:"0x82af49447d8a07e3bd95bd0d56f35241523fbab1",[r.CHAIN_IDS.OPTIMISM]:"0x4200000000000000000000000000000000000006",[r.CHAIN_IDS.ZKSYNC_ERA]:"0x5AEa5775959fBC2557Cc8789bC1bf90A239D9a91",[r.CHAIN_IDS.LINEA_MAINNET]:"0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f",[r.CHAIN_IDS.BASE]:"0x4200000000000000000000000000000000000006",[r.CHAIN_IDS.SEI]:"0xe30fedd158a2e3b13e9badaeabafc5516e95e8c7"},n.ALLOWED_CONTRACT_ADDRESSES={[r.CHAIN_IDS.MAINNET]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.MAINNET],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.MAINNET]],[r.CHAIN_IDS.LOCALHOST]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.LOCALHOST],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.LOCALHOST]],[r.CHAIN_IDS.BSC]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.BSC],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.BSC]],[r.CHAIN_IDS.POLYGON]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.POLYGON],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.POLYGON]],[r.CHAIN_IDS.AVALANCHE]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.AVALANCHE],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.AVALANCHE]],[r.CHAIN_IDS.ARBITRUM]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.ARBITRUM],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.ARBITRUM]],[r.CHAIN_IDS.OPTIMISM]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.OPTIMISM],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.OPTIMISM]],[r.CHAIN_IDS.ZKSYNC_ERA]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.ZKSYNC_ERA],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.ZKSYNC_ERA]],[r.CHAIN_IDS.LINEA_MAINNET]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.LINEA_MAINNET],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.LINEA_MAINNET]],[r.CHAIN_IDS.BASE]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.BASE],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.BASE]],[r.CHAIN_IDS.SEI]:[n.SWAPS_CONTRACT_ADDRESSES[r.CHAIN_IDS.SEI],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[r.CHAIN_IDS.SEI]]}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/swaps.cjs"}],[3141,{"./chains.cjs":3139,"@metamask/keyring-api":2300},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SYMBOL_TO_SLIP44_MAP=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=void 0;const r=e("@metamask/keyring-api"),a=e("./chains.cjs");n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const s="AVAX",i="BNB",o="ETH",c="POL",l="TESTETH",u="SOL",d="SEI",h="BTC",f="TRX",m="MON",p={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},g={symbol:i,name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},w={symbol:c,name:"Polygon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},b={symbol:s,name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},T={symbol:l,name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},E={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},y={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},S={...p},I={...p},k={...p},A={...p},C={...p},_={symbol:u,name:"Solana",address:n.DEFAULT_TOKEN_ADDRESS,decimals:9,iconUrl:""},P={symbol:h,name:"Bitcoin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:8,iconUrl:""},v={symbol:d,name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},N={symbol:f,name:"Tron",address:n.DEFAULT_TOKEN_ADDRESS,decimals:6,iconUrl:""},R={symbol:m,name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""};n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[a.CHAIN_IDS.MAINNET]:p,[a.CHAIN_IDS.LOCALHOST]:T,[a.CHAIN_IDS.BSC]:g,[a.CHAIN_IDS.POLYGON]:w,[a.CHAIN_IDS.GOERLI]:E,[a.CHAIN_IDS.SEPOLIA]:y,[a.CHAIN_IDS.AVALANCHE]:b,[a.CHAIN_IDS.OPTIMISM]:I,[a.CHAIN_IDS.ARBITRUM]:S,[a.CHAIN_IDS.ZKSYNC_ERA]:k,[a.CHAIN_IDS.LINEA_MAINNET]:A,[a.CHAIN_IDS.BASE]:C,[a.CHAIN_IDS.SEI]:v,[a.CHAIN_IDS.MONAD]:R,[r.SolScope.Mainnet]:_,[r.SolScope.Devnet]:_,[r.BtcScope.Mainnet]:P,[r.TrxScope.Mainnet]:N},n.SYMBOL_TO_SLIP44_MAP={SOL:"slip44:501",BTC:"slip44:0",ETH:"slip44:60",POL:"slip44:966",BNB:"slip44:714",AVAX:"slip44:9000",TESTETH:"slip44:60",SEI:"slip44:19000118",TRX:"slip44:195",MON:"slip44:268435779"}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/tokens.cjs"}],[3142,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceName=void 0,function(e){e.BridgeQuotesFetched="Bridge Quotes Fetched",e.SwapQuotesFetched="Swap Quotes Fetched"}(r||(n.TraceName=r={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/traces.cjs"}],[3143,{"./bridge-controller.cjs":3137,"./constants/bridge.cjs":3138,"./constants/swaps.cjs":3140,"./constants/tokens.cjs":3141,"./selectors.cjs":3144,"./types.cjs":3145,"./utils/balance.cjs":3147,"./utils/bridge.cjs":3148,"./utils/caip-formatters.cjs":3149,"./utils/feature-flags.cjs":3150,"./utils/fetch.cjs":3152,"./utils/metrics/constants.cjs":3153,"./utils/metrics/properties.cjs":3154,"./utils/quote.cjs":3156,"./utils/slippage.cjs":3157,"./utils/swaps.cjs":3159,"./utils/trade-utils.cjs":3160,"./utils/validators.cjs":3161},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidQuoteRequest=n.isCrossChain=n.getDefaultBridgeControllerState=n.getNativeAssetForChainId=n.isNonEvmChainId=n.isBitcoinChainId=n.isSolanaChainId=n.isNativeAddress=n.isEthUsdt=n.MetricsSwapType=n.MetricsActionType=n.ALLOWED_CONTRACT_ADDRESSES=n.SWAPS_WRAPPED_TOKENS_ADDRESSES=n.SWAPS_CONTRACT_ADDRESSES=n.SWAPS_API_V2_BASE_URL=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.BRIDGE_PROD_API_BASE_URL=n.BRIDGE_DEV_API_BASE_URL=n.METABRIDGE_CHAIN_TO_ADDRESS_MAP=n.DEFAULT_BRIDGE_CONTROLLER_STATE=n.DEFAULT_MAX_REFRESH_COUNT=n.REFRESH_INTERVAL_MS=n.BRIDGE_MM_FEE_RATE=n.BRIDGE_PREFERRED_GAS_ESTIMATE=n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=n.BRIDGE_QUOTE_MAX_ETA_SECONDS=n.BRIDGE_CONTROLLER_NAME=n.BridgeClientId=n.ALLOWED_BRIDGE_CHAIN_IDS=n.FeatureId=n.BridgeAssetSchema=n.ActionTypes=n.FeeType=n.BridgeBackgroundAction=n.BridgeUserAction=n.RequestStatus=n.ChainId=n.SortOrder=n.AssetType=n.StatusTypes=n.AbortReason=n.getQuotesReceivedProperties=n.isCustomSlippage=n.isHardwareWallet=n.getSwapType=n.getRequestParams=n.formatProviderLabel=n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY=n.UnifiedSwapBridgeEventName=n.BridgeController=void 0,n.fetchTokens=n.getSwapsContractAddress=n.isValidSwapsContractAddress=n.BRIDGE_DEFAULT_SLIPPAGE=n.getBridgeFeatureFlags=n.DEFAULT_FEATURE_FLAG_CONFIG=n.selectMinimumBalanceForRentExemptionInSOL=n.selectBridgeFeatureFlags=n.selectIsQuoteExpired=n.selectExchangeRateByChainIdAndAddress=n.selectDefaultSlippagePercentage=n.selectBridgeQuotes=n.isEvmTxData=n.isTronTrade=n.isBitcoinTrade=n.extractTradeData=n.formatAddressToAssetId=n.formatAddressToCaipReference=n.formatChainIdToHex=n.formatChainIdToCaip=n.getClientHeaders=n.fetchBridgeTokens=n.calcLatestSrcBalance=n.calcSlippagePercentage=n.formatEtaInMinutes=void 0;var r=e("./bridge-controller.cjs");Object.defineProperty(n,"BridgeController",{enumerable:!0,get:function(){return r.BridgeController}});var a=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"UnifiedSwapBridgeEventName",{enumerable:!0,get:function(){return a.UnifiedSwapBridgeEventName}}),Object.defineProperty(n,"UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY",{enumerable:!0,get:function(){return a.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY}});var s=e("./utils/metrics/properties.cjs");Object.defineProperty(n,"formatProviderLabel",{enumerable:!0,get:function(){return s.formatProviderLabel}}),Object.defineProperty(n,"getRequestParams",{enumerable:!0,get:function(){return s.getRequestParams}}),Object.defineProperty(n,"getSwapType",{enumerable:!0,get:function(){return s.getSwapType}}),Object.defineProperty(n,"isHardwareWallet",{enumerable:!0,get:function(){return s.isHardwareWallet}}),Object.defineProperty(n,"isCustomSlippage",{enumerable:!0,get:function(){return s.isCustomSlippage}}),Object.defineProperty(n,"getQuotesReceivedProperties",{enumerable:!0,get:function(){return s.getQuotesReceivedProperties}});var i=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"AbortReason",{enumerable:!0,get:function(){return i.AbortReason}});var o=e("./types.cjs");Object.defineProperty(n,"StatusTypes",{enumerable:!0,get:function(){return o.StatusTypes}});var c=e("./types.cjs");Object.defineProperty(n,"AssetType",{enumerable:!0,get:function(){return c.AssetType}}),Object.defineProperty(n,"SortOrder",{enumerable:!0,get:function(){return c.SortOrder}}),Object.defineProperty(n,"ChainId",{enumerable:!0,get:function(){return c.ChainId}}),Object.defineProperty(n,"RequestStatus",{enumerable:!0,get:function(){return c.RequestStatus}}),Object.defineProperty(n,"BridgeUserAction",{enumerable:!0,get:function(){return c.BridgeUserAction}}),Object.defineProperty(n,"BridgeBackgroundAction",{enumerable:!0,get:function(){return c.BridgeBackgroundAction}});var l=e("./utils/validators.cjs");Object.defineProperty(n,"FeeType",{enumerable:!0,get:function(){return l.FeeType}}),Object.defineProperty(n,"ActionTypes",{enumerable:!0,get:function(){return l.ActionTypes}}),Object.defineProperty(n,"BridgeAssetSchema",{enumerable:!0,get:function(){return l.BridgeAssetSchema}}),Object.defineProperty(n,"FeatureId",{enumerable:!0,get:function(){return l.FeatureId}});var u=e("./constants/bridge.cjs");Object.defineProperty(n,"ALLOWED_BRIDGE_CHAIN_IDS",{enumerable:!0,get:function(){return u.ALLOWED_BRIDGE_CHAIN_IDS}}),Object.defineProperty(n,"BridgeClientId",{enumerable:!0,get:function(){return u.BridgeClientId}}),Object.defineProperty(n,"BRIDGE_CONTROLLER_NAME",{enumerable:!0,get:function(){return u.BRIDGE_CONTROLLER_NAME}}),Object.defineProperty(n,"BRIDGE_QUOTE_MAX_ETA_SECONDS",{enumerable:!0,get:function(){return u.BRIDGE_QUOTE_MAX_ETA_SECONDS}}),Object.defineProperty(n,"BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE",{enumerable:!0,get:function(){return u.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE}}),Object.defineProperty(n,"BRIDGE_PREFERRED_GAS_ESTIMATE",{enumerable:!0,get:function(){return u.BRIDGE_PREFERRED_GAS_ESTIMATE}}),Object.defineProperty(n,"BRIDGE_MM_FEE_RATE",{enumerable:!0,get:function(){return u.BRIDGE_MM_FEE_RATE}}),Object.defineProperty(n,"REFRESH_INTERVAL_MS",{enumerable:!0,get:function(){return u.REFRESH_INTERVAL_MS}}),Object.defineProperty(n,"DEFAULT_MAX_REFRESH_COUNT",{enumerable:!0,get:function(){return u.DEFAULT_MAX_REFRESH_COUNT}}),Object.defineProperty(n,"DEFAULT_BRIDGE_CONTROLLER_STATE",{enumerable:!0,get:function(){return u.DEFAULT_BRIDGE_CONTROLLER_STATE}}),Object.defineProperty(n,"METABRIDGE_CHAIN_TO_ADDRESS_MAP",{enumerable:!0,get:function(){return u.METABRIDGE_CHAIN_TO_ADDRESS_MAP}}),Object.defineProperty(n,"BRIDGE_DEV_API_BASE_URL",{enumerable:!0,get:function(){return u.BRIDGE_DEV_API_BASE_URL}}),Object.defineProperty(n,"BRIDGE_PROD_API_BASE_URL",{enumerable:!0,get:function(){return u.BRIDGE_PROD_API_BASE_URL}});var d=e("./constants/tokens.cjs");Object.defineProperty(n,"SWAPS_CHAINID_DEFAULT_TOKEN_MAP",{enumerable:!0,get:function(){return d.SWAPS_CHAINID_DEFAULT_TOKEN_MAP}});var h=e("./constants/swaps.cjs");Object.defineProperty(n,"SWAPS_API_V2_BASE_URL",{enumerable:!0,get:function(){return h.SWAPS_API_V2_BASE_URL}}),Object.defineProperty(n,"SWAPS_CONTRACT_ADDRESSES",{enumerable:!0,get:function(){return h.SWAPS_CONTRACT_ADDRESSES}}),Object.defineProperty(n,"SWAPS_WRAPPED_TOKENS_ADDRESSES",{enumerable:!0,get:function(){return h.SWAPS_WRAPPED_TOKENS_ADDRESSES}}),Object.defineProperty(n,"ALLOWED_CONTRACT_ADDRESSES",{enumerable:!0,get:function(){return h.ALLOWED_CONTRACT_ADDRESSES}});var f=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"MetricsActionType",{enumerable:!0,get:function(){return f.MetricsActionType}}),Object.defineProperty(n,"MetricsSwapType",{enumerable:!0,get:function(){return f.MetricsSwapType}});var m=e("./utils/bridge.cjs");Object.defineProperty(n,"isEthUsdt",{enumerable:!0,get:function(){return m.isEthUsdt}}),Object.defineProperty(n,"isNativeAddress",{enumerable:!0,get:function(){return m.isNativeAddress}}),Object.defineProperty(n,"isSolanaChainId",{enumerable:!0,get:function(){return m.isSolanaChainId}}),Object.defineProperty(n,"isBitcoinChainId",{enumerable:!0,get:function(){return m.isBitcoinChainId}}),Object.defineProperty(n,"isNonEvmChainId",{enumerable:!0,get:function(){return m.isNonEvmChainId}}),Object.defineProperty(n,"getNativeAssetForChainId",{enumerable:!0,get:function(){return m.getNativeAssetForChainId}}),Object.defineProperty(n,"getDefaultBridgeControllerState",{enumerable:!0,get:function(){return m.getDefaultBridgeControllerState}}),Object.defineProperty(n,"isCrossChain",{enumerable:!0,get:function(){return m.isCrossChain}});var p=e("./utils/quote.cjs");Object.defineProperty(n,"isValidQuoteRequest",{enumerable:!0,get:function(){return p.isValidQuoteRequest}}),Object.defineProperty(n,"formatEtaInMinutes",{enumerable:!0,get:function(){return p.formatEtaInMinutes}}),Object.defineProperty(n,"calcSlippagePercentage",{enumerable:!0,get:function(){return p.calcSlippagePercentage}});var g=e("./utils/balance.cjs");Object.defineProperty(n,"calcLatestSrcBalance",{enumerable:!0,get:function(){return g.calcLatestSrcBalance}});var w=e("./utils/fetch.cjs");Object.defineProperty(n,"fetchBridgeTokens",{enumerable:!0,get:function(){return w.fetchBridgeTokens}}),Object.defineProperty(n,"getClientHeaders",{enumerable:!0,get:function(){return w.getClientHeaders}});var b=e("./utils/caip-formatters.cjs");Object.defineProperty(n,"formatChainIdToCaip",{enumerable:!0,get:function(){return b.formatChainIdToCaip}}),Object.defineProperty(n,"formatChainIdToHex",{enumerable:!0,get:function(){return b.formatChainIdToHex}}),Object.defineProperty(n,"formatAddressToCaipReference",{enumerable:!0,get:function(){return b.formatAddressToCaipReference}}),Object.defineProperty(n,"formatAddressToAssetId",{enumerable:!0,get:function(){return b.formatAddressToAssetId}});var T=e("./utils/trade-utils.cjs");Object.defineProperty(n,"extractTradeData",{enumerable:!0,get:function(){return T.extractTradeData}}),Object.defineProperty(n,"isBitcoinTrade",{enumerable:!0,get:function(){return T.isBitcoinTrade}}),Object.defineProperty(n,"isTronTrade",{enumerable:!0,get:function(){return T.isTronTrade}}),Object.defineProperty(n,"isEvmTxData",{enumerable:!0,get:function(){return T.isEvmTxData}});var E=e("./selectors.cjs");Object.defineProperty(n,"selectBridgeQuotes",{enumerable:!0,get:function(){return E.selectBridgeQuotes}}),Object.defineProperty(n,"selectDefaultSlippagePercentage",{enumerable:!0,get:function(){return E.selectDefaultSlippagePercentage}}),Object.defineProperty(n,"selectExchangeRateByChainIdAndAddress",{enumerable:!0,get:function(){return E.selectExchangeRateByChainIdAndAddress}}),Object.defineProperty(n,"selectIsQuoteExpired",{enumerable:!0,get:function(){return E.selectIsQuoteExpired}}),Object.defineProperty(n,"selectBridgeFeatureFlags",{enumerable:!0,get:function(){return E.selectBridgeFeatureFlags}}),Object.defineProperty(n,"selectMinimumBalanceForRentExemptionInSOL",{enumerable:!0,get:function(){return E.selectMinimumBalanceForRentExemptionInSOL}});var y=e("./constants/bridge.cjs");Object.defineProperty(n,"DEFAULT_FEATURE_FLAG_CONFIG",{enumerable:!0,get:function(){return y.DEFAULT_FEATURE_FLAG_CONFIG}});var S=e("./utils/feature-flags.cjs");Object.defineProperty(n,"getBridgeFeatureFlags",{enumerable:!0,get:function(){return S.getBridgeFeatureFlags}});var I=e("./utils/slippage.cjs");Object.defineProperty(n,"BRIDGE_DEFAULT_SLIPPAGE",{enumerable:!0,get:function(){return I.BRIDGE_DEFAULT_SLIPPAGE}});var k=e("./utils/swaps.cjs");Object.defineProperty(n,"isValidSwapsContractAddress",{enumerable:!0,get:function(){return k.isValidSwapsContractAddress}}),Object.defineProperty(n,"getSwapsContractAddress",{enumerable:!0,get:function(){return k.getSwapsContractAddress}}),Object.defineProperty(n,"fetchTokens",{enumerable:!0,get:function(){return k.fetchTokens}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/index.cjs"}],[3144,{"./constants/bridge.cjs":3138,"./types.cjs":3145,"./utils/bridge.cjs":3148,"./utils/caip-formatters.cjs":3149,"./utils/feature-flags.cjs":3150,"./utils/quote.cjs":3156,"./utils/slippage.cjs":3157,"@ethersproject/constants":768,"@metamask/utils":3207,"bignumber.js":3178,lodash:4940,reselect:5410},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.selectDefaultSlippagePercentage=n.selectMinimumBalanceForRentExemptionInSOL=n.selectBridgeQuotes=n.selectIsQuoteExpired=n.selectIsAssetExchangeRateInState=n.selectExchangeRateByChainIdAndAddress=n.selectBridgeFeatureFlags=void 0;const r=e("@ethersproject/constants"),a=e("@metamask/utils"),s=e("bignumber.js"),i=e("lodash"),o=e("reselect"),c=e("./constants/bridge.cjs"),l=e("./types.cjs"),u=e("./utils/bridge.cjs"),d=e("./utils/caip-formatters.cjs"),h=e("./utils/feature-flags.cjs"),f=e("./utils/quote.cjs"),m=e("./utils/slippage.cjs"),p=o.createStructuredSelector.withTypes(),g=o.createSelector.withTypes(),w=o.createSelector.withTypes();n.selectBridgeFeatureFlags=w([e=>e.remoteFeatureFlags.bridgeConfig],e=>(0,h.processFeatureFlags)(e));const b=(e,t,n)=>{if(!t||!n)return{};const r=(0,d.formatAddressToAssetId)(n,t);if(!r)return{};const{assetExchangeRates:i,currencyRates:o,marketData:c,conversionRates:l}=e,h=i?.[r]??i?.[r.toLowerCase()];if(h?.exchangeRate)return h;if((0,u.isNonEvmChainId)(t)){const e=l?.[r];return e?{exchangeRate:e.rate,usdExchangeRate:undefined}:{}}if((0,u.isNativeAddress)(n)){const{symbol:e}=(0,u.getNativeAssetForChainId)(t),n=o?.[e];return n?{exchangeRate:n?.conversionRate?.toString(),usdExchangeRate:n?.usdConversionRate?.toString()}:{}}if(!(0,u.isNonEvmChainId)(t)){const e=c?.[(0,d.formatChainIdToHex)(t)],r=(0,a.isStrictHexString)(n)?e?.[n]:null,i=r?o[r?.currency]:undefined;if(r&&i)return{exchangeRate:new s.BigNumber(r.price).multipliedBy(i.conversionRate??0).toString(),usdExchangeRate:new s.BigNumber(r.price).multipliedBy(i.usdConversionRate??0).toString()}}return{}};n.selectExchangeRateByChainIdAndAddress=(e,t,n)=>b(e,t,n);n.selectIsAssetExchangeRateInState=(...e)=>Boolean(b(...e)?.exchangeRate)&&Boolean(b(...e)?.usdExchangeRate);const T=g([({quotes:e})=>e,p({estimatedBaseFeeInDecGwei:({gasFeeEstimates:e})=>e?.estimatedBaseFee,feePerGasInDecGwei:({gasFeeEstimates:e})=>e?.[c.BRIDGE_PREFERRED_GAS_ESTIMATE]?.suggestedMaxFeePerGas,maxFeePerGasInDecGwei:({gasFeeEstimates:e})=>e?.high?.suggestedMaxFeePerGas}),g([e=>e,({quoteRequest:{srcChainId:e}})=>e,({quoteRequest:{srcTokenAddress:e}})=>e],n.selectExchangeRateByChainIdAndAddress),g([e=>e,({quoteRequest:{destChainId:e}})=>e,({quoteRequest:{destTokenAddress:e}})=>e],n.selectExchangeRateByChainIdAndAddress),g([e=>e,({quoteRequest:{srcChainId:e}})=>e],(e,t)=>(0,n.selectExchangeRateByChainIdAndAddress)(e,t,r.AddressZero))],(e,t,n,r,a)=>e.map(e=>{const s=(0,f.calcSentAmount)(e.quote,n),i=(0,f.calcToAmount)(e.quote.destTokenAmount,e.quote.destAsset,r),o=(0,f.calcToAmount)(e.quote.minDestTokenAmount,e.quote.destAsset,r),c=(0,f.calcIncludedTxFees)(e.quote,n,r);let l,d,h,m;(0,u.isEvmQuoteResponse)(e)?(h=(0,f.calcRelayerFee)(e,a),m=(0,f.calcEstimatedAndMaxTotalGasFee)({bridgeQuote:e,...t,...a}),l=(0,f.calcTotalEstimatedNetworkFee)(m,h),d=(0,f.calcTotalMaxNetworkFee)(m,h)):(l=(0,f.calcNonEvmTotalNetworkFee)(e,a),m={effective:l,total:l,max:l},d=l);const p=(0,f.calcAdjustedReturn)(i,l,e.quote),g=(0,f.calcCost)(p,s);return{...e,sentAmount:s,toTokenAmount:i,minToTokenAmount:o,swapRate:(0,f.calcSwapRate)(s.amount,i.amount),totalNetworkFee:l,totalMaxNetworkFee:d,gasFee:m,adjustedReturn:p,cost:g,includedTxFees:c}})),E=g([T,(e,{sortOrder:t})=>t],(e,t)=>t===l.SortOrder.ETA_ASC?(0,i.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc"):(0,i.orderBy)(e,({cost:e})=>e.valueInCurrency?Number(e.valueInCurrency):0,"asc")),y=g([E],e=>e.length>0?e[0]:null),S=g([y,(e,{selectedQuote:t})=>t],(e,t)=>t??e),I=g([n.selectBridgeFeatureFlags,e=>e.quoteRequest.insufficientBal,e=>e.quotesRefreshCount],(e,t,n)=>!t&&e.maxRefreshCount>n),k=g([n.selectBridgeFeatureFlags,e=>e.quoteRequest.srcChainId],(e,t)=>(t?e.chains[(0,d.formatChainIdToCaip)(t)]?.refreshRate:e.refreshRate)??e.refreshRate);n.selectIsQuoteExpired=g([I,({quotesLastFetched:e})=>e,k,(e,t,n)=>n],(e,t,n,r)=>Boolean(!e&&t&&r-t>n)),n.selectBridgeQuotes=p({sortedQuotes:E,recommendedQuote:y,activeQuote:S,quotesLastFetchedMs:e=>e.quotesLastFetched,isLoading:e=>e.quotesLoadingStatus===l.RequestStatus.LOADING,quoteFetchError:e=>e.quoteFetchError,quotesRefreshCount:e=>e.quotesRefreshCount,quotesInitialLoadTimeMs:e=>e.quotesInitialLoadTime,isQuoteGoingToRefresh:I});n.selectMinimumBalanceForRentExemptionInSOL=e=>new s.BigNumber(e.minimumBalanceForRentExemptionInLamports??0).div(10**9).toString(),n.selectDefaultSlippagePercentage=g([e=>(0,n.selectBridgeFeatureFlags)(e).chains,(e,t)=>t.srcTokenAddress,(e,t)=>t.destTokenAddress,(e,t)=>t.srcChainId?(0,d.formatChainIdToCaip)(t.srcChainId):undefined,(e,t)=>t.destChainId?(0,d.formatChainIdToCaip)(t.destChainId):undefined],(e,t,n,r,a)=>(0,m.getDefaultSlippagePercentage)({srcTokenAddress:t,destTokenAddress:n,srcChainId:r,destChainId:a},r?e[r]?.stablecoins:undefined,a?e[a]?.stablecoins:undefined))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/selectors.cjs"}],[3145,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l;Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeBackgroundAction=n.BridgeUserAction=n.RequestStatus=n.ChainId=n.StatusTypes=n.SortOrder=n.AssetType=void 0,function(e){e.native="NATIVE",e.token="TOKEN",e.NFT="NFT",e.unknown="UNKNOWN"}(r||(n.AssetType=r={})),function(e){e.COST_ASC="cost_ascending",e.ETA_ASC="time_descending"}(a||(n.SortOrder=a={})),function(e){e.SUBMITTED="SUBMITTED",e.UNKNOWN="UNKNOWN",e.FAILED="FAILED",e.PENDING="PENDING",e.COMPLETE="COMPLETE"}(s||(n.StatusTypes=s={})),function(e){e[e.ETH=1]="ETH",e[e.OPTIMISM=10]="OPTIMISM",e[e.BSC=56]="BSC",e[e.POLYGON=137]="POLYGON",e[e.ZKSYNC=324]="ZKSYNC",e[e.BASE=8453]="BASE",e[e.ARBITRUM=42161]="ARBITRUM",e[e.AVALANCHE=43114]="AVALANCHE",e[e.LINEA=59144]="LINEA",e[e.SOLANA=0x416edef1601be]="SOLANA",e[e.BTC=20000000000001]="BTC",e[e.TRON=728126428]="TRON",e[e.SEI=1329]="SEI",e[e.MONAD=143]="MONAD"}(i||(n.ChainId=i={})),function(e){e[e.LOADING=0]="LOADING",e[e.FETCHED=1]="FETCHED",e[e.ERROR=2]="ERROR"}(o||(n.RequestStatus=o={})),function(e){e.SELECT_DEST_NETWORK="selectDestNetwork",e.UPDATE_QUOTE_PARAMS="updateBridgeQuoteRequestParams"}(c||(n.BridgeUserAction=c={})),function(e){e.SET_CHAIN_INTERVAL_LENGTH="setChainIntervalLength",e.RESET_STATE="resetState",e.TRACK_METAMETRICS_EVENT="trackUnifiedSwapBridgeEvent",e.STOP_POLLING_FOR_QUOTES="stopPollingForQuotes",e.FETCH_QUOTES="fetchQuotes"}(l||(n.BridgeBackgroundAction=l={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/types.cjs"}],[3146,{"./bridge.cjs":3148,"./caip-formatters.cjs":3149},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toExchangeRates=n.getAssetIdsForToken=void 0;const r=e("./bridge.cjs"),a=e("./caip-formatters.cjs");n.getAssetIdsForToken=(e,t)=>{const n=[],s=(0,a.formatAddressToAssetId)(e,t);return s&&(n.push(s),(0,r.getNativeAssetForChainId)(t)?.assetId&&n.push((0,r.getNativeAssetForChainId)(t).assetId)),n};n.toExchangeRates=(e,t)=>Object.entries(t).reduce((t,[n,r])=>(r&&(t[n]={exchangeRate:r[e],usdExchangeRate:r.usd}),t),{})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/assets.cjs"}],[3147,{"./bridge.cjs":3148,"@ethersproject/address":755,"@ethersproject/contracts":771,"@ethersproject/providers":809,"@metamask/metamask-eth-abis":2370},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasSufficientBalance=n.calcLatestSrcBalance=n.fetchTokenBalance=void 0;const r=e("@ethersproject/address"),a=e("@ethersproject/contracts"),s=e("@ethersproject/providers"),i=e("@metamask/metamask-eth-abis"),o=e("./bridge.cjs");n.fetchTokenBalance=async(e,t,n)=>{const r=new s.Web3Provider(n),o=new a.Contract(e,i.abiERC20,r),c="function"==typeof o?.balanceOf?o.balanceOf(t):Promise.resolve(undefined);return await c};n.calcLatestSrcBalance=async(e,t,a,i)=>{if(a&&i){if((0,o.isNativeAddress)(a)){const n=new s.Web3Provider(e);return await n.getBalance((0,r.getAddress)(t))}return await(0,n.fetchTokenBalance)(a,t,e)}return undefined};n.hasSufficientBalance=async(e,t,r,a,s)=>{const i=await(0,n.calcLatestSrcBalance)(e,t,r,s);return!!i&&i.gte(a)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/balance.cjs"}],[3148,{"../constants/bridge.cjs":3138,"../constants/chains.cjs":3139,"../constants/swaps.cjs":3140,"../constants/tokens.cjs":3141,"../types.cjs":3145,"./caip-formatters.cjs":3149,"@ethersproject/constants":768,"@ethersproject/contracts":771,"@metamask/keyring-api":2300,"@metamask/metamask-eth-abis":2370,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isEvmQuoteResponse=n.isNonEvmChainId=n.isTronChainId=n.isBitcoinChainId=n.isSolanaChainId=n.isNativeAddress=n.isSwapsDefaultTokenSymbol=n.isSwapsDefaultTokenAddress=n.sumHexes=n.isEthUsdt=n.getEthUsdtResetData=n.getNativeAssetForChainId=n.getDefaultBridgeControllerState=n.isCrossChain=void 0;const r=e("@ethersproject/constants"),a=e("@ethersproject/contracts"),s=e("@metamask/keyring-api"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=e("./caip-formatters.cjs"),l=e("../constants/bridge.cjs"),u=e("../constants/chains.cjs"),d=e("../constants/swaps.cjs"),h=e("../constants/tokens.cjs"),f=e("../types.cjs");n.isCrossChain=(e,t)=>{try{return!!t&&(0,c.formatChainIdToCaip)(e)!==(0,c.formatChainIdToCaip)(t)}catch{return!1}};n.getDefaultBridgeControllerState=()=>l.DEFAULT_BRIDGE_CONTROLLER_STATE;const m=(e,t)=>`${(0,c.formatChainIdToCaip)(e)}/${h.SYMBOL_TO_SLIP44_MAP[t]}`;n.getNativeAssetForChainId=e=>{const t=(0,c.formatChainIdToCaip)(e),n=h.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[(0,c.formatChainIdToCaip)(e)]??h.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[(0,c.formatChainIdToHex)(e)];if(!n)throw new Error(`No XChain Swaps native asset found for chainId: ${e}`);return{...n,chainId:(0,c.formatChainIdToDec)(e),assetId:m(t,n.symbol)}};n.getEthUsdtResetData=e=>{const t=(0,n.isCrossChain)(u.CHAIN_IDS.MAINNET,e)?l.METABRIDGE_ETHEREUM_ADDRESS:d.SWAPS_CONTRACT_ADDRESSES[u.CHAIN_IDS.MAINNET];return new a.Contract(l.ETH_USDT_ADDRESS,i.abiERC20).interface.encodeFunctionData("approve",[t,"0"])};n.isEthUsdt=(e,t)=>(0,c.formatChainIdToDec)(e)===f.ChainId.ETH&&t.toLowerCase()===l.ETH_USDT_ADDRESS.toLowerCase();n.sumHexes=(...e)=>{if(0===e.length)return"0x0";return`0x${e.reduce((e,t)=>e+BigInt(t),BigInt(0)).toString(16)}`};n.isSwapsDefaultTokenAddress=(e,t)=>!(!e||!t)&&e===(0,n.getNativeAssetForChainId)(t)?.address;n.isSwapsDefaultTokenSymbol=(e,t)=>!(!e||!t)&&e===(0,n.getNativeAssetForChainId)(t)?.symbol;n.isNativeAddress=e=>e===r.AddressZero||""===e||!e||!(0,o.isStrictHexString)(e)&&Object.values(h.SYMBOL_TO_SLIP44_MAP).some(t=>e.includes(t)||t.endsWith(e));n.isSolanaChainId=e=>(0,o.isCaipChainId)(e)?e===s.SolScope.Mainnet.toString():e.toString()===f.ChainId.SOLANA.toString();n.isBitcoinChainId=e=>(0,o.isCaipChainId)(e)?e===s.BtcScope.Mainnet.toString():e.toString()===f.ChainId.BTC.toString();n.isTronChainId=e=>(0,o.isCaipChainId)(e)?e===s.TrxScope.Mainnet.toString():e.toString()===f.ChainId.TRON.toString();n.isNonEvmChainId=e=>(0,n.isSolanaChainId)(e)||(0,n.isBitcoinChainId)(e)||(0,n.isTronChainId)(e);n.isEvmQuoteResponse=e=>!(0,n.isNonEvmChainId)(e.quote.srcChainId)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/bridge.cjs"}],[3149,{"../types.cjs":3145,"./bridge.cjs":3148,"@ethersproject/address":755,"@ethersproject/constants":768,"@metamask/controller-utils":1488,"@metamask/keyring-api":2300,"@metamask/multichain-network-controller":3166,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.formatAddressToAssetId=n.formatAddressToCaipReference=n.formatChainIdToHex=n.formatChainIdToDec=n.formatChainIdToCaip=void 0;const r=e("@ethersproject/address"),a=e("@ethersproject/constants"),s=e("@metamask/controller-utils"),i=e("@metamask/keyring-api"),o=e("@metamask/multichain-network-controller"),c=e("@metamask/utils"),l=e("./bridge.cjs"),u=e("../types.cjs");n.formatChainIdToCaip=e=>(0,c.isCaipChainId)(e)?e:(0,c.isStrictHexString)(e)?(0,o.toEvmCaipChainId)(e):(0,l.isSolanaChainId)(e)?i.SolScope.Mainnet:(0,l.isBitcoinChainId)(e)?i.BtcScope.Mainnet:(0,l.isTronChainId)(e)?i.TrxScope.Mainnet:(0,o.toEvmCaipChainId)((0,c.numberToHex)(Number(e)));n.formatChainIdToDec=e=>(0,c.isStrictHexString)(e)?(0,s.convertHexToDecimal)(e):e===i.SolScope.Mainnet?u.ChainId.SOLANA:e===i.BtcScope.Mainnet?u.ChainId.BTC:e===i.TrxScope.Mainnet?u.ChainId.TRON:(0,c.isCaipChainId)(e)?Number(e.split(":").at(-1)):"string"==typeof e?parseInt(e,10):e;n.formatChainIdToHex=e=>{if((0,c.isStrictHexString)(e))return e;if("number"==typeof e||parseInt(e,10))return(0,c.numberToHex)(Number(e));if((0,c.isCaipChainId)(e)){const{reference:t}=(0,c.parseCaipChainId)(e);if((0,c.isCaipReference)(t)&&!isNaN(Number(t)))return(0,c.numberToHex)(Number(t))}throw new Error(`Invalid cross-chain swaps chainId: ${e}`)};n.formatAddressToCaipReference=e=>{if((0,c.isStrictHexString)(e))return(0,r.getAddress)(e);if((0,l.isNativeAddress)(e))return a.AddressZero;const t=e.split(":").at(-1);if(!t)throw new Error("Invalid address");return t};n.formatAddressToAssetId=(e,t)=>(0,c.isCaipAssetType)(e)?e:(0,l.isNativeAddress)(e)?(0,l.getNativeAssetForChainId)(t).assetId:t===i.SolScope.Mainnet?c.CaipAssetTypeStruct.create(`${t}/token:${e}`):(0,c.isStrictHexString)(e)?c.CaipAssetTypeStruct.create(`${(0,n.formatChainIdToCaip)(t)}/erc20:${e}`):undefined}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/caip-formatters.cjs"}],[3150,{"../constants/bridge.cjs":3138,"./caip-formatters.cjs":3149,"./validators.cjs":3161},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasMinimumRequiredVersion=n.getBridgeFeatureFlags=n.processFeatureFlags=n.formatFeatureFlags=void 0;const r=e("./caip-formatters.cjs"),a=e("./validators.cjs"),s=e("../constants/bridge.cjs");n.formatFeatureFlags=e=>{return{...e,chains:(t=e.chains,Object.entries(t).reduce((e,[t,n])=>({...e,[(0,r.formatChainIdToCaip)(t)]:n}),{}))};var t};n.processFeatureFlags=e=>(0,a.validateFeatureFlagsResponse)(e)?(0,n.formatFeatureFlags)(e):s.DEFAULT_FEATURE_FLAG_CONFIG,n.getBridgeFeatureFlags=function(e){const t=e.call("RemoteFeatureFlagController:getState"),r=t?.remoteFeatureFlags?.bridgeConfigV2,a=t?.remoteFeatureFlags?.bridgeConfig;return(0,n.processFeatureFlags)(r||a)};n.hasMinimumRequiredVersion=(e,t)=>{const[n,r,a]=e.split(".").map(Number),[s,i,o]=t.split(".").map(Number);return n>s||(n===s&&r>i||n===s&&r===i&&a>=o)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/feature-flags.cjs"}],[3151,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchServerEvents=void 0;n.fetchServerEvents=async(e,{onMessage:t,onError:n,onClose:r,fetchFn:a,...s})=>{let i;try{const n=await a(e,s);if(!n.ok||!n.body)throw new Error(`${n.status}`);i=n.body.getReader();const o=new TextDecoder("utf-8");let c="";for(;;){const{done:e,value:n}=await i.read();if(e)break;c+=o.decode(n,{stream:!0});const r=c.split("\n\n");c=r.pop()||"";for(const e of r){const n=e.split("\n");let r;const a=[];for(const e of n)e.startsWith("event:")?r=e.slice(6).trim():e.startsWith("data:")&&a.push(e.slice(5).trim());if("error"===r)throw new Error(`Bridge-api error: ${a.join("\n")}`);if(a.length>0){const e=JSON.parse(a.join("\n"));await t(e,r)}}}await(r?.())}catch(e){n?.(e)}finally{try{await(i?.cancel())}catch(e){console.error("Error cleaning up stream reader",e)}}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/fetch-server-events.cjs"}],[3152,{"./bridge.cjs":3148,"./caip-formatters.cjs":3149,"./fetch-server-events.cjs":3151,"./trade-utils.cjs":3160,"./validators.cjs":3161,"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchBridgeQuoteStream=n.fetchAssetPrices=n.fetchBridgeQuotes=n.fetchBridgeTokens=n.getClientHeaders=void 0;const r=e("@metamask/superstruct"),a=e("./bridge.cjs"),s=e("./caip-formatters.cjs"),i=e("./fetch-server-events.cjs"),o=e("./trade-utils.cjs"),c=e("./validators.cjs");n.getClientHeaders=(e,t)=>({"X-Client-Id":e,...t?{"Client-Version":t}:{}}),n.fetchBridgeTokens=async function(e,t,r,a,i){const o=`${a}/getTokens?chainId=${(0,s.formatChainIdToDec)(e)}`,l=await r(o,{headers:(0,n.getClientHeaders)(t,i)}),u={};return l.forEach(e=>{(0,c.validateSwapsTokenObject)(e)&&(u[e.address]=e)}),u};const l=e=>{const t=e.destWalletAddress??e.walletAddress,n={walletAddress:(0,s.formatAddressToCaipReference)(e.walletAddress),destWalletAddress:(0,s.formatAddressToCaipReference)(t),srcChainId:(0,s.formatChainIdToDec)(e.srcChainId),destChainId:(0,s.formatChainIdToDec)(e.destChainId),srcTokenAddress:(0,s.formatAddressToCaipReference)(e.srcTokenAddress),destTokenAddress:(0,s.formatAddressToCaipReference)(e.destTokenAddress),srcTokenAmount:e.srcTokenAmount,insufficientBal:Boolean(e.insufficientBal),resetApproval:Boolean(e.resetApproval),gasIncluded:Boolean(e.gasIncluded),gasIncluded7702:Boolean(e.gasIncluded7702)};e.slippage!==undefined&&(n.slippage=e.slippage),e.fee!==undefined&&(n.fee=e.fee),e.aggIds&&e.aggIds.length>0&&(n.aggIds=e.aggIds),e.bridgeIds&&e.bridgeIds.length>0&&(n.bridgeIds=e.bridgeIds);const r=new URLSearchParams;return Object.entries(n).forEach(([e,t])=>{r.append(e,t.toString())}),r};n.fetchBridgeQuotes=async function(e,t,s,i,u,d,h){const f=`${u}/getQuote?${l(e)}`,m=await i(f,{headers:(0,n.getClientHeaders)(s,h),signal:t}),p=new Set([]),g=m.filter(e=>{try{return(0,c.validateQuoteResponse)(e)}catch(t){return t instanceof r.StructError&&t.failures().forEach(({branch:t,path:n})=>{const r=t?.[0]?.quote?.bridgeId||t?.[0]?.quote?.bridges?.[0]||e?.quote?.bridgeId||e?.quote?.bridges?.[0]||"unknown",a=n?.join(".")||"unknown";p.add([r,a].join("|"))}),!1}}).map(t=>({...t,featureId:d??undefined,resetApproval:e.resetApproval&&t.approval&&(0,o.isEvmTxData)(t.approval)?{...t.approval,data:(0,a.getEthUsdtResetData)(e.destChainId)}:undefined})),w=Array.from(p);return p.size>0&&console.warn("Quote validation failed",w),{quotes:g,validationFailures:w}};n.fetchAssetPrices=async e=>{const{currencies:t,...r}=e,a=await Promise.allSettled(Array.from(t).map(async e=>await(async e=>{const{currency:t,assetIds:r,clientId:a,clientVersion:s,fetchFn:i,signal:o}=e,c=Array.from(r).filter(Boolean);if(0===c.length)return{};const l=`https://price.api.cx.metamask.io/v3/spot-prices?${new URLSearchParams({assetIds:c.filter(Boolean).join(","),vsCurrency:t})}`,u=await i(l,{headers:(0,n.getClientHeaders)(a,s),signal:o});return u&&"object"==typeof u?Object.entries(u).reduce((e,[n,r])=>r?(e[n]||(e[n]={}),r[t]&&(e[n][t]=r[t].toString()),e):e,{}):{}})({...r,currency:e}))).then(e=>e.reduce((e,t)=>("fulfilled"===t.status&&Object.entries(t.value).forEach(([t,n])=>{e[t]||(e[t]={}),Object.entries(n).forEach(([n,r])=>{e[t][n]=r})}),e),{}));return a},n.fetchBridgeQuoteStream=async function(e,t,s,u,d,h,f){const m=`${d}/getQuoteStream?${l(t)}`;await(0,i.fetchServerEvents)(m,{headers:{...(0,n.getClientHeaders)(u,f),"Content-Type":"text/event-stream"},signal:s,onMessage:async e=>{const n=new Set([]);try{if((0,c.validateQuoteResponse)(e))return await h.onValidQuoteReceived({...e,resetApproval:t.resetApproval&&e.approval&&(0,o.isEvmTxData)(e.approval)?{...e.approval,data:(0,a.getEthUsdtResetData)(t.destChainId)}:undefined})}catch(t){t instanceof r.StructError&&t.failures().forEach(({branch:t,path:r})=>{const a=t?.[0]?.quote?.bridgeId||t?.[0]?.quote?.bridges?.[0]||e?.quote?.bridgeId||e?.quote?.bridges?.[0]||"unknown",s=r?.join(".")||"unknown";n.add([a,s].join("|"))});const a=Array.from(n);if(n.size>0)return console.warn("Quote validation failed",a),h.onValidationFailure(a);throw t}return undefined},onError:e=>{throw e},onClose:async()=>{await h.onClose()},fetchFn:e})}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/fetch.cjs"}],[3153,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o;Object.defineProperty(n,"__esModule",{value:!0}),n.MetricsSwapType=n.MetricsActionType=n.MetaMetricsSwapsEventSource=n.AbortReason=n.UnifiedSwapBridgeEventName=n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY=void 0,n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY="Unified SwapBridge",function(e){e.ButtonClicked="Unified SwapBridge Button Clicked",e.PageViewed="Unified SwapBridge Page Viewed",e.InputChanged="Unified SwapBridge Input Changed",e.InputSourceDestinationSwitched="Unified SwapBridge Source Destination Switched",e.QuotesRequested="Unified SwapBridge Quotes Requested",e.QuotesReceived="Unified SwapBridge Quotes Received",e.QuotesError="Unified SwapBridge Quotes Error",e.Submitted="Unified SwapBridge Submitted",e.Completed="Unified SwapBridge Completed",e.Failed="Unified SwapBridge Failed",e.AllQuotesOpened="Unified SwapBridge All Quotes Opened",e.AllQuotesSorted="Unified SwapBridge All Quotes Sorted",e.QuoteSelected="Unified SwapBridge Quote Selected",e.AssetDetailTooltipClicked="Unified SwapBridge Asset Detail Tooltip Clicked",e.QuotesValidationFailed="Unified SwapBridge Quotes Failed Validation",e.StatusValidationFailed="Unified SwapBridge Status Failed Validation"}(r||(n.UnifiedSwapBridgeEventName=r={})),function(e){e.NewQuoteRequest="New Quote Request",e.QuoteRequestUpdated="Quote Request Updated",e.ResetState="Reset controller state",e.TransactionSubmitted="Transaction submitted"}(a||(n.AbortReason=a={})),function(e){e.MainView="Main View",e.TokenView="Token View"}(s||(n.MetaMetricsSwapsEventSource=s={})),function(e){e.CROSSCHAIN_V1="crosschain-v1",e.SWAPBRIDGE_V1="swapbridge-v1"}(i||(n.MetricsActionType=i={})),function(e){e.SINGLE="single_chain",e.CROSSCHAIN="crosschain"}(o||(n.MetricsSwapType=o={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/metrics/constants.cjs"}],[3154,{"../../constants/bridge.cjs":3138,"../../types.cjs":3145,"../bridge.cjs":3148,"../caip-formatters.cjs":3149,"./constants.cjs":3153},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesReceivedProperties=n.isCustomSlippage=n.isHardwareWallet=n.getRequestParams=n.formatProviderLabel=n.getSwapTypeFromQuote=n.getSwapType=n.toInputChangedPropertyValue=n.toInputChangedPropertyKey=void 0;const r=e("./constants.cjs"),a=e("../../constants/bridge.cjs"),s=e("../../types.cjs"),i=e("../bridge.cjs"),o=e("../caip-formatters.cjs");n.toInputChangedPropertyKey={srcTokenAddress:"token_source",destTokenAddress:"token_destination",srcChainId:"chain_source",destChainId:"chain_destination",slippage:"slippage"},n.toInputChangedPropertyValue={srcTokenAddress:({srcTokenAddress:e,srcChainId:t})=>t?(0,o.formatAddressToAssetId)(e??"",t):undefined,destTokenAddress:({destTokenAddress:e,destChainId:t})=>t?(0,o.formatAddressToAssetId)(e??"",t):undefined,srcChainId:({srcChainId:e})=>e?(0,o.formatChainIdToCaip)(e):undefined,destChainId:({destChainId:e})=>e?(0,o.formatChainIdToCaip)(e):undefined,slippage:({slippage:e})=>e?Number(e):e};n.getSwapType=(e,t)=>e&&!(0,i.isCrossChain)(e,t??e)?r.MetricsSwapType.SINGLE:r.MetricsSwapType.CROSSCHAIN;n.getSwapTypeFromQuote=e=>(0,n.getSwapType)(e.srcChainId,e.destChainId);n.formatProviderLabel=({bridgeId:e,bridges:t})=>`${e}_${t[0]}`;n.getRequestParams=({srcChainId:e,destChainId:t,srcTokenAddress:n,destTokenAddress:r})=>{const a=(0,o.formatChainIdToCaip)(e??s.ChainId.ETH);return{chain_id_source:a,chain_id_destination:t?(0,o.formatChainIdToCaip)(t):null,token_address_source:n?(0,o.formatAddressToAssetId)(n,a)??(0,i.getNativeAssetForChainId)(a)?.assetId??null:(0,i.getNativeAssetForChainId)(a)?.assetId??null,token_address_destination:r?(0,o.formatAddressToAssetId)(r,t??a)??null:null}};n.isHardwareWallet=e=>e?.metadata?.keyring.type?.includes("Hardware")??!1;n.isCustomSlippage=e=>e!==a.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest.slippage;n.getQuotesReceivedProperties=(e,t=[],r=!0,a,s)=>{const i=e?(0,n.formatProviderLabel)(e.quote):"_";return{can_submit:r,gas_included:Boolean(e?.quote?.gasIncluded),gas_included_7702:Boolean(e?.quote?.gasIncluded7702),quoted_time_minutes:e?.estimatedProcessingTimeInSeconds?e.estimatedProcessingTimeInSeconds/60:0,usd_quoted_gas:Number(e?.gasFee?.effective?.usd??0),usd_quoted_return:Number(e?.toTokenAmount?.usd??0),usd_balance_source:s??0,best_quote_provider:a?(0,n.formatProviderLabel)(a.quote):i,provider:i,warnings:t,price_impact:Number(e?.quote.priceData?.priceImpact??0)}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/metrics/properties.cjs"}],[3155,{"../constants/chains.cjs":3139,"./bridge.cjs":3148,"./caip-formatters.cjs":3149,"./snaps.cjs":3158,"./trade-utils.cjs":3160,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.appendFeesToQuotes=void 0;const r=e("@metamask/utils"),a=e("./bridge.cjs"),s=e("./caip-formatters.cjs"),i=e("./snaps.cjs"),o=e("./trade-utils.cjs"),c=e("../constants/chains.cjs");n.appendFeesToQuotes=async(e,t,n,l)=>{const u=await(async(e,t)=>{if(e.some(({quote:e})=>{const t=(0,s.formatChainIdToCaip)(e.srcChainId);return![c.CHAIN_IDS.OPTIMISM,c.CHAIN_IDS.BASE].map(s.formatChainIdToCaip).includes(t)}))return undefined;const n=Promise.allSettled(e.map(async e=>{const{quote:n,trade:s,approval:i}=e,o=(0,r.numberToHex)(n.srcChainId),c=e=>({from:e.from,to:e.to,value:e.value,data:e.data,gasLimit:e.gasLimit?.toString()}),l=i?await t({transactionParams:c(i),chainId:o}):"0x0",u=await t({transactionParams:c(s),chainId:o});return l===undefined||u===undefined?undefined:{...e,l1GasFeesInHexWei:(0,a.sumHexes)(l,u)}}));return(await n).reduce((e,t)=>("fulfilled"===t.status&&t.value?e.push(t.value):"rejected"===t.status&&console.error("Error calculating L1 gas fees for quote",t.reason),e),[])})(e,n),d=await(async(e,t,n)=>{if(e.some(({quote:{srcChainId:e}})=>!(0,a.isNonEvmChainId)(e)))return undefined;const r=Promise.allSettled(e.map(async e=>{const{trade:r,quote:a}=e;if(!n?.metadata?.snap?.id||!r)return e;try{const c=(0,s.formatChainIdToCaip)(a.srcChainId),l=(0,o.extractTradeData)(r),u=(0,o.isTronTrade)(r)?{visible:r.visible,type:r.raw_data?.contract?.[0]?.type,feeLimit:r.raw_data?.fee_limit}:undefined,d=await t.call("SnapController:handleRequest",(0,i.computeFeeRequest)(n?.metadata?.snap?.id,l,n?.id,c,u)),h=d?.find(e=>"base"===e.type)||d?.find(e=>"priority"===e.type)||d?.[0],f=h?.asset?.amount||"0";return{...e,nonEvmFeesInNative:f}}catch(t){return console.error(`Failed to compute non-EVM fees for quote ${a.requestId}:`,t),{...e,nonEvmFeesInNative:undefined}}}));return(await r).reduce((e,t)=>("fulfilled"===t.status&&t.value&&e.push(t.value),e),[])})(e,t,l);return u??d??e}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/quote-fees.cjs"}],[3156,{"./bridge.cjs":3148,"./validators.cjs":3161,"@metamask/controller-utils":1488,"bignumber.js":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sortQuotes=n.formatEtaInMinutes=n.calcSlippagePercentage=n.calcCost=n.calcSwapRate=n.calcAdjustedReturn=n.calcIncludedTxFees=n.calcTotalMaxNetworkFee=n.calcTotalEstimatedNetworkFee=n.calcEstimatedAndMaxTotalGasFee=n.calcRelayerFee=n.calcSentAmount=n.calcToAmount=n.calcNonEvmTotalNetworkFee=n.getQuoteIdentifier=n.isValidQuoteRequest=void 0;const r=e("@metamask/controller-utils"),a=e("bignumber.js"),s=e("./bridge.cjs"),i=e("./validators.cjs");n.isValidQuoteRequest=(e,t=!0)=>{const n=["srcTokenAddress","destTokenAddress","srcChainId","destChainId","walletAddress"];if(t&&n.push("srcTokenAmount"),e.destChainId&&e.srcChainId&&e.destChainId!==e.srcChainId&&((0,s.isNonEvmChainId)(e.destChainId)||(0,s.isNonEvmChainId)(e.srcChainId))&&(n.push("destWalletAddress"),!e.destWalletAddress))return!1;const r=[];return e.slippage!==undefined&&r.push("slippage"),n.every(t=>t in e&&"string"==typeof e[t]&&e[t]!==undefined&&""!==e[t]&&null!==e[t])&&r.every(t=>t in e&&"number"==typeof e[t]&&e[t]!==undefined&&!isNaN(Number(e[t]))&&null!==e[t])&&(!t||Boolean((e.srcTokenAmount??"").match(/^[1-9]\d*$/u)))};n.getQuoteIdentifier=e=>`${e.bridgeId}-${e.bridges[0]}-${e.steps.length}`;const o=(e,t)=>{const n=new a.BigNumber(10).pow(t??0);return new a.BigNumber(e).div(n)};n.calcNonEvmTotalNetworkFee=(e,{exchangeRate:t,usdExchangeRate:n})=>{const{nonEvmFeesInNative:r}=e,s=new a.BigNumber(r??"0");return{amount:s.toString(),valueInCurrency:t?s.times(t).toString():null,usd:n?s.times(n).toString():null}};n.calcToAmount=(e,t,{exchangeRate:n,usdExchangeRate:r})=>{const a=o(e,t.decimals);return{amount:a.toString(),valueInCurrency:n?a.times(n).toString():null,usd:r?a.times(r).toString():null}};n.calcSentAmount=({srcTokenAmount:e,srcAsset:t,feeData:n},{exchangeRate:r,usdExchangeRate:s})=>{const i=Object.values(n).filter(e=>e&&e.amount&&e.asset?.assetId===t.assetId).reduce((e,{amount:t})=>e.plus(t),new a.BigNumber(e)),c=o(i,t.decimals);return{amount:c.toString(),valueInCurrency:r?c.times(r).toString():null,usd:s?c.times(s).toString():null}};n.calcRelayerFee=(e,{exchangeRate:t,usdExchangeRate:i})=>{const{quote:c,trade:l}=e,u=new a.BigNumber((0,r.convertHexToDecimal)(l.value||"0x0"));let d=o(u,18);if((0,s.isNativeAddress)(c.srcAsset.address)){const e=(0,n.calcSentAmount)(c,{exchangeRate:t,usdExchangeRate:i}).amount;d=d.minus(e)}return{amount:d,valueInCurrency:t?d.times(t):null,usd:i?d.times(i):null}};const c=({approvalGasLimit:e,resetApprovalGasLimit:t,tradeGasLimit:n,l1GasFeesInHexWei:s,feePerGasInDecGwei:i,nativeToDisplayCurrencyExchangeRate:o,nativeToUsdExchangeRate:c})=>{const l=new a.BigNumber(n?.toString()??"0").plus(e?.toString()??"0").plus(t?.toString()??"0"),u=(0,r.weiHexToGweiDec)((0,r.toHex)(s??"0")),d=l.times(i).plus(u).times(new a.BigNumber(10).pow(-9)),h=o?d.times(o.toString()):null,f=c?d.times(c.toString()):null;return{amount:d.toString(),valueInCurrency:h?.toString()??null,usd:f?.toString()??null}};n.calcEstimatedAndMaxTotalGasFee=({bridgeQuote:{approval:e,trade:t,l1GasFeesInHexWei:n,resetApproval:r},feePerGasInDecGwei:a,maxFeePerGasInDecGwei:s,exchangeRate:i,usdExchangeRate:o})=>{const{amount:l,valueInCurrency:u,usd:d}=c({approvalGasLimit:e?.effectiveGas??e?.gasLimit,resetApprovalGasLimit:r?.effectiveGas??r?.gasLimit,tradeGasLimit:t?.effectiveGas??t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:a,nativeToDisplayCurrencyExchangeRate:i,nativeToUsdExchangeRate:o}),{amount:h,valueInCurrency:f,usd:m}=c({approvalGasLimit:e?.gasLimit,resetApprovalGasLimit:r?.gasLimit,tradeGasLimit:t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:a,nativeToDisplayCurrencyExchangeRate:i,nativeToUsdExchangeRate:o}),{amount:p,valueInCurrency:g,usd:w}=c({approvalGasLimit:e?.gasLimit,resetApprovalGasLimit:r?.gasLimit,tradeGasLimit:t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:s,nativeToDisplayCurrencyExchangeRate:i,nativeToUsdExchangeRate:o});return{effective:{amount:l,valueInCurrency:u,usd:d},total:{amount:h,valueInCurrency:f,usd:m},max:{amount:p,valueInCurrency:g,usd:w}}};n.calcTotalEstimatedNetworkFee=({total:e},t)=>({amount:new a.BigNumber(e?.amount??"0").plus(t.amount).toString(),valueInCurrency:e?.valueInCurrency?new a.BigNumber(e.valueInCurrency).plus(t.valueInCurrency||"0").toString():null,usd:e?.usd?new a.BigNumber(e.usd).plus(t.usd||"0").toString():null});n.calcTotalMaxNetworkFee=(e,t)=>({amount:new a.BigNumber(e.max.amount).plus(t.amount).toString(),valueInCurrency:e.max.valueInCurrency?new a.BigNumber(e.max.valueInCurrency).plus(t.valueInCurrency||"0").toString():null,usd:e.max.usd?new a.BigNumber(e.max.usd).plus(t.usd||"0").toString():null});n.calcIncludedTxFees=({gasIncluded:e,gasIncluded7702:t,srcAsset:n,feeData:{txFee:r}},a,s)=>{if(!r||!e&&!t)return null;const{exchangeRate:i,usdExchangeRate:c}=r.asset.assetId===n.assetId?a:s,l=o(r.amount,r.asset.decimals);return{amount:l.toString(),valueInCurrency:i?l.times(i).toString():null,usd:c?l.times(c).toString():null}};n.calcAdjustedReturn=(e,t,{feeData:{txFee:n},destAsset:{assetId:r}})=>n?.asset?.assetId===r?{valueInCurrency:e.valueInCurrency,usd:e.usd}:{valueInCurrency:e.valueInCurrency&&t.valueInCurrency?new a.BigNumber(e.valueInCurrency).minus(t.valueInCurrency).toString():null,usd:e.usd&&t.usd?new a.BigNumber(e.usd).minus(t.usd).toString():null};n.calcSwapRate=(e,t)=>new a.BigNumber(t).div(e).toString();n.calcCost=(e,t)=>({valueInCurrency:e.valueInCurrency&&t.valueInCurrency?new a.BigNumber(t.valueInCurrency).minus(e.valueInCurrency).toString():null,usd:e.usd&&t.usd?new a.BigNumber(t.usd).minus(e.usd).toString():null});n.calcSlippagePercentage=(e,t)=>{const r=(0,n.calcCost)(e,t);return r.valueInCurrency&&t.valueInCurrency?new a.BigNumber(r.valueInCurrency).div(t.valueInCurrency).times(100).abs().toString():r.usd&&t.usd?new a.BigNumber(r.usd).div(t.usd).times(100).abs().toString():null};n.formatEtaInMinutes=e=>e<60?"< 1":(e/60).toFixed();n.sortQuotes=(e,t)=>t===i.FeatureId.PERPS?e.sort((e,t)=>e.estimatedProcessingTimeInSeconds-t.estimatedProcessingTimeInSeconds):e}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/quote.cjs"}],[3157,{"./bridge.cjs":3148},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultSlippagePercentage=n.BRIDGE_DEFAULT_SLIPPAGE=void 0;const r=e("./bridge.cjs");n.BRIDGE_DEFAULT_SLIPPAGE=.5;const a=undefined;n.getDefaultSlippagePercentage=({srcTokenAddress:e,destTokenAddress:t,srcChainId:s,destChainId:i},o,c)=>!s||(0,r.isCrossChain)(s,i)?n.BRIDGE_DEFAULT_SLIPPAGE:(0,r.isSolanaChainId)(s)?a:e&&t&&o?.map(e=>e.toLowerCase()).includes(e.toLowerCase())&&(c??o)?.map(e=>e.toLowerCase()).includes(t.toLowerCase())?.5:2}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/slippage.cjs"}],[3158,{"../constants/bridge.cjs":3138,"@metamask/keyring-api":2300,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.computeFeeRequest=n.getMinimumBalanceForRentExemptionInLamports=n.getMinimumBalanceForRentExemptionRequest=void 0;const r=e("@metamask/keyring-api"),a=e("uuid"),s=e("../constants/bridge.cjs");n.getMinimumBalanceForRentExemptionRequest=e=>({snapId:e,origin:"metamask",handler:"onProtocolRequest",request:{method:" ",jsonrpc:"2.0",params:{scope:r.SolScope.Mainnet,request:{id:(0,a.v4)(),jsonrpc:"2.0",method:"getMinimumBalanceForRentExemption",params:[0,{commitment:"confirmed"}]}}}});n.getMinimumBalanceForRentExemptionInLamports=async(e,t)=>String(await t.call("SnapController:handleRequest",(0,n.getMinimumBalanceForRentExemptionRequest)(e)).catch(e=>(console.error("Error setting minimum balance for rent exemption",e),s.DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports)));n.computeFeeRequest=(e,t,n,r,s)=>({snapId:e,origin:"metamask",handler:"onClientRequest",request:{id:(0,a.v4)(),jsonrpc:"2.0",method:"computeFee",params:{transaction:t,accountId:n,scope:r,...s&&{options:s}}}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/snaps.cjs"}],[3159,{"../constants/chains.cjs":3139,"../constants/swaps.cjs":3140,"../constants/tokens.cjs":3141,"./caip-formatters.cjs":3149},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchTokens=n.DEV_BASE_URL=n.API_BASE_URL=n.getSwapsContractAddress=n.isValidSwapsContractAddress=void 0;const r=e("./caip-formatters.cjs"),a=e("../constants/chains.cjs"),s=e("../constants/swaps.cjs"),i=e("../constants/tokens.cjs");function o(e){return e?{"X-Client-Id":e}:undefined}n.isValidSwapsContractAddress=function(e,t){return!(!t||!s.ALLOWED_CONTRACT_ADDRESSES[e])&&s.ALLOWED_CONTRACT_ADDRESSES[e].some(e=>t.toLowerCase()===e.toLowerCase())},n.getSwapsContractAddress=function(e){return s.SWAPS_CONTRACT_ADDRESSES[e]},n.API_BASE_URL="https://swap.api.cx.metamask.io",n.DEV_BASE_URL="https://swap.dev-api.cx.metamask.io",n.fetchTokens=async function(e,t,s){const[c,l]=e===a.CHAIN_IDS.LOCALHOST?[a.CHAIN_IDS.MAINNET,n.DEV_BASE_URL]:[e,n.API_BASE_URL],u=`${l}/networks/${(0,r.formatChainIdToDec)(c)}/tokens`,d=(await t(u,{headers:o(s)})).filter(e=>e.address!==i.DEFAULT_TOKEN_ADDRESS),h=i.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[e];return d.push(h),d}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/swaps.cjs"}],[3160,{buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.extractTradeData=n.isTronTrade=n.isBitcoinTrade=n.isEvmTxData=void 0;n.isEvmTxData=e=>"object"==typeof e&&null!==e&&"data"in e&&"chainId"in e&&"to"in e;n.isBitcoinTrade=e=>"object"==typeof e&&null!==e&&"unsignedPsbtBase64"in e;n.isTronTrade=e=>"object"==typeof e&&null!==e&&"raw_data_hex"in e;n.extractTradeData=t=>(0,n.isBitcoinTrade)(t)?t.unsignedPsbtBase64:(0,n.isTronTrade)(t)?e.from(t.raw_data_hex,"hex").toString("base64"):"string"==typeof t?t:(0,n.isEvmTxData)(t)?t.data:""}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/trade-utils.cjs"}],[3161,{"@metamask/controller-utils":1488,"@metamask/superstruct":3027,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateQuoteResponse=n.QuoteResponseSchema=n.TronTradeDataSchema=n.BitcoinTradeDataSchema=n.TxDataSchema=n.QuoteSchema=n.IntentSchema=n.IntentOrderSchema=n.StepSchema=n.ProtocolSchema=n.FeeDataSchema=n.validateSwapsTokenObject=n.validateFeatureFlagsResponse=n.PlatformConfigSchema=n.PriceImpactThresholdSchema=n.ChainConfigurationSchema=n.BridgeAssetSchema=n.truthyString=n.ActionTypes=n.FeatureId=n.FeeType=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/superstruct"),s=e("@metamask/utils");var i,o,c;!function(e){e.METABRIDGE="metabridge",e.REFUEL="refuel",e.TX_FEE="txFee"}(i||(n.FeeType=i={})),function(e){e.PERPS="perps"}(o||(n.FeatureId=o={})),function(e){e.BRIDGE="bridge",e.SWAP="swap",e.REFUEL="refuel"}(c||(n.ActionTypes=c={}));const l=(0,a.define)("HexAddress",e=>(0,r.isValidHexAddress)(e,{allowNonPrefixed:!1})),u=(0,a.define)("HexString",e=>(0,s.isStrictHexString)(e)),d=(0,a.define)("VersionString",e=>"string"==typeof e&&/^(\d+\.*){2}\d+$/u.test(e)&&3===e.split(".").length);n.truthyString=e=>Boolean(e?.length);const h=(0,a.pattern)((0,a.string)(),/^\d+$/u),f=(0,a.number)();n.BridgeAssetSchema=(0,a.type)({chainId:f,address:(0,a.string)(),assetId:s.CaipAssetTypeStruct,symbol:(0,a.string)(),name:(0,a.string)(),decimals:(0,a.number)(),icon:(0,a.optional)((0,a.nullable)((0,a.string)())),iconUrl:(0,a.optional)((0,a.nullable)((0,a.string)()))});const m=(0,a.type)({standard:(0,a.record)((0,a.string)(),(0,a.string)()),other:(0,a.record)((0,a.string)(),(0,a.string)())});n.ChainConfigurationSchema=(0,a.type)({isActiveSrc:(0,a.boolean)(),isActiveDest:(0,a.boolean)(),refreshRate:(0,a.optional)((0,a.number)()),topAssets:(0,a.optional)((0,a.array)((0,a.string)())),stablecoins:(0,a.optional)((0,a.array)((0,a.string)())),isUnifiedUIEnabled:(0,a.optional)((0,a.boolean)()),isSingleSwapBridgeButtonEnabled:(0,a.optional)((0,a.boolean)()),isGaslessSwapEnabled:(0,a.optional)((0,a.boolean)()),noFeeAssets:(0,a.optional)((0,a.array)((0,a.string)())),defaultPairs:(0,a.optional)(m)}),n.PriceImpactThresholdSchema=(0,a.type)({gasless:(0,a.number)(),normal:(0,a.number)()});const p=(0,a.type)({aggIds:(0,a.optional)((0,a.array)((0,a.string)())),bridgeIds:(0,a.optional)((0,a.array)((0,a.string)())),fee:(0,a.optional)((0,a.number)())}),g=(0,a.enums)(Object.values(o));n.PlatformConfigSchema=(0,a.type)({priceImpactThreshold:(0,a.optional)(n.PriceImpactThresholdSchema),quoteRequestOverrides:(0,a.optional)((0,a.record)(g,(0,a.optional)(p))),minimumVersion:(0,a.string)(),refreshRate:(0,a.number)(),maxRefreshCount:(0,a.number)(),support:(0,a.boolean)(),chains:(0,a.record)((0,a.string)(),n.ChainConfigurationSchema),bip44DefaultPairs:(0,a.optional)((0,a.record)((0,a.string)(),(0,a.optional)(m))),sse:(0,a.optional)((0,a.type)({enabled:(0,a.boolean)(),minimumVersion:d}))});n.validateFeatureFlagsResponse=e=>(0,a.is)(e,n.PlatformConfigSchema);n.validateSwapsTokenObject=e=>(0,a.is)(e,n.BridgeAssetSchema),n.FeeDataSchema=(0,a.type)({amount:h,asset:n.BridgeAssetSchema}),n.ProtocolSchema=(0,a.type)({name:(0,a.string)(),displayName:(0,a.optional)((0,a.string)()),icon:(0,a.optional)((0,a.string)())}),n.StepSchema=(0,a.type)({action:(0,a.enums)(Object.values(c)),srcChainId:f,destChainId:(0,a.optional)(f),srcAsset:n.BridgeAssetSchema,destAsset:n.BridgeAssetSchema,srcAmount:(0,a.string)(),destAmount:(0,a.string)(),protocol:n.ProtocolSchema});const w=n.StepSchema,b=(0,a.union)([h,(0,a.number)()]),T=(0,a.string)();n.IntentOrderSchema=(0,a.type)({sellToken:l,buyToken:l,receiver:(0,a.optional)(l),validTo:b,appData:(0,a.string)(),appDataHash:u,feeAmount:h,kind:(0,a.enums)(["sell","buy"]),partiallyFillable:(0,a.boolean)(),sellAmount:(0,a.optional)(h),buyAmount:(0,a.optional)(h),from:(0,a.optional)(l)}),n.IntentSchema=(0,a.type)({protocol:T,order:n.IntentOrderSchema,settlementContract:(0,a.optional)(l),relayer:(0,a.optional)(l)}),n.QuoteSchema=(0,a.type)({requestId:(0,a.string)(),srcChainId:f,srcAsset:n.BridgeAssetSchema,srcTokenAmount:(0,a.string)(),destChainId:f,destAsset:n.BridgeAssetSchema,destTokenAmount:(0,a.string)(),minDestTokenAmount:(0,a.string)(),feeData:(0,a.type)({[i.METABRIDGE]:n.FeeDataSchema,[i.TX_FEE]:(0,a.optional)((0,a.intersection)([n.FeeDataSchema,(0,a.type)({maxFeePerGas:(0,a.string)(),maxPriorityFeePerGas:(0,a.string)()})]))}),gasIncluded:(0,a.optional)((0,a.boolean)()),gasIncluded7702:(0,a.optional)((0,a.boolean)()),bridgeId:(0,a.string)(),bridges:(0,a.array)((0,a.string)()),steps:(0,a.array)(n.StepSchema),refuel:(0,a.optional)(w),priceData:(0,a.optional)((0,a.type)({totalFromAmountUsd:(0,a.optional)((0,a.string)()),totalToAmountUsd:(0,a.optional)((0,a.string)()),priceImpact:(0,a.optional)((0,a.string)()),totalFeeAmountUsd:(0,a.optional)((0,a.string)())})),intent:(0,a.optional)(n.IntentSchema),gasSponsored:(0,a.optional)((0,a.boolean)())}),n.TxDataSchema=(0,a.type)({chainId:(0,a.number)(),to:l,from:l,value:u,data:u,gasLimit:(0,a.nullable)((0,a.number)()),effectiveGas:(0,a.optional)((0,a.number)())}),n.BitcoinTradeDataSchema=(0,a.type)({unsignedPsbtBase64:(0,a.string)(),inputsToSign:(0,a.nullable)((0,a.array)((0,a.type)({})))}),n.TronTradeDataSchema=(0,a.type)({raw_data_hex:(0,a.string)(),visible:(0,a.optional)((0,a.boolean)()),raw_data:(0,a.optional)((0,a.nullable)((0,a.type)({contract:(0,a.optional)((0,a.array)((0,a.type)({type:(0,a.optional)((0,a.string)())}))),fee_limit:(0,a.optional)((0,a.number)())})))}),n.QuoteResponseSchema=(0,a.type)({quote:n.QuoteSchema,estimatedProcessingTimeInSeconds:(0,a.number)(),approval:(0,a.optional)((0,a.union)([n.TxDataSchema,n.TronTradeDataSchema])),trade:(0,a.union)([n.TxDataSchema,n.BitcoinTradeDataSchema,n.TronTradeDataSchema,(0,a.string)()])});n.validateQuoteResponse=e=>((0,a.assert)(e,n.QuoteResponseSchema),!0)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/validators.cjs"}],[3162,{"../api/accounts-api.cjs":3164,"../constants.cjs":3165,"../types.cjs":3167,"../utils.cjs":3168,"@metamask/base-controller":1401,"@metamask/keyring-api":2300,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkController=void 0;const m=e("@metamask/base-controller"),p=e("@metamask/keyring-api"),g=e("@metamask/utils"),w=e("../api/accounts-api.cjs"),b=e("../constants.cjs"),T=e("../types.cjs"),E=e("../utils.cjs");class y extends m.BaseController{constructor({messenger:e,state:t,networkService:n}){super({messenger:e,name:T.MULTICHAIN_NETWORK_CONTROLLER_NAME,metadata:b.MULTICHAIN_NETWORK_CONTROLLER_METADATA,state:{...(0,b.getDefaultMultichainNetworkControllerState)(),...t,multichainNetworkConfigurationsByChainId:b.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS}}),r.add(this),a.set(this,void 0),h(this,a,n,"f"),f(this,r,"m",u).call(this),f(this,r,"m",d).call(this)}async setActiveNetwork(e){if((0,g.isCaipChainId)(e)){if(!(0,E.checkIfSupportedCaipChainId)(e))throw new Error(`Unsupported Caip chain ID: ${String(e)}`);return f(this,r,"m",i).call(this,e)}return await f(this,r,"m",s).call(this,e)}async getNetworksWithTransactionActivityByAccounts(){const e=this.messenger.call("AccountsController:listMultichainAccounts").filter(e=>(0,p.isEvmAccountType)(e.type));if(!e||0===e.length)return this.state.networksWithTransactionActivity;const t=e.map(e=>(0,w.toAllowedCaipAccountIds)(e)).flat(),n=await f(this,a,"f").fetchNetworkActivity(t),r=(0,w.toActiveNetworksByAddress)(n);return this.update(e=>{e.networksWithTransactionActivity=r}),this.state.networksWithTransactionActivity}async removeNetwork(e){return(0,E.isEvmCaipChainId)(e)?await f(this,r,"m",o).call(this,e):f(this,r,"m",c).call(this,e)}}n.MultichainNetworkController=y,a=new WeakMap,r=new WeakSet,s=async function(e){const{selectedNetworkClientId:t}=this.messenger.call("NetworkController:getState"),n=!this.state.isEvmSelected,r=e!==t;(n||r)&&(n&&this.update(e=>{e.isEvmSelected=!0}),r&&await this.messenger.call("NetworkController:setActiveNetwork",e),(n||r)&&this.messenger.publish("MultichainNetworkController:networkDidChange",e))},i=function(e){(e!==this.state.selectedMultichainNetworkChainId||this.state.isEvmSelected)&&(this.update(t=>{t.selectedMultichainNetworkChainId=e,t.isEvmSelected=!1}),this.messenger.publish("MultichainNetworkController:networkDidChange",e))},o=async function(e){const t=(0,E.convertEvmCaipToHexChainId)(e);if(this.messenger.call("NetworkController:getSelectedChainId")===t){if(this.state.isEvmSelected)throw new Error("Cannot remove the currently selected network");const e="0x1",t=this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);await this.messenger.call("NetworkController:setActiveNetwork",t)}this.messenger.call("NetworkController:removeNetwork",t)},c=function(e){throw new Error("Removal of non-EVM networks is not supported")},l=function(e){const{type:t,scopes:n}=e;if((0,p.isEvmAccountType)(t)){if(this.state.isEvmSelected)return;return void this.update(e=>{e.isEvmSelected=!0})}if(n.includes(this.state.selectedMultichainNetworkChainId))return void this.update(e=>{e.isEvmSelected=!1});const r=(0,E.getChainIdForNonEvm)(n);this.update(e=>{e.selectedMultichainNetworkChainId=r,e.isEvmSelected=!1})},u=function(){this.messenger.subscribe("AccountsController:selectedAccountChange",e=>f(this,r,"m",l).call(this,e))},d=function(){this.messenger.registerActionHandler("MultichainNetworkController:setActiveNetwork",this.setActiveNetwork.bind(this)),this.messenger.registerActionHandler("MultichainNetworkController:getNetworksWithTransactionActivityByAccounts",this.getNetworksWithTransactionActivityByAccounts.bind(this))}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/MultichainNetworkController/MultichainNetworkController.cjs"}],[3163,{"../api/accounts-api.cjs":3164,"@metamask/superstruct":3027,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkService=void 0;const l=e("@metamask/superstruct"),u=e("lodash"),d=e("../api/accounts-api.cjs");n.MultichainNetworkService=class{constructor({fetch:e,batchSize:t}){r.add(this),a.set(this,void 0),s.set(this,void 0),o(this,a,e,"f"),o(this,s,t??20,"f")}async fetchNetworkActivity(e){if(0===e.length)return{activeNetworks:[]};if(e.length<=c(this,s,"f"))return c(this,r,"m",i).call(this,e);const t=(0,u.chunk)(e,c(this,s,"f"));return{activeNetworks:(await Promise.all(t.map(e=>c(this,r,"m",i).call(this,e)))).flatMap(e=>e.activeNetworks)}}},a=new WeakMap,s=new WeakMap,r=new WeakSet,i=async function(e){try{const t=(0,d.buildActiveNetworksUrl)(e),n=await c(this,a,"f").call(this,t.toString(),{method:"GET",headers:{[d.MULTICHAIN_ACCOUNTS_CLIENT_HEADER]:d.MULTICHAIN_ACCOUNTS_CLIENT_ID,Accept:"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();return(0,l.assert)(r,d.ActiveNetworksResponseStruct),r}catch(e){if(e instanceof Error){if("AbortError"===e.name)throw new Error("Request timeout: Failed to fetch active networks");throw e}throw new Error(`Failed to fetch active networks: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/MultichainNetworkService/MultichainNetworkService.cjs"}],[3164,{"@metamask/keyring-api":2300,"@metamask/superstruct":3027,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.buildActiveNetworksUrl=n.toActiveNetworksByAddress=n.toAllowedCaipAccountIds=n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES=n.MULTICHAIN_ACCOUNTS_CLIENT_ID=n.MULTICHAIN_ACCOUNTS_CLIENT_HEADER=n.MULTICHAIN_ACCOUNTS_BASE_URL=n.ActiveNetworksResponseStruct=void 0;const r=e("@metamask/keyring-api"),a=e("@metamask/superstruct"),s=e("@metamask/utils");n.ActiveNetworksResponseStruct=(0,a.object)({activeNetworks:(0,a.array)(s.CaipAccountIdStruct)}),n.MULTICHAIN_ACCOUNTS_BASE_URL="https://accounts.api.cx.metamask.io",n.MULTICHAIN_ACCOUNTS_CLIENT_HEADER="x-metamask-clientproduct",n.MULTICHAIN_ACCOUNTS_CLIENT_ID="metamask-multichain-network-controller",n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES=[String(r.BtcScope.Mainnet),String(r.BtcScope.Testnet),String(r.BtcScope.Testnet4),String(r.BtcScope.Signet),String(r.BtcScope.Regtest),String(r.SolScope.Mainnet),String(r.SolScope.Devnet),String(r.EthScope.Mainnet),String(r.EthScope.Testnet),String(r.EthScope.Eoa),String(r.TrxScope.Mainnet),String(r.TrxScope.Nile),String(r.TrxScope.Shasta)],n.toAllowedCaipAccountIds=function(e){const t=[];for(const r of e.scopes)n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES.includes(r)&&t.push(`${r}:${e.address}`);return t},n.toActiveNetworksByAddress=function(e){const t={};return e.activeNetworks.forEach(e=>{const{address:n,chain:{namespace:r,reference:a}}=(0,s.parseCaipAccountId)(e);t[n]||(t[n]={namespace:r,activeChains:[]}),t[n].activeChains.push(a)}),t},n.buildActiveNetworksUrl=function(e){const t=new URL(`${n.MULTICHAIN_ACCOUNTS_BASE_URL}/v2/activeNetworks`);return t.searchParams.append("accountIds",e.join(",")),t}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/api/accounts-api.cjs"}],[3165,{"@metamask/keyring-api":2300,"@metamask/network-controller":3173},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MULTICHAIN_NETWORK_DECIMAL_PLACES=n.MULTICHAIN_NETWORK_TICKER=n.MULTICHAIN_NETWORK_CONTROLLER_METADATA=n.getDefaultMultichainNetworkControllerState=n.NETWORKS_METADATA=n.NON_EVM_TESTNET_IDS=n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS=n.TRX_SHASTA_NATIVE_ASSET=n.TRX_NILE_NATIVE_ASSET=n.TRX_NATIVE_ASSET=n.SOL_DEVNET_NATIVE_ASSET=n.SOL_TESTNET_NATIVE_ASSET=n.SOL_NATIVE_ASSET=n.BTC_REGTEST_NATIVE_ASSET=n.BTC_SIGNET_NATIVE_ASSET=n.BTC_TESTNET4_NATIVE_ASSET=n.BTC_TESTNET_NATIVE_ASSET=n.BTC_NATIVE_ASSET=void 0;const r=e("@metamask/keyring-api"),a=e("@metamask/network-controller");n.BTC_NATIVE_ASSET=`${r.BtcScope.Mainnet}/slip44:0`,n.BTC_TESTNET_NATIVE_ASSET=`${r.BtcScope.Testnet}/slip44:0`,n.BTC_TESTNET4_NATIVE_ASSET=`${r.BtcScope.Testnet4}/slip44:0`,n.BTC_SIGNET_NATIVE_ASSET=`${r.BtcScope.Signet}/slip44:0`,n.BTC_REGTEST_NATIVE_ASSET=`${r.BtcScope.Regtest}/slip44:0`,n.SOL_NATIVE_ASSET=`${r.SolScope.Mainnet}/slip44:501`,n.SOL_TESTNET_NATIVE_ASSET=`${r.SolScope.Testnet}/slip44:501`,n.SOL_DEVNET_NATIVE_ASSET=`${r.SolScope.Devnet}/slip44:501`,n.TRX_NATIVE_ASSET=`${r.TrxScope.Mainnet}/slip44:195`,n.TRX_NILE_NATIVE_ASSET=`${r.TrxScope.Nile}/slip44:195`,n.TRX_SHASTA_NATIVE_ASSET=`${r.TrxScope.Shasta}/slip44:195`,n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS={[r.BtcScope.Mainnet]:{chainId:r.BtcScope.Mainnet,name:"Bitcoin",nativeCurrency:n.BTC_NATIVE_ASSET,isEvm:!1},[r.BtcScope.Testnet]:{chainId:r.BtcScope.Testnet,name:"Bitcoin Testnet",nativeCurrency:n.BTC_TESTNET_NATIVE_ASSET,isEvm:!1},[r.BtcScope.Testnet4]:{chainId:r.BtcScope.Testnet4,name:"Bitcoin Testnet4",nativeCurrency:n.BTC_TESTNET4_NATIVE_ASSET,isEvm:!1},[r.BtcScope.Signet]:{chainId:r.BtcScope.Signet,name:"Bitcoin Mutinynet",nativeCurrency:n.BTC_SIGNET_NATIVE_ASSET,isEvm:!1},[r.BtcScope.Regtest]:{chainId:r.BtcScope.Regtest,name:"Bitcoin Regtest",nativeCurrency:n.BTC_REGTEST_NATIVE_ASSET,isEvm:!1},[r.SolScope.Mainnet]:{chainId:r.SolScope.Mainnet,name:"Solana",nativeCurrency:n.SOL_NATIVE_ASSET,isEvm:!1},[r.SolScope.Testnet]:{chainId:r.SolScope.Testnet,name:"Solana Testnet",nativeCurrency:n.SOL_TESTNET_NATIVE_ASSET,isEvm:!1},[r.SolScope.Devnet]:{chainId:r.SolScope.Devnet,name:"Solana Devnet",nativeCurrency:n.SOL_DEVNET_NATIVE_ASSET,isEvm:!1},[r.TrxScope.Mainnet]:{chainId:r.TrxScope.Mainnet,name:"Tron",nativeCurrency:n.TRX_NATIVE_ASSET,isEvm:!1},[r.TrxScope.Nile]:{chainId:r.TrxScope.Nile,name:"Tron Nile",nativeCurrency:n.TRX_NILE_NATIVE_ASSET,isEvm:!1},[r.TrxScope.Shasta]:{chainId:r.TrxScope.Shasta,name:"Tron Shasta",nativeCurrency:n.TRX_SHASTA_NATIVE_ASSET,isEvm:!1}},n.NON_EVM_TESTNET_IDS=[r.BtcScope.Testnet,r.BtcScope.Testnet4,r.BtcScope.Signet,r.BtcScope.Regtest,r.SolScope.Testnet,r.SolScope.Devnet,r.TrxScope.Nile,r.TrxScope.Shasta],n.NETWORKS_METADATA={[r.BtcScope.Mainnet]:{features:[],status:a.NetworkStatus.Available},[r.SolScope.Mainnet]:{features:[],status:a.NetworkStatus.Available},[r.TrxScope.Mainnet]:{features:[],status:a.NetworkStatus.Available}};n.getDefaultMultichainNetworkControllerState=()=>({multichainNetworkConfigurationsByChainId:n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS,selectedMultichainNetworkChainId:r.SolScope.Mainnet,isEvmSelected:!0,networksWithTransactionActivity:{}}),n.MULTICHAIN_NETWORK_CONTROLLER_METADATA={multichainNetworkConfigurationsByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},selectedMultichainNetworkChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},isEvmSelected:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},networksWithTransactionActivity:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}},n.MULTICHAIN_NETWORK_TICKER={[r.BtcScope.Mainnet]:"BTC",[r.BtcScope.Testnet]:"tBTC",[r.BtcScope.Testnet4]:"tBTC",[r.BtcScope.Signet]:"sBTC",[r.BtcScope.Regtest]:"rBTC",[r.SolScope.Mainnet]:"SOL",[r.SolScope.Testnet]:"tSOL",[r.SolScope.Devnet]:"dSOL",[r.TrxScope.Mainnet]:"TRX",[r.TrxScope.Nile]:"tTRX",[r.TrxScope.Shasta]:"sTRX"},n.MULTICHAIN_NETWORK_DECIMAL_PLACES={[r.BtcScope.Mainnet]:8,[r.BtcScope.Testnet]:8,[r.BtcScope.Testnet4]:8,[r.BtcScope.Signet]:8,[r.BtcScope.Regtest]:8,[r.SolScope.Mainnet]:5,[r.SolScope.Testnet]:5,[r.SolScope.Devnet]:5,[r.TrxScope.Mainnet]:6,[r.TrxScope.Nile]:6,[r.TrxScope.Shasta]:6}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/constants.cjs"}],[3166,{"./MultichainNetworkController/MultichainNetworkController.cjs":3162,"./MultichainNetworkService/MultichainNetworkService.cjs":3163,"./constants.cjs":3165,"./utils.cjs":3168},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEvmCaipChainId=n.toMultichainNetworkConfigurationsByChainId=n.toMultichainNetworkConfiguration=n.checkIfSupportedCaipChainId=n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS=n.MULTICHAIN_NETWORK_DECIMAL_PLACES=n.MULTICHAIN_NETWORK_TICKER=n.NON_EVM_TESTNET_IDS=n.getDefaultMultichainNetworkControllerState=n.MultichainNetworkService=n.MultichainNetworkController=void 0;var r=e("./MultichainNetworkController/MultichainNetworkController.cjs");Object.defineProperty(n,"MultichainNetworkController",{enumerable:!0,get:function(){return r.MultichainNetworkController}});var a=e("./MultichainNetworkService/MultichainNetworkService.cjs");Object.defineProperty(n,"MultichainNetworkService",{enumerable:!0,get:function(){return a.MultichainNetworkService}});var s=e("./constants.cjs");Object.defineProperty(n,"getDefaultMultichainNetworkControllerState",{enumerable:!0,get:function(){return s.getDefaultMultichainNetworkControllerState}}),Object.defineProperty(n,"NON_EVM_TESTNET_IDS",{enumerable:!0,get:function(){return s.NON_EVM_TESTNET_IDS}}),Object.defineProperty(n,"MULTICHAIN_NETWORK_TICKER",{enumerable:!0,get:function(){return s.MULTICHAIN_NETWORK_TICKER}}),Object.defineProperty(n,"MULTICHAIN_NETWORK_DECIMAL_PLACES",{enumerable:!0,get:function(){return s.MULTICHAIN_NETWORK_DECIMAL_PLACES}}),Object.defineProperty(n,"AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS",{enumerable:!0,get:function(){return s.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS}});var i=e("./utils.cjs");Object.defineProperty(n,"checkIfSupportedCaipChainId",{enumerable:!0,get:function(){return i.checkIfSupportedCaipChainId}}),Object.defineProperty(n,"toMultichainNetworkConfiguration",{enumerable:!0,get:function(){return i.toMultichainNetworkConfiguration}}),Object.defineProperty(n,"toMultichainNetworkConfigurationsByChainId",{enumerable:!0,get:function(){return i.toMultichainNetworkConfigurationsByChainId}}),Object.defineProperty(n,"toEvmCaipChainId",{enumerable:!0,get:function(){return i.toEvmCaipChainId}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/index.cjs"}],[3167,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MULTICHAIN_NETWORK_CONTROLLER_NAME=void 0,n.MULTICHAIN_NETWORK_CONTROLLER_NAME="MultichainNetworkController"}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/types.cjs"}],[3168,{"./constants.cjs":3165,"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isKnownCaipNamespace=n.toMultichainNetworkConfigurationsByChainId=n.toMultichainNetworkConfiguration=n.convertEvmCaipToHexChainId=n.toEvmCaipChainId=n.checkIfSupportedCaipChainId=n.getChainIdForNonEvm=n.isEvmCaipChainId=void 0;const r=e("@metamask/utils"),a=e("./constants.cjs");n.isEvmCaipChainId=function(e){const{namespace:t}=(0,r.parseCaipChainId)(e);return t===r.KnownCaipNamespace.Eip155},n.getChainIdForNonEvm=function(e){const t=e.find(e=>Object.keys(a.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS).includes(e));if(t)return t;throw new Error(`Unsupported scope: ${e.join(", ")}.`)},n.checkIfSupportedCaipChainId=function(e){return Object.keys(a.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS).includes(e)};n.toEvmCaipChainId=e=>(0,r.toCaipChainId)(r.KnownCaipNamespace.Eip155,(0,r.hexToNumber)(e).toString()),n.convertEvmCaipToHexChainId=function(e){const{namespace:t,reference:n}=(0,r.parseCaipChainId)(e);if(t===r.KnownCaipNamespace.Eip155)return(0,r.add0x)(parseInt(n,10).toString(16));throw new Error(`Unsupported CAIP chain ID namespace: ${t}. Only eip155 is supported.`)};n.toMultichainNetworkConfiguration=e=>{const{chainId:t,name:r,rpcEndpoints:a,defaultRpcEndpointIndex:s,nativeCurrency:i,blockExplorerUrls:o,defaultBlockExplorerUrlIndex:c=0}=e;return{chainId:(0,n.toEvmCaipChainId)(t),isEvm:!0,name:r||a[s].url,nativeCurrency:i,blockExplorerUrls:o,defaultBlockExplorerUrlIndex:c}};n.toMultichainNetworkConfigurationsByChainId=e=>Object.entries(e).reduce((e,[,t])=>({...e,[(0,n.toEvmCaipChainId)(t.chainId)]:(0,n.toMultichainNetworkConfiguration)(t)}),{}),n.isKnownCaipNamespace=function(e){return Object.values(r.KnownCaipNamespace).includes(e)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/utils.cjs"}],[3169,{"./constants.cjs":3170,"./create-auto-managed-network-client.cjs":3171,"./logger.cjs":3174,"./types.cjs":3177,"@metamask/base-controller":1401,"@metamask/controller-utils":1488,"@metamask/eth-query":2073,"@metamask/rpc-errors":2692,"@metamask/swappable-obj-proxy":3036,"@metamask/utils":3207,"fast-deep-equal":4484,immer:4717,lodash:4940,reselect:5410,"uri-js":5809,uuid:5835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,h,f,m,p,g,w,b,T,E,y,S,I,k,A,C,_,P,v,N,R,j=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),O=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),x=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&j(t,e,n);return O(t,e),t},L=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},F=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkController=n.selectAvailableNetworkClientIds=n.getAvailableNetworkClientIds=n.selectNetworkConfigurations=n.getNetworkConfigurations=n.getDefaultNetworkControllerState=n.knownKeysOf=n.RpcEndpointType=void 0;const D=e("@metamask/base-controller"),B=e("@metamask/controller-utils"),G=F(e("@metamask/eth-query")),U=e("@metamask/rpc-errors"),H=e("@metamask/swappable-obj-proxy"),q=e("@metamask/utils"),W=F(e("fast-deep-equal")),$=e("immer"),K=e("lodash"),V=e("reselect"),Y=x(e("uri-js")),z=e("uuid"),Q=e("./constants.cjs"),J=e("./create-auto-managed-network-client.cjs"),X=e("./logger.cjs"),Z=e("./types.cjs"),ee=(0,X.createModuleLogger)(X.projectLogger,"NetworkController"),te=/^https:\/\/(?<networkName>[^.]+)\.infura\.io\/v\d+\/(?<apiKey>.+)$/u;var ne;function re(e){return Object.keys(e)}!function(e){e.Custom="custom",e.Infura="infura"}(ne||(n.RpcEndpointType=ne={})),n.knownKeysOf=re;const ae="NetworkController";function se(e=[]){const t=Object.values(B.InfuraNetworkType).reduce((e,t)=>{const n=B.ChainId[t];if(Q.DEPRECATED_NETWORKS.has(n))return e;const r=`https://${t}.infura.io/v3/{infuraProjectId}`,a={blockExplorerUrls:[],chainId:n,defaultRpcEndpointIndex:0,name:B.NetworkNickname[t],nativeCurrency:B.NetworksTicker[t],rpcEndpoints:[{failoverUrls:[],networkClientId:t,type:ne.Infura,url:r}]};return{...e,[n]:a}},{}),n={[B.ChainId["megaeth-testnet"]]:ie(B.CustomNetworkType["megaeth-testnet"]),[B.ChainId["megaeth-testnet-v2"]]:ie(B.CustomNetworkType["megaeth-testnet-v2"]),[B.ChainId["monad-testnet"]]:ie(B.CustomNetworkType["monad-testnet"])};return e.reduce((e,t)=>((0,q.hasProperty)(n,t)&&(e[t]=n[t]),e),t)}function ie(e){const{ticker:t,rpcPrefs:n}=B.BUILT_IN_NETWORKS[e],r=B.BUILT_IN_CUSTOM_NETWORKS_RPC[e];return{blockExplorerUrls:[n.blockExplorerUrl],chainId:B.ChainId[e],defaultRpcEndpointIndex:0,defaultBlockExplorerUrlIndex:0,name:B.NetworkNickname[e],nativeCurrency:t,rpcEndpoints:[{failoverUrls:[],networkClientId:e,type:ne.Custom,url:r}]}}function oe(e){const t=se(e);return{selectedNetworkClientId:B.InfuraNetworkType.mainnet,networksMetadata:{},networkConfigurationsByChainId:t}}n.getDefaultNetworkControllerState=oe;function ce(e){return Object.values(e.networkConfigurationsByChainId)}function le(e){return e.flatMap(e=>e.rpcEndpoints.map(e=>e.networkClientId))}function ue(e){const t=Y.parse(e);return t.error===undefined&&("http"===t.scheme||"https"===t.scheme)}function de(e){const t=te.exec(e);if(t?.groups){if((0,B.isInfuraNetworkType)(t.groups.networkName))return t.groups.networkName;throw new Error(`Unknown Infura network '${t.groups.networkName}'`)}throw new Error("Could not derive Infura network from RPC endpoint URL")}function he(e){return new Map(Object.values(e).flatMap(e=>e.rpcEndpoints.map(t=>[t.networkClientId,e])))}n.getNetworkConfigurations=ce,n.selectNetworkConfigurations=(0,V.createSelector)(e=>e.networkConfigurationsByChainId,e=>Object.values(e)),n.getAvailableNetworkClientIds=le,n.selectAvailableNetworkClientIds=(0,V.createSelector)(n.selectNetworkConfigurations,le);class fe extends D.BaseController{constructor(e){const{messenger:t,state:n,infuraProjectId:g,log:w,getRpcServiceOptions:b,getBlockTrackerOptions:T,additionalDefaultNetworks:E,isRpcFailoverEnabled:S=!1}=e,I={...oe(E),...n};!function(e){const t=Object.entries(e.networkConfigurationsByChainId),n=le(ce(e));if(0===t.length)throw new Error("NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty");for(const[e,n]of t){if(e!==n.chainId)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' is filed under '${e}' which does not match its \`chainId\` of '${n.chainId}'`);if(n.blockExplorerUrls.length>0?n.defaultBlockExplorerUrlIndex===undefined||n.blockExplorerUrls[n.defaultBlockExplorerUrlIndex]===undefined:n.defaultBlockExplorerUrlIndex!==undefined)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' has a \`defaultBlockExplorerUrlIndex\` that does not refer to an entry in \`blockExplorerUrls\``);if(n.rpcEndpoints[n.defaultRpcEndpointIndex]===undefined)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' has a \`defaultRpcEndpointIndex\` that does not refer to an entry in \`rpcEndpoints\``)}if([...new Set(n)].length<n.length)throw new Error("NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`")}(I);const k=function(e,t){const n=ce(e).sort((e,t)=>e.chainId.localeCompare(t.chainId)),r=le(n),a=Object.keys(e.networksMetadata).filter(e=>!r.includes(e));return(0,$.produce)(e,s=>{if(!r.includes(e.selectedNetworkClientId)){const r=n[0],a=r.rpcEndpoints[r.defaultRpcEndpointIndex].networkClientId;t.captureException?.(new Error(`\`selectedNetworkClientId\` '${e.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${a}'`)),s.selectedNetworkClientId=a}if(a.length>0){for(const e of a)delete s.networksMetadata[e];t.captureException?.(new Error("`networksMetadata` had invalid network client IDs, which have been removed"))}})}(I,t);if(!g||"string"!=typeof g)throw new Error("Invalid Infura project ID");super({name:ae,metadata:{selectedNetworkClientId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},networksMetadata:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},networkConfigurationsByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}},messenger:t,state:k}),r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),f.set(this,void 0),m.set(this,void 0),p.set(this,void 0),L(this,s,g,"f"),L(this,d,w,"f"),L(this,h,b,"f"),L(this,f,T,"f"),L(this,p,S,"f"),L(this,i,this.state.selectedNetworkClientId,"f"),L(this,m,he(this.state.networkConfigurationsByChainId),"f"),this.messenger.registerActionHandler(`${this.name}:getEthQuery`,()=>M(this,a,"f")),this.messenger.registerActionHandler(`${this.name}:getNetworkClientById`,this.getNetworkClientById.bind(this)),this.messenger.registerActionHandler(`${this.name}:getEIP1559Compatibility`,this.getEIP1559Compatibility.bind(this)),this.messenger.registerActionHandler(`${this.name}:setActiveNetwork`,this.setActiveNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:setProviderType`,this.setProviderType.bind(this)),this.messenger.registerActionHandler(`${this.name}:findNetworkClientIdByChainId`,this.findNetworkClientIdByChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getNetworkConfigurationByChainId`,this.getNetworkConfigurationByChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getNetworkConfigurationByNetworkClientId`,this.getNetworkConfigurationByNetworkClientId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getSelectedNetworkClient`,this.getSelectedNetworkClient.bind(this)),this.messenger.registerActionHandler(`${this.name}:getSelectedChainId`,this.getSelectedChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:addNetwork`,this.addNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:removeNetwork`,this.removeNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:updateNetwork`,this.updateNetwork.bind(this)),this.messenger.subscribe(`${this.name}:rpcEndpointChainUnavailable`,({networkClientId:e})=>{M(this,r,"m",y).call(this,e,{networkStatus:Q.NetworkStatus.Unavailable})}),this.messenger.subscribe(`${this.name}:rpcEndpointChainDegraded`,({networkClientId:e})=>{M(this,r,"m",y).call(this,e,{networkStatus:Q.NetworkStatus.Degraded})}),this.messenger.subscribe(`${this.name}:rpcEndpointChainAvailable`,({networkClientId:e})=>{M(this,r,"m",y).call(this,e,{networkStatus:Q.NetworkStatus.Available})})}enableRpcFailover(){M(this,r,"m",g).call(this,!0)}disableRpcFailover(){M(this,r,"m",g).call(this,!1)}getProviderAndBlockTracker(){return{provider:M(this,o,"f"),blockTracker:M(this,c,"f")}}getSelectedNetworkClient(){return M(this,o,"f")&&M(this,c,"f")?{provider:M(this,o,"f"),blockTracker:M(this,c,"f")}:undefined}getSelectedChainId(){const e=this.getNetworkConfigurationByNetworkClientId(this.state.selectedNetworkClientId);return e?.chainId}getNetworkClientRegistry(){const e=M(this,r,"m",v).call(this);return Object.assign({},e[Z.NetworkClientType.Infura],e[Z.NetworkClientType.Custom])}getNetworkClientById(e){if(!e)throw new Error("No network client ID was provided.");const t=M(this,r,"m",v).call(this);if((0,B.isInfuraNetworkType)(e)){const n=t[Z.NetworkClientType.Infura][e];if(!n)throw new Error(`No Infura network client was found with the ID "${e}".`);return n}const n=t[Z.NetworkClientType.Custom][e];if(!n)throw new Error(`No custom network client was found with the ID "${e}".`);return n}initializeProvider({lookupNetwork:e=!0}={}){return M(this,r,"m",R).call(this,this.state.selectedNetworkClientId),e?this.lookupNetwork():undefined}async lookupNetwork(e){e?await M(this,r,"m",T).call(this,e):await M(this,r,"m",E).call(this)}async lookupNetworkByClientId(e){await M(this,r,"m",T).call(this,e)}async setProviderType(e){if(e===B.NetworkType.rpc)throw new Error(`NetworkController - cannot call "setProviderType" with type "${B.NetworkType.rpc}". Use "setActiveNetwork"`);if(!(0,B.isInfuraNetworkType)(e))throw new Error(`Unknown Infura provider type "${String(e)}".`);await this.setActiveNetwork(e)}async setActiveNetwork(e,t={}){L(this,i,this.state.selectedNetworkClientId,"f"),await M(this,r,"m",w).call(this,e,t)}async getEIP1559Compatibility(e){if(e)return this.get1559CompatibilityWithNetworkClientId(e);if(!M(this,a,"f"))return!1;const{EIPS:t}=this.state.networksMetadata[this.state.selectedNetworkClientId];if(t[1559]!==undefined)return t[1559];const n=await M(this,r,"m",I).call(this,this.state.selectedNetworkClientId);return this.update(e=>{n!==undefined&&(e.networksMetadata[e.selectedNetworkClientId].EIPS[1559]=n)}),n}async get1559CompatibilityWithNetworkClientId(e){let t=this.state.networksMetadata[e];t?.EIPS[1559]===undefined&&(await this.lookupNetwork(e),t=this.state.networksMetadata[e]);const{EIPS:n}=t;return n[1559]}async resetConnection(){await M(this,r,"m",w).call(this,this.state.selectedNetworkClientId)}getNetworkConfigurationByChainId(e){return this.state.networkConfigurationsByChainId[e]}getNetworkConfigurationByNetworkClientId(e){return M(this,m,"f").get(e)}addNetwork(e){const{rpcEndpoints:t}=e,n=M(this,r,"m",v).call(this);M(this,r,"m",k).call(this,{mode:"add",networkFields:e,autoManagedNetworkClientRegistry:n});const a=t.map(e=>({type:"add",rpcEndpoint:e.type===ne.Custom?{...e,networkClientId:(0,z.v4)()}:e})),s=M(this,r,"m",A).call(this,{networkFields:e,networkClientOperations:a});return M(this,r,"m",C).call(this,{networkFields:e,networkClientOperations:a,autoManagedNetworkClientRegistry:n}),this.update(t=>{M(this,r,"m",P).call(this,{state:t,mode:"add",networkFields:e,networkConfigurationToPersist:s})}),this.messenger.publish(`${ae}:networkAdded`,s),s}async updateNetwork(e,t,{replacementSelectedRpcEndpointIndex:n}={}){const a=this.state.networkConfigurationsByChainId[e];if(a===undefined)throw new Error(`Could not update network: Cannot find network configuration for chain '${e}'`);const s=e,{chainId:i,rpcEndpoints:o}=t,c=M(this,r,"m",v).call(this);M(this,r,"m",k).call(this,{mode:"update",networkFields:t,existingNetworkConfiguration:a,autoManagedNetworkClientRegistry:c});const l=[];for(const e of o){const t=a.rpcEndpoints.find(t=>t.type===e.type&&t.url===e.url&&(t.networkClientId===e.networkClientId||e.networkClientId===undefined)),n=a.rpcEndpoints.find(t=>t.type===ne.Infura&&e.type===ne.Infura||t.type===e.type&&t.networkClientId===e.networkClientId&&t.url===e.url),r=a.rpcEndpoints.find(t=>t.type===e.type&&(t.url===e.url||t.networkClientId===e.networkClientId));if(i!==s&&n!==undefined){const t=e.type===ne.Infura?e:{...e,networkClientId:(0,z.v4)()};l.push({type:"replace",oldRpcEndpoint:n,newRpcEndpoint:t})}else if(t!==undefined){let n;n=t.type===ne.Infura?t:Object.assign({},e,{networkClientId:t.networkClientId}),l.push({type:"noop",rpcEndpoint:n})}else if(r===undefined){const t={type:"add",rpcEndpoint:e.type===ne.Infura?e:{...e,networkClientId:(0,z.v4)()}};l.push(t)}else{let t;t=e.type===ne.Infura?e:{...e,networkClientId:(0,z.v4)()},l.push({type:"replace",oldRpcEndpoint:r,newRpcEndpoint:t})}}for(const e of a.rpcEndpoints)if(!l.some(t=>{const n="replace"===t.type?t.oldRpcEndpoint:t.rpcEndpoint;return n.type===e.type&&n.networkClientId===e.networkClientId&&n.url===e.url})){const t={type:"remove",rpcEndpoint:e};l.push(t)}const u=M(this,r,"m",A).call(this,{networkFields:t,networkClientOperations:l});if(n===undefined&&l.some(e=>"remove"===e.type&&e.rpcEndpoint.networkClientId===this.state.selectedNetworkClientId)&&!l.some(e=>"replace"===e.type&&e.oldRpcEndpoint.networkClientId===this.state.selectedNetworkClientId))throw new Error(`Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \`replacementSelectedRpcEndpointIndex\` option.`);M(this,r,"m",C).call(this,{networkFields:t,networkClientOperations:l,autoManagedNetworkClientRegistry:c});const d=l.map((e,t)=>[e,t]).find(([e,t])=>"replace"===e.type&&e.oldRpcEndpoint.networkClientId===this.state.selectedNetworkClientId),h=n??d?.[1];let f;if(h!==undefined&&(f=u.rpcEndpoints[h],f===undefined))throw new Error(`Could not update network: \`replacementSelectedRpcEndpointIndex\` ${h} does not refer to an entry in \`rpcEndpoints\``);return f&&f.networkClientId!==this.state.selectedNetworkClientId?await this.setActiveNetwork(f.networkClientId,{updateState:e=>{M(this,r,"m",P).call(this,{state:e,mode:"update",networkFields:t,networkConfigurationToPersist:u,existingNetworkConfiguration:a})}}):this.update(e=>{M(this,r,"m",P).call(this,{state:e,mode:"update",networkFields:t,networkConfigurationToPersist:u,existingNetworkConfiguration:a})}),M(this,r,"m",_).call(this,{networkClientOperations:l,autoManagedNetworkClientRegistry:c}),u}removeNetwork(e){const t=this.state.networkConfigurationsByChainId[e];if(t===undefined)throw new Error(`Cannot find network configuration for chain '${e}'`);if(t.rpcEndpoints.some(e=>e.networkClientId===this.state.selectedNetworkClientId))throw new Error("Cannot remove the currently selected network");const n=M(this,r,"m",v).call(this),a=t.rpcEndpoints.map(e=>({type:"remove",rpcEndpoint:e}));M(this,r,"m",_).call(this,{networkClientOperations:a,autoManagedNetworkClientRegistry:n}),this.update(e=>{M(this,r,"m",P).call(this,{state:e,mode:"remove",existingNetworkConfiguration:t});for(const n of t.rpcEndpoints)delete e.networksMetadata[n.networkClientId]}),this.messenger.publish("NetworkController:networkRemoved",t)}async rollbackToPreviousProvider(){await M(this,r,"m",w).call(this,M(this,i,"f"))}async destroy(){await(M(this,c,"f")?.destroy())}loadBackup({networkConfigurationsByChainId:e}){this.update(t=>{t.networkConfigurationsByChainId={...t.networkConfigurationsByChainId,...e}})}findNetworkClientIdByChainId(e){const t=this.state.networkConfigurationsByChainId[e];if(!t)throw new Error(`Invalid chain ID "${e}"`);const{networkClientId:n}=t.rpcEndpoints[t.defaultRpcEndpointIndex];return n}}n.NetworkController=fe,a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,r=new WeakSet,g=function(e){if(M(this,p,"f")===e)return;const t=M(this,r,"m",v).call(this);for(const n of Object.values(t))for(const t of Object.keys(n)){const r=n[t];r.configuration.failoverRpcUrls&&r.configuration.failoverRpcUrls.length>0&&(e?r.enableRpcFailover():r.disableRpcFailover())}L(this,p,e,"f")},w=async function(e,t={}){this.messenger.publish("NetworkController:networkWillChange",this.state),M(this,r,"m",R).call(this,e,t),this.messenger.publish("NetworkController:networkDidChange",this.state),await this.lookupNetwork()},b=async function(e){const t=((0,B.isInfuraNetworkType)(e),this.getNetworkClientById(e)).configuration.type===Z.NetworkClientType.Infura;let n,a;try{a=await M(this,r,"m",I).call(this,e),n=Q.NetworkStatus.Available}catch(e){if(ee("NetworkController: lookupNetwork: ",e),function(e){return"object"==typeof e&&null!==e&&"code"in e}(e)){let r;if(t&&(0,q.hasProperty)(e,"message")&&"string"==typeof e.message)try{r=JSON.parse(e.message)}catch{M(this,d,"f")?.warn("NetworkController: lookupNetwork: json parse error: ",e)}(0,q.isPlainObject)(r)&&r.error===Q.INFURA_BLOCKED_KEY?n=Q.NetworkStatus.Blocked:e.code===U.errorCodes.rpc.internal?(n=Q.NetworkStatus.Unknown,M(this,d,"f")?.warn("NetworkController: lookupNetwork: rpc internal error: ",e)):(n=Q.NetworkStatus.Unavailable,M(this,d,"f")?.warn("NetworkController: lookupNetwork: ",e))}else ee("NetworkController - could not determine network status",e),n=Q.NetworkStatus.Unknown,M(this,d,"f")?.warn("NetworkController: lookupNetwork: ",e)}return{isInfura:t,networkStatus:n,isEIP1559Compatible:a}},T=async function(e){const{networkStatus:t,isEIP1559Compatible:n}=await M(this,r,"m",b).call(this,e);M(this,r,"m",y).call(this,e,{networkStatus:t,isEIP1559Compatible:n})},E=async function(){if(!M(this,a,"f"))return;let e=!1;const t=()=>{e=!0;try{this.messenger.unsubscribe("NetworkController:networkDidChange",t)}catch(e){if(!(e instanceof Error)||"Subscription not found for event: NetworkController:networkDidChange"!==e.message)throw e}};this.messenger.subscribe("NetworkController:networkDidChange",t);const{isInfura:n,networkStatus:s,isEIP1559Compatible:i}=await M(this,r,"m",b).call(this,this.state.selectedNetworkClientId);if(!e){try{this.messenger.unsubscribe("NetworkController:networkDidChange",t)}catch(e){if(!(e instanceof Error)||"Subscription not found for event: NetworkController:networkDidChange"!==e.message)throw e}M(this,r,"m",y).call(this,this.state.selectedNetworkClientId,{networkStatus:s,isEIP1559Compatible:i}),n?s===Q.NetworkStatus.Available?this.messenger.publish("NetworkController:infuraIsUnblocked"):s===Q.NetworkStatus.Blocked&&this.messenger.publish("NetworkController:infuraIsBlocked"):this.messenger.publish("NetworkController:infuraIsUnblocked")}},y=function(e,t){this.update(n=>{var r;(r=n.networksMetadata)[e]??(r[e]={status:Q.NetworkStatus.Unknown,EIPS:{}});const a=n.networksMetadata[e];a.status=t.networkStatus,"isEIP1559Compatible"in t&&(t.isEIP1559Compatible===undefined?delete a.EIPS[1559]:a.EIPS[1559]=t.isEIP1559Compatible)})},S=function(e=this.state.selectedNetworkClientId){const t=this.getNetworkClientById(e),n=new G.default(t.provider);return new Promise((e,t)=>{n.sendAsync({method:"eth_getBlockByNumber",params:["latest",!1]},(n,r)=>{n?t(n):e(r)})})},I=async function(e){const t=await M(this,r,"m",S).call(this,e);return t?t.baseFeePerGas!==undefined:undefined},k=function(e){const{mode:t,networkFields:n,autoManagedNetworkClientRegistry:r}=e,a="existingNetworkConfiguration"in e?e.existingNetworkConfiguration:null,s="update"===t?"Could not update network":"Could not add network";if(!(0,q.isStrictHexString)(n.chainId)||!(0,B.isSafeChainId)(n.chainId))throw new Error(`${s}: Invalid \`chainId\` '${n.chainId}' (must start with "0x" and not exceed the maximum)`);if(null===a||n.chainId!==a.chainId){const t=this.state.networkConfigurationsByChainId[n.chainId];if(t!==undefined)throw null===a?new Error(`Could not add network for chain ${e.networkFields.chainId} as another network for that chain already exists ('${t.name}')`):new Error(`Cannot move network from chain ${a.chainId} to ${n.chainId} as another network for that chain already exists ('${t.name}')`)}if(n.blockExplorerUrls.length>0?n.defaultBlockExplorerUrlIndex===undefined||n.blockExplorerUrls[n.defaultBlockExplorerUrlIndex]===undefined:n.defaultBlockExplorerUrlIndex!==undefined)throw new Error(`${s}: \`defaultBlockExplorerUrlIndex\` must refer to an entry in \`blockExplorerUrls\``);if(0===n.rpcEndpoints.length)throw new Error(`${s}: \`rpcEndpoints\` must be a non-empty array`);for(const e of n.rpcEndpoints){if(!ue(e.url))throw new Error(`${s}: An entry in \`rpcEndpoints\` has invalid URL '${e.url}'`);const i="networkClientId"in e?e.networkClientId:undefined;if(e.type===ne.Custom&&i!==undefined&&(0,B.isInfuraNetworkType)(i))throw new Error(`${s}: Custom RPC endpoint '${e.url}' has invalid network client ID '${i}'`);if("update"===t&&i!==undefined&&e.type===ne.Custom&&!Object.values(r).some(e=>i in e))throw new Error(`${s}: RPC endpoint '${e.url}' refers to network client '${i}' that does not exist`);if(n.rpcEndpoints.some(t=>t!==e&&Y.equal(t.url,e.url)))throw new Error(`${s}: Each entry in rpcEndpoints must have a unique URL`);const o=Object.values(this.state.networkConfigurationsByChainId).filter(e=>!a||e.chainId!==a.chainId);for(const n of o){if(n.rpcEndpoints.find(t=>Y.equal(e.url,t.url)))throw"update"===t?new Error(`Could not update network to point to same RPC endpoint as existing network for chain ${n.chainId} ('${n.name}')`):new Error(`Could not add network that points to same RPC endpoint as existing network for chain ${n.chainId} ('${n.name}')`)}}if([...new Set(n.rpcEndpoints)].length<n.rpcEndpoints.length)throw new Error(`${s}: Each entry in rpcEndpoints must be unique`);const i=n.rpcEndpoints.map(e=>"networkClientId"in e?e.networkClientId:undefined).filter(e=>e!==undefined);if([...new Set(i)].length<i.length)throw new Error(`${s}: Each entry in rpcEndpoints must have a unique networkClientId`);const o=n.rpcEndpoints.filter(e=>e.type===ne.Infura);if(o.length>1)throw new Error(`${s}: There cannot be more than one Infura RPC endpoint`);const c=o[0];if(c){const e=de(c.url),r=B.NetworkNickname[e],a=B.ChainId[e];if(n.chainId!==a)throw new Error("add"===t?`Could not add network with chain ID ${n.chainId} and Infura RPC endpoint for '${r}' which represents ${a}, as the two conflict`:`Could not update network with chain ID ${n.chainId} and Infura RPC endpoint for '${r}' which represents ${a}, as the two conflict`)}if(n.rpcEndpoints[n.defaultRpcEndpointIndex]===undefined)throw new Error(`${s}: \`defaultRpcEndpointIndex\` must refer to an entry in \`rpcEndpoints\``)},A=function({networkFields:e,networkClientOperations:t}){return{...e,rpcEndpoints:t.filter(e=>"add"===e.type||"noop"===e.type).map(e=>e.rpcEndpoint).concat(t.filter(e=>"replace"===e.type).map(e=>e.newRpcEndpoint))}},C=function({networkFields:e,networkClientOperations:t,autoManagedNetworkClientRegistry:n}){const r=t.filter(e=>"add"===e.type).map(e=>e.rpcEndpoint).concat(t.filter(e=>"replace"===e.type).map(e=>e.newRpcEndpoint));for(const t of r)t.type===ne.Infura?n[Z.NetworkClientType.Infura][t.networkClientId]=(0,J.createAutoManagedNetworkClient)({networkClientId:t.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Infura,chainId:e.chainId,network:t.networkClientId,failoverRpcUrls:t.failoverUrls,infuraProjectId:M(this,s,"f"),ticker:e.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,f,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")}):n[Z.NetworkClientType.Custom][t.networkClientId]=(0,J.createAutoManagedNetworkClient)({networkClientId:t.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Custom,chainId:e.chainId,failoverRpcUrls:t.failoverUrls,rpcUrl:t.url,ticker:e.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,f,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")})},_=function({networkClientOperations:e,autoManagedNetworkClientRegistry:t}){const n=e.filter(e=>"remove"===e.type).map(e=>e.rpcEndpoint).concat(e.filter(e=>"replace"===e.type).map(e=>e.oldRpcEndpoint));for(const e of n){const n=this.getNetworkClientById(e.networkClientId);n.destroy(),delete t[n.configuration.type][e.networkClientId]}},P=function(e){const{state:t,mode:n}=e;("remove"===n||"update"===n&&e.networkFields.chainId!==e.existingNetworkConfiguration.chainId)&&delete t.networkConfigurationsByChainId[e.existingNetworkConfiguration.chainId],"add"!==n&&"update"!==n||((0,W.default)(t.networkConfigurationsByChainId[e.networkFields.chainId],e.networkConfigurationToPersist)||(e.networkConfigurationToPersist.lastUpdatedAt=Date.now()),t.networkConfigurationsByChainId[e.networkFields.chainId]=e.networkConfigurationToPersist),L(this,m,he((0,K.cloneDeep)(t.networkConfigurationsByChainId)),"f")},v=function(){return L(this,l,M(this,l,"f")??M(this,r,"m",N).call(this),"f")},N=function(){return re(this.state.networkConfigurationsByChainId).flatMap(e=>{const t=this.state.networkConfigurationsByChainId[e];return t.rpcEndpoints.map(e=>{if(e.type===ne.Infura){const n=de(e.url);return[e.networkClientId,(0,J.createAutoManagedNetworkClient)({networkClientId:e.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Infura,network:n,failoverRpcUrls:e.failoverUrls,infuraProjectId:M(this,s,"f"),chainId:t.chainId,ticker:t.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,f,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")})]}return[e.networkClientId,(0,J.createAutoManagedNetworkClient)({networkClientId:e.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Custom,chainId:t.chainId,failoverRpcUrls:e.failoverUrls,rpcUrl:e.url,ticker:t.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,f,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")})]})}).reduce((e,[t,n])=>({...e,[n.configuration.type]:{...e[n.configuration.type],[t]:n}}),{[Z.NetworkClientType.Custom]:{},[Z.NetworkClientType.Infura]:{}})},R=function(e,{updateState:t}={}){const n=M(this,r,"m",v).call(this);let s;if((0,B.isInfuraNetworkType)(e)){const t=n[Z.NetworkClientType.Infura][e];if(!t)throw new Error(`No Infura network client found with ID '${e}'`);s=t}else{const t=n[Z.NetworkClientType.Custom][e];if(!t)throw new Error(`No network client found with ID '${e}'`);s=t}L(this,u,s,"f"),this.update(n=>{var r;n.selectedNetworkClientId=e,(r=n.networksMetadata)[e]??(r[e]={status:Q.NetworkStatus.Unknown,EIPS:{}}),t?.(n)}),M(this,o,"f")?M(this,o,"f").setTarget(M(this,u,"f").provider):L(this,o,(0,H.createSwappableProxy)(M(this,u,"f").provider),"f"),M(this,c,"f")?M(this,c,"f").setTarget(M(this,u,"f").blockTracker):L(this,c,(0,H.createEventEmitterProxy)(M(this,u,"f").blockTracker,{eventFilter:"skipInternal"}),"f"),L(this,a,new G.default(M(this,o,"f")),"f")}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/NetworkController.cjs"}],[3170,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.DEPRECATED_NETWORKS=n.INFURA_BLOCKED_KEY=n.NetworkStatus=void 0,function(e){e.Unknown="unknown",e.Available="available",e.Degraded="degraded",e.Unavailable="unavailable",e.Blocked="blocked"}(r||(n.NetworkStatus=r={})),n.INFURA_BLOCKED_KEY="countryBlocked",n.DEPRECATED_NETWORKS=new Set(["0xe704","0x5"])}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/constants.cjs"}],[3171,{"./create-network-client.cjs":3172},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createAutoManagedNetworkClient=void 0;const r=e("./create-network-client.cjs"),a="__target__",s={__UNINITIALIZED__:!0};n.createAutoManagedNetworkClient=function({networkClientId:e,networkClientConfiguration:t,getRpcServiceOptions:n,getBlockTrackerOptions:i=()=>({}),messenger:o,isRpcFailoverEnabled:c,logger:l}){let u,d=c;const h=()=>{if(u??(u=(0,r.createNetworkClient)({id:e,configuration:t,getRpcServiceOptions:n,getBlockTrackerOptions:i,messenger:o,isRpcFailoverEnabled:d,logger:l})),u===undefined)throw new Error("It looks like `createNetworkClient` didn't return anything. Perhaps it's being mocked?");return u},f=new Proxy(s,{get(e,t,n){if(t===a)return u?.provider;const{provider:r}=h();if(t in r){const e=r[t];return"function"==typeof e?function(...t){return e.apply(this===n?r:this,t)}:e}return undefined},has(e,t){if(t===a)return!0;const{provider:n}=h();return t in n}}),m=new Proxy(s,{get(e,t,n){if(t===a)return u?.blockTracker;const{blockTracker:r}=h();if(t in r){const e=r[t];return"function"==typeof e?function(...t){return e.apply(this===n?r:this,t)}:e}return undefined},has(e,t){if(t===a)return!0;const{blockTracker:n}=h();return t in n}}),p=()=>{u?.destroy()};return{configuration:t,provider:f,blockTracker:m,destroy:p,enableRpcFailover:()=>{d=!0,p(),u=undefined},disableRpcFailover:()=>{d=!1,p(),u=undefined}}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/create-auto-managed-network-client.cjs"}],[3172,{"./rpc-service/rpc-service-chain.cjs":3175,"./types.cjs":3177,"@metamask/connectivity-controller":1482,"@metamask/controller-utils":1488,"@metamask/eth-block-tracker":1897,"@metamask/eth-json-rpc-infura":1935,"@metamask/eth-json-rpc-middleware":1946,"@metamask/eth-json-rpc-provider":1963,"@metamask/json-rpc-engine":2216,"@metamask/json-rpc-engine/v2":2226},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createNetworkClient=void 0;const r=e("@metamask/connectivity-controller"),a=e("@metamask/controller-utils"),s=e("@metamask/eth-block-tracker"),i=e("@metamask/eth-json-rpc-infura"),o=e("@metamask/eth-json-rpc-middleware"),c=e("@metamask/eth-json-rpc-provider"),l=e("@metamask/eth-json-rpc-provider"),u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-engine/v2"),h=e("./rpc-service/rpc-service-chain.cjs"),f=e("./types.cjs");function m({network:e}){return(0,d.createScaffoldMiddleware)({eth_chainId:a.ChainId[e]})}n.createNetworkClient=function({id:e,configuration:t,getRpcServiceOptions:n,getBlockTrackerOptions:a,messenger:g,isRpcFailoverEnabled:w,logger:b}){const T=t.type===f.NetworkClientType.Infura?`https://${t.network}.infura.io/v3/${t.infuraProjectId}`:t.rpcUrl,E=function({id:e,primaryEndpointUrl:t,configuration:n,getRpcServiceOptions:a,messenger:s,isRpcFailoverEnabled:i,logger:o}){const c=i?[t,...n.failoverRpcUrls??[]]:[t],l=()=>s.call("ConnectivityController:getState").connectivityStatus===r.CONNECTIVITY_STATUSES.Offline,u=c.map(e=>({...a(e),endpointUrl:e,logger:o,isOffline:l})),d=e=>"error"in e?e.error:"value"in e?e.value:undefined,f=new h.RpcServiceChain([u[0],...u.slice(1)]);return f.onBreak(t=>{const r=d(t);if(r===undefined)throw new Error("Could not make request to endpoint.");s.publish("NetworkController:rpcEndpointChainUnavailable",{chainId:n.chainId,networkClientId:e,error:r})}),f.onServiceBreak(({endpointUrl:t,primaryEndpointUrl:r,...a})=>{const i=d(a);if(i===undefined)throw new Error("Could not make request to endpoint.");s.publish("NetworkController:rpcEndpointUnavailable",{chainId:n.chainId,networkClientId:e,primaryEndpointUrl:r,endpointUrl:t,error:i})}),f.onDegraded(t=>{const r=d(t);s.publish("NetworkController:rpcEndpointChainDegraded",{chainId:n.chainId,networkClientId:e,error:r})}),f.onServiceDegraded(({endpointUrl:t,primaryEndpointUrl:r,...a})=>{const i=d(a);s.publish("NetworkController:rpcEndpointDegraded",{chainId:n.chainId,networkClientId:e,primaryEndpointUrl:r,endpointUrl:t,error:i})}),f.onAvailable(()=>{s.publish("NetworkController:rpcEndpointChainAvailable",{chainId:n.chainId,networkClientId:e})}),f.onServiceRetry(({attempt:t,endpointUrl:r,primaryEndpointUrl:a})=>{s.publish("NetworkController:rpcEndpointRetried",{chainId:n.chainId,networkClientId:e,primaryEndpointUrl:a,endpointUrl:r,attempt:t})}),f}({id:e,primaryEndpointUrl:T,configuration:t,getRpcServiceOptions:n,messenger:g,isRpcFailoverEnabled:w,logger:b});let y;y=t.type===f.NetworkClientType.Infura?(0,u.asV2Middleware)((0,i.createInfuraMiddleware)({rpcService:E,options:{source:"metamask"}})):(0,o.createFetchMiddleware)({rpcService:E});const S=(0,l.providerFromMiddlewareV2)(y),I=function({networkClientType:e,endpointUrl:t,getOptions:n,provider:r}){const a={};return new s.PollingBlockTracker({...a,...n(t),provider:r})}({networkClientType:t.type,endpointUrl:T,getOptions:a,provider:S}),k=t.type===f.NetworkClientType.Infura?function({blockTracker:e,network:t,rpcProvider:n,rpcApiMiddleware:r}){return d.JsonRpcEngineV2.create({middleware:[m({network:t}),(0,o.createBlockCacheMiddleware)({blockTracker:e}),(0,o.createInflightCacheMiddleware)(),(0,o.createBlockRefMiddleware)({blockTracker:e,provider:n}),(0,o.createRetryOnEmptyMiddleware)({blockTracker:e,provider:n}),(0,o.createBlockTrackerInspectorMiddleware)({blockTracker:e}),r]}).asMiddleware()}({blockTracker:I,network:t.network,rpcProvider:S,rpcApiMiddleware:y}):function({blockTracker:e,chainId:t,rpcApiMiddleware:n}){const r=[];return d.JsonRpcEngineV2.create({middleware:[...r,p(t),(0,o.createBlockRefRewriteMiddleware)({blockTracker:e}),(0,o.createBlockCacheMiddleware)({blockTracker:e}),(0,o.createInflightCacheMiddleware)(),(0,o.createBlockTrackerInspectorMiddleware)({blockTracker:e}),n]}).asMiddleware()}({blockTracker:I,chainId:t.chainId,rpcApiMiddleware:y});return{configuration:t,provider:new c.InternalProvider({engine:d.JsonRpcEngineV2.create({middleware:[k]})}),blockTracker:I,destroy:()=>{I.destroy()}}};const p=e=>({request:t,next:n})=>"eth_chainId"===t.method?e:n()}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/create-network-client.cjs"}],[3173,{"./NetworkController.cjs":3169,"./constants.cjs":3170,"./rpc-service/rpc-service.cjs":3176,"./types.cjs":3177},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.isConnectionError=n.NetworkClientType=n.RpcEndpointType=n.NetworkController=n.knownKeysOf=n.selectAvailableNetworkClientIds=n.getDefaultNetworkControllerState=void 0;var s=e("./NetworkController.cjs");Object.defineProperty(n,"getDefaultNetworkControllerState",{enumerable:!0,get:function(){return s.getDefaultNetworkControllerState}}),Object.defineProperty(n,"selectAvailableNetworkClientIds",{enumerable:!0,get:function(){return s.selectAvailableNetworkClientIds}}),Object.defineProperty(n,"knownKeysOf",{enumerable:!0,get:function(){return s.knownKeysOf}}),Object.defineProperty(n,"NetworkController",{enumerable:!0,get:function(){return s.NetworkController}}),Object.defineProperty(n,"RpcEndpointType",{enumerable:!0,get:function(){return s.RpcEndpointType}}),a(e("./constants.cjs"),n);var i=e("./types.cjs");Object.defineProperty(n,"NetworkClientType",{enumerable:!0,get:function(){return i.NetworkClientType}});var o=e("./rpc-service/rpc-service.cjs");Object.defineProperty(n,"isConnectionError",{enumerable:!0,get:function(){return o.isConnectionError}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/index.cjs"}],[3174,{"@metamask/utils":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("network-controller")}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/logger.cjs"}],[3175,{"../logger.cjs":3174,"./rpc-service.cjs":3176,"@metamask/controller-utils":1488},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RpcServiceChain=void 0;const d=e("@metamask/controller-utils"),h=e("./rpc-service.cjs"),f=e("../logger.cjs"),m=(0,f.createModuleLogger)(f.projectLogger,"RpcServiceChain"),p="available",g="degraded",w="unknown",b="unavailable";n.RpcServiceChain=class{constructor(e){r.set(this,void 0),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l(this,o,e.map(e=>new h.RpcService(e)),"f"),l(this,i,u(this,o,"f")[0],"f"),l(this,c,w,"f"),l(this,a,new d.CockatielEventEmitter,"f"),l(this,s,new d.CockatielEventEmitter,"f");for(const e of u(this,o,"f"))e.onDegraded(e=>{if(u(this,c,"f")!==g){m('Updating status to "degraded"',e),l(this,c,g,"f");const{endpointUrl:t,...n}=e;u(this,s,"f").emit(n)}});l(this,r,new d.CockatielEventEmitter,"f");for(const e of u(this,o,"f"))e.onAvailable(e=>{if(u(this,c,"f")!==p){m('Updating status to "available"',e),l(this,c,p,"f");const{endpointUrl:t,...n}=e;u(this,r,"f").emit(n)}})}onServiceRetry(e){const t=u(this,o,"f").map(t=>t.onRetry(t=>{e({...t,primaryEndpointUrl:u(this,i,"f").endpointUrl.toString()})}));return{dispose(){t.forEach(e=>e.dispose())}}}onBreak(e){return u(this,a,"f").addListener(e)}onServiceBreak(e){const t=u(this,o,"f").map(t=>t.onBreak(t=>{e({...t,primaryEndpointUrl:u(this,i,"f").endpointUrl.toString()})}));return{dispose(){t.forEach(e=>e.dispose())}}}onDegraded(e){return u(this,s,"f").addListener(e)}onServiceDegraded(e){const t=u(this,o,"f").map(t=>t.onDegraded(t=>{e({...t,primaryEndpointUrl:u(this,i,"f").endpointUrl.toString()})}));return{dispose(){t.forEach(e=>e.dispose())}}}onAvailable(e){return u(this,r,"f").addListener(e)}async request(e,t={}){let n,r;for(const[s,i]of u(this,o,"f").entries()){m(`Trying service #${s+1}...`);const h=i.getCircuitState();try{r=await i.request(e,t),m("Service successfully received request."),n=s;break}catch(e){const{lastError:t}=i,n=i.getCircuitState()===d.CircuitState.Open;if(m("Service failed! error =",e,"lastError = ",t),n){if(s<u(this,o,"f").length-1){m("This service's circuit is open. Proceeding to next service...");continue}h!==d.CircuitState.Open&&u(this,c,"f")!==b&&t!==undefined&&(m('This service\'s circuit just opened and it is the last service. Updating status to "unavailable" and triggering onBreak.'),l(this,c,b,"f"),u(this,a,"f").emit({error:t}))}throw m((n?"":"This service's circuit is closed. ")+"Re-throwing error."),e}}if(r){if(n!==undefined)for(const[e,t]of[...u(this,o,"f").entries()].slice(n+1))m(`Resetting policy for service #${e+1}.`),t.resetPolicy();return r}throw new Error("Nothing to return")}},r=new WeakMap,a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/rpc-service/rpc-service-chain.cjs"}],[3176,{"../logger.cjs":3174,"@metamask/controller-utils":1488,"@metamask/rpc-errors":2692,"@metamask/utils":3207,cockatiel:4236,deepmerge:4329},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.RpcService=n.isConnectionError=n.CUSTOM_RPC_ERRORS=n.CONNECTION_ERRORS=n.DEFAULT_MAX_CONSECUTIVE_FAILURES=n.DEFAULT_MAX_RETRIES=void 0;const m=e("@metamask/controller-utils"),p=e("@metamask/rpc-errors"),g=e("@metamask/utils"),w=(e("cockatiel"),f(e("deepmerge"))),b=e("../logger.cjs"),T=(0,b.createModuleLogger)(b.projectLogger,"RpcService");function E(e){if("object"!=typeof e||null===e||!("message"in e))return!1;const{message:t}=e;return"string"==typeof t&&!function(e){return e.includes("Nock:")}(t)&&n.CONNECTION_ERRORS.some(({constructorName:n,pattern:r})=>e.constructor.name===n&&r.test(t))}function y(e){return e instanceof SyntaxError||/invalid json/iu.test((0,g.getErrorMessage)(e))}n.DEFAULT_MAX_RETRIES=4,n.DEFAULT_MAX_CONSECUTIVE_FAILURES=3*(1+n.DEFAULT_MAX_RETRIES),n.CONNECTION_ERRORS=[{constructorName:"TypeError",pattern:/network error/u},{constructorName:"TypeError",pattern:/Failed to fetch/u},{constructorName:"TypeError",pattern:/NetworkError when attempting to fetch resource\./u},{constructorName:"TypeError",pattern:/The Internet connection appears to be offline\./u},{constructorName:"TypeError",pattern:/Load failed/u},{constructorName:"TypeError",pattern:/Network request failed/u},{constructorName:"FetchError",pattern:/request to (.+) failed/u},{constructorName:"TypeError",pattern:/fetch failed/u},{constructorName:"TypeError",pattern:/terminated/u}],n.CUSTOM_RPC_ERRORS={unauthorized:-32006,httpClientError:-32080},n.isConnectionError=E;n.RpcService=class{constructor(e){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0);const{btoa:t,endpointUrl:l,fetch:u,logger:f,fetchOptions:p={},policyOptions:w={},isOffline:b}=e;d(this,a,u,"f");const T=(S=l)instanceof URL?S:new URL(S);var S;d(this,s,h(this,r,"m",c).call(this,T,p,t),"f"),this.endpointUrl=function(e){const t=new URL(e.toString());return t.username="",t.password="",t}(T),d(this,i,f,"f"),d(this,o,(0,m.createServicePolicy)({maxRetries:n.DEFAULT_MAX_RETRIES,maxConsecutiveFailures:n.DEFAULT_MAX_CONSECUTIVE_FAILURES,...w,retryFilterPolicy:(0,m.handleWhen)(e=>!b()&&(E(e)||y(e)||"httpStatus"in e&&(502===e.httpStatus||503===e.httpStatus||504===e.httpStatus)||(0,g.hasProperty)(e,"code")&&("ETIMEDOUT"===e.code||"ECONNRESET"===e.code)))}),"f")}resetPolicy(){h(this,o,"f").reset()}getCircuitState(){return h(this,o,"f").getCircuitState()}onRetry(e){return h(this,o,"f").onRetry(t=>{e({...t,endpointUrl:this.endpointUrl.toString()})})}onBreak(e){return h(this,o,"f").onBreak(t=>{"isolated"in t||e({...t,endpointUrl:this.endpointUrl.toString()})})}onDegraded(e){return h(this,o,"f").onDegraded(t=>{e({...t??{},endpointUrl:this.endpointUrl.toString()})})}onAvailable(e){return h(this,o,"f").onAvailable(()=>{e({endpointUrl:this.endpointUrl.toString()})})}async request(e,t={}){const n=h(this,r,"m",l).call(this,e,t);return await h(this,r,"m",u).call(this,n)}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,r=new WeakSet,c=function(e,t,n){if(e.username&&e.password){const r=n(`${e.username}:${e.password}`);return(0,w.default)(t,{headers:{Authorization:`Basic ${r}`}})}return t},l=function(e,t){const n=(0,w.default)({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}},(0,w.default)(h(this,s,"f"),t)),{id:r,jsonrpc:a,method:i,params:o}=e;return{...n,body:JSON.stringify({id:r,jsonrpc:a,method:i,params:o})}},u=async function(e){let t;try{T(`[${this.endpointUrl}] Circuit state`,h(this,o,"f").getCircuitState());const n=await h(this,o,"f").execute(async n=>{if(T("REQUEST INITIATED:",this.endpointUrl.toString(),"::",e,`(attempt ${n.attempt+1})`),t=await h(this,a,"f").call(this,this.endpointUrl,e),!t.ok)throw new m.HttpError(t.status);return T("REQUEST SUCCESSFUL:",this.endpointUrl.toString(),t.status),await t.json()});return this.lastError=undefined,n}catch(e){if(T("REQUEST ERROR:",this.endpointUrl.toString(),e),this.lastError=e instanceof Error?e:new Error((0,g.getErrorMessage)(e)),e instanceof m.HttpError){const t=e.httpStatus;if(401===t)throw new p.JsonRpcError(n.CUSTOM_RPC_ERRORS.unauthorized,"Unauthorized.",{httpStatus:t});if(429===t)throw p.rpcErrors.limitExceeded({message:"Request is being rate limited.",data:{httpStatus:t}});if(t>=500||402===t||404===t)throw p.rpcErrors.resourceUnavailable({message:"RPC endpoint not found or unavailable.",data:{httpStatus:t}});throw new p.JsonRpcError(n.CUSTOM_RPC_ERRORS.httpClientError,"RPC endpoint returned HTTP client error.",{httpStatus:t})}if(y(e))throw p.rpcErrors.parse({message:"RPC endpoint did not return JSON."});if(e instanceof m.BrokenCircuitError){h(this,i,"f")?.warn(e);const t=h(this,o,"f").getRemainingCircuitOpenDuration(),n=Intl.NumberFormat(undefined,{maximumFractionDigits:2}).format((t??h(this,o,"f").circuitBreakDuration)/g.Duration.Minute);throw p.rpcErrors.resourceUnavailable({message:`RPC endpoint returned too many errors, retrying in ${n} minutes. Consider using a different RPC endpoint.`})}throw e}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/rpc-service/rpc-service.cjs"}],[3177,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkClientType=void 0,function(e){e.Custom="custom",e.Infura="infura"}(r||(n.NetworkClientType=r={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/types.cjs"}],[3178,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,s=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,f=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,r=1,a=e.length,s=e[0]+"";r<a;){for(t=e[r++]+"",n=l-t.length;n--;t="0"+t);s+=t}for(a=s.length;48===s.charCodeAt(--a););return s.slice(0,a+1||1)}function g(e,t){var n,r,a=e.c,s=t.c,i=e.s,o=t.s,c=e.e,l=t.e;if(!i||!o)return null;if(n=a&&!a[0],r=s&&!s[0],n||r)return n?r?0:-o:i;if(i!=o)return i;if(n=i<0,r=c==l,!a||!s)return r?0:!a^n?1:-1;if(!r)return c>l^n?1:-1;for(o=(c=a.length)<(l=s.length)?c:l,i=0;i<o;i++)if(a[i]!=s[i])return a[i]>s[i]^n?1:-1;return c==l?0:c>l^n?1:-1}function w(e,t,n,r){if(e<t||e>n||e!==s(e))throw Error(i+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function b(e){var t=e.c.length-1;return m(e.e/l)==t&&e.c[t]%2!=0}function T(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function E(e,t,n){var r,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(r=e.length)){for(a=n,t-=r;--t;a+=n);e+=a}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,y,S,I,k,A,C,_,P,v,N=W.prototype={constructor:W,toString:null,valueOf:null},R=new W(1),j=20,O=4,x=-7,L=21,M=-1e7,F=1e7,D=!1,B=1,G=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",q=!0;function W(e,t){var n,a,i,c,d,h,f,m,p=this;if(!(p instanceof W))return new W(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>F?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>F?p.c=p.e=null:(p.e=c,p.c=[e]))}m=String(e)}else{if(!r.test(m=String(e)))return S(p,m,h);p.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(w(t,2,H.length,"Base"),10==t&&q)return Y(p=new W(e),j+p.e+1,O);if(m=String(e),h="number"==typeof e){if(0*e!=0)return S(p,m,h,t);if(p.s=1/e<0?(m=m.slice(1),-1):1,W.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,f=m.length;d<f;d++)if(n.indexOf(a=m.charAt(d))<0){if("."==a){if(d>c){c=f;continue}}else if(!i&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){i=!0,d=-1,c=0;continue}return S(p,String(e),h,t)}h=!1,(c=(m=y(m,t,10,p.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(f=m.length;48===m.charCodeAt(--f););if(m=m.slice(d,++f)){if(f-=d,h&&W.DEBUG&&f>15&&(e>u||e!==s(e)))throw Error(o+p.s*e);if((c=c-d-1)>F)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%l,c<0&&(d+=l),d<f){for(d&&p.c.push(+m.slice(0,d)),f-=l;d<f;)p.c.push(+m.slice(d,d+=l));d=l-(m=m.slice(d)).length}else d-=f;for(;d--;m+="0");p.c.push(+m)}}else p.c=[p.e=0]}function $(e,t,n,r){var a,s,i,o,c;if(null==n?n=O:w(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=p(e.c),c=1==r||2==r&&(i<=x||i>=L)?T(c,i):E(c,i,"0");else if(s=(e=Y(new W(e),t,n)).e,o=(c=p(e.c)).length,1==r||2==r&&(t<=s||s<=x)){for(;o<t;c+="0",o++);c=T(c,s)}else if(t-=i,c=E(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function K(e,t){for(var n,r,a=1,s=new W(e[0]);a<e.length;a++)(!(r=new W(e[a])).s||(n=g(s,r))===t||0===n&&s.s===t)&&(s=r);return s}function V(e,t,n){for(var r=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,r++);return(n=r+n*l-1)>F?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function Y(e,t,n,r){var i,o,u,h,f,m,p,g=e.c,w=d;if(g){e:{for(i=1,h=g[0];h>=10;h/=10,i++);if((o=t-i)<0)o+=l,u=t,f=g[m=0],p=s(f/w[i-u-1]%10);else if((m=a((o+1)/l))>=g.length){if(!r)break e;for(;g.length<=m;g.push(0));f=p=0,i=1,u=(o%=l)-l+1}else{for(f=h=g[m],i=1;h>=10;h/=10,i++);p=(u=(o%=l)-l+i)<0?0:s(f/w[i-u-1]%10)}if(r=r||t<0||null!=g[m+1]||(u<0?f:f%w[i-u-1]),r=n<4?(p||r)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||r||6==n&&(o>0?u>0?f/w[i-u]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,r?(t-=e.e+1,g[0]=w[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,h=1,m--):(g.length=m+1,h=w[l-o],g[m]=u>0?s(f/w[i-u]%w[u])*h:0),r)for(;;){if(0==m){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=h,h=1;u>=10;u/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=h,g[m]!=c)break;g[m--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>F?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function z(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=x||n>=L?T(t,n):E(t,n,"0"),e.s<0?"-"+t:t)}return W.clone=e,W.ROUND_UP=0,W.ROUND_DOWN=1,W.ROUND_CEIL=2,W.ROUND_FLOOR=3,W.ROUND_HALF_UP=4,W.ROUND_HALF_DOWN=5,W.ROUND_HALF_EVEN=6,W.ROUND_HALF_CEIL=7,W.ROUND_HALF_FLOOR=8,W.EUCLID=9,W.config=W.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(w(n=e[t],0,f,t),j=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(w(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(w(n[0],-f,0,t),w(n[1],0,f,t),x=n[0],L=n[1]):(w(n,-f,f,t),x=-(L=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)w(n[0],-f,-1,t),w(n[1],1,f,t),M=n[0],F=n[1];else{if(w(n,-f,f,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(F=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw D=!n,Error(i+"crypto unavailable");D=n}else D=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(w(n=e[t],0,9,t),B=n),e.hasOwnProperty(t="POW_PRECISION")&&(w(n=e[t],0,f,t),G=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);q="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:j,ROUNDING_MODE:O,EXPONENTIAL_AT:[x,L],RANGE:[M,F],CRYPTO:D,MODULO_MODE:B,POW_PRECISION:G,FORMAT:U,ALPHABET:H}},W.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!W.DEBUG)return!0;var t,n,r=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&a>=-f&&a<=f&&a===s(a)){if(0===r[0]){if(0===a&&1===r.length)return!0;break e}if((t=(a+1)%l)<1&&(t+=l),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=c||n!==s(n))break e;if(0!==n)return!0}}}else if(null===r&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},W.maximum=W.max=function(){return K(arguments,-1)},W.minimum=W.min=function(){return K(arguments,1)},W.random=(I=9007199254740992,k=Math.random()*I&2097151?function(){return s(Math.random()*I)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,o,c,u=0,h=[],m=new W(R);if(null==e?e=j:w(e,0,f),o=a(e/l),D)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(h.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw D=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=o/7}if(!D)for(;u<o;)(c=k())<9e15&&(h[u++]=c%1e14);for(o=h[--u],e%=l,o&&e&&(c=d[l-e],h[u]=s(o/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[r=0];else{for(r=-1;0===h[0];h.splice(0,1),r-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(r-=l-u)}return m.e=r,m.c=h,m}),W.sum=function(){for(var e=1,t=arguments,n=new W(t[0]);e<t.length;)n=n.plus(t[e++]);return n},y=function(){var e="0123456789";function t(e,t,n,r){for(var a,s,i=[0],o=0,c=e.length;o<c;){for(s=i.length;s--;i[s]*=t);for(i[0]+=r.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(r,a,s,i,o){var c,l,u,d,h,f,m,g,w=r.indexOf("."),b=j,T=O;for(w>=0&&(d=G,G=0,r=r.replace(".",""),f=(g=new W(a)).pow(r.length-w),G=d,g.c=t(E(p(f.c),f.e,"0"),10,s,e),g.e=g.c.length),u=d=(m=t(r,a,s,o?(c=H,e):(c=e,H))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(w<0?--u:(f.c=m,f.e=u,f.s=i,m=(f=n(f,g,b,T,s)).c,h=f.r,u=f.e),w=m[l=u+b+1],d=s/2,h=h||l<0||null!=m[l+1],h=T<4?(null!=w||h)&&(0==T||T==(f.s<0?3:2)):w>d||w==d&&(4==T||h||6==T&&1&m[l-1]||T==(f.s<0?8:7)),l<1||!m[0])r=h?E(c.charAt(1),-b,c.charAt(0)):c.charAt(0);else{if(m.length=l,h)for(--s;++m[--l]>s;)m[l]=0,l||(++u,m=[1].concat(m));for(d=m.length;!m[--d];);for(w=0,r="";w<=d;r+=c.charAt(m[w++]));r=E(r,u,c.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,a,s,i,o=0,c=e.length,l=t%h,u=t/h|0;for(e=e.slice();c--;)o=((a=l*(s=e[c]%h)+(r=u*s+(i=e[c]/h|0)*l)%h*h+o)/n|0)+(r/h|0)+u*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,r){var a,s;if(n!=r)s=n>r?1:-1;else for(a=s=0;a<n;a++)if(e[a]!=t[a]){s=e[a]>t[a]?1:-1;break}return s}function n(e,t,n,r){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,a,i,o,u){var d,h,f,p,g,w,b,T,E,y,S,I,k,A,C,_,P,v=r.s==a.s?1:-1,N=r.c,R=a.c;if(!(N&&N[0]&&R&&R[0]))return new W(r.s&&a.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*v:v/0:NaN);for(E=(T=new W(v)).c=[],v=i+(h=r.e-a.e)+1,u||(u=c,h=m(r.e/l)-m(a.e/l),v=v/l|0),f=0;R[f]==(N[f]||0);f++);if(R[f]>(N[f]||0)&&h--,v<0)E.push(1),p=!0;else{for(A=N.length,_=R.length,f=0,v+=2,(g=s(u/(R[0]+1)))>1&&(R=e(R,g,u),N=e(N,g,u),_=R.length,A=N.length),k=_,S=(y=N.slice(0,_)).length;S<_;y[S++]=0);P=R.slice(),P=[0].concat(P),C=R[0],R[1]>=u/2&&C++;do{if(g=0,(d=t(R,y,_,S))<0){if(I=y[0],_!=S&&(I=I*u+(y[1]||0)),(g=s(I/C))>1)for(g>=u&&(g=u-1),b=(w=e(R,g,u)).length,S=y.length;1==t(w,y,b,S);)g--,n(w,_<b?P:R,b,u),b=w.length,d=1;else 0==g&&(d=g=1),b=(w=R.slice()).length;if(b<S&&(w=[0].concat(w)),n(y,w,S,u),S=y.length,-1==d)for(;t(R,y,_,S)<1;)g++,n(y,_<S?P:R,S,u),S=y.length}else 0===d&&(g++,y=[0]);E[f++]=g,y[0]?y[S++]=N[k]||0:(y=[N[k]],S=1)}while((k++<A||null!=y[0])&&v--);p=null!=y[0],E[0]||E.splice(0,1)}if(u==c){for(f=1,v=E[0];v>=10;v/=10,f++);Y(T,i+(T.e=f+h*l-1)+1,o,p)}else T.e=h,T.r=+p;return T}}(),A=/^(-?)0([xbo])(?=\w[\w.]*$)/i,C=/^([^.]+)\.$/,_=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,n,r){var a,s=n?t:t.replace(v,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!n&&(s=s.replace(A,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=a?e:t}),r&&(a=r,s=s.replace(C,"$1").replace(_,"0.$1")),t!=s))return new W(s,a);if(W.DEBUG)throw Error(i+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new W(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return g(this,new W(e,t))},N.decimalPlaces=N.dp=function(e,t){var n,r,a,s=this;if(null!=e)return w(e,0,f),null==t?t=O:w(t,0,8),Y(new W(s),e+s.e+1,t);if(!(n=s.c))return null;if(r=((a=n.length-1)-m(this.e/l))*l,a=n[a])for(;a%10==0;a/=10,r--);return r<0&&(r=0),r},N.dividedBy=N.div=function(e,t){return n(this,new W(e,t),j,O)},N.dividedToIntegerBy=N.idiv=function(e,t){return n(this,new W(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var n,r,o,c,u,d,h,f,m=this;if((e=new W(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+z(e));if(null!=t&&(t=new W(t)),u=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return f=new W(Math.pow(+z(m),u?e.s*(2-b(e)):+z(e))),t?f.mod(t):f;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new W(NaN);(r=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||u&&m.c[1]>=24e7:m.c[0]<8e13||u&&m.c[0]<=9999975e7)))return c=m.s<0&&b(e)?-0:0,m.e>-1&&(c=1/c),new W(d?1/c:c);G&&(c=a(G/l+2))}for(u?(n=new W(.5),d&&(e.s=1),h=b(e)):h=(o=Math.abs(+z(e)))%2,f=new W(R);;){if(h){if(!(f=f.times(m)).c)break;c?f.c.length>c&&(f.c.length=c):r&&(f=f.mod(t))}if(o){if(0===(o=s(o/2)))break;h=o%2}else if(Y(e=e.times(n),e.e+1,1),e.e>14)h=b(e);else{if(0===(o=+z(e)))break;h=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):r&&(m=m.mod(t))}return r?f:(d&&(f=R.div(f)),t?f.mod(t):c?Y(f,G,O,undefined):f)},N.integerValue=function(e){var t=new W(this);return null==e?e=O:w(e,0,8),Y(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===g(this,new W(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return g(this,new W(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=g(this,new W(e,t)))||0===t},N.isInteger=function(){return!!this.c&&m(this.e/l)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return g(this,new W(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=g(this,new W(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var n,r,a,s,i=this,o=i.s;if(t=(e=new W(e,t)).s,!o||!t)return new W(NaN);if(o!=t)return e.s=-t,i.plus(e);var u=i.e/l,d=e.e/l,h=i.c,f=e.c;if(!u||!d){if(!h||!f)return h?(e.s=-t,e):new W(f?i:NaN);if(!h[0]||!f[0])return f[0]?(e.s=-t,e):new W(h[0]?i:3==O?-0:0)}if(u=m(u),d=m(d),h=h.slice(),o=u-d){for((s=o<0)?(o=-o,a=h):(d=u,a=f),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(r=(s=(o=h.length)<(t=f.length))?o:t,o=t=0;t<r;t++)if(h[t]!=f[t]){s=h[t]<f[t];break}if(s&&(a=h,h=f,f=a,e.s=-e.s),(t=(r=f.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;r>o;){if(h[--r]<f[r]){for(n=r;n&&!h[--n];h[n]=t);--h[n],h[r]+=c}h[r]-=f[r]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var r,a,s=this;return e=new W(e,t),!s.c||!e.s||e.c&&!e.c[0]?new W(NaN):!e.c||s.c&&!s.c[0]?new W(s):(9==B?(a=e.s,e.s=1,r=n(s,e,0,3),e.s=a,r.s*=a):r=n(s,e,0,B),(e=s.minus(r.times(e))).c[0]||1!=B||(e.s=s.s),e)},N.multipliedBy=N.times=function(e,t){var n,r,a,s,i,o,u,d,f,p,g,w,b,T,E,y=this,S=y.c,I=(e=new W(e,t)).c;if(!(S&&I&&S[0]&&I[0]))return!y.s||!e.s||S&&!S[0]&&!I||I&&!I[0]&&!S?e.c=e.e=e.s=null:(e.s*=y.s,S&&I?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=m(y.e/l)+m(e.e/l),e.s*=y.s,(u=S.length)<(p=I.length)&&(b=S,S=I,I=b,a=u,u=p,p=a),a=u+p,b=[];a--;b.push(0));for(T=c,E=h,a=p;--a>=0;){for(n=0,g=I[a]%E,w=I[a]/E|0,s=a+(i=u);s>a;)n=((d=g*(d=S[--i]%E)+(o=w*d+(f=S[i]/E|0)*g)%E*E+b[s]+n)/T|0)+(o/E|0)+w*f,b[s--]=d%T;b[s]=n}return n?++r:b.splice(0,1),V(e,b,r)},N.negated=function(){var e=new W(this);return e.s=-e.s||null,e},N.plus=function(e,t){var n,r=this,a=r.s;if(t=(e=new W(e,t)).s,!a||!t)return new W(NaN);if(a!=t)return e.s=-t,r.minus(e);var s=r.e/l,i=e.e/l,o=r.c,u=e.c;if(!s||!i){if(!o||!u)return new W(a/0);if(!o[0]||!u[0])return u[0]?e:new W(o[0]?r:0*a)}if(s=m(s),i=m(i),o=o.slice(),a=s-i){for(a>0?(i=s,n=u):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+u[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),V(e,o,i)},N.precision=N.sd=function(e,t){var n,r,a,s=this;if(null!=e&&e!==!!e)return w(e,1,f),null==t?t=O:w(t,0,8),Y(new W(s),e,t);if(!(n=s.c))return null;if(r=(a=n.length-1)*l+1,a=n[a]){for(;a%10==0;a/=10,r--);for(a=n[0];a>=10;a/=10,r++);}return e&&s.e+1>r&&(r=s.e+1),r},N.shiftedBy=function(e){return w(e,-9007199254740991,u),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,r,a,s,i=this,o=i.c,c=i.s,l=i.e,u=j+4,d=new W("0.5");if(1!==c||!o||!o[0])return new W(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+z(i)))||c==1/0?(((t=p(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=m((l+1)/2)-(l<0||l%2),r=new W(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):r=new W(c+""),r.c[0])for((c=(l=r.e)+u)<3&&(c=0);;)if(s=r,r=d.times(s.plus(n(i,s,u,1))),p(s.c).slice(0,c)===(t=p(r.c)).slice(0,c)){if(r.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(Y(r,r.e+j+2,1),e=!r.times(r).eq(i));break}if(!a&&(Y(s,s.e+j+2,0),s.times(s).eq(i))){r=s;break}u+=4,c+=4,a=1}return Y(r,r.e+j+1,O,e)},N.toExponential=function(e,t){return null!=e&&(w(e,0,f),e++),$(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(w(e,0,f),e=e+this.e+1),$(this,e,t)},N.toFormat=function(e,t,n){var r,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(r=a.toFixed(e,t),a.c){var s,o=r.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],h=o[1],f=a.s<0,m=f?d.slice(1):d,p=m.length;if(l&&(s=c,c=l,l=s,p-=s),c>0&&p>0){for(s=p%c||c,d=m.substr(0,s);s<p;s+=c)d+=u+m.substr(s,c);l>0&&(d+=u+m.slice(s)),f&&(d="-"+d)}r=h?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+r+(n.suffix||"")},N.toFraction=function(e){var t,r,a,s,o,c,u,h,f,m,g,w,b=this,T=b.c;if(null!=e&&(!(u=new W(e)).isInteger()&&(u.c||1!==u.s)||u.lt(R)))throw Error(i+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+z(u));if(!T)return new W(b);for(t=new W(R),f=r=new W(R),a=h=new W(R),w=p(T),o=t.e=w.length-b.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:f:u,c=F,F=1/0,u=new W(w),h.c[0]=0;m=n(u,t,0,1),1!=(s=r.plus(m.times(a))).comparedTo(e);)r=a,a=s,f=h.plus(m.times(s=f)),h=s,t=u.minus(m.times(s=t)),u=s;return s=n(e.minus(r),a,0,1),h=h.plus(s.times(f)),r=r.plus(s.times(a)),h.s=f.s=b.s,g=n(f,a,o*=2,O).minus(b).abs().comparedTo(n(h,r,o,O).minus(b).abs())<1?[f,a]:[h,r],F=c,g},N.toNumber=function(){return+z(this)},N.toPrecision=function(e,t){return null!=e&&w(e,1,f),$(this,e,t,2)},N.toString=function(e){var t,n=this,r=n.s,a=n.e;return null===a?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=a<=x||a>=L?T(p(n.c),a):E(p(n.c),a,"0"):10===e&&q?t=E(p((n=Y(new W(n),j+a+1,O)).c),n.e,"0"):(w(e,2,H.length,"Base"),t=y(E(p(n.c),a,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return z(this)},N._isBigNumber=!0,null!=t&&W.set(t),W}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/transaction-pay-controller>bignumber.js",file:"node_modules/@metamask/transaction-pay-controller/node_modules/bignumber.js/bignumber.js"}],[3196,{"./errors.cjs":3204,"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.assertExhaustive=n.assertStruct=n.assert=n.AssertionError=void 0;const r=e("@metamask/superstruct"),a=e("./errors.cjs");function s(e,t){return n=e,Boolean("string"==typeof n?.prototype?.constructor?.name)?new e({message:t}):e({message:t});var n}class i extends Error{constructor(e){super(e.message),this.code="ERR_ASSERTION"}}n.AssertionError=i,n.assert=function(e,t="Assertion failed.",n=i){if(!e){if(t instanceof Error)throw t;throw s(n,t)}},n.assertStruct=function(e,t,n="Assertion failed",o=i){try{(0,r.assert)(e,t)}catch(e){throw s(o,`${n}: ${function(e){return(0,a.getErrorMessage)(e).replace(/\.$/u,"")}(e)}.`)}},n.assertExhaustive=function(e){throw new Error("Invalid branch reached. Should be detected during compilation.")}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/assert.cjs"}],[3197,{"./assert.cjs":3196,"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.base64=void 0;const r=e("@metamask/superstruct"),a=e("./assert.cjs");n.base64=(e,t={})=>{const n=t.paddingRequired??!1,s=t.characterSet??"base64";let i,o;return"base64"===s?i=String.raw`[A-Za-z0-9+\/]`:((0,a.assert)("base64url"===s),i=String.raw`[-_A-Za-z0-9]`),o=n?new RegExp(`^(?:${i}{4})*(?:${i}{3}=|${i}{2}==)?$`,"u"):new RegExp(`^(?:${i}{4})*(?:${i}{2,3}|${i}{3}=|${i}{2}==)?$`,"u"),(0,r.pattern)(e,o)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/base64.cjs"}],[3198,{"./assert.cjs":3196,"./hex.cjs":3206,"@scure/base":3287,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.areUint8ArraysEqual=n.createDataView=n.concatBytes=n.valueToBytes=n.base64ToBytes=n.stringToBytes=n.numberToBytes=n.signedBigIntToBytes=n.bigIntToBytes=n.hexToBytes=n.bytesToBase64=n.bytesToString=n.bytesToNumber=n.bytesToSignedBigInt=n.bytesToBigInt=n.bytesToHex=n.assertIsBytes=n.isBytes=void 0;const r=e("@scure/base"),a=e("./assert.cjs"),s=e("./hex.cjs");const i=function(){const e=[];return()=>{if(0===e.length)for(let t=0;t<256;t++)e.push(t.toString(16).padStart(2,"0"));return e}}();function o(e){return e instanceof Uint8Array}function c(e){(0,a.assert)(o(e),"Value must be a Uint8Array.")}function l(e){if(c(e),0===e.length)return"0x";const t=i(),n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return(0,s.add0x)(n.join(""))}function u(e){c(e);const t=l(e);return BigInt(t)}function d(e){if("0x"===e?.toLowerCase?.())return new Uint8Array;(0,s.assertIsHexString)(e);const t=(0,s.remove0x)(e).toLowerCase(),n=t.length%2==0?t:`0${t}`,r=new Uint8Array(n.length/2);for(let e=0;e<r.length;e++){const t=n.charCodeAt(2*e),a=n.charCodeAt(2*e+1),s=t-(t<58?48:87),i=a-(a<58?48:87);r[e]=16*s+i}return r}function h(e){(0,a.assert)("bigint"==typeof e,"Value must be a bigint."),(0,a.assert)(e>=BigInt(0),"Value must be a non-negative bigint.");return d(e.toString(16))}function f(e){(0,a.assert)("number"==typeof e,"Value must be a number."),(0,a.assert)(e>=0,"Value must be a non-negative number."),(0,a.assert)(Number.isSafeInteger(e),"Value is not a safe integer. Use `bigIntToBytes` instead.");return d(e.toString(16))}function m(e){return(0,a.assert)("string"==typeof e,"Value must be a string."),(new TextEncoder).encode(e)}function p(e){if("bigint"==typeof e)return h(e);if("number"==typeof e)return f(e);if("string"==typeof e)return e.startsWith("0x")?d(e):m(e);if(o(e))return e;throw new TypeError(`Unsupported value type: "${typeof e}".`)}n.isBytes=o,n.assertIsBytes=c,n.bytesToHex=l,n.bytesToBigInt=u,n.bytesToSignedBigInt=function(e){c(e);let t=BigInt(0);for(const n of e)t=(t<<BigInt(8))+BigInt(n);return BigInt.asIntN(8*e.length,t)},n.bytesToNumber=function(e){c(e);const t=u(e);return(0,a.assert)(t<=BigInt(Number.MAX_SAFE_INTEGER),"Number is not a safe integer. Use `bytesToBigInt` instead."),Number(t)},n.bytesToString=function(e){return c(e),(new TextDecoder).decode(e)},n.bytesToBase64=function(e){return c(e),r.base64.encode(e)},n.hexToBytes=d,n.bigIntToBytes=h,n.signedBigIntToBytes=function(e,t){(0,a.assert)("bigint"==typeof e,"Value must be a bigint."),(0,a.assert)("number"==typeof t,"Byte length must be a number."),(0,a.assert)(t>0,"Byte length must be greater than 0."),(0,a.assert)(function(e,t){(0,a.assert)(t>0);const n=e>>BigInt(31);return!((~e&n)+(e&~n)>>BigInt(8*t-1))}(e,t),"Byte length is too small to represent the given value.");let n=e;const r=new Uint8Array(t);for(let e=0;e<r.length;e++)r[e]=Number(BigInt.asUintN(8,n)),n>>=BigInt(8);return r.reverse()},n.numberToBytes=f,n.stringToBytes=m,n.base64ToBytes=function(e){return(0,a.assert)("string"==typeof e,"Value must be a string."),r.base64.decode(e)},n.valueToBytes=p,n.concatBytes=function(e){const t=new Array(e.length);let n=0;for(let r=0;r<e.length;r++){const a=p(e[r]);t[r]=a,n+=a.length}const r=new Uint8Array(n);for(let e=0,n=0;e<t.length;e++)r.set(t[e],n),n+=t[e].length;return r},n.createDataView=function(e){if(void 0!==t&&e instanceof t){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return new DataView(t)}return new DataView(e.buffer,e.byteOffset,e.byteLength)},n.areUint8ArraysEqual=function(e,t){let n=e.byteLength^t.byteLength;const r=Math.max(e.byteLength,t.byteLength);for(let a=0;a<r;a++){n|=(e[a]??0)^(t[a]??0)}return 0===n}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/bytes.cjs"}],[3199,{"./superstruct.cjs":3215},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toCaipAssetId=n.toCaipAssetType=n.toCaipAccountId=n.toCaipChainId=n.parseCaipAssetId=n.parseCaipAssetType=n.parseCaipAccountId=n.parseCaipChainId=n.isCaipAssetId=n.isCaipAssetType=n.isCaipTokenId=n.isCaipAssetReference=n.isCaipAssetNamespace=n.isCaipAccountAddress=n.isCaipAccountId=n.isCaipReference=n.isCaipNamespace=n.isCaipChainId=n.KnownCaipNamespace=n.CaipAssetTypeOrIdStruct=n.CaipAssetIdStruct=n.CaipAssetTypeStruct=n.CaipTokenIdStruct=n.CaipAssetReferenceStruct=n.CaipAssetNamespaceStruct=n.CaipAccountAddressStruct=n.CaipAccountIdStruct=n.CaipReferenceStruct=n.CaipNamespaceStruct=n.CaipChainIdStruct=n.CAIP_ASSET_ID_REGEX=n.CAIP_ASSET_TYPE_REGEX=n.CAIP_TOKEN_ID_REGEX=n.CAIP_ASSET_REFERENCE_REGEX=n.CAIP_ASSET_NAMESPACE_REGEX=n.CAIP_ACCOUNT_ADDRESS_REGEX=n.CAIP_ACCOUNT_ID_REGEX=n.CAIP_REFERENCE_REGEX=n.CAIP_NAMESPACE_REGEX=n.CAIP_CHAIN_ID_REGEX=void 0;const r=e("./superstruct.cjs");n.CAIP_CHAIN_ID_REGEX=/^(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32})$/u,n.CAIP_NAMESPACE_REGEX=/^[-a-z0-9]{3,8}$/u,n.CAIP_REFERENCE_REGEX=/^[-_a-zA-Z0-9]{1,32}$/u,n.CAIP_ACCOUNT_ID_REGEX=/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32})):(?<accountAddress>[-.%a-zA-Z0-9]{1,128})$/u,n.CAIP_ACCOUNT_ADDRESS_REGEX=/^[-.%a-zA-Z0-9]{1,128}$/u,n.CAIP_ASSET_NAMESPACE_REGEX=/^[-a-z0-9]{3,8}$/u,n.CAIP_ASSET_REFERENCE_REGEX=/^[-.%a-zA-Z0-9]{1,128}$/u,n.CAIP_TOKEN_ID_REGEX=/^[-.%a-zA-Z0-9]{1,78}$/u,n.CAIP_ASSET_TYPE_REGEX=/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32}))\/(?<assetNamespace>[-a-z0-9]{3,8}):(?<assetReference>[-.%a-zA-Z0-9]{1,128})$/u,n.CAIP_ASSET_ID_REGEX=/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32}))\/(?<assetNamespace>[-a-z0-9]{3,8}):(?<assetReference>[-.%a-zA-Z0-9]{1,128})\/(?<tokenId>[-.%a-zA-Z0-9]{1,78})$/u;function a(e){return"string"==typeof e&&n.CAIP_NAMESPACE_REGEX.test(e)}function s(e){return"string"==typeof e&&n.CAIP_REFERENCE_REGEX.test(e)}function i(e){return"string"==typeof e&&n.CAIP_ACCOUNT_ADDRESS_REGEX.test(e)}function o(e){return"string"==typeof e&&n.CAIP_ASSET_NAMESPACE_REGEX.test(e)}function c(e){return"string"==typeof e&&n.CAIP_ASSET_REFERENCE_REGEX.test(e)}function l(e){return"string"==typeof e&&n.CAIP_TOKEN_ID_REGEX.test(e)}n.CaipChainIdStruct=(0,r.definePattern)("CaipChainId",n.CAIP_CHAIN_ID_REGEX),n.CaipNamespaceStruct=(0,r.definePattern)("CaipNamespace",n.CAIP_NAMESPACE_REGEX),n.CaipReferenceStruct=(0,r.definePattern)("CaipReference",n.CAIP_REFERENCE_REGEX),n.CaipAccountIdStruct=(0,r.definePattern)("CaipAccountId",n.CAIP_ACCOUNT_ID_REGEX),n.CaipAccountAddressStruct=(0,r.definePattern)("CaipAccountAddress",n.CAIP_ACCOUNT_ADDRESS_REGEX),n.CaipAssetNamespaceStruct=(0,r.definePattern)("CaipAssetNamespace",n.CAIP_ASSET_NAMESPACE_REGEX),n.CaipAssetReferenceStruct=(0,r.definePattern)("CaipAssetReference",n.CAIP_ASSET_REFERENCE_REGEX),n.CaipTokenIdStruct=(0,r.definePattern)("CaipTokenId",n.CAIP_TOKEN_ID_REGEX),n.CaipAssetTypeStruct=(0,r.definePattern)("CaipAssetType",n.CAIP_ASSET_TYPE_REGEX),n.CaipAssetIdStruct=(0,r.definePattern)("CaipAssetId",n.CAIP_ASSET_ID_REGEX),n.CaipAssetTypeOrIdStruct=(0,r.definePattern)("CaipAssetTypeOrId",/^(?<chainId>(?<namespace>[-a-z0-9]{3,8}):(?<reference>[-_a-zA-Z0-9]{1,32}))\/(?<assetNamespace>[-a-z0-9]{3,8}):(?<assetReference>[-.%a-zA-Z0-9]{1,128})(\/(?<tokenId>[-.%a-zA-Z0-9]{1,78}))?$/u),function(e){e.Bip122="bip122",e.Solana="solana",e.Tron="tron",e.Eip155="eip155",e.Wallet="wallet"}(n.KnownCaipNamespace||(n.KnownCaipNamespace={})),n.isCaipChainId=function(e){return"string"==typeof e&&n.CAIP_CHAIN_ID_REGEX.test(e)},n.isCaipNamespace=a,n.isCaipReference=s,n.isCaipAccountId=function(e){return"string"==typeof e&&n.CAIP_ACCOUNT_ID_REGEX.test(e)},n.isCaipAccountAddress=i,n.isCaipAssetNamespace=o,n.isCaipAssetReference=c,n.isCaipTokenId=l,n.isCaipAssetType=function(e){return"string"==typeof e&&n.CAIP_ASSET_TYPE_REGEX.test(e)},n.isCaipAssetId=function(e){return"string"==typeof e&&n.CAIP_ASSET_ID_REGEX.test(e)},n.parseCaipChainId=function(e){const t=n.CAIP_CHAIN_ID_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP chain ID.");return{namespace:t.groups.namespace,reference:t.groups.reference}},n.parseCaipAccountId=function(e){const t=n.CAIP_ACCOUNT_ID_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP account ID.");return{address:t.groups.accountAddress,chainId:t.groups.chainId,chain:{namespace:t.groups.namespace,reference:t.groups.reference}}},n.parseCaipAssetType=function(e){const t=n.CAIP_ASSET_TYPE_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP asset type.");return{assetNamespace:t.groups.assetNamespace,assetReference:t.groups.assetReference,chainId:t.groups.chainId,chain:{namespace:t.groups.namespace,reference:t.groups.reference}}},n.parseCaipAssetId=function(e){const t=n.CAIP_ASSET_ID_REGEX.exec(e);if(!t?.groups)throw new Error("Invalid CAIP asset ID.");return{assetNamespace:t.groups.assetNamespace,assetReference:t.groups.assetReference,tokenId:t.groups.tokenId,chainId:t.groups.chainId,chain:{namespace:t.groups.namespace,reference:t.groups.reference}}},n.toCaipChainId=function(e,t){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!s(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);return`${e}:${t}`},n.toCaipAccountId=function(e,t,r){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!s(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);if(!i(r))throw new Error(`Invalid "accountAddress", must match: ${n.CAIP_ACCOUNT_ADDRESS_REGEX.toString()}`);return`${e}:${t}:${r}`},n.toCaipAssetType=function(e,t,r,i){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!s(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);if(!o(r))throw new Error(`Invalid "assetNamespace", must match: ${n.CAIP_ASSET_NAMESPACE_REGEX.toString()}`);if(!c(i))throw new Error(`Invalid "assetReference", must match: ${n.CAIP_ASSET_REFERENCE_REGEX.toString()}`);return`${e}:${t}/${r}:${i}`},n.toCaipAssetId=function(e,t,r,i,u){if(!a(e))throw new Error(`Invalid "namespace", must match: ${n.CAIP_NAMESPACE_REGEX.toString()}`);if(!s(t))throw new Error(`Invalid "reference", must match: ${n.CAIP_REFERENCE_REGEX.toString()}`);if(!o(r))throw new Error(`Invalid "assetNamespace", must match: ${n.CAIP_ASSET_NAMESPACE_REGEX.toString()}`);if(!c(i))throw new Error(`Invalid "assetReference", must match: ${n.CAIP_ASSET_REFERENCE_REGEX.toString()}`);if(!l(u))throw new Error(`Invalid "tokenId", must match: ${n.CAIP_TOKEN_ID_REGEX.toString()}`);return`${e}:${t}/${r}:${i}/${u}`}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/caip-types.cjs"}],[3200,{"./base64.cjs":3197,"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ChecksumStruct=void 0;const r=e("@metamask/superstruct"),a=e("./base64.cjs");n.ChecksumStruct=(0,r.size)((0,a.base64)((0,r.string)(),{paddingRequired:!0}),44,44)}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/checksum.cjs"}],[3201,{"./assert.cjs":3196,"./bytes.cjs":3198,"./hex.cjs":3206,"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createHex=n.createBytes=n.createBigInt=n.createNumber=void 0;const r=e("@metamask/superstruct"),a=e("./assert.cjs"),s=e("./bytes.cjs"),i=e("./hex.cjs"),o=(0,r.union)([(0,r.number)(),(0,r.bigint)(),(0,r.string)(),i.StrictHexStruct]),c=(0,r.coerce)((0,r.number)(),o,Number),l=(0,r.coerce)((0,r.bigint)(),o,BigInt),u=((0,r.union)([i.StrictHexStruct,(0,r.instance)(Uint8Array)]),(0,r.coerce)((0,r.instance)(Uint8Array),(0,r.union)([i.StrictHexStruct]),s.hexToBytes)),d=(0,r.coerce)(i.StrictHexStruct,(0,r.instance)(Uint8Array),s.bytesToHex);n.createNumber=function(e){try{const t=(0,r.create)(e,c);return(0,a.assert)(Number.isFinite(t),`Expected a number-like value, got "${e}".`),t}catch(t){if(t instanceof r.StructError)throw new Error(`Expected a number-like value, got "${e}".`);throw t}},n.createBigInt=function(e){try{return(0,r.create)(e,l)}catch(e){if(e instanceof r.StructError)throw new Error(`Expected a number-like value, got "${String(e.value)}".`);throw e}},n.createBytes=function(e){if("string"==typeof e&&"0x"===e.toLowerCase())return new Uint8Array;try{return(0,r.create)(e,u)}catch(e){if(e instanceof r.StructError)throw new Error(`Expected a bytes-like value, got "${String(e.value)}".`);throw e}},n.createHex=function(e){if(e instanceof Uint8Array&&0===e.length||"string"==typeof e&&"0x"===e.toLowerCase())return"0x";try{return(0,r.create)(e,d)}catch(e){if(e instanceof r.StructError)throw new Error(`Expected a bytes-like value, got "${String(e.value)}".`);throw e}}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/coercers.cjs"}],[3202,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},i=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.FrozenSet=n.FrozenMap=void 0;class o{get size(){return s(this,r,"f").size}[(r=new WeakMap,Symbol.iterator)](){return s(this,r,"f")[Symbol.iterator]()}constructor(e){r.set(this,void 0),i(this,r,new Map(e),"f"),Object.freeze(this)}entries(){return s(this,r,"f").entries()}forEach(e,t){return s(this,r,"f").forEach((n,r,a)=>e.call(t,n,r,this))}get(e){return s(this,r,"f").get(e)}has(e){return s(this,r,"f").has(e)}keys(){return s(this,r,"f").keys()}values(){return s(this,r,"f").values()}toString(){return`FrozenMap(${this.size}) {${this.size>0?` ${[...this.entries()].map(([e,t])=>`${String(e)} => ${String(t)}`).join(", ")} `:""}}`}}n.FrozenMap=o;class c{get size(){return s(this,a,"f").size}[(a=new WeakMap,Symbol.iterator)](){return s(this,a,"f")[Symbol.iterator]()}constructor(e){a.set(this,void 0),i(this,a,new Set(e),"f"),Object.freeze(this)}entries(){return s(this,a,"f").entries()}forEach(e,t){return s(this,a,"f").forEach((n,r,a)=>e.call(t,n,r,this))}has(e){return s(this,a,"f").has(e)}keys(){return s(this,a,"f").keys()}values(){return s(this,a,"f").values()}toString(){return`FrozenSet(${this.size}) {${this.size>0?` ${[...this.values()].map(e=>String(e)).join(", ")} `:""}}`}}n.FrozenSet=c,Object.freeze(o),Object.freeze(o.prototype),Object.freeze(c),Object.freeze(c.prototype)}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/collections.cjs"}],[3203,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/encryption-types.cjs"}],[3204,{"./misc.cjs":3211,"pony-cause":5185},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.wrapError=n.getErrorMessage=n.isErrorWithStack=n.isErrorWithMessage=n.isErrorWithCode=void 0;const r=e("pony-cause"),a=e("./misc.cjs");function s(e){return"object"==typeof e&&null!==e&&"code"in e}function i(e){return"object"==typeof e&&null!==e&&"message"in e}n.isErrorWithCode=s,n.isErrorWithMessage=i,n.isErrorWithStack=function(e){return"object"==typeof e&&null!==e&&"stack"in e},n.getErrorMessage=function(e){return i(e)&&"string"==typeof e.message?e.message:(0,a.isNullOrUndefined)(e)?"":String(e)},n.wrapError=function(e,t){if((n=e)instanceof Error||(0,a.isObject)(n)&&"Error"===n.constructor.name){let n;return n=2===Error.length?new Error(t,{cause:e}):new r.ErrorWithCause(t,{cause:e}),s(e)&&(n.code=e.code),n}var n;return t.length>0?new Error(`${String(e)}: ${t}`):new Error(String(e))}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/errors.cjs"}],[3205,{"@noble/hashes/sha256":3261},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sha256=void 0;const r=e("@noble/hashes/sha256");n.sha256=async function(e){return"crypto"in globalThis&&"object"==typeof globalThis.crypto&&globalThis.crypto.subtle?.digest?new Uint8Array(await globalThis.crypto.subtle.digest("SHA-256",e)):(0,r.sha256)(e)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/hashing.cjs"}],[3206,{"./assert.cjs":3196,"@metamask/superstruct":3027,"@noble/hashes/sha3":3262,lodash:4940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.remove0x=n.add0x=n.isValidHexAddress=n.isValidHexAddressUnmemoized=n.isValidChecksumAddress=n.isValidChecksumAddressUnmemoized=n.getChecksumAddress=n.getChecksumAddressUnmemoized=n.assertIsStrictHexString=n.assertIsHexString=n.isHexChecksumAddress=n.isHexAddress=n.isStrictHexString=n.isHexString=n.HexChecksumAddressStruct=n.HexAddressStruct=n.StrictHexStruct=n.HexStruct=void 0;const r=e("@metamask/superstruct"),a=e("@noble/hashes/sha3"),s=e("lodash"),i=e("./assert.cjs"),o=/^(?:0x)?[0-9a-f]+$/iu,c=/^0x[0-9a-f]+$/iu,l=/^0x[0-9a-f]{40}$/u,u=/^0x[0-9a-fA-F]{40}$/u;n.HexStruct=(0,r.pattern)((0,r.string)(),o),n.StrictHexStruct=(0,r.pattern)((0,r.string)(),c),n.HexAddressStruct=(0,r.pattern)((0,r.string)(),l),n.HexChecksumAddressStruct=(0,r.pattern)((0,r.string)(),u);const d=e=>"string"==typeof e;function h(e){return d(e)&&o.test(e)}function f(e){return d(e)&&c.test(e)}function m(e){return d(e)&&l.test(e)}function p(e){return d(e)&&u.test(e)}function g(e){(0,i.assert)(p(e),"Invalid hex address.");const t=T(e).toLowerCase(),n=(0,a.keccak_256)(t),{length:r}=t,s=new Array(r);for(let e=0;e<r;e++){const r=1&e,a=n[e>>1],i=0===r?a>>4:15&a;s[e]=i>=8?t[e].toUpperCase():t[e]}return`0x${s.join("")}`}function w(e){return!!p(e)&&(0,n.getChecksumAddress)(e)===e}function b(e){return m(e)||(0,n.isValidChecksumAddress)(e)}function T(e){return e.startsWith("0x")||e.startsWith("0X")?e.substring(2):e}n.isHexString=h,n.isStrictHexString=f,n.isHexAddress=m,n.isHexChecksumAddress=p,n.assertIsHexString=function(e){(0,i.assert)(h(e),"Value must be a hexadecimal string.")},n.assertIsStrictHexString=function(e){(0,i.assert)(f(e),'Value must be a hexadecimal string, starting with "0x".')},n.getChecksumAddressUnmemoized=g,n.getChecksumAddress=(0,s.memoize)(g),n.isValidChecksumAddressUnmemoized=w,n.isValidChecksumAddress=(0,s.memoize)(w),n.isValidHexAddressUnmemoized=b,n.isValidHexAddress=(0,s.memoize)(b),n.add0x=function(e){return e.startsWith("0x")?e:e.startsWith("0X")?`0x${e.substring(2)}`:`0x${e}`},n.remove0x=T}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/hex.cjs"}],[3207,{"./assert.cjs":3196,"./base64.cjs":3197,"./bytes.cjs":3198,"./caip-types.cjs":3199,"./checksum.cjs":3200,"./coercers.cjs":3201,"./collections.cjs":3202,"./encryption-types.cjs":3203,"./errors.cjs":3204,"./hashing.cjs":3205,"./hex.cjs":3206,"./json.cjs":3208,"./keyring.cjs":3209,"./logging.cjs":3210,"./misc.cjs":3211,"./number.cjs":3212,"./opaque.cjs":3213,"./promise.cjs":3214,"./superstruct.cjs":3215,"./time.cjs":3216,"./transaction-types.cjs":3217,"./unitsConversion.cjs":3218,"./versions.cjs":3219},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.unitMap=n.getValueOfUnit=n.numberToString=n.fromWei=n.toWei=n.remove0x=n.add0x=n.isValidChecksumAddress=n.getChecksumAddress=n.isValidHexAddress=n.assertIsStrictHexString=n.assertIsHexString=n.isHexChecksumAddress=n.isHexAddress=n.isStrictHexString=n.isHexString=n.HexChecksumAddressStruct=n.HexAddressStruct=n.StrictHexStruct=n.HexStruct=void 0,a(e("./assert.cjs"),n),a(e("./base64.cjs"),n),a(e("./bytes.cjs"),n),a(e("./caip-types.cjs"),n),a(e("./checksum.cjs"),n),a(e("./coercers.cjs"),n),a(e("./collections.cjs"),n),a(e("./encryption-types.cjs"),n),a(e("./errors.cjs"),n),a(e("./hashing.cjs"),n);var s=e("./hex.cjs");Object.defineProperty(n,"HexStruct",{enumerable:!0,get:function(){return s.HexStruct}}),Object.defineProperty(n,"StrictHexStruct",{enumerable:!0,get:function(){return s.StrictHexStruct}}),Object.defineProperty(n,"HexAddressStruct",{enumerable:!0,get:function(){return s.HexAddressStruct}}),Object.defineProperty(n,"HexChecksumAddressStruct",{enumerable:!0,get:function(){return s.HexChecksumAddressStruct}}),Object.defineProperty(n,"isHexString",{enumerable:!0,get:function(){return s.isHexString}}),Object.defineProperty(n,"isStrictHexString",{enumerable:!0,get:function(){return s.isStrictHexString}}),Object.defineProperty(n,"isHexAddress",{enumerable:!0,get:function(){return s.isHexAddress}}),Object.defineProperty(n,"isHexChecksumAddress",{enumerable:!0,get:function(){return s.isHexChecksumAddress}}),Object.defineProperty(n,"assertIsHexString",{enumerable:!0,get:function(){return s.assertIsHexString}}),Object.defineProperty(n,"assertIsStrictHexString",{enumerable:!0,get:function(){return s.assertIsStrictHexString}}),Object.defineProperty(n,"isValidHexAddress",{enumerable:!0,get:function(){return s.isValidHexAddress}}),Object.defineProperty(n,"getChecksumAddress",{enumerable:!0,get:function(){return s.getChecksumAddress}}),Object.defineProperty(n,"isValidChecksumAddress",{enumerable:!0,get:function(){return s.isValidChecksumAddress}}),Object.defineProperty(n,"add0x",{enumerable:!0,get:function(){return s.add0x}}),Object.defineProperty(n,"remove0x",{enumerable:!0,get:function(){return s.remove0x}}),a(e("./json.cjs"),n),a(e("./keyring.cjs"),n),a(e("./logging.cjs"),n),a(e("./misc.cjs"),n),a(e("./number.cjs"),n),a(e("./opaque.cjs"),n),a(e("./promise.cjs"),n),a(e("./superstruct.cjs"),n),a(e("./time.cjs"),n),a(e("./transaction-types.cjs"),n),a(e("./versions.cjs"),n);var i=e("./unitsConversion.cjs");Object.defineProperty(n,"toWei",{enumerable:!0,get:function(){return i.toWei}}),Object.defineProperty(n,"fromWei",{enumerable:!0,get:function(){return i.fromWei}}),Object.defineProperty(n,"numberToString",{enumerable:!0,get:function(){return i.numberToString}}),Object.defineProperty(n,"getValueOfUnit",{enumerable:!0,get:function(){return i.getValueOfUnit}}),Object.defineProperty(n,"unitMap",{enumerable:!0,get:function(){return i.unitMap}})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/index.cjs"}],[3208,{"./assert.cjs":3196,"./misc.cjs":3211,"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getJsonRpcIdValidator=n.assertIsJsonRpcError=n.isJsonRpcError=n.assertIsJsonRpcFailure=n.isJsonRpcFailure=n.assertIsJsonRpcSuccess=n.isJsonRpcSuccess=n.assertIsJsonRpcResponse=n.isJsonRpcResponse=n.assertIsPendingJsonRpcResponse=n.isPendingJsonRpcResponse=n.JsonRpcResponseStruct=n.JsonRpcFailureStruct=n.JsonRpcSuccessStruct=n.PendingJsonRpcResponseStruct=n.assertIsJsonRpcRequest=n.isJsonRpcRequest=n.assertIsJsonRpcNotification=n.isJsonRpcNotification=n.JsonRpcNotificationStruct=n.JsonRpcRequestStruct=n.JsonRpcParamsStruct=n.JsonRpcErrorStruct=n.JsonRpcIdStruct=n.JsonRpcVersionStruct=n.jsonrpc2=n.getJsonSize=n.getSafeJson=n.isValidJson=n.JsonStruct=n.UnsafeJsonStruct=n.exactOptional=n.object=void 0;const r=e("@metamask/superstruct"),a=e("./assert.cjs"),s=e("./misc.cjs");function i({path:e,branch:t}){const n=e[e.length-1];return(0,s.hasProperty)(t[t.length-2],n)}function o(e){return new r.Struct({...e,type:`optional ${e.type}`,validator:(t,n)=>!i(n)||e.validator(t,n),refiner:(t,n)=>!i(n)||e.refiner(t,n)})}function c(e){if(null===e||"boolean"==typeof e||"string"==typeof e)return!0;if("number"==typeof e&&Number.isFinite(e))return!0;if("object"==typeof e){let t=!0;if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(!c(e[n])){t=!1;break}return t}const n=Object.entries(e);for(let e=0;e<n.length;e++)if("string"!=typeof n[e][0]||!c(n[e][1])){t=!1;break}return t}return!1}function l(e){return(0,r.create)(e,n.JsonStruct)}n.object=e=>(0,r.object)(e),n.exactOptional=o,n.UnsafeJsonStruct=(0,r.define)("JSON",e=>c(e)),n.JsonStruct=(0,r.coerce)(n.UnsafeJsonStruct,(0,r.refine)((0,r.any)(),"JSON",e=>(0,r.is)(e,n.UnsafeJsonStruct)),e=>JSON.parse(JSON.stringify(e,(e,t)=>"__proto__"===e||"constructor"===e?undefined:t))),n.isValidJson=function(e){try{return l(e),!0}catch{return!1}},n.getSafeJson=l,n.getJsonSize=function(e){(0,a.assertStruct)(e,n.JsonStruct,"Invalid JSON value");const t=JSON.stringify(e);return(new TextEncoder).encode(t).byteLength},n.jsonrpc2="2.0",n.JsonRpcVersionStruct=(0,r.literal)(n.jsonrpc2),n.JsonRpcIdStruct=(0,r.nullable)((0,r.union)([(0,r.number)(),(0,r.string)()])),n.JsonRpcErrorStruct=(0,n.object)({code:(0,r.integer)(),message:(0,r.string)(),data:o(n.JsonStruct),stack:o((0,r.string)())}),n.JsonRpcParamsStruct=(0,r.union)([(0,r.record)((0,r.string)(),n.JsonStruct),(0,r.array)(n.JsonStruct)]),n.JsonRpcRequestStruct=(0,n.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,method:(0,r.string)(),params:o(n.JsonRpcParamsStruct)}),n.JsonRpcNotificationStruct=(0,n.object)({jsonrpc:n.JsonRpcVersionStruct,method:(0,r.string)(),params:o(n.JsonRpcParamsStruct)}),n.isJsonRpcNotification=function(e){return(0,r.is)(e,n.JsonRpcNotificationStruct)},n.assertIsJsonRpcNotification=function(e,t){(0,a.assertStruct)(e,n.JsonRpcNotificationStruct,"Invalid JSON-RPC notification",t)},n.isJsonRpcRequest=function(e){return(0,r.is)(e,n.JsonRpcRequestStruct)},n.assertIsJsonRpcRequest=function(e,t){(0,a.assertStruct)(e,n.JsonRpcRequestStruct,"Invalid JSON-RPC request",t)},n.PendingJsonRpcResponseStruct=(0,r.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,result:(0,r.optional)((0,r.unknown)()),error:(0,r.optional)(n.JsonRpcErrorStruct)}),n.JsonRpcSuccessStruct=(0,n.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,result:n.JsonStruct}),n.JsonRpcFailureStruct=(0,n.object)({id:n.JsonRpcIdStruct,jsonrpc:n.JsonRpcVersionStruct,error:n.JsonRpcErrorStruct}),n.JsonRpcResponseStruct=(0,r.union)([n.JsonRpcSuccessStruct,n.JsonRpcFailureStruct]),n.isPendingJsonRpcResponse=function(e){return(0,r.is)(e,n.PendingJsonRpcResponseStruct)},n.assertIsPendingJsonRpcResponse=function(e,t){(0,a.assertStruct)(e,n.PendingJsonRpcResponseStruct,"Invalid pending JSON-RPC response",t)},n.isJsonRpcResponse=function(e){return(0,r.is)(e,n.JsonRpcResponseStruct)},n.assertIsJsonRpcResponse=function(e,t){(0,a.assertStruct)(e,n.JsonRpcResponseStruct,"Invalid JSON-RPC response",t)},n.isJsonRpcSuccess=function(e){return(0,r.is)(e,n.JsonRpcSuccessStruct)},n.assertIsJsonRpcSuccess=function(e,t){(0,a.assertStruct)(e,n.JsonRpcSuccessStruct,"Invalid JSON-RPC success response",t)},n.isJsonRpcFailure=function(e){return(0,r.is)(e,n.JsonRpcFailureStruct)},n.assertIsJsonRpcFailure=function(e,t){(0,a.assertStruct)(e,n.JsonRpcFailureStruct,"Invalid JSON-RPC failure response",t)},n.isJsonRpcError=function(e){return(0,r.is)(e,n.JsonRpcErrorStruct)},n.assertIsJsonRpcError=function(e,t){(0,a.assertStruct)(e,n.JsonRpcErrorStruct,"Invalid JSON-RPC error",t)},n.getJsonRpcIdValidator=function(e){const{permitEmptyString:t,permitFractions:n,permitNull:r}={permitEmptyString:!0,permitFractions:!1,permitNull:!0,...e};return e=>Boolean("number"==typeof e&&(n||Number.isInteger(e))||"string"==typeof e&&(t||e.length>0)||r&&null===e)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/json.cjs"}],[3209,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/keyring.cjs"}],[3210,{debug:4325},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.createProjectLogger=void 0;const a=(0,r(e("debug")).default)("metamask");n.createProjectLogger=function(e){return a.extend(e)},n.createModuleLogger=function(e,t){return e.extend(t)}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/logging.cjs"}],[3211,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateNumberSize=n.calculateStringSize=n.isASCII=n.isPlainObject=n.ESCAPE_CHARACTERS_REGEXP=n.JsonSize=n.getKnownPropertyNames=n.hasProperty=n.isObject=n.isNullOrUndefined=n.isNonEmptyArray=void 0,n.isNonEmptyArray=function(e){return Array.isArray(e)&&e.length>0},n.isNullOrUndefined=function(e){return null===e||e===undefined},n.isObject=function(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)};function r(e){return e.charCodeAt(0)<=127}n.hasProperty=(e,t)=>Object.hasOwnProperty.call(e,t),n.getKnownPropertyNames=function(e){return Object.getOwnPropertyNames(e)},function(e){e[e.Null=4]="Null",e[e.Comma=1]="Comma",e[e.Wrapper=1]="Wrapper",e[e.True=4]="True",e[e.False=5]="False",e[e.Quote=1]="Quote",e[e.Colon=1]="Colon",e[e.Date=24]="Date"}(n.JsonSize||(n.JsonSize={})),n.ESCAPE_CHARACTERS_REGEXP=/"|\\|\n|\r|\t/gu,n.isPlainObject=function(e){if("object"!=typeof e||null===e)return!1;try{let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}catch(e){return!1}},n.isASCII=r,n.calculateStringSize=function(e){return e.split("").reduce((e,t)=>r(t)?e+1:e+2,0)+(e.match(n.ESCAPE_CHARACTERS_REGEXP)??[]).length},n.calculateNumberSize=function(e){return e.toString().length}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/misc.cjs"}],[3212,{"./assert.cjs":3196,"./hex.cjs":3206},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hexToBigInt=n.hexToNumber=n.bigIntToHex=n.numberToHex=void 0;const r=e("./assert.cjs"),a=e("./hex.cjs");n.numberToHex=e=>((0,r.assert)("number"==typeof e,"Value must be a number."),(0,r.assert)(e>=0,"Value must be a non-negative number."),(0,r.assert)(Number.isSafeInteger(e),"Value is not a safe integer. Use `bigIntToHex` instead."),(0,a.add0x)(e.toString(16)));n.bigIntToHex=e=>((0,r.assert)("bigint"==typeof e,"Value must be a bigint."),(0,r.assert)(e>=0,"Value must be a non-negative bigint."),(0,a.add0x)(e.toString(16)));n.hexToNumber=e=>{(0,a.assertIsHexString)(e);const t=parseInt(e,16);return(0,r.assert)(Number.isSafeInteger(t),"Value is not a safe integer. Use `hexToBigInt` instead."),t};n.hexToBigInt=e=>((0,a.assertIsHexString)(e),BigInt((0,a.add0x)(e)))}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/number.cjs"}],[3213,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/opaque.cjs"}],[3214,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createDeferredPromise=void 0,n.createDeferredPromise=function({suppressUnhandledRejection:e=!1}={}){let t,n;const r=new Promise((e,r)=>{t=e,n=r});return e&&r.catch(e=>{}),{promise:r,resolve:t,reject:n}}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/promise.cjs"}],[3215,{"@metamask/superstruct":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.definePattern=void 0;const r=e("@metamask/superstruct");n.definePattern=function(e,t){return(0,r.define)(e,e=>"string"==typeof e&&t.test(e))}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/superstruct.cjs"}],[3216,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.timeSince=n.inMilliseconds=n.Duration=void 0,function(e){e[e.Millisecond=1]="Millisecond",e[e.Second=1e3]="Second",e[e.Minute=6e4]="Minute",e[e.Hour=36e5]="Hour",e[e.Day=864e5]="Day",e[e.Week=6048e5]="Week",e[e.Year=31536e6]="Year"}(n.Duration||(n.Duration={}));const r=(e,t)=>{if(!(e=>Number.isInteger(e)&&e>=0)(e))throw new Error(`"${t}" must be a non-negative integer. Received: "${e}".`)};n.inMilliseconds=function(e,t){return r(e,"count"),e*t},n.timeSince=function(e){return r(e,"timestamp"),Date.now()-e}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/time.cjs"}],[3217,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/transaction-types.cjs"}],[3218,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toWei=n.fromWei=n.numberToString=n.getValueOfUnit=n.unitMap=n.numericToBigInt=void 0;const r=BigInt(0),a=BigInt(-1);function s(e){if("string"==typeof e)return BigInt(e);if("number"==typeof e)return BigInt(e);if("bigint"==typeof e)return e;throw new Error(`Cannot convert ${typeof e} to BigInt`)}n.numericToBigInt=s,n.unitMap={noether:"0",wei:"1",kwei:"1000",Kwei:"1000",babbage:"1000",femtoether:"1000",mwei:"1000000",Mwei:"1000000",lovelace:"1000000",picoether:"1000000",gwei:"1000000000",Gwei:"1000000000",shannon:"1000000000",nanoether:"1000000000",nano:"1000000000",szabo:"1000000000000",microether:"1000000000000",micro:"1000000000000",finney:"1000000000000000",milliether:"1000000000000000",milli:"1000000000000000",ether:"1000000000000000000",kether:"1000000000000000000000",grand:"1000000000000000000000",mether:"1000000000000000000000000",gether:"1000000000000000000000000000",tether:"1000000000000000000000000000000"};const i=Object.fromEntries(Object.entries(n.unitMap).map(([e,t])=>[e,BigInt(t)])),o=Object.fromEntries(Object.entries(n.unitMap).map(([e,t])=>[e,t.length-1||1])),c=/^-?[0-9.]+$/u,l=/^([0-9]*[1-9]|0)(0*)/u,u=/\B(?=(\d{3})+(?!\d))/gu;function d(e){if("string"==typeof e){if(!c.test(e))throw new Error(`while converting number to string, invalid number value '${e}', should be a number matching (^-?[0-9.]+).`);return e}if("number"==typeof e)return String(e);if("bigint"==typeof e)return e.toString();throw new Error(`while converting number to string, invalid number value '${String(e)}' type ${typeof e}.`)}n.getValueOfUnit=function(e="ether"){const t=e.toLowerCase(),r=i[t];if(r===undefined)throw new Error(`The unit provided ${e} doesn't exist, please use the one of the following units ${JSON.stringify(n.unitMap,null,2)}`);return r},n.numberToString=d,n.fromWei=function(e,t,c){let d=s(e);const h=d<r,f=t.toLowerCase(),m=i[f],p=o[f],g=c??{};if(m===undefined)throw new Error(`The unit provided ${t} doesn't exist, please use the one of the following units ${JSON.stringify(n.unitMap,null,2)}`);if(m===r)return h?"-0":"0";h&&(d*=a);let w=(d%m).toString();if(w=w.padStart(p,"0"),!g.pad){const e=w.match(l);w=e?.[1]??"0"}let b=(d/m).toString();g.commify&&(b=b.replace(u,","));let T=`${b}${"0"===w?"":`.${w}`}`;return h&&(T=`-${T}`),T},n.toWei=function(e,t){const s=t.toLowerCase(),c=i[s],l=o[s];if(c===undefined)throw new Error(`The unit provided ${t} doesn't exist, please use the one of the following units ${JSON.stringify(n.unitMap,null,2)}`);if(c===r)return r;if("bigint"==typeof e&&"wei"===s)return e;if("bigint"==typeof e)return e*c;let u=d(e);const h=u.startsWith("-");if(h&&(u=u.substring(1)),"."===u)throw new Error(`While converting number ${e} to wei, invalid value`);const f=u.split(".");if(f.length>2)throw new Error(`While converting number ${e} to wei,  too many decimal points`);let m=f[0],p=f[1];if(m||(m="0"),p||(p="0"),p.length>l)throw new Error(`While converting number ${e} to wei, too many decimal places`);p=p.padEnd(l,"0");let g=BigInt(m)*c+BigInt(p);return h&&(g*=a),g}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/unitsConversion.cjs"}],[3219,{"./assert.cjs":3196,"@metamask/superstruct":3027,semver:5688},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.satisfiesVersionRange=n.gtRange=n.gtVersion=n.assertIsSemVerRange=n.assertIsSemVerVersion=n.isValidSemVerRange=n.isValidSemVerVersion=n.VersionRangeStruct=n.VersionStruct=void 0;const r=e("@metamask/superstruct"),a=e("semver"),s=e("./assert.cjs");n.VersionStruct=(0,r.refine)((0,r.string)(),"Version",e=>null!==(0,a.valid)(e)||`Expected SemVer version, got "${e}"`),n.VersionRangeStruct=(0,r.refine)((0,r.string)(),"Version range",e=>null!==(0,a.validRange)(e)||`Expected SemVer range, got "${e}"`),n.isValidSemVerVersion=function(e){return(0,r.is)(e,n.VersionStruct)},n.isValidSemVerRange=function(e){return(0,r.is)(e,n.VersionRangeStruct)},n.assertIsSemVerVersion=function(e){(0,s.assertStruct)(e,n.VersionStruct)},n.assertIsSemVerRange=function(e){(0,s.assertStruct)(e,n.VersionRangeStruct)},n.gtVersion=function(e,t){return(0,a.gt)(e,t)},n.gtRange=function(e,t){return(0,a.gtr)(e,t)},n.satisfiesVersionRange=function(e,t){return(0,a.satisfies)(e,t,{includePrerelease:!0})}}}},{package:"@metamask/utils",file:"node_modules/@metamask/utils/dist/versions.cjs"}],[3221,{"./utils":3231,assert:4172,buffer:4176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=r(e("assert")),s=e("./utils");let i=[];var o;!function(e){e.STANDARD="standard",e.URI="uri",e.MINIMAL="minimal"}(o||(o={}));const c=e=>"ableacidalsoapexaquaarchatomauntawayaxisbackbaldbarnbeltbetabiasbluebodybragbrewbulbbuzzcalmcashcatschefcityclawcodecolacookcostcruxcurlcuspcyandarkdatadaysdelidicedietdoordowndrawdropdrumdulldutyeacheasyechoedgeepicevenexamexiteyesfactfairfernfigsfilmfishfizzflapflewfluxfoxyfreefrogfuelfundgalagamegeargemsgiftgirlglowgoodgraygrimgurugushgyrohalfhanghardhawkheathelphighhillholyhopehornhutsicedideaidleinchinkyintoirisironitemjadejazzjoinjoltjowljudojugsjumpjunkjurykeepkenokeptkeyskickkilnkingkitekiwiknoblamblavalazyleaflegsliarlimplionlistlogoloudloveluaulucklungmainmanymathmazememomenumeowmildmintmissmonknailnavyneednewsnextnoonnotenumbobeyoboeomitonyxopenovalowlspaidpartpeckplaypluspoempoolposepuffpumapurrquadquizraceramprealredorichroadrockroofrubyruinrunsrustsafesagascarsetssilkskewslotsoapsolosongstubsurfswantacotasktaxitenttiedtimetinytoiltombtoystriptunatwinuglyundouniturgeuservastveryvetovialvibeviewvisavoidvowswallwandwarmwaspwavewaxywebswhatwhenwhizwolfworkyankyawnyellyogayurtzapszerozestzinczonezoom".slice(4*e,4*e+4),l=e=>`${e}${s.getCRCHex(t.from(e,"hex"))}`,u=(e,n)=>{const r=l(e);return t.from(r,"hex").reduce((e,t)=>[...e,c(t)],[]).join(n)},d=e=>{const n=l(e);return t.from(n,"hex").reduce((e,t)=>e+(e=>{const t=c(e);return`${t[0]}${t[3]}`})(t),"")},h=(e,n,r)=>{const o=(4==r?e.split(n):s.partition(e,2)).map(e=>((e,n)=>{a.default(e.length===n,"Invalid Bytewords: word.length does not match wordLength provided");const r=26;if(0===i.length){i=[...new Array(676)].map(()=>-1);for(let e=0;e<256;e++){const t=c(e);let n=t[0].charCodeAt(0)-"a".charCodeAt(0),a=t[3].charCodeAt(0)-"a".charCodeAt(0);i[a*r+n]=e}}let s=e[0].toLowerCase().charCodeAt(0)-"a".charCodeAt(0),o=e[4==n?3:1].toLowerCase().charCodeAt(0)-"a".charCodeAt(0);a.default(0<=s&&s<r&&0<=o&&o<r,"Invalid Bytewords: invalid word");let l=i[o*r+s];if(a.default(-1!==l,"Invalid Bytewords: value not in lookup table"),4==n){const t=c(l);let n=e[1].toLowerCase(),r=e[2].toLowerCase();a.default(n===t[1]&&r===t[2],"Invalid Bytewords: invalid middle letters of word")}return t.from([l]).toString("hex")})(e,r)).join("");a.default(o.length>=5,"Invalid Bytewords: invalid decoded string length");const[l,u]=s.split(t.from(o,"hex"),4),d=s.getCRCHex(l);return a.default(d===u.toString("hex"),"Invalid Checksum"),l.toString("hex")};n.default={decode:(e,t=o.MINIMAL)=>{switch(t){case o.STANDARD:return h(e," ",4);case o.URI:return h(e,"-",4);case o.MINIMAL:return h(e,"",2);default:throw new Error(`Invalid style ${t}`)}},encode:(e,t=o.MINIMAL)=>{switch(t){case o.STANDARD:return u(e," ");case o.URI:return u(e,"-");case o.MINIMAL:return d(e);default:throw new Error(`Invalid style ${t}`)}},STYLES:o}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@ngraveio/bc-ur",file:"node_modules/@ngraveio/bc-ur/dist/bytewords.js"}],[3222,{buffer:4176,"cbor-sync":4196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.cborDecode=n.cborEncode=void 0;const r=e("cbor-sync");n.cborEncode=e=>r.encode(e);n.cborDecode=e=>r.decode(t.isBuffer(e)?e:t.from(e,"hex"))}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@ngraveio/bc-ur",file:"node_modules/@ngraveio/bc-ur/dist/cbor.js"}],[3223,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.InvalidChecksumError=n.InvalidSequenceComponentError=n.InvalidTypeError=n.InvalidPathLengthError=n.InvalidSchemeError=void 0;class r extends Error{constructor(){super("Invalid Scheme"),this.name="InvalidSchemeError"}}n.InvalidSchemeError=r;class a extends Error{constructor(){super("Invalid Path"),this.name="InvalidPathLengthError"}}n.InvalidPathLengthError=a;class s extends Error{constructor(){super("Invalid Type"),this.name="InvalidTypeError"}}n.InvalidTypeError=s;class i extends Error{constructor(){super("Invalid Sequence Component"),this.name="InvalidSequenceComponentError"}}n.InvalidSequenceComponentError=i;class o extends Error{constructor(){super("Invalid Checksum"),this.name="InvalidChecksumError"}}n.InvalidChecksumError=o}}},{package:"@ngraveio/bc-ur",file:"node_modules/@ngraveio/bc-ur/dist/errors.js"}]],[],{});